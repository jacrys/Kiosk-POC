(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const b of document.querySelectorAll('link[rel="modulepreload"]'))d(b);new MutationObserver(b=>{for(const E of b)if(E.type==="childList")for(const T of E.addedNodes)T.tagName==="LINK"&&T.rel==="modulepreload"&&d(T)}).observe(document,{childList:!0,subtree:!0});function u(b){const E={};return b.integrity&&(E.integrity=b.integrity),b.referrerPolicy&&(E.referrerPolicy=b.referrerPolicy),b.crossOrigin==="use-credentials"?E.credentials="include":b.crossOrigin==="anonymous"?E.credentials="omit":E.credentials="same-origin",E}function d(b){if(b.ep)return;b.ep=!0;const E=u(b);fetch(b.href,E)}})();/**
* @vue/shared v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function GT(e){const s=Object.create(null);for(const u of e.split(","))s[u]=1;return u=>u in s}const $s={},Xy=[],Np=()=>{},iB=()=>!1,R1=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&(e.charCodeAt(2)>122||e.charCodeAt(2)<97),qT=e=>e.startsWith("onUpdate:"),Gl=Object.assign,HT=(e,s)=>{const u=e.indexOf(s);u>-1&&e.splice(u,1)},rB=Object.prototype.hasOwnProperty,Es=(e,s)=>rB.call(e,s),na=Array.isArray,Yy=e=>L1(e)==="[object Map]",Ak=e=>L1(e)==="[object Set]",la=e=>typeof e=="function",jo=e=>typeof e=="string",Dm=e=>typeof e=="symbol",Ks=e=>e!==null&&typeof e=="object",kk=e=>(Ks(e)||la(e))&&la(e.then)&&la(e.catch),Dk=Object.prototype.toString,L1=e=>Dk.call(e),aB=e=>L1(e).slice(8,-1),Rk=e=>L1(e)==="[object Object]",ZT=e=>jo(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,zx=GT(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),z1=e=>{const s=Object.create(null);return u=>s[u]||(s[u]=e(u))},sB=/-(\w)/g,mh=z1(e=>e.replace(sB,(s,u)=>u?u.toUpperCase():"")),oB=/\B([A-Z])/g,q_=z1(e=>e.replace(oB,"-$1").toLowerCase()),$p=z1(e=>e.charAt(0).toUpperCase()+e.slice(1)),DS=z1(e=>e?`on${$p(e)}`:""),Ag=(e,s)=>!Object.is(e,s),t1=(e,...s)=>{for(let u=0;u<e.length;u++)e[u](...s)},Lk=(e,s,u,d=!1)=>{Object.defineProperty(e,s,{configurable:!0,enumerable:!1,writable:d,value:u})},U2=e=>{const s=parseFloat(e);return isNaN(s)?e:s},lB=e=>{const s=jo(e)?Number(e):NaN;return isNaN(s)?e:s};let vI;const O1=()=>vI||(vI=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Ky(e){if(na(e)){const s={};for(let u=0;u<e.length;u++){const d=e[u],b=jo(d)?dB(d):Ky(d);if(b)for(const E in b)s[E]=b[E]}return s}else if(jo(e)||Ks(e))return e}const cB=/;(?![^(]*\))/g,uB=/:([^]+)/,hB=/\/\*[^]*?\*\//g;function dB(e){const s={};return e.replace(hB,"").split(cB).forEach(u=>{if(u){const d=u.split(uB);d.length>1&&(s[d[0].trim()]=d[1].trim())}}),s}function WT(e){let s="";if(jo(e))s=e;else if(na(e))for(let u=0;u<e.length;u++){const d=WT(e[u]);d&&(s+=d+" ")}else if(Ks(e))for(const u in e)e[u]&&(s+=u+" ");return s.trim()}const fB="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",pB=GT(fB);function zk(e){return!!e||e===""}const Ok=e=>!!(e&&e.__v_isRef===!0),$x=e=>jo(e)?e:e==null?"":na(e)||Ks(e)&&(e.toString===Dk||!la(e.toString))?Ok(e)?$x(e.value):JSON.stringify(e,Fk,2):String(e),Fk=(e,s)=>Ok(s)?Fk(e,s.value):Yy(s)?{[`Map(${s.size})`]:[...s.entries()].reduce((u,[d,b],E)=>(u[RS(d,E)+" =>"]=b,u),{})}:Ak(s)?{[`Set(${s.size})`]:[...s.values()].map(u=>RS(u))}:Dm(s)?RS(s):Ks(s)&&!na(s)&&!Rk(s)?String(s):s,RS=(e,s="")=>{var u;return Dm(e)?`Symbol(${(u=e.description)!=null?u:s})`:e};/**
* @vue/reactivity v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Au;class Bk{constructor(s=!1){this.detached=s,this._active=!0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=Au,!s&&Au&&(this.index=(Au.scopes||(Au.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let s,u;if(this.scopes)for(s=0,u=this.scopes.length;s<u;s++)this.scopes[s].pause();for(s=0,u=this.effects.length;s<u;s++)this.effects[s].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let s,u;if(this.scopes)for(s=0,u=this.scopes.length;s<u;s++)this.scopes[s].resume();for(s=0,u=this.effects.length;s<u;s++)this.effects[s].resume()}}run(s){if(this._active){const u=Au;try{return Au=this,s()}finally{Au=u}}}on(){Au=this}off(){Au=this.parent}stop(s){if(this._active){this._active=!1;let u,d;for(u=0,d=this.effects.length;u<d;u++)this.effects[u].stop();for(this.effects.length=0,u=0,d=this.cleanups.length;u<d;u++)this.cleanups[u]();if(this.cleanups.length=0,this.scopes){for(u=0,d=this.scopes.length;u<d;u++)this.scopes[u].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!s){const b=this.parent.scopes.pop();b&&b!==this&&(this.parent.scopes[this.index]=b,b.index=this.index)}this.parent=void 0}}}function XT(e){return new Bk(e)}function mB(){return Au}function nu(e,s=!1){Au&&Au.cleanups.push(e)}let Xs;const LS=new WeakSet;class Vk{constructor(s){this.fn=s,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,Au&&Au.active&&Au.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,LS.has(this)&&(LS.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||jk(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,xI(this),Uk(this);const s=Xs,u=Lf;Xs=this,Lf=!0;try{return this.fn()}finally{$k(this),Xs=s,Lf=u,this.flags&=-3}}stop(){if(this.flags&1){for(let s=this.deps;s;s=s.nextDep)JT(s);this.deps=this.depsTail=void 0,xI(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?LS.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){$2(this)&&this.run()}get dirty(){return $2(this)}}let Nk=0,Ox,Fx;function jk(e,s=!1){if(e.flags|=8,s){e.next=Fx,Fx=e;return}e.next=Ox,Ox=e}function YT(){Nk++}function KT(){if(--Nk>0)return;if(Fx){let s=Fx;for(Fx=void 0;s;){const u=s.next;s.next=void 0,s.flags&=-9,s=u}}let e;for(;Ox;){let s=Ox;for(Ox=void 0;s;){const u=s.next;if(s.next=void 0,s.flags&=-9,s.flags&1)try{s.trigger()}catch(d){e||(e=d)}s=u}}if(e)throw e}function Uk(e){for(let s=e.deps;s;s=s.nextDep)s.version=-1,s.prevActiveLink=s.dep.activeLink,s.dep.activeLink=s}function $k(e){let s,u=e.depsTail,d=u;for(;d;){const b=d.prevDep;d.version===-1?(d===u&&(u=b),JT(d),gB(d)):s=d,d.dep.activeLink=d.prevActiveLink,d.prevActiveLink=void 0,d=b}e.deps=s,e.depsTail=u}function $2(e){for(let s=e.deps;s;s=s.nextDep)if(s.dep.version!==s.version||s.dep.computed&&(Gk(s.dep.computed)||s.dep.version!==s.version))return!0;return!!e._dirty}function Gk(e){if(e.flags&4&&!(e.flags&16)||(e.flags&=-17,e.globalVersion===Gx))return;e.globalVersion=Gx;const s=e.dep;if(e.flags|=2,s.version>0&&!e.isSSR&&e.deps&&!$2(e)){e.flags&=-3;return}const u=Xs,d=Lf;Xs=e,Lf=!0;try{Uk(e);const b=e.fn(e._value);(s.version===0||Ag(b,e._value))&&(e._value=b,s.version++)}catch(b){throw s.version++,b}finally{Xs=u,Lf=d,$k(e),e.flags&=-3}}function JT(e,s=!1){const{dep:u,prevSub:d,nextSub:b}=e;if(d&&(d.nextSub=b,e.prevSub=void 0),b&&(b.prevSub=d,e.nextSub=void 0),u.subs===e&&(u.subs=d,!d&&u.computed)){u.computed.flags&=-5;for(let E=u.computed.deps;E;E=E.nextDep)JT(E,!0)}!s&&!--u.sc&&u.map&&u.map.delete(u.key)}function gB(e){const{prevDep:s,nextDep:u}=e;s&&(s.nextDep=u,e.prevDep=void 0),u&&(u.prevDep=s,e.nextDep=void 0)}let Lf=!0;const qk=[];function Rg(){qk.push(Lf),Lf=!1}function Lg(){const e=qk.pop();Lf=e===void 0?!0:e}function xI(e){const{cleanup:s}=e;if(e.cleanup=void 0,s){const u=Xs;Xs=void 0;try{s()}finally{Xs=u}}}let Gx=0;class _B{constructor(s,u){this.sub=s,this.dep=u,this.version=u.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class QT{constructor(s){this.computed=s,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(s){if(!Xs||!Lf||Xs===this.computed)return;let u=this.activeLink;if(u===void 0||u.sub!==Xs)u=this.activeLink=new _B(Xs,this),Xs.deps?(u.prevDep=Xs.depsTail,Xs.depsTail.nextDep=u,Xs.depsTail=u):Xs.deps=Xs.depsTail=u,Hk(u);else if(u.version===-1&&(u.version=this.version,u.nextDep)){const d=u.nextDep;d.prevDep=u.prevDep,u.prevDep&&(u.prevDep.nextDep=d),u.prevDep=Xs.depsTail,u.nextDep=void 0,Xs.depsTail.nextDep=u,Xs.depsTail=u,Xs.deps===u&&(Xs.deps=d)}return u}trigger(s){this.version++,Gx++,this.notify(s)}notify(s){YT();try{for(let u=this.subs;u;u=u.prevSub)u.sub.notify()&&u.sub.dep.notify()}finally{KT()}}}function Hk(e){if(e.dep.sc++,e.sub.flags&4){const s=e.dep.computed;if(s&&!e.dep.subs){s.flags|=20;for(let d=s.deps;d;d=d.nextDep)Hk(d)}const u=e.dep.subs;u!==e&&(e.prevSub=u,u&&(u.nextSub=e)),e.dep.subs=e}}const f1=new WeakMap,A_=Symbol(""),G2=Symbol(""),qx=Symbol("");function Xc(e,s,u){if(Lf&&Xs){let d=f1.get(e);d||f1.set(e,d=new Map);let b=d.get(u);b||(d.set(u,b=new QT),b.map=d,b.key=u),b.track()}}function Tm(e,s,u,d,b,E){const T=f1.get(e);if(!T){Gx++;return}const t=G=>{G&&G.trigger()};if(YT(),s==="clear")T.forEach(t);else{const G=na(e),W=G&&ZT(u);if(G&&u==="length"){const Y=Number(d);T.forEach((ne,J)=>{(J==="length"||J===qx||!Dm(J)&&J>=Y)&&t(ne)})}else switch((u!==void 0||T.has(void 0))&&t(T.get(u)),W&&t(T.get(qx)),s){case"add":G?W&&t(T.get("length")):(t(T.get(A_)),Yy(e)&&t(T.get(G2)));break;case"delete":G||(t(T.get(A_)),Yy(e)&&t(T.get(G2)));break;case"set":Yy(e)&&t(T.get(A_));break}}KT()}function yB(e,s){const u=f1.get(e);return u&&u.get(s)}function Vy(e){const s=Gr(e);return s===e?s:(Xc(s,"iterate",qx),Fd(e)?s:s.map(Yc))}function F1(e){return Xc(e=Gr(e),"iterate",qx),e}const vB={__proto__:null,[Symbol.iterator](){return zS(this,Symbol.iterator,Yc)},concat(...e){return Vy(this).concat(...e.map(s=>na(s)?Vy(s):s))},entries(){return zS(this,"entries",e=>(e[1]=Yc(e[1]),e))},every(e,s){return bm(this,"every",e,s,void 0,arguments)},filter(e,s){return bm(this,"filter",e,s,u=>u.map(Yc),arguments)},find(e,s){return bm(this,"find",e,s,Yc,arguments)},findIndex(e,s){return bm(this,"findIndex",e,s,void 0,arguments)},findLast(e,s){return bm(this,"findLast",e,s,Yc,arguments)},findLastIndex(e,s){return bm(this,"findLastIndex",e,s,void 0,arguments)},forEach(e,s){return bm(this,"forEach",e,s,void 0,arguments)},includes(...e){return OS(this,"includes",e)},indexOf(...e){return OS(this,"indexOf",e)},join(e){return Vy(this).join(e)},lastIndexOf(...e){return OS(this,"lastIndexOf",e)},map(e,s){return bm(this,"map",e,s,void 0,arguments)},pop(){return xx(this,"pop")},push(...e){return xx(this,"push",e)},reduce(e,...s){return bI(this,"reduce",e,s)},reduceRight(e,...s){return bI(this,"reduceRight",e,s)},shift(){return xx(this,"shift")},some(e,s){return bm(this,"some",e,s,void 0,arguments)},splice(...e){return xx(this,"splice",e)},toReversed(){return Vy(this).toReversed()},toSorted(e){return Vy(this).toSorted(e)},toSpliced(...e){return Vy(this).toSpliced(...e)},unshift(...e){return xx(this,"unshift",e)},values(){return zS(this,"values",Yc)}};function zS(e,s,u){const d=F1(e),b=d[s]();return d!==e&&!Fd(e)&&(b._next=b.next,b.next=()=>{const E=b._next();return E.value&&(E.value=u(E.value)),E}),b}const xB=Array.prototype;function bm(e,s,u,d,b,E){const T=F1(e),t=T!==e&&!Fd(e),G=T[s];if(G!==xB[s]){const ne=G.apply(e,E);return t?Yc(ne):ne}let W=u;T!==e&&(t?W=function(ne,J){return u.call(this,Yc(ne),J,e)}:u.length>2&&(W=function(ne,J){return u.call(this,ne,J,e)}));const Y=G.call(T,W,d);return t&&b?b(Y):Y}function bI(e,s,u,d){const b=F1(e);let E=u;return b!==e&&(Fd(e)?u.length>3&&(E=function(T,t,G){return u.call(this,T,t,G,e)}):E=function(T,t,G){return u.call(this,T,Yc(t),G,e)}),b[s](E,...d)}function OS(e,s,u){const d=Gr(e);Xc(d,"iterate",qx);const b=d[s](...u);return(b===-1||b===!1)&&nC(u[0])?(u[0]=Gr(u[0]),d[s](...u)):b}function xx(e,s,u=[]){Rg(),YT();const d=Gr(e)[s].apply(e,u);return KT(),Lg(),d}const bB=GT("__proto__,__v_isRef,__isVue"),Zk=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>e!=="arguments"&&e!=="caller").map(e=>Symbol[e]).filter(Dm));function wB(e){Dm(e)||(e=String(e));const s=Gr(this);return Xc(s,"has",e),s.hasOwnProperty(e)}class Wk{constructor(s=!1,u=!1){this._isReadonly=s,this._isShallow=u}get(s,u,d){if(u==="__v_skip")return s.__v_skip;const b=this._isReadonly,E=this._isShallow;if(u==="__v_isReactive")return!b;if(u==="__v_isReadonly")return b;if(u==="__v_isShallow")return E;if(u==="__v_raw")return d===(b?E?DB:Jk:E?Kk:Yk).get(s)||Object.getPrototypeOf(s)===Object.getPrototypeOf(d)?s:void 0;const T=na(s);if(!b){let G;if(T&&(G=vB[u]))return G;if(u==="hasOwnProperty")return wB}const t=Reflect.get(s,u,Mo(s)?s:d);return(Dm(u)?Zk.has(u):bB(u))||(b||Xc(s,"get",u),E)?t:Mo(t)?T&&ZT(u)?t:t.value:Ks(t)?b?ub(t):$l(t):t}}class Xk extends Wk{constructor(s=!1){super(!1,s)}set(s,u,d,b){let E=s[u];if(!this._isShallow){const G=z_(E);if(!Fd(d)&&!z_(d)&&(E=Gr(E),d=Gr(d)),!na(s)&&Mo(E)&&!Mo(d))return G?!1:(E.value=d,!0)}const T=na(s)&&ZT(u)?Number(u)<s.length:Es(s,u),t=Reflect.set(s,u,d,Mo(s)?s:b);return s===Gr(b)&&(T?Ag(d,E)&&Tm(s,"set",u,d):Tm(s,"add",u,d)),t}deleteProperty(s,u){const d=Es(s,u);s[u];const b=Reflect.deleteProperty(s,u);return b&&d&&Tm(s,"delete",u,void 0),b}has(s,u){const d=Reflect.has(s,u);return(!Dm(u)||!Zk.has(u))&&Xc(s,"has",u),d}ownKeys(s){return Xc(s,"iterate",na(s)?"length":A_),Reflect.ownKeys(s)}}class SB extends Wk{constructor(s=!1){super(!0,s)}set(s,u){return!0}deleteProperty(s,u){return!0}}const TB=new Xk,CB=new SB,EB=new Xk(!0);const q2=e=>e,V0=e=>Reflect.getPrototypeOf(e);function MB(e,s,u){return function(...d){const b=this.__v_raw,E=Gr(b),T=Yy(E),t=e==="entries"||e===Symbol.iterator&&T,G=e==="keys"&&T,W=b[e](...d),Y=u?q2:s?H2:Yc;return!s&&Xc(E,"iterate",G?G2:A_),{next(){const{value:ne,done:J}=W.next();return J?{value:ne,done:J}:{value:t?[Y(ne[0]),Y(ne[1])]:Y(ne),done:J}},[Symbol.iterator](){return this}}}}function N0(e){return function(...s){return e==="delete"?!1:e==="clear"?void 0:this}}function IB(e,s){const u={get(b){const E=this.__v_raw,T=Gr(E),t=Gr(b);e||(Ag(b,t)&&Xc(T,"get",b),Xc(T,"get",t));const{has:G}=V0(T),W=s?q2:e?H2:Yc;if(G.call(T,b))return W(E.get(b));if(G.call(T,t))return W(E.get(t));E!==T&&E.get(b)},get size(){const b=this.__v_raw;return!e&&Xc(Gr(b),"iterate",A_),Reflect.get(b,"size",b)},has(b){const E=this.__v_raw,T=Gr(E),t=Gr(b);return e||(Ag(b,t)&&Xc(T,"has",b),Xc(T,"has",t)),b===t?E.has(b):E.has(b)||E.has(t)},forEach(b,E){const T=this,t=T.__v_raw,G=Gr(t),W=s?q2:e?H2:Yc;return!e&&Xc(G,"iterate",A_),t.forEach((Y,ne)=>b.call(E,W(Y),W(ne),T))}};return Gl(u,e?{add:N0("add"),set:N0("set"),delete:N0("delete"),clear:N0("clear")}:{add(b){!s&&!Fd(b)&&!z_(b)&&(b=Gr(b));const E=Gr(this);return V0(E).has.call(E,b)||(E.add(b),Tm(E,"add",b,b)),this},set(b,E){!s&&!Fd(E)&&!z_(E)&&(E=Gr(E));const T=Gr(this),{has:t,get:G}=V0(T);let W=t.call(T,b);W||(b=Gr(b),W=t.call(T,b));const Y=G.call(T,b);return T.set(b,E),W?Ag(E,Y)&&Tm(T,"set",b,E):Tm(T,"add",b,E),this},delete(b){const E=Gr(this),{has:T,get:t}=V0(E);let G=T.call(E,b);G||(b=Gr(b),G=T.call(E,b)),t&&t.call(E,b);const W=E.delete(b);return G&&Tm(E,"delete",b,void 0),W},clear(){const b=Gr(this),E=b.size!==0,T=b.clear();return E&&Tm(b,"clear",void 0,void 0),T}}),["keys","values","entries",Symbol.iterator].forEach(b=>{u[b]=MB(b,e,s)}),u}function eC(e,s){const u=IB(e,s);return(d,b,E)=>b==="__v_isReactive"?!e:b==="__v_isReadonly"?e:b==="__v_raw"?d:Reflect.get(Es(u,b)&&b in d?u:d,b,E)}const PB={get:eC(!1,!1)},AB={get:eC(!1,!0)},kB={get:eC(!0,!1)};const Yk=new WeakMap,Kk=new WeakMap,Jk=new WeakMap,DB=new WeakMap;function RB(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function LB(e){return e.__v_skip||!Object.isExtensible(e)?0:RB(aB(e))}function $l(e){return z_(e)?e:tC(e,!1,TB,PB,Yk)}function Qk(e){return tC(e,!1,EB,AB,Kk)}function ub(e){return tC(e,!0,CB,kB,Jk)}function tC(e,s,u,d,b){if(!Ks(e)||e.__v_raw&&!(s&&e.__v_isReactive))return e;const E=b.get(e);if(E)return E;const T=LB(e);if(T===0)return e;const t=new Proxy(e,T===2?d:u);return b.set(e,t),t}function Jy(e){return z_(e)?Jy(e.__v_raw):!!(e&&e.__v_isReactive)}function z_(e){return!!(e&&e.__v_isReadonly)}function Fd(e){return!!(e&&e.__v_isShallow)}function nC(e){return e?!!e.__v_raw:!1}function Gr(e){const s=e&&e.__v_raw;return s?Gr(s):e}function eD(e){return!Es(e,"__v_skip")&&Object.isExtensible(e)&&Lk(e,"__v_skip",!0),e}const Yc=e=>Ks(e)?$l(e):e,H2=e=>Ks(e)?ub(e):e;function Mo(e){return e?e.__v_isRef===!0:!1}function yi(e){return tD(e,!1)}function Bi(e){return tD(e,!0)}function tD(e,s){return Mo(e)?e:new zB(e,s)}class zB{constructor(s,u){this.dep=new QT,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=u?s:Gr(s),this._value=u?s:Yc(s),this.__v_isShallow=u}get value(){return this.dep.track(),this._value}set value(s){const u=this._rawValue,d=this.__v_isShallow||Fd(s)||z_(s);s=d?s:Gr(s),Ag(s,u)&&(this._rawValue=s,this._value=d?s:Yc(s),this.dep.trigger())}}function Ps(e){return Mo(e)?e.value:e}const OB={get:(e,s,u)=>s==="__v_raw"?e:Ps(Reflect.get(e,s,u)),set:(e,s,u,d)=>{const b=e[s];return Mo(b)&&!Mo(u)?(b.value=u,!0):Reflect.set(e,s,u,d)}};function nD(e){return Jy(e)?e:new Proxy(e,OB)}function zg(e){const s=na(e)?new Array(e.length):{};for(const u in e)s[u]=iD(e,u);return s}class FB{constructor(s,u,d){this._object=s,this._key=u,this._defaultValue=d,this.__v_isRef=!0,this._value=void 0}get value(){const s=this._object[this._key];return this._value=s===void 0?this._defaultValue:s}set value(s){this._object[this._key]=s}get dep(){return yB(Gr(this._object),this._key)}}class BB{constructor(s){this._getter=s,this.__v_isRef=!0,this.__v_isReadonly=!0,this._value=void 0}get value(){return this._value=this._getter()}}function $n(e,s,u){return Mo(e)?e:la(e)?new BB(e):Ks(e)&&arguments.length>1?iD(e,s,u):yi(e)}function iD(e,s,u){const d=e[s];return Mo(d)?d:new FB(e,s,u)}class VB{constructor(s,u,d){this.fn=s,this.setter=u,this._value=void 0,this.dep=new QT(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Gx-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!u,this.isSSR=d}notify(){if(this.flags|=16,!(this.flags&8)&&Xs!==this)return jk(this,!0),!0}get value(){const s=this.dep.track();return Gk(this),s&&(s.version=this.dep.version),this._value}set value(s){this.setter&&this.setter(s)}}function NB(e,s,u=!1){let d,b;return la(e)?d=e:(d=e.get,b=e.set),new VB(d,b,u)}const j0={},p1=new WeakMap;let E_;function jB(e,s=!1,u=E_){if(u){let d=p1.get(u);d||p1.set(u,d=[]),d.push(e)}}function UB(e,s,u=$s){const{immediate:d,deep:b,once:E,scheduler:T,augmentJob:t,call:G}=u,W=Le=>b?Le:Fd(Le)||b===!1||b===0?Cm(Le,1):Cm(Le);let Y,ne,J,Q,ce=!1,ie=!1;if(Mo(e)?(ne=()=>e.value,ce=Fd(e)):Jy(e)?(ne=()=>W(e),ce=!0):na(e)?(ie=!0,ce=e.some(Le=>Jy(Le)||Fd(Le)),ne=()=>e.map(Le=>{if(Mo(Le))return Le.value;if(Jy(Le))return W(Le);if(la(Le))return G?G(Le,2):Le()})):la(e)?s?ne=G?()=>G(e,2):e:ne=()=>{if(J){Rg();try{J()}finally{Lg()}}const Le=E_;E_=Y;try{return G?G(e,3,[Q]):e(Q)}finally{E_=Le}}:ne=Np,s&&b){const Le=ne,Oe=b===!0?1/0:b;ne=()=>Cm(Le(),Oe)}const pe=mB(),be=()=>{Y.stop(),pe&&pe.active&&HT(pe.effects,Y)};if(E&&s){const Le=s;s=(...Oe)=>{Le(...Oe),be()}}let Ie=ie?new Array(e.length).fill(j0):j0;const $e=Le=>{if(!(!(Y.flags&1)||!Y.dirty&&!Le))if(s){const Oe=Y.run();if(b||ce||(ie?Oe.some((Ve,Ue)=>Ag(Ve,Ie[Ue])):Ag(Oe,Ie))){J&&J();const Ve=E_;E_=Y;try{const Ue=[Oe,Ie===j0?void 0:ie&&Ie[0]===j0?[]:Ie,Q];G?G(s,3,Ue):s(...Ue),Ie=Oe}finally{E_=Ve}}}else Y.run()};return t&&t($e),Y=new Vk(ne),Y.scheduler=T?()=>T($e,!1):$e,Q=Le=>jB(Le,!1,Y),J=Y.onStop=()=>{const Le=p1.get(Y);if(Le){if(G)G(Le,4);else for(const Oe of Le)Oe();p1.delete(Y)}},s?d?$e(!0):Ie=Y.run():T?T($e.bind(null,!0),!0):Y.run(),be.pause=Y.pause.bind(Y),be.resume=Y.resume.bind(Y),be.stop=be,be}function Cm(e,s=1/0,u){if(s<=0||!Ks(e)||e.__v_skip||(u=u||new Set,u.has(e)))return e;if(u.add(e),s--,Mo(e))Cm(e.value,s,u);else if(na(e))for(let d=0;d<e.length;d++)Cm(e[d],s,u);else if(Ak(e)||Yy(e))e.forEach(d=>{Cm(d,s,u)});else if(Rk(e)){for(const d in e)Cm(e[d],s,u);for(const d of Object.getOwnPropertySymbols(e))Object.prototype.propertyIsEnumerable.call(e,d)&&Cm(e[d],s,u)}return e}/**
* @vue/runtime-core v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function hb(e,s,u,d){try{return d?e(...d):e()}catch(b){B1(b,s,u)}}function zf(e,s,u,d){if(la(e)){const b=hb(e,s,u,d);return b&&kk(b)&&b.catch(E=>{B1(E,s,u)}),b}if(na(e)){const b=[];for(let E=0;E<e.length;E++)b.push(zf(e[E],s,u,d));return b}}function B1(e,s,u,d=!0){const b=s?s.vnode:null,{errorHandler:E,throwUnhandledErrorInProduction:T}=s&&s.appContext.config||$s;if(s){let t=s.parent;const G=s.proxy,W=`https://vuejs.org/error-reference/#runtime-${u}`;for(;t;){const Y=t.ec;if(Y){for(let ne=0;ne<Y.length;ne++)if(Y[ne](e,G,W)===!1)return}t=t.parent}if(E){Rg(),hb(E,null,10,[e,G,W]),Lg();return}}$B(e,u,b,d,T)}function $B(e,s,u,d=!0,b=!1){if(b)throw e;console.error(e)}const ku=[];let Fp=-1;const Qy=[];let Sg=null,Gy=0;const rD=Promise.resolve();let m1=null;function Na(e){const s=m1||rD;return e?s.then(this?e.bind(this):e):s}function GB(e){let s=Fp+1,u=ku.length;for(;s<u;){const d=s+u>>>1,b=ku[d],E=Hx(b);E<e||E===e&&b.flags&2?s=d+1:u=d}return s}function iC(e){if(!(e.flags&1)){const s=Hx(e),u=ku[ku.length-1];!u||!(e.flags&2)&&s>=Hx(u)?ku.push(e):ku.splice(GB(s),0,e),e.flags|=1,aD()}}function aD(){m1||(m1=rD.then(oD))}function qB(e){na(e)?Qy.push(...e):Sg&&e.id===-1?Sg.splice(Gy+1,0,e):e.flags&1||(Qy.push(e),e.flags|=1),aD()}function wI(e,s,u=Fp+1){for(;u<ku.length;u++){const d=ku[u];if(d&&d.flags&2){if(e&&d.id!==e.uid)continue;ku.splice(u,1),u--,d.flags&4&&(d.flags&=-2),d(),d.flags&4||(d.flags&=-2)}}}function sD(e){if(Qy.length){const s=[...new Set(Qy)].sort((u,d)=>Hx(u)-Hx(d));if(Qy.length=0,Sg){Sg.push(...s);return}for(Sg=s,Gy=0;Gy<Sg.length;Gy++){const u=Sg[Gy];u.flags&4&&(u.flags&=-2),u.flags&8||u(),u.flags&=-2}Sg=null,Gy=0}}const Hx=e=>e.id==null?e.flags&2?-1:1/0:e.id;function oD(e){try{for(Fp=0;Fp<ku.length;Fp++){const s=ku[Fp];s&&!(s.flags&8)&&(s.flags&4&&(s.flags&=-2),hb(s,s.i,s.i?15:14),s.flags&4||(s.flags&=-2))}}finally{for(;Fp<ku.length;Fp++){const s=ku[Fp];s&&(s.flags&=-2)}Fp=-1,ku.length=0,sD(),m1=null,(ku.length||Qy.length)&&oD()}}let oc=null,lD=null;function g1(e){const s=oc;return oc=e,lD=e&&e.type.__scopeId||null,s}function fh(e,s=oc,u){if(!s||e._n)return e;const d=(...b)=>{d._d&&OI(-1);const E=g1(s);let T;try{T=e(...b)}finally{g1(E),d._d&&OI(1)}return T};return d._n=!0,d._c=!0,d._d=!0,d}function Js(e,s){if(oc===null)return e;const u=U1(oc),d=e.dirs||(e.dirs=[]);for(let b=0;b<s.length;b++){let[E,T,t,G=$s]=s[b];E&&(la(E)&&(E={mounted:E,updated:E}),E.deep&&Cm(T),d.push({dir:E,instance:u,value:T,oldValue:void 0,arg:t,modifiers:G}))}return e}function b_(e,s,u,d){const b=e.dirs,E=s&&s.dirs;for(let T=0;T<b.length;T++){const t=b[T];E&&(t.oldValue=E[T].value);let G=t.dir[d];G&&(Rg(),zf(G,u,8,[e.el,t,e,s]),Lg())}}const cD=Symbol("_vte"),uD=e=>e.__isTeleport,Bx=e=>e&&(e.disabled||e.disabled===""),SI=e=>e&&(e.defer||e.defer===""),TI=e=>typeof SVGElement<"u"&&e instanceof SVGElement,CI=e=>typeof MathMLElement=="function"&&e instanceof MathMLElement,Z2=(e,s)=>{const u=e&&e.to;return jo(u)?s?s(u):null:u},hD={name:"Teleport",__isTeleport:!0,process(e,s,u,d,b,E,T,t,G,W){const{mc:Y,pc:ne,pbc:J,o:{insert:Q,querySelector:ce,createText:ie,createComment:pe}}=W,be=Bx(s.props);let{shapeFlag:Ie,children:$e,dynamicChildren:Le}=s;if(e==null){const Oe=s.el=ie(""),Ve=s.anchor=ie("");Q(Oe,u,d),Q(Ve,u,d);const Ue=(He,nt)=>{Ie&16&&(b&&b.isCE&&(b.ce._teleportTarget=He),Y($e,He,nt,b,E,T,t,G))},qe=()=>{const He=s.target=Z2(s.props,ce),nt=dD(He,s,ie,Q);He&&(T!=="svg"&&TI(He)?T="svg":T!=="mathml"&&CI(He)&&(T="mathml"),be||(Ue(He,nt),n1(s,!1)))};be&&(Ue(u,Ve),n1(s,!0)),SI(s.props)?Pu(()=>{qe(),s.el.__isMounted=!0},E):qe()}else{if(SI(s.props)&&!e.el.__isMounted){Pu(()=>{hD.process(e,s,u,d,b,E,T,t,G,W),delete e.el.__isMounted},E);return}s.el=e.el,s.targetStart=e.targetStart;const Oe=s.anchor=e.anchor,Ve=s.target=e.target,Ue=s.targetAnchor=e.targetAnchor,qe=Bx(e.props),He=qe?u:Ve,nt=qe?Oe:Ue;if(T==="svg"||TI(Ve)?T="svg":(T==="mathml"||CI(Ve))&&(T="mathml"),Le?(J(e.dynamicChildren,Le,He,b,E,T,t),uC(e,s,!0)):G||ne(e,s,He,nt,b,E,T,t,!1),be)qe?s.props&&e.props&&s.props.to!==e.props.to&&(s.props.to=e.props.to):U0(s,u,Oe,W,1);else if((s.props&&s.props.to)!==(e.props&&e.props.to)){const rt=s.target=Z2(s.props,ce);rt&&U0(s,rt,null,W,0)}else qe&&U0(s,Ve,Ue,W,1);n1(s,be)}},remove(e,s,u,{um:d,o:{remove:b}},E){const{shapeFlag:T,children:t,anchor:G,targetStart:W,targetAnchor:Y,target:ne,props:J}=e;if(ne&&(b(W),b(Y)),E&&b(G),T&16){const Q=E||!Bx(J);for(let ce=0;ce<t.length;ce++){const ie=t[ce];d(ie,s,u,Q,!!ie.dynamicChildren)}}},move:U0,hydrate:HB};function U0(e,s,u,{o:{insert:d},m:b},E=2){E===0&&d(e.targetAnchor,s,u);const{el:T,anchor:t,shapeFlag:G,children:W,props:Y}=e,ne=E===2;if(ne&&d(T,s,u),(!ne||Bx(Y))&&G&16)for(let J=0;J<W.length;J++)b(W[J],s,u,2);ne&&d(t,s,u)}function HB(e,s,u,d,b,E,{o:{nextSibling:T,parentNode:t,querySelector:G,insert:W,createText:Y}},ne){const J=s.target=Z2(s.props,G);if(J){const Q=Bx(s.props),ce=J._lpa||J.firstChild;if(s.shapeFlag&16)if(Q)s.anchor=ne(T(e),s,t(e),u,d,b,E),s.targetStart=ce,s.targetAnchor=ce&&T(ce);else{s.anchor=T(e);let ie=ce;for(;ie;){if(ie&&ie.nodeType===8){if(ie.data==="teleport start anchor")s.targetStart=ie;else if(ie.data==="teleport anchor"){s.targetAnchor=ie,J._lpa=s.targetAnchor&&T(s.targetAnchor);break}}ie=T(ie)}s.targetAnchor||dD(J,s,Y,W),ne(ce&&T(ce),s,J,u,d,b,E)}n1(s,Q)}return s.anchor&&T(s.anchor)}const ZB=hD;function n1(e,s){const u=e.ctx;if(u&&u.ut){let d,b;for(s?(d=e.el,b=e.anchor):(d=e.targetStart,b=e.targetAnchor);d&&d!==b;)d.nodeType===1&&d.setAttribute("data-v-owner",u.uid),d=d.nextSibling;u.ut()}}function dD(e,s,u,d){const b=s.targetStart=u(""),E=s.targetAnchor=u("");return b[cD]=E,e&&(d(b,e),d(E,e)),E}const Tg=Symbol("_leaveCb"),$0=Symbol("_enterCb");function fD(){const e={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return Ua(()=>{e.isMounted=!0}),ql(()=>{e.isUnmounting=!0}),e}const Ld=[Function,Array],pD={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Ld,onEnter:Ld,onAfterEnter:Ld,onEnterCancelled:Ld,onBeforeLeave:Ld,onLeave:Ld,onAfterLeave:Ld,onLeaveCancelled:Ld,onBeforeAppear:Ld,onAppear:Ld,onAfterAppear:Ld,onAppearCancelled:Ld},mD=e=>{const s=e.subTree;return s.component?mD(s.component):s},WB={name:"BaseTransition",props:pD,setup(e,{slots:s}){const u=jf(),d=fD();return()=>{const b=s.default&&rC(s.default(),!0);if(!b||!b.length)return;const E=gD(b),T=Gr(e),{mode:t}=T;if(d.isLeaving)return FS(E);const G=EI(E);if(!G)return FS(E);let W=Zx(G,T,d,u,ne=>W=ne);G.type!==Jc&&O_(G,W);let Y=u.subTree&&EI(u.subTree);if(Y&&Y.type!==Jc&&!M_(G,Y)&&mD(u).type!==Jc){let ne=Zx(Y,T,d,u);if(O_(Y,ne),t==="out-in"&&G.type!==Jc)return d.isLeaving=!0,ne.afterLeave=()=>{d.isLeaving=!1,u.job.flags&8||u.update(),delete ne.afterLeave,Y=void 0},FS(E);t==="in-out"&&G.type!==Jc?ne.delayLeave=(J,Q,ce)=>{const ie=_D(d,Y);ie[String(Y.key)]=Y,J[Tg]=()=>{Q(),J[Tg]=void 0,delete W.delayedLeave,Y=void 0},W.delayedLeave=()=>{ce(),delete W.delayedLeave,Y=void 0}}:Y=void 0}else Y&&(Y=void 0);return E}}};function gD(e){let s=e[0];if(e.length>1){for(const u of e)if(u.type!==Jc){s=u;break}}return s}const XB=WB;function _D(e,s){const{leavingVNodes:u}=e;let d=u.get(s.type);return d||(d=Object.create(null),u.set(s.type,d)),d}function Zx(e,s,u,d,b){const{appear:E,mode:T,persisted:t=!1,onBeforeEnter:G,onEnter:W,onAfterEnter:Y,onEnterCancelled:ne,onBeforeLeave:J,onLeave:Q,onAfterLeave:ce,onLeaveCancelled:ie,onBeforeAppear:pe,onAppear:be,onAfterAppear:Ie,onAppearCancelled:$e}=s,Le=String(e.key),Oe=_D(u,e),Ve=(He,nt)=>{He&&zf(He,d,9,nt)},Ue=(He,nt)=>{const rt=nt[1];Ve(He,nt),na(He)?He.every(ft=>ft.length<=1)&&rt():He.length<=1&&rt()},qe={mode:T,persisted:t,beforeEnter(He){let nt=G;if(!u.isMounted)if(E)nt=pe||G;else return;He[Tg]&&He[Tg](!0);const rt=Oe[Le];rt&&M_(e,rt)&&rt.el[Tg]&&rt.el[Tg](),Ve(nt,[He])},enter(He){let nt=W,rt=Y,ft=ne;if(!u.isMounted)if(E)nt=be||W,rt=Ie||Y,ft=$e||ne;else return;let $t=!1;const hn=He[$0]=gn=>{$t||($t=!0,gn?Ve(ft,[He]):Ve(rt,[He]),qe.delayedLeave&&qe.delayedLeave(),He[$0]=void 0)};nt?Ue(nt,[He,hn]):hn()},leave(He,nt){const rt=String(e.key);if(He[$0]&&He[$0](!0),u.isUnmounting)return nt();Ve(J,[He]);let ft=!1;const $t=He[Tg]=hn=>{ft||(ft=!0,nt(),hn?Ve(ie,[He]):Ve(ce,[He]),He[Tg]=void 0,Oe[rt]===e&&delete Oe[rt])};Oe[rt]=e,Q?Ue(Q,[He,$t]):$t()},clone(He){const nt=Zx(He,s,u,d,b);return b&&b(nt),nt}};return qe}function FS(e){if(V1(e))return e=Mm(e),e.children=null,e}function EI(e){if(!V1(e))return uD(e.type)&&e.children?gD(e.children):e;const{shapeFlag:s,children:u}=e;if(u){if(s&16)return u[0];if(s&32&&la(u.default))return u.default()}}function O_(e,s){e.shapeFlag&6&&e.component?(e.transition=s,O_(e.component.subTree,s)):e.shapeFlag&128?(e.ssContent.transition=s.clone(e.ssContent),e.ssFallback.transition=s.clone(e.ssFallback)):e.transition=s}function rC(e,s=!1,u){let d=[],b=0;for(let E=0;E<e.length;E++){let T=e[E];const t=u==null?T.key:String(u)+String(T.key!=null?T.key:E);T.type===sr?(T.patchFlag&128&&b++,d=d.concat(rC(T.children,s,t))):(s||T.type!==Jc)&&d.push(t!=null?Mm(T,{key:t}):T)}if(b>1)for(let E=0;E<d.length;E++)d[E].patchFlag=-2;return d}/*! #__NO_SIDE_EFFECTS__ */function mo(e,s){return la(e)?Gl({name:e.name},s,{setup:e}):e}function yD(e){e.ids=[e.ids[0]+e.ids[2]+++"-",0,0]}function _1(e,s,u,d,b=!1){if(na(e)){e.forEach((ce,ie)=>_1(ce,s&&(na(s)?s[ie]:s),u,d,b));return}if(ev(d)&&!b){d.shapeFlag&512&&d.type.__asyncResolved&&d.component.subTree.component&&_1(e,s,u,d.component.subTree);return}const E=d.shapeFlag&4?U1(d.component):d.el,T=b?null:E,{i:t,r:G}=e,W=s&&s.r,Y=t.refs===$s?t.refs={}:t.refs,ne=t.setupState,J=Gr(ne),Q=ne===$s?()=>!1:ce=>Es(J,ce);if(W!=null&&W!==G&&(jo(W)?(Y[W]=null,Q(W)&&(ne[W]=null)):Mo(W)&&(W.value=null)),la(G))hb(G,t,12,[T,Y]);else{const ce=jo(G),ie=Mo(G);if(ce||ie){const pe=()=>{if(e.f){const be=ce?Q(G)?ne[G]:Y[G]:G.value;b?na(be)&&HT(be,E):na(be)?be.includes(E)||be.push(E):ce?(Y[G]=[E],Q(G)&&(ne[G]=Y[G])):(G.value=[E],e.k&&(Y[e.k]=G.value))}else ce?(Y[G]=T,Q(G)&&(ne[G]=T)):ie&&(G.value=T,e.k&&(Y[e.k]=T))};T?(pe.id=-1,Pu(pe,u)):pe()}}}O1().requestIdleCallback;O1().cancelIdleCallback;const ev=e=>!!e.type.__asyncLoader,V1=e=>e.type.__isKeepAlive;function vD(e,s){xD(e,"a",s)}function aC(e,s){xD(e,"da",s)}function xD(e,s,u=Pc){const d=e.__wdc||(e.__wdc=()=>{let b=u;for(;b;){if(b.isDeactivated)return;b=b.parent}return e()});if(N1(s,d,u),u){let b=u.parent;for(;b&&b.parent;)V1(b.parent.vnode)&&YB(d,s,u,b),b=b.parent}}function YB(e,s,u,d){const b=N1(s,e,d,!0);Tl(()=>{HT(d[s],b)},u)}function N1(e,s,u=Pc,d=!1){if(u){const b=u[e]||(u[e]=[]),E=s.__weh||(s.__weh=(...T)=>{Rg();const t=fb(u),G=zf(s,u,e,T);return t(),Lg(),G});return d?b.unshift(E):b.push(E),E}}const Rm=e=>(s,u=Pc)=>{(!Xx||e==="sp")&&N1(e,(...d)=>s(...d),u)},pv=Rm("bm"),Ua=Rm("m"),bD=Rm("bu"),sC=Rm("u"),ql=Rm("bum"),Tl=Rm("um"),KB=Rm("sp"),JB=Rm("rtg"),QB=Rm("rtc");function e5(e,s=Pc){N1("ec",e,s)}const oC="components",t5="directives";function Ul(e,s){return lC(oC,e,!0,s)||e}const n5=Symbol.for("v-ndc");function i5(e){return jo(e)&&lC(oC,e,!1)||e}function qh(e){return lC(t5,e)}function lC(e,s,u=!0,d=!1){const b=oc||Pc;if(b){const E=b.type;if(e===oC){const t=q5(E,!1);if(t&&(t===s||t===mh(s)||t===$p(mh(s))))return E}const T=MI(b[e]||E[e],s)||MI(b.appContext[e],s);return!T&&d?E:T}}function MI(e,s){return e&&(e[s]||e[mh(s)]||e[$p(mh(s))])}function r5(e,s,u,d){let b;const E=u,T=na(e);if(T||jo(e)){const t=T&&Jy(e);let G=!1;t&&(G=!Fd(e),e=F1(e)),b=new Array(e.length);for(let W=0,Y=e.length;W<Y;W++)b[W]=s(G?Yc(e[W]):e[W],W,void 0,E)}else if(typeof e=="number"){b=new Array(e);for(let t=0;t<e;t++)b[t]=s(t+1,t,void 0,E)}else if(Ks(e))if(e[Symbol.iterator])b=Array.from(e,(t,G)=>s(t,G,void 0,E));else{const t=Object.keys(e);b=new Array(t.length);for(let G=0,W=t.length;G<W;G++){const Y=t[G];b[G]=s(e[Y],Y,G,E)}}else b=[];return b}function Ac(e,s,u={},d,b){if(oc.ce||oc.parent&&ev(oc.parent)&&oc.parent.ce)return s!=="default"&&(u.name=s),ja(),Em(sr,null,[de("slot",u,d&&d())],64);let E=e[s];E&&E._c&&(E._d=!1),ja();const T=E&&wD(E(u)),t=u.key||T&&T.key,G=Em(sr,{key:(t&&!Dm(t)?t:`_${s}`)+(!T&&d?"_fb":"")},T||(d?d():[]),T&&e._===1?64:-2);return G.scopeId&&(G.slotScopeIds=[G.scopeId+"-s"]),E&&E._c&&(E._d=!0),G}function wD(e){return e.some(s=>nv(s)?!(s.type===Jc||s.type===sr&&!wD(s.children)):!0)?e:null}const W2=e=>e?UD(e)?U1(e):W2(e.parent):null,Vx=Gl(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>W2(e.parent),$root:e=>W2(e.root),$host:e=>e.ce,$emit:e=>e.emit,$options:e=>TD(e),$forceUpdate:e=>e.f||(e.f=()=>{iC(e.update)}),$nextTick:e=>e.n||(e.n=Na.bind(e.proxy)),$watch:e=>M5.bind(e)}),BS=(e,s)=>e!==$s&&!e.__isScriptSetup&&Es(e,s),a5={get({_:e},s){if(s==="__v_skip")return!0;const{ctx:u,setupState:d,data:b,props:E,accessCache:T,type:t,appContext:G}=e;let W;if(s[0]!=="$"){const Q=T[s];if(Q!==void 0)switch(Q){case 1:return d[s];case 2:return b[s];case 4:return u[s];case 3:return E[s]}else{if(BS(d,s))return T[s]=1,d[s];if(b!==$s&&Es(b,s))return T[s]=2,b[s];if((W=e.propsOptions[0])&&Es(W,s))return T[s]=3,E[s];if(u!==$s&&Es(u,s))return T[s]=4,u[s];X2&&(T[s]=0)}}const Y=Vx[s];let ne,J;if(Y)return s==="$attrs"&&Xc(e.attrs,"get",""),Y(e);if((ne=t.__cssModules)&&(ne=ne[s]))return ne;if(u!==$s&&Es(u,s))return T[s]=4,u[s];if(J=G.config.globalProperties,Es(J,s))return J[s]},set({_:e},s,u){const{data:d,setupState:b,ctx:E}=e;return BS(b,s)?(b[s]=u,!0):d!==$s&&Es(d,s)?(d[s]=u,!0):Es(e.props,s)||s[0]==="$"&&s.slice(1)in e?!1:(E[s]=u,!0)},has({_:{data:e,setupState:s,accessCache:u,ctx:d,appContext:b,propsOptions:E}},T){let t;return!!u[T]||e!==$s&&Es(e,T)||BS(s,T)||(t=E[0])&&Es(t,T)||Es(d,T)||Es(Vx,T)||Es(b.config.globalProperties,T)},defineProperty(e,s,u){return u.get!=null?e._.accessCache[s]=0:Es(u,"value")&&this.set(e,s,u.value,null),Reflect.defineProperty(e,s,u)}};function s5(){return o5().attrs}function o5(){const e=jf();return e.setupContext||(e.setupContext=GD(e))}function II(e){return na(e)?e.reduce((s,u)=>(s[u]=null,s),{}):e}let X2=!0;function l5(e){const s=TD(e),u=e.proxy,d=e.ctx;X2=!1,s.beforeCreate&&PI(s.beforeCreate,e,"bc");const{data:b,computed:E,methods:T,watch:t,provide:G,inject:W,created:Y,beforeMount:ne,mounted:J,beforeUpdate:Q,updated:ce,activated:ie,deactivated:pe,beforeDestroy:be,beforeUnmount:Ie,destroyed:$e,unmounted:Le,render:Oe,renderTracked:Ve,renderTriggered:Ue,errorCaptured:qe,serverPrefetch:He,expose:nt,inheritAttrs:rt,components:ft,directives:$t,filters:hn}=s;if(W&&c5(W,d,null),T)for(const ri in T){const ai=T[ri];la(ai)&&(d[ri]=ai.bind(u))}if(b){const ri=b.call(u,u);Ks(ri)&&(e.data=$l(ri))}if(X2=!0,E)for(const ri in E){const ai=E[ri],_n=la(ai)?ai.bind(u,u):la(ai.get)?ai.get.bind(u,u):Np,Bn=!la(ai)&&la(ai.set)?ai.set.bind(u):Np,mn=Fe({get:_n,set:Bn});Object.defineProperty(d,ri,{enumerable:!0,configurable:!0,get:()=>mn.value,set:Nn=>mn.value=Nn})}if(t)for(const ri in t)SD(t[ri],d,u,ri);if(G){const ri=la(G)?G.call(u):G;Reflect.ownKeys(ri).forEach(ai=>{xa(ai,ri[ai])})}Y&&PI(Y,e,"c");function pn(ri,ai){na(ai)?ai.forEach(_n=>ri(_n.bind(u))):ai&&ri(ai.bind(u))}if(pn(pv,ne),pn(Ua,J),pn(bD,Q),pn(sC,ce),pn(vD,ie),pn(aC,pe),pn(e5,qe),pn(QB,Ve),pn(JB,Ue),pn(ql,Ie),pn(Tl,Le),pn(KB,He),na(nt))if(nt.length){const ri=e.exposed||(e.exposed={});nt.forEach(ai=>{Object.defineProperty(ri,ai,{get:()=>u[ai],set:_n=>u[ai]=_n})})}else e.exposed||(e.exposed={});Oe&&e.render===Np&&(e.render=Oe),rt!=null&&(e.inheritAttrs=rt),ft&&(e.components=ft),$t&&(e.directives=$t),He&&yD(e)}function c5(e,s,u=Np){na(e)&&(e=Y2(e));for(const d in e){const b=e[d];let E;Ks(b)?"default"in b?E=vr(b.from||d,b.default,!0):E=vr(b.from||d):E=vr(b),Mo(E)?Object.defineProperty(s,d,{enumerable:!0,configurable:!0,get:()=>E.value,set:T=>E.value=T}):s[d]=E}}function PI(e,s,u){zf(na(e)?e.map(d=>d.bind(s.proxy)):e.bind(s.proxy),s,u)}function SD(e,s,u,d){let b=d.includes(".")?OD(u,d):()=>u[d];if(jo(e)){const E=s[e];la(E)&&Pi(b,E)}else if(la(e))Pi(b,e.bind(u));else if(Ks(e))if(na(e))e.forEach(E=>SD(E,s,u,d));else{const E=la(e.handler)?e.handler.bind(u):s[e.handler];la(E)&&Pi(b,E,e)}}function TD(e){const s=e.type,{mixins:u,extends:d}=s,{mixins:b,optionsCache:E,config:{optionMergeStrategies:T}}=e.appContext,t=E.get(s);let G;return t?G=t:!b.length&&!u&&!d?G=s:(G={},b.length&&b.forEach(W=>y1(G,W,T,!0)),y1(G,s,T)),Ks(s)&&E.set(s,G),G}function y1(e,s,u,d=!1){const{mixins:b,extends:E}=s;E&&y1(e,E,u,!0),b&&b.forEach(T=>y1(e,T,u,!0));for(const T in s)if(!(d&&T==="expose")){const t=u5[T]||u&&u[T];e[T]=t?t(e[T],s[T]):s[T]}return e}const u5={data:AI,props:kI,emits:kI,methods:Ax,computed:Ax,beforeCreate:Iu,created:Iu,beforeMount:Iu,mounted:Iu,beforeUpdate:Iu,updated:Iu,beforeDestroy:Iu,beforeUnmount:Iu,destroyed:Iu,unmounted:Iu,activated:Iu,deactivated:Iu,errorCaptured:Iu,serverPrefetch:Iu,components:Ax,directives:Ax,watch:d5,provide:AI,inject:h5};function AI(e,s){return s?e?function(){return Gl(la(e)?e.call(this,this):e,la(s)?s.call(this,this):s)}:s:e}function h5(e,s){return Ax(Y2(e),Y2(s))}function Y2(e){if(na(e)){const s={};for(let u=0;u<e.length;u++)s[e[u]]=e[u];return s}return e}function Iu(e,s){return e?[...new Set([].concat(e,s))]:s}function Ax(e,s){return e?Gl(Object.create(null),e,s):s}function kI(e,s){return e?na(e)&&na(s)?[...new Set([...e,...s])]:Gl(Object.create(null),II(e),II(s??{})):s}function d5(e,s){if(!e)return s;if(!s)return e;const u=Gl(Object.create(null),e);for(const d in s)u[d]=Iu(e[d],s[d]);return u}function CD(){return{app:null,config:{isNativeTag:iB,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let f5=0;function p5(e,s){return function(d,b=null){la(d)||(d=Gl({},d)),b!=null&&!Ks(b)&&(b=null);const E=CD(),T=new WeakSet,t=[];let G=!1;const W=E.app={_uid:f5++,_component:d,_props:b,_container:null,_context:E,_instance:null,version:Z5,get config(){return E.config},set config(Y){},use(Y,...ne){return T.has(Y)||(Y&&la(Y.install)?(T.add(Y),Y.install(W,...ne)):la(Y)&&(T.add(Y),Y(W,...ne))),W},mixin(Y){return E.mixins.includes(Y)||E.mixins.push(Y),W},component(Y,ne){return ne?(E.components[Y]=ne,W):E.components[Y]},directive(Y,ne){return ne?(E.directives[Y]=ne,W):E.directives[Y]},mount(Y,ne,J){if(!G){const Q=W._ceVNode||de(d,b);return Q.appContext=E,J===!0?J="svg":J===!1&&(J=void 0),e(Q,Y,J),G=!0,W._container=Y,Y.__vue_app__=W,U1(Q.component)}},onUnmount(Y){t.push(Y)},unmount(){G&&(zf(t,W._instance,16),e(null,W._container),delete W._container.__vue_app__)},provide(Y,ne){return E.provides[Y]=ne,W},runWithContext(Y){const ne=tv;tv=W;try{return Y()}finally{tv=ne}}};return W}}let tv=null;function xa(e,s){if(Pc){let u=Pc.provides;const d=Pc.parent&&Pc.parent.provides;d===u&&(u=Pc.provides=Object.create(d)),u[e]=s}}function vr(e,s,u=!1){const d=Pc||oc;if(d||tv){const b=tv?tv._context.provides:d?d.parent==null?d.vnode.appContext&&d.vnode.appContext.provides:d.parent.provides:void 0;if(b&&e in b)return b[e];if(arguments.length>1)return u&&la(s)?s.call(d&&d.proxy):s}}const ED={},MD=()=>Object.create(ED),ID=e=>Object.getPrototypeOf(e)===ED;function m5(e,s,u,d=!1){const b={},E=MD();e.propsDefaults=Object.create(null),PD(e,s,b,E);for(const T in e.propsOptions[0])T in b||(b[T]=void 0);u?e.props=d?b:Qk(b):e.type.props?e.props=b:e.props=E,e.attrs=E}function g5(e,s,u,d){const{props:b,attrs:E,vnode:{patchFlag:T}}=e,t=Gr(b),[G]=e.propsOptions;let W=!1;if((d||T>0)&&!(T&16)){if(T&8){const Y=e.vnode.dynamicProps;for(let ne=0;ne<Y.length;ne++){let J=Y[ne];if(j1(e.emitsOptions,J))continue;const Q=s[J];if(G)if(Es(E,J))Q!==E[J]&&(E[J]=Q,W=!0);else{const ce=mh(J);b[ce]=K2(G,t,ce,Q,e,!1)}else Q!==E[J]&&(E[J]=Q,W=!0)}}}else{PD(e,s,b,E)&&(W=!0);let Y;for(const ne in t)(!s||!Es(s,ne)&&((Y=q_(ne))===ne||!Es(s,Y)))&&(G?u&&(u[ne]!==void 0||u[Y]!==void 0)&&(b[ne]=K2(G,t,ne,void 0,e,!0)):delete b[ne]);if(E!==t)for(const ne in E)(!s||!Es(s,ne))&&(delete E[ne],W=!0)}W&&Tm(e.attrs,"set","")}function PD(e,s,u,d){const[b,E]=e.propsOptions;let T=!1,t;if(s)for(let G in s){if(zx(G))continue;const W=s[G];let Y;b&&Es(b,Y=mh(G))?!E||!E.includes(Y)?u[Y]=W:(t||(t={}))[Y]=W:j1(e.emitsOptions,G)||(!(G in d)||W!==d[G])&&(d[G]=W,T=!0)}if(E){const G=Gr(u),W=t||$s;for(let Y=0;Y<E.length;Y++){const ne=E[Y];u[ne]=K2(b,G,ne,W[ne],e,!Es(W,ne))}}return T}function K2(e,s,u,d,b,E){const T=e[u];if(T!=null){const t=Es(T,"default");if(t&&d===void 0){const G=T.default;if(T.type!==Function&&!T.skipFactory&&la(G)){const{propsDefaults:W}=b;if(u in W)d=W[u];else{const Y=fb(b);d=W[u]=G.call(null,s),Y()}}else d=G;b.ce&&b.ce._setProp(u,d)}T[0]&&(E&&!t?d=!1:T[1]&&(d===""||d===q_(u))&&(d=!0))}return d}const _5=new WeakMap;function AD(e,s,u=!1){const d=u?_5:s.propsCache,b=d.get(e);if(b)return b;const E=e.props,T={},t=[];let G=!1;if(!la(e)){const Y=ne=>{G=!0;const[J,Q]=AD(ne,s,!0);Gl(T,J),Q&&t.push(...Q)};!u&&s.mixins.length&&s.mixins.forEach(Y),e.extends&&Y(e.extends),e.mixins&&e.mixins.forEach(Y)}if(!E&&!G)return Ks(e)&&d.set(e,Xy),Xy;if(na(E))for(let Y=0;Y<E.length;Y++){const ne=mh(E[Y]);DI(ne)&&(T[ne]=$s)}else if(E)for(const Y in E){const ne=mh(Y);if(DI(ne)){const J=E[Y],Q=T[ne]=na(J)||la(J)?{type:J}:Gl({},J),ce=Q.type;let ie=!1,pe=!0;if(na(ce))for(let be=0;be<ce.length;++be){const Ie=ce[be],$e=la(Ie)&&Ie.name;if($e==="Boolean"){ie=!0;break}else $e==="String"&&(pe=!1)}else ie=la(ce)&&ce.name==="Boolean";Q[0]=ie,Q[1]=pe,(ie||Es(Q,"default"))&&t.push(ne)}}const W=[T,t];return Ks(e)&&d.set(e,W),W}function DI(e){return e[0]!=="$"&&!zx(e)}const kD=e=>e[0]==="_"||e==="$stable",cC=e=>na(e)?e.map(Bp):[Bp(e)],y5=(e,s,u)=>{if(s._n)return s;const d=fh((...b)=>cC(s(...b)),u);return d._c=!1,d},DD=(e,s,u)=>{const d=e._ctx;for(const b in e){if(kD(b))continue;const E=e[b];if(la(E))s[b]=y5(b,E,d);else if(E!=null){const T=cC(E);s[b]=()=>T}}},RD=(e,s)=>{const u=cC(s);e.slots.default=()=>u},LD=(e,s,u)=>{for(const d in s)(u||d!=="_")&&(e[d]=s[d])},v5=(e,s,u)=>{const d=e.slots=MD();if(e.vnode.shapeFlag&32){const b=s._;b?(LD(d,s,u),u&&Lk(d,"_",b,!0)):DD(s,d)}else s&&RD(e,s)},x5=(e,s,u)=>{const{vnode:d,slots:b}=e;let E=!0,T=$s;if(d.shapeFlag&32){const t=s._;t?u&&t===1?E=!1:LD(b,s,u):(E=!s.$stable,DD(s,b)),T=s}else s&&(RD(e,s),T={default:1});if(E)for(const t in b)!kD(t)&&T[t]==null&&delete b[t]},Pu=L5;function b5(e){return w5(e)}function w5(e,s){const u=O1();u.__VUE__=!0;const{insert:d,remove:b,patchProp:E,createElement:T,createText:t,createComment:G,setText:W,setElementText:Y,parentNode:ne,nextSibling:J,setScopeId:Q=Np,insertStaticContent:ce}=e,ie=(St,mt,at,Tn=null,bn=null,Cn=null,zn=void 0,vi=null,ii=!!mt.dynamicChildren)=>{if(St===mt)return;St&&!M_(St,mt)&&(Tn=sn(St),Nn(St,bn,Cn,!0),St=null),mt.patchFlag===-2&&(ii=!1,mt.dynamicChildren=null);const{type:wi,ref:Ki,shapeFlag:Vi}=mt;switch(wi){case db:pe(St,mt,at,Tn);break;case Jc:be(St,mt,at,Tn);break;case i1:St==null&&Ie(mt,at,Tn,zn);break;case sr:ft(St,mt,at,Tn,bn,Cn,zn,vi,ii);break;default:Vi&1?Oe(St,mt,at,Tn,bn,Cn,zn,vi,ii):Vi&6?$t(St,mt,at,Tn,bn,Cn,zn,vi,ii):(Vi&64||Vi&128)&&wi.process(St,mt,at,Tn,bn,Cn,zn,vi,ii,ht)}Ki!=null&&bn&&_1(Ki,St&&St.ref,Cn,mt||St,!mt)},pe=(St,mt,at,Tn)=>{if(St==null)d(mt.el=t(mt.children),at,Tn);else{const bn=mt.el=St.el;mt.children!==St.children&&W(bn,mt.children)}},be=(St,mt,at,Tn)=>{St==null?d(mt.el=G(mt.children||""),at,Tn):mt.el=St.el},Ie=(St,mt,at,Tn)=>{[St.el,St.anchor]=ce(St.children,mt,at,Tn,St.el,St.anchor)},$e=({el:St,anchor:mt},at,Tn)=>{let bn;for(;St&&St!==mt;)bn=J(St),d(St,at,Tn),St=bn;d(mt,at,Tn)},Le=({el:St,anchor:mt})=>{let at;for(;St&&St!==mt;)at=J(St),b(St),St=at;b(mt)},Oe=(St,mt,at,Tn,bn,Cn,zn,vi,ii)=>{mt.type==="svg"?zn="svg":mt.type==="math"&&(zn="mathml"),St==null?Ve(mt,at,Tn,bn,Cn,zn,vi,ii):He(St,mt,bn,Cn,zn,vi,ii)},Ve=(St,mt,at,Tn,bn,Cn,zn,vi)=>{let ii,wi;const{props:Ki,shapeFlag:Vi,transition:ui,dirs:pr}=St;if(ii=St.el=T(St.type,Cn,Ki&&Ki.is,Ki),Vi&8?Y(ii,St.children):Vi&16&&qe(St.children,ii,null,Tn,bn,VS(St,Cn),zn,vi),pr&&b_(St,null,Tn,"created"),Ue(ii,St,St.scopeId,zn,Tn),Ki){for(const sa in Ki)sa!=="value"&&!zx(sa)&&E(ii,sa,null,Ki[sa],Cn,Tn);"value"in Ki&&E(ii,"value",null,Ki.value,Cn),(wi=Ki.onVnodeBeforeMount)&&zp(wi,Tn,St)}pr&&b_(St,null,Tn,"beforeMount");const Er=S5(bn,ui);Er&&ui.beforeEnter(ii),d(ii,mt,at),((wi=Ki&&Ki.onVnodeMounted)||Er||pr)&&Pu(()=>{wi&&zp(wi,Tn,St),Er&&ui.enter(ii),pr&&b_(St,null,Tn,"mounted")},bn)},Ue=(St,mt,at,Tn,bn)=>{if(at&&Q(St,at),Tn)for(let Cn=0;Cn<Tn.length;Cn++)Q(St,Tn[Cn]);if(bn){let Cn=bn.subTree;if(mt===Cn||BD(Cn.type)&&(Cn.ssContent===mt||Cn.ssFallback===mt)){const zn=bn.vnode;Ue(St,zn,zn.scopeId,zn.slotScopeIds,bn.parent)}}},qe=(St,mt,at,Tn,bn,Cn,zn,vi,ii=0)=>{for(let wi=ii;wi<St.length;wi++){const Ki=St[wi]=vi?Cg(St[wi]):Bp(St[wi]);ie(null,Ki,mt,at,Tn,bn,Cn,zn,vi)}},He=(St,mt,at,Tn,bn,Cn,zn)=>{const vi=mt.el=St.el;let{patchFlag:ii,dynamicChildren:wi,dirs:Ki}=mt;ii|=St.patchFlag&16;const Vi=St.props||$s,ui=mt.props||$s;let pr;if(at&&w_(at,!1),(pr=ui.onVnodeBeforeUpdate)&&zp(pr,at,mt,St),Ki&&b_(mt,St,at,"beforeUpdate"),at&&w_(at,!0),(Vi.innerHTML&&ui.innerHTML==null||Vi.textContent&&ui.textContent==null)&&Y(vi,""),wi?nt(St.dynamicChildren,wi,vi,at,Tn,VS(mt,bn),Cn):zn||ai(St,mt,vi,null,at,Tn,VS(mt,bn),Cn,!1),ii>0){if(ii&16)rt(vi,Vi,ui,at,bn);else if(ii&2&&Vi.class!==ui.class&&E(vi,"class",null,ui.class,bn),ii&4&&E(vi,"style",Vi.style,ui.style,bn),ii&8){const Er=mt.dynamicProps;for(let sa=0;sa<Er.length;sa++){const Ar=Er[sa],Ta=Vi[Ar],Qa=ui[Ar];(Qa!==Ta||Ar==="value")&&E(vi,Ar,Ta,Qa,bn,at)}}ii&1&&St.children!==mt.children&&Y(vi,mt.children)}else!zn&&wi==null&&rt(vi,Vi,ui,at,bn);((pr=ui.onVnodeUpdated)||Ki)&&Pu(()=>{pr&&zp(pr,at,mt,St),Ki&&b_(mt,St,at,"updated")},Tn)},nt=(St,mt,at,Tn,bn,Cn,zn)=>{for(let vi=0;vi<mt.length;vi++){const ii=St[vi],wi=mt[vi],Ki=ii.el&&(ii.type===sr||!M_(ii,wi)||ii.shapeFlag&70)?ne(ii.el):at;ie(ii,wi,Ki,null,Tn,bn,Cn,zn,!0)}},rt=(St,mt,at,Tn,bn)=>{if(mt!==at){if(mt!==$s)for(const Cn in mt)!zx(Cn)&&!(Cn in at)&&E(St,Cn,mt[Cn],null,bn,Tn);for(const Cn in at){if(zx(Cn))continue;const zn=at[Cn],vi=mt[Cn];zn!==vi&&Cn!=="value"&&E(St,Cn,vi,zn,bn,Tn)}"value"in at&&E(St,"value",mt.value,at.value,bn)}},ft=(St,mt,at,Tn,bn,Cn,zn,vi,ii)=>{const wi=mt.el=St?St.el:t(""),Ki=mt.anchor=St?St.anchor:t("");let{patchFlag:Vi,dynamicChildren:ui,slotScopeIds:pr}=mt;pr&&(vi=vi?vi.concat(pr):pr),St==null?(d(wi,at,Tn),d(Ki,at,Tn),qe(mt.children||[],at,Ki,bn,Cn,zn,vi,ii)):Vi>0&&Vi&64&&ui&&St.dynamicChildren?(nt(St.dynamicChildren,ui,at,bn,Cn,zn,vi),(mt.key!=null||bn&&mt===bn.subTree)&&uC(St,mt,!0)):ai(St,mt,at,Ki,bn,Cn,zn,vi,ii)},$t=(St,mt,at,Tn,bn,Cn,zn,vi,ii)=>{mt.slotScopeIds=vi,St==null?mt.shapeFlag&512?bn.ctx.activate(mt,at,Tn,zn,ii):hn(mt,at,Tn,bn,Cn,zn,ii):gn(St,mt,ii)},hn=(St,mt,at,Tn,bn,Cn,zn)=>{const vi=St.component=j5(St,Tn,bn);if(V1(St)&&(vi.ctx.renderer=ht),U5(vi,!1,zn),vi.asyncDep){if(bn&&bn.registerDep(vi,pn,zn),!St.el){const ii=vi.subTree=de(Jc);be(null,ii,mt,at)}}else pn(vi,St,mt,at,bn,Cn,zn)},gn=(St,mt,at)=>{const Tn=mt.component=St.component;if(D5(St,mt,at))if(Tn.asyncDep&&!Tn.asyncResolved){ri(Tn,mt,at);return}else Tn.next=mt,Tn.update();else mt.el=St.el,Tn.vnode=mt},pn=(St,mt,at,Tn,bn,Cn,zn)=>{const vi=()=>{if(St.isMounted){let{next:Vi,bu:ui,u:pr,parent:Er,vnode:sa}=St;{const As=zD(St);if(As){Vi&&(Vi.el=sa.el,ri(St,Vi,zn)),As.asyncDep.then(()=>{St.isUnmounted||vi()});return}}let Ar=Vi,Ta;w_(St,!1),Vi?(Vi.el=sa.el,ri(St,Vi,zn)):Vi=sa,ui&&t1(ui),(Ta=Vi.props&&Vi.props.onVnodeBeforeUpdate)&&zp(Ta,Er,Vi,sa),w_(St,!0);const Qa=LI(St),Os=St.subTree;St.subTree=Qa,ie(Os,Qa,ne(Os.el),sn(Os),St,bn,Cn),Vi.el=Qa.el,Ar===null&&R5(St,Qa.el),pr&&Pu(pr,bn),(Ta=Vi.props&&Vi.props.onVnodeUpdated)&&Pu(()=>zp(Ta,Er,Vi,sa),bn)}else{let Vi;const{el:ui,props:pr}=mt,{bm:Er,m:sa,parent:Ar,root:Ta,type:Qa}=St,Os=ev(mt);w_(St,!1),Er&&t1(Er),!Os&&(Vi=pr&&pr.onVnodeBeforeMount)&&zp(Vi,Ar,mt),w_(St,!0);{Ta.ce&&Ta.ce._injectChildStyle(Qa);const As=St.subTree=LI(St);ie(null,As,at,Tn,St,bn,Cn),mt.el=As.el}if(sa&&Pu(sa,bn),!Os&&(Vi=pr&&pr.onVnodeMounted)){const As=mt;Pu(()=>zp(Vi,Ar,As),bn)}(mt.shapeFlag&256||Ar&&ev(Ar.vnode)&&Ar.vnode.shapeFlag&256)&&St.a&&Pu(St.a,bn),St.isMounted=!0,mt=at=Tn=null}};St.scope.on();const ii=St.effect=new Vk(vi);St.scope.off();const wi=St.update=ii.run.bind(ii),Ki=St.job=ii.runIfDirty.bind(ii);Ki.i=St,Ki.id=St.uid,ii.scheduler=()=>iC(Ki),w_(St,!0),wi()},ri=(St,mt,at)=>{mt.component=St;const Tn=St.vnode.props;St.vnode=mt,St.next=null,g5(St,mt.props,Tn,at),x5(St,mt.children,at),Rg(),wI(St),Lg()},ai=(St,mt,at,Tn,bn,Cn,zn,vi,ii=!1)=>{const wi=St&&St.children,Ki=St?St.shapeFlag:0,Vi=mt.children,{patchFlag:ui,shapeFlag:pr}=mt;if(ui>0){if(ui&128){Bn(wi,Vi,at,Tn,bn,Cn,zn,vi,ii);return}else if(ui&256){_n(wi,Vi,at,Tn,bn,Cn,zn,vi,ii);return}}pr&8?(Ki&16&&Ln(wi,bn,Cn),Vi!==wi&&Y(at,Vi)):Ki&16?pr&16?Bn(wi,Vi,at,Tn,bn,Cn,zn,vi,ii):Ln(wi,bn,Cn,!0):(Ki&8&&Y(at,""),pr&16&&qe(Vi,at,Tn,bn,Cn,zn,vi,ii))},_n=(St,mt,at,Tn,bn,Cn,zn,vi,ii)=>{St=St||Xy,mt=mt||Xy;const wi=St.length,Ki=mt.length,Vi=Math.min(wi,Ki);let ui;for(ui=0;ui<Vi;ui++){const pr=mt[ui]=ii?Cg(mt[ui]):Bp(mt[ui]);ie(St[ui],pr,at,null,bn,Cn,zn,vi,ii)}wi>Ki?Ln(St,bn,Cn,!0,!1,Vi):qe(mt,at,Tn,bn,Cn,zn,vi,ii,Vi)},Bn=(St,mt,at,Tn,bn,Cn,zn,vi,ii)=>{let wi=0;const Ki=mt.length;let Vi=St.length-1,ui=Ki-1;for(;wi<=Vi&&wi<=ui;){const pr=St[wi],Er=mt[wi]=ii?Cg(mt[wi]):Bp(mt[wi]);if(M_(pr,Er))ie(pr,Er,at,null,bn,Cn,zn,vi,ii);else break;wi++}for(;wi<=Vi&&wi<=ui;){const pr=St[Vi],Er=mt[ui]=ii?Cg(mt[ui]):Bp(mt[ui]);if(M_(pr,Er))ie(pr,Er,at,null,bn,Cn,zn,vi,ii);else break;Vi--,ui--}if(wi>Vi){if(wi<=ui){const pr=ui+1,Er=pr<Ki?mt[pr].el:Tn;for(;wi<=ui;)ie(null,mt[wi]=ii?Cg(mt[wi]):Bp(mt[wi]),at,Er,bn,Cn,zn,vi,ii),wi++}}else if(wi>ui)for(;wi<=Vi;)Nn(St[wi],bn,Cn,!0),wi++;else{const pr=wi,Er=wi,sa=new Map;for(wi=Er;wi<=ui;wi++){const bt=mt[wi]=ii?Cg(mt[wi]):Bp(mt[wi]);bt.key!=null&&sa.set(bt.key,wi)}let Ar,Ta=0;const Qa=ui-Er+1;let Os=!1,As=0;const to=new Array(Qa);for(wi=0;wi<Qa;wi++)to[wi]=0;for(wi=pr;wi<=Vi;wi++){const bt=St[wi];if(Ta>=Qa){Nn(bt,bn,Cn,!0);continue}let Qe;if(bt.key!=null)Qe=sa.get(bt.key);else for(Ar=Er;Ar<=ui;Ar++)if(to[Ar-Er]===0&&M_(bt,mt[Ar])){Qe=Ar;break}Qe===void 0?Nn(bt,bn,Cn,!0):(to[Qe-Er]=wi+1,Qe>=As?As=Qe:Os=!0,ie(bt,mt[Qe],at,null,bn,Cn,zn,vi,ii),Ta++)}const ko=Os?T5(to):Xy;for(Ar=ko.length-1,wi=Qa-1;wi>=0;wi--){const bt=Er+wi,Qe=mt[bt],dt=bt+1<Ki?mt[bt+1].el:Tn;to[wi]===0?ie(null,Qe,at,dt,bn,Cn,zn,vi,ii):Os&&(Ar<0||wi!==ko[Ar]?mn(Qe,at,dt,2):Ar--)}}},mn=(St,mt,at,Tn,bn=null)=>{const{el:Cn,type:zn,transition:vi,children:ii,shapeFlag:wi}=St;if(wi&6){mn(St.component.subTree,mt,at,Tn);return}if(wi&128){St.suspense.move(mt,at,Tn);return}if(wi&64){zn.move(St,mt,at,ht);return}if(zn===sr){d(Cn,mt,at);for(let Vi=0;Vi<ii.length;Vi++)mn(ii[Vi],mt,at,Tn);d(St.anchor,mt,at);return}if(zn===i1){$e(St,mt,at);return}if(Tn!==2&&wi&1&&vi)if(Tn===0)vi.beforeEnter(Cn),d(Cn,mt,at),Pu(()=>vi.enter(Cn),bn);else{const{leave:Vi,delayLeave:ui,afterLeave:pr}=vi,Er=()=>d(Cn,mt,at),sa=()=>{Vi(Cn,()=>{Er(),pr&&pr()})};ui?ui(Cn,Er,sa):sa()}else d(Cn,mt,at)},Nn=(St,mt,at,Tn=!1,bn=!1)=>{const{type:Cn,props:zn,ref:vi,children:ii,dynamicChildren:wi,shapeFlag:Ki,patchFlag:Vi,dirs:ui,cacheIndex:pr}=St;if(Vi===-2&&(bn=!1),vi!=null&&_1(vi,null,at,St,!0),pr!=null&&(mt.renderCache[pr]=void 0),Ki&256){mt.ctx.deactivate(St);return}const Er=Ki&1&&ui,sa=!ev(St);let Ar;if(sa&&(Ar=zn&&zn.onVnodeBeforeUnmount)&&zp(Ar,mt,St),Ki&6)Fi(St.component,at,Tn);else{if(Ki&128){St.suspense.unmount(at,Tn);return}Er&&b_(St,null,mt,"beforeUnmount"),Ki&64?St.type.remove(St,mt,at,ht,Tn):wi&&!wi.hasOnce&&(Cn!==sr||Vi>0&&Vi&64)?Ln(wi,mt,at,!1,!0):(Cn===sr&&Vi&384||!bn&&Ki&16)&&Ln(ii,mt,at),Tn&&Pn(St)}(sa&&(Ar=zn&&zn.onVnodeUnmounted)||Er)&&Pu(()=>{Ar&&zp(Ar,mt,St),Er&&b_(St,null,mt,"unmounted")},at)},Pn=St=>{const{type:mt,el:at,anchor:Tn,transition:bn}=St;if(mt===sr){Ci(at,Tn);return}if(mt===i1){Le(St);return}const Cn=()=>{b(at),bn&&!bn.persisted&&bn.afterLeave&&bn.afterLeave()};if(St.shapeFlag&1&&bn&&!bn.persisted){const{leave:zn,delayLeave:vi}=bn,ii=()=>zn(at,Cn);vi?vi(St.el,Cn,ii):ii()}else Cn()},Ci=(St,mt)=>{let at;for(;St!==mt;)at=J(St),b(St),St=at;b(mt)},Fi=(St,mt,at)=>{const{bum:Tn,scope:bn,job:Cn,subTree:zn,um:vi,m:ii,a:wi}=St;RI(ii),RI(wi),Tn&&t1(Tn),bn.stop(),Cn&&(Cn.flags|=8,Nn(zn,St,mt,at)),vi&&Pu(vi,mt),Pu(()=>{St.isUnmounted=!0},mt),mt&&mt.pendingBranch&&!mt.isUnmounted&&St.asyncDep&&!St.asyncResolved&&St.suspenseId===mt.pendingId&&(mt.deps--,mt.deps===0&&mt.resolve())},Ln=(St,mt,at,Tn=!1,bn=!1,Cn=0)=>{for(let zn=Cn;zn<St.length;zn++)Nn(St[zn],mt,at,Tn,bn)},sn=St=>{if(St.shapeFlag&6)return sn(St.component.subTree);if(St.shapeFlag&128)return St.suspense.next();const mt=J(St.anchor||St.el),at=mt&&mt[cD];return at?J(at):mt};let qn=!1;const pi=(St,mt,at)=>{St==null?mt._vnode&&Nn(mt._vnode,null,null,!0):ie(mt._vnode||null,St,mt,null,null,null,at),mt._vnode=St,qn||(qn=!0,wI(),sD(),qn=!1)},ht={p:ie,um:Nn,m:mn,r:Pn,mt:hn,mc:qe,pc:ai,pbc:nt,n:sn,o:e};return{render:pi,hydrate:void 0,createApp:p5(pi)}}function VS({type:e,props:s},u){return u==="svg"&&e==="foreignObject"||u==="mathml"&&e==="annotation-xml"&&s&&s.encoding&&s.encoding.includes("html")?void 0:u}function w_({effect:e,job:s},u){u?(e.flags|=32,s.flags|=4):(e.flags&=-33,s.flags&=-5)}function S5(e,s){return(!e||e&&!e.pendingBranch)&&s&&!s.persisted}function uC(e,s,u=!1){const d=e.children,b=s.children;if(na(d)&&na(b))for(let E=0;E<d.length;E++){const T=d[E];let t=b[E];t.shapeFlag&1&&!t.dynamicChildren&&((t.patchFlag<=0||t.patchFlag===32)&&(t=b[E]=Cg(b[E]),t.el=T.el),!u&&t.patchFlag!==-2&&uC(T,t)),t.type===db&&(t.el=T.el)}}function T5(e){const s=e.slice(),u=[0];let d,b,E,T,t;const G=e.length;for(d=0;d<G;d++){const W=e[d];if(W!==0){if(b=u[u.length-1],e[b]<W){s[d]=b,u.push(d);continue}for(E=0,T=u.length-1;E<T;)t=E+T>>1,e[u[t]]<W?E=t+1:T=t;W<e[u[E]]&&(E>0&&(s[d]=u[E-1]),u[E]=d)}}for(E=u.length,T=u[E-1];E-- >0;)u[E]=T,T=s[T];return u}function zD(e){const s=e.subTree.component;if(s)return s.asyncDep&&!s.asyncResolved?s:zD(s)}function RI(e){if(e)for(let s=0;s<e.length;s++)e[s].flags|=8}const C5=Symbol.for("v-scx"),E5=()=>vr(C5);function Jo(e,s){return hC(e,null,s)}function Pi(e,s,u){return hC(e,s,u)}function hC(e,s,u=$s){const{immediate:d,deep:b,flush:E,once:T}=u,t=Gl({},u),G=s&&d||!s&&E!=="post";let W;if(Xx){if(E==="sync"){const Q=E5();W=Q.__watcherHandles||(Q.__watcherHandles=[])}else if(!G){const Q=()=>{};return Q.stop=Np,Q.resume=Np,Q.pause=Np,Q}}const Y=Pc;t.call=(Q,ce,ie)=>zf(Q,Y,ce,ie);let ne=!1;E==="post"?t.scheduler=Q=>{Pu(Q,Y&&Y.suspense)}:E!=="sync"&&(ne=!0,t.scheduler=(Q,ce)=>{ce?Q():iC(Q)}),t.augmentJob=Q=>{s&&(Q.flags|=4),ne&&(Q.flags|=2,Y&&(Q.id=Y.uid,Q.i=Y))};const J=UB(e,s,t);return Xx&&(W?W.push(J):G&&J()),J}function M5(e,s,u){const d=this.proxy,b=jo(e)?e.includes(".")?OD(d,e):()=>d[e]:e.bind(d,d);let E;la(s)?E=s:(E=s.handler,u=s);const T=fb(this),t=hC(b,E.bind(d),u);return T(),t}function OD(e,s){const u=s.split(".");return()=>{let d=e;for(let b=0;b<u.length&&d;b++)d=d[u[b]];return d}}const I5=(e,s)=>s==="modelValue"||s==="model-value"?e.modelModifiers:e[`${s}Modifiers`]||e[`${mh(s)}Modifiers`]||e[`${q_(s)}Modifiers`];function P5(e,s,...u){if(e.isUnmounted)return;const d=e.vnode.props||$s;let b=u;const E=s.startsWith("update:"),T=E&&I5(d,s.slice(7));T&&(T.trim&&(b=u.map(Y=>jo(Y)?Y.trim():Y)),T.number&&(b=u.map(U2)));let t,G=d[t=DS(s)]||d[t=DS(mh(s))];!G&&E&&(G=d[t=DS(q_(s))]),G&&zf(G,e,6,b);const W=d[t+"Once"];if(W){if(!e.emitted)e.emitted={};else if(e.emitted[t])return;e.emitted[t]=!0,zf(W,e,6,b)}}function FD(e,s,u=!1){const d=s.emitsCache,b=d.get(e);if(b!==void 0)return b;const E=e.emits;let T={},t=!1;if(!la(e)){const G=W=>{const Y=FD(W,s,!0);Y&&(t=!0,Gl(T,Y))};!u&&s.mixins.length&&s.mixins.forEach(G),e.extends&&G(e.extends),e.mixins&&e.mixins.forEach(G)}return!E&&!t?(Ks(e)&&d.set(e,null),null):(na(E)?E.forEach(G=>T[G]=null):Gl(T,E),Ks(e)&&d.set(e,T),T)}function j1(e,s){return!e||!R1(s)?!1:(s=s.slice(2).replace(/Once$/,""),Es(e,s[0].toLowerCase()+s.slice(1))||Es(e,q_(s))||Es(e,s))}function LI(e){const{type:s,vnode:u,proxy:d,withProxy:b,propsOptions:[E],slots:T,attrs:t,emit:G,render:W,renderCache:Y,props:ne,data:J,setupState:Q,ctx:ce,inheritAttrs:ie}=e,pe=g1(e);let be,Ie;try{if(u.shapeFlag&4){const Le=b||d,Oe=Le;be=Bp(W.call(Oe,Le,Y,ne,Q,J,ce)),Ie=t}else{const Le=s;be=Bp(Le.length>1?Le(ne,{attrs:t,slots:T,emit:G}):Le(ne,null)),Ie=s.props?t:A5(t)}}catch(Le){Nx.length=0,B1(Le,e,1),be=de(Jc)}let $e=be;if(Ie&&ie!==!1){const Le=Object.keys(Ie),{shapeFlag:Oe}=$e;Le.length&&Oe&7&&(E&&Le.some(qT)&&(Ie=k5(Ie,E)),$e=Mm($e,Ie,!1,!0))}return u.dirs&&($e=Mm($e,null,!1,!0),$e.dirs=$e.dirs?$e.dirs.concat(u.dirs):u.dirs),u.transition&&O_($e,u.transition),be=$e,g1(pe),be}const A5=e=>{let s;for(const u in e)(u==="class"||u==="style"||R1(u))&&((s||(s={}))[u]=e[u]);return s},k5=(e,s)=>{const u={};for(const d in e)(!qT(d)||!(d.slice(9)in s))&&(u[d]=e[d]);return u};function D5(e,s,u){const{props:d,children:b,component:E}=e,{props:T,children:t,patchFlag:G}=s,W=E.emitsOptions;if(s.dirs||s.transition)return!0;if(u&&G>=0){if(G&1024)return!0;if(G&16)return d?zI(d,T,W):!!T;if(G&8){const Y=s.dynamicProps;for(let ne=0;ne<Y.length;ne++){const J=Y[ne];if(T[J]!==d[J]&&!j1(W,J))return!0}}}else return(b||t)&&(!t||!t.$stable)?!0:d===T?!1:d?T?zI(d,T,W):!0:!!T;return!1}function zI(e,s,u){const d=Object.keys(s);if(d.length!==Object.keys(e).length)return!0;for(let b=0;b<d.length;b++){const E=d[b];if(s[E]!==e[E]&&!j1(u,E))return!0}return!1}function R5({vnode:e,parent:s},u){for(;s;){const d=s.subTree;if(d.suspense&&d.suspense.activeBranch===e&&(d.el=e.el),d===e)(e=s.vnode).el=u,s=s.parent;else break}}const BD=e=>e.__isSuspense;function L5(e,s){s&&s.pendingBranch?na(e)?s.effects.push(...e):s.effects.push(e):qB(e)}const sr=Symbol.for("v-fgt"),db=Symbol.for("v-txt"),Jc=Symbol.for("v-cmt"),i1=Symbol.for("v-stc"),Nx=[];let $h=null;function ja(e=!1){Nx.push($h=e?null:[])}function z5(){Nx.pop(),$h=Nx[Nx.length-1]||null}let Wx=1;function OI(e,s=!1){Wx+=e,e<0&&$h&&s&&($h.hasOnce=!0)}function VD(e){return e.dynamicChildren=Wx>0?$h||Xy:null,z5(),Wx>0&&$h&&$h.push(e),e}function Gs(e,s,u,d,b,E){return VD(Ys(e,s,u,d,b,E,!0))}function Em(e,s,u,d,b){return VD(de(e,s,u,d,b,!0))}function nv(e){return e?e.__v_isVNode===!0:!1}function M_(e,s){return e.type===s.type&&e.key===s.key}const ND=({key:e})=>e??null,r1=({ref:e,ref_key:s,ref_for:u})=>(typeof e=="number"&&(e=""+e),e!=null?jo(e)||Mo(e)||la(e)?{i:oc,r:e,k:s,f:!!u}:e:null);function Ys(e,s=null,u=null,d=0,b=null,E=e===sr?0:1,T=!1,t=!1){const G={__v_isVNode:!0,__v_skip:!0,type:e,props:s,key:s&&ND(s),ref:s&&r1(s),scopeId:lD,slotScopeIds:null,children:u,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:E,patchFlag:d,dynamicProps:b,dynamicChildren:null,appContext:null,ctx:oc};return t?(dC(G,u),E&128&&e.normalize(G)):u&&(G.shapeFlag|=jo(u)?8:16),Wx>0&&!T&&$h&&(G.patchFlag>0||E&6)&&G.patchFlag!==32&&$h.push(G),G}const de=O5;function O5(e,s=null,u=null,d=0,b=null,E=!1){if((!e||e===n5)&&(e=Jc),nv(e)){const t=Mm(e,s,!0);return u&&dC(t,u),Wx>0&&!E&&$h&&(t.shapeFlag&6?$h[$h.indexOf(e)]=t:$h.push(t)),t.patchFlag=-2,t}if(H5(e)&&(e=e.__vccOpts),s){s=F5(s);let{class:t,style:G}=s;t&&!jo(t)&&(s.class=WT(t)),Ks(G)&&(nC(G)&&!na(G)&&(G=Gl({},G)),s.style=Ky(G))}const T=jo(e)?1:BD(e)?128:uD(e)?64:Ks(e)?4:la(e)?2:0;return Ys(e,s,u,d,b,T,E,!0)}function F5(e){return e?nC(e)||ID(e)?Gl({},e):e:null}function Mm(e,s,u=!1,d=!1){const{props:b,ref:E,patchFlag:T,children:t,transition:G}=e,W=s?oi(b||{},s):b,Y={__v_isVNode:!0,__v_skip:!0,type:e.type,props:W,key:W&&ND(W),ref:s&&s.ref?u&&E?na(E)?E.concat(r1(s)):[E,r1(s)]:r1(s):E,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:t,target:e.target,targetStart:e.targetStart,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:s&&e.type!==sr?T===-1?16:T|16:T,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:G,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&Mm(e.ssContent),ssFallback:e.ssFallback&&Mm(e.ssFallback),el:e.el,anchor:e.anchor,ctx:e.ctx,ce:e.ce};return G&&d&&O_(Y,G.clone(Y)),Y}function Kc(e=" ",s=0){return de(db,null,e,s)}function jD(e,s){const u=de(i1,null,e);return u.staticCount=s,u}function B5(e="",s=!1){return s?(ja(),Em(Jc,null,e)):de(Jc,null,e)}function Bp(e){return e==null||typeof e=="boolean"?de(Jc):na(e)?de(sr,null,e.slice()):nv(e)?Cg(e):de(db,null,String(e))}function Cg(e){return e.el===null&&e.patchFlag!==-1||e.memo?e:Mm(e)}function dC(e,s){let u=0;const{shapeFlag:d}=e;if(s==null)s=null;else if(na(s))u=16;else if(typeof s=="object")if(d&65){const b=s.default;b&&(b._c&&(b._d=!1),dC(e,b()),b._c&&(b._d=!0));return}else{u=32;const b=s._;!b&&!ID(s)?s._ctx=oc:b===3&&oc&&(oc.slots._===1?s._=1:(s._=2,e.patchFlag|=1024))}else la(s)?(s={default:s,_ctx:oc},u=32):(s=String(s),d&64?(u=16,s=[Kc(s)]):u=8);e.children=s,e.shapeFlag|=u}function oi(...e){const s={};for(let u=0;u<e.length;u++){const d=e[u];for(const b in d)if(b==="class")s.class!==d.class&&(s.class=WT([s.class,d.class]));else if(b==="style")s.style=Ky([s.style,d.style]);else if(R1(b)){const E=s[b],T=d[b];T&&E!==T&&!(na(E)&&E.includes(T))&&(s[b]=E?[].concat(E,T):T)}else b!==""&&(s[b]=d[b])}return s}function zp(e,s,u,d=null){zf(e,s,7,[u,d])}const V5=CD();let N5=0;function j5(e,s,u){const d=e.type,b=(s?s.appContext:e.appContext)||V5,E={uid:N5++,vnode:e,type:d,parent:s,appContext:b,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new Bk(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:s?s.provides:Object.create(b.provides),ids:s?s.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:AD(d,b),emitsOptions:FD(d,b),emit:null,emitted:null,propsDefaults:$s,inheritAttrs:d.inheritAttrs,ctx:$s,data:$s,props:$s,attrs:$s,slots:$s,refs:$s,setupState:$s,setupContext:null,suspense:u,suspenseId:u?u.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return E.ctx={_:E},E.root=s?s.root:E,E.emit=P5.bind(null,E),e.ce&&e.ce(E),E}let Pc=null;const jf=()=>Pc||oc;let v1,J2;{const e=O1(),s=(u,d)=>{let b;return(b=e[u])||(b=e[u]=[]),b.push(d),E=>{b.length>1?b.forEach(T=>T(E)):b[0](E)}};v1=s("__VUE_INSTANCE_SETTERS__",u=>Pc=u),J2=s("__VUE_SSR_SETTERS__",u=>Xx=u)}const fb=e=>{const s=Pc;return v1(e),e.scope.on(),()=>{e.scope.off(),v1(s)}},FI=()=>{Pc&&Pc.scope.off(),v1(null)};function UD(e){return e.vnode.shapeFlag&4}let Xx=!1;function U5(e,s=!1,u=!1){s&&J2(s);const{props:d,children:b}=e.vnode,E=UD(e);m5(e,d,E,s),v5(e,b,u);const T=E?$5(e,s):void 0;return s&&J2(!1),T}function $5(e,s){const u=e.type;e.accessCache=Object.create(null),e.proxy=new Proxy(e.ctx,a5);const{setup:d}=u;if(d){Rg();const b=e.setupContext=d.length>1?GD(e):null,E=fb(e),T=hb(d,e,0,[e.props,b]),t=kk(T);if(Lg(),E(),(t||e.sp)&&!ev(e)&&yD(e),t){if(T.then(FI,FI),s)return T.then(G=>{BI(e,G)}).catch(G=>{B1(G,e,0)});e.asyncDep=T}else BI(e,T)}else $D(e)}function BI(e,s,u){la(s)?e.type.__ssrInlineRender?e.ssrRender=s:e.render=s:Ks(s)&&(e.setupState=nD(s)),$D(e)}function $D(e,s,u){const d=e.type;e.render||(e.render=d.render||Np);{const b=fb(e);Rg();try{l5(e)}finally{Lg(),b()}}}const G5={get(e,s){return Xc(e,"get",""),e[s]}};function GD(e){const s=u=>{e.exposed=u||{}};return{attrs:new Proxy(e.attrs,G5),slots:e.slots,emit:e.emit,expose:s}}function U1(e){return e.exposed?e.exposeProxy||(e.exposeProxy=new Proxy(nD(eD(e.exposed)),{get(s,u){if(u in s)return s[u];if(u in Vx)return Vx[u](e)},has(s,u){return u in s||u in Vx}})):e.proxy}function q5(e,s=!0){return la(e)?e.displayName||e.name:e.name||s&&e.__name}function H5(e){return la(e)&&"__vccOpts"in e}const Fe=(e,s)=>NB(e,s,Xx);function Uf(e,s,u){const d=arguments.length;return d===2?Ks(s)&&!na(s)?nv(s)?de(e,null,[s]):de(e,s):de(e,null,s):(d>3?u=Array.prototype.slice.call(arguments,2):d===3&&nv(u)&&(u=[u]),de(e,s,u))}const Z5="3.5.13";/**
* @vue/runtime-dom v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Q2;const VI=typeof window<"u"&&window.trustedTypes;if(VI)try{Q2=VI.createPolicy("vue",{createHTML:e=>e})}catch{}const qD=Q2?e=>Q2.createHTML(e):e=>e,W5="http://www.w3.org/2000/svg",X5="http://www.w3.org/1998/Math/MathML",Sm=typeof document<"u"?document:null,NI=Sm&&Sm.createElement("template"),Y5={insert:(e,s,u)=>{s.insertBefore(e,u||null)},remove:e=>{const s=e.parentNode;s&&s.removeChild(e)},createElement:(e,s,u,d)=>{const b=s==="svg"?Sm.createElementNS(W5,e):s==="mathml"?Sm.createElementNS(X5,e):u?Sm.createElement(e,{is:u}):Sm.createElement(e);return e==="select"&&d&&d.multiple!=null&&b.setAttribute("multiple",d.multiple),b},createText:e=>Sm.createTextNode(e),createComment:e=>Sm.createComment(e),setText:(e,s)=>{e.nodeValue=s},setElementText:(e,s)=>{e.textContent=s},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>Sm.querySelector(e),setScopeId(e,s){e.setAttribute(s,"")},insertStaticContent(e,s,u,d,b,E){const T=u?u.previousSibling:s.lastChild;if(b&&(b===E||b.nextSibling))for(;s.insertBefore(b.cloneNode(!0),u),!(b===E||!(b=b.nextSibling)););else{NI.innerHTML=qD(d==="svg"?`<svg>${e}</svg>`:d==="mathml"?`<math>${e}</math>`:e);const t=NI.content;if(d==="svg"||d==="mathml"){const G=t.firstChild;for(;G.firstChild;)t.appendChild(G.firstChild);t.removeChild(G)}s.insertBefore(t,u)}return[T?T.nextSibling:s.firstChild,u?u.previousSibling:s.lastChild]}},xg="transition",bx="animation",iv=Symbol("_vtc"),HD={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},ZD=Gl({},pD,HD),K5=e=>(e.displayName="Transition",e.props=ZD,e),kg=K5((e,{slots:s})=>Uf(XB,WD(e),s)),S_=(e,s=[])=>{na(e)?e.forEach(u=>u(...s)):e&&e(...s)},jI=e=>e?na(e)?e.some(s=>s.length>1):e.length>1:!1;function WD(e){const s={};for(const ft in e)ft in HD||(s[ft]=e[ft]);if(e.css===!1)return s;const{name:u="v",type:d,duration:b,enterFromClass:E=`${u}-enter-from`,enterActiveClass:T=`${u}-enter-active`,enterToClass:t=`${u}-enter-to`,appearFromClass:G=E,appearActiveClass:W=T,appearToClass:Y=t,leaveFromClass:ne=`${u}-leave-from`,leaveActiveClass:J=`${u}-leave-active`,leaveToClass:Q=`${u}-leave-to`}=e,ce=J5(b),ie=ce&&ce[0],pe=ce&&ce[1],{onBeforeEnter:be,onEnter:Ie,onEnterCancelled:$e,onLeave:Le,onLeaveCancelled:Oe,onBeforeAppear:Ve=be,onAppear:Ue=Ie,onAppearCancelled:qe=$e}=s,He=(ft,$t,hn,gn)=>{ft._enterCancelled=gn,wg(ft,$t?Y:t),wg(ft,$t?W:T),hn&&hn()},nt=(ft,$t)=>{ft._isLeaving=!1,wg(ft,ne),wg(ft,Q),wg(ft,J),$t&&$t()},rt=ft=>($t,hn)=>{const gn=ft?Ue:Ie,pn=()=>He($t,ft,hn);S_(gn,[$t,pn]),UI(()=>{wg($t,ft?G:E),Op($t,ft?Y:t),jI(gn)||$I($t,d,ie,pn)})};return Gl(s,{onBeforeEnter(ft){S_(be,[ft]),Op(ft,E),Op(ft,T)},onBeforeAppear(ft){S_(Ve,[ft]),Op(ft,G),Op(ft,W)},onEnter:rt(!1),onAppear:rt(!0),onLeave(ft,$t){ft._isLeaving=!0;const hn=()=>nt(ft,$t);Op(ft,ne),ft._enterCancelled?(Op(ft,J),eT()):(eT(),Op(ft,J)),UI(()=>{ft._isLeaving&&(wg(ft,ne),Op(ft,Q),jI(Le)||$I(ft,d,pe,hn))}),S_(Le,[ft,hn])},onEnterCancelled(ft){He(ft,!1,void 0,!0),S_($e,[ft])},onAppearCancelled(ft){He(ft,!0,void 0,!0),S_(qe,[ft])},onLeaveCancelled(ft){nt(ft),S_(Oe,[ft])}})}function J5(e){if(e==null)return null;if(Ks(e))return[NS(e.enter),NS(e.leave)];{const s=NS(e);return[s,s]}}function NS(e){return lB(e)}function Op(e,s){s.split(/\s+/).forEach(u=>u&&e.classList.add(u)),(e[iv]||(e[iv]=new Set)).add(s)}function wg(e,s){s.split(/\s+/).forEach(d=>d&&e.classList.remove(d));const u=e[iv];u&&(u.delete(s),u.size||(e[iv]=void 0))}function UI(e){requestAnimationFrame(()=>{requestAnimationFrame(e)})}let Q5=0;function $I(e,s,u,d){const b=e._endId=++Q5,E=()=>{b===e._endId&&d()};if(u!=null)return setTimeout(E,u);const{type:T,timeout:t,propCount:G}=XD(e,s);if(!T)return d();const W=T+"end";let Y=0;const ne=()=>{e.removeEventListener(W,J),E()},J=Q=>{Q.target===e&&++Y>=G&&ne()};setTimeout(()=>{Y<G&&ne()},t+1),e.addEventListener(W,J)}function XD(e,s){const u=window.getComputedStyle(e),d=ce=>(u[ce]||"").split(", "),b=d(`${xg}Delay`),E=d(`${xg}Duration`),T=GI(b,E),t=d(`${bx}Delay`),G=d(`${bx}Duration`),W=GI(t,G);let Y=null,ne=0,J=0;s===xg?T>0&&(Y=xg,ne=T,J=E.length):s===bx?W>0&&(Y=bx,ne=W,J=G.length):(ne=Math.max(T,W),Y=ne>0?T>W?xg:bx:null,J=Y?Y===xg?E.length:G.length:0);const Q=Y===xg&&/\b(transform|all)(,|$)/.test(d(`${xg}Property`).toString());return{type:Y,timeout:ne,propCount:J,hasTransform:Q}}function GI(e,s){for(;e.length<s.length;)e=e.concat(e);return Math.max(...s.map((u,d)=>qI(u)+qI(e[d])))}function qI(e){return e==="auto"?0:Number(e.slice(0,-1).replace(",","."))*1e3}function eT(){return document.body.offsetHeight}function e4(e,s,u){const d=e[iv];d&&(s=(s?[s,...d]:[...d]).join(" ")),s==null?e.removeAttribute("class"):u?e.setAttribute("class",s):e.className=s}const x1=Symbol("_vod"),YD=Symbol("_vsh"),Nd={beforeMount(e,{value:s},{transition:u}){e[x1]=e.style.display==="none"?"":e.style.display,u&&s?u.beforeEnter(e):wx(e,s)},mounted(e,{value:s},{transition:u}){u&&s&&u.enter(e)},updated(e,{value:s,oldValue:u},{transition:d}){!s!=!u&&(d?s?(d.beforeEnter(e),wx(e,!0),d.enter(e)):d.leave(e,()=>{wx(e,!1)}):wx(e,s))},beforeUnmount(e,{value:s}){wx(e,s)}};function wx(e,s){e.style.display=s?e[x1]:"none",e[YD]=!s}const t4=Symbol(""),n4=/(^|;)\s*display\s*:/;function i4(e,s,u){const d=e.style,b=jo(u);let E=!1;if(u&&!b){if(s)if(jo(s))for(const T of s.split(";")){const t=T.slice(0,T.indexOf(":")).trim();u[t]==null&&a1(d,t,"")}else for(const T in s)u[T]==null&&a1(d,T,"");for(const T in u)T==="display"&&(E=!0),a1(d,T,u[T])}else if(b){if(s!==u){const T=d[t4];T&&(u+=";"+T),d.cssText=u,E=n4.test(u)}}else s&&e.removeAttribute("style");x1 in e&&(e[x1]=E?d.display:"",e[YD]&&(d.display="none"))}const HI=/\s*!important$/;function a1(e,s,u){if(na(u))u.forEach(d=>a1(e,s,d));else if(u==null&&(u=""),s.startsWith("--"))e.setProperty(s,u);else{const d=r4(e,s);HI.test(u)?e.setProperty(q_(d),u.replace(HI,""),"important"):e[d]=u}}const ZI=["Webkit","Moz","ms"],jS={};function r4(e,s){const u=jS[s];if(u)return u;let d=mh(s);if(d!=="filter"&&d in e)return jS[s]=d;d=$p(d);for(let b=0;b<ZI.length;b++){const E=ZI[b]+d;if(E in e)return jS[s]=E}return s}const WI="http://www.w3.org/1999/xlink";function XI(e,s,u,d,b,E=pB(s)){d&&s.startsWith("xlink:")?u==null?e.removeAttributeNS(WI,s.slice(6,s.length)):e.setAttributeNS(WI,s,u):u==null||E&&!zk(u)?e.removeAttribute(s):e.setAttribute(s,E?"":Dm(u)?String(u):u)}function YI(e,s,u,d,b){if(s==="innerHTML"||s==="textContent"){u!=null&&(e[s]=s==="innerHTML"?qD(u):u);return}const E=e.tagName;if(s==="value"&&E!=="PROGRESS"&&!E.includes("-")){const t=E==="OPTION"?e.getAttribute("value")||"":e.value,G=u==null?e.type==="checkbox"?"on":"":String(u);(t!==G||!("_value"in e))&&(e.value=G),u==null&&e.removeAttribute(s),e._value=u;return}let T=!1;if(u===""||u==null){const t=typeof e[s];t==="boolean"?u=zk(u):u==null&&t==="string"?(u="",T=!0):t==="number"&&(u=0,T=!0)}try{e[s]=u}catch{}T&&e.removeAttribute(b||s)}function qy(e,s,u,d){e.addEventListener(s,u,d)}function a4(e,s,u,d){e.removeEventListener(s,u,d)}const KI=Symbol("_vei");function s4(e,s,u,d,b=null){const E=e[KI]||(e[KI]={}),T=E[s];if(d&&T)T.value=d;else{const[t,G]=o4(s);if(d){const W=E[s]=u4(d,b);qy(e,t,W,G)}else T&&(a4(e,t,T,G),E[s]=void 0)}}const JI=/(?:Once|Passive|Capture)$/;function o4(e){let s;if(JI.test(e)){s={};let d;for(;d=e.match(JI);)e=e.slice(0,e.length-d[0].length),s[d[0].toLowerCase()]=!0}return[e[2]===":"?e.slice(3):q_(e.slice(2)),s]}let US=0;const l4=Promise.resolve(),c4=()=>US||(l4.then(()=>US=0),US=Date.now());function u4(e,s){const u=d=>{if(!d._vts)d._vts=Date.now();else if(d._vts<=u.attached)return;zf(h4(d,u.value),s,5,[d])};return u.value=e,u.attached=c4(),u}function h4(e,s){if(na(s)){const u=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{u.call(e),e._stopped=!0},s.map(d=>b=>!b._stopped&&d&&d(b))}else return s}const QI=e=>e.charCodeAt(0)===111&&e.charCodeAt(1)===110&&e.charCodeAt(2)>96&&e.charCodeAt(2)<123,d4=(e,s,u,d,b,E)=>{const T=b==="svg";s==="class"?e4(e,d,T):s==="style"?i4(e,u,d):R1(s)?qT(s)||s4(e,s,u,d,E):(s[0]==="."?(s=s.slice(1),!0):s[0]==="^"?(s=s.slice(1),!1):f4(e,s,d,T))?(YI(e,s,d),!e.tagName.includes("-")&&(s==="value"||s==="checked"||s==="selected")&&XI(e,s,d,T,E,s!=="value")):e._isVueCE&&(/[A-Z]/.test(s)||!jo(d))?YI(e,mh(s),d,E,s):(s==="true-value"?e._trueValue=d:s==="false-value"&&(e._falseValue=d),XI(e,s,d,T))};function f4(e,s,u,d){if(d)return!!(s==="innerHTML"||s==="textContent"||s in e&&QI(s)&&la(u));if(s==="spellcheck"||s==="draggable"||s==="translate"||s==="form"||s==="list"&&e.tagName==="INPUT"||s==="type"&&e.tagName==="TEXTAREA")return!1;if(s==="width"||s==="height"){const b=e.tagName;if(b==="IMG"||b==="VIDEO"||b==="CANVAS"||b==="SOURCE")return!1}return QI(s)&&jo(u)?!1:s in e}const KD=new WeakMap,JD=new WeakMap,b1=Symbol("_moveCb"),eP=Symbol("_enterCb"),p4=e=>(delete e.props.mode,e),m4=p4({name:"TransitionGroup",props:Gl({},ZD,{tag:String,moveClass:String}),setup(e,{slots:s}){const u=jf(),d=fD();let b,E;return sC(()=>{if(!b.length)return;const T=e.moveClass||`${e.name||"v"}-move`;if(!v4(b[0].el,u.vnode.el,T))return;b.forEach(g4),b.forEach(_4);const t=b.filter(y4);eT(),t.forEach(G=>{const W=G.el,Y=W.style;Op(W,T),Y.transform=Y.webkitTransform=Y.transitionDuration="";const ne=W[b1]=J=>{J&&J.target!==W||(!J||/transform$/.test(J.propertyName))&&(W.removeEventListener("transitionend",ne),W[b1]=null,wg(W,T))};W.addEventListener("transitionend",ne)})}),()=>{const T=Gr(e),t=WD(T);let G=T.tag||sr;if(b=[],E)for(let W=0;W<E.length;W++){const Y=E[W];Y.el&&Y.el instanceof Element&&(b.push(Y),O_(Y,Zx(Y,t,d,u)),KD.set(Y,Y.el.getBoundingClientRect()))}E=s.default?rC(s.default()):[];for(let W=0;W<E.length;W++){const Y=E[W];Y.key!=null&&O_(Y,Zx(Y,t,d,u))}return de(G,null,E)}}}),fC=m4;function g4(e){const s=e.el;s[b1]&&s[b1](),s[eP]&&s[eP]()}function _4(e){JD.set(e,e.el.getBoundingClientRect())}function y4(e){const s=KD.get(e),u=JD.get(e),d=s.left-u.left,b=s.top-u.top;if(d||b){const E=e.el.style;return E.transform=E.webkitTransform=`translate(${d}px,${b}px)`,E.transitionDuration="0s",e}}function v4(e,s,u){const d=e.cloneNode(),b=e[iv];b&&b.forEach(t=>{t.split(/\s+/).forEach(G=>G&&d.classList.remove(G))}),u.split(/\s+/).forEach(t=>t&&d.classList.add(t)),d.style.display="none";const E=s.nodeType===1?s:s.parentNode;E.appendChild(d);const{hasTransform:T}=XD(d);return E.removeChild(d),T}const tP=e=>{const s=e.props["onUpdate:modelValue"]||!1;return na(s)?u=>t1(s,u):s};function x4(e){e.target.composing=!0}function nP(e){const s=e.target;s.composing&&(s.composing=!1,s.dispatchEvent(new Event("input")))}const $S=Symbol("_assign"),b4={created(e,{modifiers:{lazy:s,trim:u,number:d}},b){e[$S]=tP(b);const E=d||b.props&&b.props.type==="number";qy(e,s?"change":"input",T=>{if(T.target.composing)return;let t=e.value;u&&(t=t.trim()),E&&(t=U2(t)),e[$S](t)}),u&&qy(e,"change",()=>{e.value=e.value.trim()}),s||(qy(e,"compositionstart",x4),qy(e,"compositionend",nP),qy(e,"change",nP))},mounted(e,{value:s}){e.value=s??""},beforeUpdate(e,{value:s,oldValue:u,modifiers:{lazy:d,trim:b,number:E}},T){if(e[$S]=tP(T),e.composing)return;const t=(E||e.type==="number")&&!/^0\d/.test(e.value)?U2(e.value):e.value,G=s??"";t!==G&&(document.activeElement===e&&e.type!=="range"&&(d&&s===u||b&&e.value.trim()===G)||(e.value=G))}},w4=["ctrl","shift","alt","meta"],S4={stop:e=>e.stopPropagation(),prevent:e=>e.preventDefault(),self:e=>e.target!==e.currentTarget,ctrl:e=>!e.ctrlKey,shift:e=>!e.shiftKey,alt:e=>!e.altKey,meta:e=>!e.metaKey,left:e=>"button"in e&&e.button!==0,middle:e=>"button"in e&&e.button!==1,right:e=>"button"in e&&e.button!==2,exact:(e,s)=>w4.some(u=>e[`${u}Key`]&&!s.includes(u))},iP=(e,s)=>{const u=e._withMods||(e._withMods={}),d=s.join(".");return u[d]||(u[d]=(b,...E)=>{for(let T=0;T<s.length;T++){const t=S4[s[T]];if(t&&t(b,s))return}return e(b,...E)})},T4=Gl({patchProp:d4},Y5);let rP;function QD(){return rP||(rP=b5(T4))}const eR=(...e)=>{QD().render(...e)},C4=(...e)=>{const s=QD().createApp(...e),{mount:u}=s;return s.mount=d=>{const b=M4(d);if(!b)return;const E=s._component;!la(E)&&!E.render&&!E.template&&(E.template=b.innerHTML),b.nodeType===1&&(b.textContent="");const T=u(b,!1,E4(b));return b instanceof Element&&(b.removeAttribute("v-cloak"),b.setAttribute("data-v-app","")),T},s};function E4(e){if(e instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&e instanceof MathMLElement)return"mathml"}function M4(e){return jo(e)?document.querySelector(e):e}/*!
  * vue-router v4.5.0
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */const Hy=typeof document<"u";function tR(e){return typeof e=="object"||"displayName"in e||"props"in e||"__vccOpts"in e}function I4(e){return e.__esModule||e[Symbol.toStringTag]==="Module"||e.default&&tR(e.default)}const Cs=Object.assign;function GS(e,s){const u={};for(const d in s){const b=s[d];u[d]=Of(b)?b.map(e):e(b)}return u}const jx=()=>{},Of=Array.isArray,nR=/#/g,P4=/&/g,A4=/\//g,k4=/=/g,D4=/\?/g,iR=/\+/g,R4=/%5B/g,L4=/%5D/g,rR=/%5E/g,z4=/%60/g,aR=/%7B/g,O4=/%7C/g,sR=/%7D/g,F4=/%20/g;function pC(e){return encodeURI(""+e).replace(O4,"|").replace(R4,"[").replace(L4,"]")}function B4(e){return pC(e).replace(aR,"{").replace(sR,"}").replace(rR,"^")}function tT(e){return pC(e).replace(iR,"%2B").replace(F4,"+").replace(nR,"%23").replace(P4,"%26").replace(z4,"`").replace(aR,"{").replace(sR,"}").replace(rR,"^")}function V4(e){return tT(e).replace(k4,"%3D")}function N4(e){return pC(e).replace(nR,"%23").replace(D4,"%3F")}function j4(e){return e==null?"":N4(e).replace(A4,"%2F")}function Yx(e){try{return decodeURIComponent(""+e)}catch{}return""+e}const U4=/\/$/,$4=e=>e.replace(U4,"");function qS(e,s,u="/"){let d,b={},E="",T="";const t=s.indexOf("#");let G=s.indexOf("?");return t<G&&t>=0&&(G=-1),G>-1&&(d=s.slice(0,G),E=s.slice(G+1,t>-1?t:s.length),b=e(E)),t>-1&&(d=d||s.slice(0,t),T=s.slice(t,s.length)),d=Z4(d??s,u),{fullPath:d+(E&&"?")+E+T,path:d,query:b,hash:Yx(T)}}function G4(e,s){const u=s.query?e(s.query):"";return s.path+(u&&"?")+u+(s.hash||"")}function aP(e,s){return!s||!e.toLowerCase().startsWith(s.toLowerCase())?e:e.slice(s.length)||"/"}function q4(e,s,u){const d=s.matched.length-1,b=u.matched.length-1;return d>-1&&d===b&&rv(s.matched[d],u.matched[b])&&oR(s.params,u.params)&&e(s.query)===e(u.query)&&s.hash===u.hash}function rv(e,s){return(e.aliasOf||e)===(s.aliasOf||s)}function oR(e,s){if(Object.keys(e).length!==Object.keys(s).length)return!1;for(const u in e)if(!H4(e[u],s[u]))return!1;return!0}function H4(e,s){return Of(e)?sP(e,s):Of(s)?sP(s,e):e===s}function sP(e,s){return Of(s)?e.length===s.length&&e.every((u,d)=>u===s[d]):e.length===1&&e[0]===s}function Z4(e,s){if(e.startsWith("/"))return e;if(!e)return s;const u=s.split("/"),d=e.split("/"),b=d[d.length-1];(b===".."||b===".")&&d.push("");let E=u.length-1,T,t;for(T=0;T<d.length;T++)if(t=d[T],t!==".")if(t==="..")E>1&&E--;else break;return u.slice(0,E).join("/")+"/"+d.slice(T).join("/")}const bg={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var Kx;(function(e){e.pop="pop",e.push="push"})(Kx||(Kx={}));var Ux;(function(e){e.back="back",e.forward="forward",e.unknown=""})(Ux||(Ux={}));function W4(e){if(!e)if(Hy){const s=document.querySelector("base");e=s&&s.getAttribute("href")||"/",e=e.replace(/^\w+:\/\/[^\/]+/,"")}else e="/";return e[0]!=="/"&&e[0]!=="#"&&(e="/"+e),$4(e)}const X4=/^[^#]+#/;function Y4(e,s){return e.replace(X4,"#")+s}function K4(e,s){const u=document.documentElement.getBoundingClientRect(),d=e.getBoundingClientRect();return{behavior:s.behavior,left:d.left-u.left-(s.left||0),top:d.top-u.top-(s.top||0)}}const $1=()=>({left:window.scrollX,top:window.scrollY});function J4(e){let s;if("el"in e){const u=e.el,d=typeof u=="string"&&u.startsWith("#"),b=typeof u=="string"?d?document.getElementById(u.slice(1)):document.querySelector(u):u;if(!b)return;s=K4(b,e)}else s=e;"scrollBehavior"in document.documentElement.style?window.scrollTo(s):window.scrollTo(s.left!=null?s.left:window.scrollX,s.top!=null?s.top:window.scrollY)}function oP(e,s){return(history.state?history.state.position-s:-1)+e}const nT=new Map;function Q4(e,s){nT.set(e,s)}function eV(e){const s=nT.get(e);return nT.delete(e),s}let tV=()=>location.protocol+"//"+location.host;function lR(e,s){const{pathname:u,search:d,hash:b}=s,E=e.indexOf("#");if(E>-1){let t=b.includes(e.slice(E))?e.slice(E).length:1,G=b.slice(t);return G[0]!=="/"&&(G="/"+G),aP(G,"")}return aP(u,e)+d+b}function nV(e,s,u,d){let b=[],E=[],T=null;const t=({state:J})=>{const Q=lR(e,location),ce=u.value,ie=s.value;let pe=0;if(J){if(u.value=Q,s.value=J,T&&T===ce){T=null;return}pe=ie?J.position-ie.position:0}else d(Q);b.forEach(be=>{be(u.value,ce,{delta:pe,type:Kx.pop,direction:pe?pe>0?Ux.forward:Ux.back:Ux.unknown})})};function G(){T=u.value}function W(J){b.push(J);const Q=()=>{const ce=b.indexOf(J);ce>-1&&b.splice(ce,1)};return E.push(Q),Q}function Y(){const{history:J}=window;J.state&&J.replaceState(Cs({},J.state,{scroll:$1()}),"")}function ne(){for(const J of E)J();E=[],window.removeEventListener("popstate",t),window.removeEventListener("beforeunload",Y)}return window.addEventListener("popstate",t),window.addEventListener("beforeunload",Y,{passive:!0}),{pauseListeners:G,listen:W,destroy:ne}}function lP(e,s,u,d=!1,b=!1){return{back:e,current:s,forward:u,replaced:d,position:window.history.length,scroll:b?$1():null}}function iV(e){const{history:s,location:u}=window,d={value:lR(e,u)},b={value:s.state};b.value||E(d.value,{back:null,current:d.value,forward:null,position:s.length-1,replaced:!0,scroll:null},!0);function E(G,W,Y){const ne=e.indexOf("#"),J=ne>-1?(u.host&&document.querySelector("base")?e:e.slice(ne))+G:tV()+e+G;try{s[Y?"replaceState":"pushState"](W,"",J),b.value=W}catch(Q){console.error(Q),u[Y?"replace":"assign"](J)}}function T(G,W){const Y=Cs({},s.state,lP(b.value.back,G,b.value.forward,!0),W,{position:b.value.position});E(G,Y,!0),d.value=G}function t(G,W){const Y=Cs({},b.value,s.state,{forward:G,scroll:$1()});E(Y.current,Y,!0);const ne=Cs({},lP(d.value,G,null),{position:Y.position+1},W);E(G,ne,!1),d.value=G}return{location:d,state:b,push:t,replace:T}}function rV(e){e=W4(e);const s=iV(e),u=nV(e,s.state,s.location,s.replace);function d(E,T=!0){T||u.pauseListeners(),history.go(E)}const b=Cs({location:"",base:e,go:d,createHref:Y4.bind(null,e)},s,u);return Object.defineProperty(b,"location",{enumerable:!0,get:()=>s.location.value}),Object.defineProperty(b,"state",{enumerable:!0,get:()=>s.state.value}),b}function aV(e){return typeof e=="string"||e&&typeof e=="object"}function cR(e){return typeof e=="string"||typeof e=="symbol"}const uR=Symbol("");var cP;(function(e){e[e.aborted=4]="aborted",e[e.cancelled=8]="cancelled",e[e.duplicated=16]="duplicated"})(cP||(cP={}));function av(e,s){return Cs(new Error,{type:e,[uR]:!0},s)}function wm(e,s){return e instanceof Error&&uR in e&&(s==null||!!(e.type&s))}const uP="[^/]+?",sV={sensitive:!1,strict:!1,start:!0,end:!0},oV=/[.+*?^${}()[\]/\\]/g;function lV(e,s){const u=Cs({},sV,s),d=[];let b=u.start?"^":"";const E=[];for(const W of e){const Y=W.length?[]:[90];u.strict&&!W.length&&(b+="/");for(let ne=0;ne<W.length;ne++){const J=W[ne];let Q=40+(u.sensitive?.25:0);if(J.type===0)ne||(b+="/"),b+=J.value.replace(oV,"\\$&"),Q+=40;else if(J.type===1){const{value:ce,repeatable:ie,optional:pe,regexp:be}=J;E.push({name:ce,repeatable:ie,optional:pe});const Ie=be||uP;if(Ie!==uP){Q+=10;try{new RegExp(`(${Ie})`)}catch(Le){throw new Error(`Invalid custom RegExp for param "${ce}" (${Ie}): `+Le.message)}}let $e=ie?`((?:${Ie})(?:/(?:${Ie}))*)`:`(${Ie})`;ne||($e=pe&&W.length<2?`(?:/${$e})`:"/"+$e),pe&&($e+="?"),b+=$e,Q+=20,pe&&(Q+=-8),ie&&(Q+=-20),Ie===".*"&&(Q+=-50)}Y.push(Q)}d.push(Y)}if(u.strict&&u.end){const W=d.length-1;d[W][d[W].length-1]+=.7000000000000001}u.strict||(b+="/?"),u.end?b+="$":u.strict&&!b.endsWith("/")&&(b+="(?:/|$)");const T=new RegExp(b,u.sensitive?"":"i");function t(W){const Y=W.match(T),ne={};if(!Y)return null;for(let J=1;J<Y.length;J++){const Q=Y[J]||"",ce=E[J-1];ne[ce.name]=Q&&ce.repeatable?Q.split("/"):Q}return ne}function G(W){let Y="",ne=!1;for(const J of e){(!ne||!Y.endsWith("/"))&&(Y+="/"),ne=!1;for(const Q of J)if(Q.type===0)Y+=Q.value;else if(Q.type===1){const{value:ce,repeatable:ie,optional:pe}=Q,be=ce in W?W[ce]:"";if(Of(be)&&!ie)throw new Error(`Provided param "${ce}" is an array but it is not repeatable (* or + modifiers)`);const Ie=Of(be)?be.join("/"):be;if(!Ie)if(pe)J.length<2&&(Y.endsWith("/")?Y=Y.slice(0,-1):ne=!0);else throw new Error(`Missing required param "${ce}"`);Y+=Ie}}return Y||"/"}return{re:T,score:d,keys:E,parse:t,stringify:G}}function cV(e,s){let u=0;for(;u<e.length&&u<s.length;){const d=s[u]-e[u];if(d)return d;u++}return e.length<s.length?e.length===1&&e[0]===80?-1:1:e.length>s.length?s.length===1&&s[0]===80?1:-1:0}function hR(e,s){let u=0;const d=e.score,b=s.score;for(;u<d.length&&u<b.length;){const E=cV(d[u],b[u]);if(E)return E;u++}if(Math.abs(b.length-d.length)===1){if(hP(d))return 1;if(hP(b))return-1}return b.length-d.length}function hP(e){const s=e[e.length-1];return e.length>0&&s[s.length-1]<0}const uV={type:0,value:""},hV=/[a-zA-Z0-9_]/;function dV(e){if(!e)return[[]];if(e==="/")return[[uV]];if(!e.startsWith("/"))throw new Error(`Invalid path "${e}"`);function s(Q){throw new Error(`ERR (${u})/"${W}": ${Q}`)}let u=0,d=u;const b=[];let E;function T(){E&&b.push(E),E=[]}let t=0,G,W="",Y="";function ne(){W&&(u===0?E.push({type:0,value:W}):u===1||u===2||u===3?(E.length>1&&(G==="*"||G==="+")&&s(`A repeatable param (${W}) must be alone in its segment. eg: '/:ids+.`),E.push({type:1,value:W,regexp:Y,repeatable:G==="*"||G==="+",optional:G==="*"||G==="?"})):s("Invalid state to consume buffer"),W="")}function J(){W+=G}for(;t<e.length;){if(G=e[t++],G==="\\"&&u!==2){d=u,u=4;continue}switch(u){case 0:G==="/"?(W&&ne(),T()):G===":"?(ne(),u=1):J();break;case 4:J(),u=d;break;case 1:G==="("?u=2:hV.test(G)?J():(ne(),u=0,G!=="*"&&G!=="?"&&G!=="+"&&t--);break;case 2:G===")"?Y[Y.length-1]=="\\"?Y=Y.slice(0,-1)+G:u=3:Y+=G;break;case 3:ne(),u=0,G!=="*"&&G!=="?"&&G!=="+"&&t--,Y="";break;default:s("Unknown state");break}}return u===2&&s(`Unfinished custom RegExp for param "${W}"`),ne(),T(),b}function fV(e,s,u){const d=lV(dV(e.path),u),b=Cs(d,{record:e,parent:s,children:[],alias:[]});return s&&!b.record.aliasOf==!s.record.aliasOf&&s.children.push(b),b}function pV(e,s){const u=[],d=new Map;s=mP({strict:!1,end:!0,sensitive:!1},s);function b(ne){return d.get(ne)}function E(ne,J,Q){const ce=!Q,ie=fP(ne);ie.aliasOf=Q&&Q.record;const pe=mP(s,ne),be=[ie];if("alias"in ne){const Le=typeof ne.alias=="string"?[ne.alias]:ne.alias;for(const Oe of Le)be.push(fP(Cs({},ie,{components:Q?Q.record.components:ie.components,path:Oe,aliasOf:Q?Q.record:ie})))}let Ie,$e;for(const Le of be){const{path:Oe}=Le;if(J&&Oe[0]!=="/"){const Ve=J.record.path,Ue=Ve[Ve.length-1]==="/"?"":"/";Le.path=J.record.path+(Oe&&Ue+Oe)}if(Ie=fV(Le,J,pe),Q?Q.alias.push(Ie):($e=$e||Ie,$e!==Ie&&$e.alias.push(Ie),ce&&ne.name&&!pP(Ie)&&T(ne.name)),dR(Ie)&&G(Ie),ie.children){const Ve=ie.children;for(let Ue=0;Ue<Ve.length;Ue++)E(Ve[Ue],Ie,Q&&Q.children[Ue])}Q=Q||Ie}return $e?()=>{T($e)}:jx}function T(ne){if(cR(ne)){const J=d.get(ne);J&&(d.delete(ne),u.splice(u.indexOf(J),1),J.children.forEach(T),J.alias.forEach(T))}else{const J=u.indexOf(ne);J>-1&&(u.splice(J,1),ne.record.name&&d.delete(ne.record.name),ne.children.forEach(T),ne.alias.forEach(T))}}function t(){return u}function G(ne){const J=_V(ne,u);u.splice(J,0,ne),ne.record.name&&!pP(ne)&&d.set(ne.record.name,ne)}function W(ne,J){let Q,ce={},ie,pe;if("name"in ne&&ne.name){if(Q=d.get(ne.name),!Q)throw av(1,{location:ne});pe=Q.record.name,ce=Cs(dP(J.params,Q.keys.filter($e=>!$e.optional).concat(Q.parent?Q.parent.keys.filter($e=>$e.optional):[]).map($e=>$e.name)),ne.params&&dP(ne.params,Q.keys.map($e=>$e.name))),ie=Q.stringify(ce)}else if(ne.path!=null)ie=ne.path,Q=u.find($e=>$e.re.test(ie)),Q&&(ce=Q.parse(ie),pe=Q.record.name);else{if(Q=J.name?d.get(J.name):u.find($e=>$e.re.test(J.path)),!Q)throw av(1,{location:ne,currentLocation:J});pe=Q.record.name,ce=Cs({},J.params,ne.params),ie=Q.stringify(ce)}const be=[];let Ie=Q;for(;Ie;)be.unshift(Ie.record),Ie=Ie.parent;return{name:pe,path:ie,params:ce,matched:be,meta:gV(be)}}e.forEach(ne=>E(ne));function Y(){u.length=0,d.clear()}return{addRoute:E,resolve:W,removeRoute:T,clearRoutes:Y,getRoutes:t,getRecordMatcher:b}}function dP(e,s){const u={};for(const d of s)d in e&&(u[d]=e[d]);return u}function fP(e){const s={path:e.path,redirect:e.redirect,name:e.name,meta:e.meta||{},aliasOf:e.aliasOf,beforeEnter:e.beforeEnter,props:mV(e),children:e.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in e?e.components||null:e.component&&{default:e.component}};return Object.defineProperty(s,"mods",{value:{}}),s}function mV(e){const s={},u=e.props||!1;if("component"in e)s.default=u;else for(const d in e.components)s[d]=typeof u=="object"?u[d]:u;return s}function pP(e){for(;e;){if(e.record.aliasOf)return!0;e=e.parent}return!1}function gV(e){return e.reduce((s,u)=>Cs(s,u.meta),{})}function mP(e,s){const u={};for(const d in e)u[d]=d in s?s[d]:e[d];return u}function _V(e,s){let u=0,d=s.length;for(;u!==d;){const E=u+d>>1;hR(e,s[E])<0?d=E:u=E+1}const b=yV(e);return b&&(d=s.lastIndexOf(b,d-1)),d}function yV(e){let s=e;for(;s=s.parent;)if(dR(s)&&hR(e,s)===0)return s}function dR({record:e}){return!!(e.name||e.components&&Object.keys(e.components).length||e.redirect)}function vV(e){const s={};if(e===""||e==="?")return s;const d=(e[0]==="?"?e.slice(1):e).split("&");for(let b=0;b<d.length;++b){const E=d[b].replace(iR," "),T=E.indexOf("="),t=Yx(T<0?E:E.slice(0,T)),G=T<0?null:Yx(E.slice(T+1));if(t in s){let W=s[t];Of(W)||(W=s[t]=[W]),W.push(G)}else s[t]=G}return s}function gP(e){let s="";for(let u in e){const d=e[u];if(u=V4(u),d==null){d!==void 0&&(s+=(s.length?"&":"")+u);continue}(Of(d)?d.map(E=>E&&tT(E)):[d&&tT(d)]).forEach(E=>{E!==void 0&&(s+=(s.length?"&":"")+u,E!=null&&(s+="="+E))})}return s}function xV(e){const s={};for(const u in e){const d=e[u];d!==void 0&&(s[u]=Of(d)?d.map(b=>b==null?null:""+b):d==null?d:""+d)}return s}const bV=Symbol(""),_P=Symbol(""),mC=Symbol(""),fR=Symbol(""),iT=Symbol("");function Sx(){let e=[];function s(d){return e.push(d),()=>{const b=e.indexOf(d);b>-1&&e.splice(b,1)}}function u(){e=[]}return{add:s,list:()=>e.slice(),reset:u}}function Eg(e,s,u,d,b,E=T=>T()){const T=d&&(d.enterCallbacks[b]=d.enterCallbacks[b]||[]);return()=>new Promise((t,G)=>{const W=J=>{J===!1?G(av(4,{from:u,to:s})):J instanceof Error?G(J):aV(J)?G(av(2,{from:s,to:J})):(T&&d.enterCallbacks[b]===T&&typeof J=="function"&&T.push(J),t())},Y=E(()=>e.call(d&&d.instances[b],s,u,W));let ne=Promise.resolve(Y);e.length<3&&(ne=ne.then(W)),ne.catch(J=>G(J))})}function HS(e,s,u,d,b=E=>E()){const E=[];for(const T of e)for(const t in T.components){let G=T.components[t];if(!(s!=="beforeRouteEnter"&&!T.instances[t]))if(tR(G)){const Y=(G.__vccOpts||G)[s];Y&&E.push(Eg(Y,u,d,T,t,b))}else{let W=G();E.push(()=>W.then(Y=>{if(!Y)throw new Error(`Couldn't resolve component "${t}" at "${T.path}"`);const ne=I4(Y)?Y.default:Y;T.mods[t]=Y,T.components[t]=ne;const Q=(ne.__vccOpts||ne)[s];return Q&&Eg(Q,u,d,T,t,b)()}))}}return E}function yP(e){const s=vr(mC),u=vr(fR),d=Fe(()=>{const G=Ps(e.to);return s.resolve(G)}),b=Fe(()=>{const{matched:G}=d.value,{length:W}=G,Y=G[W-1],ne=u.matched;if(!Y||!ne.length)return-1;const J=ne.findIndex(rv.bind(null,Y));if(J>-1)return J;const Q=vP(G[W-2]);return W>1&&vP(Y)===Q&&ne[ne.length-1].path!==Q?ne.findIndex(rv.bind(null,G[W-2])):J}),E=Fe(()=>b.value>-1&&EV(u.params,d.value.params)),T=Fe(()=>b.value>-1&&b.value===u.matched.length-1&&oR(u.params,d.value.params));function t(G={}){if(CV(G)){const W=s[Ps(e.replace)?"replace":"push"](Ps(e.to)).catch(jx);return e.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>W),W}return Promise.resolve()}return{route:d,href:Fe(()=>d.value.href),isActive:E,isExactActive:T,navigate:t}}function wV(e){return e.length===1?e[0]:e}const SV=mo({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:yP,setup(e,{slots:s}){const u=$l(yP(e)),{options:d}=vr(mC),b=Fe(()=>({[xP(e.activeClass,d.linkActiveClass,"router-link-active")]:u.isActive,[xP(e.exactActiveClass,d.linkExactActiveClass,"router-link-exact-active")]:u.isExactActive}));return()=>{const E=s.default&&wV(s.default(u));return e.custom?E:Uf("a",{"aria-current":u.isExactActive?e.ariaCurrentValue:null,href:u.href,onClick:u.navigate,class:b.value},E)}}}),TV=SV;function CV(e){if(!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)&&!e.defaultPrevented&&!(e.button!==void 0&&e.button!==0)){if(e.currentTarget&&e.currentTarget.getAttribute){const s=e.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(s))return}return e.preventDefault&&e.preventDefault(),!0}}function EV(e,s){for(const u in s){const d=s[u],b=e[u];if(typeof d=="string"){if(d!==b)return!1}else if(!Of(b)||b.length!==d.length||d.some((E,T)=>E!==b[T]))return!1}return!0}function vP(e){return e?e.aliasOf?e.aliasOf.path:e.path:""}const xP=(e,s,u)=>e??s??u,MV=mo({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(e,{attrs:s,slots:u}){const d=vr(iT),b=Fe(()=>e.route||d.value),E=vr(_P,0),T=Fe(()=>{let W=Ps(E);const{matched:Y}=b.value;let ne;for(;(ne=Y[W])&&!ne.components;)W++;return W}),t=Fe(()=>b.value.matched[T.value]);xa(_P,Fe(()=>T.value+1)),xa(bV,t),xa(iT,b);const G=yi();return Pi(()=>[G.value,t.value,e.name],([W,Y,ne],[J,Q,ce])=>{Y&&(Y.instances[ne]=W,Q&&Q!==Y&&W&&W===J&&(Y.leaveGuards.size||(Y.leaveGuards=Q.leaveGuards),Y.updateGuards.size||(Y.updateGuards=Q.updateGuards))),W&&Y&&(!Q||!rv(Y,Q)||!J)&&(Y.enterCallbacks[ne]||[]).forEach(ie=>ie(W))},{flush:"post"}),()=>{const W=b.value,Y=e.name,ne=t.value,J=ne&&ne.components[Y];if(!J)return bP(u.default,{Component:J,route:W});const Q=ne.props[Y],ce=Q?Q===!0?W.params:typeof Q=="function"?Q(W):Q:null,pe=Uf(J,Cs({},ce,s,{onVnodeUnmounted:be=>{be.component.isUnmounted&&(ne.instances[Y]=null)},ref:G}));return bP(u.default,{Component:pe,route:W})||pe}}});function bP(e,s){if(!e)return null;const u=e(s);return u.length===1?u[0]:u}const pR=MV;function IV(e){const s=pV(e.routes,e),u=e.parseQuery||vV,d=e.stringifyQuery||gP,b=e.history,E=Sx(),T=Sx(),t=Sx(),G=Bi(bg);let W=bg;Hy&&e.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const Y=GS.bind(null,sn=>""+sn),ne=GS.bind(null,j4),J=GS.bind(null,Yx);function Q(sn,qn){let pi,ht;return cR(sn)?(pi=s.getRecordMatcher(sn),ht=qn):ht=sn,s.addRoute(ht,pi)}function ce(sn){const qn=s.getRecordMatcher(sn);qn&&s.removeRoute(qn)}function ie(){return s.getRoutes().map(sn=>sn.record)}function pe(sn){return!!s.getRecordMatcher(sn)}function be(sn,qn){if(qn=Cs({},qn||G.value),typeof sn=="string"){const at=qS(u,sn,qn.path),Tn=s.resolve({path:at.path},qn),bn=b.createHref(at.fullPath);return Cs(at,Tn,{params:J(Tn.params),hash:Yx(at.hash),redirectedFrom:void 0,href:bn})}let pi;if(sn.path!=null)pi=Cs({},sn,{path:qS(u,sn.path,qn.path).path});else{const at=Cs({},sn.params);for(const Tn in at)at[Tn]==null&&delete at[Tn];pi=Cs({},sn,{params:ne(at)}),qn.params=ne(qn.params)}const ht=s.resolve(pi,qn),Zn=sn.hash||"";ht.params=Y(J(ht.params));const St=G4(d,Cs({},sn,{hash:B4(Zn),path:ht.path})),mt=b.createHref(St);return Cs({fullPath:St,hash:Zn,query:d===gP?xV(sn.query):sn.query||{}},ht,{redirectedFrom:void 0,href:mt})}function Ie(sn){return typeof sn=="string"?qS(u,sn,G.value.path):Cs({},sn)}function $e(sn,qn){if(W!==sn)return av(8,{from:qn,to:sn})}function Le(sn){return Ue(sn)}function Oe(sn){return Le(Cs(Ie(sn),{replace:!0}))}function Ve(sn){const qn=sn.matched[sn.matched.length-1];if(qn&&qn.redirect){const{redirect:pi}=qn;let ht=typeof pi=="function"?pi(sn):pi;return typeof ht=="string"&&(ht=ht.includes("?")||ht.includes("#")?ht=Ie(ht):{path:ht},ht.params={}),Cs({query:sn.query,hash:sn.hash,params:ht.path!=null?{}:sn.params},ht)}}function Ue(sn,qn){const pi=W=be(sn),ht=G.value,Zn=sn.state,St=sn.force,mt=sn.replace===!0,at=Ve(pi);if(at)return Ue(Cs(Ie(at),{state:typeof at=="object"?Cs({},Zn,at.state):Zn,force:St,replace:mt}),qn||pi);const Tn=pi;Tn.redirectedFrom=qn;let bn;return!St&&q4(d,ht,pi)&&(bn=av(16,{to:Tn,from:ht}),mn(ht,ht,!0,!1)),(bn?Promise.resolve(bn):nt(Tn,ht)).catch(Cn=>wm(Cn)?wm(Cn,2)?Cn:Bn(Cn):ai(Cn,Tn,ht)).then(Cn=>{if(Cn){if(wm(Cn,2))return Ue(Cs({replace:mt},Ie(Cn.to),{state:typeof Cn.to=="object"?Cs({},Zn,Cn.to.state):Zn,force:St}),qn||Tn)}else Cn=ft(Tn,ht,!0,mt,Zn);return rt(Tn,ht,Cn),Cn})}function qe(sn,qn){const pi=$e(sn,qn);return pi?Promise.reject(pi):Promise.resolve()}function He(sn){const qn=Ci.values().next().value;return qn&&typeof qn.runWithContext=="function"?qn.runWithContext(sn):sn()}function nt(sn,qn){let pi;const[ht,Zn,St]=PV(sn,qn);pi=HS(ht.reverse(),"beforeRouteLeave",sn,qn);for(const at of ht)at.leaveGuards.forEach(Tn=>{pi.push(Eg(Tn,sn,qn))});const mt=qe.bind(null,sn,qn);return pi.push(mt),Ln(pi).then(()=>{pi=[];for(const at of E.list())pi.push(Eg(at,sn,qn));return pi.push(mt),Ln(pi)}).then(()=>{pi=HS(Zn,"beforeRouteUpdate",sn,qn);for(const at of Zn)at.updateGuards.forEach(Tn=>{pi.push(Eg(Tn,sn,qn))});return pi.push(mt),Ln(pi)}).then(()=>{pi=[];for(const at of St)if(at.beforeEnter)if(Of(at.beforeEnter))for(const Tn of at.beforeEnter)pi.push(Eg(Tn,sn,qn));else pi.push(Eg(at.beforeEnter,sn,qn));return pi.push(mt),Ln(pi)}).then(()=>(sn.matched.forEach(at=>at.enterCallbacks={}),pi=HS(St,"beforeRouteEnter",sn,qn,He),pi.push(mt),Ln(pi))).then(()=>{pi=[];for(const at of T.list())pi.push(Eg(at,sn,qn));return pi.push(mt),Ln(pi)}).catch(at=>wm(at,8)?at:Promise.reject(at))}function rt(sn,qn,pi){t.list().forEach(ht=>He(()=>ht(sn,qn,pi)))}function ft(sn,qn,pi,ht,Zn){const St=$e(sn,qn);if(St)return St;const mt=qn===bg,at=Hy?history.state:{};pi&&(ht||mt?b.replace(sn.fullPath,Cs({scroll:mt&&at&&at.scroll},Zn)):b.push(sn.fullPath,Zn)),G.value=sn,mn(sn,qn,pi,mt),Bn()}let $t;function hn(){$t||($t=b.listen((sn,qn,pi)=>{if(!Fi.listening)return;const ht=be(sn),Zn=Ve(ht);if(Zn){Ue(Cs(Zn,{replace:!0,force:!0}),ht).catch(jx);return}W=ht;const St=G.value;Hy&&Q4(oP(St.fullPath,pi.delta),$1()),nt(ht,St).catch(mt=>wm(mt,12)?mt:wm(mt,2)?(Ue(Cs(Ie(mt.to),{force:!0}),ht).then(at=>{wm(at,20)&&!pi.delta&&pi.type===Kx.pop&&b.go(-1,!1)}).catch(jx),Promise.reject()):(pi.delta&&b.go(-pi.delta,!1),ai(mt,ht,St))).then(mt=>{mt=mt||ft(ht,St,!1),mt&&(pi.delta&&!wm(mt,8)?b.go(-pi.delta,!1):pi.type===Kx.pop&&wm(mt,20)&&b.go(-1,!1)),rt(ht,St,mt)}).catch(jx)}))}let gn=Sx(),pn=Sx(),ri;function ai(sn,qn,pi){Bn(sn);const ht=pn.list();return ht.length?ht.forEach(Zn=>Zn(sn,qn,pi)):console.error(sn),Promise.reject(sn)}function _n(){return ri&&G.value!==bg?Promise.resolve():new Promise((sn,qn)=>{gn.add([sn,qn])})}function Bn(sn){return ri||(ri=!sn,hn(),gn.list().forEach(([qn,pi])=>sn?pi(sn):qn()),gn.reset()),sn}function mn(sn,qn,pi,ht){const{scrollBehavior:Zn}=e;if(!Hy||!Zn)return Promise.resolve();const St=!pi&&eV(oP(sn.fullPath,0))||(ht||!pi)&&history.state&&history.state.scroll||null;return Na().then(()=>Zn(sn,qn,St)).then(mt=>mt&&J4(mt)).catch(mt=>ai(mt,sn,qn))}const Nn=sn=>b.go(sn);let Pn;const Ci=new Set,Fi={currentRoute:G,listening:!0,addRoute:Q,removeRoute:ce,clearRoutes:s.clearRoutes,hasRoute:pe,getRoutes:ie,resolve:be,options:e,push:Le,replace:Oe,go:Nn,back:()=>Nn(-1),forward:()=>Nn(1),beforeEach:E.add,beforeResolve:T.add,afterEach:t.add,onError:pn.add,isReady:_n,install(sn){const qn=this;sn.component("RouterLink",TV),sn.component("RouterView",pR),sn.config.globalProperties.$router=qn,Object.defineProperty(sn.config.globalProperties,"$route",{enumerable:!0,get:()=>Ps(G)}),Hy&&!Pn&&G.value===bg&&(Pn=!0,Le(b.location).catch(Zn=>{}));const pi={};for(const Zn in bg)Object.defineProperty(pi,Zn,{get:()=>G.value[Zn],enumerable:!0});sn.provide(mC,qn),sn.provide(fR,Qk(pi)),sn.provide(iT,G);const ht=sn.unmount;Ci.add(sn),sn.unmount=function(){Ci.delete(sn),Ci.size<1&&(W=bg,$t&&$t(),$t=null,G.value=bg,Pn=!1,ri=!1),ht()}}};function Ln(sn){return sn.reduce((qn,pi)=>qn.then(()=>He(pi)),Promise.resolve())}return Fi}function PV(e,s){const u=[],d=[],b=[],E=Math.max(s.matched.length,e.matched.length);for(let T=0;T<E;T++){const t=s.matched[T];t&&(e.matched.find(W=>rv(W,t))?d.push(t):u.push(t));const G=e.matched[T];G&&(s.matched.find(W=>rv(W,G))||b.push(G))}return[u,d,b]}const AV=mo({__name:"App",setup(e){const s=yi([{id:1,name:"1910",year:"1910"},{id:2,name:"1920",year:"1920"},{id:3,name:"Current",year:"current"}]);return(u,d)=>{const b=Ul("v-list-item"),E=Ul("v-list"),T=Ul("v-divider"),t=Ul("v-list-item-title"),G=Ul("v-list-group"),W=Ul("v-navigation-drawer"),Y=Ul("v-container"),ne=Ul("v-layout"),J=Ul("v-app");return ja(),Em(J,null,{default:fh(()=>[de(ne,null,{default:fh(()=>[de(W,{"expand-on-hover":"",rail:"","mobile-breakpoint":0},{default:fh(()=>[de(E,null,{default:fh(()=>[de(b,{"prepend-avatar":"/gcc.png",title:"Greenwood Kiosk"})]),_:1}),de(T),de(E,{density:"compact",nav:""},{default:fh(()=>[de(b,{"prepend-icon":"mdi-home",link:"",title:"Home",to:"/"}),de(G,{value:"Maps"},{activator:fh(({props:Q})=>[de(b,oi(Q,{"prepend-icon":"mdi-map",title:"Maps"}),null,16)]),default:fh(()=>[(ja(!0),Gs(sr,null,r5(s.value,Q=>(ja(),Em(b,{key:Q.id,link:"",to:"/maps/"+Q.year},{default:fh(()=>[de(t,null,{default:fh(()=>[Kc($x(Q.name),1)]),_:2},1024)]),_:2},1032,["to"]))),128))]),_:1})]),_:1})]),_:1}),de(Y,{fluid:""},{default:fh(()=>[de(Ps(pR))]),_:1})]),_:1})]),_:1})}}}),kV=mo({props:{msg:String},name:"HelloWorld",setup(){return{count:yi(0)}}}),H_=(e,s)=>{const u=e.__vccOpts||e;for(const[d,b]of s)u[d]=b;return u},DV={class:"card"};function RV(e,s,u,d,b,E){return ja(),Gs(sr,null,[Ys("h1",null,$x(e.msg),1),Ys("div",DV,[Ys("button",{type:"button",onClick:s[0]||(s[0]=T=>e.count++)},"count is "+$x(e.count),1),s[1]||(s[1]=Ys("p",null,[Kc(" Edit "),Ys("code",null,"components/HelloWorld.vue"),Kc(" to test HMR ")],-1))]),s[2]||(s[2]=Ys("p",null,[Kc(" Check out "),Ys("a",{href:"https://vuejs.org/guide/quick-start.html#local",target:"_blank"},"create-vue"),Kc(", the official Vue + Vite starter ")],-1)),s[3]||(s[3]=Ys("p",null,[Kc(" Learn more about IDE Support for Vue in the "),Ys("a",{href:"https://vuejs.org/guide/scaling-up/tooling.html#ide-support",target:"_blank"},"Vue Docs Scaling up Guide"),Kc(". ")],-1)),s[4]||(s[4]=Ys("p",{class:"read-the-docs"},"Click on the Vite and Vue logos to learn more",-1))],64)}const LV=H_(kV,[["render",RV],["__scopeId","data-v-a05b656c"]]),zV=mo({components:{HelloWorld:LV}}),OV="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20aria-hidden='true'%20role='img'%20class='iconify%20iconify--logos'%20width='31.88'%20height='32'%20preserveAspectRatio='xMidYMid%20meet'%20viewBox='0%200%20256%20257'%3e%3cdefs%3e%3clinearGradient%20id='IconifyId1813088fe1fbc01fb466'%20x1='-.828%25'%20x2='57.636%25'%20y1='7.652%25'%20y2='78.411%25'%3e%3cstop%20offset='0%25'%20stop-color='%2341D1FF'%3e%3c/stop%3e%3cstop%20offset='100%25'%20stop-color='%23BD34FE'%3e%3c/stop%3e%3c/linearGradient%3e%3clinearGradient%20id='IconifyId1813088fe1fbc01fb467'%20x1='43.376%25'%20x2='50.316%25'%20y1='2.242%25'%20y2='89.03%25'%3e%3cstop%20offset='0%25'%20stop-color='%23FFEA83'%3e%3c/stop%3e%3cstop%20offset='8.333%25'%20stop-color='%23FFDD35'%3e%3c/stop%3e%3cstop%20offset='100%25'%20stop-color='%23FFA800'%3e%3c/stop%3e%3c/linearGradient%3e%3c/defs%3e%3cpath%20fill='url(%23IconifyId1813088fe1fbc01fb466)'%20d='M255.153%2037.938L134.897%20252.976c-2.483%204.44-8.862%204.466-11.382.048L.875%2037.958c-2.746-4.814%201.371-10.646%206.827-9.67l120.385%2021.517a6.537%206.537%200%200%200%202.322-.004l117.867-21.483c5.438-.991%209.574%204.796%206.877%209.62Z'%3e%3c/path%3e%3cpath%20fill='url(%23IconifyId1813088fe1fbc01fb467)'%20d='M185.432.063L96.44%2017.501a3.268%203.268%200%200%200-2.634%203.014l-5.474%2092.456a3.268%203.268%200%200%200%203.997%203.378l24.777-5.718c2.318-.535%204.413%201.507%203.936%203.838l-7.361%2036.047c-.495%202.426%201.782%204.5%204.151%203.78l15.304-4.649c2.372-.72%204.652%201.36%204.15%203.788l-11.698%2056.621c-.732%203.542%203.979%205.473%205.943%202.437l1.313-2.028l72.516-144.72c1.215-2.423-.88-5.186-3.54-4.672l-25.505%204.922c-2.396.462-4.435-1.77-3.759-4.114l16.646-57.705c.677-2.35-1.37-4.583-3.769-4.113Z'%3e%3c/path%3e%3c/svg%3e",FV="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20aria-hidden='true'%20role='img'%20class='iconify%20iconify--logos'%20width='37.07'%20height='36'%20preserveAspectRatio='xMidYMid%20meet'%20viewBox='0%200%20256%20198'%3e%3cpath%20fill='%2341B883'%20d='M204.8%200H256L128%20220.8L0%200h97.92L128%2051.2L157.44%200h47.36Z'%3e%3c/path%3e%3cpath%20fill='%2341B883'%20d='m0%200l128%20220.8L256%200h-51.2L128%20132.48L50.56%200H0Z'%3e%3c/path%3e%3cpath%20fill='%2335495E'%20d='M50.56%200L128%20133.12L204.8%200h-47.36L128%2051.2L97.92%200H50.56Z'%3e%3c/path%3e%3c/svg%3e";function BV(e,s,u,d,b,E){const T=Ul("HelloWorld");return ja(),Gs(sr,null,[s[0]||(s[0]=Ys("div",null,[Ys("a",{href:"https://vite.dev",target:"_blank"},[Ys("img",{src:OV,class:"logo",alt:"Vite logo"})]),Ys("a",{href:"https://vuejs.org/",target:"_blank"},[Ys("img",{src:FV,class:"logo vue",alt:"Vue logo"})])],-1)),de(T,{msg:"Vite + Vue"})],64)}const VV=H_(zV,[["render",BV],["__scopeId","data-v-c6d3f9e7"]]);var Ig=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Z_(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function NV(e){if(e.__esModule)return e;var s=e.default;if(typeof s=="function"){var u=function d(){return this instanceof d?Reflect.construct(s,arguments,this.constructor):s.apply(this,arguments)};u.prototype=s.prototype}else u={};return Object.defineProperty(u,"__esModule",{value:!0}),Object.keys(e).forEach(function(d){var b=Object.getOwnPropertyDescriptor(e,d);Object.defineProperty(u,d,b.get?b:{enumerable:!0,get:function(){return e[d]}})}),u}var s1={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v5.1.0/LICENSE.txt
 */var jV=s1.exports,wP;function UV(){return wP||(wP=1,function(e,s){(function(u,d){e.exports=d()})(jV,function(){var u={},d={};function b(T,t,G){if(d[T]=G,T==="index"){var W="var sharedModule = {}; ("+d.shared+")(sharedModule); ("+d.worker+")(sharedModule);",Y={};return d.shared(Y),d.index(u,Y),typeof window<"u"&&u.setWorkerUrl(window.URL.createObjectURL(new Blob([W],{type:"text/javascript"}))),u}}b("shared",["exports"],function(T){function t(g,o,m,S){return new(m||(m=Promise))(function(D,U){function $(fe){try{oe(S.next(fe))}catch(ve){U(ve)}}function X(fe){try{oe(S.throw(fe))}catch(ve){U(ve)}}function oe(fe){var ve;fe.done?D(fe.value):(ve=fe.value,ve instanceof m?ve:new m(function(Ce){Ce(ve)})).then($,X)}oe((S=S.apply(g,o||[])).next())})}function G(g){return g&&g.__esModule&&Object.prototype.hasOwnProperty.call(g,"default")?g.default:g}var W,Y;function ne(){if(Y)return W;function g(o,m){this.x=o,this.y=m}return Y=1,W=g,g.prototype={clone:function(){return new g(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,m){return this.clone()._rotateAround(o,m)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var m=o.x-this.x,S=o.y-this.y;return m*m+S*S},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,m){return Math.atan2(this.x*m-this.y*o,this.x*o+this.y*m)},_matMult:function(o){var m=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=m,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var m=Math.cos(o),S=Math.sin(o),D=S*this.x+m*this.y;return this.x=m*this.x-S*this.y,this.y=D,this},_rotateAround:function(o,m){var S=Math.cos(o),D=Math.sin(o),U=m.y+D*(this.x-m.x)+S*(this.y-m.y);return this.x=m.x+S*(this.x-m.x)-D*(this.y-m.y),this.y=U,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},g.convert=function(o){return o instanceof g?o:Array.isArray(o)?new g(o[0],o[1]):o},W}typeof SuppressedError=="function"&&SuppressedError;var J,Q,ce=G(ne()),ie=function(){if(Q)return J;function g(o,m,S,D){this.cx=3*o,this.bx=3*(S-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*m,this.by=3*(D-m)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=m,this.p2x=S,this.p2y=D}return Q=1,J=g,g.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,m){if(m===void 0&&(m=1e-6),o<0)return 0;if(o>1)return 1;for(var S=o,D=0;D<8;D++){var U=this.sampleCurveX(S)-o;if(Math.abs(U)<m)return S;var $=this.sampleCurveDerivativeX(S);if(Math.abs($)<1e-6)break;S-=U/$}var X=0,oe=1;for(S=o,D=0;D<20&&(U=this.sampleCurveX(S),!(Math.abs(U-o)<m));D++)o>U?X=S:oe=S,S=.5*(oe-X)+X;return S},solve:function(o,m){return this.sampleCurveY(this.solveCurveX(o,m))}},J}(),pe=G(ie);let be,Ie;function $e(){return be==null&&(be=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),be}function Le(){if(Ie==null&&(Ie=!1,$e())){const o=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(o){for(let S=0;S<5*5;S++){const D=4*S;o.fillStyle=`rgb(${D},${D+1},${D+2})`,o.fillRect(S%5,Math.floor(S/5),1,1)}const m=o.getImageData(0,0,5,5).data;for(let S=0;S<5*5*4;S++)if(S%4!=3&&m[S]!==S){Ie=!0;break}}}return Ie||!1}var Oe,Ve=1e-6,Ue=typeof Float32Array<"u"?Float32Array:Array;function qe(){var g=new Ue(9);return Ue!=Float32Array&&(g[1]=0,g[2]=0,g[3]=0,g[5]=0,g[6]=0,g[7]=0),g[0]=1,g[4]=1,g[8]=1,g}function He(g){return g[0]=1,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=1,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[10]=1,g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,g}function nt(){var g=new Ue(3);return Ue!=Float32Array&&(g[0]=0,g[1]=0,g[2]=0),g}function rt(g,o,m){var S=new Ue(3);return S[0]=g,S[1]=o,S[2]=m,S}function ft(g,o,m){var S=o[0],D=o[1],U=o[2],$=o[3];return g[0]=m[0]*S+m[4]*D+m[8]*U+m[12]*$,g[1]=m[1]*S+m[5]*D+m[9]*U+m[13]*$,g[2]=m[2]*S+m[6]*D+m[10]*U+m[14]*$,g[3]=m[3]*S+m[7]*D+m[11]*U+m[15]*$,g}function $t(){var g=new Ue(4);return Ue!=Float32Array&&(g[0]=0,g[1]=0,g[2]=0),g[3]=1,g}function hn(){var g=new Ue(2);return Ue!=Float32Array&&(g[0]=0,g[1]=0),g}function gn(g,o){var m=new Ue(2);return m[0]=g,m[1]=o,m}Math.hypot||(Math.hypot=function(){for(var g=0,o=arguments.length;o--;)g+=arguments[o]*arguments[o];return Math.sqrt(g)}),nt(),Oe=new Ue(4),Ue!=Float32Array&&(Oe[0]=0,Oe[1]=0,Oe[2]=0,Oe[3]=0),nt(),rt(1,0,0),rt(0,1,0),$t(),$t(),qe(),hn();const pn=8192;function ri(g,o,m){return o*(pn/(g.tileSize*Math.pow(2,m-g.tileID.overscaledZ)))}function ai(g,o){return(g%o+o)%o}function _n(g,o,m){return g*(1-m)+o*m}function Bn(g){if(g<=0)return 0;if(g>=1)return 1;const o=g*g,m=o*g;return 4*(g<.5?m:3*(g-o)+m-.75)}function mn(g,o,m,S){const D=new pe(g,o,m,S);return U=>D.solve(U)}const Nn=mn(.25,.1,.25,1);function Pn(g,o,m){return Math.min(m,Math.max(o,g))}function Ci(g,o,m){const S=m-o,D=((g-o)%S+S)%S+o;return D===o?m:D}function Fi(g,...o){for(const m of o)for(const S in m)g[S]=m[S];return g}let Ln=1;function sn(g,o,m){const S={};for(const D in g)S[D]=o.call(this,g[D],D,g);return S}function qn(g,o,m){const S={};for(const D in g)o.call(this,g[D],D,g)&&(S[D]=g[D]);return S}function pi(g){return Array.isArray(g)?g.map(pi):typeof g=="object"&&g?sn(g,pi):g}const ht={};function Zn(g){ht[g]||(typeof console<"u"&&console.warn(g),ht[g]=!0)}function St(g,o,m){return(m.y-g.y)*(o.x-g.x)>(o.y-g.y)*(m.x-g.x)}function mt(g){return typeof WorkerGlobalScope<"u"&&g!==void 0&&g instanceof WorkerGlobalScope}let at=null;function Tn(g){return typeof ImageBitmap<"u"&&g instanceof ImageBitmap}const bn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Cn(g,o,m,S,D){return t(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const U=new VideoFrame(g,{timestamp:0});try{const $=U==null?void 0:U.format;if(!$||!$.startsWith("BGR")&&!$.startsWith("RGB"))throw new Error(`Unrecognized format ${$}`);const X=$.startsWith("BGR"),oe=new Uint8ClampedArray(S*D*4);if(yield U.copyTo(oe,function(fe,ve,Ce,Be,je){const Ge=4*Math.max(1,0),lt=(Math.max(0,Ce)-Ce)*Be*4+Ge,Tt=4*Be,Ot=Math.max(0,ve),ln=Math.max(0,Ce);return{rect:{x:Ot,y:ln,width:Math.min(fe.width,ve+Be)-Ot,height:Math.min(fe.height,Ce+je)-ln},layout:[{offset:lt,stride:Tt}]}}(g,o,m,S,D)),X)for(let fe=0;fe<oe.length;fe+=4){const ve=oe[fe];oe[fe]=oe[fe+2],oe[fe+2]=ve}return oe}finally{U.close()}})}let zn,vi;function ii(g){return g/Math.PI*180}const wi="AbortError";function Ki(){return new Error(wi)}const Vi={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function ui(g){return Vi.REGISTERED_PROTOCOLS[g.substring(0,g.indexOf("://"))]}const pr="global-dispatcher";class Er extends Error{constructor(o,m,S,D){super(`AJAXError: ${m} (${o}): ${S}`),this.status=o,this.statusText=m,this.url=S,this.body=D}}const sa=()=>mt(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Ar=function(g,o){if(/:\/\//.test(g.url)&&!/^https?:|^file:/.test(g.url)){const S=ui(g.url);if(S)return S(g,o);if(mt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:g,targetMapId:pr},o)}if(!(/^file:/.test(m=g.url)||/^file:/.test(sa())&&!/^\w+:/.test(m))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(S,D){return t(this,void 0,void 0,function*(){const U=new Request(S.url,{method:S.method||"GET",body:S.body,credentials:S.credentials,headers:S.headers,cache:S.cache,referrer:sa(),signal:D.signal});let $,X;S.type!=="json"||U.headers.has("Accept")||U.headers.set("Accept","application/json");try{$=yield fetch(U)}catch(fe){throw new Er(0,fe.message,S.url,new Blob)}if(!$.ok){const fe=yield $.blob();throw new Er($.status,$.statusText,S.url,fe)}X=S.type==="arrayBuffer"||S.type==="image"?$.arrayBuffer():S.type==="json"?$.json():$.text();const oe=yield X;if(D.signal.aborted)throw Ki();return{data:oe,cacheControl:$.headers.get("Cache-Control"),expires:$.headers.get("Expires")}})}(g,o);if(mt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:g,mustQueue:!0,targetMapId:pr},o)}var m;return function(S,D){return new Promise((U,$)=>{var X;const oe=new XMLHttpRequest;oe.open(S.method||"GET",S.url,!0),S.type!=="arrayBuffer"&&S.type!=="image"||(oe.responseType="arraybuffer");for(const fe in S.headers)oe.setRequestHeader(fe,S.headers[fe]);S.type==="json"&&(oe.responseType="text",!((X=S.headers)===null||X===void 0)&&X.Accept||oe.setRequestHeader("Accept","application/json")),oe.withCredentials=S.credentials==="include",oe.onerror=()=>{$(new Error(oe.statusText))},oe.onload=()=>{if(!D.signal.aborted)if((oe.status>=200&&oe.status<300||oe.status===0)&&oe.response!==null){let fe=oe.response;if(S.type==="json")try{fe=JSON.parse(oe.response)}catch(ve){return void $(ve)}U({data:fe,cacheControl:oe.getResponseHeader("Cache-Control"),expires:oe.getResponseHeader("Expires")})}else{const fe=new Blob([oe.response],{type:oe.getResponseHeader("Content-Type")});$(new Er(oe.status,oe.statusText,S.url,fe))}},D.signal.addEventListener("abort",()=>{oe.abort(),$(Ki())}),oe.send(S.body)})}(g,o)};function Ta(g){if(!g||g.indexOf("://")<=0||g.indexOf("data:image/")===0||g.indexOf("blob:")===0)return!0;const o=new URL(g),m=window.location;return o.protocol===m.protocol&&o.host===m.host}function Qa(g,o,m){m[g]&&m[g].indexOf(o)!==-1||(m[g]=m[g]||[],m[g].push(o))}function Os(g,o,m){if(m&&m[g]){const S=m[g].indexOf(o);S!==-1&&m[g].splice(S,1)}}class As{constructor(o,m={}){Fi(this,m),this.type=o}}class to extends As{constructor(o,m={}){super("error",Fi({error:o},m))}}class ko{on(o,m){return this._listeners=this._listeners||{},Qa(o,m,this._listeners),{unsubscribe:()=>{this.off(o,m)}}}off(o,m){return Os(o,m,this._listeners),Os(o,m,this._oneTimeListeners),this}once(o,m){return m?(this._oneTimeListeners=this._oneTimeListeners||{},Qa(o,m,this._oneTimeListeners),this):new Promise(S=>this.once(o,S))}fire(o,m){typeof o=="string"&&(o=new As(o,m||{}));const S=o.type;if(this.listens(S)){o.target=this;const D=this._listeners&&this._listeners[S]?this._listeners[S].slice():[];for(const X of D)X.call(this,o);const U=this._oneTimeListeners&&this._oneTimeListeners[S]?this._oneTimeListeners[S].slice():[];for(const X of U)Os(S,X,this._oneTimeListeners),X.call(this,o);const $=this._eventedParent;$&&(Fi(o,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),$.fire(o))}else o instanceof to&&console.error(o.error);return this}listens(o){return this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o)}setEventedParent(o,m){return this._eventedParent=o,this._eventedParentData=m,this}}var bt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},centerAltitude:{type:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},roll:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"projectionDefinition",default:"mercator","property-type":"data-constant",transition:!1,expression:{interpolated:!0,parameters:["zoom"]}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Qe=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function dt(g,o){const m={};for(const S in g)S!=="ref"&&(m[S]=g[S]);return Qe.forEach(S=>{S in o&&(m[S]=o[S])}),m}function it(g,o){if(Array.isArray(g)){if(!Array.isArray(o)||g.length!==o.length)return!1;for(let m=0;m<g.length;m++)if(!it(g[m],o[m]))return!1;return!0}if(typeof g=="object"&&g!==null&&o!==null){if(typeof o!="object"||Object.keys(g).length!==Object.keys(o).length)return!1;for(const m in g)if(!it(g[m],o[m]))return!1;return!0}return g===o}function Ut(g,o){g.push(o)}function on(g,o,m){Ut(m,{command:"addSource",args:[g,o[g]]})}function un(g,o,m){Ut(o,{command:"removeSource",args:[g]}),m[g]=!0}function kn(g,o,m,S){un(g,m,S),on(g,o,m)}function fn(g,o,m){let S;for(S in g[m])if(Object.prototype.hasOwnProperty.call(g[m],S)&&S!=="data"&&!it(g[m][S],o[m][S]))return!1;for(S in o[m])if(Object.prototype.hasOwnProperty.call(o[m],S)&&S!=="data"&&!it(g[m][S],o[m][S]))return!1;return!0}function Wn(g,o,m,S,D,U){g=g||{},o=o||{};for(const $ in g)Object.prototype.hasOwnProperty.call(g,$)&&(it(g[$],o[$])||m.push({command:U,args:[S,$,o[$],D]}));for(const $ in o)Object.prototype.hasOwnProperty.call(o,$)&&!Object.prototype.hasOwnProperty.call(g,$)&&(it(g[$],o[$])||m.push({command:U,args:[S,$,o[$],D]}))}function Gn(g){return g.id}function Sn(g,o){return g[o.id]=o,g}class et{constructor(o,m,S,D){this.message=(o?`${o}: `:"")+S,D&&(this.identifier=D),m!=null&&m.__line__&&(this.line=m.__line__)}}function we(g,...o){for(const m of o)for(const S in m)g[S]=m[S];return g}class Pe extends Error{constructor(o,m){super(m),this.message=m,this.key=o}}class Ze{constructor(o,m=[]){this.parent=o,this.bindings={};for(const[S,D]of m)this.bindings[S]=D}concat(o){return new Ze(this,o)}get(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(`${o} not found in scope.`)}has(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)}}const yt={kind:"null"},We={kind:"number"},pt={kind:"string"},kt={kind:"boolean"},Dt={kind:"color"},Jt={kind:"projectionDefinition"},Xt={kind:"object"},Gt={kind:"value"},On={kind:"collator"},_i={kind:"formatted"},li={kind:"padding"},Ui={kind:"resolvedImage"},qi={kind:"variableAnchorOffsetCollection"};function Qi(g,o){return{kind:"array",itemType:g,N:o}}function Ni(g){if(g.kind==="array"){const o=Ni(g.itemType);return typeof g.N=="number"?`array<${o}, ${g.N}>`:g.itemType.kind==="value"?"array":`array<${o}>`}return g.kind}const Jr=[yt,We,pt,kt,Dt,Jt,_i,Xt,Qi(Gt),li,Ui,qi];function Nr(g,o){if(o.kind==="error")return null;if(g.kind==="array"){if(o.kind==="array"&&(o.N===0&&o.itemType.kind==="value"||!Nr(g.itemType,o.itemType))&&(typeof g.N!="number"||g.N===o.N))return null}else{if(g.kind===o.kind)return null;if(g.kind==="value"){for(const m of Jr)if(!Nr(m,o))return null}}return`Expected ${Ni(g)} but found ${Ni(o)} instead.`}function kr(g,o){return o.some(m=>m.kind===g.kind)}function Zr(g,o){return o.some(m=>m==="null"?g===null:m==="array"?Array.isArray(g):m==="object"?g&&!Array.isArray(g)&&typeof g=="object":m===typeof g)}function Xr(g,o){return g.kind==="array"&&o.kind==="array"?g.itemType.kind===o.itemType.kind&&typeof g.N=="number":g.kind===o.kind}const xs=.96422,go=.82521,Fs=4/29,bs=6/29,Ou=3*bs*bs,Lc=bs*bs*bs,Xp=Math.PI/180,Gf=180/Math.PI;function Fu(g){return(g%=360)<0&&(g+=360),g}function Yh([g,o,m,S]){let D,U;const $=dc((.2225045*(g=Zl(g))+.7168786*(o=Zl(o))+.0606169*(m=Zl(m)))/1);g===o&&o===m?D=U=$:(D=dc((.4360747*g+.3850649*o+.1430804*m)/xs),U=dc((.0139322*g+.0971045*o+.7141733*m)/go));const X=116*$-16;return[X<0?0:X,500*(D-$),200*($-U),S]}function Zl(g){return g<=.04045?g/12.92:Math.pow((g+.055)/1.055,2.4)}function dc(g){return g>Lc?Math.pow(g,1/3):g/Ou+Fs}function Bu([g,o,m,S]){let D=(g+16)/116,U=isNaN(o)?D:D+o/500,$=isNaN(m)?D:D-m/200;return D=1*qf(D),U=xs*qf(U),$=go*qf($),[ru(3.1338561*U-1.6168667*D-.4906146*$),ru(-.9787684*U+1.9161415*D+.033454*$),ru(.0719453*U-.2289914*D+1.4052427*$),S]}function ru(g){return(g=g<=.00304?12.92*g:1.055*Math.pow(g,1/2.4)-.055)<0?0:g>1?1:g}function qf(g){return g>bs?g*g*g:Ou*(g-Fs)}function _h(g){return parseInt(g.padEnd(2,g),16)/255}function Kh(g,o){return zc(o?g/100:g,0,1)}function zc(g,o,m){return Math.min(Math.max(o,g),m)}function Gd(g){return!g.some(Number.isNaN)}const ks={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};function zr(g,o,m){return g+m*(o-g)}function Bs(g,o,m){return g.map((S,D)=>zr(S,o[D],m))}class Br{constructor(o,m,S,D=1,U=!0){this.r=o,this.g=m,this.b=S,this.a=D,U||(this.r*=D,this.g*=D,this.b*=D,D||this.overwriteGetter("rgb",[o,m,S,D]))}static parse(o){if(o instanceof Br)return o;if(typeof o!="string")return;const m=function(S){if((S=S.toLowerCase().trim())==="transparent")return[0,0,0,0];const D=ks[S];if(D){const[$,X,oe]=D;return[$/255,X/255,oe/255,1]}if(S.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(S)){const $=S.length<6?1:2;let X=1;return[_h(S.slice(X,X+=$)),_h(S.slice(X,X+=$)),_h(S.slice(X,X+=$)),_h(S.slice(X,X+$)||"ff")]}if(S.startsWith("rgb")){const $=S.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if($){const[X,oe,fe,ve,Ce,Be,je,Ge,lt,Tt,Ot,ln]=$,Zt=[ve||" ",je||" ",Tt].join("");if(Zt==="  "||Zt==="  /"||Zt===",,"||Zt===",,,"){const Ne=[fe,Be,lt].join(""),xt=Ne==="%%%"?100:Ne===""?255:0;if(xt){const Yt=[zc(+oe/xt,0,1),zc(+Ce/xt,0,1),zc(+Ge/xt,0,1),Ot?Kh(+Ot,ln):1];if(Gd(Yt))return Yt}}return}}const U=S.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(U){const[$,X,oe,fe,ve,Ce,Be,je,Ge]=U,lt=[oe||" ",ve||" ",Be].join("");if(lt==="  "||lt==="  /"||lt===",,"||lt===",,,"){const Tt=[+X,zc(+fe,0,100),zc(+Ce,0,100),je?Kh(+je,Ge):1];if(Gd(Tt))return function([Ot,ln,Zt,Ne]){function xt(Yt){const Dn=(Yt+Ot/30)%12,bi=ln*Math.min(Zt,1-Zt);return Zt-bi*Math.max(-1,Math.min(Dn-3,9-Dn,1))}return Ot=Fu(Ot),ln/=100,Zt/=100,[xt(0),xt(8),xt(4),Ne]}(Tt)}}}(o);return m?new Br(...m,!1):void 0}get rgb(){const{r:o,g:m,b:S,a:D}=this,U=D||1/0;return this.overwriteGetter("rgb",[o/U,m/U,S/U,D])}get hcl(){return this.overwriteGetter("hcl",function(o){const[m,S,D,U]=Yh(o),$=Math.sqrt(S*S+D*D);return[Math.round(1e4*$)?Fu(Math.atan2(D,S)*Gf):NaN,$,m,U]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Yh(this.rgb))}overwriteGetter(o,m){return Object.defineProperty(this,o,{value:m}),m}toString(){const[o,m,S,D]=this.rgb;return`rgba(${[o,m,S].map(U=>Math.round(255*U)).join(",")},${D})`}static interpolate(o,m,S,D="rgb"){switch(D){case"rgb":{const[U,$,X,oe]=Bs(o.rgb,m.rgb,S);return new Br(U,$,X,oe,!1)}case"hcl":{const[U,$,X,oe]=o.hcl,[fe,ve,Ce,Be]=m.hcl;let je,Ge;if(isNaN(U)||isNaN(fe))isNaN(U)?isNaN(fe)?je=NaN:(je=fe,X!==1&&X!==0||(Ge=ve)):(je=U,Ce!==1&&Ce!==0||(Ge=$));else{let Zt=fe-U;fe>U&&Zt>180?Zt-=360:fe<U&&U-fe>180&&(Zt+=360),je=U+S*Zt}const[lt,Tt,Ot,ln]=function([Zt,Ne,xt,Yt]){return Zt=isNaN(Zt)?0:Zt*Xp,Bu([xt,Math.cos(Zt)*Ne,Math.sin(Zt)*Ne,Yt])}([je,Ge??zr($,ve,S),zr(X,Ce,S),zr(oe,Be,S)]);return new Br(lt,Tt,Ot,ln,!1)}case"lab":{const[U,$,X,oe]=Bu(Bs(o.lab,m.lab,S));return new Br(U,$,X,oe,!1)}}}}Br.black=new Br(0,0,0,1),Br.white=new Br(1,1,1,1),Br.transparent=new Br(0,0,0,0),Br.red=new Br(1,0,0,1);class Wl{constructor(o,m,S){this.sensitivity=o?m?"variant":"case":m?"accent":"base",this.locale=S,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(o,m){return this.collator.compare(o,m)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}const qd=["bottom","center","top"];class au{constructor(o,m,S,D,U,$){this.text=o,this.image=m,this.scale=S,this.fontStack=D,this.textColor=U,this.verticalAlign=$}}class $a{constructor(o){this.sections=o}static fromString(o){return new $a([new au(o,null,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(o=>o.text.length!==0||o.image&&o.image.name.length!==0)}static factory(o){return o instanceof $a?o:$a.fromString(o)}toString(){return this.sections.length===0?"":this.sections.map(o=>o.text).join("")}}class ss{constructor(o){this.values=o.slice()}static parse(o){if(o instanceof ss)return o;if(typeof o=="number")return new ss([o,o,o,o]);if(Array.isArray(o)&&!(o.length<1||o.length>4)){for(const m of o)if(typeof m!="number")return;switch(o.length){case 1:o=[o[0],o[0],o[0],o[0]];break;case 2:o=[o[0],o[1],o[0],o[1]];break;case 3:o=[o[0],o[1],o[2],o[1]]}return new ss(o)}}toString(){return JSON.stringify(this.values)}static interpolate(o,m,S){return new ss(Bs(o.values,m.values,S))}}class es{constructor(o){this.name="ExpressionEvaluationError",this.message=o}toJSON(){return this.message}}const Hd=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Vs{constructor(o){this.values=o.slice()}static parse(o){if(o instanceof Vs)return o;if(Array.isArray(o)&&!(o.length<1)&&o.length%2==0){for(let m=0;m<o.length;m+=2){const S=o[m],D=o[m+1];if(typeof S!="string"||!Hd.has(S)||!Array.isArray(D)||D.length!==2||typeof D[0]!="number"||typeof D[1]!="number")return}return new Vs(o)}}toString(){return JSON.stringify(this.values)}static interpolate(o,m,S){const D=o.values,U=m.values;if(D.length!==U.length)throw new es(`Cannot interpolate values of different length. from: ${o.toString()}, to: ${m.toString()}`);const $=[];for(let X=0;X<D.length;X+=2){if(D[X]!==U[X])throw new es(`Cannot interpolate values containing mismatched anchors. from[${X}]: ${D[X]}, to[${X}]: ${U[X]}`);$.push(D[X]);const[oe,fe]=D[X+1],[ve,Ce]=U[X+1];$.push([zr(oe,ve,S),zr(fe,Ce,S)])}return new Vs($)}}class ts{constructor(o){this.name=o.name,this.available=o.available}toString(){return this.name}static fromString(o){return o?new ts({name:o,available:!1}):null}}class no{constructor(o,m,S){this.from=o,this.to=m,this.transition=S}static interpolate(o,m,S){return new no(o,m,S)}static parse(o){return o instanceof no?o:Array.isArray(o)&&o.length===3&&typeof o[0]=="string"&&typeof o[1]=="string"&&typeof o[2]=="number"?new no(o[0],o[1],o[2]):typeof o=="object"&&typeof o.from=="string"&&typeof o.to=="string"&&typeof o.transition=="number"?new no(o.from,o.to,o.transition):typeof o=="string"?new no(o,o,1):void 0}}function Jh(g,o,m,S){return typeof g=="number"&&g>=0&&g<=255&&typeof o=="number"&&o>=0&&o<=255&&typeof m=="number"&&m>=0&&m<=255?S===void 0||typeof S=="number"&&S>=0&&S<=1?null:`Invalid rgba value [${[g,o,m,S].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof S=="number"?[g,o,m,S]:[g,o,m]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Or(g){if(g===null||typeof g=="string"||typeof g=="boolean"||typeof g=="number"||g instanceof no||g instanceof Br||g instanceof Wl||g instanceof $a||g instanceof ss||g instanceof Vs||g instanceof ts)return!0;if(Array.isArray(g)){for(const o of g)if(!Or(o))return!1;return!0}if(typeof g=="object"){for(const o in g)if(!Or(g[o]))return!1;return!0}return!1}function os(g){if(g===null)return yt;if(typeof g=="string")return pt;if(typeof g=="boolean")return kt;if(typeof g=="number")return We;if(g instanceof Br)return Dt;if(g instanceof no)return Jt;if(g instanceof Wl)return On;if(g instanceof $a)return _i;if(g instanceof ss)return li;if(g instanceof Vs)return qi;if(g instanceof ts)return Ui;if(Array.isArray(g)){const o=g.length;let m;for(const S of g){const D=os(S);if(m){if(m===D)continue;m=Gt;break}m=D}return Qi(m||Gt,o)}return Xt}function ir(g){const o=typeof g;return g===null?"":o==="string"||o==="number"||o==="boolean"?String(g):g instanceof Br||g instanceof no||g instanceof $a||g instanceof ss||g instanceof Vs||g instanceof ts?g.toString():JSON.stringify(g)}class Xl{constructor(o,m){this.type=o,this.value=m}static parse(o,m){if(o.length!==2)return m.error(`'literal' expression requires exactly one argument, but found ${o.length-1} instead.`);if(!Or(o[1]))return m.error("invalid value");const S=o[1];let D=os(S);const U=m.expectedType;return D.kind!=="array"||D.N!==0||!U||U.kind!=="array"||typeof U.N=="number"&&U.N!==0||(D=U),new Xl(D,S)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}const Dr={string:pt,number:We,boolean:kt,object:Xt};class Qo{constructor(o,m){this.type=o,this.args=m}static parse(o,m){if(o.length<2)return m.error("Expected at least one argument.");let S,D=1;const U=o[0];if(U==="array"){let X,oe;if(o.length>2){const fe=o[1];if(typeof fe!="string"||!(fe in Dr)||fe==="object")return m.error('The item type argument of "array" must be one of string, number, boolean',1);X=Dr[fe],D++}else X=Gt;if(o.length>3){if(o[2]!==null&&(typeof o[2]!="number"||o[2]<0||o[2]!==Math.floor(o[2])))return m.error('The length argument to "array" must be a positive integer literal',2);oe=o[2],D++}S=Qi(X,oe)}else{if(!Dr[U])throw new Error(`Types doesn't contain name = ${U}`);S=Dr[U]}const $=[];for(;D<o.length;D++){const X=m.parse(o[D],D,Gt);if(!X)return null;$.push(X)}return new Qo(S,$)}evaluate(o){for(let m=0;m<this.args.length;m++){const S=this.args[m].evaluate(o);if(!Nr(this.type,os(S)))return S;if(m===this.args.length-1)throw new es(`Expected value to be of type ${Ni(this.type)}, but found ${Ni(os(S))} instead.`)}throw new Error}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}const fl={"to-boolean":kt,"to-color":Dt,"to-number":We,"to-string":pt};class fc{constructor(o,m){this.type=o,this.args=m}static parse(o,m){if(o.length<2)return m.error("Expected at least one argument.");const S=o[0];if(!fl[S])throw new Error(`Can't parse ${S} as it is not part of the known types`);if((S==="to-boolean"||S==="to-string")&&o.length!==2)return m.error("Expected one argument.");const D=fl[S],U=[];for(let $=1;$<o.length;$++){const X=m.parse(o[$],$,Gt);if(!X)return null;U.push(X)}return new fc(D,U)}evaluate(o){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(o);case"color":{let m,S;for(const D of this.args){if(m=D.evaluate(o),S=null,m instanceof Br)return m;if(typeof m=="string"){const U=o.parseColor(m);if(U)return U}else if(Array.isArray(m)&&(S=m.length<3||m.length>4?`Invalid rgba value ${JSON.stringify(m)}: expected an array containing either three or four numeric values.`:Jh(m[0],m[1],m[2],m[3]),!S))return new Br(m[0]/255,m[1]/255,m[2]/255,m[3])}throw new es(S||`Could not parse color from value '${typeof m=="string"?m:JSON.stringify(m)}'`)}case"padding":{let m;for(const S of this.args){m=S.evaluate(o);const D=ss.parse(m);if(D)return D}throw new es(`Could not parse padding from value '${typeof m=="string"?m:JSON.stringify(m)}'`)}case"variableAnchorOffsetCollection":{let m;for(const S of this.args){m=S.evaluate(o);const D=Vs.parse(m);if(D)return D}throw new es(`Could not parse variableAnchorOffsetCollection from value '${typeof m=="string"?m:JSON.stringify(m)}'`)}case"number":{let m=null;for(const S of this.args){if(m=S.evaluate(o),m===null)return 0;const D=Number(m);if(!isNaN(D))return D}throw new es(`Could not convert ${JSON.stringify(m)} to number.`)}case"formatted":return $a.fromString(ir(this.args[0].evaluate(o)));case"resolvedImage":return ts.fromString(ir(this.args[0].evaluate(o)));case"projectionDefinition":return this.args[0].evaluate(o);default:return ir(this.args[0].evaluate(o))}}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}const su=["Unknown","Point","LineString","Polygon"];class hi{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?su[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(o){let m=this._parseColorCache[o];return m||(m=this._parseColorCache[o]=Br.parse(o)),m}}class jr{constructor(o,m,S=[],D,U=new Ze,$=[]){this.registry=o,this.path=S,this.key=S.map(X=>`[${X}]`).join(""),this.scope=U,this.errors=$,this.expectedType=D,this._isConstant=m}parse(o,m,S,D,U={}){return m?this.concat(m,S,D)._parse(o,U):this._parse(o,U)}_parse(o,m){function S(D,U,$){return $==="assert"?new Qo(U,[D]):$==="coerce"?new fc(U,[D]):D}if(o!==null&&typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"||(o=["literal",o]),Array.isArray(o)){if(o.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const D=o[0];if(typeof D!="string")return this.error(`Expression name must be a string, but found ${typeof D} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const U=this.registry[D];if(U){let $=U.parse(o,this);if(!$)return null;if(this.expectedType){const X=this.expectedType,oe=$.type;if(X.kind!=="string"&&X.kind!=="number"&&X.kind!=="boolean"&&X.kind!=="object"&&X.kind!=="array"||oe.kind!=="value")if(X.kind!=="projectionDefinition"||oe.kind!=="string"&&oe.kind!=="array")if(X.kind!=="color"&&X.kind!=="formatted"&&X.kind!=="resolvedImage"||oe.kind!=="value"&&oe.kind!=="string")if(X.kind!=="padding"||oe.kind!=="value"&&oe.kind!=="number"&&oe.kind!=="array")if(X.kind!=="variableAnchorOffsetCollection"||oe.kind!=="value"&&oe.kind!=="array"){if(this.checkSubtype(X,oe))return null}else $=S($,X,m.typeAnnotation||"coerce");else $=S($,X,m.typeAnnotation||"coerce");else $=S($,X,m.typeAnnotation||"coerce");else $=S($,X,m.typeAnnotation||"coerce");else $=S($,X,m.typeAnnotation||"assert")}if(!($ instanceof Xl)&&$.type.kind!=="resolvedImage"&&this._isConstant($)){const X=new hi;try{$=new Xl($.type,$.evaluate(X))}catch(oe){return this.error(oe.message),null}}return $}return this.error(`Unknown expression "${D}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(o===void 0?"'undefined' value invalid. Use null instead.":typeof o=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof o} instead.`)}concat(o,m,S){const D=typeof o=="number"?this.path.concat(o):this.path,U=S?this.scope.concat(S):this.scope;return new jr(this.registry,this._isConstant,D,m||null,U,this.errors)}error(o,...m){const S=`${this.key}${m.map(D=>`[${D}]`).join("")}`;this.errors.push(new Pe(S,o))}checkSubtype(o,m){const S=Nr(o,m);return S&&this.error(S),S}}class Wi{constructor(o,m){this.type=m.type,this.bindings=[].concat(o),this.result=m}evaluate(o){return this.result.evaluate(o)}eachChild(o){for(const m of this.bindings)o(m[1]);o(this.result)}static parse(o,m){if(o.length<4)return m.error(`Expected at least 3 arguments, but found ${o.length-1} instead.`);const S=[];for(let U=1;U<o.length-1;U+=2){const $=o[U];if(typeof $!="string")return m.error(`Expected string, but found ${typeof $} instead.`,U);if(/[^a-zA-Z0-9_]/.test($))return m.error("Variable names must contain only alphanumeric characters or '_'.",U);const X=m.parse(o[U+1],U+1);if(!X)return null;S.push([$,X])}const D=m.parse(o[o.length-1],o.length-1,m.expectedType,S);return D?new Wi(S,D):null}outputDefined(){return this.result.outputDefined()}}class Sr{constructor(o,m){this.type=m.type,this.name=o,this.boundExpression=m}static parse(o,m){if(o.length!==2||typeof o[1]!="string")return m.error("'var' expression requires exactly one string literal argument.");const S=o[1];return m.scope.has(S)?new Sr(S,m.scope.get(S)):m.error(`Unknown variable "${S}". Make sure "${S}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(o){return this.boundExpression.evaluate(o)}eachChild(){}outputDefined(){return!1}}class pc{constructor(o,m,S){this.type=o,this.index=m,this.input=S}static parse(o,m){if(o.length!==3)return m.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const S=m.parse(o[1],1,We),D=m.parse(o[2],2,Qi(m.expectedType||Gt));return S&&D?new pc(D.type.itemType,S,D):null}evaluate(o){const m=this.index.evaluate(o),S=this.input.evaluate(o);if(m<0)throw new es(`Array index out of bounds: ${m} < 0.`);if(m>=S.length)throw new es(`Array index out of bounds: ${m} > ${S.length-1}.`);if(m!==Math.floor(m))throw new es(`Array index must be an integer, but found ${m} instead.`);return S[m]}eachChild(o){o(this.index),o(this.input)}outputDefined(){return!1}}class Hi{constructor(o,m){this.type=kt,this.needle=o,this.haystack=m}static parse(o,m){if(o.length!==3)return m.error(`Expected 2 arguments, but found ${o.length-1} instead.`);const S=m.parse(o[1],1,Gt),D=m.parse(o[2],2,Gt);return S&&D?kr(S.type,[kt,pt,We,yt,Gt])?new Hi(S,D):m.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ni(S.type)} instead`):null}evaluate(o){const m=this.needle.evaluate(o),S=this.haystack.evaluate(o);if(!S)return!1;if(!Zr(m,["boolean","string","number","null"]))throw new es(`Expected first argument to be of type boolean, string, number or null, but found ${Ni(os(m))} instead.`);if(!Zr(S,["string","array"]))throw new es(`Expected second argument to be of type array or string, but found ${Ni(os(S))} instead.`);return S.indexOf(m)>=0}eachChild(o){o(this.needle),o(this.haystack)}outputDefined(){return!0}}class ou{constructor(o,m,S){this.type=We,this.needle=o,this.haystack=m,this.fromIndex=S}static parse(o,m){if(o.length<=2||o.length>=5)return m.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const S=m.parse(o[1],1,Gt),D=m.parse(o[2],2,Gt);if(!S||!D)return null;if(!kr(S.type,[kt,pt,We,yt,Gt]))return m.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ni(S.type)} instead`);if(o.length===4){const U=m.parse(o[3],3,We);return U?new ou(S,D,U):null}return new ou(S,D)}evaluate(o){const m=this.needle.evaluate(o),S=this.haystack.evaluate(o);if(!Zr(m,["boolean","string","number","null"]))throw new es(`Expected first argument to be of type boolean, string, number or null, but found ${Ni(os(m))} instead.`);let D;if(this.fromIndex&&(D=this.fromIndex.evaluate(o)),Zr(S,["string"])){const U=S.indexOf(m,D);return U===-1?-1:[...S.slice(0,U)].length}if(Zr(S,["array"]))return S.indexOf(m,D);throw new es(`Expected second argument to be of type array or string, but found ${Ni(os(S))} instead.`)}eachChild(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)}outputDefined(){return!1}}class io{constructor(o,m,S,D,U,$){this.inputType=o,this.type=m,this.input=S,this.cases=D,this.outputs=U,this.otherwise=$}static parse(o,m){if(o.length<5)return m.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if(o.length%2!=1)return m.error("Expected an even number of arguments.");let S,D;m.expectedType&&m.expectedType.kind!=="value"&&(D=m.expectedType);const U={},$=[];for(let fe=2;fe<o.length-1;fe+=2){let ve=o[fe];const Ce=o[fe+1];Array.isArray(ve)||(ve=[ve]);const Be=m.concat(fe);if(ve.length===0)return Be.error("Expected at least one branch label.");for(const Ge of ve){if(typeof Ge!="number"&&typeof Ge!="string")return Be.error("Branch labels must be numbers or strings.");if(typeof Ge=="number"&&Math.abs(Ge)>Number.MAX_SAFE_INTEGER)return Be.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Ge=="number"&&Math.floor(Ge)!==Ge)return Be.error("Numeric branch labels must be integer values.");if(S){if(Be.checkSubtype(S,os(Ge)))return null}else S=os(Ge);if(U[String(Ge)]!==void 0)return Be.error("Branch labels must be unique.");U[String(Ge)]=$.length}const je=m.parse(Ce,fe,D);if(!je)return null;D=D||je.type,$.push(je)}const X=m.parse(o[1],1,Gt);if(!X)return null;const oe=m.parse(o[o.length-1],o.length-1,D);return oe?X.type.kind!=="value"&&m.concat(1).checkSubtype(S,X.type)?null:new io(S,D,X,U,$,oe):null}evaluate(o){const m=this.input.evaluate(o);return(os(m)===this.inputType&&this.outputs[this.cases[m]]||this.otherwise).evaluate(o)}eachChild(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)}outputDefined(){return this.outputs.every(o=>o.outputDefined())&&this.otherwise.outputDefined()}}class mc{constructor(o,m,S){this.type=o,this.branches=m,this.otherwise=S}static parse(o,m){if(o.length<4)return m.error(`Expected at least 3 arguments, but found only ${o.length-1}.`);if(o.length%2!=0)return m.error("Expected an odd number of arguments.");let S;m.expectedType&&m.expectedType.kind!=="value"&&(S=m.expectedType);const D=[];for(let $=1;$<o.length-1;$+=2){const X=m.parse(o[$],$,kt);if(!X)return null;const oe=m.parse(o[$+1],$+1,S);if(!oe)return null;D.push([X,oe]),S=S||oe.type}const U=m.parse(o[o.length-1],o.length-1,S);if(!U)return null;if(!S)throw new Error("Can't infer output type");return new mc(S,D,U)}evaluate(o){for(const[m,S]of this.branches)if(m.evaluate(o))return S.evaluate(o);return this.otherwise.evaluate(o)}eachChild(o){for(const[m,S]of this.branches)o(m),o(S);o(this.otherwise)}outputDefined(){return this.branches.every(([o,m])=>m.outputDefined())&&this.otherwise.outputDefined()}}class Ns{constructor(o,m,S,D){this.type=o,this.input=m,this.beginIndex=S,this.endIndex=D}static parse(o,m){if(o.length<=2||o.length>=5)return m.error(`Expected 3 or 4 arguments, but found ${o.length-1} instead.`);const S=m.parse(o[1],1,Gt),D=m.parse(o[2],2,We);if(!S||!D)return null;if(!kr(S.type,[Qi(Gt),pt,Gt]))return m.error(`Expected first argument to be of type array or string, but found ${Ni(S.type)} instead`);if(o.length===4){const U=m.parse(o[3],3,We);return U?new Ns(S.type,S,D,U):null}return new Ns(S.type,S,D)}evaluate(o){const m=this.input.evaluate(o),S=this.beginIndex.evaluate(o);let D;if(this.endIndex&&(D=this.endIndex.evaluate(o)),Zr(m,["string"]))return[...m].slice(S,D).join("");if(Zr(m,["array"]))return m.slice(S,D);throw new es(`Expected first argument to be of type array or string, but found ${Ni(os(m))} instead.`)}eachChild(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)}outputDefined(){return!1}}function ca(g,o){const m=g.length-1;let S,D,U=0,$=m,X=0;for(;U<=$;)if(X=Math.floor((U+$)/2),S=g[X],D=g[X+1],S<=o){if(X===m||o<D)return X;U=X+1}else{if(!(S>o))throw new es("Input is not a number.");$=X-1}return 0}class Vu{constructor(o,m,S){this.type=o,this.input=m,this.labels=[],this.outputs=[];for(const[D,U]of S)this.labels.push(D),this.outputs.push(U)}static parse(o,m){if(o.length-1<4)return m.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return m.error("Expected an even number of arguments.");const S=m.parse(o[1],1,We);if(!S)return null;const D=[];let U=null;m.expectedType&&m.expectedType.kind!=="value"&&(U=m.expectedType);for(let $=1;$<o.length;$+=2){const X=$===1?-1/0:o[$],oe=o[$+1],fe=$,ve=$+1;if(typeof X!="number")return m.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',fe);if(D.length&&D[D.length-1][0]>=X)return m.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',fe);const Ce=m.parse(oe,ve,U);if(!Ce)return null;U=U||Ce.type,D.push([X,Ce])}return new Vu(U,S,D)}evaluate(o){const m=this.labels,S=this.outputs;if(m.length===1)return S[0].evaluate(o);const D=this.input.evaluate(o);if(D<=m[0])return S[0].evaluate(o);const U=m.length;return D>=m[U-1]?S[U-1].evaluate(o):S[ca(m,D)].evaluate(o)}eachChild(o){o(this.input);for(const m of this.outputs)o(m)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}}function Qh(g){return g&&g.__esModule&&Object.prototype.hasOwnProperty.call(g,"default")?g.default:g}var ed,Nu,Zd=function(){if(Nu)return ed;function g(o,m,S,D){this.cx=3*o,this.bx=3*(S-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*m,this.by=3*(D-m)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=m,this.p2x=S,this.p2y=D}return Nu=1,ed=g,g.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,m){if(m===void 0&&(m=1e-6),o<0)return 0;if(o>1)return 1;for(var S=o,D=0;D<8;D++){var U=this.sampleCurveX(S)-o;if(Math.abs(U)<m)return S;var $=this.sampleCurveDerivativeX(S);if(Math.abs($)<1e-6)break;S-=U/$}var X=0,oe=1;for(S=o,D=0;D<20&&(U=this.sampleCurveX(S),!(Math.abs(U-o)<m));D++)o>U?X=S:oe=S,S=.5*(oe-X)+X;return S},solve:function(o,m){return this.sampleCurveY(this.solveCurveX(o,m))}},ed}(),lu=Qh(Zd);class Yr{constructor(o,m,S,D,U){this.type=o,this.operator=m,this.interpolation=S,this.input=D,this.labels=[],this.outputs=[];for(const[$,X]of U)this.labels.push($),this.outputs.push(X)}static interpolationFactor(o,m,S,D){let U=0;if(o.name==="exponential")U=el(m,o.base,S,D);else if(o.name==="linear")U=el(m,1,S,D);else if(o.name==="cubic-bezier"){const $=o.controlPoints;U=new lu($[0],$[1],$[2],$[3]).solve(el(m,1,S,D))}return U}static parse(o,m){let[S,D,U,...$]=o;if(!Array.isArray(D)||D.length===0)return m.error("Expected an interpolation type expression.",1);if(D[0]==="linear")D={name:"linear"};else if(D[0]==="exponential"){const fe=D[1];if(typeof fe!="number")return m.error("Exponential interpolation requires a numeric base.",1,1);D={name:"exponential",base:fe}}else{if(D[0]!=="cubic-bezier")return m.error(`Unknown interpolation type ${String(D[0])}`,1,0);{const fe=D.slice(1);if(fe.length!==4||fe.some(ve=>typeof ve!="number"||ve<0||ve>1))return m.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);D={name:"cubic-bezier",controlPoints:fe}}}if(o.length-1<4)return m.error(`Expected at least 4 arguments, but found only ${o.length-1}.`);if((o.length-1)%2!=0)return m.error("Expected an even number of arguments.");if(U=m.parse(U,2,We),!U)return null;const X=[];let oe=null;S==="interpolate-hcl"||S==="interpolate-lab"?oe=Dt:m.expectedType&&m.expectedType.kind!=="value"&&(oe=m.expectedType);for(let fe=0;fe<$.length;fe+=2){const ve=$[fe],Ce=$[fe+1],Be=fe+3,je=fe+4;if(typeof ve!="number")return m.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',Be);if(X.length&&X[X.length-1][0]>=ve)return m.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',Be);const Ge=m.parse(Ce,je,oe);if(!Ge)return null;oe=oe||Ge.type,X.push([ve,Ge])}return Xr(oe,We)||Xr(oe,Jt)||Xr(oe,Dt)||Xr(oe,li)||Xr(oe,qi)||Xr(oe,Qi(We))?new Yr(oe,S,D,U,X):m.error(`Type ${Ni(oe)} is not interpolatable.`)}evaluate(o){const m=this.labels,S=this.outputs;if(m.length===1)return S[0].evaluate(o);const D=this.input.evaluate(o);if(D<=m[0])return S[0].evaluate(o);const U=m.length;if(D>=m[U-1])return S[U-1].evaluate(o);const $=ca(m,D),X=Yr.interpolationFactor(this.interpolation,D,m[$],m[$+1]),oe=S[$].evaluate(o),fe=S[$+1].evaluate(o);switch(this.operator){case"interpolate":switch(this.type.kind){case"number":return zr(oe,fe,X);case"color":return Br.interpolate(oe,fe,X);case"padding":return ss.interpolate(oe,fe,X);case"variableAnchorOffsetCollection":return Vs.interpolate(oe,fe,X);case"array":return Bs(oe,fe,X);case"projectionDefinition":return no.interpolate(oe,fe,X)}case"interpolate-hcl":return Br.interpolate(oe,fe,X,"hcl");case"interpolate-lab":return Br.interpolate(oe,fe,X,"lab")}}eachChild(o){o(this.input);for(const m of this.outputs)o(m)}outputDefined(){return this.outputs.every(o=>o.outputDefined())}}function el(g,o,m,S){const D=S-m,U=g-m;return D===0?0:o===1?U/D:(Math.pow(o,U)-1)/(Math.pow(o,D)-1)}const Oa={color:Br.interpolate,number:zr,padding:ss.interpolate,variableAnchorOffsetCollection:Vs.interpolate,array:Bs};class Ml{constructor(o,m){this.type=o,this.args=m}static parse(o,m){if(o.length<2)return m.error("Expected at least one argument.");let S=null;const D=m.expectedType;D&&D.kind!=="value"&&(S=D);const U=[];for(const X of o.slice(1)){const oe=m.parse(X,1+U.length,S,void 0,{typeAnnotation:"omit"});if(!oe)return null;S=S||oe.type,U.push(oe)}if(!S)throw new Error("No output type");const $=D&&U.some(X=>Nr(D,X.type));return new Ml($?Gt:S,U)}evaluate(o){let m,S=null,D=0;for(const U of this.args)if(D++,S=U.evaluate(o),S&&S instanceof ts&&!S.available&&(m||(m=S.name),S=null,D===this.args.length&&(S=m)),S!==null)break;return S}eachChild(o){this.args.forEach(o)}outputDefined(){return this.args.every(o=>o.outputDefined())}}function fs(g,o){return g==="=="||g==="!="?o.kind==="boolean"||o.kind==="string"||o.kind==="number"||o.kind==="null"||o.kind==="value":o.kind==="string"||o.kind==="number"||o.kind==="value"}function Ca(g,o,m,S){return S.compare(o,m)===0}function _o(g,o,m){const S=g!=="=="&&g!=="!=";return class mR{constructor(U,$,X){this.type=kt,this.lhs=U,this.rhs=$,this.collator=X,this.hasUntypedArgument=U.type.kind==="value"||$.type.kind==="value"}static parse(U,$){if(U.length!==3&&U.length!==4)return $.error("Expected two or three arguments.");const X=U[0];let oe=$.parse(U[1],1,Gt);if(!oe)return null;if(!fs(X,oe.type))return $.concat(1).error(`"${X}" comparisons are not supported for type '${Ni(oe.type)}'.`);let fe=$.parse(U[2],2,Gt);if(!fe)return null;if(!fs(X,fe.type))return $.concat(2).error(`"${X}" comparisons are not supported for type '${Ni(fe.type)}'.`);if(oe.type.kind!==fe.type.kind&&oe.type.kind!=="value"&&fe.type.kind!=="value")return $.error(`Cannot compare types '${Ni(oe.type)}' and '${Ni(fe.type)}'.`);S&&(oe.type.kind==="value"&&fe.type.kind!=="value"?oe=new Qo(fe.type,[oe]):oe.type.kind!=="value"&&fe.type.kind==="value"&&(fe=new Qo(oe.type,[fe])));let ve=null;if(U.length===4){if(oe.type.kind!=="string"&&fe.type.kind!=="string"&&oe.type.kind!=="value"&&fe.type.kind!=="value")return $.error("Cannot use collator to compare non-string types.");if(ve=$.parse(U[3],3,On),!ve)return null}return new mR(oe,fe,ve)}evaluate(U){const $=this.lhs.evaluate(U),X=this.rhs.evaluate(U);if(S&&this.hasUntypedArgument){const oe=os($),fe=os(X);if(oe.kind!==fe.kind||oe.kind!=="string"&&oe.kind!=="number")throw new es(`Expected arguments for "${g}" to be (string, string) or (number, number), but found (${oe.kind}, ${fe.kind}) instead.`)}if(this.collator&&!S&&this.hasUntypedArgument){const oe=os($),fe=os(X);if(oe.kind!=="string"||fe.kind!=="string")return o(U,$,X)}return this.collator?m(U,$,X,this.collator.evaluate(U)):o(U,$,X)}eachChild(U){U(this.lhs),U(this.rhs),this.collator&&U(this.collator)}outputDefined(){return!0}}}const Il=_o("==",function(g,o,m){return o===m},Ca),ws=_o("!=",function(g,o,m){return o!==m},function(g,o,m,S){return!Ca(0,o,m,S)}),ju=_o("<",function(g,o,m){return o<m},function(g,o,m,S){return S.compare(o,m)<0}),pl=_o(">",function(g,o,m){return o>m},function(g,o,m,S){return S.compare(o,m)>0}),cu=_o("<=",function(g,o,m){return o<=m},function(g,o,m,S){return S.compare(o,m)<=0}),uu=_o(">=",function(g,o,m){return o>=m},function(g,o,m,S){return S.compare(o,m)>=0});class Pl{constructor(o,m,S){this.type=On,this.locale=S,this.caseSensitive=o,this.diacriticSensitive=m}static parse(o,m){if(o.length!==2)return m.error("Expected one argument.");const S=o[1];if(typeof S!="object"||Array.isArray(S))return m.error("Collator options argument must be an object.");const D=m.parse(S["case-sensitive"]!==void 0&&S["case-sensitive"],1,kt);if(!D)return null;const U=m.parse(S["diacritic-sensitive"]!==void 0&&S["diacritic-sensitive"],1,kt);if(!U)return null;let $=null;return S.locale&&($=m.parse(S.locale,1,pt),!$)?null:new Pl(D,U,$)}evaluate(o){return new Wl(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)}eachChild(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)}outputDefined(){return!1}}class Al{constructor(o,m,S,D,U){this.type=pt,this.number=o,this.locale=m,this.currency=S,this.minFractionDigits=D,this.maxFractionDigits=U}static parse(o,m){if(o.length!==3)return m.error("Expected two arguments.");const S=m.parse(o[1],1,We);if(!S)return null;const D=o[2];if(typeof D!="object"||Array.isArray(D))return m.error("NumberFormat options argument must be an object.");let U=null;if(D.locale&&(U=m.parse(D.locale,1,pt),!U))return null;let $=null;if(D.currency&&($=m.parse(D.currency,1,pt),!$))return null;let X=null;if(D["min-fraction-digits"]&&(X=m.parse(D["min-fraction-digits"],1,We),!X))return null;let oe=null;return D["max-fraction-digits"]&&(oe=m.parse(D["max-fraction-digits"],1,We),!oe)?null:new Al(S,U,$,X,oe)}evaluate(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))}eachChild(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)}outputDefined(){return!1}}class kl{constructor(o){this.type=_i,this.sections=o}static parse(o,m){if(o.length<2)return m.error("Expected at least one argument.");const S=o[1];if(!Array.isArray(S)&&typeof S=="object")return m.error("First argument must be an image or text section.");const D=[];let U=!1;for(let $=1;$<=o.length-1;++$){const X=o[$];if(U&&typeof X=="object"&&!Array.isArray(X)){U=!1;let oe=null;if(X["font-scale"]&&(oe=m.parse(X["font-scale"],1,We),!oe))return null;let fe=null;if(X["text-font"]&&(fe=m.parse(X["text-font"],1,Qi(pt)),!fe))return null;let ve=null;if(X["text-color"]&&(ve=m.parse(X["text-color"],1,Dt),!ve))return null;let Ce=null;if(X["vertical-align"]){if(typeof X["vertical-align"]=="string"&&!qd.includes(X["vertical-align"]))return m.error(`'vertical-align' must be one of: 'bottom', 'center', 'top' but found '${X["vertical-align"]}' instead.`);if(Ce=m.parse(X["vertical-align"],1,pt),!Ce)return null}const Be=D[D.length-1];Be.scale=oe,Be.font=fe,Be.textColor=ve,Be.verticalAlign=Ce}else{const oe=m.parse(o[$],1,Gt);if(!oe)return null;const fe=oe.type.kind;if(fe!=="string"&&fe!=="value"&&fe!=="null"&&fe!=="resolvedImage")return m.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");U=!0,D.push({content:oe,scale:null,font:null,textColor:null,verticalAlign:null})}}return new kl(D)}evaluate(o){return new $a(this.sections.map(m=>{const S=m.content.evaluate(o);return os(S)===Ui?new au("",S,null,null,null,m.verticalAlign?m.verticalAlign.evaluate(o):null):new au(ir(S),null,m.scale?m.scale.evaluate(o):null,m.font?m.font.evaluate(o).join(","):null,m.textColor?m.textColor.evaluate(o):null,m.verticalAlign?m.verticalAlign.evaluate(o):null)}))}eachChild(o){for(const m of this.sections)o(m.content),m.scale&&o(m.scale),m.font&&o(m.font),m.textColor&&o(m.textColor),m.verticalAlign&&o(m.verticalAlign)}outputDefined(){return!1}}class yh{constructor(o){this.type=Ui,this.input=o}static parse(o,m){if(o.length!==2)return m.error("Expected two arguments.");const S=m.parse(o[1],1,pt);return S?new yh(S):m.error("No image name provided.")}evaluate(o){const m=this.input.evaluate(o),S=ts.fromString(m);return S&&o.availableImages&&(S.available=o.availableImages.indexOf(m)>-1),S}eachChild(o){o(this.input)}outputDefined(){return!1}}class td{constructor(o){this.type=We,this.input=o}static parse(o,m){if(o.length!==2)return m.error(`Expected 1 argument, but found ${o.length-1} instead.`);const S=m.parse(o[1],1);return S?S.type.kind!=="array"&&S.type.kind!=="string"&&S.type.kind!=="value"?m.error(`Expected argument of type string or array, but found ${Ni(S.type)} instead.`):new td(S):null}evaluate(o){const m=this.input.evaluate(o);if(typeof m=="string")return[...m].length;if(Array.isArray(m))return m.length;throw new es(`Expected value to be of type string or array, but found ${Ni(os(m))} instead.`)}eachChild(o){o(this.input)}outputDefined(){return!1}}const ps=8192;function Hf(g,o){const m=(180+g[0])/360,S=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+g[1]*Math.PI/360)))/360,D=Math.pow(2,o.z);return[Math.round(m*D*ps),Math.round(S*D*ps)]}function nd(g,o){const m=Math.pow(2,o.z);return[(D=(g[0]/ps+o.x)/m,360*D-180),(S=(g[1]/ps+o.y)/m,360/Math.PI*Math.atan(Math.exp((180-360*S)*Math.PI/180))-90)];var S,D}function id(g,o){g[0]=Math.min(g[0],o[0]),g[1]=Math.min(g[1],o[1]),g[2]=Math.max(g[2],o[0]),g[3]=Math.max(g[3],o[1])}function hu(g,o){return!(g[0]<=o[0]||g[2]>=o[2]||g[1]<=o[1]||g[3]>=o[3])}function Zf(g,o,m){const S=g[0]-o[0],D=g[1]-o[1],U=g[0]-m[0],$=g[1]-m[1];return S*$-U*D==0&&S*U<=0&&D*$<=0}function Wf(g,o,m,S){return(D=[S[0]-m[0],S[1]-m[1]])[0]*(U=[o[0]-g[0],o[1]-g[1]])[1]-D[1]*U[0]!=0&&!(!Wd(g,o,m,S)||!Wd(m,S,g,o));var D,U}function rd(g,o,m){for(const S of m)for(let D=0;D<S.length-1;++D)if(Wf(g,o,S[D],S[D+1]))return!0;return!1}function gc(g,o,m=!1){let S=!1;for(const X of o)for(let oe=0;oe<X.length-1;oe++){if(Zf(g,X[oe],X[oe+1]))return m;(U=X[oe])[1]>(D=g)[1]!=($=X[oe+1])[1]>D[1]&&D[0]<($[0]-U[0])*(D[1]-U[1])/($[1]-U[1])+U[0]&&(S=!S)}var D,U,$;return S}function Bm(g,o){for(const m of o)if(gc(g,m))return!0;return!1}function Dl(g,o){for(const m of g)if(!gc(m,o))return!1;for(let m=0;m<g.length-1;++m)if(rd(g[m],g[m+1],o))return!1;return!0}function Vm(g,o){for(const m of o)if(Dl(g,m))return!0;return!1}function Wd(g,o,m,S){const D=S[0]-m[0],U=S[1]-m[1],$=(g[0]-m[0])*U-D*(g[1]-m[1]),X=(o[0]-m[0])*U-D*(o[1]-m[1]);return $>0&&X<0||$<0&&X>0}function Yl(g,o,m){const S=[];for(let D=0;D<g.length;D++){const U=[];for(let $=0;$<g[D].length;$++){const X=Hf(g[D][$],m);id(o,X),U.push(X)}S.push(U)}return S}function Nm(g,o,m){const S=[];for(let D=0;D<g.length;D++){const U=Yl(g[D],o,m);S.push(U)}return S}function jm(g,o,m,S){if(g[0]<m[0]||g[0]>m[2]){const D=.5*S;let U=g[0]-m[0]>D?-S:m[0]-g[0]>D?S:0;U===0&&(U=g[0]-m[2]>D?-S:m[2]-g[0]>D?S:0),g[0]+=U}id(o,g)}function Yp(g,o,m,S){const D=Math.pow(2,S.z)*ps,U=[S.x*ps,S.y*ps],$=[];for(const X of g)for(const oe of X){const fe=[oe.x+U[0],oe.y+U[1]];jm(fe,o,m,D),$.push(fe)}return $}function Xf(g,o,m,S){const D=Math.pow(2,S.z)*ps,U=[S.x*ps,S.y*ps],$=[];for(const oe of g){const fe=[];for(const ve of oe){const Ce=[ve.x+U[0],ve.y+U[1]];id(o,Ce),fe.push(Ce)}$.push(fe)}if(o[2]-o[0]<=D/2){(X=o)[0]=X[1]=1/0,X[2]=X[3]=-1/0;for(const oe of $)for(const fe of oe)jm(fe,o,m,D)}var X;return $}class Rl{constructor(o,m){this.type=kt,this.geojson=o,this.geometries=m}static parse(o,m){if(o.length!==2)return m.error(`'within' expression requires exactly one argument, but found ${o.length-1} instead.`);if(Or(o[1])){const S=o[1];if(S.type==="FeatureCollection"){const D=[];for(const U of S.features){const{type:$,coordinates:X}=U.geometry;$==="Polygon"&&D.push(X),$==="MultiPolygon"&&D.push(...X)}if(D.length)return new Rl(S,{type:"MultiPolygon",coordinates:D})}else if(S.type==="Feature"){const D=S.geometry.type;if(D==="Polygon"||D==="MultiPolygon")return new Rl(S,S.geometry)}else if(S.type==="Polygon"||S.type==="MultiPolygon")return new Rl(S,S)}return m.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(o.geometry()!=null&&o.canonicalID()!=null){if(o.geometryType()==="Point")return function(m,S){const D=[1/0,1/0,-1/0,-1/0],U=[1/0,1/0,-1/0,-1/0],$=m.canonicalID();if(S.type==="Polygon"){const X=Yl(S.coordinates,U,$),oe=Yp(m.geometry(),D,U,$);if(!hu(D,U))return!1;for(const fe of oe)if(!gc(fe,X))return!1}if(S.type==="MultiPolygon"){const X=Nm(S.coordinates,U,$),oe=Yp(m.geometry(),D,U,$);if(!hu(D,U))return!1;for(const fe of oe)if(!Bm(fe,X))return!1}return!0}(o,this.geometries);if(o.geometryType()==="LineString")return function(m,S){const D=[1/0,1/0,-1/0,-1/0],U=[1/0,1/0,-1/0,-1/0],$=m.canonicalID();if(S.type==="Polygon"){const X=Yl(S.coordinates,U,$),oe=Xf(m.geometry(),D,U,$);if(!hu(D,U))return!1;for(const fe of oe)if(!Dl(fe,X))return!1}if(S.type==="MultiPolygon"){const X=Nm(S.coordinates,U,$),oe=Xf(m.geometry(),D,U,$);if(!hu(D,U))return!1;for(const fe of oe)if(!Vm(fe,X))return!1}return!0}(o,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let Tr=class{constructor(g=[],o=(m,S)=>m<S?-1:m>S?1:0){if(this.data=g,this.length=this.data.length,this.compare=o,this.length>0)for(let m=(this.length>>1)-1;m>=0;m--)this._down(m)}push(g){this.data.push(g),this._up(this.length++)}pop(){if(this.length===0)return;const g=this.data[0],o=this.data.pop();return--this.length>0&&(this.data[0]=o,this._down(0)),g}peek(){return this.data[0]}_up(g){const{data:o,compare:m}=this,S=o[g];for(;g>0;){const D=g-1>>1,U=o[D];if(m(S,U)>=0)break;o[g]=U,g=D}o[g]=S}_down(g){const{data:o,compare:m}=this,S=this.length>>1,D=o[g];for(;g<S;){let U=1+(g<<1);const $=U+1;if($<this.length&&m(o[$],o[U])<0&&(U=$),m(o[U],D)>=0)break;o[g]=o[U],g=U}o[g]=D}};function Zi(g,o,m=0,S=g.length-1,D=lr){for(;S>m;){if(S-m>600){const oe=S-m+1,fe=o-m+1,ve=Math.log(oe),Ce=.5*Math.exp(2*ve/3),Be=.5*Math.sqrt(ve*Ce*(oe-Ce)/oe)*(fe-oe/2<0?-1:1);Zi(g,o,Math.max(m,Math.floor(o-fe*Ce/oe+Be)),Math.min(S,Math.floor(o+(oe-fe)*Ce/oe+Be)),D)}const U=g[o];let $=m,X=S;for(Uu(g,m,o),D(g[S],U)>0&&Uu(g,m,S);$<X;){for(Uu(g,$,X),$++,X--;D(g[$],U)<0;)$++;for(;D(g[X],U)>0;)X--}D(g[m],U)===0?Uu(g,m,X):(X++,Uu(g,X,S)),X<=o&&(m=X+1),o<=X&&(S=X-1)}}function Uu(g,o,m){const S=g[o];g[o]=g[m],g[m]=S}function lr(g,o){return g<o?-1:g>o?1:0}function vh(g,o){if(g.length<=1)return[g];const m=[];let S,D;for(const U of g){const $=or(U);$!==0&&(U.area=Math.abs($),D===void 0&&(D=$<0),D===$<0?(S&&m.push(S),S=[U]):S.push(U))}if(S&&m.push(S),o>1)for(let U=0;U<m.length;U++)m[U].length<=o||(Zi(m[U],o,1,m[U].length-1,du),m[U]=m[U].slice(0,o));return m}function du(g,o){return o.area-g.area}function or(g){let o=0;for(let m,S,D=0,U=g.length,$=U-1;D<U;$=D++)m=g[D],S=g[$],o+=(S.x-m.x)*(m.y+S.y);return o}const Xd=1/298.257223563,ad=Xd*(2-Xd),xh=Math.PI/180;class $u{constructor(o){const m=6378.137*xh*1e3,S=Math.cos(o*xh),D=1/(1-ad*(1-S*S)),U=Math.sqrt(D);this.kx=m*U*S,this.ky=m*U*D*(1-ad)}distance(o,m){const S=this.wrap(o[0]-m[0])*this.kx,D=(o[1]-m[1])*this.ky;return Math.sqrt(S*S+D*D)}pointOnLine(o,m){let S,D,U,$,X=1/0;for(let oe=0;oe<o.length-1;oe++){let fe=o[oe][0],ve=o[oe][1],Ce=this.wrap(o[oe+1][0]-fe)*this.kx,Be=(o[oe+1][1]-ve)*this.ky,je=0;Ce===0&&Be===0||(je=(this.wrap(m[0]-fe)*this.kx*Ce+(m[1]-ve)*this.ky*Be)/(Ce*Ce+Be*Be),je>1?(fe=o[oe+1][0],ve=o[oe+1][1]):je>0&&(fe+=Ce/this.kx*je,ve+=Be/this.ky*je)),Ce=this.wrap(m[0]-fe)*this.kx,Be=(m[1]-ve)*this.ky;const Ge=Ce*Ce+Be*Be;Ge<X&&(X=Ge,S=fe,D=ve,U=oe,$=je)}return{point:[S,D],index:U,t:Math.max(0,Math.min(1,$))}}wrap(o){for(;o<-180;)o+=360;for(;o>180;)o-=360;return o}}function bh(g,o){return o[0]-g[0]}function Ds(g){return g[1]-g[0]+1}function Rs(g,o){return g[1]>=g[0]&&g[1]<o}function sd(g,o){if(g[0]>g[1])return[null,null];const m=Ds(g);if(o){if(m===2)return[g,null];const D=Math.floor(m/2);return[[g[0],g[0]+D],[g[0]+D,g[1]]]}if(m===1)return[g,null];const S=Math.floor(m/2)-1;return[[g[0],g[0]+S],[g[0]+S+1,g[1]]]}function mi(g,o){if(!Rs(o,g.length))return[1/0,1/0,-1/0,-1/0];const m=[1/0,1/0,-1/0,-1/0];for(let S=o[0];S<=o[1];++S)id(m,g[S]);return m}function wh(g){const o=[1/0,1/0,-1/0,-1/0];for(const m of g)for(const S of m)id(o,S);return o}function Oc(g){return g[0]!==-1/0&&g[1]!==-1/0&&g[2]!==1/0&&g[3]!==1/0}function Zs(g,o,m){if(!Oc(g)||!Oc(o))return NaN;let S=0,D=0;return g[2]<o[0]&&(S=o[0]-g[2]),g[0]>o[2]&&(S=g[0]-o[2]),g[1]>o[3]&&(D=g[1]-o[3]),g[3]<o[1]&&(D=o[1]-g[3]),m.distance([0,0],[S,D])}function Gu(g,o,m){const S=m.pointOnLine(o,g);return m.distance(g,S.point)}function od(g,o,m,S,D){const U=Math.min(Gu(g,[m,S],D),Gu(o,[m,S],D)),$=Math.min(Gu(m,[g,o],D),Gu(S,[g,o],D));return Math.min(U,$)}function oa(g,o,m,S,D){if(!Rs(o,g.length)||!Rs(S,m.length))return 1/0;let U=1/0;for(let $=o[0];$<o[1];++$){const X=g[$],oe=g[$+1];for(let fe=S[0];fe<S[1];++fe){const ve=m[fe],Ce=m[fe+1];if(Wf(X,oe,ve,Ce))return 0;U=Math.min(U,od(X,oe,ve,Ce,D))}}return U}function ld(g,o,m,S,D){if(!Rs(o,g.length)||!Rs(S,m.length))return NaN;let U=1/0;for(let $=o[0];$<=o[1];++$)for(let X=S[0];X<=S[1];++X)if(U=Math.min(U,D.distance(g[$],m[X])),U===0)return U;return U}function qu(g,o,m){if(gc(g,o,!0))return 0;let S=1/0;for(const D of o){const U=D[0],$=D[D.length-1];if(U!==$&&(S=Math.min(S,Gu(g,[$,U],m)),S===0))return S;const X=m.pointOnLine(D,g);if(S=Math.min(S,m.distance(g,X.point)),S===0)return S}return S}function cd(g,o,m,S){if(!Rs(o,g.length))return NaN;for(let U=o[0];U<=o[1];++U)if(gc(g[U],m,!0))return 0;let D=1/0;for(let U=o[0];U<o[1];++U){const $=g[U],X=g[U+1];for(const oe of m)for(let fe=0,ve=oe.length,Ce=ve-1;fe<ve;Ce=fe++){const Be=oe[Ce],je=oe[fe];if(Wf($,X,Be,je))return 0;D=Math.min(D,od($,X,Be,je,S))}}return D}function Sh(g,o){for(const m of g)for(const S of m)if(gc(S,o,!0))return!0;return!1}function Ng(g,o,m,S=1/0){const D=wh(g),U=wh(o);if(S!==1/0&&Zs(D,U,m)>=S)return S;if(hu(D,U)){if(Sh(g,o))return 0}else if(Sh(o,g))return 0;let $=1/0;for(const X of g)for(let oe=0,fe=X.length,ve=fe-1;oe<fe;ve=oe++){const Ce=X[ve],Be=X[oe];for(const je of o)for(let Ge=0,lt=je.length,Tt=lt-1;Ge<lt;Tt=Ge++){const Ot=je[Tt],ln=je[Ge];if(Wf(Ce,Be,Ot,ln))return 0;$=Math.min($,od(Ce,Be,Ot,ln,m))}}return $}function Um(g,o,m,S,D,U){if(!U)return;const $=Zs(mi(S,U),D,m);$<o&&g.push([$,U,[0,0]])}function ud(g,o,m,S,D,U,$){if(!U||!$)return;const X=Zs(mi(S,U),mi(D,$),m);X<o&&g.push([X,U,$])}function Yd(g,o,m,S,D=1/0){let U=Math.min(S.distance(g[0],m[0][0]),D);if(U===0)return U;const $=new Tr([[0,[0,g.length-1],[0,0]]],bh),X=wh(m);for(;$.length>0;){const oe=$.pop();if(oe[0]>=U)continue;const fe=oe[1],ve=o?50:100;if(Ds(fe)<=ve){if(!Rs(fe,g.length))return NaN;if(o){const Ce=cd(g,fe,m,S);if(isNaN(Ce)||Ce===0)return Ce;U=Math.min(U,Ce)}else for(let Ce=fe[0];Ce<=fe[1];++Ce){const Be=qu(g[Ce],m,S);if(U=Math.min(U,Be),U===0)return 0}}else{const Ce=sd(fe,o);Um($,U,S,g,X,Ce[0]),Um($,U,S,g,X,Ce[1])}}return U}function Kd(g,o,m,S,D,U=1/0){let $=Math.min(U,D.distance(g[0],m[0]));if($===0)return $;const X=new Tr([[0,[0,g.length-1],[0,m.length-1]]],bh);for(;X.length>0;){const oe=X.pop();if(oe[0]>=$)continue;const fe=oe[1],ve=oe[2],Ce=o?50:100,Be=S?50:100;if(Ds(fe)<=Ce&&Ds(ve)<=Be){if(!Rs(fe,g.length)&&Rs(ve,m.length))return NaN;let je;if(o&&S)je=oa(g,fe,m,ve,D),$=Math.min($,je);else if(o&&!S){const Ge=g.slice(fe[0],fe[1]+1);for(let lt=ve[0];lt<=ve[1];++lt)if(je=Gu(m[lt],Ge,D),$=Math.min($,je),$===0)return $}else if(!o&&S){const Ge=m.slice(ve[0],ve[1]+1);for(let lt=fe[0];lt<=fe[1];++lt)if(je=Gu(g[lt],Ge,D),$=Math.min($,je),$===0)return $}else je=ld(g,fe,m,ve,D),$=Math.min($,je)}else{const je=sd(fe,o),Ge=sd(ve,S);ud(X,$,D,g,m,je[0],Ge[0]),ud(X,$,D,g,m,je[0],Ge[1]),ud(X,$,D,g,m,je[1],Ge[0]),ud(X,$,D,g,m,je[1],Ge[1])}}return $}function Yf(g){return g.type==="MultiPolygon"?g.coordinates.map(o=>({type:"Polygon",coordinates:o})):g.type==="MultiLineString"?g.coordinates.map(o=>({type:"LineString",coordinates:o})):g.type==="MultiPoint"?g.coordinates.map(o=>({type:"Point",coordinates:o})):[g]}class Fc{constructor(o,m){this.type=We,this.geojson=o,this.geometries=m}static parse(o,m){if(o.length!==2)return m.error(`'distance' expression requires exactly one argument, but found ${o.length-1} instead.`);if(Or(o[1])){const S=o[1];if(S.type==="FeatureCollection")return new Fc(S,S.features.map(D=>Yf(D.geometry)).flat());if(S.type==="Feature")return new Fc(S,Yf(S.geometry));if("type"in S&&"coordinates"in S)return new Fc(S,Yf(S))}return m.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(o){if(o.geometry()!=null&&o.canonicalID()!=null){if(o.geometryType()==="Point")return function(m,S){const D=m.geometry(),U=D.flat().map(oe=>nd([oe.x,oe.y],m.canonical));if(D.length===0)return NaN;const $=new $u(U[0][1]);let X=1/0;for(const oe of S){switch(oe.type){case"Point":X=Math.min(X,Kd(U,!1,[oe.coordinates],!1,$,X));break;case"LineString":X=Math.min(X,Kd(U,!1,oe.coordinates,!0,$,X));break;case"Polygon":X=Math.min(X,Yd(U,!1,oe.coordinates,$,X))}if(X===0)return X}return X}(o,this.geometries);if(o.geometryType()==="LineString")return function(m,S){const D=m.geometry(),U=D.flat().map(oe=>nd([oe.x,oe.y],m.canonical));if(D.length===0)return NaN;const $=new $u(U[0][1]);let X=1/0;for(const oe of S){switch(oe.type){case"Point":X=Math.min(X,Kd(U,!0,[oe.coordinates],!1,$,X));break;case"LineString":X=Math.min(X,Kd(U,!0,oe.coordinates,!0,$,X));break;case"Polygon":X=Math.min(X,Yd(U,!0,oe.coordinates,$,X))}if(X===0)return X}return X}(o,this.geometries);if(o.geometryType()==="Polygon")return function(m,S){const D=m.geometry();if(D.length===0||D[0].length===0)return NaN;const U=vh(D,0).map(oe=>oe.map(fe=>fe.map(ve=>nd([ve.x,ve.y],m.canonical)))),$=new $u(U[0][0][0][1]);let X=1/0;for(const oe of S)for(const fe of U){switch(oe.type){case"Point":X=Math.min(X,Yd([oe.coordinates],!1,fe,$,X));break;case"LineString":X=Math.min(X,Yd(oe.coordinates,!0,fe,$,X));break;case"Polygon":X=Math.min(X,Ng(fe,oe.coordinates,$,X))}if(X===0)return X}return X}(o,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const Kl={"==":Il,"!=":ws,">":pl,"<":ju,">=":uu,"<=":cu,array:Qo,at:pc,boolean:Qo,case:mc,coalesce:Ml,collator:Pl,format:kl,image:yh,in:Hi,"index-of":ou,interpolate:Yr,"interpolate-hcl":Yr,"interpolate-lab":Yr,length:td,let:Wi,literal:Xl,match:io,number:Qo,"number-format":Al,object:Qo,slice:Ns,step:Vu,string:Qo,"to-boolean":fc,"to-color":fc,"to-number":fc,"to-string":fc,var:Sr,within:Rl,distance:Fc};class Jl{constructor(o,m,S,D){this.name=o,this.type=m,this._evaluate=S,this.args=D}evaluate(o){return this._evaluate(o,this.args)}eachChild(o){this.args.forEach(o)}outputDefined(){return!1}static parse(o,m){const S=o[0],D=Jl.definitions[S];if(!D)return m.error(`Unknown expression "${S}". If you wanted a literal array, use ["literal", [...]].`,0);const U=Array.isArray(D)?D[0]:D.type,$=Array.isArray(D)?[[D[1],D[2]]]:D.overloads,X=$.filter(([fe])=>!Array.isArray(fe)||fe.length===o.length-1);let oe=null;for(const[fe,ve]of X){oe=new jr(m.registry,Do,m.path,null,m.scope);const Ce=[];let Be=!1;for(let je=1;je<o.length;je++){const Ge=o[je],lt=Array.isArray(fe)?fe[je-1]:fe.type,Tt=oe.parse(Ge,1+Ce.length,lt);if(!Tt){Be=!0;break}Ce.push(Tt)}if(!Be)if(Array.isArray(fe)&&fe.length!==Ce.length)oe.error(`Expected ${fe.length} arguments, but found ${Ce.length} instead.`);else{for(let je=0;je<Ce.length;je++){const Ge=Array.isArray(fe)?fe[je]:fe.type,lt=Ce[je];oe.concat(je+1).checkSubtype(Ge,lt.type)}if(oe.errors.length===0)return new Jl(S,U,ve,Ce)}}if(X.length===1)m.errors.push(...oe.errors);else{const fe=(X.length?X:$).map(([Ce])=>{return Be=Ce,Array.isArray(Be)?`(${Be.map(Ni).join(", ")})`:`(${Ni(Be.type)}...)`;var Be}).join(" | "),ve=[];for(let Ce=1;Ce<o.length;Ce++){const Be=m.parse(o[Ce],1+ve.length);if(!Be)return null;ve.push(Ni(Be.type))}m.error(`Expected arguments of type ${fe}, but found (${ve.join(", ")}) instead.`)}return null}static register(o,m){Jl.definitions=m;for(const S in m)o[S]=Jl}}function $m(g,[o,m,S,D]){o=o.evaluate(g),m=m.evaluate(g),S=S.evaluate(g);const U=D?D.evaluate(g):1,$=Jh(o,m,S,U);if($)throw new es($);return new Br(o/255,m/255,S/255,U,!1)}function Kf(g,o){return g in o}function Jd(g,o){const m=o[g];return m===void 0?null:m}function Hu(g){return{type:g}}function Do(g){if(g instanceof Sr)return Do(g.boundExpression);if(g instanceof Jl&&g.name==="error"||g instanceof Pl||g instanceof Rl||g instanceof Fc)return!1;const o=g instanceof fc||g instanceof Qo;let m=!0;return g.eachChild(S=>{m=o?m&&Do(S):m&&S instanceof Xl}),!!m&&Qd(g)&&Ch(g,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Qd(g){if(g instanceof Jl&&(g.name==="get"&&g.args.length===1||g.name==="feature-state"||g.name==="has"&&g.args.length===1||g.name==="properties"||g.name==="geometry-type"||g.name==="id"||/^filter-/.test(g.name))||g instanceof Rl||g instanceof Fc)return!1;let o=!0;return g.eachChild(m=>{o&&!Qd(m)&&(o=!1)}),o}function Th(g){if(g instanceof Jl&&g.name==="feature-state")return!1;let o=!0;return g.eachChild(m=>{o&&!Th(m)&&(o=!1)}),o}function Ch(g,o){if(g instanceof Jl&&o.indexOf(g.name)>=0)return!1;let m=!0;return g.eachChild(S=>{m&&!Ch(S,o)&&(m=!1)}),m}function hd(g){return{result:"success",value:g}}function fu(g){return{result:"error",value:g}}function Ll(g){return g["property-type"]==="data-driven"||g["property-type"]==="cross-faded-data-driven"}function ef(g){return!!g.expression&&g.expression.parameters.indexOf("zoom")>-1}function tf(g){return!!g.expression&&g.expression.interpolated}function aa(g){return g instanceof Number?"number":g instanceof String?"string":g instanceof Boolean?"boolean":Array.isArray(g)?"array":g===null?"null":typeof g}function pu(g){return typeof g=="object"&&g!==null&&!Array.isArray(g)}function nf(g){return g}function Zu(g,o){const m=o.type==="color",S=g.stops&&typeof g.stops[0][0]=="object",D=S||!(S||g.property!==void 0),U=g.type||(tf(o)?"exponential":"interval");if(m||o.type==="padding"){const ve=m?Br.parse:ss.parse;(g=we({},g)).stops&&(g.stops=g.stops.map(Ce=>[Ce[0],ve(Ce[1])])),g.default=ve(g.default?g.default:o.default)}if(g.colorSpace&&($=g.colorSpace)!=="rgb"&&$!=="hcl"&&$!=="lab")throw new Error(`Unknown color space: "${g.colorSpace}"`);var $;let X,oe,fe;if(U==="exponential")X=Qf;else if(U==="interval")X=Jf;else if(U==="categorical"){X=mu,oe=Object.create(null);for(const ve of g.stops)oe[ve[0]]=ve[1];fe=typeof g.stops[0][0]}else{if(U!=="identity")throw new Error(`Unknown function type "${U}"`);X=ep}if(S){const ve={},Ce=[];for(let Ge=0;Ge<g.stops.length;Ge++){const lt=g.stops[Ge],Tt=lt[0].zoom;ve[Tt]===void 0&&(ve[Tt]={zoom:Tt,type:g.type,property:g.property,default:g.default,stops:[]},Ce.push(Tt)),ve[Tt].stops.push([lt[0].value,lt[1]])}const Be=[];for(const Ge of Ce)Be.push([ve[Ge].zoom,Zu(ve[Ge],o)]);const je={name:"linear"};return{kind:"composite",interpolationType:je,interpolationFactor:Yr.interpolationFactor.bind(void 0,je),zoomStops:Be.map(Ge=>Ge[0]),evaluate:({zoom:Ge},lt)=>Qf({stops:Be,base:g.base},o,Ge).evaluate(Ge,lt)}}if(D){const ve=U==="exponential"?{name:"exponential",base:g.base!==void 0?g.base:1}:null;return{kind:"camera",interpolationType:ve,interpolationFactor:Yr.interpolationFactor.bind(void 0,ve),zoomStops:g.stops.map(Ce=>Ce[0]),evaluate:({zoom:Ce})=>X(g,o,Ce,oe,fe)}}return{kind:"source",evaluate(ve,Ce){const Be=Ce&&Ce.properties?Ce.properties[g.property]:void 0;return Be===void 0?zl(g.default,o.default):X(g,o,Be,oe,fe)}}}function zl(g,o,m){return g!==void 0?g:o!==void 0?o:m!==void 0?m:void 0}function mu(g,o,m,S,D){return zl(typeof m===D?S[m]:void 0,g.default,o.default)}function Jf(g,o,m){if(aa(m)!=="number")return zl(g.default,o.default);const S=g.stops.length;if(S===1||m<=g.stops[0][0])return g.stops[0][1];if(m>=g.stops[S-1][0])return g.stops[S-1][1];const D=ca(g.stops.map(U=>U[0]),m);return g.stops[D][1]}function Qf(g,o,m){const S=g.base!==void 0?g.base:1;if(aa(m)!=="number")return zl(g.default,o.default);const D=g.stops.length;if(D===1||m<=g.stops[0][0])return g.stops[0][1];if(m>=g.stops[D-1][0])return g.stops[D-1][1];const U=ca(g.stops.map(ve=>ve[0]),m),$=function(ve,Ce,Be,je){const Ge=je-Be,lt=ve-Be;return Ge===0?0:Ce===1?lt/Ge:(Math.pow(Ce,lt)-1)/(Math.pow(Ce,Ge)-1)}(m,S,g.stops[U][0],g.stops[U+1][0]),X=g.stops[U][1],oe=g.stops[U+1][1],fe=Oa[o.type]||nf;return typeof X.evaluate=="function"?{evaluate(...ve){const Ce=X.evaluate.apply(void 0,ve),Be=oe.evaluate.apply(void 0,ve);if(Ce!==void 0&&Be!==void 0)return fe(Ce,Be,$,g.colorSpace)}}:fe(X,oe,$,g.colorSpace)}function ep(g,o,m){switch(o.type){case"color":m=Br.parse(m);break;case"formatted":m=$a.fromString(m.toString());break;case"resolvedImage":m=ts.fromString(m.toString());break;case"padding":m=ss.parse(m);break;default:aa(m)===o.type||o.type==="enum"&&o.values[m]||(m=void 0)}return zl(m,g.default,o.default)}Jl.register(Kl,{error:[{kind:"error"},[pt],(g,[o])=>{throw new es(o.evaluate(g))}],typeof:[pt,[Gt],(g,[o])=>Ni(os(o.evaluate(g)))],"to-rgba":[Qi(We,4),[Dt],(g,[o])=>{const[m,S,D,U]=o.evaluate(g).rgb;return[255*m,255*S,255*D,U]}],rgb:[Dt,[We,We,We],$m],rgba:[Dt,[We,We,We,We],$m],has:{type:kt,overloads:[[[pt],(g,[o])=>Kf(o.evaluate(g),g.properties())],[[pt,Xt],(g,[o,m])=>Kf(o.evaluate(g),m.evaluate(g))]]},get:{type:Gt,overloads:[[[pt],(g,[o])=>Jd(o.evaluate(g),g.properties())],[[pt,Xt],(g,[o,m])=>Jd(o.evaluate(g),m.evaluate(g))]]},"feature-state":[Gt,[pt],(g,[o])=>Jd(o.evaluate(g),g.featureState||{})],properties:[Xt,[],g=>g.properties()],"geometry-type":[pt,[],g=>g.geometryType()],id:[Gt,[],g=>g.id()],zoom:[We,[],g=>g.globals.zoom],"heatmap-density":[We,[],g=>g.globals.heatmapDensity||0],"line-progress":[We,[],g=>g.globals.lineProgress||0],accumulated:[Gt,[],g=>g.globals.accumulated===void 0?null:g.globals.accumulated],"+":[We,Hu(We),(g,o)=>{let m=0;for(const S of o)m+=S.evaluate(g);return m}],"*":[We,Hu(We),(g,o)=>{let m=1;for(const S of o)m*=S.evaluate(g);return m}],"-":{type:We,overloads:[[[We,We],(g,[o,m])=>o.evaluate(g)-m.evaluate(g)],[[We],(g,[o])=>-o.evaluate(g)]]},"/":[We,[We,We],(g,[o,m])=>o.evaluate(g)/m.evaluate(g)],"%":[We,[We,We],(g,[o,m])=>o.evaluate(g)%m.evaluate(g)],ln2:[We,[],()=>Math.LN2],pi:[We,[],()=>Math.PI],e:[We,[],()=>Math.E],"^":[We,[We,We],(g,[o,m])=>Math.pow(o.evaluate(g),m.evaluate(g))],sqrt:[We,[We],(g,[o])=>Math.sqrt(o.evaluate(g))],log10:[We,[We],(g,[o])=>Math.log(o.evaluate(g))/Math.LN10],ln:[We,[We],(g,[o])=>Math.log(o.evaluate(g))],log2:[We,[We],(g,[o])=>Math.log(o.evaluate(g))/Math.LN2],sin:[We,[We],(g,[o])=>Math.sin(o.evaluate(g))],cos:[We,[We],(g,[o])=>Math.cos(o.evaluate(g))],tan:[We,[We],(g,[o])=>Math.tan(o.evaluate(g))],asin:[We,[We],(g,[o])=>Math.asin(o.evaluate(g))],acos:[We,[We],(g,[o])=>Math.acos(o.evaluate(g))],atan:[We,[We],(g,[o])=>Math.atan(o.evaluate(g))],min:[We,Hu(We),(g,o)=>Math.min(...o.map(m=>m.evaluate(g)))],max:[We,Hu(We),(g,o)=>Math.max(...o.map(m=>m.evaluate(g)))],abs:[We,[We],(g,[o])=>Math.abs(o.evaluate(g))],round:[We,[We],(g,[o])=>{const m=o.evaluate(g);return m<0?-Math.round(-m):Math.round(m)}],floor:[We,[We],(g,[o])=>Math.floor(o.evaluate(g))],ceil:[We,[We],(g,[o])=>Math.ceil(o.evaluate(g))],"filter-==":[kt,[pt,Gt],(g,[o,m])=>g.properties()[o.value]===m.value],"filter-id-==":[kt,[Gt],(g,[o])=>g.id()===o.value],"filter-type-==":[kt,[pt],(g,[o])=>g.geometryType()===o.value],"filter-<":[kt,[pt,Gt],(g,[o,m])=>{const S=g.properties()[o.value],D=m.value;return typeof S==typeof D&&S<D}],"filter-id-<":[kt,[Gt],(g,[o])=>{const m=g.id(),S=o.value;return typeof m==typeof S&&m<S}],"filter->":[kt,[pt,Gt],(g,[o,m])=>{const S=g.properties()[o.value],D=m.value;return typeof S==typeof D&&S>D}],"filter-id->":[kt,[Gt],(g,[o])=>{const m=g.id(),S=o.value;return typeof m==typeof S&&m>S}],"filter-<=":[kt,[pt,Gt],(g,[o,m])=>{const S=g.properties()[o.value],D=m.value;return typeof S==typeof D&&S<=D}],"filter-id-<=":[kt,[Gt],(g,[o])=>{const m=g.id(),S=o.value;return typeof m==typeof S&&m<=S}],"filter->=":[kt,[pt,Gt],(g,[o,m])=>{const S=g.properties()[o.value],D=m.value;return typeof S==typeof D&&S>=D}],"filter-id->=":[kt,[Gt],(g,[o])=>{const m=g.id(),S=o.value;return typeof m==typeof S&&m>=S}],"filter-has":[kt,[Gt],(g,[o])=>o.value in g.properties()],"filter-has-id":[kt,[],g=>g.id()!==null&&g.id()!==void 0],"filter-type-in":[kt,[Qi(pt)],(g,[o])=>o.value.indexOf(g.geometryType())>=0],"filter-id-in":[kt,[Qi(Gt)],(g,[o])=>o.value.indexOf(g.id())>=0],"filter-in-small":[kt,[pt,Qi(Gt)],(g,[o,m])=>m.value.indexOf(g.properties()[o.value])>=0],"filter-in-large":[kt,[pt,Qi(Gt)],(g,[o,m])=>function(S,D,U,$){for(;U<=$;){const X=U+$>>1;if(D[X]===S)return!0;D[X]>S?$=X-1:U=X+1}return!1}(g.properties()[o.value],m.value,0,m.value.length-1)],all:{type:kt,overloads:[[[kt,kt],(g,[o,m])=>o.evaluate(g)&&m.evaluate(g)],[Hu(kt),(g,o)=>{for(const m of o)if(!m.evaluate(g))return!1;return!0}]]},any:{type:kt,overloads:[[[kt,kt],(g,[o,m])=>o.evaluate(g)||m.evaluate(g)],[Hu(kt),(g,o)=>{for(const m of o)if(m.evaluate(g))return!0;return!1}]]},"!":[kt,[kt],(g,[o])=>!o.evaluate(g)],"is-supported-script":[kt,[pt],(g,[o])=>{const m=g.globals&&g.globals.isSupportedScript;return!m||m(o.evaluate(g))}],upcase:[pt,[pt],(g,[o])=>o.evaluate(g).toUpperCase()],downcase:[pt,[pt],(g,[o])=>o.evaluate(g).toLowerCase()],concat:[pt,Hu(Gt),(g,o)=>o.map(m=>ir(m.evaluate(g))).join("")],"resolved-locale":[pt,[On],(g,[o])=>o.evaluate(g).resolvedLocale()]});class Ql{constructor(o,m){var S;this.expression=o,this._warningHistory={},this._evaluator=new hi,this._defaultValue=m?(S=m).type==="color"&&pu(S.default)?new Br(0,0,0,0):S.type==="color"?Br.parse(S.default)||null:S.type==="padding"?ss.parse(S.default)||null:S.type==="variableAnchorOffsetCollection"?Vs.parse(S.default)||null:S.type==="projectionDefinition"?no.parse(S.default)||null:S.default===void 0?null:S.default:null,this._enumValues=m&&m.type==="enum"?m.values:null}evaluateWithoutErrorHandling(o,m,S,D,U,$){return this._evaluator.globals=o,this._evaluator.feature=m,this._evaluator.featureState=S,this._evaluator.canonical=D,this._evaluator.availableImages=U||null,this._evaluator.formattedSection=$,this.expression.evaluate(this._evaluator)}evaluate(o,m,S,D,U,$){this._evaluator.globals=o,this._evaluator.feature=m||null,this._evaluator.featureState=S||null,this._evaluator.canonical=D,this._evaluator.availableImages=U||null,this._evaluator.formattedSection=$||null;try{const X=this.expression.evaluate(this._evaluator);if(X==null||typeof X=="number"&&X!=X)return this._defaultValue;if(this._enumValues&&!(X in this._enumValues))throw new es(`Expected value to be one of ${Object.keys(this._enumValues).map(oe=>JSON.stringify(oe)).join(", ")}, but found ${JSON.stringify(X)} instead.`);return X}catch(X){return this._warningHistory[X.message]||(this._warningHistory[X.message]=!0,typeof console<"u"&&console.warn(X.message)),this._defaultValue}}}function Rr(g){return Array.isArray(g)&&g.length>0&&typeof g[0]=="string"&&g[0]in Kl}function rf(g,o){const m=new jr(Kl,Do,[],o?function(D){const U={color:Dt,string:pt,number:We,enum:pt,boolean:kt,formatted:_i,padding:li,projectionDefinition:Jt,resolvedImage:Ui,variableAnchorOffsetCollection:qi};return D.type==="array"?Qi(U[D.value]||Gt,D.length):U[D.type]}(o):void 0),S=m.parse(g,void 0,void 0,void 0,o&&o.type==="string"?{typeAnnotation:"coerce"}:void 0);return S?hd(new Ql(S,o)):fu(m.errors)}class Eh{constructor(o,m){this.kind=o,this._styleExpression=m,this.isStateDependent=o!=="constant"&&!Th(m.expression)}evaluateWithoutErrorHandling(o,m,S,D,U,$){return this._styleExpression.evaluateWithoutErrorHandling(o,m,S,D,U,$)}evaluate(o,m,S,D,U,$){return this._styleExpression.evaluate(o,m,S,D,U,$)}}class af{constructor(o,m,S,D){this.kind=o,this.zoomStops=S,this._styleExpression=m,this.isStateDependent=o!=="camera"&&!Th(m.expression),this.interpolationType=D}evaluateWithoutErrorHandling(o,m,S,D,U,$){return this._styleExpression.evaluateWithoutErrorHandling(o,m,S,D,U,$)}evaluate(o,m,S,D,U,$){return this._styleExpression.evaluate(o,m,S,D,U,$)}interpolationFactor(o,m,S){return this.interpolationType?Yr.interpolationFactor(this.interpolationType,o,m,S):0}}function Wu(g,o){const m=rf(g,o);if(m.result==="error")return m;const S=m.value.expression,D=Qd(S);if(!D&&!Ll(o))return fu([new Pe("","data expressions not supported")]);const U=Ch(S,["zoom"]);if(!U&&!ef(o))return fu([new Pe("","zoom expressions not supported")]);const $=ga(S);return $||U?$ instanceof Pe?fu([$]):$ instanceof Yr&&!tf(o)?fu([new Pe("",'"interpolate" expressions cannot be used with this property')]):hd($?new af(D?"camera":"composite",m.value,$.labels,$ instanceof Yr?$.interpolation:void 0):new Eh(D?"constant":"source",m.value)):fu([new Pe("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class sf{constructor(o,m){this._parameters=o,this._specification=m,we(this,Zu(this._parameters,this._specification))}static deserialize(o){return new sf(o._parameters,o._specification)}static serialize(o){return{_parameters:o._parameters,_specification:o._specification}}}function ga(g){let o=null;if(g instanceof Wi)o=ga(g.result);else if(g instanceof Ml){for(const m of g.args)if(o=ga(m),o)break}else(g instanceof Vu||g instanceof Yr)&&g.input instanceof Jl&&g.input.name==="zoom"&&(o=g);return o instanceof Pe||g.eachChild(m=>{const S=ga(m);S instanceof Pe?o=S:!o&&S?o=new Pe("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):o&&S&&o!==S&&(o=new Pe("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),o}function Kp(g){if(g===!0||g===!1)return!0;if(!Array.isArray(g)||g.length===0)return!1;switch(g[0]){case"has":return g.length>=2&&g[1]!=="$id"&&g[1]!=="$type";case"in":return g.length>=3&&(typeof g[1]!="string"||Array.isArray(g[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return g.length!==3||Array.isArray(g[1])||Array.isArray(g[2]);case"any":case"all":for(const o of g.slice(1))if(!Kp(o)&&typeof o!="boolean")return!1;return!0;default:return!0}}const jg={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function dd(g){if(g==null)return{filter:()=>!0,needGeometry:!1};Kp(g)||(g=fd(g));const o=rf(g,jg);if(o.result==="error")throw new Error(o.value.map(m=>`${m.key}: ${m.message}`).join(", "));return{filter:(m,S,D)=>o.value.evaluate(m,S,{},D),needGeometry:np(g)}}function tp(g,o){return g<o?-1:g>o?1:0}function np(g){if(!Array.isArray(g))return!1;if(g[0]==="within"||g[0]==="distance")return!0;for(let o=1;o<g.length;o++)if(np(g[o]))return!0;return!1}function fd(g){if(!g)return!0;const o=g[0];return g.length<=1?o!=="any":o==="=="?of(g[1],g[2],"=="):o==="!="?gu(of(g[1],g[2],"==")):o==="<"||o===">"||o==="<="||o===">="?of(g[1],g[2],o):o==="any"?(m=g.slice(1),["any"].concat(m.map(fd))):o==="all"?["all"].concat(g.slice(1).map(fd)):o==="none"?["all"].concat(g.slice(1).map(fd).map(gu)):o==="in"?ip(g[1],g.slice(2)):o==="!in"?gu(ip(g[1],g.slice(2))):o==="has"?Jp(g[1]):o!=="!has"||gu(Jp(g[1]));var m}function of(g,o,m){switch(g){case"$type":return[`filter-type-${m}`,o];case"$id":return[`filter-id-${m}`,o];default:return[`filter-${m}`,g,o]}}function ip(g,o){if(o.length===0)return!1;switch(g){case"$type":return["filter-type-in",["literal",o]];case"$id":return["filter-id-in",["literal",o]];default:return o.length>200&&!o.some(m=>typeof m!=typeof o[0])?["filter-in-large",g,["literal",o.sort(tp)]]:["filter-in-small",g,["literal",o]]}}function Jp(g){switch(g){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",g]}}function gu(g){return["!",g]}function _u(g){const o=typeof g;if(o==="number"||o==="boolean"||o==="string"||g==null)return JSON.stringify(g);if(Array.isArray(g)){let D="[";for(const U of g)D+=`${_u(U)},`;return`${D}]`}const m=Object.keys(g).sort();let S="{";for(let D=0;D<m.length;D++)S+=`${JSON.stringify(m[D])}:${_u(g[m[D]])},`;return`${S}}`}function rp(g){let o="";for(const m of Qe)o+=`/${_u(g[m])}`;return o}function Ro(g){const o=g.value;return o?[new et(g.key,o,"constants have been deprecated as of v8")]:[]}function ns(g){return g instanceof Number||g instanceof String||g instanceof Boolean?g.valueOf():g}function Bc(g){if(Array.isArray(g))return g.map(Bc);if(g instanceof Object&&!(g instanceof Number||g instanceof String||g instanceof Boolean)){const o={};for(const m in g)o[m]=Bc(g[m]);return o}return ns(g)}function tl(g){const o=g.key,m=g.value,S=g.valueSpec||{},D=g.objectElementValidators||{},U=g.style,$=g.styleSpec,X=g.validateSpec;let oe=[];const fe=aa(m);if(fe!=="object")return[new et(o,m,`object expected, ${fe} found`)];for(const ve in m){const Ce=ve.split(".")[0],Be=S[Ce]||S["*"];let je;if(D[Ce])je=D[Ce];else if(S[Ce])je=X;else if(D["*"])je=D["*"];else{if(!S["*"]){oe.push(new et(o,m[ve],`unknown property "${ve}"`));continue}je=X}oe=oe.concat(je({key:(o&&`${o}.`)+ve,value:m[ve],valueSpec:Be,style:U,styleSpec:$,object:m,objectKey:ve,validateSpec:X},m))}for(const ve in S)D[ve]||S[ve].required&&S[ve].default===void 0&&m[ve]===void 0&&oe.push(new et(o,m,`missing required property "${ve}"`));return oe}function lf(g){const o=g.value,m=g.valueSpec,S=g.style,D=g.styleSpec,U=g.key,$=g.arrayElementValidator||g.validateSpec;if(aa(o)!=="array")return[new et(U,o,`array expected, ${aa(o)} found`)];if(m.length&&o.length!==m.length)return[new et(U,o,`array length ${m.length} expected, length ${o.length} found`)];if(m["min-length"]&&o.length<m["min-length"])return[new et(U,o,`array length at least ${m["min-length"]} expected, length ${o.length} found`)];let X={type:m.value,values:m.values};D.$version<7&&(X.function=m.function),aa(m.value)==="object"&&(X=m.value);let oe=[];for(let fe=0;fe<o.length;fe++)oe=oe.concat($({array:o,arrayIndex:fe,value:o[fe],valueSpec:X,validateSpec:g.validateSpec,style:S,styleSpec:D,key:`${U}[${fe}]`}));return oe}function cf(g){const o=g.key,m=g.value,S=g.valueSpec;let D=aa(m);return D==="number"&&m!=m&&(D="NaN"),D!=="number"?[new et(o,m,`number expected, ${D} found`)]:"minimum"in S&&m<S.minimum?[new et(o,m,`${m} is less than the minimum value ${S.minimum}`)]:"maximum"in S&&m>S.maximum?[new et(o,m,`${m} is greater than the maximum value ${S.maximum}`)]:[]}function uf(g){const o=g.valueSpec,m=ns(g.value.type);let S,D,U,$={};const X=m!=="categorical"&&g.value.property===void 0,oe=!X,fe=aa(g.value.stops)==="array"&&aa(g.value.stops[0])==="array"&&aa(g.value.stops[0][0])==="object",ve=tl({key:g.key,value:g.value,valueSpec:g.styleSpec.function,validateSpec:g.validateSpec,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{stops:function(je){if(m==="identity")return[new et(je.key,je.value,'identity function may not have a "stops" property')];let Ge=[];const lt=je.value;return Ge=Ge.concat(lf({key:je.key,value:lt,valueSpec:je.valueSpec,validateSpec:je.validateSpec,style:je.style,styleSpec:je.styleSpec,arrayElementValidator:Ce})),aa(lt)==="array"&&lt.length===0&&Ge.push(new et(je.key,lt,"array must have at least one stop")),Ge},default:function(je){return je.validateSpec({key:je.key,value:je.value,valueSpec:o,validateSpec:je.validateSpec,style:je.style,styleSpec:je.styleSpec})}}});return m==="identity"&&X&&ve.push(new et(g.key,g.value,'missing required property "property"')),m==="identity"||g.value.stops||ve.push(new et(g.key,g.value,'missing required property "stops"')),m==="exponential"&&g.valueSpec.expression&&!tf(g.valueSpec)&&ve.push(new et(g.key,g.value,"exponential functions not supported")),g.styleSpec.$version>=8&&(oe&&!Ll(g.valueSpec)?ve.push(new et(g.key,g.value,"property functions not supported")):X&&!ef(g.valueSpec)&&ve.push(new et(g.key,g.value,"zoom functions not supported"))),m!=="categorical"&&!fe||g.value.property!==void 0||ve.push(new et(g.key,g.value,'"property" property is required')),ve;function Ce(je){let Ge=[];const lt=je.value,Tt=je.key;if(aa(lt)!=="array")return[new et(Tt,lt,`array expected, ${aa(lt)} found`)];if(lt.length!==2)return[new et(Tt,lt,`array length 2 expected, length ${lt.length} found`)];if(fe){if(aa(lt[0])!=="object")return[new et(Tt,lt,`object expected, ${aa(lt[0])} found`)];if(lt[0].zoom===void 0)return[new et(Tt,lt,"object stop key must have zoom")];if(lt[0].value===void 0)return[new et(Tt,lt,"object stop key must have value")];if(U&&U>ns(lt[0].zoom))return[new et(Tt,lt[0].zoom,"stop zoom values must appear in ascending order")];ns(lt[0].zoom)!==U&&(U=ns(lt[0].zoom),D=void 0,$={}),Ge=Ge.concat(tl({key:`${Tt}[0]`,value:lt[0],valueSpec:{zoom:{}},validateSpec:je.validateSpec,style:je.style,styleSpec:je.styleSpec,objectElementValidators:{zoom:cf,value:Be}}))}else Ge=Ge.concat(Be({key:`${Tt}[0]`,value:lt[0],valueSpec:{},validateSpec:je.validateSpec,style:je.style,styleSpec:je.styleSpec},lt));return Rr(Bc(lt[1]))?Ge.concat([new et(`${Tt}[1]`,lt[1],"expressions are not allowed in function stops.")]):Ge.concat(je.validateSpec({key:`${Tt}[1]`,value:lt[1],valueSpec:o,validateSpec:je.validateSpec,style:je.style,styleSpec:je.styleSpec}))}function Be(je,Ge){const lt=aa(je.value),Tt=ns(je.value),Ot=je.value!==null?je.value:Ge;if(S){if(lt!==S)return[new et(je.key,Ot,`${lt} stop domain type must match previous stop domain type ${S}`)]}else S=lt;if(lt!=="number"&&lt!=="string"&&lt!=="boolean")return[new et(je.key,Ot,"stop domain value must be a number, string, or boolean")];if(lt!=="number"&&m!=="categorical"){let ln=`number expected, ${lt} found`;return Ll(o)&&m===void 0&&(ln+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new et(je.key,Ot,ln)]}return m!=="categorical"||lt!=="number"||isFinite(Tt)&&Math.floor(Tt)===Tt?m!=="categorical"&&lt==="number"&&D!==void 0&&Tt<D?[new et(je.key,Ot,"stop domain values must appear in ascending order")]:(D=Tt,m==="categorical"&&Tt in $?[new et(je.key,Ot,"stop domain values must be unique")]:($[Tt]=!0,[])):[new et(je.key,Ot,`integer expected, found ${Tt}`)]}}function Xu(g){const o=(g.expressionContext==="property"?Wu:rf)(Bc(g.value),g.valueSpec);if(o.result==="error")return o.value.map(S=>new et(`${g.key}${S.key}`,g.value,S.message));const m=o.value.expression||o.value._styleExpression.expression;if(g.expressionContext==="property"&&g.propertyKey==="text-font"&&!m.outputDefined())return[new et(g.key,g.value,`Invalid data expression for "${g.propertyKey}". Output values must be contained as literals within the expression.`)];if(g.expressionContext==="property"&&g.propertyType==="layout"&&!Th(m))return[new et(g.key,g.value,'"feature-state" data expressions are not supported with layout properties.')];if(g.expressionContext==="filter"&&!Th(m))return[new et(g.key,g.value,'"feature-state" data expressions are not supported with filters.')];if(g.expressionContext&&g.expressionContext.indexOf("cluster")===0){if(!Ch(m,["zoom","feature-state"]))return[new et(g.key,g.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(g.expressionContext==="cluster-initial"&&!Qd(m))return[new et(g.key,g.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Yu(g){const o=g.key,m=g.value,S=g.valueSpec,D=[];return Array.isArray(S.values)?S.values.indexOf(ns(m))===-1&&D.push(new et(o,m,`expected one of [${S.values.join(", ")}], ${JSON.stringify(m)} found`)):Object.keys(S.values).indexOf(ns(m))===-1&&D.push(new et(o,m,`expected one of [${Object.keys(S.values).join(", ")}], ${JSON.stringify(m)} found`)),D}function Mh(g){return Kp(Bc(g.value))?Xu(we({},g,{expressionContext:"filter",valueSpec:{value:"boolean"}})):pd(g)}function pd(g){const o=g.value,m=g.key;if(aa(o)!=="array")return[new et(m,o,`array expected, ${aa(o)} found`)];const S=g.styleSpec;let D,U=[];if(o.length<1)return[new et(m,o,"filter array must have at least 1 element")];switch(U=U.concat(Yu({key:`${m}[0]`,value:o[0],valueSpec:S.filter_operator,style:g.style,styleSpec:g.styleSpec})),ns(o[0])){case"<":case"<=":case">":case">=":o.length>=2&&ns(o[1])==="$type"&&U.push(new et(m,o,`"$type" cannot be use with operator "${o[0]}"`));case"==":case"!=":o.length!==3&&U.push(new et(m,o,`filter array for operator "${o[0]}" must have 3 elements`));case"in":case"!in":o.length>=2&&(D=aa(o[1]),D!=="string"&&U.push(new et(`${m}[1]`,o[1],`string expected, ${D} found`)));for(let $=2;$<o.length;$++)D=aa(o[$]),ns(o[1])==="$type"?U=U.concat(Yu({key:`${m}[${$}]`,value:o[$],valueSpec:S.geometry_type,style:g.style,styleSpec:g.styleSpec})):D!=="string"&&D!=="number"&&D!=="boolean"&&U.push(new et(`${m}[${$}]`,o[$],`string, number, or boolean expected, ${D} found`));break;case"any":case"all":case"none":for(let $=1;$<o.length;$++)U=U.concat(pd({key:`${m}[${$}]`,value:o[$],style:g.style,styleSpec:g.styleSpec}));break;case"has":case"!has":D=aa(o[1]),o.length!==2?U.push(new et(m,o,`filter array for "${o[0]}" operator must have 2 elements`)):D!=="string"&&U.push(new et(`${m}[1]`,o[1],`string expected, ${D} found`))}return U}function Qp(g,o){const m=g.key,S=g.validateSpec,D=g.style,U=g.styleSpec,$=g.value,X=g.objectKey,oe=U[`${o}_${g.layerType}`];if(!oe)return[];const fe=X.match(/^(.*)-transition$/);if(o==="paint"&&fe&&oe[fe[1]]&&oe[fe[1]].transition)return S({key:m,value:$,valueSpec:U.transition,style:D,styleSpec:U});const ve=g.valueSpec||oe[X];if(!ve)return[new et(m,$,`unknown property "${X}"`)];let Ce;if(aa($)==="string"&&Ll(ve)&&!ve.tokens&&(Ce=/^{([^}]+)}$/.exec($)))return[new et(m,$,`"${X}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(Ce[1])} }\`.`)];const Be=[];return g.layerType==="symbol"&&(X==="text-field"&&D&&!D.glyphs&&Be.push(new et(m,$,'use of "text-field" requires a style "glyphs" property')),X==="text-font"&&pu(Bc($))&&ns($.type)==="identity"&&Be.push(new et(m,$,'"text-font" does not support identity functions'))),Be.concat(S({key:g.key,value:$,valueSpec:ve,style:D,styleSpec:U,expressionContext:"property",propertyType:o,propertyKey:X}))}function Ku(g){return Qp(g,"paint")}function em(g){return Qp(g,"layout")}function Gm(g){let o=[];const m=g.value,S=g.key,D=g.style,U=g.styleSpec;m.type||m.ref||o.push(new et(S,m,'either "type" or "ref" is required'));let $=ns(m.type);const X=ns(m.ref);if(m.id){const oe=ns(m.id);for(let fe=0;fe<g.arrayIndex;fe++){const ve=D.layers[fe];ns(ve.id)===oe&&o.push(new et(S,m.id,`duplicate layer id "${m.id}", previously used at line ${ve.id.__line__}`))}}if("ref"in m){let oe;["type","source","source-layer","filter","layout"].forEach(fe=>{fe in m&&o.push(new et(S,m[fe],`"${fe}" is prohibited for ref layers`))}),D.layers.forEach(fe=>{ns(fe.id)===X&&(oe=fe)}),oe?oe.ref?o.push(new et(S,m.ref,"ref cannot reference another ref layer")):$=ns(oe.type):o.push(new et(S,m.ref,`ref layer "${X}" not found`))}else if($!=="background")if(m.source){const oe=D.sources&&D.sources[m.source],fe=oe&&ns(oe.type);oe?fe==="vector"&&$==="raster"?o.push(new et(S,m.source,`layer "${m.id}" requires a raster source`)):fe!=="raster-dem"&&$==="hillshade"?o.push(new et(S,m.source,`layer "${m.id}" requires a raster-dem source`)):fe==="raster"&&$!=="raster"?o.push(new et(S,m.source,`layer "${m.id}" requires a vector source`)):fe!=="vector"||m["source-layer"]?fe==="raster-dem"&&$!=="hillshade"?o.push(new et(S,m.source,"raster-dem source can only be used with layer type 'hillshade'.")):$!=="line"||!m.paint||!m.paint["line-gradient"]||fe==="geojson"&&oe.lineMetrics||o.push(new et(S,m,`layer "${m.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):o.push(new et(S,m,`layer "${m.id}" must specify a "source-layer"`)):o.push(new et(S,m.source,`source "${m.source}" not found`))}else o.push(new et(S,m,'missing required property "source"'));return o=o.concat(tl({key:S,value:m,valueSpec:U.layer,style:g.style,styleSpec:g.styleSpec,validateSpec:g.validateSpec,objectElementValidators:{"*":()=>[],type:()=>g.validateSpec({key:`${S}.type`,value:m.type,valueSpec:U.layer.type,style:g.style,styleSpec:g.styleSpec,validateSpec:g.validateSpec,object:m,objectKey:"type"}),filter:Mh,layout:oe=>tl({layer:m,key:oe.key,value:oe.value,style:oe.style,styleSpec:oe.styleSpec,validateSpec:oe.validateSpec,objectElementValidators:{"*":fe=>em(we({layerType:$},fe))}}),paint:oe=>tl({layer:m,key:oe.key,value:oe.value,style:oe.style,styleSpec:oe.styleSpec,validateSpec:oe.validateSpec,objectElementValidators:{"*":fe=>Ku(we({layerType:$},fe))}})}})),o}function Ju(g){const o=g.value,m=g.key,S=aa(o);return S!=="string"?[new et(m,o,`string expected, ${S} found`)]:[]}const tm={promoteId:function({key:g,value:o}){if(aa(o)==="string")return Ju({key:g,value:o});{const m=[];for(const S in o)m.push(...Ju({key:`${g}.${S}`,value:o[S]}));return m}}};function md(g){const o=g.value,m=g.key,S=g.styleSpec,D=g.style,U=g.validateSpec;if(!o.type)return[new et(m,o,'"type" is required')];const $=ns(o.type);let X;switch($){case"vector":case"raster":return X=tl({key:m,value:o,valueSpec:S[`source_${$.replace("-","_")}`],style:g.style,styleSpec:S,objectElementValidators:tm,validateSpec:U}),X;case"raster-dem":return X=function(oe){var fe;const ve=(fe=oe.sourceName)!==null&&fe!==void 0?fe:"",Ce=oe.value,Be=oe.styleSpec,je=Be.source_raster_dem,Ge=oe.style;let lt=[];const Tt=aa(Ce);if(Ce===void 0)return lt;if(Tt!=="object")return lt.push(new et("source_raster_dem",Ce,`object expected, ${Tt} found`)),lt;const Ot=ns(Ce.encoding)==="custom",ln=["redFactor","greenFactor","blueFactor","baseShift"],Zt=oe.value.encoding?`"${oe.value.encoding}"`:"Default";for(const Ne in Ce)!Ot&&ln.includes(Ne)?lt.push(new et(Ne,Ce[Ne],`In "${ve}": "${Ne}" is only valid when "encoding" is set to "custom". ${Zt} encoding found`)):je[Ne]?lt=lt.concat(oe.validateSpec({key:Ne,value:Ce[Ne],valueSpec:je[Ne],validateSpec:oe.validateSpec,style:Ge,styleSpec:Be})):lt.push(new et(Ne,Ce[Ne],`unknown property "${Ne}"`));return lt}({sourceName:m,value:o,style:g.style,styleSpec:S,validateSpec:U}),X;case"geojson":if(X=tl({key:m,value:o,valueSpec:S.source_geojson,style:D,styleSpec:S,validateSpec:U,objectElementValidators:tm}),o.cluster)for(const oe in o.clusterProperties){const[fe,ve]=o.clusterProperties[oe],Ce=typeof fe=="string"?[fe,["accumulated"],["get",oe]]:fe;X.push(...Xu({key:`${m}.${oe}.map`,value:ve,validateSpec:U,expressionContext:"cluster-map"})),X.push(...Xu({key:`${m}.${oe}.reduce`,value:Ce,validateSpec:U,expressionContext:"cluster-reduce"}))}return X;case"video":return tl({key:m,value:o,valueSpec:S.source_video,style:D,validateSpec:U,styleSpec:S});case"image":return tl({key:m,value:o,valueSpec:S.source_image,style:D,validateSpec:U,styleSpec:S});case"canvas":return[new et(m,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Yu({key:`${m}.type`,value:o.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:D,validateSpec:U,styleSpec:S})}}function qm(g){const o=g.value,m=g.styleSpec,S=m.light,D=g.style;let U=[];const $=aa(o);if(o===void 0)return U;if($!=="object")return U=U.concat([new et("light",o,`object expected, ${$} found`)]),U;for(const X in o){const oe=X.match(/^(.*)-transition$/);U=U.concat(oe&&S[oe[1]]&&S[oe[1]].transition?g.validateSpec({key:X,value:o[X],valueSpec:m.transition,validateSpec:g.validateSpec,style:D,styleSpec:m}):S[X]?g.validateSpec({key:X,value:o[X],valueSpec:S[X],validateSpec:g.validateSpec,style:D,styleSpec:m}):[new et(X,o[X],`unknown property "${X}"`)])}return U}function gd(g){const o=g.value,m=g.styleSpec,S=m.sky,D=g.style,U=aa(o);if(o===void 0)return[];if(U!=="object")return[new et("sky",o,`object expected, ${U} found`)];let $=[];for(const X in o)$=$.concat(S[X]?g.validateSpec({key:X,value:o[X],valueSpec:S[X],style:D,styleSpec:m}):[new et(X,o[X],`unknown property "${X}"`)]);return $}function ap(g){const o=g.value,m=g.styleSpec,S=m.terrain,D=g.style;let U=[];const $=aa(o);if(o===void 0)return U;if($!=="object")return U=U.concat([new et("terrain",o,`object expected, ${$} found`)]),U;for(const X in o)U=U.concat(S[X]?g.validateSpec({key:X,value:o[X],valueSpec:S[X],validateSpec:g.validateSpec,style:D,styleSpec:m}):[new et(X,o[X],`unknown property "${X}"`)]);return U}function sp(g){let o=[];const m=g.value,S=g.key;if(Array.isArray(m)){const D=[],U=[];for(const $ in m)m[$].id&&D.includes(m[$].id)&&o.push(new et(S,m,`all the sprites' ids must be unique, but ${m[$].id} is duplicated`)),D.push(m[$].id),m[$].url&&U.includes(m[$].url)&&o.push(new et(S,m,`all the sprites' URLs must be unique, but ${m[$].url} is duplicated`)),U.push(m[$].url),o=o.concat(tl({key:`${S}[${$}]`,value:m[$],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:g.validateSpec}));return o}return Ju({key:S,value:m})}const Ih={"*":()=>[],array:lf,boolean:function(g){const o=g.value,m=g.key,S=aa(o);return S!=="boolean"?[new et(m,o,`boolean expected, ${S} found`)]:[]},number:cf,color:function(g){const o=g.key,m=g.value,S=aa(m);return S!=="string"?[new et(o,m,`color expected, ${S} found`)]:Br.parse(String(m))?[]:[new et(o,m,`color expected, "${m}" found`)]},constants:Ro,enum:Yu,filter:Mh,function:uf,layer:Gm,object:tl,source:md,light:qm,sky:gd,terrain:ap,projection:function(g){const o=g.value,m=g.styleSpec,S=m.projection,D=g.style,U=aa(o);if(o===void 0)return[];if(U!=="object")return[new et("projection",o,`object expected, ${U} found`)];let $=[];for(const X in o)$=$.concat(S[X]?g.validateSpec({key:X,value:o[X],valueSpec:S[X],style:D,styleSpec:m}):[new et(X,o[X],`unknown property "${X}"`)]);return $},projectionDefinition:function(g){const o=g.key;let m=g.value;m=m instanceof String?m.valueOf():m;const S=aa(m);return S!=="array"||function(D){return Array.isArray(D)&&D.length===3&&typeof D[0]=="string"&&typeof D[1]=="string"&&typeof D[2]=="number"}(m)||function(D){return!!["interpolate","step","literal"].includes(D[0])}(m)?["array","string"].includes(S)?[]:[new et(o,m,`projection expected, invalid type "${S}" found`)]:[new et(o,m,`projection expected, invalid array ${JSON.stringify(m)} found`)]},string:Ju,formatted:function(g){return Ju(g).length===0?[]:Xu(g)},resolvedImage:function(g){return Ju(g).length===0?[]:Xu(g)},padding:function(g){const o=g.key,m=g.value;if(aa(m)==="array"){if(m.length<1||m.length>4)return[new et(o,m,`padding requires 1 to 4 values; ${m.length} values found`)];const S={type:"number"};let D=[];for(let U=0;U<m.length;U++)D=D.concat(g.validateSpec({key:`${o}[${U}]`,value:m[U],validateSpec:g.validateSpec,valueSpec:S}));return D}return cf({key:o,value:m,valueSpec:{}})},variableAnchorOffsetCollection:function(g){const o=g.key,m=g.value,S=aa(m),D=g.styleSpec;if(S!=="array"||m.length<1||m.length%2!=0)return[new et(o,m,"variableAnchorOffsetCollection requires a non-empty array of even length")];let U=[];for(let $=0;$<m.length;$+=2)U=U.concat(Yu({key:`${o}[${$}]`,value:m[$],valueSpec:D.layout_symbol["text-anchor"]})),U=U.concat(lf({key:`${o}[${$+1}]`,value:m[$+1],valueSpec:{length:2,value:"number"},validateSpec:g.validateSpec,style:g.style,styleSpec:D}));return U},sprite:sp};function _d(g){const o=g.value,m=g.valueSpec,S=g.styleSpec;return g.validateSpec=_d,m.expression&&pu(ns(o))?uf(g):m.expression&&Rr(Bc(o))?Xu(g):m.type&&Ih[m.type]?Ih[m.type](g):tl(we({},g,{valueSpec:m.type?S[m.type]:m}))}function Ph(g){const o=g.value,m=g.key,S=Ju(g);return S.length||(o.indexOf("{fontstack}")===-1&&S.push(new et(m,o,'"glyphs" url must include a "{fontstack}" token')),o.indexOf("{range}")===-1&&S.push(new et(m,o,'"glyphs" url must include a "{range}" token'))),S}function Lo(g,o=bt){let m=[];return m=m.concat(_d({key:"",value:g,valueSpec:o.$root,styleSpec:o,style:g,validateSpec:_d,objectElementValidators:{glyphs:Ph,"*":()=>[]}})),g.constants&&(m=m.concat(Ro({key:"constants",value:g.constants,style:g,styleSpec:o,validateSpec:_d}))),zo(m)}function ms(g){return function(o){return g({...o,validateSpec:_d})}}function zo(g){return[].concat(g).sort((o,m)=>o.line-m.line)}function Ol(g){return function(...o){return zo(g.apply(this,o))}}Lo.source=Ol(ms(md)),Lo.sprite=Ol(ms(sp)),Lo.glyphs=Ol(ms(Ph)),Lo.light=Ol(ms(qm)),Lo.sky=Ol(ms(gd)),Lo.terrain=Ol(ms(ap)),Lo.layer=Ol(ms(Gm)),Lo.filter=Ol(ms(Mh)),Lo.paintProperty=Ol(ms(Ku)),Lo.layoutProperty=Ol(ms(em));const ml=Lo,nm=ml.light,Vc=ml.sky,hf=ml.paintProperty,op=ml.layoutProperty;function lp(g,o){let m=!1;if(o&&o.length)for(const S of o)g.fire(new to(new Error(S.message))),m=!0;return m}class Nc{constructor(o,m,S){const D=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;const $=new Int32Array(this.arrayBuffer);o=$[0],this.d=(m=$[1])+2*(S=$[2]);for(let oe=0;oe<this.d*this.d;oe++){const fe=$[3+oe],ve=$[3+oe+1];D.push(fe===ve?null:$.subarray(fe,ve))}const X=$[3+D.length+1];this.keys=$.subarray($[3+D.length],X),this.bboxes=$.subarray(X),this.insert=this._insertReadonly}else{this.d=m+2*S;for(let $=0;$<this.d*this.d;$++)D.push([]);this.keys=[],this.bboxes=[]}this.n=m,this.extent=o,this.padding=S,this.scale=m/o,this.uid=0;const U=S/m*o;this.min=-U,this.max=o+U}insert(o,m,S,D,U){this._forEachCell(m,S,D,U,this._insertCell,this.uid++,void 0,void 0),this.keys.push(o),this.bboxes.push(m),this.bboxes.push(S),this.bboxes.push(D),this.bboxes.push(U)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(o,m,S,D,U,$){this.cells[U].push($)}query(o,m,S,D,U){const $=this.min,X=this.max;if(o<=$&&m<=$&&X<=S&&X<=D&&!U)return Array.prototype.slice.call(this.keys);{const oe=[];return this._forEachCell(o,m,S,D,this._queryCell,oe,{},U),oe}}_queryCell(o,m,S,D,U,$,X,oe){const fe=this.cells[U];if(fe!==null){const ve=this.keys,Ce=this.bboxes;for(let Be=0;Be<fe.length;Be++){const je=fe[Be];if(X[je]===void 0){const Ge=4*je;(oe?oe(Ce[Ge+0],Ce[Ge+1],Ce[Ge+2],Ce[Ge+3]):o<=Ce[Ge+2]&&m<=Ce[Ge+3]&&S>=Ce[Ge+0]&&D>=Ce[Ge+1])?(X[je]=!0,$.push(ve[je])):X[je]=!1}}}}_forEachCell(o,m,S,D,U,$,X,oe){const fe=this._convertToCellCoord(o),ve=this._convertToCellCoord(m),Ce=this._convertToCellCoord(S),Be=this._convertToCellCoord(D);for(let je=fe;je<=Ce;je++)for(let Ge=ve;Ge<=Be;Ge++){const lt=this.d*Ge+je;if((!oe||oe(this._convertFromCellCoord(je),this._convertFromCellCoord(Ge),this._convertFromCellCoord(je+1),this._convertFromCellCoord(Ge+1)))&&U.call(this,o,m,S,D,lt,$,X,oe))return}}_convertFromCellCoord(o){return(o-this.padding)/this.scale}_convertToCellCoord(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const o=this.cells,m=3+this.cells.length+1+1;let S=0;for(let $=0;$<this.cells.length;$++)S+=this.cells[$].length;const D=new Int32Array(m+S+this.keys.length+this.bboxes.length);D[0]=this.extent,D[1]=this.n,D[2]=this.padding;let U=m;for(let $=0;$<o.length;$++){const X=o[$];D[3+$]=U,D.set(X,U),U+=X.length}return D[3+o.length]=U,D.set(this.keys,U),U+=this.keys.length,D[3+o.length+1]=U,D.set(this.bboxes,U),U+=this.bboxes.length,D.buffer}static serialize(o,m){const S=o.toArrayBuffer();return m&&m.push(S),{buffer:S}}static deserialize(o){return new Nc(o.buffer)}}const jc={};function Yi(g,o,m={}){if(jc[g])throw new Error(`${g} is already registered.`);Object.defineProperty(o,"_classRegistryKey",{value:g,writeable:!1}),jc[g]={klass:o,omit:m.omit||[],shallow:m.shallow||[]}}Yi("Object",Object),Yi("TransferableGridIndex",Nc),Yi("Color",Br),Yi("Error",Error),Yi("AJAXError",Er),Yi("ResolvedImage",ts),Yi("StylePropertyFunction",sf),Yi("StyleExpression",Ql,{omit:["_evaluator"]}),Yi("ZoomDependentExpression",af),Yi("ZoomConstantExpression",Eh),Yi("CompoundExpression",Jl,{omit:["_evaluate"]});for(const g in Kl)Kl[g]._classRegistryKey||Yi(`Expression_${g}`,Kl[g]);function yd(g){return g&&typeof ArrayBuffer<"u"&&(g instanceof ArrayBuffer||g.constructor&&g.constructor.name==="ArrayBuffer")}function Ah(g){return g.$name||g.constructor._classRegistryKey}function im(g){return!function(o){if(o===null||typeof o!="object")return!1;const m=Ah(o);return!(!m||m==="Object")}(g)&&(g==null||typeof g=="boolean"||typeof g=="number"||typeof g=="string"||g instanceof Boolean||g instanceof Number||g instanceof String||g instanceof Date||g instanceof RegExp||g instanceof Blob||g instanceof Error||yd(g)||Tn(g)||ArrayBuffer.isView(g)||g instanceof ImageData)}function kh(g,o){if(im(g))return(yd(g)||Tn(g))&&o&&o.push(g),ArrayBuffer.isView(g)&&o&&o.push(g.buffer),g instanceof ImageData&&o&&o.push(g.data.buffer),g;if(Array.isArray(g)){const U=[];for(const $ of g)U.push(kh($,o));return U}if(typeof g!="object")throw new Error("can't serialize object of type "+typeof g);const m=Ah(g);if(!m)throw new Error(`can't serialize object of unregistered class ${g.constructor.name}`);if(!jc[m])throw new Error(`${m} is not registered.`);const{klass:S}=jc[m],D=S.serialize?S.serialize(g,o):{};if(S.serialize){if(o&&D===o[o.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const U in g){if(!g.hasOwnProperty(U)||jc[m].omit.indexOf(U)>=0)continue;const $=g[U];D[U]=jc[m].shallow.indexOf(U)>=0?$:kh($,o)}g instanceof Error&&(D.message=g.message)}if(D.$name)throw new Error("$name property is reserved for worker serialization logic.");return m!=="Object"&&(D.$name=m),D}function _c(g){if(im(g))return g;if(Array.isArray(g))return g.map(_c);if(typeof g!="object")throw new Error("can't deserialize object of type "+typeof g);const o=Ah(g)||"Object";if(!jc[o])throw new Error(`can't deserialize unregistered class ${o}`);const{klass:m}=jc[o];if(!m)throw new Error(`can't deserialize unregistered class ${o}`);if(m.deserialize)return m.deserialize(g);const S=Object.create(m.prototype);for(const D of Object.keys(g)){if(D==="$name")continue;const U=g[D];S[D]=jc[o].shallow.indexOf(D)>=0?U:_c(U)}return S}class cp{constructor(){this.first=!0}update(o,m){const S=Math.floor(o);return this.first?(this.first=!1,this.lastIntegerZoom=S,this.lastIntegerZoomTime=0,this.lastZoom=o,this.lastFloorZoom=S,!0):(this.lastFloorZoom>S?(this.lastIntegerZoom=S+1,this.lastIntegerZoomTime=m):this.lastFloorZoom<S&&(this.lastIntegerZoom=S,this.lastIntegerZoomTime=m),o!==this.lastZoom&&(this.lastZoom=o,this.lastFloorZoom=S,!0))}}const Qr={"Latin-1 Supplement":g=>g>=128&&g<=255,"Hangul Jamo":g=>g>=4352&&g<=4607,Khmer:g=>g>=6016&&g<=6143,"General Punctuation":g=>g>=8192&&g<=8303,"Letterlike Symbols":g=>g>=8448&&g<=8527,"Number Forms":g=>g>=8528&&g<=8591,"Miscellaneous Technical":g=>g>=8960&&g<=9215,"Control Pictures":g=>g>=9216&&g<=9279,"Optical Character Recognition":g=>g>=9280&&g<=9311,"Enclosed Alphanumerics":g=>g>=9312&&g<=9471,"Geometric Shapes":g=>g>=9632&&g<=9727,"Miscellaneous Symbols":g=>g>=9728&&g<=9983,"Miscellaneous Symbols and Arrows":g=>g>=11008&&g<=11263,"Ideographic Description Characters":g=>g>=12272&&g<=12287,"CJK Symbols and Punctuation":g=>g>=12288&&g<=12351,Katakana:g=>g>=12448&&g<=12543,Kanbun:g=>g>=12688&&g<=12703,"CJK Strokes":g=>g>=12736&&g<=12783,"Enclosed CJK Letters and Months":g=>g>=12800&&g<=13055,"CJK Compatibility":g=>g>=13056&&g<=13311,"Yijing Hexagram Symbols":g=>g>=19904&&g<=19967,"Private Use Area":g=>g>=57344&&g<=63743,"Vertical Forms":g=>g>=65040&&g<=65055,"CJK Compatibility Forms":g=>g>=65072&&g<=65103,"Small Form Variants":g=>g>=65104&&g<=65135,"Halfwidth and Fullwidth Forms":g=>g>=65280&&g<=65519};function Uc(g){for(const o of g)if(vd(o.charCodeAt(0)))return!0;return!1}function up(g){for(const o of g)if(!df(o.charCodeAt(0)))return!1;return!0}function yu(g){const o=g.map(m=>{try{return new RegExp(`\\p{sc=${m}}`,"u").source}catch{return null}}).filter(m=>m);return new RegExp(o.join("|"),"u")}const hp=yu(["Arab","Dupl","Mong","Ougr","Syrc"]);function df(g){return!hp.test(String.fromCodePoint(g))}const Dh=yu(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function vd(g){return!(g!==746&&g!==747&&(g<4352||!(Qr["CJK Compatibility Forms"](g)&&!(g>=65097&&g<=65103)||Qr["CJK Compatibility"](g)||Qr["CJK Strokes"](g)||!(!Qr["CJK Symbols and Punctuation"](g)||g>=12296&&g<=12305||g>=12308&&g<=12319||g===12336)||Qr["Enclosed CJK Letters and Months"](g)||Qr["Ideographic Description Characters"](g)||Qr.Kanbun(g)||Qr.Katakana(g)&&g!==12540||!(!Qr["Halfwidth and Fullwidth Forms"](g)||g===65288||g===65289||g===65293||g>=65306&&g<=65310||g===65339||g===65341||g===65343||g>=65371&&g<=65503||g===65507||g>=65512&&g<=65519)||!(!Qr["Small Form Variants"](g)||g>=65112&&g<=65118||g>=65123&&g<=65126)||Qr["Vertical Forms"](g)||Qr["Yijing Hexagram Symbols"](g)||new RegExp("\\p{sc=Cans}","u").test(String.fromCodePoint(g))||new RegExp("\\p{sc=Hang}","u").test(String.fromCodePoint(g))||Dh.test(String.fromCodePoint(g)))))}function dp(g){return!(vd(g)||function(o){return!!(Qr["Latin-1 Supplement"](o)&&(o===167||o===169||o===174||o===177||o===188||o===189||o===190||o===215||o===247)||Qr["General Punctuation"](o)&&(o===8214||o===8224||o===8225||o===8240||o===8241||o===8251||o===8252||o===8258||o===8263||o===8264||o===8265||o===8273)||Qr["Letterlike Symbols"](o)||Qr["Number Forms"](o)||Qr["Miscellaneous Technical"](o)&&(o>=8960&&o<=8967||o>=8972&&o<=8991||o>=8996&&o<=9e3||o===9003||o>=9085&&o<=9114||o>=9150&&o<=9165||o===9167||o>=9169&&o<=9179||o>=9186&&o<=9215)||Qr["Control Pictures"](o)&&o!==9251||Qr["Optical Character Recognition"](o)||Qr["Enclosed Alphanumerics"](o)||Qr["Geometric Shapes"](o)||Qr["Miscellaneous Symbols"](o)&&!(o>=9754&&o<=9759)||Qr["Miscellaneous Symbols and Arrows"](o)&&(o>=11026&&o<=11055||o>=11088&&o<=11097||o>=11192&&o<=11243)||Qr["CJK Symbols and Punctuation"](o)||Qr.Katakana(o)||Qr["Private Use Area"](o)||Qr["CJK Compatibility Forms"](o)||Qr["Small Form Variants"](o)||Qr["Halfwidth and Fullwidth Forms"](o)||o===8734||o===8756||o===8757||o>=9984&&o<=10087||o>=10102&&o<=10131||o===65532||o===65533)}(g))}const Hm=yu(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function Rh(g){return Hm.test(String.fromCodePoint(g))}function xd(g,o){return!(!o&&Rh(g)||g>=2304&&g<=3583||g>=3840&&g<=4255||Qr.Khmer(g))}function ki(g){for(const o of g)if(Rh(o.charCodeAt(0)))return!0;return!1}const yc=new class{constructor(){this.TIMEOUT=5e3,this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null,this.loadScriptResolve=()=>{}}setState(g){this.pluginStatus=g.pluginStatus,this.pluginURL=g.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(g){if(yc.isParsed())throw new Error("RTL text plugin already registered.");this.applyArabicShaping=g.applyArabicShaping,this.processBidirectionalText=g.processBidirectionalText,this.processStyledBidirectionalText=g.processStyledBidirectionalText,this.loadScriptResolve()}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getRTLTextPluginStatus(){return this.pluginStatus}syncState(g,o){return t(this,void 0,void 0,function*(){if(this.isParsed())return this.getState();if(g.pluginStatus!=="loading")return this.setState(g),g;const m=g.pluginURL,S=new Promise(U=>{this.loadScriptResolve=U});o(m);const D=new Promise(U=>setTimeout(()=>U(),this.TIMEOUT));if(yield Promise.race([S,D]),this.isParsed()){const U={pluginStatus:"loaded",pluginURL:m};return this.setState(U),U}throw this.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${m}`)})}};class ls{constructor(o,m){this.zoom=o,m?(this.now=m.now,this.fadeDuration=m.fadeDuration,this.zoomHistory=m.zoomHistory,this.transition=m.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new cp,this.transition={})}isSupportedScript(o){return function(m,S){for(const D of m)if(!xd(D.charCodeAt(0),S))return!1;return!0}(o,yc.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const o=this.zoom,m=o-Math.floor(o),S=this.crossFadingFactor();return o>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:m+(1-m)*S}:{fromScale:.5,toScale:1,t:1-(1-S)*m}}}class nl{constructor(o,m){this.property=o,this.value=m,this.expression=function(S,D){if(pu(S))return new sf(S,D);if(Rr(S)){const U=Wu(S,D);if(U.result==="error")throw new Error(U.value.map($=>`${$.key}: ${$.message}`).join(", "));return U.value}{let U=S;return D.type==="color"&&typeof S=="string"?U=Br.parse(S):D.type!=="padding"||typeof S!="number"&&!Array.isArray(S)?D.type==="variableAnchorOffsetCollection"&&Array.isArray(S)?U=Vs.parse(S):D.type==="projectionDefinition"&&typeof S=="string"&&(U=no.parse(S)):U=ss.parse(S),{kind:"constant",evaluate:()=>U}}}(m===void 0?o.specification.default:m,o.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(o,m,S){return this.property.possiblyEvaluate(this,o,m,S)}}class $c{constructor(o){this.property=o,this.value=new nl(o,void 0)}transitioned(o,m){return new ff(this.property,this.value,m,Fi({},o.transition,this.transition),o.now)}untransitioned(){return new ff(this.property,this.value,null,{},0)}}class $i{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues)}getValue(o){return pi(this._values[o].value.value)}setValue(o,m){Object.prototype.hasOwnProperty.call(this._values,o)||(this._values[o]=new $c(this._values[o].property)),this._values[o].value=new nl(this._values[o].property,m===null?void 0:pi(m))}getTransition(o){return pi(this._values[o].transition)}setTransition(o,m){Object.prototype.hasOwnProperty.call(this._values,o)||(this._values[o]=new $c(this._values[o].property)),this._values[o].transition=pi(m)||void 0}serialize(){const o={};for(const m of Object.keys(this._values)){const S=this.getValue(m);S!==void 0&&(o[m]=S);const D=this.getTransition(m);D!==void 0&&(o[`${m}-transition`]=D)}return o}transitioned(o,m){const S=new fp(this._properties);for(const D of Object.keys(this._values))S._values[D]=this._values[D].transitioned(o,m._values[D]);return S}untransitioned(){const o=new fp(this._properties);for(const m of Object.keys(this._values))o._values[m]=this._values[m].untransitioned();return o}}class ff{constructor(o,m,S,D,U){this.property=o,this.value=m,this.begin=U+D.delay||0,this.end=this.begin+D.duration||0,o.specification.transition&&(D.delay||D.duration)&&(this.prior=S)}possiblyEvaluate(o,m,S){const D=o.now||0,U=this.value.possiblyEvaluate(o,m,S),$=this.prior;if($){if(D>this.end)return this.prior=null,U;if(this.value.isDataDriven())return this.prior=null,U;if(D<this.begin)return $.possiblyEvaluate(o,m,S);{const X=(D-this.begin)/(this.end-this.begin);return this.property.interpolate($.possiblyEvaluate(o,m,S),U,Bn(X))}}return U}}class fp{constructor(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)}possiblyEvaluate(o,m,S){const D=new Qu(this._properties);for(const U of Object.keys(this._values))D._values[U]=this._values[U].possiblyEvaluate(o,m,S);return D}hasTransition(){for(const o of Object.keys(this._values))if(this._values[o].prior)return!0;return!1}}class pf{constructor(o){this._properties=o,this._values=Object.create(o.defaultPropertyValues)}hasValue(o){return this._values[o].value!==void 0}getValue(o){return pi(this._values[o].value)}setValue(o,m){this._values[o]=new nl(this._values[o].property,m===null?void 0:pi(m))}serialize(){const o={};for(const m of Object.keys(this._values)){const S=this.getValue(m);S!==void 0&&(o[m]=S)}return o}possiblyEvaluate(o,m,S){const D=new Qu(this._properties);for(const U of Object.keys(this._values))D._values[U]=this._values[U].possiblyEvaluate(o,m,S);return D}}class Fl{constructor(o,m,S){this.property=o,this.value=m,this.parameters=S}isConstant(){return this.value.kind==="constant"}constantOr(o){return this.value.kind==="constant"?this.value.value:o}evaluate(o,m,S,D){return this.property.evaluate(this.value,this.parameters,o,m,S,D)}}class Qu{constructor(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)}get(o){return this._values[o]}}class cr{constructor(o){this.specification=o}possiblyEvaluate(o,m){if(o.isDataDriven())throw new Error("Value should not be data driven");return o.expression.evaluate(m)}interpolate(o,m,S){const D=Oa[this.specification.type];return D?D(o,m,S):o}}class xr{constructor(o,m){this.specification=o,this.overrides=m}possiblyEvaluate(o,m,S,D){return new Fl(this,o.expression.kind==="constant"||o.expression.kind==="camera"?{kind:"constant",value:o.expression.evaluate(m,null,{},S,D)}:o.expression,m)}interpolate(o,m,S){if(o.value.kind!=="constant"||m.value.kind!=="constant")return o;if(o.value.value===void 0||m.value.value===void 0)return new Fl(this,{kind:"constant",value:void 0},o.parameters);const D=Oa[this.specification.type];if(D){const U=D(o.value.value,m.value.value,S);return new Fl(this,{kind:"constant",value:U},o.parameters)}return o}evaluate(o,m,S,D,U,$){return o.kind==="constant"?o.value:o.evaluate(m,S,D,U,$)}}class bd extends xr{possiblyEvaluate(o,m,S,D){if(o.value===void 0)return new Fl(this,{kind:"constant",value:void 0},m);if(o.expression.kind==="constant"){const U=o.expression.evaluate(m,null,{},S,D),$=o.property.specification.type==="resolvedImage"&&typeof U!="string"?U.name:U,X=this._calculate($,$,$,m);return new Fl(this,{kind:"constant",value:X},m)}if(o.expression.kind==="camera"){const U=this._calculate(o.expression.evaluate({zoom:m.zoom-1}),o.expression.evaluate({zoom:m.zoom}),o.expression.evaluate({zoom:m.zoom+1}),m);return new Fl(this,{kind:"constant",value:U},m)}return new Fl(this,o.expression,m)}evaluate(o,m,S,D,U,$){if(o.kind==="source"){const X=o.evaluate(m,S,D,U,$);return this._calculate(X,X,X,m)}return o.kind==="composite"?this._calculate(o.evaluate({zoom:Math.floor(m.zoom)-1},S,D),o.evaluate({zoom:Math.floor(m.zoom)},S,D),o.evaluate({zoom:Math.floor(m.zoom)+1},S,D),m):o.value}_calculate(o,m,S,D){return D.zoom>D.zoomHistory.lastIntegerZoom?{from:o,to:m}:{from:S,to:m}}interpolate(o){return o}}class wd{constructor(o){this.specification=o}possiblyEvaluate(o,m,S,D){if(o.value!==void 0){if(o.expression.kind==="constant"){const U=o.expression.evaluate(m,null,{},S,D);return this._calculate(U,U,U,m)}return this._calculate(o.expression.evaluate(new ls(Math.floor(m.zoom-1),m)),o.expression.evaluate(new ls(Math.floor(m.zoom),m)),o.expression.evaluate(new ls(Math.floor(m.zoom+1),m)),m)}}_calculate(o,m,S,D){return D.zoom>D.zoomHistory.lastIntegerZoom?{from:o,to:m}:{from:S,to:m}}interpolate(o){return o}}class Bl{constructor(o){this.specification=o}possiblyEvaluate(o,m,S,D){return!!o.expression.evaluate(m,null,{},S,D)}interpolate(){return!1}}class $o{constructor(o){this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const m in o){const S=o[m];S.specification.overridable&&this.overridableProperties.push(m);const D=this.defaultPropertyValues[m]=new nl(S,void 0),U=this.defaultTransitionablePropertyValues[m]=new $c(S);this.defaultTransitioningPropertyValues[m]=U.untransitioned(),this.defaultPossiblyEvaluatedValues[m]=D.possiblyEvaluate({})}}}Yi("DataDrivenProperty",xr),Yi("DataConstantProperty",cr),Yi("CrossFadedDataDrivenProperty",bd),Yi("CrossFadedProperty",wd),Yi("ColorRampProperty",Bl);const pp="-transition";class Ss extends ko{constructor(o,m){if(super(),this.id=o.id,this.type=o.type,this._featureFilter={filter:()=>!0,needGeometry:!1},o.type!=="custom"&&(this.metadata=o.metadata,this.minzoom=o.minzoom,this.maxzoom=o.maxzoom,o.type!=="background"&&(this.source=o.source,this.sourceLayer=o["source-layer"],this.filter=o.filter),m.layout&&(this._unevaluatedLayout=new pf(m.layout)),m.paint)){this._transitionablePaint=new $i(m.paint);for(const S in o.paint)this.setPaintProperty(S,o.paint[S],{validate:!1});for(const S in o.layout)this.setLayoutProperty(S,o.layout[S],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Qu(m.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(o){return o==="visibility"?this.visibility:this._unevaluatedLayout.getValue(o)}setLayoutProperty(o,m,S={}){m!=null&&this._validate(op,`layers.${this.id}.layout.${o}`,o,m,S)||(o!=="visibility"?this._unevaluatedLayout.setValue(o,m):this.visibility=m)}getPaintProperty(o){return o.endsWith(pp)?this._transitionablePaint.getTransition(o.slice(0,-11)):this._transitionablePaint.getValue(o)}setPaintProperty(o,m,S={}){if(m!=null&&this._validate(hf,`layers.${this.id}.paint.${o}`,o,m,S))return!1;if(o.endsWith(pp))return this._transitionablePaint.setTransition(o.slice(0,-11),m||void 0),!1;{const D=this._transitionablePaint._values[o],U=D.property.specification["property-type"]==="cross-faded-data-driven",$=D.value.isDataDriven(),X=D.value;this._transitionablePaint.setValue(o,m),this._handleSpecialPaintPropertyUpdate(o);const oe=this._transitionablePaint._values[o].value;return oe.isDataDriven()||$||U||this._handleOverridablePaintPropertyUpdate(o,X,oe)}}_handleSpecialPaintPropertyUpdate(o){}_handleOverridablePaintPropertyUpdate(o,m,S){return!1}isHidden(o){return!!(this.minzoom&&o<this.minzoom)||!!(this.maxzoom&&o>=this.maxzoom)||this.visibility==="none"}updateTransitions(o){this._transitioningPaint=this._transitionablePaint.transitioned(o,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(o,m){o.getCrossfadeParameters&&(this._crossfadeParameters=o.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(o,void 0,m)),this.paint=this._transitioningPaint.possiblyEvaluate(o,void 0,m)}serialize(){const o={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(o.layout=o.layout||{},o.layout.visibility=this.visibility),qn(o,(m,S)=>!(m===void 0||S==="layout"&&!Object.keys(m).length||S==="paint"&&!Object.keys(m).length))}_validate(o,m,S,D,U={}){return(!U||U.validate!==!1)&&lp(this,o.call(ml,{key:m,layerType:this.type,objectKey:S,value:D,styleSpec:bt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const o in this.paint._values){const m=this.paint.get(o);if(m instanceof Fl&&Ll(m.property.specification)&&(m.value.kind==="source"||m.value.kind==="composite")&&m.value.isStateDependent)return!0}return!1}}const eh={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class vu{constructor(o,m){this._structArray=o,this._pos1=m*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ra{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(o,m){return o._trim(),m&&(o.isTransferred=!0,m.push(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}}static deserialize(o){const m=Object.create(this.prototype);return m.arrayBuffer=o.arrayBuffer,m.length=o.length,m.capacity=o.arrayBuffer.byteLength/m.bytesPerElement,m._refreshViews(),m}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(o){this.reserve(o),this.length=o}reserve(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const m=this.uint8;this._refreshViews(),m&&this.uint8.set(m)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function cs(g,o=1){let m=0,S=0;return{members:g.map(D=>{const U=eh[D.type].BYTES_PER_ELEMENT,$=m=mf(m,Math.max(o,U)),X=D.components||1;return S=Math.max(S,U),m+=U*X,{name:D.name,type:D.type,components:X,offset:$}}),size:mf(m,Math.max(S,o)),alignment:o}}function mf(g,o){return Math.ceil(g/o)*o}class Sd extends Ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,m){const S=this.length;return this.resize(S+1),this.emplace(S,o,m)}emplace(o,m,S){const D=2*o;return this.int16[D+0]=m,this.int16[D+1]=S,o}}Sd.prototype.bytesPerElement=4,Yi("StructArrayLayout2i4",Sd);class Go extends Ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,m,S){const D=this.length;return this.resize(D+1),this.emplace(D,o,m,S)}emplace(o,m,S,D){const U=3*o;return this.int16[U+0]=m,this.int16[U+1]=S,this.int16[U+2]=D,o}}Go.prototype.bytesPerElement=6,Yi("StructArrayLayout3i6",Go);class ba extends Ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,m,S,D){const U=this.length;return this.resize(U+1),this.emplace(U,o,m,S,D)}emplace(o,m,S,D,U){const $=4*o;return this.int16[$+0]=m,this.int16[$+1]=S,this.int16[$+2]=D,this.int16[$+3]=U,o}}ba.prototype.bytesPerElement=8,Yi("StructArrayLayout4i8",ba);class th extends Ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,m,S,D,U,$){const X=this.length;return this.resize(X+1),this.emplace(X,o,m,S,D,U,$)}emplace(o,m,S,D,U,$,X){const oe=6*o;return this.int16[oe+0]=m,this.int16[oe+1]=S,this.int16[oe+2]=D,this.int16[oe+3]=U,this.int16[oe+4]=$,this.int16[oe+5]=X,o}}th.prototype.bytesPerElement=12,Yi("StructArrayLayout2i4i12",th);class ec extends Ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,m,S,D,U,$){const X=this.length;return this.resize(X+1),this.emplace(X,o,m,S,D,U,$)}emplace(o,m,S,D,U,$,X){const oe=4*o,fe=8*o;return this.int16[oe+0]=m,this.int16[oe+1]=S,this.uint8[fe+4]=D,this.uint8[fe+5]=U,this.uint8[fe+6]=$,this.uint8[fe+7]=X,o}}ec.prototype.bytesPerElement=8,Yi("StructArrayLayout2i4ub8",ec);class Gc extends Ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,m){const S=this.length;return this.resize(S+1),this.emplace(S,o,m)}emplace(o,m,S){const D=2*o;return this.float32[D+0]=m,this.float32[D+1]=S,o}}Gc.prototype.bytesPerElement=8,Yi("StructArrayLayout2f8",Gc);class vc extends Ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,m,S,D,U,$,X,oe,fe,ve){const Ce=this.length;return this.resize(Ce+1),this.emplace(Ce,o,m,S,D,U,$,X,oe,fe,ve)}emplace(o,m,S,D,U,$,X,oe,fe,ve,Ce){const Be=10*o;return this.uint16[Be+0]=m,this.uint16[Be+1]=S,this.uint16[Be+2]=D,this.uint16[Be+3]=U,this.uint16[Be+4]=$,this.uint16[Be+5]=X,this.uint16[Be+6]=oe,this.uint16[Be+7]=fe,this.uint16[Be+8]=ve,this.uint16[Be+9]=Ce,o}}vc.prototype.bytesPerElement=20,Yi("StructArrayLayout10ui20",vc);class gf extends Ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,m,S,D,U,$,X,oe,fe,ve,Ce,Be){const je=this.length;return this.resize(je+1),this.emplace(je,o,m,S,D,U,$,X,oe,fe,ve,Ce,Be)}emplace(o,m,S,D,U,$,X,oe,fe,ve,Ce,Be,je){const Ge=12*o;return this.int16[Ge+0]=m,this.int16[Ge+1]=S,this.int16[Ge+2]=D,this.int16[Ge+3]=U,this.uint16[Ge+4]=$,this.uint16[Ge+5]=X,this.uint16[Ge+6]=oe,this.uint16[Ge+7]=fe,this.int16[Ge+8]=ve,this.int16[Ge+9]=Ce,this.int16[Ge+10]=Be,this.int16[Ge+11]=je,o}}gf.prototype.bytesPerElement=24,Yi("StructArrayLayout4i4ui4i24",gf);class _f extends Ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,m,S){const D=this.length;return this.resize(D+1),this.emplace(D,o,m,S)}emplace(o,m,S,D){const U=3*o;return this.float32[U+0]=m,this.float32[U+1]=S,this.float32[U+2]=D,o}}_f.prototype.bytesPerElement=12,Yi("StructArrayLayout3f12",_f);class nh extends Ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(o){const m=this.length;return this.resize(m+1),this.emplace(m,o)}emplace(o,m){return this.uint32[1*o+0]=m,o}}nh.prototype.bytesPerElement=4,Yi("StructArrayLayout1ul4",nh);class xc extends Ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,m,S,D,U,$,X,oe,fe){const ve=this.length;return this.resize(ve+1),this.emplace(ve,o,m,S,D,U,$,X,oe,fe)}emplace(o,m,S,D,U,$,X,oe,fe,ve){const Ce=10*o,Be=5*o;return this.int16[Ce+0]=m,this.int16[Ce+1]=S,this.int16[Ce+2]=D,this.int16[Ce+3]=U,this.int16[Ce+4]=$,this.int16[Ce+5]=X,this.uint32[Be+3]=oe,this.uint16[Ce+8]=fe,this.uint16[Ce+9]=ve,o}}xc.prototype.bytesPerElement=20,Yi("StructArrayLayout6i1ul2ui20",xc);class Xn extends Ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,m,S,D,U,$){const X=this.length;return this.resize(X+1),this.emplace(X,o,m,S,D,U,$)}emplace(o,m,S,D,U,$,X){const oe=6*o;return this.int16[oe+0]=m,this.int16[oe+1]=S,this.int16[oe+2]=D,this.int16[oe+3]=U,this.int16[oe+4]=$,this.int16[oe+5]=X,o}}Xn.prototype.bytesPerElement=12,Yi("StructArrayLayout2i2i2i12",Xn);class Ei extends Ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,m,S,D,U){const $=this.length;return this.resize($+1),this.emplace($,o,m,S,D,U)}emplace(o,m,S,D,U,$){const X=4*o,oe=8*o;return this.float32[X+0]=m,this.float32[X+1]=S,this.float32[X+2]=D,this.int16[oe+6]=U,this.int16[oe+7]=$,o}}Ei.prototype.bytesPerElement=16,Yi("StructArrayLayout2f1f2i16",Ei);class bc extends Ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(o,m,S,D,U,$){const X=this.length;return this.resize(X+1),this.emplace(X,o,m,S,D,U,$)}emplace(o,m,S,D,U,$,X){const oe=16*o,fe=4*o,ve=8*o;return this.uint8[oe+0]=m,this.uint8[oe+1]=S,this.float32[fe+1]=D,this.float32[fe+2]=U,this.int16[ve+6]=$,this.int16[ve+7]=X,o}}bc.prototype.bytesPerElement=16,Yi("StructArrayLayout2ub2f2i16",bc);class _a extends Ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,m,S){const D=this.length;return this.resize(D+1),this.emplace(D,o,m,S)}emplace(o,m,S,D){const U=3*o;return this.uint16[U+0]=m,this.uint16[U+1]=S,this.uint16[U+2]=D,o}}_a.prototype.bytesPerElement=6,Yi("StructArrayLayout3ui6",_a);class tn extends Ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,m,S,D,U,$,X,oe,fe,ve,Ce,Be,je,Ge,lt,Tt,Ot){const ln=this.length;return this.resize(ln+1),this.emplace(ln,o,m,S,D,U,$,X,oe,fe,ve,Ce,Be,je,Ge,lt,Tt,Ot)}emplace(o,m,S,D,U,$,X,oe,fe,ve,Ce,Be,je,Ge,lt,Tt,Ot,ln){const Zt=24*o,Ne=12*o,xt=48*o;return this.int16[Zt+0]=m,this.int16[Zt+1]=S,this.uint16[Zt+2]=D,this.uint16[Zt+3]=U,this.uint32[Ne+2]=$,this.uint32[Ne+3]=X,this.uint32[Ne+4]=oe,this.uint16[Zt+10]=fe,this.uint16[Zt+11]=ve,this.uint16[Zt+12]=Ce,this.float32[Ne+7]=Be,this.float32[Ne+8]=je,this.uint8[xt+36]=Ge,this.uint8[xt+37]=lt,this.uint8[xt+38]=Tt,this.uint32[Ne+10]=Ot,this.int16[Zt+22]=ln,o}}tn.prototype.bytesPerElement=48,Yi("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",tn);class mp extends Ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,m,S,D,U,$,X,oe,fe,ve,Ce,Be,je,Ge,lt,Tt,Ot,ln,Zt,Ne,xt,Yt,Dn,bi,Un,Kn,Di,Si){const Li=this.length;return this.resize(Li+1),this.emplace(Li,o,m,S,D,U,$,X,oe,fe,ve,Ce,Be,je,Ge,lt,Tt,Ot,ln,Zt,Ne,xt,Yt,Dn,bi,Un,Kn,Di,Si)}emplace(o,m,S,D,U,$,X,oe,fe,ve,Ce,Be,je,Ge,lt,Tt,Ot,ln,Zt,Ne,xt,Yt,Dn,bi,Un,Kn,Di,Si,Li){const ni=32*o,ar=16*o;return this.int16[ni+0]=m,this.int16[ni+1]=S,this.int16[ni+2]=D,this.int16[ni+3]=U,this.int16[ni+4]=$,this.int16[ni+5]=X,this.int16[ni+6]=oe,this.int16[ni+7]=fe,this.uint16[ni+8]=ve,this.uint16[ni+9]=Ce,this.uint16[ni+10]=Be,this.uint16[ni+11]=je,this.uint16[ni+12]=Ge,this.uint16[ni+13]=lt,this.uint16[ni+14]=Tt,this.uint16[ni+15]=Ot,this.uint16[ni+16]=ln,this.uint16[ni+17]=Zt,this.uint16[ni+18]=Ne,this.uint16[ni+19]=xt,this.uint16[ni+20]=Yt,this.uint16[ni+21]=Dn,this.uint16[ni+22]=bi,this.uint32[ar+12]=Un,this.float32[ar+13]=Kn,this.float32[ar+14]=Di,this.uint16[ni+30]=Si,this.uint16[ni+31]=Li,o}}mp.prototype.bytesPerElement=64,Yi("StructArrayLayout8i15ui1ul2f2ui64",mp);class ih extends Ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o){const m=this.length;return this.resize(m+1),this.emplace(m,o)}emplace(o,m){return this.float32[1*o+0]=m,o}}ih.prototype.bytesPerElement=4,Yi("StructArrayLayout1f4",ih);class yf extends Ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,m,S){const D=this.length;return this.resize(D+1),this.emplace(D,o,m,S)}emplace(o,m,S,D){const U=3*o;return this.uint16[6*o+0]=m,this.float32[U+1]=S,this.float32[U+2]=D,o}}yf.prototype.bytesPerElement=12,Yi("StructArrayLayout1ui2f12",yf);class B extends Ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,m,S){const D=this.length;return this.resize(D+1),this.emplace(D,o,m,S)}emplace(o,m,S,D){const U=4*o;return this.uint32[2*o+0]=m,this.uint16[U+2]=S,this.uint16[U+3]=D,o}}B.prototype.bytesPerElement=8,Yi("StructArrayLayout1ul2ui8",B);class r extends Ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o,m){const S=this.length;return this.resize(S+1),this.emplace(S,o,m)}emplace(o,m,S){const D=2*o;return this.uint16[D+0]=m,this.uint16[D+1]=S,o}}r.prototype.bytesPerElement=4,Yi("StructArrayLayout2ui4",r);class p extends Ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(o){const m=this.length;return this.resize(m+1),this.emplace(m,o)}emplace(o,m){return this.uint16[1*o+0]=m,o}}p.prototype.bytesPerElement=2,Yi("StructArrayLayout1ui2",p);class C extends Ra{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(o,m,S,D){const U=this.length;return this.resize(U+1),this.emplace(U,o,m,S,D)}emplace(o,m,S,D,U){const $=4*o;return this.float32[$+0]=m,this.float32[$+1]=S,this.float32[$+2]=D,this.float32[$+3]=U,o}}C.prototype.bytesPerElement=16,Yi("StructArrayLayout4f16",C);class k extends vu{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new ce(this.anchorPointX,this.anchorPointY)}}k.prototype.size=20;class j extends xc{get(o){return new k(this,o)}}Yi("CollisionBoxArray",j);class Z extends vu{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(o){this._structArray.uint8[this._pos1+37]=o}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(o){this._structArray.uint8[this._pos1+38]=o}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(o){this._structArray.uint32[this._pos4+10]=o}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}Z.prototype.size=48;class re extends tn{get(o){return new Z(this,o)}}Yi("PlacedSymbolArray",re);class ue extends vu{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(o){this._structArray.uint32[this._pos4+12]=o}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}ue.prototype.size=64;class ye extends mp{get(o){return new ue(this,o)}}Yi("SymbolInstanceArray",ye);class Me extends ih{getoffsetX(o){return this.float32[1*o+0]}}Yi("GlyphOffsetArray",Me);class Re extends Go{getx(o){return this.int16[3*o+0]}gety(o){return this.int16[3*o+1]}gettileUnitDistanceFromAnchor(o){return this.int16[3*o+2]}}Yi("SymbolLineVertexArray",Re);class ze extends vu{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}ze.prototype.size=12;class Je extends yf{get(o){return new ze(this,o)}}Yi("TextAnchorOffsetArray",Je);class ot extends vu{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}ot.prototype.size=8;class Pt extends B{get(o){return new ot(this,o)}}Yi("FeatureIndexArray",Pt);class Et extends Sd{}class Lt extends Sd{}class jt extends Sd{}class Nt extends th{}class Bt extends ec{}class nn extends Gc{}class rn extends vc{}class an extends gf{}class Mn extends _f{}class Rn extends nh{}class Hn extends Xn{}class ei extends bc{}class jn extends _a{}class Ri extends r{}const zi=cs([{name:"a_pos",components:2,type:"Int16"}],4),{members:xi}=zi;class Gi{constructor(o=[]){this._forceNewSegmentOnNextPrepare=!1,this.segments=o}prepareSegment(o,m,S,D){const U=this.segments[this.segments.length-1];return o>Gi.MAX_VERTEX_ARRAY_LENGTH&&Zn(`Max vertices per segment is ${Gi.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${o}. Consider using the \`fillLargeMeshArrays\` function if you require meshes with more than ${Gi.MAX_VERTEX_ARRAY_LENGTH} vertices.`),this._forceNewSegmentOnNextPrepare||!U||U.vertexLength+o>Gi.MAX_VERTEX_ARRAY_LENGTH||U.sortKey!==D?this.createNewSegment(m,S,D):U}createNewSegment(o,m,S){const D={vertexOffset:o.length,primitiveOffset:m.length,vertexLength:0,primitiveLength:0,vaos:{}};return S!==void 0&&(D.sortKey=S),this._forceNewSegmentOnNextPrepare=!1,this.segments.push(D),D}getOrCreateLatestSegment(o,m,S){return this.prepareSegment(0,o,m,S)}forceNewSegmentOnNextPrepare(){this._forceNewSegmentOnNextPrepare=!0}get(){return this.segments}destroy(){for(const o of this.segments)for(const m in o.vaos)o.vaos[m].destroy()}static simpleSegment(o,m,S,D){return new Gi([{vertexOffset:o,primitiveOffset:m,vertexLength:S,primitiveLength:D,vaos:{},sortKey:0}])}}function Hr(g,o){return 256*(g=Pn(Math.floor(g),0,255))+Pn(Math.floor(o),0,255)}Gi.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Yi("SegmentVector",Gi);const ua=cs([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Ma,La,Ha,Ia={exports:{}},Pa={exports:{}},Wr={exports:{}},ro=function(){if(Ha)return Ia.exports;Ha=1;var g=(Ma||(Ma=1,Pa.exports=function(m,S){var D,U,$,X,oe,fe,ve,Ce;for(U=m.length-(D=3&m.length),$=S,oe=3432918353,fe=461845907,Ce=0;Ce<U;)ve=255&m.charCodeAt(Ce)|(255&m.charCodeAt(++Ce))<<8|(255&m.charCodeAt(++Ce))<<16|(255&m.charCodeAt(++Ce))<<24,++Ce,$=27492+(65535&(X=5*(65535&($=($^=ve=(65535&(ve=(ve=(65535&ve)*oe+(((ve>>>16)*oe&65535)<<16)&4294967295)<<15|ve>>>17))*fe+(((ve>>>16)*fe&65535)<<16)&4294967295)<<13|$>>>19))+((5*($>>>16)&65535)<<16)&4294967295))+((58964+(X>>>16)&65535)<<16);switch(ve=0,D){case 3:ve^=(255&m.charCodeAt(Ce+2))<<16;case 2:ve^=(255&m.charCodeAt(Ce+1))<<8;case 1:$^=ve=(65535&(ve=(ve=(65535&(ve^=255&m.charCodeAt(Ce)))*oe+(((ve>>>16)*oe&65535)<<16)&4294967295)<<15|ve>>>17))*fe+(((ve>>>16)*fe&65535)<<16)&4294967295}return $^=m.length,$=2246822507*(65535&($^=$>>>16))+((2246822507*($>>>16)&65535)<<16)&4294967295,$=3266489909*(65535&($^=$>>>13))+((3266489909*($>>>16)&65535)<<16)&4294967295,($^=$>>>16)>>>0}),Pa.exports),o=(La||(La=1,Wr.exports=function(m,S){for(var D,U=m.length,$=S^U,X=0;U>=4;)D=1540483477*(65535&(D=255&m.charCodeAt(X)|(255&m.charCodeAt(++X))<<8|(255&m.charCodeAt(++X))<<16|(255&m.charCodeAt(++X))<<24))+((1540483477*(D>>>16)&65535)<<16),$=1540483477*(65535&$)+((1540483477*($>>>16)&65535)<<16)^(D=1540483477*(65535&(D^=D>>>24))+((1540483477*(D>>>16)&65535)<<16)),U-=4,++X;switch(U){case 3:$^=(255&m.charCodeAt(X+2))<<16;case 2:$^=(255&m.charCodeAt(X+1))<<8;case 1:$=1540483477*(65535&($^=255&m.charCodeAt(X)))+((1540483477*($>>>16)&65535)<<16)}return $=1540483477*(65535&($^=$>>>13))+((1540483477*($>>>16)&65535)<<16),($^=$>>>15)>>>0}),Wr.exports);return Ia.exports=g,Ia.exports.murmur3=g,Ia.exports.murmur2=o,Ia.exports}(),Is=G(ro);class gs{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(o,m,S,D){this.ids.push(Za(o)),this.positions.push(m,S,D)}getPositions(o){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const m=Za(o);let S=0,D=this.ids.length-1;for(;S<D;){const $=S+D>>1;this.ids[$]>=m?D=$:S=$+1}const U=[];for(;this.ids[S]===m;)U.push({index:this.positions[3*S],start:this.positions[3*S+1],end:this.positions[3*S+2]}),S++;return U}static serialize(o,m){const S=new Float64Array(o.ids),D=new Uint32Array(o.positions);return tc(S,D,0,S.length-1),m&&m.push(S.buffer,D.buffer),{ids:S,positions:D}}static deserialize(o){const m=new gs;return m.ids=o.ids,m.positions=o.positions,m.indexed=!0,m}}function Za(g){const o=+g;return!isNaN(o)&&o<=Number.MAX_SAFE_INTEGER?o:Is(String(g))}function tc(g,o,m,S){for(;m<S;){const D=g[m+S>>1];let U=m-1,$=S+1;for(;;){do U++;while(g[U]<D);do $--;while(g[$]>D);if(U>=$)break;nc(g,U,$),nc(o,3*U,3*$),nc(o,3*U+1,3*$+1),nc(o,3*U+2,3*$+2)}$-m<S-$?(tc(g,o,m,$),m=$+1):(tc(g,o,$+1,S),S=$)}}function nc(g,o,m){const S=g[o];g[o]=g[m],g[m]=S}Yi("FeaturePositionMap",gs);class il{constructor(o,m){this.gl=o.gl,this.location=m}}class rl extends il{constructor(o,m){super(o,m),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1f(this.location,o))}}class xu extends il{constructor(o,m){super(o,m),this.current=[0,0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]&&o[3]===this.current[3]||(this.current=o,this.gl.uniform4f(this.location,o[0],o[1],o[2],o[3]))}}class rh extends il{constructor(o,m){super(o,m),this.current=Br.transparent}set(o){o.r===this.current.r&&o.g===this.current.g&&o.b===this.current.b&&o.a===this.current.a||(this.current=o,this.gl.uniform4f(this.location,o.r,o.g,o.b,o.a))}}const ah=new Float32Array(16);function yo(g){return[Hr(255*g.r,255*g.g),Hr(255*g.b,255*g.a)]}class gl{constructor(o,m,S){this.value=o,this.uniformNames=m.map(D=>`u_${D}`),this.type=S}setUniform(o,m,S){o.set(S.constantOr(this.value))}getBinding(o,m,S){return this.type==="color"?new rh(o,m):new rl(o,m)}}class al{constructor(o,m){this.uniformNames=m.map(S=>`u_${S}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(o,m){this.pixelRatioFrom=m.pixelRatio,this.pixelRatioTo=o.pixelRatio,this.patternFrom=m.tlbr,this.patternTo=o.tlbr}setUniform(o,m,S,D){const U=D==="u_pattern_to"?this.patternTo:D==="u_pattern_from"?this.patternFrom:D==="u_pixel_ratio_to"?this.pixelRatioTo:D==="u_pixel_ratio_from"?this.pixelRatioFrom:null;U&&o.set(U)}getBinding(o,m,S){return S.substr(0,9)==="u_pattern"?new xu(o,m):new rl(o,m)}}class Oo{constructor(o,m,S,D){this.expression=o,this.type=S,this.maxValue=0,this.paintVertexAttributes=m.map(U=>({name:`a_${U}`,type:"Float32",components:S==="color"?2:1,offset:0})),this.paintVertexArray=new D}populatePaintArray(o,m,S,D,U){const $=this.paintVertexArray.length,X=this.expression.evaluate(new ls(0),m,{},D,[],U);this.paintVertexArray.resize(o),this._setPaintValue($,o,X)}updatePaintArray(o,m,S,D){const U=this.expression.evaluate({zoom:0},S,D);this._setPaintValue(o,m,U)}_setPaintValue(o,m,S){if(this.type==="color"){const D=yo(S);for(let U=o;U<m;U++)this.paintVertexArray.emplace(U,D[0],D[1])}else{for(let D=o;D<m;D++)this.paintVertexArray.emplace(D,S);this.maxValue=Math.max(this.maxValue,Math.abs(S))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Fa{constructor(o,m,S,D,U,$){this.expression=o,this.uniformNames=m.map(X=>`u_${X}_t`),this.type=S,this.useIntegerZoom=D,this.zoom=U,this.maxValue=0,this.paintVertexAttributes=m.map(X=>({name:`a_${X}`,type:"Float32",components:S==="color"?4:2,offset:0})),this.paintVertexArray=new $}populatePaintArray(o,m,S,D,U){const $=this.expression.evaluate(new ls(this.zoom),m,{},D,[],U),X=this.expression.evaluate(new ls(this.zoom+1),m,{},D,[],U),oe=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(oe,o,$,X)}updatePaintArray(o,m,S,D){const U=this.expression.evaluate({zoom:this.zoom},S,D),$=this.expression.evaluate({zoom:this.zoom+1},S,D);this._setPaintValue(o,m,U,$)}_setPaintValue(o,m,S,D){if(this.type==="color"){const U=yo(S),$=yo(D);for(let X=o;X<m;X++)this.paintVertexArray.emplace(X,U[0],U[1],$[0],$[1])}else{for(let U=o;U<m;U++)this.paintVertexArray.emplace(U,S,D);this.maxValue=Math.max(this.maxValue,Math.abs(S),Math.abs(D))}}upload(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(o,m){const S=this.useIntegerZoom?Math.floor(m.zoom):m.zoom,D=Pn(this.expression.interpolationFactor(S,this.zoom,this.zoom+1),0,1);o.set(D)}getBinding(o,m,S){return new rl(o,m)}}class us{constructor(o,m,S,D,U,$){this.expression=o,this.type=m,this.useIntegerZoom=S,this.zoom=D,this.layerId=$,this.zoomInPaintVertexArray=new U,this.zoomOutPaintVertexArray=new U}populatePaintArray(o,m,S){const D=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(o),this.zoomOutPaintVertexArray.resize(o),this._setPaintValues(D,o,m.patterns&&m.patterns[this.layerId],S)}updatePaintArray(o,m,S,D,U){this._setPaintValues(o,m,S.patterns&&S.patterns[this.layerId],U)}_setPaintValues(o,m,S,D){if(!D||!S)return;const{min:U,mid:$,max:X}=S,oe=D[U],fe=D[$],ve=D[X];if(oe&&fe&&ve)for(let Ce=o;Ce<m;Ce++)this.zoomInPaintVertexArray.emplace(Ce,fe.tl[0],fe.tl[1],fe.br[0],fe.br[1],oe.tl[0],oe.tl[1],oe.br[0],oe.br[1],fe.pixelRatio,oe.pixelRatio),this.zoomOutPaintVertexArray.emplace(Ce,fe.tl[0],fe.tl[1],fe.br[0],fe.br[1],ve.tl[0],ve.tl[1],ve.br[0],ve.br[1],fe.pixelRatio,ve.pixelRatio)}upload(o){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=o.createVertexBuffer(this.zoomInPaintVertexArray,ua.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=o.createVertexBuffer(this.zoomOutPaintVertexArray,ua.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class _l{constructor(o,m,S){this.binders={},this._buffers=[];const D=[];for(const U in o.paint._values){if(!S(U))continue;const $=o.paint.get(U);if(!($ instanceof Fl&&Ll($.property.specification)))continue;const X=Zm(U,o.type),oe=$.value,fe=$.property.specification.type,ve=$.property.useIntegerZoom,Ce=$.property.specification["property-type"],Be=Ce==="cross-faded"||Ce==="cross-faded-data-driven";if(oe.kind==="constant")this.binders[U]=Be?new al(oe.value,X):new gl(oe.value,X,fe),D.push(`/u_${U}`);else if(oe.kind==="source"||Be){const je=Td(U,fe,"source");this.binders[U]=Be?new us(oe,fe,ve,m,je,o.id):new Oo(oe,X,fe,je),D.push(`/a_${U}`)}else{const je=Td(U,fe,"composite");this.binders[U]=new Fa(oe,X,fe,ve,m,je),D.push(`/z_${U}`)}}this.cacheKey=D.sort().join("")}getMaxValue(o){const m=this.binders[o];return m instanceof Oo||m instanceof Fa?m.maxValue:0}populatePaintArrays(o,m,S,D,U){for(const $ in this.binders){const X=this.binders[$];(X instanceof Oo||X instanceof Fa||X instanceof us)&&X.populatePaintArray(o,m,S,D,U)}}setConstantPatternPositions(o,m){for(const S in this.binders){const D=this.binders[S];D instanceof al&&D.setConstantPatternPositions(o,m)}}updatePaintArrays(o,m,S,D,U){let $=!1;for(const X in o){const oe=m.getPositions(X);for(const fe of oe){const ve=S.feature(fe.index);for(const Ce in this.binders){const Be=this.binders[Ce];if((Be instanceof Oo||Be instanceof Fa||Be instanceof us)&&Be.expression.isStateDependent===!0){const je=D.paint.get(Ce);Be.expression=je.value,Be.updatePaintArray(fe.start,fe.end,ve,o[X],U),$=!0}}}}return $}defines(){const o=[];for(const m in this.binders){const S=this.binders[m];(S instanceof gl||S instanceof al)&&o.push(...S.uniformNames.map(D=>`#define HAS_UNIFORM_${D}`))}return o}getBinderAttributes(){const o=[];for(const m in this.binders){const S=this.binders[m];if(S instanceof Oo||S instanceof Fa)for(let D=0;D<S.paintVertexAttributes.length;D++)o.push(S.paintVertexAttributes[D].name);else if(S instanceof us)for(let D=0;D<ua.members.length;D++)o.push(ua.members[D].name)}return o}getBinderUniforms(){const o=[];for(const m in this.binders){const S=this.binders[m];if(S instanceof gl||S instanceof al||S instanceof Fa)for(const D of S.uniformNames)o.push(D)}return o}getPaintVertexBuffers(){return this._buffers}getUniforms(o,m){const S=[];for(const D in this.binders){const U=this.binders[D];if(U instanceof gl||U instanceof al||U instanceof Fa){for(const $ of U.uniformNames)if(m[$]){const X=U.getBinding(o,m[$],$);S.push({name:$,property:D,binding:X})}}}return S}setUniforms(o,m,S,D){for(const{name:U,property:$,binding:X}of m)this.binders[$].setUniform(X,D,S.get($),U)}updatePaintBuffers(o){this._buffers=[];for(const m in this.binders){const S=this.binders[m];if(o&&S instanceof us){const D=o.fromScale===2?S.zoomInPaintVertexBuffer:S.zoomOutPaintVertexBuffer;D&&this._buffers.push(D)}else(S instanceof Oo||S instanceof Fa)&&S.paintVertexBuffer&&this._buffers.push(S.paintVertexBuffer)}}upload(o){for(const m in this.binders){const S=this.binders[m];(S instanceof Oo||S instanceof Fa||S instanceof us)&&S.upload(o)}this.updatePaintBuffers()}destroy(){for(const o in this.binders){const m=this.binders[o];(m instanceof Oo||m instanceof Fa||m instanceof us)&&m.destroy()}}}class _s{constructor(o,m,S=()=>!0){this.programConfigurations={};for(const D of o)this.programConfigurations[D.id]=new _l(D,m,S);this.needsUpload=!1,this._featureMap=new gs,this._bufferOffset=0}populatePaintArrays(o,m,S,D,U,$){for(const X in this.programConfigurations)this.programConfigurations[X].populatePaintArrays(o,m,D,U,$);m.id!==void 0&&this._featureMap.add(m.id,S,this._bufferOffset,o),this._bufferOffset=o,this.needsUpload=!0}updatePaintArrays(o,m,S,D){for(const U of S)this.needsUpload=this.programConfigurations[U.id].updatePaintArrays(o,this._featureMap,m,U,D)||this.needsUpload}get(o){return this.programConfigurations[o]}upload(o){if(this.needsUpload){for(const m in this.programConfigurations)this.programConfigurations[m].upload(o);this.needsUpload=!1}}destroy(){for(const o in this.programConfigurations)this.programConfigurations[o].destroy()}}function Zm(g,o){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[g]||[g.replace(`${o}-`,"").replace(/-/g,"_")]}function Td(g,o,m){const S={color:{source:Gc,composite:C},number:{source:ih,composite:Gc}},D=function(U){return{"line-pattern":{source:rn,composite:rn},"fill-pattern":{source:rn,composite:rn},"fill-extrusion-pattern":{source:rn,composite:rn}}[U]}(g);return D&&D[m]||S[o][m]}Yi("ConstantBinder",gl),Yi("CrossFadedConstantBinder",al),Yi("SourceExpressionBinder",Oo),Yi("CrossFadedCompositeBinder",us),Yi("CompositeExpressionBinder",Fa),Yi("ProgramConfiguration",_l,{omit:["_buffers"]}),Yi("ProgramConfigurationSet",_s);const Lh=Math.pow(2,14)-1,sl=-Lh-1;function wc(g){const o=pn/g.extent,m=g.loadGeometry();for(let S=0;S<m.length;S++){const D=m[S];for(let U=0;U<D.length;U++){const $=D[U],X=Math.round($.x*o),oe=Math.round($.y*o);$.x=Pn(X,sl,Lh),$.y=Pn(oe,sl,Lh),(X<$.x||X>$.x+1||oe<$.y||oe>$.y+1)&&Zn("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return m}function sh(g,o){return{type:g.type,id:g.id,properties:g.properties,geometry:o?wc(g):[]}}const bu=-32768;function rm(g,o,m,S,D){g.emplaceBack(bu+8*o+S,bu+8*m+D)}class gp{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(m=>m.id),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new Lt,this.indexArray=new jn,this.segments=new Gi,this.programConfigurations=new _s(o.layers,o.zoom),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id)}populate(o,m,S){const D=this.layers[0],U=[];let $=null,X=!1,oe=D.type==="heatmap";if(D.type==="circle"){const ve=D;$=ve.layout.get("circle-sort-key"),X=!$.isConstant(),oe=oe||ve.paint.get("circle-pitch-alignment")==="map"}const fe=oe?m.subdivisionGranularity.circle:1;for(const{feature:ve,id:Ce,index:Be,sourceLayerIndex:je}of o){const Ge=this.layers[0]._featureFilter.needGeometry,lt=sh(ve,Ge);if(!this.layers[0]._featureFilter.filter(new ls(this.zoom),lt,S))continue;const Tt=X?$.evaluate(lt,{},S):void 0,Ot={id:Ce,properties:ve.properties,type:ve.type,sourceLayerIndex:je,index:Be,geometry:Ge?lt.geometry:wc(ve),patterns:{},sortKey:Tt};U.push(Ot)}X&&U.sort((ve,Ce)=>ve.sortKey-Ce.sortKey);for(const ve of U){const{geometry:Ce,index:Be,sourceLayerIndex:je}=ve,Ge=o[Be].feature;this.addFeature(ve,Ce,Be,S,fe),m.featureIndex.insert(Ge,Ce,Be,je,this.index)}}update(o,m,S){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,m,this.stateDependentLayers,S)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,xi),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(o,m,S,D,U=1){let $;switch(U){case 1:$=[0,7];break;case 3:$=[0,2,5,7];break;case 5:$=[0,1,3,4,6,7];break;case 7:$=[0,1,2,3,4,5,6,7];break;default:throw new Error(`Invalid circle bucket granularity: ${U}; valid values are 1, 3, 5, 7.`)}const X=$.length;for(const oe of m)for(const fe of oe){const ve=fe.x,Ce=fe.y;if(ve<0||ve>=pn||Ce<0||Ce>=pn)continue;const Be=this.segments.prepareSegment(X*X,this.layoutVertexArray,this.indexArray,o.sortKey),je=Be.vertexLength;for(let Ge=0;Ge<X;Ge++)for(let lt=0;lt<X;lt++)rm(this.layoutVertexArray,ve,Ce,$[lt],$[Ge]);for(let Ge=0;Ge<X-1;Ge++)for(let lt=0;lt<X-1;lt++){const Tt=je+Ge*X+lt,Ot=je+(Ge+1)*X+lt;this.indexArray.emplaceBack(Tt,Ot+1,Tt+1),this.indexArray.emplaceBack(Tt,Ot,Ot+1)}Be.vertexLength+=X*X,Be.primitiveLength+=(X-1)*(X-1)*2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,S,{},D)}}function vf(g,o){for(let m=0;m<g.length;m++)if(ic(o,g[m]))return!0;for(let m=0;m<o.length;m++)if(ic(g,o[m]))return!0;return!!Ug(g,o)}function Wa(g,o,m){return!!ic(g,o)||!!Wm(o,g,m)}function Cd(g,o){if(g.length===1)return _p(o,g[0]);for(let m=0;m<o.length;m++){const S=o[m];for(let D=0;D<S.length;D++)if(ic(g,S[D]))return!0}for(let m=0;m<g.length;m++)if(_p(o,g[m]))return!0;for(let m=0;m<o.length;m++)if(Ug(g,o[m]))return!0;return!1}function am(g,o,m){if(g.length>1){if(Ug(g,o))return!0;for(let S=0;S<o.length;S++)if(Wm(o[S],g,m))return!0}for(let S=0;S<g.length;S++)if(Wm(g[S],o,m))return!0;return!1}function Ug(g,o){if(g.length===0||o.length===0)return!1;for(let m=0;m<g.length-1;m++){const S=g[m],D=g[m+1];for(let U=0;U<o.length-1;U++)if(xf(S,D,o[U],o[U+1]))return!0}return!1}function xf(g,o,m,S){return St(g,m,S)!==St(o,m,S)&&St(g,o,m)!==St(g,o,S)}function Wm(g,o,m){const S=m*m;if(o.length===1)return g.distSqr(o[0])<S;for(let D=1;D<o.length;D++)if(sm(g,o[D-1],o[D])<S)return!0;return!1}function sm(g,o,m){const S=o.distSqr(m);if(S===0)return g.distSqr(o);const D=((g.x-o.x)*(m.x-o.x)+(g.y-o.y)*(m.y-o.y))/S;return g.distSqr(D<0?o:D>1?m:m.sub(o)._mult(D)._add(o))}function _p(g,o){let m,S,D,U=!1;for(let $=0;$<g.length;$++){m=g[$];for(let X=0,oe=m.length-1;X<m.length;oe=X++)S=m[X],D=m[oe],S.y>o.y!=D.y>o.y&&o.x<(D.x-S.x)*(o.y-S.y)/(D.y-S.y)+S.x&&(U=!U)}return U}function ic(g,o){let m=!1;for(let S=0,D=g.length-1;S<g.length;D=S++){const U=g[S],$=g[D];U.y>o.y!=$.y>o.y&&o.x<($.x-U.x)*(o.y-U.y)/($.y-U.y)+U.x&&(m=!m)}return m}function yp(g,o,m){const S=m[0],D=m[2];if(g.x<S.x&&o.x<S.x||g.x>D.x&&o.x>D.x||g.y<S.y&&o.y<S.y||g.y>D.y&&o.y>D.y)return!1;const U=St(g,o,m[0]);return U!==St(g,o,m[1])||U!==St(g,o,m[2])||U!==St(g,o,m[3])}function Ba(g,o,m){const S=o.paint.get(g).value;return S.kind==="constant"?S.value:m.programConfigurations.get(o.id).getMaxValue(g)}function rc(g){return Math.sqrt(g[0]*g[0]+g[1]*g[1])}function vp(g,o,m,S,D){if(!o[0]&&!o[1])return g;const U=ce.convert(o)._mult(D);m==="viewport"&&U._rotate(-S);const $=[];for(let X=0;X<g.length;X++)$.push(g[X].sub(U));return $}let xp,$g;Yi("CircleBucket",gp,{omit:["layers"]});var Gg={get paint(){return $g=$g||new $o({"circle-radius":new xr(bt.paint_circle["circle-radius"]),"circle-color":new xr(bt.paint_circle["circle-color"]),"circle-blur":new xr(bt.paint_circle["circle-blur"]),"circle-opacity":new xr(bt.paint_circle["circle-opacity"]),"circle-translate":new cr(bt.paint_circle["circle-translate"]),"circle-translate-anchor":new cr(bt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new cr(bt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new cr(bt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new xr(bt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new xr(bt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new xr(bt.paint_circle["circle-stroke-opacity"])})},get layout(){return xp=xp||new $o({"circle-sort-key":new xr(bt.layout_circle["circle-sort-key"])})}};class om extends Ss{constructor(o){super(o,Gg)}createBucket(o){return new gp(o)}queryRadius(o){const m=o;return Ba("circle-radius",this,m)+Ba("circle-stroke-width",this,m)+rc(this.paint.get("circle-translate"))}queryIntersectsFeature({queryGeometry:o,feature:m,featureState:S,geometry:D,transform:U,pixelsToTileUnits:$,pixelPosMatrix:X}){const oe=vp(o,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),-U.bearingInRadians,$),fe=this.paint.get("circle-radius").evaluate(m,S)+this.paint.get("circle-stroke-width").evaluate(m,S),ve=this.paint.get("circle-pitch-alignment")==="map",Ce=ve?oe:function(je,Ge){return je.map(lt=>sy(lt,Ge))}(oe,X),Be=ve?fe*$:fe;for(const je of D)for(const Ge of je){const lt=ve?Ge:sy(Ge,X);let Tt=Be;const Ot=ft([],[Ge.x,Ge.y,0,1],X);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Tt*=Ot[3]/U.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Tt*=U.cameraToCenterDistance/Ot[3]),Wa(Ce,lt,Tt))return!0}return!1}}function sy(g,o){const m=ft([],[g.x,g.y,0,1],o);return new ce(m[0]/m[3],m[1]/m[3])}class oy extends gp{}let Xm;Yi("HeatmapBucket",oy,{omit:["layers"]});var Ym={get paint(){return Xm=Xm||new $o({"heatmap-radius":new xr(bt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new xr(bt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new cr(bt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Bl(bt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new cr(bt.paint_heatmap["heatmap-opacity"])})}};function Ed(g,{width:o,height:m},S,D){if(D){if(D instanceof Uint8ClampedArray)D=new Uint8Array(D.buffer);else if(D.length!==o*m*S)throw new RangeError(`mismatched image size. expected: ${D.length} but got: ${o*m*S}`)}else D=new Uint8Array(o*m*S);return g.width=o,g.height=m,g.data=D,g}function bf(g,{width:o,height:m},S){if(o===g.width&&m===g.height)return;const D=Ed({},{width:o,height:m},S);wu(g,D,{x:0,y:0},{x:0,y:0},{width:Math.min(g.width,o),height:Math.min(g.height,m)},S),g.width=o,g.height=m,g.data=D.data}function wu(g,o,m,S,D,U){if(D.width===0||D.height===0)return o;if(D.width>g.width||D.height>g.height||m.x>g.width-D.width||m.y>g.height-D.height)throw new RangeError("out of range source coordinates for image copy");if(D.width>o.width||D.height>o.height||S.x>o.width-D.width||S.y>o.height-D.height)throw new RangeError("out of range destination coordinates for image copy");const $=g.data,X=o.data;if($===X)throw new Error("srcData equals dstData, so image is already copied");for(let oe=0;oe<D.height;oe++){const fe=((m.y+oe)*g.width+m.x)*U,ve=((S.y+oe)*o.width+S.x)*U;for(let Ce=0;Ce<D.width*U;Ce++)X[ve+Ce]=$[fe+Ce]}return o}class Vl{constructor(o,m){Ed(this,o,1,m)}resize(o){bf(this,o,1)}clone(){return new Vl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,m,S,D,U){wu(o,m,S,D,U,1)}}class vo{constructor(o,m){Ed(this,o,4,m)}resize(o){bf(this,o,4)}replace(o,m){m?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o}clone(){return new vo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(o,m,S,D,U){wu(o,m,S,D,U,4)}}function Md(g){const o={},m=g.resolution||256,S=g.clips?g.clips.length:1,D=g.image||new vo({width:m,height:S});if(Math.log(m)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${m}`);const U=($,X,oe)=>{o[g.evaluationKey]=oe;const fe=g.expression.evaluate(o);D.data[$+X+0]=Math.floor(255*fe.r/fe.a),D.data[$+X+1]=Math.floor(255*fe.g/fe.a),D.data[$+X+2]=Math.floor(255*fe.b/fe.a),D.data[$+X+3]=Math.floor(255*fe.a)};if(g.clips)for(let $=0,X=0;$<S;++$,X+=4*m)for(let oe=0,fe=0;oe<m;oe++,fe+=4){const ve=oe/(m-1),{start:Ce,end:Be}=g.clips[$];U(X,fe,Ce*(1-ve)+Be*ve)}else for(let $=0,X=0;$<m;$++,X+=4)U(0,X,$/(m-1));return D}Yi("AlphaImage",Vl),Yi("RGBAImage",vo);const oh="big-fb";class Sv extends Ss{createBucket(o){return new oy(o)}constructor(o){super(o,Ym),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){o==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Md({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(oh)&&this.heatmapFbos.delete(oh)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let lm;var Tv={get paint(){return lm=lm||new $o({"hillshade-illumination-direction":new cr(bt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new cr(bt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new cr(bt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new cr(bt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new cr(bt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new cr(bt.paint_hillshade["hillshade-accent-color"])})}};class Cv extends Ss{constructor(o){super(o,Tv)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const cm=cs([{name:"a_pos",components:2,type:"Int16"}],4),{members:yl}=cm;function bp(g,o,m){const S=m.patternDependencies;let D=!1;for(const U of o){const $=U.paint.get(`${g}-pattern`);$.isConstant()||(D=!0);const X=$.constantOr(null);X&&(D=!0,S[X.to]=!0,S[X.from]=!0)}return D}function Km(g,o,m,S,D){const U=D.patternDependencies;for(const $ of o){const X=$.paint.get(`${g}-pattern`).value;if(X.kind!=="constant"){let oe=X.evaluate({zoom:S-1},m,{},D.availableImages),fe=X.evaluate({zoom:S},m,{},D.availableImages),ve=X.evaluate({zoom:S+1},m,{},D.availableImages);oe=oe&&oe.name?oe.name:oe,fe=fe&&fe.name?fe.name:fe,ve=ve&&ve.name?ve.name:ve,U[oe]=!0,U[fe]=!0,U[ve]=!0,m.patterns[$.id]={min:oe,mid:fe,max:ve}}}return m}function qg(g,o,m,S,D){let U;if(D===function($,X,oe,fe){let ve=0;for(let Ce=X,Be=oe-fe;Ce<oe;Ce+=fe)ve+=($[Be]-$[Ce])*($[Ce+1]+$[Be+1]),Be=Ce;return ve}(g,o,m,S)>0)for(let $=o;$<m;$+=S)U=_($/S|0,g[$],g[$+1],U);else for(let $=m-S;$>=o;$-=S)U=_($/S|0,g[$],g[$+1],U);return U&&ao(U,U.next)&&(i(U),U=U.next),U}function Sc(g,o){if(!g)return g;o||(o=g);let m,S=g;do if(m=!1,S.steiner||!ao(S,S.next)&&Ga(S.prev,S,S.next)!==0)S=S.next;else{if(i(S),S=o=S.prev,S===S.next)break;m=!0}while(m||S!==o);return o}function Id(g,o,m,S,D,U,$){if(!g)return;!$&&U&&function(oe,fe,ve,Ce){let Be=oe;do Be.z===0&&(Be.z=lh(Be.x,Be.y,fe,ve,Ce)),Be.prevZ=Be.prev,Be.nextZ=Be.next,Be=Be.next;while(Be!==oe);Be.prevZ.nextZ=null,Be.prevZ=null,function(je){let Ge,lt=1;do{let Tt,Ot=je;je=null;let ln=null;for(Ge=0;Ot;){Ge++;let Zt=Ot,Ne=0;for(let Yt=0;Yt<lt&&(Ne++,Zt=Zt.nextZ,Zt);Yt++);let xt=lt;for(;Ne>0||xt>0&&Zt;)Ne!==0&&(xt===0||!Zt||Ot.z<=Zt.z)?(Tt=Ot,Ot=Ot.nextZ,Ne--):(Tt=Zt,Zt=Zt.nextZ,xt--),ln?ln.nextZ=Tt:je=Tt,Tt.prevZ=ln,ln=Tt;Ot=Zt}ln.nextZ=null,lt*=2}while(Ge>1)}(Be)}(g,S,D,U);let X=g;for(;g.prev!==g.next;){const oe=g.prev,fe=g.next;if(U?Hc(g,S,D,U):qc(g))o.push(oe.i,g.i,fe.i),i(g),g=fe.next,X=fe.next;else if((g=fe)===X){$?$===1?Id(g=wp(Sc(g),o),o,m,S,D,U,2):$===2&&Pd(g,o,m,S,D,U):Id(Sc(g),o,m,S,D,U,1);break}}}function qc(g){const o=g.prev,m=g,S=g.next;if(Ga(o,m,S)>=0)return!1;const D=o.x,U=m.x,$=S.x,X=o.y,oe=m.y,fe=S.y,ve=Math.min(D,U,$),Ce=Math.min(X,oe,fe),Be=Math.max(D,U,$),je=Math.max(X,oe,fe);let Ge=S.next;for(;Ge!==o;){if(Ge.x>=ve&&Ge.x<=Be&&Ge.y>=Ce&&Ge.y<=je&&zh(D,X,U,oe,$,fe,Ge.x,Ge.y)&&Ga(Ge.prev,Ge,Ge.next)>=0)return!1;Ge=Ge.next}return!0}function Hc(g,o,m,S){const D=g.prev,U=g,$=g.next;if(Ga(D,U,$)>=0)return!1;const X=D.x,oe=U.x,fe=$.x,ve=D.y,Ce=U.y,Be=$.y,je=Math.min(X,oe,fe),Ge=Math.min(ve,Ce,Be),lt=Math.max(X,oe,fe),Tt=Math.max(ve,Ce,Be),Ot=lh(je,Ge,o,m,S),ln=lh(lt,Tt,o,m,S);let Zt=g.prevZ,Ne=g.nextZ;for(;Zt&&Zt.z>=Ot&&Ne&&Ne.z<=ln;){if(Zt.x>=je&&Zt.x<=lt&&Zt.y>=Ge&&Zt.y<=Tt&&Zt!==D&&Zt!==$&&zh(X,ve,oe,Ce,fe,Be,Zt.x,Zt.y)&&Ga(Zt.prev,Zt,Zt.next)>=0||(Zt=Zt.prevZ,Ne.x>=je&&Ne.x<=lt&&Ne.y>=Ge&&Ne.y<=Tt&&Ne!==D&&Ne!==$&&zh(X,ve,oe,Ce,fe,Be,Ne.x,Ne.y)&&Ga(Ne.prev,Ne,Ne.next)>=0))return!1;Ne=Ne.nextZ}for(;Zt&&Zt.z>=Ot;){if(Zt.x>=je&&Zt.x<=lt&&Zt.y>=Ge&&Zt.y<=Tt&&Zt!==D&&Zt!==$&&zh(X,ve,oe,Ce,fe,Be,Zt.x,Zt.y)&&Ga(Zt.prev,Zt,Zt.next)>=0)return!1;Zt=Zt.prevZ}for(;Ne&&Ne.z<=ln;){if(Ne.x>=je&&Ne.x<=lt&&Ne.y>=Ge&&Ne.y<=Tt&&Ne!==D&&Ne!==$&&zh(X,ve,oe,Ce,fe,Be,Ne.x,Ne.y)&&Ga(Ne.prev,Ne,Ne.next)>=0)return!1;Ne=Ne.nextZ}return!0}function wp(g,o){let m=g;do{const S=m.prev,D=m.next.next;!ao(S,D)&&Nl(S,m,m.next,D)&&xo(S,D)&&xo(D,S)&&(o.push(S.i,m.i,D.i),i(m),i(m.next),m=g=D),m=m.next}while(m!==g);return Sc(m)}function Pd(g,o,m,S,D,U){let $=g;do{let X=$.next.next;for(;X!==$.prev;){if($.i!==X.i&&ch($,X)){let oe=ly($,X);return $=Sc($,$.next),oe=Sc(oe,oe.next),Id($,o,m,S,D,U,0),void Id(oe,o,m,S,D,U,0)}X=X.next}$=$.next}while($!==g)}function Sp(g,o){let m=g.x-o.x;return m===0&&(m=g.y-o.y,m===0)&&(m=(g.next.y-g.y)/(g.next.x-g.x)-(o.next.y-o.y)/(o.next.x-o.x)),m}function Hg(g,o){const m=function(D,U){let $=U;const X=D.x,oe=D.y;let fe,ve=-1/0;if(ao(D,$))return $;do{if(ao(D,$.next))return $.next;if(oe<=$.y&&oe>=$.next.y&&$.next.y!==$.y){const lt=$.x+(oe-$.y)*($.next.x-$.x)/($.next.y-$.y);if(lt<=X&&lt>ve&&(ve=lt,fe=$.x<$.next.x?$:$.next,lt===X))return fe}$=$.next}while($!==U);if(!fe)return null;const Ce=fe,Be=fe.x,je=fe.y;let Ge=1/0;$=fe;do{if(X>=$.x&&$.x>=Be&&X!==$.x&&Zg(oe<je?X:ve,oe,Be,je,oe<je?ve:X,oe,$.x,$.y)){const lt=Math.abs(oe-$.y)/(X-$.x);xo($,D)&&(lt<Ge||lt===Ge&&($.x>fe.x||$.x===fe.x&&Kr(fe,$)))&&(fe=$,Ge=lt)}$=$.next}while($!==Ce);return fe}(g,o);if(!m)return o;const S=ly(m,g);return Sc(S,S.next),Sc(m,m.next)}function Kr(g,o){return Ga(g.prev,g,o.prev)<0&&Ga(o.next,g,g.next)<0}function lh(g,o,m,S,D){return(g=1431655765&((g=858993459&((g=252645135&((g=16711935&((g=(g-m)*D|0)|g<<8))|g<<4))|g<<2))|g<<1))|(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-S)*D|0)|o<<8))|o<<4))|o<<2))|o<<1))<<1}function Ev(g){let o=g,m=g;do(o.x<m.x||o.x===m.x&&o.y<m.y)&&(m=o),o=o.next;while(o!==g);return m}function Zg(g,o,m,S,D,U,$,X){return(D-$)*(o-X)>=(g-$)*(U-X)&&(g-$)*(S-X)>=(m-$)*(o-X)&&(m-$)*(U-X)>=(D-$)*(S-X)}function zh(g,o,m,S,D,U,$,X){return!(g===$&&o===X)&&Zg(g,o,m,S,D,U,$,X)}function ch(g,o){return g.next.i!==o.i&&g.prev.i!==o.i&&!function(m,S){let D=m;do{if(D.i!==m.i&&D.next.i!==m.i&&D.i!==S.i&&D.next.i!==S.i&&Nl(D,D.next,m,S))return!0;D=D.next}while(D!==m);return!1}(g,o)&&(xo(g,o)&&xo(o,g)&&function(m,S){let D=m,U=!1;const $=(m.x+S.x)/2,X=(m.y+S.y)/2;do D.y>X!=D.next.y>X&&D.next.y!==D.y&&$<(D.next.x-D.x)*(X-D.y)/(D.next.y-D.y)+D.x&&(U=!U),D=D.next;while(D!==m);return U}(g,o)&&(Ga(g.prev,g,o.prev)||Ga(g,o.prev,o))||ao(g,o)&&Ga(g.prev,g,g.next)>0&&Ga(o.prev,o,o.next)>0)}function Ga(g,o,m){return(o.y-g.y)*(m.x-o.x)-(o.x-g.x)*(m.y-o.y)}function ao(g,o){return g.x===o.x&&g.y===o.y}function Nl(g,o,m,S){const D=um(Ga(g,o,m)),U=um(Ga(g,o,S)),$=um(Ga(m,S,g)),X=um(Ga(m,S,o));return D!==U&&$!==X||!(D!==0||!Ws(g,m,o))||!(U!==0||!Ws(g,S,o))||!($!==0||!Ws(m,g,S))||!(X!==0||!Ws(m,o,S))}function Ws(g,o,m){return o.x<=Math.max(g.x,m.x)&&o.x>=Math.min(g.x,m.x)&&o.y<=Math.max(g.y,m.y)&&o.y>=Math.min(g.y,m.y)}function um(g){return g>0?1:g<0?-1:0}function xo(g,o){return Ga(g.prev,g,g.next)<0?Ga(g,o,g.next)>=0&&Ga(g,g.prev,o)>=0:Ga(g,o,g.prev)<0||Ga(g,g.next,o)<0}function ly(g,o){const m=l(g.i,g.x,g.y),S=l(o.i,o.x,o.y),D=g.next,U=o.prev;return g.next=o,o.prev=g,m.next=D,D.prev=m,S.next=m,m.prev=S,U.next=S,S.prev=U,S}function _(g,o,m,S){const D=l(g,o,m);return S?(D.next=S.next,D.prev=S,S.next.prev=D,S.next=D):(D.prev=D,D.next=D),D}function i(g){g.next.prev=g.prev,g.prev.next=g.next,g.prevZ&&(g.prevZ.nextZ=g.nextZ),g.nextZ&&(g.nextZ.prevZ=g.prevZ)}function l(g,o,m){return{i:g,x:o,y:m,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}class y{constructor(o,m){if(m>o)throw new Error("Min granularity must not be greater than base granularity.");this._baseZoomGranularity=o,this._minGranularity=m}getGranularityForZoomLevel(o){return Math.max(Math.floor(this._baseZoomGranularity/(1<<o)),this._minGranularity,1)}}class w{constructor(o){this.fill=o.fill,this.line=o.line,this.tile=o.tile,this.stencil=o.stencil,this.circle=o.circle}}w.noSubdivision=new w({fill:new y(0,0),line:new y(0,0),tile:new y(0,0),stencil:new y(0,0),circle:1}),Yi("SubdivisionGranularityExpression",y),Yi("SubdivisionGranularitySetting",w);const M=-32768,A=32767;class V{constructor(o,m){this._vertexBuffer=[],this._vertexDictionary=new Map,this._used=!1,this._granularity=o,this._granularityCellSize=pn/o,this._canonical=m}_getKey(o,m){return(o+=32768)<<16|(m+=32768)<<0}_vertexToIndex(o,m){if(o<-32768||m<-32768||o>32767||m>32767)throw new Error("Vertex coordinates are out of signed 16 bit integer range.");const S=0|Math.round(o),D=0|Math.round(m),U=this._getKey(S,D);if(this._vertexDictionary.has(U))return this._vertexDictionary.get(U);const $=this._vertexBuffer.length/2;return this._vertexDictionary.set(U,$),this._vertexBuffer.push(S,D),$}_subdivideTrianglesScanline(o){if(this._granularity<2)return function(D,U){const $=[];for(let X=0;X<U.length;X+=3){const oe=U[X],fe=U[X+1],ve=U[X+2],Ce=D[2*oe],Be=D[2*oe+1];(D[2*fe]-Ce)*(D[2*ve+1]-Be)-(D[2*fe+1]-Be)*(D[2*ve]-Ce)>0?($.push(oe),$.push(ve),$.push(fe)):($.push(oe),$.push(fe),$.push(ve))}return $}(this._vertexBuffer,o);const m=[],S=o.length;for(let D=0;D<S;D+=3){const U=[o[D+0],o[D+1],o[D+2]],$=[this._vertexBuffer[2*o[D+0]+0],this._vertexBuffer[2*o[D+0]+1],this._vertexBuffer[2*o[D+1]+0],this._vertexBuffer[2*o[D+1]+1],this._vertexBuffer[2*o[D+2]+0],this._vertexBuffer[2*o[D+2]+1]];let X=1/0,oe=1/0,fe=-1/0,ve=-1/0;for(let lt=0;lt<3;lt++){const Tt=$[2*lt],Ot=$[2*lt+1];X=Math.min(X,Tt),fe=Math.max(fe,Tt),oe=Math.min(oe,Ot),ve=Math.max(ve,Ot)}if(X===fe||oe===ve)continue;const Ce=Math.floor(X/this._granularityCellSize),Be=Math.ceil(fe/this._granularityCellSize),je=Math.floor(oe/this._granularityCellSize),Ge=Math.ceil(ve/this._granularityCellSize);if(Ce!==Be||je!==Ge)for(let lt=je;lt<Ge;lt++){const Tt=this._scanlineGenerateVertexRingForCellRow(lt,$,U);ee(this._vertexBuffer,Tt,m)}else m.push(...U)}return m}_scanlineGenerateVertexRingForCellRow(o,m,S){const D=o*this._granularityCellSize,U=D+this._granularityCellSize,$=[];for(let X=0;X<3;X++){const oe=m[2*X],fe=m[2*X+1],ve=m[2*(X+1)%6],Ce=m[(2*(X+1)+1)%6],Be=m[2*(X+2)%6],je=m[(2*(X+2)+1)%6],Ge=ve-oe,lt=Ce-fe,Tt=Ge===0,Ot=lt===0,ln=(D-fe)/lt,Zt=(U-fe)/lt,Ne=Math.min(ln,Zt),xt=Math.max(ln,Zt);if(!Ot&&(Ne>=1||xt<=0)||Ot&&(fe<D||fe>U)){Ce>=D&&Ce<=U&&$.push(S[(X+1)%3]);continue}!Ot&&Ne>0&&$.push(this._vertexToIndex(oe+Ge*Ne,fe+lt*Ne));const Yt=oe+Ge*Math.max(Ne,0),Dn=oe+Ge*Math.min(xt,1);Tt||this._generateIntraEdgeVertices($,oe,fe,ve,Ce,Yt,Dn),!Ot&&xt<1&&$.push(this._vertexToIndex(oe+Ge*xt,fe+lt*xt)),(Ot||Ce>=D&&Ce<=U)&&$.push(S[(X+1)%3]),!Ot&&(Ce<=D||Ce>=U)&&this._generateInterEdgeVertices($,oe,fe,ve,Ce,Be,je,Dn,D,U)}return $}_generateIntraEdgeVertices(o,m,S,D,U,$,X){const oe=D-m,fe=U-S,ve=fe===0,Ce=ve?Math.min(m,D):Math.min($,X),Be=ve?Math.max(m,D):Math.max($,X),je=Math.floor(Ce/this._granularityCellSize)+1,Ge=Math.ceil(Be/this._granularityCellSize)-1;if(ve?m<D:$<X)for(let lt=je;lt<=Ge;lt++){const Tt=lt*this._granularityCellSize;o.push(this._vertexToIndex(Tt,S+fe*(Tt-m)/oe))}else for(let lt=Ge;lt>=je;lt--){const Tt=lt*this._granularityCellSize;o.push(this._vertexToIndex(Tt,S+fe*(Tt-m)/oe))}}_generateInterEdgeVertices(o,m,S,D,U,$,X,oe,fe,ve){const Ce=U-S,Be=$-D,je=X-U,Ge=(fe-U)/je,lt=(ve-U)/je,Tt=Math.min(Ge,lt),Ot=Math.max(Ge,lt),ln=D+Be*Tt;let Zt=Math.floor(Math.min(ln,oe)/this._granularityCellSize)+1,Ne=Math.ceil(Math.max(ln,oe)/this._granularityCellSize)-1,xt=oe<ln;const Yt=je===0;if(Yt&&(X===fe||X===ve))return;if(Yt||Tt>=1||Ot<=0){const bi=S-X,Un=$+(m-$)*Math.min((fe-X)/bi,(ve-X)/bi);Zt=Math.floor(Math.min(Un,oe)/this._granularityCellSize)+1,Ne=Math.ceil(Math.max(Un,oe)/this._granularityCellSize)-1,xt=oe<Un}const Dn=Ce>0?ve:fe;if(xt)for(let bi=Zt;bi<=Ne;bi++)o.push(this._vertexToIndex(bi*this._granularityCellSize,Dn));else for(let bi=Ne;bi>=Zt;bi--)o.push(this._vertexToIndex(bi*this._granularityCellSize,Dn))}_generateOutline(o){const m=[];for(const S of o){const D=K(S,this._granularity,!0),U=this._pointArrayToIndices(D),$=[];for(let X=1;X<U.length;X++)$.push(U[X-1]),$.push(U[X]);m.push($)}return m}_handlePoles(o){let m=!1,S=!1;this._canonical&&(this._canonical.y===0&&(m=!0),this._canonical.y===(1<<this._canonical.z)-1&&(S=!0)),(m||S)&&this._fillPoles(o,m,S)}_ensureNoPoleVertices(){const o=this._vertexBuffer;for(let m=0;m<o.length;m+=2){const S=o[m+1];S===M&&(o[m+1]=-32767),S===A&&(o[m+1]=32766)}}_generatePoleQuad(o,m,S,D,U,$){D>U!=($===M)?(o.push(m),o.push(S),o.push(this._vertexToIndex(D,$)),o.push(S),o.push(this._vertexToIndex(U,$)),o.push(this._vertexToIndex(D,$))):(o.push(S),o.push(m),o.push(this._vertexToIndex(D,$)),o.push(this._vertexToIndex(U,$)),o.push(S),o.push(this._vertexToIndex(D,$)))}_fillPoles(o,m,S){const D=this._vertexBuffer,U=pn,$=o.length;for(let X=2;X<$;X+=3){const oe=o[X-2],fe=o[X-1],ve=o[X],Ce=D[2*oe],Be=D[2*oe+1],je=D[2*fe],Ge=D[2*fe+1],lt=D[2*ve],Tt=D[2*ve+1];m&&(Be===0&&Ge===0&&this._generatePoleQuad(o,oe,fe,Ce,je,M),Ge===0&&Tt===0&&this._generatePoleQuad(o,fe,ve,je,lt,M),Tt===0&&Be===0&&this._generatePoleQuad(o,ve,oe,lt,Ce,M)),S&&(Be===U&&Ge===U&&this._generatePoleQuad(o,oe,fe,Ce,je,A),Ge===U&&Tt===U&&this._generatePoleQuad(o,fe,ve,je,lt,A),Tt===U&&Be===U&&this._generatePoleQuad(o,ve,oe,lt,Ce,A))}}_initializeVertices(o){for(let m=0;m<o.length;m+=2)this._vertexToIndex(o[m],o[m+1])}subdividePolygonInternal(o,m){if(this._used)throw new Error("Subdivision: multiple use not allowed.");this._used=!0;const{flattened:S,holeIndices:D}=function(X){const oe=[],fe=[];for(const ve of X)if(ve.length!==0){ve!==X[0]&&oe.push(fe.length/2);for(let Ce=0;Ce<ve.length;Ce++)fe.push(ve[Ce].x),fe.push(ve[Ce].y)}return{flattened:fe,holeIndices:oe}}(o);let U;this._initializeVertices(S);try{const X=function(fe,ve,Ce=2){const Be=ve&&ve.length,je=Be?ve[0]*Ce:fe.length;let Ge=qg(fe,0,je,Ce,!0);const lt=[];if(!Ge||Ge.next===Ge.prev)return lt;let Tt,Ot,ln;if(Be&&(Ge=function(Zt,Ne,xt,Yt){const Dn=[];for(let bi=0,Un=Ne.length;bi<Un;bi++){const Kn=qg(Zt,Ne[bi]*Yt,bi<Un-1?Ne[bi+1]*Yt:Zt.length,Yt,!1);Kn===Kn.next&&(Kn.steiner=!0),Dn.push(Ev(Kn))}Dn.sort(Sp);for(let bi=0;bi<Dn.length;bi++)xt=Hg(Dn[bi],xt);return xt}(fe,ve,Ge,Ce)),fe.length>80*Ce){Tt=1/0,Ot=1/0;let Zt=-1/0,Ne=-1/0;for(let xt=Ce;xt<je;xt+=Ce){const Yt=fe[xt],Dn=fe[xt+1];Yt<Tt&&(Tt=Yt),Dn<Ot&&(Ot=Dn),Yt>Zt&&(Zt=Yt),Dn>Ne&&(Ne=Dn)}ln=Math.max(Zt-Tt,Ne-Ot),ln=ln!==0?32767/ln:0}return Id(Ge,lt,Ce,Tt,Ot,ln,0),lt}(S,D),oe=this._convertIndices(S,X);U=this._subdivideTrianglesScanline(oe)}catch(X){console.error(X)}let $=[];return m&&($=this._generateOutline(o)),this._ensureNoPoleVertices(),this._handlePoles(U),{verticesFlattened:this._vertexBuffer,indicesTriangles:U,indicesLineList:$}}_convertIndices(o,m){const S=[];for(let D=0;D<m.length;D++)S.push(this._vertexToIndex(o[2*m[D]],o[2*m[D]+1]));return S}_pointArrayToIndices(o){const m=[];for(let S=0;S<o.length;S++){const D=o[S];m.push(this._vertexToIndex(D.x,D.y))}return m}}function H(g,o,m,S=!0){return new V(m,o).subdividePolygonInternal(g,S)}function K(g,o,m=!1){if(!g||g.length<1)return[];if(g.length<2)return[];const S=g[0],D=g[g.length-1],U=m&&(S.x!==D.x||S.y!==D.y);if(o<2)return U?[...g,g[0]]:[...g];const $=Math.floor(pn/o),X=[];X.push(new ce(g[0].x,g[0].y));const oe=g.length,fe=U?oe:oe-1;for(let ve=0;ve<fe;ve++){const Ce=g[ve],Be=ve<oe-1?g[ve+1]:g[0],je=Ce.x,Ge=Ce.y,lt=Be.x,Tt=Be.y,Ot=je!==lt,ln=Ge!==Tt;if(!Ot&&!ln)continue;const Zt=lt-je,Ne=Tt-Ge,xt=Math.abs(Zt),Yt=Math.abs(Ne);let Dn=je,bi=Ge;for(;;){const Kn=Zt>0?(Math.floor(Dn/$)+1)*$:(Math.ceil(Dn/$)-1)*$,Di=Ne>0?(Math.floor(bi/$)+1)*$:(Math.ceil(bi/$)-1)*$,Si=Math.abs(Dn-Kn),Li=Math.abs(bi-Di),ni=Math.abs(Dn-lt),ar=Math.abs(bi-Tt),Cr=Ot?Si/xt:Number.POSITIVE_INFINITY,gr=ln?Li/Yt:Number.POSITIVE_INFINITY;if((ni<=Si||!Ot)&&(ar<=Li||!ln))break;if(Cr<gr&&Ot||!ln){Dn=Kn,bi+=Ne*Cr;const hr=new ce(Dn,Math.round(bi));X[X.length-1].x===hr.x&&X[X.length-1].y===hr.y||X.push(hr)}else{Dn+=Zt*gr,bi=Di;const hr=new ce(Math.round(Dn),bi);X[X.length-1].x===hr.x&&X[X.length-1].y===hr.y||X.push(hr)}}const Un=new ce(lt,Tt);X[X.length-1].x===Un.x&&X[X.length-1].y===Un.y||X.push(Un)}return X}function ee(g,o,m){if(o.length===0)throw new Error("Subdivision vertex ring is empty.");let S=0,D=g[2*o[0]];for(let oe=1;oe<o.length;oe++){const fe=g[2*o[oe]];fe<D&&(D=fe,S=oe)}const U=o.length;let $=S,X=($+1)%U;for(;;){const oe=$-1>=0?$-1:U-1,fe=(X+1)%U,ve=g[2*o[oe]],Ce=g[2*o[fe]],Be=g[2*o[$]],je=g[2*o[$]+1],Ge=g[2*o[X]+1];let lt=!1;if(ve<Ce)lt=!0;else if(ve>Ce)lt=!1;else{const Tt=Ge-je,Ot=-(g[2*o[X]]-Be),ln=je<Ge?1:-1;((ve-Be)*Tt+(g[2*o[oe]+1]-je)*Ot)*ln>((Ce-Be)*Tt+(g[2*o[fe]+1]-je)*Ot)*ln&&(lt=!0)}if(lt){const Tt=o[oe],Ot=o[$],ln=o[X];Tt!==Ot&&Tt!==ln&&Ot!==ln&&m.push(ln,Ot,Tt),$--,$<0&&($=U-1)}else{const Tt=o[fe],Ot=o[$],ln=o[X];Tt!==Ot&&Tt!==ln&&Ot!==ln&&m.push(ln,Ot,Tt),X++,X>=U&&(X=0)}if(oe===fe)break}}function se(g,o,m,S,D,U,$,X,oe){const fe=D.length/2,ve=$&&X&&oe;if(fe<Gi.MAX_VERTEX_ARRAY_LENGTH){const Ce=o.prepareSegment(fe,m,S),Be=Ce.vertexLength;for(let lt=0;lt<U.length;lt+=3)S.emplaceBack(Be+U[lt],Be+U[lt+1],Be+U[lt+2]);let je,Ge;Ce.vertexLength+=fe,Ce.primitiveLength+=U.length/3,ve&&(Ge=$.prepareSegment(fe,m,X),je=Ge.vertexLength,Ge.vertexLength+=fe);for(let lt=0;lt<D.length;lt+=2)g(D[lt],D[lt+1]);if(ve)for(let lt=0;lt<oe.length;lt++){const Tt=oe[lt];for(let Ot=1;Ot<Tt.length;Ot+=2)X.emplaceBack(je+Tt[Ot-1],je+Tt[Ot]);Ge.primitiveLength+=Tt.length/2}}else(function(Ce,Be,je,Ge,lt,Tt){const Ot=[];for(let Yt=0;Yt<Ge.length/2;Yt++)Ot.push(-1);const ln={count:0};let Zt=0,Ne=Ce.getOrCreateLatestSegment(Be,je),xt=Ne.vertexLength;for(let Yt=2;Yt<lt.length;Yt+=3){const Dn=lt[Yt-2],bi=lt[Yt-1],Un=lt[Yt];let Kn=Ot[Dn]<Zt,Di=Ot[bi]<Zt,Si=Ot[Un]<Zt;Ne.vertexLength+((Kn?1:0)+(Di?1:0)+(Si?1:0))>Gi.MAX_VERTEX_ARRAY_LENGTH&&(Ne=Ce.createNewSegment(Be,je),Zt=ln.count,Kn=!0,Di=!0,Si=!0,xt=0);const Li=le(Ot,Ge,Tt,ln,Dn,Kn,Ne),ni=le(Ot,Ge,Tt,ln,bi,Di,Ne),ar=le(Ot,Ge,Tt,ln,Un,Si,Ne);je.emplaceBack(xt+Li-Zt,xt+ni-Zt,xt+ar-Zt),Ne.primitiveLength++}})(o,m,S,D,U,g),ve&&function(Ce,Be,je,Ge,lt,Tt){const Ot=[];for(let Yt=0;Yt<Ge.length/2;Yt++)Ot.push(-1);const ln={count:0};let Zt=0,Ne=Ce.getOrCreateLatestSegment(Be,je),xt=Ne.vertexLength;for(let Yt=0;Yt<lt.length;Yt++){const Dn=lt[Yt];for(let bi=1;bi<lt[Yt].length;bi+=2){const Un=Dn[bi-1],Kn=Dn[bi];let Di=Ot[Un]<Zt,Si=Ot[Kn]<Zt;Ne.vertexLength+((Di?1:0)+(Si?1:0))>Gi.MAX_VERTEX_ARRAY_LENGTH&&(Ne=Ce.createNewSegment(Be,je),Zt=ln.count,Di=!0,Si=!0,xt=0);const Li=le(Ot,Ge,Tt,ln,Un,Di,Ne),ni=le(Ot,Ge,Tt,ln,Kn,Si,Ne);je.emplaceBack(xt+Li-Zt,xt+ni-Zt),Ne.primitiveLength++}}}($,m,X,D,oe,g),o.forceNewSegmentOnNextPrepare(),$==null||$.forceNewSegmentOnNextPrepare()}function le(g,o,m,S,D,U,$){if(U){const X=S.count;return m(o[2*D],o[2*D+1]),g[D]=S.count,S.count++,$.vertexLength++,X}return g[D]}class me{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(m=>m.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new jt,this.indexArray=new jn,this.indexArray2=new Ri,this.programConfigurations=new _s(o.layers,o.zoom),this.segments=new Gi,this.segments2=new Gi,this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id)}populate(o,m,S){this.hasPattern=bp("fill",this.layers,m);const D=this.layers[0].layout.get("fill-sort-key"),U=!D.isConstant(),$=[];for(const{feature:X,id:oe,index:fe,sourceLayerIndex:ve}of o){const Ce=this.layers[0]._featureFilter.needGeometry,Be=sh(X,Ce);if(!this.layers[0]._featureFilter.filter(new ls(this.zoom),Be,S))continue;const je=U?D.evaluate(Be,{},S,m.availableImages):void 0,Ge={id:oe,properties:X.properties,type:X.type,sourceLayerIndex:ve,index:fe,geometry:Ce?Be.geometry:wc(X),patterns:{},sortKey:je};$.push(Ge)}U&&$.sort((X,oe)=>X.sortKey-oe.sortKey);for(const X of $){const{geometry:oe,index:fe,sourceLayerIndex:ve}=X;if(this.hasPattern){const Ce=Km("fill",this.layers,X,this.zoom,m);this.patternFeatures.push(Ce)}else this.addFeature(X,oe,fe,S,{},m.subdivisionGranularity);m.featureIndex.insert(o[fe].feature,oe,fe,ve,this.index)}}update(o,m,S){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,m,this.stateDependentLayers,S)}addFeatures(o,m,S){for(const D of this.patternFeatures)this.addFeature(D,D.geometry,D.index,m,S,o.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,yl),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.indexBuffer2=o.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(o,m,S,D,U,$){for(const X of vh(m,500)){const oe=H(X,D,$.fill.getGranularityForZoomLevel(D.z)),fe=this.layoutVertexArray;se((ve,Ce)=>{fe.emplaceBack(ve,Ce)},this.segments,this.layoutVertexArray,this.indexArray,oe.verticesFlattened,oe.indicesTriangles,this.segments2,this.indexArray2,oe.indicesLineList)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,S,U,D)}}let Ee,Se;Yi("FillBucket",me,{omit:["layers","patternFeatures"]});var ke={get paint(){return Se=Se||new $o({"fill-antialias":new cr(bt.paint_fill["fill-antialias"]),"fill-opacity":new xr(bt.paint_fill["fill-opacity"]),"fill-color":new xr(bt.paint_fill["fill-color"]),"fill-outline-color":new xr(bt.paint_fill["fill-outline-color"]),"fill-translate":new cr(bt.paint_fill["fill-translate"]),"fill-translate-anchor":new cr(bt.paint_fill["fill-translate-anchor"]),"fill-pattern":new bd(bt.paint_fill["fill-pattern"])})},get layout(){return Ee=Ee||new $o({"fill-sort-key":new xr(bt.layout_fill["fill-sort-key"])})}};class De extends Ss{constructor(o){super(o,ke)}recalculate(o,m){super.recalculate(o,m);const S=this.paint._values["fill-outline-color"];S.value.kind==="constant"&&S.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new me(o)}queryRadius(){return rc(this.paint.get("fill-translate"))}queryIntersectsFeature({queryGeometry:o,geometry:m,transform:S,pixelsToTileUnits:D}){return Cd(vp(o,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),-S.bearingInRadians,D),m)}isTileClipped(){return!0}}const Xe=cs([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),ut=cs([{name:"a_centroid",components:2,type:"Int16"}],4),{members:st}=Xe;var wt,gt,vt,_t,Mt,Ft,cn,en={};function zt(){if(gt)return wt;gt=1;var g=ne();function o(D,U,$,X,oe){this.properties={},this.extent=$,this.type=0,this._pbf=D,this._geometry=-1,this._keys=X,this._values=oe,D.readFields(m,this,U)}function m(D,U,$){D==1?U.id=$.readVarint():D==2?function(X,oe){for(var fe=X.readVarint()+X.pos;X.pos<fe;){var ve=oe._keys[X.readVarint()],Ce=oe._values[X.readVarint()];oe.properties[ve]=Ce}}($,U):D==3?U.type=$.readVarint():D==4&&(U._geometry=$.pos)}function S(D){for(var U,$,X=0,oe=0,fe=D.length,ve=fe-1;oe<fe;ve=oe++)X+=(($=D[ve]).x-(U=D[oe]).x)*(U.y+$.y);return X}return wt=o,o.types=["Unknown","Point","LineString","Polygon"],o.prototype.loadGeometry=function(){var D=this._pbf;D.pos=this._geometry;for(var U,$=D.readVarint()+D.pos,X=1,oe=0,fe=0,ve=0,Ce=[];D.pos<$;){if(oe<=0){var Be=D.readVarint();X=7&Be,oe=Be>>3}if(oe--,X===1||X===2)fe+=D.readSVarint(),ve+=D.readSVarint(),X===1&&(U&&Ce.push(U),U=[]),U.push(new g(fe,ve));else{if(X!==7)throw new Error("unknown command "+X);U&&U.push(U[0].clone())}}return U&&Ce.push(U),Ce},o.prototype.bbox=function(){var D=this._pbf;D.pos=this._geometry;for(var U=D.readVarint()+D.pos,$=1,X=0,oe=0,fe=0,ve=1/0,Ce=-1/0,Be=1/0,je=-1/0;D.pos<U;){if(X<=0){var Ge=D.readVarint();$=7&Ge,X=Ge>>3}if(X--,$===1||$===2)(oe+=D.readSVarint())<ve&&(ve=oe),oe>Ce&&(Ce=oe),(fe+=D.readSVarint())<Be&&(Be=fe),fe>je&&(je=fe);else if($!==7)throw new Error("unknown command "+$)}return[ve,Be,Ce,je]},o.prototype.toGeoJSON=function(D,U,$){var X,oe,fe=this.extent*Math.pow(2,$),ve=this.extent*D,Ce=this.extent*U,Be=this.loadGeometry(),je=o.types[this.type];function Ge(Ot){for(var ln=0;ln<Ot.length;ln++){var Zt=Ot[ln];Ot[ln]=[360*(Zt.x+ve)/fe-180,360/Math.PI*Math.atan(Math.exp((180-360*(Zt.y+Ce)/fe)*Math.PI/180))-90]}}switch(this.type){case 1:var lt=[];for(X=0;X<Be.length;X++)lt[X]=Be[X][0];Ge(Be=lt);break;case 2:for(X=0;X<Be.length;X++)Ge(Be[X]);break;case 3:for(Be=function(Ot){var ln=Ot.length;if(ln<=1)return[Ot];for(var Zt,Ne,xt=[],Yt=0;Yt<ln;Yt++){var Dn=S(Ot[Yt]);Dn!==0&&(Ne===void 0&&(Ne=Dn<0),Ne===Dn<0?(Zt&&xt.push(Zt),Zt=[Ot[Yt]]):Zt.push(Ot[Yt]))}return Zt&&xt.push(Zt),xt}(Be),X=0;X<Be.length;X++)for(oe=0;oe<Be[X].length;oe++)Ge(Be[X][oe])}Be.length===1?Be=Be[0]:je="Multi"+je;var Tt={type:"Feature",geometry:{type:je,coordinates:Be},properties:this.properties};return"id"in this&&(Tt.id=this.id),Tt},wt}function Ht(){if(_t)return vt;_t=1;var g=zt();function o(S,D){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=S,this._keys=[],this._values=[],this._features=[],S.readFields(m,this,D),this.length=this._features.length}function m(S,D,U){S===15?D.version=U.readVarint():S===1?D.name=U.readString():S===5?D.extent=U.readVarint():S===2?D._features.push(U.pos):S===3?D._keys.push(U.readString()):S===4&&D._values.push(function($){for(var X=null,oe=$.readVarint()+$.pos;$.pos<oe;){var fe=$.readVarint()>>3;X=fe===1?$.readString():fe===2?$.readFloat():fe===3?$.readDouble():fe===4?$.readVarint64():fe===5?$.readVarint():fe===6?$.readSVarint():fe===7?$.readBoolean():null}return X}(U))}return vt=o,o.prototype.feature=function(S){if(S<0||S>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[S];var D=this._pbf.readVarint()+this._pbf.pos;return new g(this._pbf,D,this.extent,this._keys,this._values)},vt}function En(){return cn||(cn=1,en.VectorTile=function(){if(Ft)return Mt;Ft=1;var g=Ht();function o(m,S,D){if(m===3){var U=new g(D,D.readVarint()+D.pos);U.length&&(S[U.name]=U)}}return Mt=function(m,S){this.layers=m.readFields(o,{},S)},Mt}(),en.VectorTileFeature=zt(),en.VectorTileLayer=Ht()),en}var Vn=G(En());const ti=Vn.VectorTileFeature.types,Qt=Math.pow(2,13);function An(g,o,m,S,D,U,$,X){g.emplaceBack(o,m,2*Math.floor(S*Qt)+$,D*Qt*2,U*Qt*2,Math.round(X))}class dn{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(m=>m.id),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new Nt,this.centroidVertexArray=new Et,this.indexArray=new jn,this.programConfigurations=new _s(o.layers,o.zoom),this.segments=new Gi,this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id)}populate(o,m,S){this.features=[],this.hasPattern=bp("fill-extrusion",this.layers,m);for(const{feature:D,id:U,index:$,sourceLayerIndex:X}of o){const oe=this.layers[0]._featureFilter.needGeometry,fe=sh(D,oe);if(!this.layers[0]._featureFilter.filter(new ls(this.zoom),fe,S))continue;const ve={id:U,sourceLayerIndex:X,index:$,geometry:oe?fe.geometry:wc(D),properties:D.properties,type:D.type,patterns:{}};this.hasPattern?this.features.push(Km("fill-extrusion",this.layers,ve,this.zoom,m)):this.addFeature(ve,ve.geometry,$,S,{},m.subdivisionGranularity),m.featureIndex.insert(D,ve.geometry,$,X,this.index,!0)}}addFeatures(o,m,S){for(const D of this.features){const{geometry:U}=D;this.addFeature(D,U,D.index,m,S,o.subdivisionGranularity)}}update(o,m,S){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,m,this.stateDependentLayers,S)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,st),this.centroidVertexBuffer=o.createVertexBuffer(this.centroidVertexArray,ut.members,!0),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(o,m,S,D,U,$){for(const X of vh(m,500)){const oe={x:0,y:0,sampleCount:0},fe=this.layoutVertexArray.length;this.processPolygon(oe,D,o,X,$);const ve=this.layoutVertexArray.length-fe,Ce=Math.floor(oe.x/oe.sampleCount),Be=Math.floor(oe.y/oe.sampleCount);for(let je=0;je<ve;je++)this.centroidVertexArray.emplaceBack(Ce,Be)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,S,U,D)}processPolygon(o,m,S,D,U){if(D.length<1||wn(D[0]))return;for(const Ce of D)Ce.length!==0&&Jn(o,Ce);const $={segment:this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray)},X=U.fill.getGranularityForZoomLevel(m.z),oe=ti[S.type]==="Polygon";for(const Ce of D){if(Ce.length===0||wn(Ce))continue;const Be=K(Ce,X,oe);this._generateSideFaces(Be,$)}if(!oe)return;const fe=H(D,m,X,!1),ve=this.layoutVertexArray;se((Ce,Be)=>{An(ve,Ce,Be,0,0,1,1,0)},this.segments,this.layoutVertexArray,this.indexArray,fe.verticesFlattened,fe.indicesTriangles)}_generateSideFaces(o,m){let S=0;for(let D=1;D<o.length;D++){const U=o[D],$=o[D-1];if(Fn(U,$))continue;m.segment.vertexLength+4>Gi.MAX_VERTEX_ARRAY_LENGTH&&(m.segment=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const X=U.sub($)._perp()._unit(),oe=$.dist(U);S+oe>32768&&(S=0),An(this.layoutVertexArray,U.x,U.y,X.x,X.y,0,0,S),An(this.layoutVertexArray,U.x,U.y,X.x,X.y,0,1,S),S+=oe,An(this.layoutVertexArray,$.x,$.y,X.x,X.y,0,0,S),An(this.layoutVertexArray,$.x,$.y,X.x,X.y,0,1,S);const fe=m.segment.vertexLength;this.indexArray.emplaceBack(fe,fe+2,fe+1),this.indexArray.emplaceBack(fe+1,fe+2,fe+3),m.segment.vertexLength+=4,m.segment.primitiveLength+=2}}}function Jn(g,o){for(let m=0;m<o.length;m++){const S=o[m];m===o.length-1&&o[0].x===S.x&&o[0].y===S.y||(g.x+=S.x,g.y+=S.y,g.sampleCount++)}}function Fn(g,o){return g.x===o.x&&(g.x<0||g.x>pn)||g.y===o.y&&(g.y<0||g.y>pn)}function wn(g){return g.every(o=>o.x<0)||g.every(o=>o.x>pn)||g.every(o=>o.y<0)||g.every(o=>o.y>pn)}let Mi;Yi("FillExtrusionBucket",dn,{omit:["layers","features"]});var si={get paint(){return Mi=Mi||new $o({"fill-extrusion-opacity":new cr(bt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new xr(bt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new cr(bt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new cr(bt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new bd(bt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new xr(bt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new xr(bt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new cr(bt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class Ii extends Ss{constructor(o){super(o,si)}createBucket(o){return new dn(o)}queryRadius(){return rc(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature({queryGeometry:o,feature:m,featureState:S,geometry:D,transform:U,pixelsToTileUnits:$,pixelPosMatrix:X}){const oe=vp(o,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),-U.bearingInRadians,$),fe=this.paint.get("fill-extrusion-height").evaluate(m,S),ve=this.paint.get("fill-extrusion-base").evaluate(m,S),Ce=function(je,Ge,lt){const Tt=[];for(const Ot of je){const ln=[Ot.x,Ot.y,0,1];ft(ln,ln,Ge),Tt.push(new ce(ln[0]/ln[3],ln[1]/ln[3]))}return Tt}(oe,X),Be=function(je,Ge,lt,Tt){const Ot=[],ln=[],Zt=Tt[8]*Ge,Ne=Tt[9]*Ge,xt=Tt[10]*Ge,Yt=Tt[11]*Ge,Dn=Tt[8]*lt,bi=Tt[9]*lt,Un=Tt[10]*lt,Kn=Tt[11]*lt;for(const Di of je){const Si=[],Li=[];for(const ni of Di){const ar=ni.x,Cr=ni.y,gr=Tt[0]*ar+Tt[4]*Cr+Tt[12],hr=Tt[1]*ar+Tt[5]*Cr+Tt[13],pa=Tt[2]*ar+Tt[6]*Cr+Tt[14],vs=Tt[3]*ar+Tt[7]*Cr+Tt[15],To=pa+xt,xl=vs+Yt,Cu=gr+Dn,Ec=hr+bi,ol=pa+Un,zs=vs+Kn,Xo=new ce((gr+Zt)/xl,(hr+Ne)/xl);Xo.z=To/xl,Si.push(Xo);const ll=new ce(Cu/zs,Ec/zs);ll.z=ol/zs,Li.push(ll)}Ot.push(Si),ln.push(Li)}return[Ot,ln]}(D,ve,fe,X);return function(je,Ge,lt){let Tt=1/0;Cd(lt,Ge)&&(Tt=ur(lt,Ge[0]));for(let Ot=0;Ot<Ge.length;Ot++){const ln=Ge[Ot],Zt=je[Ot];for(let Ne=0;Ne<ln.length-1;Ne++){const xt=ln[Ne],Yt=[xt,ln[Ne+1],Zt[Ne+1],Zt[Ne],xt];vf(lt,Yt)&&(Tt=Math.min(Tt,ur(lt,Yt)))}}return Tt!==1/0&&Tt}(Be[0],Be[1],Ce)}}function Ai(g,o){return g.x*o.x+g.y*o.y}function ur(g,o){if(g.length===1){let m=0;const S=o[m++];let D;for(;!D||S.equals(D);)if(D=o[m++],!D)return 1/0;for(;m<o.length;m++){const U=o[m],$=g[0],X=D.sub(S),oe=U.sub(S),fe=$.sub(S),ve=Ai(X,X),Ce=Ai(X,oe),Be=Ai(oe,oe),je=Ai(fe,X),Ge=Ai(fe,oe),lt=ve*Be-Ce*Ce,Tt=(Be*je-Ce*Ge)/lt,Ot=(ve*Ge-Ce*je)/lt,ln=S.z*(1-Tt-Ot)+D.z*Tt+U.z*Ot;if(isFinite(ln))return ln}return 1/0}{let m=1/0;for(const S of o)m=Math.min(m,S.z);return m}}const Xi=cs([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:er}=Xi,dr=cs([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:Ur}=dr,Mr=Vn.VectorTileFeature.types,Ea=Math.cos(Math.PI/180*37.5),za=Math.pow(2,14)/.5;class ra{constructor(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(m=>m.id),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(m=>{this.gradients[m.id]={}}),this.layoutVertexArray=new Bt,this.layoutVertexArray2=new nn,this.indexArray=new jn,this.programConfigurations=new _s(o.layers,o.zoom),this.segments=new Gi,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id)}populate(o,m,S){this.hasPattern=bp("line",this.layers,m);const D=this.layers[0].layout.get("line-sort-key"),U=!D.isConstant(),$=[];for(const{feature:X,id:oe,index:fe,sourceLayerIndex:ve}of o){const Ce=this.layers[0]._featureFilter.needGeometry,Be=sh(X,Ce);if(!this.layers[0]._featureFilter.filter(new ls(this.zoom),Be,S))continue;const je=U?D.evaluate(Be,{},S):void 0,Ge={id:oe,properties:X.properties,type:X.type,sourceLayerIndex:ve,index:fe,geometry:Ce?Be.geometry:wc(X),patterns:{},sortKey:je};$.push(Ge)}U&&$.sort((X,oe)=>X.sortKey-oe.sortKey);for(const X of $){const{geometry:oe,index:fe,sourceLayerIndex:ve}=X;if(this.hasPattern){const Ce=Km("line",this.layers,X,this.zoom,m);this.patternFeatures.push(Ce)}else this.addFeature(X,oe,fe,S,{},m.subdivisionGranularity);m.featureIndex.insert(o[fe].feature,oe,fe,ve,this.index)}}update(o,m,S){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,m,this.stateDependentLayers,S)}addFeatures(o,m,S){for(const D of this.patternFeatures)this.addFeature(D,D.geometry,D.index,m,S,o.subdivisionGranularity)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(o){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,Ur)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,er),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(o){if(o.properties&&Object.prototype.hasOwnProperty.call(o.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(o.properties,"mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}}addFeature(o,m,S,D,U,$){const X=this.layers[0].layout,oe=X.get("line-join").evaluate(o,{}),fe=X.get("line-cap"),ve=X.get("line-miter-limit"),Ce=X.get("line-round-limit");this.lineClips=this.lineFeatureClips(o);for(const Be of m)this.addLine(Be,o,oe,fe,ve,Ce,D,$);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,S,U,D)}addLine(o,m,S,D,U,$,X,oe){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,o=K(o,X?oe.line.getGranularityForZoomLevel(X.z):1),this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Zt=0;Zt<o.length-1;Zt++)this.totalDistance+=o[Zt].dist(o[Zt+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const fe=Mr[m.type]==="Polygon";let ve=o.length;for(;ve>=2&&o[ve-1].equals(o[ve-2]);)ve--;let Ce=0;for(;Ce<ve-1&&o[Ce].equals(o[Ce+1]);)Ce++;if(ve<(fe?3:2))return;S==="bevel"&&(U=1.05);const Be=this.overscaling<=16?15*pn/(512*this.overscaling):0,je=this.segments.prepareSegment(10*ve,this.layoutVertexArray,this.indexArray);let Ge,lt,Tt,Ot,ln;this.e1=this.e2=-1,fe&&(Ge=o[ve-2],ln=o[Ce].sub(Ge)._unit()._perp());for(let Zt=Ce;Zt<ve;Zt++){if(Tt=Zt===ve-1?fe?o[Ce+1]:void 0:o[Zt+1],Tt&&o[Zt].equals(Tt))continue;ln&&(Ot=ln),Ge&&(lt=Ge),Ge=o[Zt],ln=Tt?Tt.sub(Ge)._unit()._perp():Ot,Ot=Ot||ln;let Ne=Ot.add(ln);Ne.x===0&&Ne.y===0||Ne._unit();const xt=Ot.x*ln.x+Ot.y*ln.y,Yt=Ne.x*ln.x+Ne.y*ln.y,Dn=Yt!==0?1/Yt:1/0,bi=2*Math.sqrt(2-2*Yt),Un=Yt<Ea&&lt&&Tt,Kn=Ot.x*ln.y-Ot.y*ln.x>0;if(Un&&Zt>Ce){const Li=Ge.dist(lt);if(Li>2*Be){const ni=Ge.sub(Ge.sub(lt)._mult(Be/Li)._round());this.updateDistance(lt,ni),this.addCurrentVertex(ni,Ot,0,0,je),lt=ni}}const Di=lt&&Tt;let Si=Di?S:fe?"butt":D;if(Di&&Si==="round"&&(Dn<$?Si="miter":Dn<=2&&(Si="fakeround")),Si==="miter"&&Dn>U&&(Si="bevel"),Si==="bevel"&&(Dn>2&&(Si="flipbevel"),Dn<U&&(Si="miter")),lt&&this.updateDistance(lt,Ge),Si==="miter")Ne._mult(Dn),this.addCurrentVertex(Ge,Ne,0,0,je);else if(Si==="flipbevel"){if(Dn>100)Ne=ln.mult(-1);else{const Li=Dn*Ot.add(ln).mag()/Ot.sub(ln).mag();Ne._perp()._mult(Li*(Kn?-1:1))}this.addCurrentVertex(Ge,Ne,0,0,je),this.addCurrentVertex(Ge,Ne.mult(-1),0,0,je)}else if(Si==="bevel"||Si==="fakeround"){const Li=-Math.sqrt(Dn*Dn-1),ni=Kn?Li:0,ar=Kn?0:Li;if(lt&&this.addCurrentVertex(Ge,Ot,ni,ar,je),Si==="fakeround"){const Cr=Math.round(180*bi/Math.PI/20);for(let gr=1;gr<Cr;gr++){let hr=gr/Cr;if(hr!==.5){const vs=hr-.5;hr+=hr*vs*(hr-1)*((1.0904+xt*(xt*(3.55645-1.43519*xt)-3.2452))*vs*vs+(.848013+xt*(.215638*xt-1.06021)))}const pa=ln.sub(Ot)._mult(hr)._add(Ot)._unit()._mult(Kn?-1:1);this.addHalfVertex(Ge,pa.x,pa.y,!1,Kn,0,je)}}Tt&&this.addCurrentVertex(Ge,ln,-ni,-ar,je)}else if(Si==="butt")this.addCurrentVertex(Ge,Ne,0,0,je);else if(Si==="square"){const Li=lt?1:-1;this.addCurrentVertex(Ge,Ne,Li,Li,je)}else Si==="round"&&(lt&&(this.addCurrentVertex(Ge,Ot,0,0,je),this.addCurrentVertex(Ge,Ot,1,1,je,!0)),Tt&&(this.addCurrentVertex(Ge,ln,-1,-1,je,!0),this.addCurrentVertex(Ge,ln,0,0,je)));if(Un&&Zt<ve-1){const Li=Ge.dist(Tt);if(Li>2*Be){const ni=Ge.add(Tt.sub(Ge)._mult(Be/Li)._round());this.updateDistance(Ge,ni),this.addCurrentVertex(ni,ln,0,0,je),Ge=ni}}}}addCurrentVertex(o,m,S,D,U,$=!1){const X=m.y*D-m.x,oe=-m.y-m.x*D;this.addHalfVertex(o,m.x+m.y*S,m.y-m.x*S,$,!1,S,U),this.addHalfVertex(o,X,oe,$,!0,-D,U),this.distance>za/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(o,m,S,D,U,$))}addHalfVertex({x:o,y:m},S,D,U,$,X,oe){const fe=.5*(this.lineClips?this.scaledDistance*(za-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((o<<1)+(U?1:0),(m<<1)+($?1:0),Math.round(63*S)+128,Math.round(63*D)+128,1+(X===0?0:X<0?-1:1)|(63&fe)<<2,fe>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const ve=oe.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,ve,this.e2),oe.primitiveLength++),$?this.e2=ve:this.e1=ve}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(o,m){this.distance+=o.dist(m),this.updateScaledDistance()}}let ha,br;Yi("LineBucket",ra,{omit:["layers","patternFeatures"]});var nr={get paint(){return br=br||new $o({"line-opacity":new xr(bt.paint_line["line-opacity"]),"line-color":new xr(bt.paint_line["line-color"]),"line-translate":new cr(bt.paint_line["line-translate"]),"line-translate-anchor":new cr(bt.paint_line["line-translate-anchor"]),"line-width":new xr(bt.paint_line["line-width"]),"line-gap-width":new xr(bt.paint_line["line-gap-width"]),"line-offset":new xr(bt.paint_line["line-offset"]),"line-blur":new xr(bt.paint_line["line-blur"]),"line-dasharray":new wd(bt.paint_line["line-dasharray"]),"line-pattern":new bd(bt.paint_line["line-pattern"]),"line-gradient":new Bl(bt.paint_line["line-gradient"])})},get layout(){return ha=ha||new $o({"line-cap":new cr(bt.layout_line["line-cap"]),"line-join":new xr(bt.layout_line["line-join"]),"line-miter-limit":new cr(bt.layout_line["line-miter-limit"]),"line-round-limit":new cr(bt.layout_line["line-round-limit"]),"line-sort-key":new xr(bt.layout_line["line-sort-key"])})}};class ea extends xr{possiblyEvaluate(o,m){return m=new ls(Math.floor(m.zoom),{now:m.now,fadeDuration:m.fadeDuration,zoomHistory:m.zoomHistory,transition:m.transition}),super.possiblyEvaluate(o,m)}evaluate(o,m,S,D){return m=Fi({},m,{zoom:Math.floor(m.zoom)}),super.evaluate(o,m,S,D)}}let ta;class Xa extends Ss{constructor(o){super(o,nr),this.gradientVersion=0,ta||(ta=new ea(nr.paint.properties["line-width"].specification),ta.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(o){if(o==="line-gradient"){const m=this.gradientExpression();this.stepInterpolant=!!function(S){return S._styleExpression!==void 0}(m)&&m._styleExpression.expression instanceof Vu,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(o,m){super.recalculate(o,m),this.paint._values["line-floorwidth"]=ta.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new ra(o)}queryRadius(o){const m=o,S=bo(Ba("line-width",this,m),Ba("line-gap-width",this,m)),D=Ba("line-offset",this,m);return S/2+Math.abs(D)+rc(this.paint.get("line-translate"))}queryIntersectsFeature({queryGeometry:o,feature:m,featureState:S,geometry:D,transform:U,pixelsToTileUnits:$}){const X=vp(o,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),-U.bearingInRadians,$),oe=$/2*bo(this.paint.get("line-width").evaluate(m,S),this.paint.get("line-gap-width").evaluate(m,S)),fe=this.paint.get("line-offset").evaluate(m,S);return fe&&(D=function(ve,Ce){const Be=[];for(let je=0;je<ve.length;je++){const Ge=ve[je],lt=[];for(let Tt=0;Tt<Ge.length;Tt++){const Ot=Ge[Tt-1],ln=Ge[Tt],Zt=Ge[Tt+1],Ne=Tt===0?new ce(0,0):ln.sub(Ot)._unit()._perp(),xt=Tt===Ge.length-1?new ce(0,0):Zt.sub(ln)._unit()._perp(),Yt=Ne._add(xt)._unit(),Dn=Yt.x*xt.x+Yt.y*xt.y;Dn!==0&&Yt._mult(1/Dn),lt.push(Yt._mult(Ce)._add(ln))}Be.push(lt)}return Be}(D,fe*$)),function(ve,Ce,Be){for(let je=0;je<Ce.length;je++){const Ge=Ce[je];if(ve.length>=3){for(let lt=0;lt<Ge.length;lt++)if(ic(ve,Ge[lt]))return!0}if(am(ve,Ge,Be))return!0}return!1}(X,D,oe)}isTileClipped(){return!0}}function bo(g,o){return o>0?o+2*g:g}const vl=cs([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Ls=cs([{name:"a_projected_pos",components:3,type:"Float32"}],4);cs([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const wo=cs([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);cs([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const qo=cs([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),ys=cs([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function wa(g,o,m){return g.sections.forEach(S=>{S.text=function(D,U,$){const X=U.layout.get("text-transform").evaluate($,{});return X==="uppercase"?D=D.toLocaleUpperCase():X==="lowercase"&&(D=D.toLocaleLowerCase()),yc.applyArabicShaping&&(D=yc.applyArabicShaping(D)),D}(S.text,o,m)}),g}cs([{name:"triangle",components:3,type:"Uint16"}]),cs([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),cs([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),cs([{type:"Float32",name:"offsetX"}]),cs([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),cs([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const fa={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var $r,is,So,Lr=24,Fo={};function Tc(){return $r||($r=1,Fo.read=function(g,o,m,S,D){var U,$,X=8*D-S-1,oe=(1<<X)-1,fe=oe>>1,ve=-7,Ce=m?D-1:0,Be=m?-1:1,je=g[o+Ce];for(Ce+=Be,U=je&(1<<-ve)-1,je>>=-ve,ve+=X;ve>0;U=256*U+g[o+Ce],Ce+=Be,ve-=8);for($=U&(1<<-ve)-1,U>>=-ve,ve+=S;ve>0;$=256*$+g[o+Ce],Ce+=Be,ve-=8);if(U===0)U=1-fe;else{if(U===oe)return $?NaN:1/0*(je?-1:1);$+=Math.pow(2,S),U-=fe}return(je?-1:1)*$*Math.pow(2,U-S)},Fo.write=function(g,o,m,S,D,U){var $,X,oe,fe=8*U-D-1,ve=(1<<fe)-1,Ce=ve>>1,Be=D===23?Math.pow(2,-24)-Math.pow(2,-77):0,je=S?0:U-1,Ge=S?1:-1,lt=o<0||o===0&&1/o<0?1:0;for(o=Math.abs(o),isNaN(o)||o===1/0?(X=isNaN(o)?1:0,$=ve):($=Math.floor(Math.log(o)/Math.LN2),o*(oe=Math.pow(2,-$))<1&&($--,oe*=2),(o+=$+Ce>=1?Be/oe:Be*Math.pow(2,1-Ce))*oe>=2&&($++,oe/=2),$+Ce>=ve?(X=0,$=ve):$+Ce>=1?(X=(o*oe-1)*Math.pow(2,D),$+=Ce):(X=o*Math.pow(2,Ce-1)*Math.pow(2,D),$=0));D>=8;g[m+je]=255&X,je+=Ge,X/=256,D-=8);for($=$<<D|X,fe+=D;fe>0;g[m+je]=255&$,je+=Ge,$/=256,fe-=8);g[m+je-Ge]|=128*lt}),Fo}function jl(){if(So)return is;So=1,is=o;var g=Tc();function o(Ne){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(Ne)?Ne:new Uint8Array(Ne||0),this.pos=0,this.type=0,this.length=this.buf.length}o.Varint=0,o.Fixed64=1,o.Bytes=2,o.Fixed32=5;var m=4294967296,S=1/m,D=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function U(Ne){return Ne.type===o.Bytes?Ne.readVarint()+Ne.pos:Ne.pos+1}function $(Ne,xt,Yt){return Yt?4294967296*xt+(Ne>>>0):4294967296*(xt>>>0)+(Ne>>>0)}function X(Ne,xt,Yt){var Dn=xt<=16383?1:xt<=2097151?2:xt<=268435455?3:Math.floor(Math.log(xt)/(7*Math.LN2));Yt.realloc(Dn);for(var bi=Yt.pos-1;bi>=Ne;bi--)Yt.buf[bi+Dn]=Yt.buf[bi]}function oe(Ne,xt){for(var Yt=0;Yt<Ne.length;Yt++)xt.writeVarint(Ne[Yt])}function fe(Ne,xt){for(var Yt=0;Yt<Ne.length;Yt++)xt.writeSVarint(Ne[Yt])}function ve(Ne,xt){for(var Yt=0;Yt<Ne.length;Yt++)xt.writeFloat(Ne[Yt])}function Ce(Ne,xt){for(var Yt=0;Yt<Ne.length;Yt++)xt.writeDouble(Ne[Yt])}function Be(Ne,xt){for(var Yt=0;Yt<Ne.length;Yt++)xt.writeBoolean(Ne[Yt])}function je(Ne,xt){for(var Yt=0;Yt<Ne.length;Yt++)xt.writeFixed32(Ne[Yt])}function Ge(Ne,xt){for(var Yt=0;Yt<Ne.length;Yt++)xt.writeSFixed32(Ne[Yt])}function lt(Ne,xt){for(var Yt=0;Yt<Ne.length;Yt++)xt.writeFixed64(Ne[Yt])}function Tt(Ne,xt){for(var Yt=0;Yt<Ne.length;Yt++)xt.writeSFixed64(Ne[Yt])}function Ot(Ne,xt){return(Ne[xt]|Ne[xt+1]<<8|Ne[xt+2]<<16)+16777216*Ne[xt+3]}function ln(Ne,xt,Yt){Ne[Yt]=xt,Ne[Yt+1]=xt>>>8,Ne[Yt+2]=xt>>>16,Ne[Yt+3]=xt>>>24}function Zt(Ne,xt){return(Ne[xt]|Ne[xt+1]<<8|Ne[xt+2]<<16)+(Ne[xt+3]<<24)}return o.prototype={destroy:function(){this.buf=null},readFields:function(Ne,xt,Yt){for(Yt=Yt||this.length;this.pos<Yt;){var Dn=this.readVarint(),bi=Dn>>3,Un=this.pos;this.type=7&Dn,Ne(bi,xt,this),this.pos===Un&&this.skip(Dn)}return xt},readMessage:function(Ne,xt){return this.readFields(Ne,xt,this.readVarint()+this.pos)},readFixed32:function(){var Ne=Ot(this.buf,this.pos);return this.pos+=4,Ne},readSFixed32:function(){var Ne=Zt(this.buf,this.pos);return this.pos+=4,Ne},readFixed64:function(){var Ne=Ot(this.buf,this.pos)+Ot(this.buf,this.pos+4)*m;return this.pos+=8,Ne},readSFixed64:function(){var Ne=Ot(this.buf,this.pos)+Zt(this.buf,this.pos+4)*m;return this.pos+=8,Ne},readFloat:function(){var Ne=g.read(this.buf,this.pos,!0,23,4);return this.pos+=4,Ne},readDouble:function(){var Ne=g.read(this.buf,this.pos,!0,52,8);return this.pos+=8,Ne},readVarint:function(Ne){var xt,Yt,Dn=this.buf;return xt=127&(Yt=Dn[this.pos++]),Yt<128?xt:(xt|=(127&(Yt=Dn[this.pos++]))<<7,Yt<128?xt:(xt|=(127&(Yt=Dn[this.pos++]))<<14,Yt<128?xt:(xt|=(127&(Yt=Dn[this.pos++]))<<21,Yt<128?xt:function(bi,Un,Kn){var Di,Si,Li=Kn.buf;if(Di=(112&(Si=Li[Kn.pos++]))>>4,Si<128||(Di|=(127&(Si=Li[Kn.pos++]))<<3,Si<128)||(Di|=(127&(Si=Li[Kn.pos++]))<<10,Si<128)||(Di|=(127&(Si=Li[Kn.pos++]))<<17,Si<128)||(Di|=(127&(Si=Li[Kn.pos++]))<<24,Si<128)||(Di|=(1&(Si=Li[Kn.pos++]))<<31,Si<128))return $(bi,Di,Un);throw new Error("Expected varint not more than 10 bytes")}(xt|=(15&(Yt=Dn[this.pos]))<<28,Ne,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var Ne=this.readVarint();return Ne%2==1?(Ne+1)/-2:Ne/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var Ne=this.readVarint()+this.pos,xt=this.pos;return this.pos=Ne,Ne-xt>=12&&D?function(Yt,Dn,bi){return D.decode(Yt.subarray(Dn,bi))}(this.buf,xt,Ne):function(Yt,Dn,bi){for(var Un="",Kn=Dn;Kn<bi;){var Di,Si,Li,ni=Yt[Kn],ar=null,Cr=ni>239?4:ni>223?3:ni>191?2:1;if(Kn+Cr>bi)break;Cr===1?ni<128&&(ar=ni):Cr===2?(192&(Di=Yt[Kn+1]))==128&&(ar=(31&ni)<<6|63&Di)<=127&&(ar=null):Cr===3?(Si=Yt[Kn+2],(192&(Di=Yt[Kn+1]))==128&&(192&Si)==128&&((ar=(15&ni)<<12|(63&Di)<<6|63&Si)<=2047||ar>=55296&&ar<=57343)&&(ar=null)):Cr===4&&(Si=Yt[Kn+2],Li=Yt[Kn+3],(192&(Di=Yt[Kn+1]))==128&&(192&Si)==128&&(192&Li)==128&&((ar=(15&ni)<<18|(63&Di)<<12|(63&Si)<<6|63&Li)<=65535||ar>=1114112)&&(ar=null)),ar===null?(ar=65533,Cr=1):ar>65535&&(ar-=65536,Un+=String.fromCharCode(ar>>>10&1023|55296),ar=56320|1023&ar),Un+=String.fromCharCode(ar),Kn+=Cr}return Un}(this.buf,xt,Ne)},readBytes:function(){var Ne=this.readVarint()+this.pos,xt=this.buf.subarray(this.pos,Ne);return this.pos=Ne,xt},readPackedVarint:function(Ne,xt){if(this.type!==o.Bytes)return Ne.push(this.readVarint(xt));var Yt=U(this);for(Ne=Ne||[];this.pos<Yt;)Ne.push(this.readVarint(xt));return Ne},readPackedSVarint:function(Ne){if(this.type!==o.Bytes)return Ne.push(this.readSVarint());var xt=U(this);for(Ne=Ne||[];this.pos<xt;)Ne.push(this.readSVarint());return Ne},readPackedBoolean:function(Ne){if(this.type!==o.Bytes)return Ne.push(this.readBoolean());var xt=U(this);for(Ne=Ne||[];this.pos<xt;)Ne.push(this.readBoolean());return Ne},readPackedFloat:function(Ne){if(this.type!==o.Bytes)return Ne.push(this.readFloat());var xt=U(this);for(Ne=Ne||[];this.pos<xt;)Ne.push(this.readFloat());return Ne},readPackedDouble:function(Ne){if(this.type!==o.Bytes)return Ne.push(this.readDouble());var xt=U(this);for(Ne=Ne||[];this.pos<xt;)Ne.push(this.readDouble());return Ne},readPackedFixed32:function(Ne){if(this.type!==o.Bytes)return Ne.push(this.readFixed32());var xt=U(this);for(Ne=Ne||[];this.pos<xt;)Ne.push(this.readFixed32());return Ne},readPackedSFixed32:function(Ne){if(this.type!==o.Bytes)return Ne.push(this.readSFixed32());var xt=U(this);for(Ne=Ne||[];this.pos<xt;)Ne.push(this.readSFixed32());return Ne},readPackedFixed64:function(Ne){if(this.type!==o.Bytes)return Ne.push(this.readFixed64());var xt=U(this);for(Ne=Ne||[];this.pos<xt;)Ne.push(this.readFixed64());return Ne},readPackedSFixed64:function(Ne){if(this.type!==o.Bytes)return Ne.push(this.readSFixed64());var xt=U(this);for(Ne=Ne||[];this.pos<xt;)Ne.push(this.readSFixed64());return Ne},skip:function(Ne){var xt=7&Ne;if(xt===o.Varint)for(;this.buf[this.pos++]>127;);else if(xt===o.Bytes)this.pos=this.readVarint()+this.pos;else if(xt===o.Fixed32)this.pos+=4;else{if(xt!==o.Fixed64)throw new Error("Unimplemented type: "+xt);this.pos+=8}},writeTag:function(Ne,xt){this.writeVarint(Ne<<3|xt)},realloc:function(Ne){for(var xt=this.length||16;xt<this.pos+Ne;)xt*=2;if(xt!==this.length){var Yt=new Uint8Array(xt);Yt.set(this.buf),this.buf=Yt,this.length=xt}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(Ne){this.realloc(4),ln(this.buf,Ne,this.pos),this.pos+=4},writeSFixed32:function(Ne){this.realloc(4),ln(this.buf,Ne,this.pos),this.pos+=4},writeFixed64:function(Ne){this.realloc(8),ln(this.buf,-1&Ne,this.pos),ln(this.buf,Math.floor(Ne*S),this.pos+4),this.pos+=8},writeSFixed64:function(Ne){this.realloc(8),ln(this.buf,-1&Ne,this.pos),ln(this.buf,Math.floor(Ne*S),this.pos+4),this.pos+=8},writeVarint:function(Ne){(Ne=+Ne||0)>268435455||Ne<0?function(xt,Yt){var Dn,bi;if(xt>=0?(Dn=xt%4294967296|0,bi=xt/4294967296|0):(bi=~(-xt/4294967296),4294967295^(Dn=~(-xt%4294967296))?Dn=Dn+1|0:(Dn=0,bi=bi+1|0)),xt>=18446744073709552e3||xt<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");Yt.realloc(10),function(Un,Kn,Di){Di.buf[Di.pos++]=127&Un|128,Un>>>=7,Di.buf[Di.pos++]=127&Un|128,Un>>>=7,Di.buf[Di.pos++]=127&Un|128,Un>>>=7,Di.buf[Di.pos++]=127&Un|128,Di.buf[Di.pos]=127&(Un>>>=7)}(Dn,0,Yt),function(Un,Kn){var Di=(7&Un)<<4;Kn.buf[Kn.pos++]|=Di|((Un>>>=3)?128:0),Un&&(Kn.buf[Kn.pos++]=127&Un|((Un>>>=7)?128:0),Un&&(Kn.buf[Kn.pos++]=127&Un|((Un>>>=7)?128:0),Un&&(Kn.buf[Kn.pos++]=127&Un|((Un>>>=7)?128:0),Un&&(Kn.buf[Kn.pos++]=127&Un|((Un>>>=7)?128:0),Un&&(Kn.buf[Kn.pos++]=127&Un)))))}(bi,Yt)}(Ne,this):(this.realloc(4),this.buf[this.pos++]=127&Ne|(Ne>127?128:0),Ne<=127||(this.buf[this.pos++]=127&(Ne>>>=7)|(Ne>127?128:0),Ne<=127||(this.buf[this.pos++]=127&(Ne>>>=7)|(Ne>127?128:0),Ne<=127||(this.buf[this.pos++]=Ne>>>7&127))))},writeSVarint:function(Ne){this.writeVarint(Ne<0?2*-Ne-1:2*Ne)},writeBoolean:function(Ne){this.writeVarint(!!Ne)},writeString:function(Ne){Ne=String(Ne),this.realloc(4*Ne.length),this.pos++;var xt=this.pos;this.pos=function(Dn,bi,Un){for(var Kn,Di,Si=0;Si<bi.length;Si++){if((Kn=bi.charCodeAt(Si))>55295&&Kn<57344){if(!Di){Kn>56319||Si+1===bi.length?(Dn[Un++]=239,Dn[Un++]=191,Dn[Un++]=189):Di=Kn;continue}if(Kn<56320){Dn[Un++]=239,Dn[Un++]=191,Dn[Un++]=189,Di=Kn;continue}Kn=Di-55296<<10|Kn-56320|65536,Di=null}else Di&&(Dn[Un++]=239,Dn[Un++]=191,Dn[Un++]=189,Di=null);Kn<128?Dn[Un++]=Kn:(Kn<2048?Dn[Un++]=Kn>>6|192:(Kn<65536?Dn[Un++]=Kn>>12|224:(Dn[Un++]=Kn>>18|240,Dn[Un++]=Kn>>12&63|128),Dn[Un++]=Kn>>6&63|128),Dn[Un++]=63&Kn|128)}return Un}(this.buf,Ne,this.pos);var Yt=this.pos-xt;Yt>=128&&X(xt,Yt,this),this.pos=xt-1,this.writeVarint(Yt),this.pos+=Yt},writeFloat:function(Ne){this.realloc(4),g.write(this.buf,Ne,this.pos,!0,23,4),this.pos+=4},writeDouble:function(Ne){this.realloc(8),g.write(this.buf,Ne,this.pos,!0,52,8),this.pos+=8},writeBytes:function(Ne){var xt=Ne.length;this.writeVarint(xt),this.realloc(xt);for(var Yt=0;Yt<xt;Yt++)this.buf[this.pos++]=Ne[Yt]},writeRawMessage:function(Ne,xt){this.pos++;var Yt=this.pos;Ne(xt,this);var Dn=this.pos-Yt;Dn>=128&&X(Yt,Dn,this),this.pos=Yt-1,this.writeVarint(Dn),this.pos+=Dn},writeMessage:function(Ne,xt,Yt){this.writeTag(Ne,o.Bytes),this.writeRawMessage(xt,Yt)},writePackedVarint:function(Ne,xt){xt.length&&this.writeMessage(Ne,oe,xt)},writePackedSVarint:function(Ne,xt){xt.length&&this.writeMessage(Ne,fe,xt)},writePackedBoolean:function(Ne,xt){xt.length&&this.writeMessage(Ne,Be,xt)},writePackedFloat:function(Ne,xt){xt.length&&this.writeMessage(Ne,ve,xt)},writePackedDouble:function(Ne,xt){xt.length&&this.writeMessage(Ne,Ce,xt)},writePackedFixed32:function(Ne,xt){xt.length&&this.writeMessage(Ne,je,xt)},writePackedSFixed32:function(Ne,xt){xt.length&&this.writeMessage(Ne,Ge,xt)},writePackedFixed64:function(Ne,xt){xt.length&&this.writeMessage(Ne,lt,xt)},writePackedSFixed64:function(Ne,xt){xt.length&&this.writeMessage(Ne,Tt,xt)},writeBytesField:function(Ne,xt){this.writeTag(Ne,o.Bytes),this.writeBytes(xt)},writeFixed32Field:function(Ne,xt){this.writeTag(Ne,o.Fixed32),this.writeFixed32(xt)},writeSFixed32Field:function(Ne,xt){this.writeTag(Ne,o.Fixed32),this.writeSFixed32(xt)},writeFixed64Field:function(Ne,xt){this.writeTag(Ne,o.Fixed64),this.writeFixed64(xt)},writeSFixed64Field:function(Ne,xt){this.writeTag(Ne,o.Fixed64),this.writeSFixed64(xt)},writeVarintField:function(Ne,xt){this.writeTag(Ne,o.Varint),this.writeVarint(xt)},writeSVarintField:function(Ne,xt){this.writeTag(Ne,o.Varint),this.writeSVarint(xt)},writeStringField:function(Ne,xt){this.writeTag(Ne,o.Bytes),this.writeString(xt)},writeFloatField:function(Ne,xt){this.writeTag(Ne,o.Fixed32),this.writeFloat(xt)},writeDoubleField:function(Ne,xt){this.writeTag(Ne,o.Fixed64),this.writeDouble(xt)},writeBooleanField:function(Ne,xt){this.writeVarintField(Ne,!!xt)}},is}var Su=G(jl());const Ho=3;function Tu(g,o,m){g===1&&m.readMessage(ac,o)}function ac(g,o,m){if(g===3){const{id:S,bitmap:D,width:U,height:$,left:X,top:oe,advance:fe}=m.readMessage(Ad,{});o.push({id:S,bitmap:new Vl({width:U+2*Ho,height:$+2*Ho},D),metrics:{width:U,height:$,left:X,top:oe,advance:fe}})}}function Ad(g,o,m){g===1?o.id=m.readVarint():g===2?o.bitmap=m.readBytes():g===3?o.width=m.readVarint():g===4?o.height=m.readVarint():g===5?o.left=m.readSVarint():g===6?o.top=m.readSVarint():g===7&&(o.advance=m.readVarint())}const uh=Ho;function kd(g){let o=0,m=0;for(const $ of g)o+=$.w*$.h,m=Math.max(m,$.w);g.sort(($,X)=>X.h-$.h);const S=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(o/.95)),m),h:1/0}];let D=0,U=0;for(const $ of g)for(let X=S.length-1;X>=0;X--){const oe=S[X];if(!($.w>oe.w||$.h>oe.h)){if($.x=oe.x,$.y=oe.y,U=Math.max(U,$.y+$.h),D=Math.max(D,$.x+$.w),$.w===oe.w&&$.h===oe.h){const fe=S.pop();X<S.length&&(S[X]=fe)}else $.h===oe.h?(oe.x+=$.w,oe.w-=$.w):$.w===oe.w?(oe.y+=$.h,oe.h-=$.h):(S.push({x:oe.x+$.w,y:oe.y,w:oe.w-$.w,h:$.h}),oe.y+=$.h,oe.h-=$.h);break}}return{w:D,h:U,fill:o/(D*U)||0}}const Bo=1;class Tp{constructor(o,{pixelRatio:m,version:S,stretchX:D,stretchY:U,content:$,textFitWidth:X,textFitHeight:oe}){this.paddedRect=o,this.pixelRatio=m,this.stretchX=D,this.stretchY=U,this.content=$,this.version=S,this.textFitWidth=X,this.textFitHeight=oe}get tl(){return[this.paddedRect.x+Bo,this.paddedRect.y+Bo]}get br(){return[this.paddedRect.x+this.paddedRect.w-Bo,this.paddedRect.y+this.paddedRect.h-Bo]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Bo)/this.pixelRatio,(this.paddedRect.h-2*Bo)/this.pixelRatio]}}class hm{constructor(o,m){const S={},D={};this.haveRenderCallbacks=[];const U=[];this.addImages(o,S,U),this.addImages(m,D,U);const{w:$,h:X}=kd(U),oe=new vo({width:$||1,height:X||1});for(const fe in o){const ve=o[fe],Ce=S[fe].paddedRect;vo.copy(ve.data,oe,{x:0,y:0},{x:Ce.x+Bo,y:Ce.y+Bo},ve.data)}for(const fe in m){const ve=m[fe],Ce=D[fe].paddedRect,Be=Ce.x+Bo,je=Ce.y+Bo,Ge=ve.data.width,lt=ve.data.height;vo.copy(ve.data,oe,{x:0,y:0},{x:Be,y:je},ve.data),vo.copy(ve.data,oe,{x:0,y:lt-1},{x:Be,y:je-1},{width:Ge,height:1}),vo.copy(ve.data,oe,{x:0,y:0},{x:Be,y:je+lt},{width:Ge,height:1}),vo.copy(ve.data,oe,{x:Ge-1,y:0},{x:Be-1,y:je},{width:1,height:lt}),vo.copy(ve.data,oe,{x:0,y:0},{x:Be+Ge,y:je},{width:1,height:lt})}this.image=oe,this.iconPositions=S,this.patternPositions=D}addImages(o,m,S){for(const D in o){const U=o[D],$={x:0,y:0,w:U.data.width+2*Bo,h:U.data.height+2*Bo};S.push($),m[D]=new Tp($,U),U.hasRenderCallback&&this.haveRenderCallbacks.push(D)}}patchUpdatedImages(o,m){o.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const S in o.updatedImages)this.patchUpdatedImage(this.iconPositions[S],o.getImage(S),m),this.patchUpdatedImage(this.patternPositions[S],o.getImage(S),m)}patchUpdatedImage(o,m,S){if(!o||!m||o.version===m.version)return;o.version=m.version;const[D,U]=o.tl;S.update(m.data,void 0,{x:D,y:U})}}var Cp;Yi("ImagePosition",Tp),Yi("ImageAtlas",hm),T.ai=void 0,(Cp=T.ai||(T.ai={}))[Cp.none=0]="none",Cp[Cp.horizontal=1]="horizontal",Cp[Cp.vertical=2]="vertical",Cp[Cp.horizontalOnly=3]="horizontalOnly";const Wg=-17;class Xg{constructor(){this.scale=1,this.fontStack="",this.imageName=null,this.verticalAlign="bottom"}static forText(o,m,S){const D=new Xg;return D.scale=o||1,D.fontStack=m,D.verticalAlign=S||"bottom",D}static forImage(o,m){const S=new Xg;return S.imageName=o,S.verticalAlign=m||"bottom",S}}class Jm{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(o,m){const S=new Jm;for(let D=0;D<o.sections.length;D++){const U=o.sections[D];U.image?S.addImageSection(U):S.addTextSection(U,m)}return S}length(){return this.text.length}getSection(o){return this.sections[this.sectionIndex[o]]}getSectionIndex(o){return this.sectionIndex[o]}getCharCode(o){return this.text.charCodeAt(o)}verticalizePunctuation(){this.text=function(o){let m="";for(let S=0;S<o.length;S++){const D=o.charCodeAt(S+1)||null,U=o.charCodeAt(S-1)||null;m+=D&&dp(D)&&!fa[o[S+1]]||U&&dp(U)&&!fa[o[S-1]]||!fa[o[S]]?o[S]:fa[o[S]]}return m}(this.text)}trim(){let o=0;for(let S=0;S<this.text.length&&Kg[this.text.charCodeAt(S)];S++)o++;let m=this.text.length;for(let S=this.text.length-1;S>=0&&S>=o&&Kg[this.text.charCodeAt(S)];S--)m--;this.text=this.text.substring(o,m),this.sectionIndex=this.sectionIndex.slice(o,m)}substring(o,m){const S=new Jm;return S.text=this.text.substring(o,m),S.sectionIndex=this.sectionIndex.slice(o,m),S.sections=this.sections,S}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((o,m)=>Math.max(o,this.sections[m].scale),0)}getMaxImageSize(o){let m=0,S=0;for(let D=0;D<this.length();D++){const U=this.getSection(D);if(U.imageName){const $=o[U.imageName];if(!$)continue;const X=$.displaySize;m=Math.max(m,X[0]),S=Math.max(S,X[1])}}return{maxImageWidth:m,maxImageHeight:S}}addTextSection(o,m){this.text+=o.text,this.sections.push(Xg.forText(o.scale,o.fontStack||m,o.verticalAlign));const S=this.sections.length-1;for(let D=0;D<o.text.length;++D)this.sectionIndex.push(S)}addImageSection(o){const m=o.image?o.image.name:"";if(m.length===0)return void Zn("Can't add FormattedSection with an empty image.");const S=this.getNextImageSectionCharCode();S?(this.text+=String.fromCharCode(S),this.sections.push(Xg.forImage(m,o.verticalAlign)),this.sectionIndex.push(this.sections.length-1)):Zn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Yg(g,o,m,S,D,U,$,X,oe,fe,ve,Ce,Be,je,Ge){const lt=Jm.fromFeature(g,D);let Tt;Ce===T.ai.vertical&&lt.verticalizePunctuation();const{processBidirectionalText:Ot,processStyledBidirectionalText:ln}=yc;if(Ot&&lt.sections.length===1){Tt=[];const xt=Ot(lt.toString(),Zo(lt,fe,U,o,S,je));for(const Yt of xt){const Dn=new Jm;Dn.text=Yt,Dn.sections=lt.sections;for(let bi=0;bi<Yt.length;bi++)Dn.sectionIndex.push(0);Tt.push(Dn)}}else if(ln){Tt=[];const xt=ln(lt.text,lt.sectionIndex,Zo(lt,fe,U,o,S,je));for(const Yt of xt){const Dn=new Jm;Dn.text=Yt[0],Dn.sectionIndex=Yt[1],Dn.sections=lt.sections,Tt.push(Dn)}}else Tt=function(xt,Yt){const Dn=[],bi=xt.text;let Un=0;for(const Kn of Yt)Dn.push(xt.substring(Un,Kn)),Un=Kn;return Un<bi.length&&Dn.push(xt.substring(Un,bi.length)),Dn}(lt,Zo(lt,fe,U,o,S,je));const Zt=[],Ne={positionedLines:Zt,text:lt.toString(),top:ve[1],bottom:ve[1],left:ve[0],right:ve[0],writingMode:Ce,iconsInText:!1,verticalizable:!1};return function(xt,Yt,Dn,bi,Un,Kn,Di,Si,Li,ni,ar,Cr){let gr=0,hr=0,pa=0,vs=0;const To=Si==="right"?1:Si==="left"?0:.5,xl=Lr/Cr;let Cu=0;for(const zs of Un){zs.trim();const Xo=zs.getMaxScale(),ll={positionedGlyphs:[],lineOffset:0};xt.positionedLines[Cu]=ll;const Yo=ll.positionedGlyphs;let sc=0;if(!zs.length()){hr+=Kn,++Cu;continue}const rs=Jg(bi,zs,xl);for(let bl=0;bl<zs.length();bl++){const oo=zs.getSection(bl),lo=zs.getSectionIndex(bl),js=zs.getCharCode(bl),Co=zw(Li,ar,js);let Ts;if(oo.imageName){if(xt.iconsInText=!0,oo.scale=oo.scale*xl,Ts=Lb(oo,Co,Xo,rs,bi),!Ts)continue;sc=Math.max(sc,Ts.imageOffset)}else if(Ts=Qg(oo,js,Co,rs,Yt,Dn),!Ts)continue;const{rect:Mc,metrics:lg,baselineOffset:Fh}=Ts;Yo.push({glyph:js,imageName:oo.imageName,x:gr,y:hr+Fh+Wg,vertical:Co,scale:oo.scale,fontStack:oo.fontStack,sectionIndex:lo,metrics:lg,rect:Mc}),Co?(xt.verticalizable=!0,gr+=(oo.imageName?lg.advance:Lr)*oo.scale+ni):gr+=lg.advance*oo.scale+ni}Yo.length!==0&&(pa=Math.max(gr-ni,pa),dm(Yo,0,Yo.length-1,To)),gr=0,ll.lineOffset=Math.max(sc,(Xo-1)*Lr);const hs=Kn*Xo+sc;hr+=hs,vs=Math.max(hs,vs),++Cu}const{horizontalAlign:Ec,verticalAlign:ol}=uy(Di);(function(zs,Xo,ll,Yo,sc,rs,hs,bl,oo){const lo=(Xo-ll)*sc;let js=0;js=rs!==hs?-bl*Yo-Wg:-Yo*oo*hs+.5*hs;for(const Co of zs)for(const Ts of Co.positionedGlyphs)Ts.x+=lo,Ts.y+=js})(xt.positionedLines,To,Ec,ol,pa,vs,Kn,hr,Un.length),xt.top+=-ol*hr,xt.bottom=xt.top+hr,xt.left+=-Ec*pa,xt.right=xt.left+pa}(Ne,o,m,S,Tt,$,X,oe,Ce,fe,Be,Ge),!function(xt){for(const Yt of xt)if(Yt.positionedGlyphs.length!==0)return!1;return!0}(Zt)&&Ne}const Kg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Ab={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},kb={40:!0};function Mv(g,o,m,S,D,U){if(o.imageName){const $=S[o.imageName];return $?$.displaySize[0]*o.scale*Lr/U+D:0}{const $=m[o.fontStack],X=$&&$[g];return X?X.metrics.advance*o.scale+D:0}}function Iv(g,o,m,S){const D=Math.pow(g-o,2);return S?g<o?D/2:2*D:D+Math.abs(m)*m}function Db(g,o,m){let S=0;return g===10&&(S-=1e4),m&&(S+=150),g!==40&&g!==65288||(S+=50),o!==41&&o!==65289||(S+=50),S}function cy(g,o,m,S,D,U){let $=null,X=Iv(o,m,D,U);for(const oe of S){const fe=Iv(o-oe.x,m,D,U)+oe.badness;fe<=X&&($=oe,X=fe)}return{index:g,x:o,priorBreak:$,badness:X}}function wf(g){return g?wf(g.priorBreak).concat(g.index):[]}function Zo(g,o,m,S,D,U){if(!g)return[];const $=[],X=function(Ce,Be,je,Ge,lt,Tt){let Ot=0;for(let ln=0;ln<Ce.length();ln++){const Zt=Ce.getSection(ln);Ot+=Mv(Ce.getCharCode(ln),Zt,Ge,lt,Be,Tt)}return Ot/Math.max(1,Math.ceil(Ot/je))}(g,o,m,S,D,U),oe=g.text.indexOf("​")>=0;let fe=0;for(let Ce=0;Ce<g.length();Ce++){const Be=g.getSection(Ce),je=g.getCharCode(Ce);if(Kg[je]||(fe+=Mv(je,Be,S,D,o,U)),Ce<g.length()-1){const Ge=!((ve=je)<11904)&&(!!Qr["CJK Compatibility Forms"](ve)||!!Qr["CJK Compatibility"](ve)||!!Qr["CJK Strokes"](ve)||!!Qr["CJK Symbols and Punctuation"](ve)||!!Qr["Enclosed CJK Letters and Months"](ve)||!!Qr["Halfwidth and Fullwidth Forms"](ve)||!!Qr["Ideographic Description Characters"](ve)||!!Qr["Vertical Forms"](ve)||Dh.test(String.fromCodePoint(ve)));(Ab[je]||Ge||Be.imageName||Ce!==g.length()-2&&kb[g.getCharCode(Ce+1)])&&$.push(cy(Ce+1,fe,X,$,Db(je,g.getCharCode(Ce+1),Ge&&oe),!1))}}var ve;return wf(cy(g.length(),fe,X,$,0,!0))}function uy(g){let o=.5,m=.5;switch(g){case"right":case"top-right":case"bottom-right":o=1;break;case"left":case"top-left":case"bottom-left":o=0}switch(g){case"bottom":case"bottom-right":case"bottom-left":m=1;break;case"top":case"top-right":case"top-left":m=0}return{horizontalAlign:o,verticalAlign:m}}function Jg(g,o,m){const S=o.getMaxScale()*Lr,{maxImageWidth:D,maxImageHeight:U}=o.getMaxImageSize(g),$=Math.max(S,U*m);return{verticalLineContentWidth:Math.max(S,D*m),horizontalLineContentHeight:$}}function Rb(g){switch(g){case"top":return 0;case"center":return .5;default:return 1}}function zw(g,o,m){return!(g===T.ai.horizontal||!o&&!vd(m)||o&&(Kg[m]||(S=m,new RegExp("\\p{sc=Arab}","u").test(String.fromCodePoint(S)))));var S}function Qg(g,o,m,S,D,U){const $=U[g.fontStack],X=function(fe,ve,Ce,Be){if(fe&&fe.rect)return fe;const je=ve[Ce.fontStack],Ge=je&&je[Be];return Ge?{rect:null,metrics:Ge.metrics}:null}($&&$[o],D,g,o);if(X===null)return null;let oe;if(m)oe=S.verticalLineContentWidth-g.scale*Lr;else{const fe=Rb(g.verticalAlign);oe=(S.horizontalLineContentHeight-g.scale*Lr)*fe}return{rect:X.rect,metrics:X.metrics,baselineOffset:oe}}function Lb(g,o,m,S,D){const U=D[g.imageName];if(!U)return null;const $=U.paddedRect,X=U.displaySize,oe={width:X[0],height:X[1],left:Bo,top:-3,advance:o?X[1]:X[0]};let fe;if(o)fe=S.verticalLineContentWidth-X[1]*g.scale;else{const ve=Rb(g.verticalAlign);fe=(S.horizontalLineContentHeight-X[1]*g.scale)*ve}return{rect:$,metrics:oe,baselineOffset:fe,imageOffset:(o?X[0]:X[1])*g.scale-Lr*m}}function dm(g,o,m,S){if(S===0)return;const D=g[m],U=(g[m].x+D.metrics.advance*D.scale)*S;for(let $=o;$<=m;$++)g[$].x-=U}function e_(g,o,m){const{horizontalAlign:S,verticalAlign:D}=uy(m),U=o[0]-g.displaySize[0]*S,$=o[1]-g.displaySize[1]*D;return{image:g,top:$,bottom:$+g.displaySize[1],left:U,right:U+g.displaySize[0]}}function zb(g){var o,m;let S=g.left,D=g.top,U=g.right-S,$=g.bottom-D;const X=(o=g.image.textFitWidth)!==null&&o!==void 0?o:"stretchOrShrink",oe=(m=g.image.textFitHeight)!==null&&m!==void 0?m:"stretchOrShrink",fe=(g.image.content[2]-g.image.content[0])/(g.image.content[3]-g.image.content[1]);if(oe==="proportional"){if(X==="stretchOnly"&&U/$<fe||X==="proportional"){const ve=Math.ceil($*fe);S*=ve/U,U=ve}}else if(X==="proportional"&&oe==="stretchOnly"&&fe!==0&&U/$>fe){const ve=Math.ceil(U/fe);D*=ve/$,$=ve}return{x1:S,y1:D,x2:S+U,y2:D+$}}function Ob(g,o,m,S,D,U){const $=g.image;let X;if($.content){const Tt=$.content,Ot=$.pixelRatio||1;X=[Tt[0]/Ot,Tt[1]/Ot,$.displaySize[0]-Tt[2]/Ot,$.displaySize[1]-Tt[3]/Ot]}const oe=o.left*U,fe=o.right*U;let ve,Ce,Be,je;m==="width"||m==="both"?(je=D[0]+oe-S[3],Ce=D[0]+fe+S[1]):(je=D[0]+(oe+fe-$.displaySize[0])/2,Ce=je+$.displaySize[0]);const Ge=o.top*U,lt=o.bottom*U;return m==="height"||m==="both"?(ve=D[1]+Ge-S[0],Be=D[1]+lt+S[2]):(ve=D[1]+(Ge+lt-$.displaySize[1])/2,Be=ve+$.displaySize[1]),{image:$,top:ve,right:Ce,bottom:Be,left:je,collisionPadding:X}}const t_=255,Dd=128,Ep=t_*Dd;function Fb(g,o){const{expression:m}=o;if(m.kind==="constant")return{kind:"constant",layoutSize:m.evaluate(new ls(g+1))};if(m.kind==="source")return{kind:"source"};{const{zoomStops:S,interpolationType:D}=m;let U=0;for(;U<S.length&&S[U]<=g;)U++;U=Math.max(0,U-1);let $=U;for(;$<S.length&&S[$]<g+1;)$++;$=Math.min(S.length-1,$);const X=S[U],oe=S[$];return m.kind==="composite"?{kind:"composite",minZoom:X,maxZoom:oe,interpolationType:D}:{kind:"camera",minZoom:X,maxZoom:oe,minSize:m.evaluate(new ls(X)),maxSize:m.evaluate(new ls(oe)),interpolationType:D}}}function Pv(g,o,m){let S="never";const D=g.get(o);return D?S=D:g.get(m)&&(S="always"),S}const Av=Vn.VectorTileFeature.types,Ow=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Sf(g,o,m,S,D,U,$,X,oe,fe,ve,Ce,Be){const je=X?Math.min(Ep,Math.round(X[0])):0,Ge=X?Math.min(Ep,Math.round(X[1])):0;g.emplaceBack(o,m,Math.round(32*S),Math.round(32*D),U,$,(je<<1)+(oe?1:0),Ge,16*fe,16*ve,256*Ce,256*Be)}function kv(g,o,m){g.emplaceBack(o.x,o.y,m),g.emplaceBack(o.x,o.y,m),g.emplaceBack(o.x,o.y,m),g.emplaceBack(o.x,o.y,m)}function so(g){for(const o of g.sections)if(ki(o.text))return!0;return!1}class Qm{constructor(o){this.layoutVertexArray=new an,this.indexArray=new jn,this.programConfigurations=o,this.segments=new Gi,this.dynamicLayoutVertexArray=new Mn,this.opacityVertexArray=new Rn,this.hasVisibleVertices=!1,this.placedSymbolArray=new re}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(o,m,S,D){this.isEmpty()||(S&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,vl.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,m),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,Ls.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,Ow,!0),this.opacityVertexBuffer.itemSize=1),(S||D)&&this.programConfigurations.upload(o))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Yi("SymbolBuffers",Qm);class hy{constructor(o,m,S){this.layoutVertexArray=new o,this.layoutAttributes=m,this.indexArray=new S,this.segments=new Gi,this.collisionVertexArray=new ei}upload(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,wo.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Yi("CollisionBuffers",hy);class Tf{constructor(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map($=>$.id),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[];const m=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Fb(this.zoom,m["text-size"]),this.iconSizeData=Fb(this.zoom,m["icon-size"]);const S=this.layers[0].layout,D=S.get("symbol-sort-key"),U=S.get("symbol-z-order");this.canOverlap=Pv(S,"text-overlap","text-allow-overlap")!=="never"||Pv(S,"icon-overlap","icon-allow-overlap")!=="never"||S.get("text-ignore-placement")||S.get("icon-ignore-placement"),this.sortFeaturesByKey=U!=="viewport-y"&&!D.isConstant(),this.sortFeaturesByY=(U==="viewport-y"||U==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,S.get("symbol-placement")==="point"&&(this.writingModes=S.get("text-writing-mode").map($=>T.ai[$])),this.stateDependentLayerIds=this.layers.filter($=>$.isStateDependent()).map($=>$.id),this.sourceID=o.sourceID}createArrays(){this.text=new Qm(new _s(this.layers,this.zoom,o=>/^text/.test(o))),this.icon=new Qm(new _s(this.layers,this.zoom,o=>/^icon/.test(o))),this.glyphOffsetArray=new Me,this.lineVertexArray=new Re,this.symbolInstances=new ye,this.textAnchorOffsets=new Je}calculateGlyphDependencies(o,m,S,D,U){for(let $=0;$<o.length;$++)if(m[o.charCodeAt($)]=!0,(S||D)&&U){const X=fa[o.charAt($)];X&&(m[X.charCodeAt(0)]=!0)}}populate(o,m,S){const D=this.layers[0],U=D.layout,$=U.get("text-font"),X=U.get("text-field"),oe=U.get("icon-image"),fe=(X.value.kind!=="constant"||X.value.value instanceof $a&&!X.value.value.isEmpty()||X.value.value.toString().length>0)&&($.value.kind!=="constant"||$.value.value.length>0),ve=oe.value.kind!=="constant"||!!oe.value.value||Object.keys(oe.parameters).length>0,Ce=U.get("symbol-sort-key");if(this.features=[],!fe&&!ve)return;const Be=m.iconDependencies,je=m.glyphDependencies,Ge=m.availableImages,lt=new ls(this.zoom);for(const{feature:Tt,id:Ot,index:ln,sourceLayerIndex:Zt}of o){const Ne=D._featureFilter.needGeometry,xt=sh(Tt,Ne);if(!D._featureFilter.filter(lt,xt,S))continue;let Yt,Dn;if(Ne||(xt.geometry=wc(Tt)),fe){const Un=D.getValueAndResolveTokens("text-field",xt,S,Ge),Kn=$a.factory(Un),Di=this.hasRTLText=this.hasRTLText||so(Kn);(!Di||yc.getRTLTextPluginStatus()==="unavailable"||Di&&yc.isParsed())&&(Yt=wa(Kn,D,xt))}if(ve){const Un=D.getValueAndResolveTokens("icon-image",xt,S,Ge);Dn=Un instanceof ts?Un:ts.fromString(Un)}if(!Yt&&!Dn)continue;const bi=this.sortFeaturesByKey?Ce.evaluate(xt,{},S):void 0;if(this.features.push({id:Ot,text:Yt,icon:Dn,index:ln,sourceLayerIndex:Zt,geometry:xt.geometry,properties:Tt.properties,type:Av[Tt.type],sortKey:bi}),Dn&&(Be[Dn.name]=!0),Yt){const Un=$.evaluate(xt,{},S).join(","),Kn=U.get("text-rotation-alignment")!=="viewport"&&U.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(T.ai.vertical)>=0;for(const Di of Yt.sections)if(Di.image)Be[Di.image.name]=!0;else{const Si=Uc(Yt.toString()),Li=Di.fontStack||Un,ni=je[Li]=je[Li]||{};this.calculateGlyphDependencies(Di.text,ni,Kn,this.allowVerticalPlacement,Si)}}}U.get("symbol-placement")==="line"&&(this.features=function(Tt){const Ot={},ln={},Zt=[];let Ne=0;function xt(Un){Zt.push(Tt[Un]),Ne++}function Yt(Un,Kn,Di){const Si=ln[Un];return delete ln[Un],ln[Kn]=Si,Zt[Si].geometry[0].pop(),Zt[Si].geometry[0]=Zt[Si].geometry[0].concat(Di[0]),Si}function Dn(Un,Kn,Di){const Si=Ot[Kn];return delete Ot[Kn],Ot[Un]=Si,Zt[Si].geometry[0].shift(),Zt[Si].geometry[0]=Di[0].concat(Zt[Si].geometry[0]),Si}function bi(Un,Kn,Di){const Si=Di?Kn[0][Kn[0].length-1]:Kn[0][0];return`${Un}:${Si.x}:${Si.y}`}for(let Un=0;Un<Tt.length;Un++){const Kn=Tt[Un],Di=Kn.geometry,Si=Kn.text?Kn.text.toString():null;if(!Si){xt(Un);continue}const Li=bi(Si,Di),ni=bi(Si,Di,!0);if(Li in ln&&ni in Ot&&ln[Li]!==Ot[ni]){const ar=Dn(Li,ni,Di),Cr=Yt(Li,ni,Zt[ar].geometry);delete Ot[Li],delete ln[ni],ln[bi(Si,Zt[Cr].geometry,!0)]=Cr,Zt[ar].geometry=null}else Li in ln?Yt(Li,ni,Di):ni in Ot?Dn(Li,ni,Di):(xt(Un),Ot[Li]=Ne-1,ln[ni]=Ne-1)}return Zt.filter(Un=>Un.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Tt,Ot)=>Tt.sortKey-Ot.sortKey)}update(o,m,S){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(o,m,this.layers,S),this.icon.programConfigurations.updatePaintArrays(o,m,this.layers,S))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(o,m){const S=this.lineVertexArray.length;if(o.segment!==void 0){let D=o.dist(m[o.segment+1]),U=o.dist(m[o.segment]);const $={};for(let X=o.segment+1;X<m.length;X++)$[X]={x:m[X].x,y:m[X].y,tileUnitDistanceFromAnchor:D},X<m.length-1&&(D+=m[X+1].dist(m[X]));for(let X=o.segment||0;X>=0;X--)$[X]={x:m[X].x,y:m[X].y,tileUnitDistanceFromAnchor:U},X>0&&(U+=m[X-1].dist(m[X]));for(let X=0;X<m.length;X++){const oe=$[X];this.lineVertexArray.emplaceBack(oe.x,oe.y,oe.tileUnitDistanceFromAnchor)}}return{lineStartIndex:S,lineLength:this.lineVertexArray.length-S}}addSymbols(o,m,S,D,U,$,X,oe,fe,ve,Ce,Be){const je=o.indexArray,Ge=o.layoutVertexArray,lt=o.segments.prepareSegment(4*m.length,Ge,je,this.canOverlap?$.sortKey:void 0),Tt=this.glyphOffsetArray.length,Ot=lt.vertexLength,ln=this.allowVerticalPlacement&&X===T.ai.vertical?Math.PI/2:0,Zt=$.text&&$.text.sections;for(let Ne=0;Ne<m.length;Ne++){const{tl:xt,tr:Yt,bl:Dn,br:bi,tex:Un,pixelOffsetTL:Kn,pixelOffsetBR:Di,minFontScaleX:Si,minFontScaleY:Li,glyphOffset:ni,isSDF:ar,sectionIndex:Cr}=m[Ne],gr=lt.vertexLength,hr=ni[1];Sf(Ge,oe.x,oe.y,xt.x,hr+xt.y,Un.x,Un.y,S,ar,Kn.x,Kn.y,Si,Li),Sf(Ge,oe.x,oe.y,Yt.x,hr+Yt.y,Un.x+Un.w,Un.y,S,ar,Di.x,Kn.y,Si,Li),Sf(Ge,oe.x,oe.y,Dn.x,hr+Dn.y,Un.x,Un.y+Un.h,S,ar,Kn.x,Di.y,Si,Li),Sf(Ge,oe.x,oe.y,bi.x,hr+bi.y,Un.x+Un.w,Un.y+Un.h,S,ar,Di.x,Di.y,Si,Li),kv(o.dynamicLayoutVertexArray,oe,ln),je.emplaceBack(gr,gr+2,gr+1),je.emplaceBack(gr+1,gr+2,gr+3),lt.vertexLength+=4,lt.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ni[0]),Ne!==m.length-1&&Cr===m[Ne+1].sectionIndex||o.programConfigurations.populatePaintArrays(Ge.length,$,$.index,{},Be,Zt&&Zt[Cr])}o.placedSymbolArray.emplaceBack(oe.x,oe.y,Tt,this.glyphOffsetArray.length-Tt,Ot,fe,ve,oe.segment,S?S[0]:0,S?S[1]:0,D[0],D[1],X,0,!1,0,Ce)}_addCollisionDebugVertex(o,m,S,D,U,$){return m.emplaceBack(0,0),o.emplaceBack(S.x,S.y,D,U,Math.round($.x),Math.round($.y))}addCollisionDebugVertices(o,m,S,D,U,$,X){const oe=U.segments.prepareSegment(4,U.layoutVertexArray,U.indexArray),fe=oe.vertexLength,ve=U.layoutVertexArray,Ce=U.collisionVertexArray,Be=X.anchorX,je=X.anchorY;this._addCollisionDebugVertex(ve,Ce,$,Be,je,new ce(o,m)),this._addCollisionDebugVertex(ve,Ce,$,Be,je,new ce(S,m)),this._addCollisionDebugVertex(ve,Ce,$,Be,je,new ce(S,D)),this._addCollisionDebugVertex(ve,Ce,$,Be,je,new ce(o,D)),oe.vertexLength+=4;const Ge=U.indexArray;Ge.emplaceBack(fe,fe+1),Ge.emplaceBack(fe+1,fe+2),Ge.emplaceBack(fe+2,fe+3),Ge.emplaceBack(fe+3,fe),oe.primitiveLength+=4}addDebugCollisionBoxes(o,m,S,D){for(let U=o;U<m;U++){const $=this.collisionBoxArray.get(U);this.addCollisionDebugVertices($.x1,$.y1,$.x2,$.y2,D?this.textCollisionBox:this.iconCollisionBox,$.anchorPoint,S)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new hy(Hn,qo.members,Ri),this.iconCollisionBox=new hy(Hn,qo.members,Ri);for(let o=0;o<this.symbolInstances.length;o++){const m=this.symbolInstances.get(o);this.addDebugCollisionBoxes(m.textBoxStartIndex,m.textBoxEndIndex,m,!0),this.addDebugCollisionBoxes(m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m,!0),this.addDebugCollisionBoxes(m.iconBoxStartIndex,m.iconBoxEndIndex,m,!1),this.addDebugCollisionBoxes(m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m,!1)}}_deserializeCollisionBoxesForSymbol(o,m,S,D,U,$,X,oe,fe){const ve={};for(let Ce=m;Ce<S;Ce++){const Be=o.get(Ce);ve.textBox={x1:Be.x1,y1:Be.y1,x2:Be.x2,y2:Be.y2,anchorPointX:Be.anchorPointX,anchorPointY:Be.anchorPointY},ve.textFeatureIndex=Be.featureIndex;break}for(let Ce=D;Ce<U;Ce++){const Be=o.get(Ce);ve.verticalTextBox={x1:Be.x1,y1:Be.y1,x2:Be.x2,y2:Be.y2,anchorPointX:Be.anchorPointX,anchorPointY:Be.anchorPointY},ve.verticalTextFeatureIndex=Be.featureIndex;break}for(let Ce=$;Ce<X;Ce++){const Be=o.get(Ce);ve.iconBox={x1:Be.x1,y1:Be.y1,x2:Be.x2,y2:Be.y2,anchorPointX:Be.anchorPointX,anchorPointY:Be.anchorPointY},ve.iconFeatureIndex=Be.featureIndex;break}for(let Ce=oe;Ce<fe;Ce++){const Be=o.get(Ce);ve.verticalIconBox={x1:Be.x1,y1:Be.y1,x2:Be.x2,y2:Be.y2,anchorPointX:Be.anchorPointX,anchorPointY:Be.anchorPointY},ve.verticalIconFeatureIndex=Be.featureIndex;break}return ve}deserializeCollisionBoxes(o){this.collisionArrays=[];for(let m=0;m<this.symbolInstances.length;m++){const S=this.symbolInstances.get(m);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,S.textBoxStartIndex,S.textBoxEndIndex,S.verticalTextBoxStartIndex,S.verticalTextBoxEndIndex,S.iconBoxStartIndex,S.iconBoxEndIndex,S.verticalIconBoxStartIndex,S.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(o,m){const S=o.placedSymbolArray.get(m),D=S.vertexStartIndex+4*S.numGlyphs;for(let U=S.vertexStartIndex;U<D;U+=4)o.indexArray.emplaceBack(U,U+2,U+1),o.indexArray.emplaceBack(U+1,U+2,U+3)}getSortedSymbolIndexes(o){if(this.sortedAngle===o&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const m=Math.sin(o),S=Math.cos(o),D=[],U=[],$=[];for(let X=0;X<this.symbolInstances.length;++X){$.push(X);const oe=this.symbolInstances.get(X);D.push(0|Math.round(m*oe.anchorX+S*oe.anchorY)),U.push(oe.featureIndex)}return $.sort((X,oe)=>D[X]-D[oe]||U[oe]-U[X]),$}addToSortKeyRanges(o,m){const S=this.sortKeyRanges[this.sortKeyRanges.length-1];S&&S.sortKey===m?S.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:m,symbolInstanceStart:o,symbolInstanceEnd:o+1})}sortFeatures(o){if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const m of this.symbolInstanceIndexes){const S=this.symbolInstances.get(m);this.featureSortOrder.push(S.featureIndex),[S.rightJustifiedTextSymbolIndex,S.centerJustifiedTextSymbolIndex,S.leftJustifiedTextSymbolIndex].forEach((D,U,$)=>{D>=0&&$.indexOf(D)===U&&this.addIndicesForPlacedSymbol(this.text,D)}),S.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,S.verticalPlacedTextSymbolIndex),S.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,S.placedIconSymbolIndex),S.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,S.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let n_,eg;Yi("SymbolBucket",Tf,{omit:["layers","collisionBoxArray","features","compareText"]}),Tf.MAX_GLYPHS=65535,Tf.addDynamicAttributes=kv;var dy={get paint(){return eg=eg||new $o({"icon-opacity":new xr(bt.paint_symbol["icon-opacity"]),"icon-color":new xr(bt.paint_symbol["icon-color"]),"icon-halo-color":new xr(bt.paint_symbol["icon-halo-color"]),"icon-halo-width":new xr(bt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new xr(bt.paint_symbol["icon-halo-blur"]),"icon-translate":new cr(bt.paint_symbol["icon-translate"]),"icon-translate-anchor":new cr(bt.paint_symbol["icon-translate-anchor"]),"text-opacity":new xr(bt.paint_symbol["text-opacity"]),"text-color":new xr(bt.paint_symbol["text-color"],{runtimeType:Dt,getOverride:g=>g.textColor,hasOverride:g=>!!g.textColor}),"text-halo-color":new xr(bt.paint_symbol["text-halo-color"]),"text-halo-width":new xr(bt.paint_symbol["text-halo-width"]),"text-halo-blur":new xr(bt.paint_symbol["text-halo-blur"]),"text-translate":new cr(bt.paint_symbol["text-translate"]),"text-translate-anchor":new cr(bt.paint_symbol["text-translate-anchor"])})},get layout(){return n_=n_||new $o({"symbol-placement":new cr(bt.layout_symbol["symbol-placement"]),"symbol-spacing":new cr(bt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new cr(bt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new xr(bt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new cr(bt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new cr(bt.layout_symbol["icon-allow-overlap"]),"icon-overlap":new cr(bt.layout_symbol["icon-overlap"]),"icon-ignore-placement":new cr(bt.layout_symbol["icon-ignore-placement"]),"icon-optional":new cr(bt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new cr(bt.layout_symbol["icon-rotation-alignment"]),"icon-size":new xr(bt.layout_symbol["icon-size"]),"icon-text-fit":new cr(bt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new cr(bt.layout_symbol["icon-text-fit-padding"]),"icon-image":new xr(bt.layout_symbol["icon-image"]),"icon-rotate":new xr(bt.layout_symbol["icon-rotate"]),"icon-padding":new xr(bt.layout_symbol["icon-padding"]),"icon-keep-upright":new cr(bt.layout_symbol["icon-keep-upright"]),"icon-offset":new xr(bt.layout_symbol["icon-offset"]),"icon-anchor":new xr(bt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new cr(bt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new cr(bt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new cr(bt.layout_symbol["text-rotation-alignment"]),"text-field":new xr(bt.layout_symbol["text-field"]),"text-font":new xr(bt.layout_symbol["text-font"]),"text-size":new xr(bt.layout_symbol["text-size"]),"text-max-width":new xr(bt.layout_symbol["text-max-width"]),"text-line-height":new cr(bt.layout_symbol["text-line-height"]),"text-letter-spacing":new xr(bt.layout_symbol["text-letter-spacing"]),"text-justify":new xr(bt.layout_symbol["text-justify"]),"text-radial-offset":new xr(bt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new cr(bt.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new xr(bt.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new xr(bt.layout_symbol["text-anchor"]),"text-max-angle":new cr(bt.layout_symbol["text-max-angle"]),"text-writing-mode":new cr(bt.layout_symbol["text-writing-mode"]),"text-rotate":new xr(bt.layout_symbol["text-rotate"]),"text-padding":new cr(bt.layout_symbol["text-padding"]),"text-keep-upright":new cr(bt.layout_symbol["text-keep-upright"]),"text-transform":new xr(bt.layout_symbol["text-transform"]),"text-offset":new xr(bt.layout_symbol["text-offset"]),"text-allow-overlap":new cr(bt.layout_symbol["text-allow-overlap"]),"text-overlap":new cr(bt.layout_symbol["text-overlap"]),"text-ignore-placement":new cr(bt.layout_symbol["text-ignore-placement"]),"text-optional":new cr(bt.layout_symbol["text-optional"])})}};class Dv{constructor(o){if(o.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=o.property.overrides?o.property.overrides.runtimeType:yt,this.defaultValue=o}evaluate(o){if(o.formattedSection){const m=this.defaultValue.property.overrides;if(m&&m.hasOverride(o.formattedSection))return m.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default}eachChild(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Yi("FormatSectionOverride",Dv,{omit:["defaultValue"]});class Mp extends Ss{constructor(o){super(o,dy)}recalculate(o,m){if(super.recalculate(o,m),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const S=this.layout.get("text-writing-mode");if(S){const D=[];for(const U of S)D.indexOf(U)<0&&D.push(U);this.layout._values["text-writing-mode"]=D}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(o,m,S,D){const U=this.layout.get(o).evaluate(m,{},S,D),$=this._unevaluatedLayout._values[o];return $.isDataDriven()||Rr($.value)||!U?U:function(X,oe){return oe.replace(/{([^{}]+)}/g,(fe,ve)=>X&&ve in X?String(X[ve]):"")}(m.properties,U)}createBucket(o){return new Tf(o)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const o of dy.paint.overridableProperties){if(!Mp.hasPaintOverride(this.layout,o))continue;const m=this.paint.get(o),S=new Dv(m),D=new Ql(S,m.property.specification);let U=null;U=m.value.kind==="constant"||m.value.kind==="source"?new Eh("source",D):new af("composite",D,m.value.zoomStops),this.paint._values[o]=new Fl(m.property,U,m.parameters)}}_handleOverridablePaintPropertyUpdate(o,m,S){return!(!this.layout||m.isDataDriven()||S.isDataDriven())&&Mp.hasPaintOverride(this.layout,o)}static hasPaintOverride(o,m){const S=o.get("text-field"),D=dy.paint.properties[m];let U=!1;const $=X=>{for(const oe of X)if(D.overrides&&D.overrides.hasOverride(oe))return void(U=!0)};if(S.value.kind==="constant"&&S.value.value instanceof $a)$(S.value.value.sections);else if(S.value.kind==="source"){const X=fe=>{U||(fe instanceof Xl&&os(fe.value)===_i?$(fe.value.sections):fe instanceof kl?$(fe.sections):fe.eachChild(X))},oe=S.value;oe._styleExpression&&X(oe._styleExpression.expression)}return U}}let fy;var py={get paint(){return fy=fy||new $o({"background-color":new cr(bt.paint_background["background-color"]),"background-pattern":new wd(bt.paint_background["background-pattern"]),"background-opacity":new cr(bt.paint_background["background-opacity"])})}};class Fw extends Ss{constructor(o){super(o,py)}}let Rv;var Lv={get paint(){return Rv=Rv||new $o({"raster-opacity":new cr(bt.paint_raster["raster-opacity"]),"raster-hue-rotate":new cr(bt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new cr(bt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new cr(bt.paint_raster["raster-brightness-max"]),"raster-saturation":new cr(bt.paint_raster["raster-saturation"]),"raster-contrast":new cr(bt.paint_raster["raster-contrast"]),"raster-resampling":new cr(bt.paint_raster["raster-resampling"]),"raster-fade-duration":new cr(bt.paint_raster["raster-fade-duration"])})}};class zv extends Ss{constructor(o){super(o,Lv)}}class Ov extends Ss{constructor(o){super(o,{}),this.onAdd=m=>{this.implementation.onAdd&&this.implementation.onAdd(m,m.painter.context.gl)},this.onRemove=m=>{this.implementation.onRemove&&this.implementation.onRemove(m,m.painter.context.gl)},this.implementation=o}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Bb{constructor(o){this._methodToThrottle=o,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const my=63710088e-1;class Cf{constructor(o,m){if(isNaN(o)||isNaN(m))throw new Error(`Invalid LngLat object: (${o}, ${m})`);if(this.lng=+o,this.lat=+m,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Cf(Ci(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(o){const m=Math.PI/180,S=this.lat*m,D=o.lat*m,U=Math.sin(S)*Math.sin(D)+Math.cos(S)*Math.cos(D)*Math.cos((o.lng-this.lng)*m);return my*Math.acos(Math.min(U,1))}static convert(o){if(o instanceof Cf)return o;if(Array.isArray(o)&&(o.length===2||o.length===3))return new Cf(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&typeof o=="object"&&o!==null)return new Cf(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Fv=2*Math.PI*my;function gy(g){return Fv*Math.cos(g*Math.PI/180)}function Oh(g){return(180+g)/360}function Bv(g){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+g*Math.PI/360)))/360}function Vb(g,o){return g/gy(o)}function Vv(g){return 360/Math.PI*Math.atan(Math.exp((180-360*g)*Math.PI/180))-90}function Nb(g,o){return g*gy(Vv(o))}class i_{constructor(o,m,S=0){this.x=+o,this.y=+m,this.z=+S}static fromLngLat(o,m=0){const S=Cf.convert(o);return new i_(Oh(S.lng),Bv(S.lat),Vb(m,S.lat))}toLngLat(){return new Cf(360*this.x-180,Vv(this.y))}toAltitude(){return Nb(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Fv*(o=Vv(this.y),1/Math.cos(o*Math.PI/180));var o}}function jb(g,o,m){var S=2*Math.PI*6378137/256/Math.pow(2,m);return[g*S-2*Math.PI*6378137/2,o*S-2*Math.PI*6378137/2]}class Nv{constructor(o,m,S){if(!function(D,U,$){return!(D<0||D>25||$<0||$>=Math.pow(2,D)||U<0||U>=Math.pow(2,D))}(o,m,S))throw new Error(`x=${m}, y=${S}, z=${o} outside of bounds. 0<=x<${Math.pow(2,o)}, 0<=y<${Math.pow(2,o)} 0<=z<=25 `);this.z=o,this.x=m,this.y=S,this.key=fm(0,o,o,m,S)}equals(o){return this.z===o.z&&this.x===o.x&&this.y===o.y}url(o,m,S){const D=($=this.y,X=this.z,oe=jb(256*(U=this.x),256*($=Math.pow(2,X)-$-1),X),fe=jb(256*(U+1),256*($+1),X),oe[0]+","+oe[1]+","+fe[0]+","+fe[1]);var U,$,X,oe,fe;const ve=function(Ce,Be,je){let Ge,lt="";for(let Tt=Ce;Tt>0;Tt--)Ge=1<<Tt-1,lt+=(Be&Ge?1:0)+(je&Ge?2:0);return lt}(this.z,this.x,this.y);return o[(this.x+this.y)%o.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(S==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,m>1?"@2x":"").replace(/{quadkey}/g,ve).replace(/{bbox-epsg-3857}/g,D)}isChildOf(o){const m=this.z-o.z;return m>0&&o.x===this.x>>m&&o.y===this.y>>m}getTilePoint(o){const m=Math.pow(2,this.z);return new ce((o.x*m-this.x)*pn,(o.y*m-this.y)*pn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ub{constructor(o,m){this.wrap=o,this.canonical=m,this.key=fm(o,m.z,m.z,m.x,m.y)}}class Cc{constructor(o,m,S,D,U){if(this.terrainRttPosMatrix32f=null,o<S)throw new Error(`overscaledZ should be >= z; overscaledZ = ${o}; z = ${S}`);this.overscaledZ=o,this.wrap=m,this.canonical=new Nv(S,+D,+U),this.key=fm(m,o,S,D,U)}clone(){return new Cc(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)}scaledTo(o){if(o>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${o}; overscaledZ = ${this.overscaledZ}`);const m=this.canonical.z-o;return o>this.canonical.z?new Cc(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Cc(o,this.wrap,o,this.canonical.x>>m,this.canonical.y>>m)}calculateScaledKey(o,m){if(o>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${o}; overscaledZ = ${this.overscaledZ}`);const S=this.canonical.z-o;return o>this.canonical.z?fm(this.wrap*+m,o,this.canonical.z,this.canonical.x,this.canonical.y):fm(this.wrap*+m,o,o,this.canonical.x>>S,this.canonical.y>>S)}isChildOf(o){if(o.wrap!==this.wrap)return!1;const m=this.canonical.z-o.canonical.z;return o.overscaledZ===0||o.overscaledZ<this.overscaledZ&&o.canonical.x===this.canonical.x>>m&&o.canonical.y===this.canonical.y>>m}children(o){if(this.overscaledZ>=o)return[new Cc(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const m=this.canonical.z+1,S=2*this.canonical.x,D=2*this.canonical.y;return[new Cc(m,this.wrap,m,S,D),new Cc(m,this.wrap,m,S+1,D),new Cc(m,this.wrap,m,S,D+1),new Cc(m,this.wrap,m,S+1,D+1)]}isLessThan(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))}wrapped(){return new Cc(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(o){return new Cc(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ub(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(o){return this.canonical.getTilePoint(new i_(o.x-this.wrap,o.y))}}function fm(g,o,m,S,D){(g*=2)<0&&(g=-1*g-1);const U=1<<m;return(U*U*g+U*D+S).toString(36)+m.toString(36)+o.toString(36)}Yi("CanonicalTileID",Nv),Yi("OverscaledTileID",Cc,{omit:["terrainRttPosMatrix32f"]});class _y{constructor(o,m,S,D=1,U=1,$=1,X=0){if(this.uid=o,m.height!==m.width)throw new RangeError("DEM tiles must be square");if(S&&!["mapbox","terrarium","custom"].includes(S))return void Zn(`"${S}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=m.height;const oe=this.dim=m.height-2;switch(this.data=new Uint32Array(m.data.buffer),S){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=D,this.greenFactor=U,this.blueFactor=$,this.baseShift=X;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let fe=0;fe<oe;fe++)this.data[this._idx(-1,fe)]=this.data[this._idx(0,fe)],this.data[this._idx(oe,fe)]=this.data[this._idx(oe-1,fe)],this.data[this._idx(fe,-1)]=this.data[this._idx(fe,0)],this.data[this._idx(fe,oe)]=this.data[this._idx(fe,oe-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(oe,-1)]=this.data[this._idx(oe-1,0)],this.data[this._idx(-1,oe)]=this.data[this._idx(0,oe-1)],this.data[this._idx(oe,oe)]=this.data[this._idx(oe-1,oe-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let fe=0;fe<oe;fe++)for(let ve=0;ve<oe;ve++){const Ce=this.get(fe,ve);Ce>this.max&&(this.max=Ce),Ce<this.min&&(this.min=Ce)}}get(o,m){const S=new Uint8Array(this.data.buffer),D=4*this._idx(o,m);return this.unpack(S[D],S[D+1],S[D+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(o,m){if(o<-1||o>=this.dim+1||m<-1||m>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(m+1)*this.stride+(o+1)}unpack(o,m,S){return o*this.redFactor+m*this.greenFactor+S*this.blueFactor-this.baseShift}getPixels(){return new vo({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(o,m,S){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");let D=m*this.dim,U=m*this.dim+this.dim,$=S*this.dim,X=S*this.dim+this.dim;switch(m){case-1:D=U-1;break;case 1:U=D+1}switch(S){case-1:$=X-1;break;case 1:X=$+1}const oe=-m*this.dim,fe=-S*this.dim;for(let ve=$;ve<X;ve++)for(let Ce=D;Ce<U;Ce++)this.data[this._idx(Ce,ve)]=o.data[this._idx(Ce+oe,ve+fe)]}}Yi("DEMData",_y);class jv{constructor(o){this._stringToNumber={},this._numberToString=[];for(let m=0;m<o.length;m++){const S=o[m];this._stringToNumber[S]=m,this._numberToString[m]=S}}encode(o){return this._stringToNumber[o]}decode(o){if(o>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${o} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[o]}}class yy{constructor(o,m,S,D,U){this.type="Feature",this._vectorTileFeature=o,o._z=m,o._x=S,o._y=D,this.properties=o.properties,this.id=U}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(o){this._geometry=o}toJSON(){const o={geometry:this.geometry};for(const m in this)m!=="_geometry"&&m!=="_vectorTileFeature"&&(o[m]=this[m]);return o}}class Uv{constructor(o,m){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new Nc(pn,16,0),this.grid3D=new Nc(pn,16,0),this.featureIndexArray=new Pt,this.promoteId=m}insert(o,m,S,D,U,$){const X=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(S,D,U);const oe=$?this.grid3D:this.grid;for(let fe=0;fe<m.length;fe++){const ve=m[fe],Ce=[1/0,1/0,-1/0,-1/0];for(let Be=0;Be<ve.length;Be++){const je=ve[Be];Ce[0]=Math.min(Ce[0],je.x),Ce[1]=Math.min(Ce[1],je.y),Ce[2]=Math.max(Ce[2],je.x),Ce[3]=Math.max(Ce[3],je.y)}Ce[0]<pn&&Ce[1]<pn&&Ce[2]>=0&&Ce[3]>=0&&oe.insert(X,Ce[0],Ce[1],Ce[2],Ce[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Vn.VectorTile(new Su(this.rawTileData)).layers,this.sourceLayerCoder=new jv(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(o,m,S,D){this.loadVTLayers();const U=o.params,$=pn/o.tileSize/o.scale,X=dd(U.filter),oe=o.queryGeometry,fe=o.queryPadding*$,ve=r_(oe),Ce=this.grid.query(ve.minX-fe,ve.minY-fe,ve.maxX+fe,ve.maxY+fe),Be=r_(o.cameraQueryGeometry),je=this.grid3D.query(Be.minX-fe,Be.minY-fe,Be.maxX+fe,Be.maxY+fe,(Tt,Ot,ln,Zt)=>function(Ne,xt,Yt,Dn,bi){for(const Kn of Ne)if(xt<=Kn.x&&Yt<=Kn.y&&Dn>=Kn.x&&bi>=Kn.y)return!0;const Un=[new ce(xt,Yt),new ce(xt,bi),new ce(Dn,bi),new ce(Dn,Yt)];if(Ne.length>2){for(const Kn of Un)if(ic(Ne,Kn))return!0}for(let Kn=0;Kn<Ne.length-1;Kn++)if(yp(Ne[Kn],Ne[Kn+1],Un))return!0;return!1}(o.cameraQueryGeometry,Tt-fe,Ot-fe,ln+fe,Zt+fe));for(const Tt of je)Ce.push(Tt);Ce.sort($b);const Ge={};let lt;for(let Tt=0;Tt<Ce.length;Tt++){const Ot=Ce[Tt];if(Ot===lt)continue;lt=Ot;const ln=this.featureIndexArray.get(Ot);let Zt=null;this.loadMatchingFeature(Ge,ln.bucketIndex,ln.sourceLayerIndex,ln.featureIndex,X,U.layers,U.availableImages,m,S,D,(Ne,xt,Yt)=>(Zt||(Zt=wc(Ne)),xt.queryIntersectsFeature({queryGeometry:oe,feature:Ne,featureState:Yt,geometry:Zt,zoom:this.z,transform:o.transform,pixelsToTileUnits:$,pixelPosMatrix:o.pixelPosMatrix})))}return Ge}loadMatchingFeature(o,m,S,D,U,$,X,oe,fe,ve,Ce){const Be=this.bucketLayerIDs[m];if($&&!Be.some(Tt=>$.has(Tt)))return;const je=this.sourceLayerCoder.decode(S),Ge=this.vtLayers[je].feature(D);if(U.needGeometry){const Tt=sh(Ge,!0);if(!U.filter(new ls(this.tileID.overscaledZ),Tt,this.tileID.canonical))return}else if(!U.filter(new ls(this.tileID.overscaledZ),Ge))return;const lt=this.getId(Ge,je);for(let Tt=0;Tt<Be.length;Tt++){const Ot=Be[Tt];if($&&!$.has(Ot))continue;const ln=oe[Ot];if(!ln)continue;let Zt={};lt&&ve&&(Zt=ve.getState(ln.sourceLayer||"_geojsonTileLayer",lt));const Ne=Fi({},fe[Ot]);Ne.paint=$v(Ne.paint,ln.paint,Ge,Zt,X),Ne.layout=$v(Ne.layout,ln.layout,Ge,Zt,X);const xt=!Ce||Ce(Ge,ln,Zt);if(!xt)continue;const Yt=new yy(Ge,this.z,this.x,this.y,lt);Yt.layer=Ne;let Dn=o[Ot];Dn===void 0&&(Dn=o[Ot]=[]),Dn.push({featureIndex:D,feature:Yt,intersectionZ:xt})}}lookupSymbolFeatures(o,m,S,D,U,$,X,oe){const fe={};this.loadVTLayers();const ve=dd(U);for(const Ce of o)this.loadMatchingFeature(fe,S,D,Ce,ve,$,X,oe,m);return fe}hasLayer(o){for(const m of this.bucketLayerIDs)for(const S of m)if(o===S)return!0;return!1}getId(o,m){var S;let D=o.id;return this.promoteId&&(D=o.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[m]],typeof D=="boolean"&&(D=Number(D)),D===void 0&&(!((S=o.properties)===null||S===void 0)&&S.cluster)&&this.promoteId&&(D=Number(o.properties.cluster_id))),D}}function $v(g,o,m,S,D){return sn(g,(U,$)=>{const X=o instanceof Qu?o.get($):null;return X&&X.evaluate?X.evaluate(m,S,D):X})}function r_(g){let o=1/0,m=1/0,S=-1/0,D=-1/0;for(const U of g)o=Math.min(o,U.x),m=Math.min(m,U.y),S=Math.max(S,U.x),D=Math.max(D,U.y);return{minX:o,minY:m,maxX:S,maxY:D}}function $b(g,o){return o-g}function Gv(g,o,m,S,D){const U=[];for(let $=0;$<g.length;$++){const X=g[$];let oe;for(let fe=0;fe<X.length-1;fe++){let ve=X[fe],Ce=X[fe+1];ve.x<o&&Ce.x<o||(ve.x<o?ve=new ce(o,ve.y+(o-ve.x)/(Ce.x-ve.x)*(Ce.y-ve.y))._round():Ce.x<o&&(Ce=new ce(o,ve.y+(o-ve.x)/(Ce.x-ve.x)*(Ce.y-ve.y))._round()),ve.y<m&&Ce.y<m||(ve.y<m?ve=new ce(ve.x+(m-ve.y)/(Ce.y-ve.y)*(Ce.x-ve.x),m)._round():Ce.y<m&&(Ce=new ce(ve.x+(m-ve.y)/(Ce.y-ve.y)*(Ce.x-ve.x),m)._round()),ve.x>=S&&Ce.x>=S||(ve.x>=S?ve=new ce(S,ve.y+(S-ve.x)/(Ce.x-ve.x)*(Ce.y-ve.y))._round():Ce.x>=S&&(Ce=new ce(S,ve.y+(S-ve.x)/(Ce.x-ve.x)*(Ce.y-ve.y))._round()),ve.y>=D&&Ce.y>=D||(ve.y>=D?ve=new ce(ve.x+(D-ve.y)/(Ce.y-ve.y)*(Ce.x-ve.x),D)._round():Ce.y>=D&&(Ce=new ce(ve.x+(D-ve.y)/(Ce.y-ve.y)*(Ce.x-ve.x),D)._round()),oe&&ve.equals(oe[oe.length-1])||(oe=[ve],U.push(oe)),oe.push(Ce)))))}}return U}Yi("FeatureIndex",Uv,{omit:["rawTileData","sourceLayerCoder"]});class Ef extends ce{constructor(o,m,S,D){super(o,m),this.angle=S,D!==void 0&&(this.segment=D)}clone(){return new Ef(this.x,this.y,this.angle,this.segment)}}function pm(g,o,m,S,D){if(o.segment===void 0||m===0)return!0;let U=o,$=o.segment+1,X=0;for(;X>-m/2;){if($--,$<0)return!1;X-=g[$].dist(U),U=g[$]}X+=g[$].dist(g[$+1]),$++;const oe=[];let fe=0;for(;X<m/2;){const ve=g[$],Ce=g[$+1];if(!Ce)return!1;let Be=g[$-1].angleTo(ve)-ve.angleTo(Ce);for(Be=Math.abs((Be+3*Math.PI)%(2*Math.PI)-Math.PI),oe.push({distance:X,angleDelta:Be}),fe+=Be;X-oe[0].distance>S;)fe-=oe.shift().angleDelta;if(fe>D)return!1;$++,X+=ve.dist(Ce)}return!0}function Ip(g){let o=0;for(let m=0;m<g.length-1;m++)o+=g[m].dist(g[m+1]);return o}function qv(g,o,m){return g?.6*o*m:0}function a_(g,o){return Math.max(g?g.right-g.left:0,o?o.right-o.left:0)}function Gb(g,o,m,S,D,U){const $=qv(m,D,U),X=a_(m,S)*U;let oe=0;const fe=Ip(g)/2;for(let ve=0;ve<g.length-1;ve++){const Ce=g[ve],Be=g[ve+1],je=Ce.dist(Be);if(oe+je>fe){const Ge=(fe-oe)/je,lt=Oa.number(Ce.x,Be.x,Ge),Tt=Oa.number(Ce.y,Be.y,Ge),Ot=new Ef(lt,Tt,Be.angleTo(Ce),ve);return Ot._round(),!$||pm(g,Ot,X,$,o)?Ot:void 0}oe+=je}}function qb(g,o,m,S,D,U,$,X,oe){const fe=qv(S,U,$),ve=a_(S,D),Ce=ve*$,Be=g[0].x===0||g[0].x===oe||g[0].y===0||g[0].y===oe;return o-Ce<o/4&&(o=Ce+o/4),s_(g,Be?o/2*X%o:(ve/2+2*U)*$*X%o,o,fe,m,Ce,Be,!1,oe)}function s_(g,o,m,S,D,U,$,X,oe){const fe=U/2,ve=Ip(g);let Ce=0,Be=o-m,je=[];for(let Ge=0;Ge<g.length-1;Ge++){const lt=g[Ge],Tt=g[Ge+1],Ot=lt.dist(Tt),ln=Tt.angleTo(lt);for(;Be+m<Ce+Ot;){Be+=m;const Zt=(Be-Ce)/Ot,Ne=Oa.number(lt.x,Tt.x,Zt),xt=Oa.number(lt.y,Tt.y,Zt);if(Ne>=0&&Ne<oe&&xt>=0&&xt<oe&&Be-fe>=0&&Be+fe<=ve){const Yt=new Ef(Ne,xt,ln,Ge);Yt._round(),S&&!pm(g,Yt,U,S,D)||je.push(Yt)}}Ce+=Ot}return X||je.length||$||(je=s_(g,Ce/2,m,S,D,U,$,!0,oe)),je}Yi("Anchor",Ef);const tg=Bo;function o_(g,o,m,S){const D=[],U=g.image,$=U.pixelRatio,X=U.paddedRect.w-2*tg,oe=U.paddedRect.h-2*tg;let fe={x1:g.left,y1:g.top,x2:g.right,y2:g.bottom};const ve=U.stretchX||[[0,X]],Ce=U.stretchY||[[0,oe]],Be=(ni,ar)=>ni+ar[1]-ar[0],je=ve.reduce(Be,0),Ge=Ce.reduce(Be,0),lt=X-je,Tt=oe-Ge;let Ot=0,ln=je,Zt=0,Ne=Ge,xt=0,Yt=lt,Dn=0,bi=Tt;if(U.content&&S){const ni=U.content,ar=ni[2]-ni[0],Cr=ni[3]-ni[1];(U.textFitWidth||U.textFitHeight)&&(fe=zb(g)),Ot=l_(ve,0,ni[0]),Zt=l_(Ce,0,ni[1]),ln=l_(ve,ni[0],ni[2]),Ne=l_(Ce,ni[1],ni[3]),xt=ni[0]-Ot,Dn=ni[1]-Zt,Yt=ar-ln,bi=Cr-Ne}const Un=fe.x1,Kn=fe.y1,Di=fe.x2-Un,Si=fe.y2-Kn,Li=(ni,ar,Cr,gr)=>{const hr=ng(ni.stretch-Ot,ln,Di,Un),pa=c_(ni.fixed-xt,Yt,ni.stretch,je),vs=ng(ar.stretch-Zt,Ne,Si,Kn),To=c_(ar.fixed-Dn,bi,ar.stretch,Ge),xl=ng(Cr.stretch-Ot,ln,Di,Un),Cu=c_(Cr.fixed-xt,Yt,Cr.stretch,je),Ec=ng(gr.stretch-Zt,Ne,Si,Kn),ol=c_(gr.fixed-Dn,bi,gr.stretch,Ge),zs=new ce(hr,vs),Xo=new ce(xl,vs),ll=new ce(xl,Ec),Yo=new ce(hr,Ec),sc=new ce(pa/$,To/$),rs=new ce(Cu/$,ol/$),hs=o*Math.PI/180;if(hs){const lo=Math.sin(hs),js=Math.cos(hs),Co=[js,-lo,lo,js];zs._matMult(Co),Xo._matMult(Co),Yo._matMult(Co),ll._matMult(Co)}const bl=ni.stretch+ni.fixed,oo=ar.stretch+ar.fixed;return{tl:zs,tr:Xo,bl:Yo,br:ll,tex:{x:U.paddedRect.x+tg+bl,y:U.paddedRect.y+tg+oo,w:Cr.stretch+Cr.fixed-bl,h:gr.stretch+gr.fixed-oo},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:sc,pixelOffsetBR:rs,minFontScaleX:Yt/$/Di,minFontScaleY:bi/$/Si,isSDF:m}};if(S&&(U.stretchX||U.stretchY)){const ni=vy(ve,lt,je),ar=vy(Ce,Tt,Ge);for(let Cr=0;Cr<ni.length-1;Cr++){const gr=ni[Cr],hr=ni[Cr+1];for(let pa=0;pa<ar.length-1;pa++)D.push(Li(gr,ar[pa],hr,ar[pa+1]))}}else D.push(Li({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:X+1},{fixed:0,stretch:oe+1}));return D}function l_(g,o,m){let S=0;for(const D of g)S+=Math.max(o,Math.min(m,D[1]))-Math.max(o,Math.min(m,D[0]));return S}function vy(g,o,m){const S=[{fixed:-1,stretch:0}];for(const[D,U]of g){const $=S[S.length-1];S.push({fixed:D-$.stretch,stretch:$.stretch}),S.push({fixed:D-$.stretch,stretch:$.stretch+(U-D)})}return S.push({fixed:o+tg,stretch:m}),S}function ng(g,o,m,S){return g/o*m+S}function c_(g,o,m,S){return g-o*m/S}class xy{constructor(o,m,S,D,U,$,X,oe,fe,ve){var Ce;if(this.boxStartIndex=o.length,fe){let Be=$.top,je=$.bottom;const Ge=$.collisionPadding;Ge&&(Be-=Ge[1],je+=Ge[3]);let lt=je-Be;lt>0&&(lt=Math.max(10,lt),this.circleDiameter=lt)}else{const Be=!((Ce=$.image)===null||Ce===void 0)&&Ce.content&&($.image.textFitWidth||$.image.textFitHeight)?zb($):{x1:$.left,y1:$.top,x2:$.right,y2:$.bottom};Be.y1=Be.y1*X-oe[0],Be.y2=Be.y2*X+oe[2],Be.x1=Be.x1*X-oe[3],Be.x2=Be.x2*X+oe[1];const je=$.collisionPadding;if(je&&(Be.x1-=je[0]*X,Be.y1-=je[1]*X,Be.x2+=je[2]*X,Be.y2+=je[3]*X),ve){const Ge=new ce(Be.x1,Be.y1),lt=new ce(Be.x2,Be.y1),Tt=new ce(Be.x1,Be.y2),Ot=new ce(Be.x2,Be.y2),ln=ve*Math.PI/180;Ge._rotate(ln),lt._rotate(ln),Tt._rotate(ln),Ot._rotate(ln),Be.x1=Math.min(Ge.x,lt.x,Tt.x,Ot.x),Be.x2=Math.max(Ge.x,lt.x,Tt.x,Ot.x),Be.y1=Math.min(Ge.y,lt.y,Tt.y,Ot.y),Be.y2=Math.max(Ge.y,lt.y,Tt.y,Ot.y)}o.emplaceBack(m.x,m.y,Be.x1,Be.y1,Be.x2,Be.y2,S,D,U)}this.boxEndIndex=o.length}}class Hb{constructor(o=[],m=(S,D)=>S<D?-1:S>D?1:0){if(this.data=o,this.length=this.data.length,this.compare=m,this.length>0)for(let S=(this.length>>1)-1;S>=0;S--)this._down(S)}push(o){this.data.push(o),this._up(this.length++)}pop(){if(this.length===0)return;const o=this.data[0],m=this.data.pop();return--this.length>0&&(this.data[0]=m,this._down(0)),o}peek(){return this.data[0]}_up(o){const{data:m,compare:S}=this,D=m[o];for(;o>0;){const U=o-1>>1,$=m[U];if(S(D,$)>=0)break;m[o]=$,o=U}m[o]=D}_down(o){const{data:m,compare:S}=this,D=this.length>>1,U=m[o];for(;o<D;){let $=1+(o<<1);const X=$+1;if(X<this.length&&S(m[X],m[$])<0&&($=X),S(m[$],U)>=0)break;m[o]=m[$],o=$}m[o]=U}}function Zb(g,o=1,m=!1){let S=1/0,D=1/0,U=-1/0,$=-1/0;const X=g[0];for(let je=0;je<X.length;je++){const Ge=X[je];(!je||Ge.x<S)&&(S=Ge.x),(!je||Ge.y<D)&&(D=Ge.y),(!je||Ge.x>U)&&(U=Ge.x),(!je||Ge.y>$)&&($=Ge.y)}const oe=Math.min(U-S,$-D);let fe=oe/2;const ve=new Hb([],Wb);if(oe===0)return new ce(S,D);for(let je=S;je<U;je+=oe)for(let Ge=D;Ge<$;Ge+=oe)ve.push(new mm(je+fe,Ge+fe,fe,g));let Ce=function(je){let Ge=0,lt=0,Tt=0;const Ot=je[0];for(let ln=0,Zt=Ot.length,Ne=Zt-1;ln<Zt;Ne=ln++){const xt=Ot[ln],Yt=Ot[Ne],Dn=xt.x*Yt.y-Yt.x*xt.y;lt+=(xt.x+Yt.x)*Dn,Tt+=(xt.y+Yt.y)*Dn,Ge+=3*Dn}return new mm(lt/Ge,Tt/Ge,0,je)}(g),Be=ve.length;for(;ve.length;){const je=ve.pop();(je.d>Ce.d||!Ce.d)&&(Ce=je,m&&console.log("found best %d after %d probes",Math.round(1e4*je.d)/1e4,Be)),je.max-Ce.d<=o||(fe=je.h/2,ve.push(new mm(je.p.x-fe,je.p.y-fe,fe,g)),ve.push(new mm(je.p.x+fe,je.p.y-fe,fe,g)),ve.push(new mm(je.p.x-fe,je.p.y+fe,fe,g)),ve.push(new mm(je.p.x+fe,je.p.y+fe,fe,g)),Be+=4)}return m&&(console.log(`num probes: ${Be}`),console.log(`best distance: ${Ce.d}`)),Ce.p}function Wb(g,o){return o.max-g.max}function mm(g,o,m,S){this.p=new ce(g,o),this.h=m,this.d=function(D,U){let $=!1,X=1/0;for(let oe=0;oe<U.length;oe++){const fe=U[oe];for(let ve=0,Ce=fe.length,Be=Ce-1;ve<Ce;Be=ve++){const je=fe[ve],Ge=fe[Be];je.y>D.y!=Ge.y>D.y&&D.x<(Ge.x-je.x)*(D.y-je.y)/(Ge.y-je.y)+je.x&&($=!$),X=Math.min(X,sm(D,je,Ge))}}return($?1:-1)*Math.sqrt(X)}(this.p,S),this.max=this.d+this.h*Math.SQRT2}var Wo;T.av=void 0,(Wo=T.av||(T.av={}))[Wo.center=1]="center",Wo[Wo.left=2]="left",Wo[Wo.right=3]="right",Wo[Wo.top=4]="top",Wo[Wo.bottom=5]="bottom",Wo[Wo["top-left"]=6]="top-left",Wo[Wo["top-right"]=7]="top-right",Wo[Wo["bottom-left"]=8]="bottom-left",Wo[Wo["bottom-right"]=9]="bottom-right";const Mf=7,u_=Number.POSITIVE_INFINITY;function Xb(g,o){return o[1]!==u_?function(m,S,D){let U=0,$=0;switch(S=Math.abs(S),D=Math.abs(D),m){case"top-right":case"top-left":case"top":$=D-Mf;break;case"bottom-right":case"bottom-left":case"bottom":$=-D+Mf}switch(m){case"top-right":case"bottom-right":case"right":U=-S;break;case"top-left":case"bottom-left":case"left":U=S}return[U,$]}(g,o[0],o[1]):function(m,S){let D=0,U=0;S<0&&(S=0);const $=S/Math.SQRT2;switch(m){case"top-right":case"top-left":U=$-Mf;break;case"bottom-right":case"bottom-left":U=-$+Mf;break;case"bottom":U=-S+Mf;break;case"top":U=S-Mf}switch(m){case"top-right":case"bottom-right":D=-$;break;case"top-left":case"bottom-left":D=$;break;case"left":D=S;break;case"right":D=-S}return[D,U]}(g,o[0])}function Yb(g,o,m){var S;const D=g.layout,U=(S=D.get("text-variable-anchor-offset"))===null||S===void 0?void 0:S.evaluate(o,{},m);if(U){const X=U.values,oe=[];for(let fe=0;fe<X.length;fe+=2){const ve=oe[fe]=X[fe],Ce=X[fe+1].map(Be=>Be*Lr);ve.startsWith("top")?Ce[1]-=Mf:ve.startsWith("bottom")&&(Ce[1]+=Mf),oe[fe+1]=Ce}return new Vs(oe)}const $=D.get("text-variable-anchor");if($){let X;X=g._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[D.get("text-radial-offset").evaluate(o,{},m)*Lr,u_]:D.get("text-offset").evaluate(o,{},m).map(fe=>fe*Lr);const oe=[];for(const fe of $)oe.push(fe,Xb(fe,X));return new Vs(oe)}return null}function Hv(g){switch(g){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Bw(g,o,m,S,D,U,$,X,oe,fe,ve,Ce){let Be=U.textMaxSize.evaluate(o,{});Be===void 0&&(Be=$);const je=g.layers[0].layout,Ge=je.get("icon-offset").evaluate(o,{},ve),lt=If(m.horizontal),Tt=$/24,Ot=g.tilePixelRatio*Tt,ln=g.tilePixelRatio*Be/24,Zt=g.tilePixelRatio*X,Ne=g.tilePixelRatio*je.get("symbol-spacing"),xt=je.get("text-padding")*g.tilePixelRatio,Yt=function(Cr,gr,hr,pa=1){const vs=Cr.get("icon-padding").evaluate(gr,{},hr),To=vs&&vs.values;return[To[0]*pa,To[1]*pa,To[2]*pa,To[3]*pa]}(je,o,ve,g.tilePixelRatio),Dn=je.get("text-max-angle")/180*Math.PI,bi=je.get("text-rotation-alignment")!=="viewport"&&je.get("symbol-placement")!=="point",Un=je.get("icon-rotation-alignment")==="map"&&je.get("symbol-placement")!=="point",Kn=je.get("symbol-placement"),Di=Ne/2,Si=je.get("icon-text-fit");let Li;S&&Si!=="none"&&(g.allowVerticalPlacement&&m.vertical&&(Li=Ob(S,m.vertical,Si,je.get("icon-text-fit-padding"),Ge,Tt)),lt&&(S=Ob(S,lt,Si,je.get("icon-text-fit-padding"),Ge,Tt)));const ni=ve?Ce.line.getGranularityForZoomLevel(ve.z):1,ar=(Cr,gr)=>{gr.x<0||gr.x>=pn||gr.y<0||gr.y>=pn||function(hr,pa,vs,To,xl,Cu,Ec,ol,zs,Xo,ll,Yo,sc,rs,hs,bl,oo,lo,js,Co,Ts,Mc,lg,Fh,Jb){const Pp=hr.addToLineVertexArray(pa,vs);let Ap,kp,cg,_m,d_=0,Ty=0,Qb=0,e0=0,Jv=-1,Qv=-1;const Vo={};let ug=Is("");if(hr.allowVerticalPlacement&&To.vertical){const wl=ol.layout.get("text-rotate").evaluate(Ts,{},Fh)+90;cg=new xy(zs,pa,Xo,ll,Yo,To.vertical,sc,rs,hs,wl),Ec&&(_m=new xy(zs,pa,Xo,ll,Yo,Ec,oo,lo,hs,wl))}if(xl){const wl=ol.layout.get("icon-rotate").evaluate(Ts,{}),Zc=ol.layout.get("icon-text-fit")!=="none",Dp=o_(xl,wl,lg,Zc),Bh=Ec?o_(Ec,wl,lg,Zc):void 0;kp=new xy(zs,pa,Xo,ll,Yo,xl,oo,lo,!1,wl),d_=4*Dp.length;const vm=hr.iconSizeData;let Vh=null;vm.kind==="source"?(Vh=[Dd*ol.layout.get("icon-size").evaluate(Ts,{})],Vh[0]>Ep&&Zn(`${hr.layerIds[0]}: Value for "icon-size" is >= ${t_}. Reduce your "icon-size".`)):vm.kind==="composite"&&(Vh=[Dd*Mc.compositeIconSizes[0].evaluate(Ts,{},Fh),Dd*Mc.compositeIconSizes[1].evaluate(Ts,{},Fh)],(Vh[0]>Ep||Vh[1]>Ep)&&Zn(`${hr.layerIds[0]}: Value for "icon-size" is >= ${t_}. Reduce your "icon-size".`)),hr.addSymbols(hr.icon,Dp,Vh,Co,js,Ts,T.ai.none,pa,Pp.lineStartIndex,Pp.lineLength,-1,Fh),Jv=hr.icon.placedSymbolArray.length-1,Bh&&(Ty=4*Bh.length,hr.addSymbols(hr.icon,Bh,Vh,Co,js,Ts,T.ai.vertical,pa,Pp.lineStartIndex,Pp.lineLength,-1,Fh),Qv=hr.icon.placedSymbolArray.length-1)}const ym=Object.keys(To.horizontal);for(const wl of ym){const Zc=To.horizontal[wl];if(!Ap){ug=Is(Zc.text);const Bh=ol.layout.get("text-rotate").evaluate(Ts,{},Fh);Ap=new xy(zs,pa,Xo,ll,Yo,Zc,sc,rs,hs,Bh)}const Dp=Zc.positionedLines.length===1;if(Qb+=Zv(hr,pa,Zc,Cu,ol,hs,Ts,bl,Pp,To.vertical?T.ai.horizontal:T.ai.horizontalOnly,Dp?ym:[wl],Vo,Jv,Mc,Fh),Dp)break}To.vertical&&(e0+=Zv(hr,pa,To.vertical,Cu,ol,hs,Ts,bl,Pp,T.ai.vertical,["vertical"],Vo,Qv,Mc,Fh));const ex=Ap?Ap.boxStartIndex:hr.collisionBoxArray.length,Cy=Ap?Ap.boxEndIndex:hr.collisionBoxArray.length,Vw=cg?cg.boxStartIndex:hr.collisionBoxArray.length,t0=cg?cg.boxEndIndex:hr.collisionBoxArray.length,n0=kp?kp.boxStartIndex:hr.collisionBoxArray.length,Nw=kp?kp.boxEndIndex:hr.collisionBoxArray.length,i0=_m?_m.boxStartIndex:hr.collisionBoxArray.length,r0=_m?_m.boxEndIndex:hr.collisionBoxArray.length;let Eu=-1;const f_=(wl,Zc)=>wl&&wl.circleDiameter?Math.max(wl.circleDiameter,Zc):Zc;Eu=f_(Ap,Eu),Eu=f_(cg,Eu),Eu=f_(kp,Eu),Eu=f_(_m,Eu);const a0=Eu>-1?1:0;a0&&(Eu*=Jb/Lr),hr.glyphOffsetArray.length>=Tf.MAX_GLYPHS&&Zn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ts.sortKey!==void 0&&hr.addToSortKeyRanges(hr.symbolInstances.length,Ts.sortKey);const s0=Yb(ol,Ts,Fh),[Pf,o0]=function(wl,Zc){const Dp=wl.length,Bh=Zc==null?void 0:Zc.values;if((Bh==null?void 0:Bh.length)>0)for(let vm=0;vm<Bh.length;vm+=2){const Vh=Bh[vm+1];wl.emplaceBack(T.av[Bh[vm]],Vh[0],Vh[1])}return[Dp,wl.length]}(hr.textAnchorOffsets,s0);hr.symbolInstances.emplaceBack(pa.x,pa.y,Vo.right>=0?Vo.right:-1,Vo.center>=0?Vo.center:-1,Vo.left>=0?Vo.left:-1,Vo.vertical||-1,Jv,Qv,ug,ex,Cy,Vw,t0,n0,Nw,i0,r0,Xo,Qb,e0,d_,Ty,a0,0,sc,Eu,Pf,o0)}(g,gr,Cr,m,S,D,Li,g.layers[0],g.collisionBoxArray,o.index,o.sourceLayerIndex,g.index,Ot,[xt,xt,xt,xt],bi,oe,Zt,Yt,Un,Ge,o,U,fe,ve,$)};if(Kn==="line")for(const Cr of Gv(o.geometry,0,0,pn,pn)){const gr=K(Cr,ni),hr=qb(gr,Ne,Dn,m.vertical||lt,S,24,ln,g.overscaling,pn);for(const pa of hr)lt&&h_(g,lt.text,Di,pa)||ar(gr,pa)}else if(Kn==="line-center"){for(const Cr of o.geometry)if(Cr.length>1){const gr=K(Cr,ni),hr=Gb(gr,Dn,m.vertical||lt,S,24,ln);hr&&ar(gr,hr)}}else if(o.type==="Polygon")for(const Cr of vh(o.geometry,0)){const gr=Zb(Cr,16);ar(K(Cr[0],ni,!0),new Ef(gr.x,gr.y,0))}else if(o.type==="LineString")for(const Cr of o.geometry){const gr=K(Cr,ni);ar(gr,new Ef(gr[0].x,gr[0].y,0))}else if(o.type==="Point")for(const Cr of o.geometry)for(const gr of Cr)ar([gr],new Ef(gr.x,gr.y,0))}function Zv(g,o,m,S,D,U,$,X,oe,fe,ve,Ce,Be,je,Ge){const lt=function(ln,Zt,Ne,xt,Yt,Dn,bi,Un){const Kn=xt.layout.get("text-rotate").evaluate(Dn,{})*Math.PI/180,Di=[];for(const Si of Zt.positionedLines)for(const Li of Si.positionedGlyphs){if(!Li.rect)continue;const ni=Li.rect||{};let ar=uh+1,Cr=!0,gr=1,hr=0;const pa=(Yt||Un)&&Li.vertical,vs=Li.metrics.advance*Li.scale/2;if(Un&&Zt.verticalizable&&(hr=Si.lineOffset/2-(Li.imageName?-(Lr-Li.metrics.width*Li.scale)/2:(Li.scale-1)*Lr)),Li.imageName){const lo=bi[Li.imageName];Cr=lo.sdf,gr=lo.pixelRatio,ar=Bo/gr}const To=Yt?[Li.x+vs,Li.y]:[0,0];let xl=Yt?[0,0]:[Li.x+vs+Ne[0],Li.y+Ne[1]-hr],Cu=[0,0];pa&&(Cu=xl,xl=[0,0]);const Ec=Li.metrics.isDoubleResolution?2:1,ol=(Li.metrics.left-ar)*Li.scale-vs+xl[0],zs=(-Li.metrics.top-ar)*Li.scale+xl[1],Xo=ol+ni.w/Ec*Li.scale/gr,ll=zs+ni.h/Ec*Li.scale/gr,Yo=new ce(ol,zs),sc=new ce(Xo,zs),rs=new ce(ol,ll),hs=new ce(Xo,ll);if(pa){const lo=new ce(-vs,vs-Wg),js=-Math.PI/2,Co=Lr/2-vs,Ts=new ce(5-Wg-Co,-(Li.imageName?Co:0)),Mc=new ce(...Cu);Yo._rotateAround(js,lo)._add(Ts)._add(Mc),sc._rotateAround(js,lo)._add(Ts)._add(Mc),rs._rotateAround(js,lo)._add(Ts)._add(Mc),hs._rotateAround(js,lo)._add(Ts)._add(Mc)}if(Kn){const lo=Math.sin(Kn),js=Math.cos(Kn),Co=[js,-lo,lo,js];Yo._matMult(Co),sc._matMult(Co),rs._matMult(Co),hs._matMult(Co)}const bl=new ce(0,0),oo=new ce(0,0);Di.push({tl:Yo,tr:sc,bl:rs,br:hs,tex:ni,writingMode:Zt.writingMode,glyphOffset:To,sectionIndex:Li.sectionIndex,isSDF:Cr,pixelOffsetTL:bl,pixelOffsetBR:oo,minFontScaleX:0,minFontScaleY:0})}return Di}(0,m,X,D,U,$,S,g.allowVerticalPlacement),Tt=g.textSizeData;let Ot=null;Tt.kind==="source"?(Ot=[Dd*D.layout.get("text-size").evaluate($,{})],Ot[0]>Ep&&Zn(`${g.layerIds[0]}: Value for "text-size" is >= ${t_}. Reduce your "text-size".`)):Tt.kind==="composite"&&(Ot=[Dd*je.compositeTextSizes[0].evaluate($,{},Ge),Dd*je.compositeTextSizes[1].evaluate($,{},Ge)],(Ot[0]>Ep||Ot[1]>Ep)&&Zn(`${g.layerIds[0]}: Value for "text-size" is >= ${t_}. Reduce your "text-size".`)),g.addSymbols(g.text,lt,Ot,X,U,$,fe,o,oe.lineStartIndex,oe.lineLength,Be,Ge);for(const ln of ve)Ce[ln]=g.text.placedSymbolArray.length-1;return 4*lt.length}function If(g){for(const o in g)return g[o];return null}function h_(g,o,m,S){const D=g.compareText;if(o in D){const U=D[o];for(let $=U.length-1;$>=0;$--)if(S.dist(U[$])<m)return!0}else D[o]=[];return D[o].push(S),!1}const ig=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class rg{static from(o){if(!(o instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[m,S]=new Uint8Array(o,0,2);if(m!==219)throw new Error("Data does not appear to be in a KDBush format.");const D=S>>4;if(D!==1)throw new Error(`Got v${D} data when expected v1.`);const U=ig[15&S];if(!U)throw new Error("Unrecognized array type.");const[$]=new Uint16Array(o,2,1),[X]=new Uint32Array(o,4,1);return new rg(X,$,U,o)}constructor(o,m=64,S=Float64Array,D){if(isNaN(o)||o<0)throw new Error(`Unpexpected numItems value: ${o}.`);this.numItems=+o,this.nodeSize=Math.min(Math.max(+m,2),65535),this.ArrayType=S,this.IndexArrayType=o<65536?Uint16Array:Uint32Array;const U=ig.indexOf(this.ArrayType),$=2*o*this.ArrayType.BYTES_PER_ELEMENT,X=o*this.IndexArrayType.BYTES_PER_ELEMENT,oe=(8-X%8)%8;if(U<0)throw new Error(`Unexpected typed array class: ${S}.`);D&&D instanceof ArrayBuffer?(this.data=D,this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+X+oe,2*o),this._pos=2*o,this._finished=!0):(this.data=new ArrayBuffer(8+$+X+oe),this.ids=new this.IndexArrayType(this.data,8,o),this.coords=new this.ArrayType(this.data,8+X+oe,2*o),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+U]),new Uint16Array(this.data,2,1)[0]=m,new Uint32Array(this.data,4,1)[0]=o)}add(o,m){const S=this._pos>>1;return this.ids[S]=S,this.coords[this._pos++]=o,this.coords[this._pos++]=m,S}finish(){const o=this._pos>>1;if(o!==this.numItems)throw new Error(`Added ${o} items when expected ${this.numItems}.`);return gm(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(o,m,S,D){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:U,coords:$,nodeSize:X}=this,oe=[0,U.length-1,0],fe=[];for(;oe.length;){const ve=oe.pop()||0,Ce=oe.pop()||0,Be=oe.pop()||0;if(Ce-Be<=X){for(let Tt=Be;Tt<=Ce;Tt++){const Ot=$[2*Tt],ln=$[2*Tt+1];Ot>=o&&Ot<=S&&ln>=m&&ln<=D&&fe.push(U[Tt])}continue}const je=Be+Ce>>1,Ge=$[2*je],lt=$[2*je+1];Ge>=o&&Ge<=S&&lt>=m&&lt<=D&&fe.push(U[je]),(ve===0?o<=Ge:m<=lt)&&(oe.push(Be),oe.push(je-1),oe.push(1-ve)),(ve===0?S>=Ge:D>=lt)&&(oe.push(je+1),oe.push(Ce),oe.push(1-ve))}return fe}within(o,m,S){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:D,coords:U,nodeSize:$}=this,X=[0,D.length-1,0],oe=[],fe=S*S;for(;X.length;){const ve=X.pop()||0,Ce=X.pop()||0,Be=X.pop()||0;if(Ce-Be<=$){for(let Tt=Be;Tt<=Ce;Tt++)Xv(U[2*Tt],U[2*Tt+1],o,m)<=fe&&oe.push(D[Tt]);continue}const je=Be+Ce>>1,Ge=U[2*je],lt=U[2*je+1];Xv(Ge,lt,o,m)<=fe&&oe.push(D[je]),(ve===0?o-S<=Ge:m-S<=lt)&&(X.push(Be),X.push(je-1),X.push(1-ve)),(ve===0?o+S>=Ge:m+S>=lt)&&(X.push(je+1),X.push(Ce),X.push(1-ve))}return oe}}function gm(g,o,m,S,D,U){if(D-S<=m)return;const $=S+D>>1;Wv(g,o,$,S,D,U),gm(g,o,m,S,$-1,1-U),gm(g,o,m,$+1,D,1-U)}function Wv(g,o,m,S,D,U){for(;D>S;){if(D-S>600){const fe=D-S+1,ve=m-S+1,Ce=Math.log(fe),Be=.5*Math.exp(2*Ce/3),je=.5*Math.sqrt(Ce*Be*(fe-Be)/fe)*(ve-fe/2<0?-1:1);Wv(g,o,m,Math.max(S,Math.floor(m-ve*Be/fe+je)),Math.min(D,Math.floor(m+(fe-ve)*Be/fe+je)),U)}const $=o[2*m+U];let X=S,oe=D;for(ag(g,o,S,m),o[2*D+U]>$&&ag(g,o,S,D);X<oe;){for(ag(g,o,X,oe),X++,oe--;o[2*X+U]<$;)X++;for(;o[2*oe+U]>$;)oe--}o[2*S+U]===$?ag(g,o,S,oe):(oe++,ag(g,o,oe,D)),oe<=m&&(S=oe+1),m<=oe&&(D=oe-1)}}function ag(g,o,m,S){by(g,m,S),by(o,2*m,2*S),by(o,2*m+1,2*S+1)}function by(g,o,m){const S=g[o];g[o]=g[m],g[m]=S}function Xv(g,o,m,S){const D=g-m,U=o-S;return D*D+U*U}var Yv;T.ce=void 0,(Yv=T.ce||(T.ce={})).create="create",Yv.load="load",Yv.fullLoad="fullLoad";let wy=null,sg=[];const og=1e3/60,Sy="loadTime",Kv="fullLoadTime",Kb={mark(g){performance.mark(g)},frame(g){const o=g;wy!=null&&sg.push(o-wy),wy=o},clearMetrics(){wy=null,sg=[],performance.clearMeasures(Sy),performance.clearMeasures(Kv);for(const g in T.ce)performance.clearMarks(T.ce[g])},getPerformanceMetrics(){performance.measure(Sy,T.ce.create,T.ce.load),performance.measure(Kv,T.ce.create,T.ce.fullLoad);const g=performance.getEntriesByName(Sy)[0].duration,o=performance.getEntriesByName(Kv)[0].duration,m=sg.length,S=1/(sg.reduce((U,$)=>U+$,0)/m/1e3),D=sg.filter(U=>U>og).reduce((U,$)=>U+($-og)/og,0);return{loadTime:g,fullLoadTime:o,fps:S,percentDroppedFrames:D/(m+D)*100,totalFrames:m}}};T.$=et,T.A=Ue,T.B=Vc,T.C=function(g){if(at==null){const o=g.navigator?g.navigator.userAgent:null;at=!!g.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return at},T.D=cr,T.E=ko,T.F=class{constructor(g,o){this.target=g,this.mapId=o,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Bb(()=>this.process()),this.subscription=function(m,S,D,U){return m.addEventListener(S,D,!1),{unsubscribe:()=>{m.removeEventListener(S,D,!1)}}}(this.target,"message",m=>this.receive(m)),this.globalScope=mt(self)?g:window}registerMessageHandler(g,o){this.messageHandlers[g]=o}sendAsync(g,o){return new Promise((m,S)=>{const D=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[D]={resolve:m,reject:S},o&&o.signal.addEventListener("abort",()=>{delete this.resolveRejects[D];const X={id:D,type:"<cancel>",origin:location.origin,targetMapId:g.targetMapId,sourceMapId:this.mapId};this.target.postMessage(X)},{once:!0});const U=[],$=Object.assign(Object.assign({},g),{id:D,sourceMapId:this.mapId,origin:location.origin,data:kh(g.data,U)});this.target.postMessage($,{transfer:U})})}receive(g){const o=g.data,m=o.id;if(!(o.origin!=="file://"&&location.origin!=="file://"&&o.origin!=="resource://android"&&location.origin!=="resource://android"&&o.origin!==location.origin||o.targetMapId&&this.mapId!==o.targetMapId)){if(o.type==="<cancel>"){delete this.tasks[m];const S=this.abortControllers[m];return delete this.abortControllers[m],void(S&&S.abort())}if(mt(self)||o.mustQueue)return this.tasks[m]=o,this.taskQueue.push(m),void this.invoker.trigger();this.processTask(m,o)}}process(){if(this.taskQueue.length===0)return;const g=this.taskQueue.shift(),o=this.tasks[g];delete this.tasks[g],this.taskQueue.length>0&&this.invoker.trigger(),o&&this.processTask(g,o)}processTask(g,o){return t(this,void 0,void 0,function*(){if(o.type==="<response>"){const D=this.resolveRejects[g];return delete this.resolveRejects[g],D?void(o.error?D.reject(_c(o.error)):D.resolve(_c(o.data))):void 0}if(!this.messageHandlers[o.type])return void this.completeTask(g,new Error(`Could not find a registered handler for ${o.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const m=_c(o.data),S=new AbortController;this.abortControllers[g]=S;try{const D=yield this.messageHandlers[o.type](o.sourceMapId,m,S);this.completeTask(g,null,D)}catch(D){this.completeTask(g,D)}})}completeTask(g,o,m){const S=[];delete this.abortControllers[g];const D={id:g,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:o?kh(o):null,data:kh(m,S)};this.target.postMessage(D,{transfer:S})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},T.G=pr,T.H=function(){var g=new Ue(16);return Ue!=Float32Array&&(g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[11]=0,g[12]=0,g[13]=0,g[14]=0),g[0]=1,g[5]=1,g[10]=1,g[15]=1,g},T.I=Tp,T.J=function(g,o,m){var S,D,U,$,X,oe,fe,ve,Ce,Be,je,Ge,lt=m[0],Tt=m[1],Ot=m[2];return o===g?(g[12]=o[0]*lt+o[4]*Tt+o[8]*Ot+o[12],g[13]=o[1]*lt+o[5]*Tt+o[9]*Ot+o[13],g[14]=o[2]*lt+o[6]*Tt+o[10]*Ot+o[14],g[15]=o[3]*lt+o[7]*Tt+o[11]*Ot+o[15]):(D=o[1],U=o[2],$=o[3],X=o[4],oe=o[5],fe=o[6],ve=o[7],Ce=o[8],Be=o[9],je=o[10],Ge=o[11],g[0]=S=o[0],g[1]=D,g[2]=U,g[3]=$,g[4]=X,g[5]=oe,g[6]=fe,g[7]=ve,g[8]=Ce,g[9]=Be,g[10]=je,g[11]=Ge,g[12]=S*lt+X*Tt+Ce*Ot+o[12],g[13]=D*lt+oe*Tt+Be*Ot+o[13],g[14]=U*lt+fe*Tt+je*Ot+o[14],g[15]=$*lt+ve*Tt+Ge*Ot+o[15]),g},T.K=function(g,o,m){var S=m[0],D=m[1],U=m[2];return g[0]=o[0]*S,g[1]=o[1]*S,g[2]=o[2]*S,g[3]=o[3]*S,g[4]=o[4]*D,g[5]=o[5]*D,g[6]=o[6]*D,g[7]=o[7]*D,g[8]=o[8]*U,g[9]=o[9]*U,g[10]=o[10]*U,g[11]=o[11]*U,g[12]=o[12],g[13]=o[13],g[14]=o[14],g[15]=o[15],g},T.L=function(g,o,m){var S=o[0],D=o[1],U=o[2],$=o[3],X=o[4],oe=o[5],fe=o[6],ve=o[7],Ce=o[8],Be=o[9],je=o[10],Ge=o[11],lt=o[12],Tt=o[13],Ot=o[14],ln=o[15],Zt=m[0],Ne=m[1],xt=m[2],Yt=m[3];return g[0]=Zt*S+Ne*X+xt*Ce+Yt*lt,g[1]=Zt*D+Ne*oe+xt*Be+Yt*Tt,g[2]=Zt*U+Ne*fe+xt*je+Yt*Ot,g[3]=Zt*$+Ne*ve+xt*Ge+Yt*ln,g[4]=(Zt=m[4])*S+(Ne=m[5])*X+(xt=m[6])*Ce+(Yt=m[7])*lt,g[5]=Zt*D+Ne*oe+xt*Be+Yt*Tt,g[6]=Zt*U+Ne*fe+xt*je+Yt*Ot,g[7]=Zt*$+Ne*ve+xt*Ge+Yt*ln,g[8]=(Zt=m[8])*S+(Ne=m[9])*X+(xt=m[10])*Ce+(Yt=m[11])*lt,g[9]=Zt*D+Ne*oe+xt*Be+Yt*Tt,g[10]=Zt*U+Ne*fe+xt*je+Yt*Ot,g[11]=Zt*$+Ne*ve+xt*Ge+Yt*ln,g[12]=(Zt=m[12])*S+(Ne=m[13])*X+(xt=m[14])*Ce+(Yt=m[15])*lt,g[13]=Zt*D+Ne*oe+xt*Be+Yt*Tt,g[14]=Zt*U+Ne*fe+xt*je+Yt*Ot,g[15]=Zt*$+Ne*ve+xt*Ge+Yt*ln,g},T.M=function(g,o){const m={};for(let S=0;S<o.length;S++){const D=o[S];D in g&&(m[D]=g[D])}return m},T.N=Cf,T.O=Oh,T.P=ce,T.Q=Bv,T.R=vo,T.S=Cc,T.T=$i,T.U=$e,T.V=Le,T.W=Cn,T.X=pn,T.Y=i_,T.Z=Nv,T._=t,T.a=Vi,T.a$=function(){return new Float64Array(16)},T.a0=g=>{const o=window.document.createElement("video");return o.muted=!0,new Promise(m=>{o.onloadstart=()=>{m(o)};for(const S of g){const D=window.document.createElement("source");Ta(S)||(o.crossOrigin="Anonymous"),D.src=S,o.appendChild(D)}})},T.a1=function(){return Ln++},T.a2=j,T.a3=Tf,T.a4=dd,T.a5=sh,T.a6=yy,T.a7=function(g){const o={};if(g.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(m,S,D,U)=>{const $=D||U;return o[S]=!$||$.toLowerCase(),""}),o["max-age"]){const m=parseInt(o["max-age"],10);isNaN(m)?delete o["max-age"]:o["max-age"]=m}return o},T.a8=function(g){return Math.log(g)/Math.LN2},T.a9=function(g){var o=g[0],m=g[1];return o*o+m*m},T.aA=cs,T.aB=w,T.aC=Et,T.aD=Gi,T.aE=jn,T.aF=85.051129,T.aG=function(g){return Math.pow(2,g)},T.aH=Vb,T.aI=Ci,T.aJ=ii,T.aK=Nb,T.aL=function(g,o,m){return g[0]=o[0]*m,g[1]=o[1]*m,g[2]=o[2]*m,g},T.aM=function(g,o,m){return g[0]=o[0]+m[0],g[1]=o[1]+m[1],g[2]=o[2]+m[2],g},T.aN=function(g){var o=new Ue(3);return o[0]=g[0],o[1]=g[1],o[2]=g[2],o},T.aO=function(g,o,m){return g[0]=o[0]*m[0],g[1]=o[1]*m[1],g[2]=o[2]*m[2],g[3]=o[3]*m[3],g},T.aP=function(g,o,m){return g[0]=o[0]-m[0],g[1]=o[1]-m[1],g[2]=o[2]-m[2],g},T.aQ=function(g,o){var m=o[0],S=o[1],D=o[2],U=m*m+S*S+D*D;return U>0&&(U=1/Math.sqrt(U)),g[0]=o[0]*U,g[1]=o[1]*U,g[2]=o[2]*U,g},T.aR=function(g,o,m){var S=o[0],D=o[1],U=o[2],$=m[0],X=m[1],oe=m[2];return g[0]=D*oe-U*X,g[1]=U*$-S*oe,g[2]=S*X-D*$,g},T.aS=function(g,o){return g[0]*o[0]+g[1]*o[1]+g[2]*o[2]},T.aT=Ub,T.aU=fm,T.aV=function(g,o,m,S,D){var U,$=1/Math.tan(o/2);return g[0]=$/m,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=$,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[11]=-1,g[12]=0,g[13]=0,g[15]=0,D!=null&&D!==1/0?(g[10]=(D+S)*(U=1/(S-D)),g[14]=2*D*S*U):(g[10]=-1,g[14]=-2*S),g},T.aW=function(g){var o=new Ue(16);return o[0]=g[0],o[1]=g[1],o[2]=g[2],o[3]=g[3],o[4]=g[4],o[5]=g[5],o[6]=g[6],o[7]=g[7],o[8]=g[8],o[9]=g[9],o[10]=g[10],o[11]=g[11],o[12]=g[12],o[13]=g[13],o[14]=g[14],o[15]=g[15],o},T.aX=function(g,o,m){var S=Math.sin(m),D=Math.cos(m),U=o[0],$=o[1],X=o[2],oe=o[3],fe=o[4],ve=o[5],Ce=o[6],Be=o[7];return o!==g&&(g[8]=o[8],g[9]=o[9],g[10]=o[10],g[11]=o[11],g[12]=o[12],g[13]=o[13],g[14]=o[14],g[15]=o[15]),g[0]=U*D+fe*S,g[1]=$*D+ve*S,g[2]=X*D+Ce*S,g[3]=oe*D+Be*S,g[4]=fe*D-U*S,g[5]=ve*D-$*S,g[6]=Ce*D-X*S,g[7]=Be*D-oe*S,g},T.aY=function(g,o,m){var S=Math.sin(m),D=Math.cos(m),U=o[4],$=o[5],X=o[6],oe=o[7],fe=o[8],ve=o[9],Ce=o[10],Be=o[11];return o!==g&&(g[0]=o[0],g[1]=o[1],g[2]=o[2],g[3]=o[3],g[12]=o[12],g[13]=o[13],g[14]=o[14],g[15]=o[15]),g[4]=U*D+fe*S,g[5]=$*D+ve*S,g[6]=X*D+Ce*S,g[7]=oe*D+Be*S,g[8]=fe*D-U*S,g[9]=ve*D-$*S,g[10]=Ce*D-X*S,g[11]=Be*D-oe*S,g},T.aZ=function(){const g=new Float32Array(16);return He(g),g},T.a_=function(){const g=new Float64Array(16);return He(g),g},T.aa=function(g){return g*Math.PI/180},T.ab=Pn,T.ac=function(g,o){const m=[];for(const S in g)S in o||m.push(S);return m},T.ad=hn,T.ae=function(g){return Math.hypot(g[0],g[1])},T.af=function(g){return g[0]=0,g[1]=0,g},T.ag=function(g,o,m){return g[0]=o[0]*m,g[1]=o[1]*m,g},T.ah=function(g,o){let m=0,S=0;if(g.kind==="constant")S=g.layoutSize;else if(g.kind!=="source"){const{interpolationType:D,minZoom:U,maxZoom:$}=g,X=D?Pn(Yr.interpolationFactor(D,o,U,$),0,1):0;g.kind==="camera"?S=Oa.number(g.minSize,g.maxSize,X):m=X}return{uSizeT:m,uSize:S}},T.aj=function(g,{uSize:o,uSizeT:m},{lowerSize:S,upperSize:D}){return g.kind==="source"?S/Dd:g.kind==="composite"?Oa.number(S/Dd,D/Dd,m):o},T.ak=kv,T.al=ft,T.am=function(g,o,m,S){const D=o.y-g.y,U=o.x-g.x,$=S.y-m.y,X=S.x-m.x,oe=$*U-X*D;if(oe===0)return null;const fe=(X*(g.y-m.y)-$*(g.x-m.x))/oe;return new ce(g.x+fe*U,g.y+fe*D)},T.an=function(g,o){var m=o[0],S=o[1],D=o[2],U=o[3],$=o[4],X=o[5],oe=o[6],fe=o[7],ve=o[8],Ce=o[9],Be=o[10],je=o[11],Ge=o[12],lt=o[13],Tt=o[14],Ot=o[15],ln=m*X-S*$,Zt=m*oe-D*$,Ne=m*fe-U*$,xt=S*oe-D*X,Yt=S*fe-U*X,Dn=D*fe-U*oe,bi=ve*lt-Ce*Ge,Un=ve*Tt-Be*Ge,Kn=ve*Ot-je*Ge,Di=Ce*Tt-Be*lt,Si=Ce*Ot-je*lt,Li=Be*Ot-je*Tt,ni=ln*Li-Zt*Si+Ne*Di+xt*Kn-Yt*Un+Dn*bi;return ni?(g[0]=(X*Li-oe*Si+fe*Di)*(ni=1/ni),g[1]=(D*Si-S*Li-U*Di)*ni,g[2]=(lt*Dn-Tt*Yt+Ot*xt)*ni,g[3]=(Be*Yt-Ce*Dn-je*xt)*ni,g[4]=(oe*Kn-$*Li-fe*Un)*ni,g[5]=(m*Li-D*Kn+U*Un)*ni,g[6]=(Tt*Ne-Ge*Dn-Ot*Zt)*ni,g[7]=(ve*Dn-Be*Ne+je*Zt)*ni,g[8]=($*Si-X*Kn+fe*bi)*ni,g[9]=(S*Kn-m*Si-U*bi)*ni,g[10]=(Ge*Yt-lt*Ne+Ot*ln)*ni,g[11]=(Ce*Ne-ve*Yt-je*ln)*ni,g[12]=(X*Un-$*Di-oe*bi)*ni,g[13]=(m*Di-S*Un+D*bi)*ni,g[14]=(lt*Zt-Ge*xt-Tt*ln)*ni,g[15]=(ve*xt-Ce*Zt+Be*ln)*ni,g):null},T.ao=Gv,T.ap=vf,T.aq=He,T.ar=function(g){let o=1/0,m=1/0,S=-1/0,D=-1/0;for(const U of g)o=Math.min(o,U.x),m=Math.min(m,U.y),S=Math.max(S,U.x),D=Math.max(D,U.y);return[o,m,S,D]},T.as=Lr,T.at=ri,T.au=function(g,o,m,S,D=!1){if(!m[0]&&!m[1])return[0,0];const U=D?S==="map"?-g.bearingInRadians:0:S==="viewport"?g.bearingInRadians:0;if(U){const $=Math.sin(U),X=Math.cos(U);m=[m[0]*X-m[1]*$,m[0]*$+m[1]*X]}return[D?m[0]:ri(o,m[0],g.zoom),D?m[1]:ri(o,m[1],g.zoom)]},T.aw=Pv,T.ax=Hv,T.ay=uy,T.az=rg,T.b=Tn,T.b$=g=>g.type==="line",T.b0=function(g,o,m){const S=new Float64Array(4);return function(D,U,$,X){var oe=.5*Math.PI/180;U*=oe,$*=oe,X*=oe;var fe=Math.sin(U),ve=Math.cos(U),Ce=Math.sin($),Be=Math.cos($),je=Math.sin(X),Ge=Math.cos(X);D[0]=fe*Be*Ge-ve*Ce*je,D[1]=ve*Ce*Ge+fe*Be*je,D[2]=ve*Be*je-fe*Ce*Ge,D[3]=ve*Be*Ge+fe*Ce*je}(S,g,o-90,m),S},T.b1=function(g,o,m,S){var D,U,$,X,oe,fe=o[0],ve=o[1],Ce=o[2],Be=o[3],je=m[0],Ge=m[1],lt=m[2],Tt=m[3];return(U=fe*je+ve*Ge+Ce*lt+Be*Tt)<0&&(U=-U,je=-je,Ge=-Ge,lt=-lt,Tt=-Tt),1-U>Ve?(D=Math.acos(U),$=Math.sin(D),X=Math.sin((1-S)*D)/$,oe=Math.sin(S*D)/$):(X=1-S,oe=S),g[0]=X*fe+oe*je,g[1]=X*ve+oe*Ge,g[2]=X*Ce+oe*lt,g[3]=X*Be+oe*Tt,g},T.b2=function(g){const o=new Float64Array(9);var m,S,D,U,$,X,oe,fe,ve,Ce,Be,je,Ge,lt,Tt,Ot,ln,Zt;Ce=(D=(S=g)[0])*(oe=D+D),Be=(U=S[1])*oe,Ge=($=S[2])*oe,lt=$*(fe=U+U),Ot=(X=S[3])*oe,ln=X*fe,Zt=X*(ve=$+$),(m=o)[0]=1-(je=U*fe)-(Tt=$*ve),m[3]=Be-Zt,m[6]=Ge+ln,m[1]=Be+Zt,m[4]=1-Ce-Tt,m[7]=lt-Ot,m[2]=Ge-ln,m[5]=lt+Ot,m[8]=1-Ce-je;const Ne=ii(-Math.asin(Pn(o[2],-1,1)));let xt,Yt;return Math.hypot(o[5],o[8])<.001?(xt=0,Yt=-ii(Math.atan2(o[3],o[4]))):(xt=ii(o[5]===0&&o[8]===0?0:Math.atan2(o[5],o[8])),Yt=ii(o[1]===0&&o[0]===0?0:Math.atan2(o[1],o[0]))),{roll:xt,pitch:Ne+90,bearing:Yt}},T.b3=function(g,o){return g.roll==o.roll&&g.pitch==o.pitch&&g.bearing==o.bearing},T.b4=Br,T.b5=rl,T.b6=M,T.b7=A,T.b8=y,T.b9=_n,T.bA=sn,T.bB=qn,T.bC=class extends il{constructor(g,o){super(g,o),this.current=0}set(g){this.current!==g&&(this.current=g,this.gl.uniform1i(this.location,g))}},T.bD=class extends il{constructor(g,o){super(g,o),this.current=ah}set(g){if(g[12]!==this.current[12]||g[0]!==this.current[0])return this.current=g,void this.gl.uniformMatrix4fv(this.location,!1,g);for(let o=1;o<16;o++)if(g[o]!==this.current[o]){this.current=g,this.gl.uniformMatrix4fv(this.location,!1,g);break}}},T.bE=xu,T.bF=rh,T.bG=class extends il{constructor(g,o){super(g,o),this.current=[0,0,0]}set(g){g[0]===this.current[0]&&g[1]===this.current[1]&&g[2]===this.current[2]||(this.current=g,this.gl.uniform3f(this.location,g[0],g[1],g[2]))}},T.bH=class extends il{constructor(g,o){super(g,o),this.current=[0,0]}set(g){g[0]===this.current[0]&&g[1]===this.current[1]||(this.current=g,this.gl.uniform2f(this.location,g[0],g[1]))}},T.bI=qe,T.bJ=function(g,o){var m=Math.sin(o),S=Math.cos(o);return g[0]=S,g[1]=m,g[2]=0,g[3]=-m,g[4]=S,g[5]=0,g[6]=0,g[7]=0,g[8]=1,g},T.bK=function(g,o,m){var S=o[0],D=o[1],U=o[2];return g[0]=S*m[0]+D*m[3]+U*m[6],g[1]=S*m[1]+D*m[4]+U*m[7],g[2]=S*m[2]+D*m[5]+U*m[8],g},T.bL=function(g,o,m,S,D,U,$){var X=1/(o-m),oe=1/(S-D),fe=1/(U-$);return g[0]=-2*X,g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=-2*oe,g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[10]=2*fe,g[11]=0,g[12]=(o+m)*X,g[13]=(D+S)*oe,g[14]=($+U)*fe,g[15]=1,g},T.bM=class extends Ei{},T.bN=ys,T.bO=class extends _a{},T.bP=oh,T.bQ=function(g){return g<=1?1:Math.pow(2,Math.ceil(Math.log(g)/Math.LN2))},T.bR=Md,T.bS=function(g,o,m){var S=o[0],D=o[1],U=o[2],$=m[3]*S+m[7]*D+m[11]*U+m[15];return g[0]=(m[0]*S+m[4]*D+m[8]*U+m[12])/($=$||1),g[1]=(m[1]*S+m[5]*D+m[9]*U+m[13])/$,g[2]=(m[2]*S+m[6]*D+m[10]*U+m[14])/$,g},T.bT=class extends ba{},T.bU=class extends p{},T.bV=function(g,o){return g[0]===o[0]&&g[1]===o[1]&&g[2]===o[2]&&g[3]===o[3]&&g[4]===o[4]&&g[5]===o[5]&&g[6]===o[6]&&g[7]===o[7]&&g[8]===o[8]&&g[9]===o[9]&&g[10]===o[10]&&g[11]===o[11]&&g[12]===o[12]&&g[13]===o[13]&&g[14]===o[14]&&g[15]===o[15]},T.bW=function(g,o){var m=g[0],S=g[1],D=g[2],U=g[3],$=g[4],X=g[5],oe=g[6],fe=g[7],ve=g[8],Ce=g[9],Be=g[10],je=g[11],Ge=g[12],lt=g[13],Tt=g[14],Ot=g[15],ln=o[0],Zt=o[1],Ne=o[2],xt=o[3],Yt=o[4],Dn=o[5],bi=o[6],Un=o[7],Kn=o[8],Di=o[9],Si=o[10],Li=o[11],ni=o[12],ar=o[13],Cr=o[14],gr=o[15];return Math.abs(m-ln)<=Ve*Math.max(1,Math.abs(m),Math.abs(ln))&&Math.abs(S-Zt)<=Ve*Math.max(1,Math.abs(S),Math.abs(Zt))&&Math.abs(D-Ne)<=Ve*Math.max(1,Math.abs(D),Math.abs(Ne))&&Math.abs(U-xt)<=Ve*Math.max(1,Math.abs(U),Math.abs(xt))&&Math.abs($-Yt)<=Ve*Math.max(1,Math.abs($),Math.abs(Yt))&&Math.abs(X-Dn)<=Ve*Math.max(1,Math.abs(X),Math.abs(Dn))&&Math.abs(oe-bi)<=Ve*Math.max(1,Math.abs(oe),Math.abs(bi))&&Math.abs(fe-Un)<=Ve*Math.max(1,Math.abs(fe),Math.abs(Un))&&Math.abs(ve-Kn)<=Ve*Math.max(1,Math.abs(ve),Math.abs(Kn))&&Math.abs(Ce-Di)<=Ve*Math.max(1,Math.abs(Ce),Math.abs(Di))&&Math.abs(Be-Si)<=Ve*Math.max(1,Math.abs(Be),Math.abs(Si))&&Math.abs(je-Li)<=Ve*Math.max(1,Math.abs(je),Math.abs(Li))&&Math.abs(Ge-ni)<=Ve*Math.max(1,Math.abs(Ge),Math.abs(ni))&&Math.abs(lt-ar)<=Ve*Math.max(1,Math.abs(lt),Math.abs(ar))&&Math.abs(Tt-Cr)<=Ve*Math.max(1,Math.abs(Tt),Math.abs(Cr))&&Math.abs(Ot-gr)<=Ve*Math.max(1,Math.abs(Ot),Math.abs(gr))},T.bX=function(g,o){return g[0]=o[0],g[1]=o[1],g[2]=o[2],g[3]=o[3],g[4]=o[4],g[5]=o[5],g[6]=o[6],g[7]=o[7],g[8]=o[8],g[9]=o[9],g[10]=o[10],g[11]=o[11],g[12]=o[12],g[13]=o[13],g[14]=o[14],g[15]=o[15],g},T.bY=g=>g.type==="symbol",T.bZ=g=>g.type==="circle",T.b_=g=>g.type==="heatmap",T.ba=Bn,T.bb=no,T.bc=function(g,o,m,S,D){return _n(S,D,Pn((g-o)/(m-o),0,1))},T.bd=ai,T.be=function(){return new Float64Array(4)},T.bf=function(){return new Float64Array(3)},T.bg=function(g,o,m,S){var D=[],U=[];return D[0]=o[0]-m[0],D[1]=o[1]-m[1],D[2]=o[2]-m[2],U[0]=D[0]*Math.cos(S)-D[1]*Math.sin(S),U[1]=D[0]*Math.sin(S)+D[1]*Math.cos(S),U[2]=D[2],g[0]=U[0]+m[0],g[1]=U[1]+m[1],g[2]=U[2]+m[2],g},T.bh=function(g,o,m,S){var D=[],U=[];return D[0]=o[0]-m[0],D[1]=o[1]-m[1],D[2]=o[2]-m[2],U[0]=D[0],U[1]=D[1]*Math.cos(S)-D[2]*Math.sin(S),U[2]=D[1]*Math.sin(S)+D[2]*Math.cos(S),g[0]=U[0]+m[0],g[1]=U[1]+m[1],g[2]=U[2]+m[2],g},T.bi=function(g,o,m,S){var D=[],U=[];return D[0]=o[0]-m[0],D[1]=o[1]-m[1],D[2]=o[2]-m[2],U[0]=D[2]*Math.sin(S)+D[0]*Math.cos(S),U[1]=D[1],U[2]=D[2]*Math.cos(S)-D[0]*Math.sin(S),g[0]=U[0]+m[0],g[1]=U[1]+m[1],g[2]=U[2]+m[2],g},T.bj=function(g,o,m){var S=Math.sin(m),D=Math.cos(m),U=o[0],$=o[1],X=o[2],oe=o[3],fe=o[8],ve=o[9],Ce=o[10],Be=o[11];return o!==g&&(g[4]=o[4],g[5]=o[5],g[6]=o[6],g[7]=o[7],g[12]=o[12],g[13]=o[13],g[14]=o[14],g[15]=o[15]),g[0]=U*D-fe*S,g[1]=$*D-ve*S,g[2]=X*D-Ce*S,g[3]=oe*D-Be*S,g[8]=U*S+fe*D,g[9]=$*S+ve*D,g[10]=X*S+Ce*D,g[11]=oe*S+Be*D,g},T.bk=function(g,o){const m=ai(g,360),S=ai(o,360),D=S-m,U=S>m?D-360:D+360;return Math.abs(D)<Math.abs(U)?D:U},T.bl=function(g){return g[0]=0,g[1]=0,g[2]=0,g},T.bm=function(g,o,m,S){const D=Math.sqrt(g*g+o*o),U=Math.sqrt(m*m+S*S);g/=D,o/=D,m/=U,S/=U;const $=Math.acos(g*m+o*S);return-o*m+g*S>0?$:-$},T.bn=function(g,o){return g[0]*o[0]+g[1]*o[1]+g[2]*o[2]+g[3]},T.bo=my,T.bp=function(g,o){const m=ai(g,2*Math.PI),S=ai(o,2*Math.PI);return Math.min(Math.abs(m-S),Math.abs(m-S+2*Math.PI),Math.abs(m-S-2*Math.PI))},T.bq=function(g){return Math.hypot(g[0],g[1],g[2])},T.br=function(){const g={},o=bt.$version;for(const m in bt.$root){const S=bt.$root[m];if(S.required){let D=null;D=m==="version"?o:S.type==="array"?[]:{},D!=null&&(g[m]=D)}}return g},T.bs=cp,T.bt=sa,T.bu=function(g){g=g.slice();const o=Object.create(null);for(let m=0;m<g.length;m++)o[g[m].id]=g[m];for(let m=0;m<g.length;m++)"ref"in g[m]&&(g[m]=dt(g[m],o[g[m].ref]));return g},T.bv=function(g){if(g.type==="custom")return new Ov(g);switch(g.type){case"background":return new Fw(g);case"circle":return new om(g);case"fill":return new De(g);case"fill-extrusion":return new Ii(g);case"heatmap":return new Sv(g);case"hillshade":return new Cv(g);case"line":return new Xa(g);case"raster":return new zv(g);case"symbol":return new Mp(g)}},T.bw=pi,T.bx=function(g,o){if(!g)return[{command:"setStyle",args:[o]}];let m=[];try{if(!it(g.version,o.version))return[{command:"setStyle",args:[o]}];it(g.center,o.center)||m.push({command:"setCenter",args:[o.center]}),it(g.centerAltitude,o.centerAltitude)||m.push({command:"setCenterAltitude",args:[o.centerAltitude]}),it(g.zoom,o.zoom)||m.push({command:"setZoom",args:[o.zoom]}),it(g.bearing,o.bearing)||m.push({command:"setBearing",args:[o.bearing]}),it(g.pitch,o.pitch)||m.push({command:"setPitch",args:[o.pitch]}),it(g.roll,o.roll)||m.push({command:"setRoll",args:[o.roll]}),it(g.sprite,o.sprite)||m.push({command:"setSprite",args:[o.sprite]}),it(g.glyphs,o.glyphs)||m.push({command:"setGlyphs",args:[o.glyphs]}),it(g.transition,o.transition)||m.push({command:"setTransition",args:[o.transition]}),it(g.light,o.light)||m.push({command:"setLight",args:[o.light]}),it(g.terrain,o.terrain)||m.push({command:"setTerrain",args:[o.terrain]}),it(g.sky,o.sky)||m.push({command:"setSky",args:[o.sky]}),it(g.projection,o.projection)||m.push({command:"setProjection",args:[o.projection]});const S={},D=[];(function($,X,oe,fe){let ve;for(ve in X=X||{},$=$||{})Object.prototype.hasOwnProperty.call($,ve)&&(Object.prototype.hasOwnProperty.call(X,ve)||un(ve,oe,fe));for(ve in X)Object.prototype.hasOwnProperty.call(X,ve)&&(Object.prototype.hasOwnProperty.call($,ve)?it($[ve],X[ve])||($[ve].type==="geojson"&&X[ve].type==="geojson"&&fn($,X,ve)?Ut(oe,{command:"setGeoJSONSourceData",args:[ve,X[ve].data]}):kn(ve,X,oe,fe)):on(ve,X,oe))})(g.sources,o.sources,D,S);const U=[];g.layers&&g.layers.forEach($=>{"source"in $&&S[$.source]?m.push({command:"removeLayer",args:[$.id]}):U.push($)}),m=m.concat(D),function($,X,oe){X=X||[];const fe=($=$||[]).map(Gn),ve=X.map(Gn),Ce=$.reduce(Sn,{}),Be=X.reduce(Sn,{}),je=fe.slice(),Ge=Object.create(null);let lt,Tt,Ot,ln,Zt;for(let Ne=0,xt=0;Ne<fe.length;Ne++)lt=fe[Ne],Object.prototype.hasOwnProperty.call(Be,lt)?xt++:(Ut(oe,{command:"removeLayer",args:[lt]}),je.splice(je.indexOf(lt,xt),1));for(let Ne=0,xt=0;Ne<ve.length;Ne++)lt=ve[ve.length-1-Ne],je[je.length-1-Ne]!==lt&&(Object.prototype.hasOwnProperty.call(Ce,lt)?(Ut(oe,{command:"removeLayer",args:[lt]}),je.splice(je.lastIndexOf(lt,je.length-xt),1)):xt++,ln=je[je.length-Ne],Ut(oe,{command:"addLayer",args:[Be[lt],ln]}),je.splice(je.length-Ne,0,lt),Ge[lt]=!0);for(let Ne=0;Ne<ve.length;Ne++)if(lt=ve[Ne],Tt=Ce[lt],Ot=Be[lt],!Ge[lt]&&!it(Tt,Ot))if(it(Tt.source,Ot.source)&&it(Tt["source-layer"],Ot["source-layer"])&&it(Tt.type,Ot.type)){for(Zt in Wn(Tt.layout,Ot.layout,oe,lt,null,"setLayoutProperty"),Wn(Tt.paint,Ot.paint,oe,lt,null,"setPaintProperty"),it(Tt.filter,Ot.filter)||Ut(oe,{command:"setFilter",args:[lt,Ot.filter]}),it(Tt.minzoom,Ot.minzoom)&&it(Tt.maxzoom,Ot.maxzoom)||Ut(oe,{command:"setLayerZoomRange",args:[lt,Ot.minzoom,Ot.maxzoom]}),Tt)Object.prototype.hasOwnProperty.call(Tt,Zt)&&Zt!=="layout"&&Zt!=="paint"&&Zt!=="filter"&&Zt!=="metadata"&&Zt!=="minzoom"&&Zt!=="maxzoom"&&(Zt.indexOf("paint.")===0?Wn(Tt[Zt],Ot[Zt],oe,lt,Zt.slice(6),"setPaintProperty"):it(Tt[Zt],Ot[Zt])||Ut(oe,{command:"setLayerProperty",args:[lt,Zt,Ot[Zt]]}));for(Zt in Ot)Object.prototype.hasOwnProperty.call(Ot,Zt)&&!Object.prototype.hasOwnProperty.call(Tt,Zt)&&Zt!=="layout"&&Zt!=="paint"&&Zt!=="filter"&&Zt!=="metadata"&&Zt!=="minzoom"&&Zt!=="maxzoom"&&(Zt.indexOf("paint.")===0?Wn(Tt[Zt],Ot[Zt],oe,lt,Zt.slice(6),"setPaintProperty"):it(Tt[Zt],Ot[Zt])||Ut(oe,{command:"setLayerProperty",args:[lt,Zt,Ot[Zt]]}))}else Ut(oe,{command:"removeLayer",args:[lt]}),ln=je[je.lastIndexOf(lt)+1],Ut(oe,{command:"addLayer",args:[Ot,ln]})}(U,o.layers,m)}catch(S){console.warn("Unable to compute style diff:",S),m=[{command:"setStyle",args:[o]}]}return m},T.by=function(g){const o=[],m=g.id;return m===void 0&&o.push({message:`layers.${m}: missing required property "id"`}),g.render===void 0&&o.push({message:`layers.${m}: missing required method "render"`}),g.renderingMode&&g.renderingMode!=="2d"&&g.renderingMode!=="3d"&&o.push({message:`layers.${m}: property "renderingMode" must be either "2d" or "3d"`}),o},T.bz=function g(o,m){if(Array.isArray(o)){if(!Array.isArray(m)||o.length!==m.length)return!1;for(let S=0;S<o.length;S++)if(!g(o[S],m[S]))return!1;return!0}if(typeof o=="object"&&o!==null&&m!==null){if(typeof m!="object"||Object.keys(o).length!==Object.keys(m).length)return!1;for(const S in o)if(!g(o[S],m[S]))return!1;return!0}return o===m},T.c=Ki,T.c0=g=>g.type==="fill",T.c1=g=>g.type==="fill-extrusion",T.c2=g=>g.type==="hillshade",T.c3=g=>g.type==="raster",T.c4=g=>g.type==="background",T.c5=g=>g.type==="custom",T.c6=mn,T.c7=function(g,o,m){const S=gn(o.x-m.x,o.y-m.y),D=gn(g.x-m.x,g.y-m.y);var U,$;return ii(Math.atan2(S[0]*D[1]-S[1]*D[0],(U=S)[0]*($=D)[0]+U[1]*$[1]))},T.c8=Nn,T.c9=function(g,o,m){var S=o[0],D=o[1];return g[0]=m[0]*S+m[4]*D+m[12],g[1]=m[1]*S+m[5]*D+m[13],g},T.cA=jl,T.cB=rf,T.cC=yc,T.ca=function(g,o){const{x:m,y:S}=i_.fromLngLat(o);return!(g<0||g>25||S<0||S>=1||m<0||m>=1)},T.cb=function(g,o){return g[0]=o[0],g[1]=0,g[2]=0,g[3]=0,g[4]=0,g[5]=o[1],g[6]=0,g[7]=0,g[8]=0,g[9]=0,g[10]=o[2],g[11]=0,g[12]=0,g[13]=0,g[14]=0,g[15]=1,g},T.cc=class extends Go{},T.cd=Kb,T.cf=function(g){return g.message===wi},T.cg=Er,T.ch=function(g,o){Vi.REGISTERED_PROTOCOLS[g]=o},T.ci=function(g){delete Vi.REGISTERED_PROTOCOLS[g]},T.cj=function(g,o){const m={};for(let D=0;D<g.length;D++){const U=o&&o[g[D].id]||rp(g[D]);o&&(o[g[D].id]=U);let $=m[U];$||($=m[U]=[]),$.push(g[D])}const S=[];for(const D in m)S.push(m[D]);return S},T.ck=Yi,T.cl=jv,T.cm=Uv,T.cn=hm,T.co=function(g){g.bucket.createArrays(),g.bucket.tilePixelRatio=pn/(512*g.bucket.overscaling),g.bucket.compareText={},g.bucket.iconsNeedLinear=!1;const o=g.bucket.layers[0],m=o.layout,S=o._unevaluatedLayout._values,D={layoutIconSize:S["icon-size"].possiblyEvaluate(new ls(g.bucket.zoom+1),g.canonical),layoutTextSize:S["text-size"].possiblyEvaluate(new ls(g.bucket.zoom+1),g.canonical),textMaxSize:S["text-size"].possiblyEvaluate(new ls(18))};if(g.bucket.textSizeData.kind==="composite"){const{minZoom:fe,maxZoom:ve}=g.bucket.textSizeData;D.compositeTextSizes=[S["text-size"].possiblyEvaluate(new ls(fe),g.canonical),S["text-size"].possiblyEvaluate(new ls(ve),g.canonical)]}if(g.bucket.iconSizeData.kind==="composite"){const{minZoom:fe,maxZoom:ve}=g.bucket.iconSizeData;D.compositeIconSizes=[S["icon-size"].possiblyEvaluate(new ls(fe),g.canonical),S["icon-size"].possiblyEvaluate(new ls(ve),g.canonical)]}const U=m.get("text-line-height")*Lr,$=m.get("text-rotation-alignment")!=="viewport"&&m.get("symbol-placement")!=="point",X=m.get("text-keep-upright"),oe=m.get("text-size");for(const fe of g.bucket.features){const ve=m.get("text-font").evaluate(fe,{},g.canonical).join(","),Ce=oe.evaluate(fe,{},g.canonical),Be=D.layoutTextSize.evaluate(fe,{},g.canonical),je=D.layoutIconSize.evaluate(fe,{},g.canonical),Ge={horizontal:{},vertical:void 0},lt=fe.text;let Tt,Ot=[0,0];if(lt){const Ne=lt.toString(),xt=m.get("text-letter-spacing").evaluate(fe,{},g.canonical)*Lr,Yt=up(Ne)?xt:0,Dn=m.get("text-anchor").evaluate(fe,{},g.canonical),bi=Yb(o,fe,g.canonical);if(!bi){const Si=m.get("text-radial-offset").evaluate(fe,{},g.canonical);Ot=Si?Xb(Dn,[Si*Lr,u_]):m.get("text-offset").evaluate(fe,{},g.canonical).map(Li=>Li*Lr)}let Un=$?"center":m.get("text-justify").evaluate(fe,{},g.canonical);const Kn=m.get("symbol-placement")==="point"?m.get("text-max-width").evaluate(fe,{},g.canonical)*Lr:1/0,Di=()=>{g.bucket.allowVerticalPlacement&&Uc(Ne)&&(Ge.vertical=Yg(lt,g.glyphMap,g.glyphPositions,g.imagePositions,ve,Kn,U,Dn,"left",Yt,Ot,T.ai.vertical,!0,Be,Ce))};if(!$&&bi){const Si=new Set;if(Un==="auto")for(let ni=0;ni<bi.values.length;ni+=2)Si.add(Hv(bi.values[ni]));else Si.add(Un);let Li=!1;for(const ni of Si)if(!Ge.horizontal[ni])if(Li)Ge.horizontal[ni]=Ge.horizontal[0];else{const ar=Yg(lt,g.glyphMap,g.glyphPositions,g.imagePositions,ve,Kn,U,"center",ni,Yt,Ot,T.ai.horizontal,!1,Be,Ce);ar&&(Ge.horizontal[ni]=ar,Li=ar.positionedLines.length===1)}Di()}else{Un==="auto"&&(Un=Hv(Dn));const Si=Yg(lt,g.glyphMap,g.glyphPositions,g.imagePositions,ve,Kn,U,Dn,Un,Yt,Ot,T.ai.horizontal,!1,Be,Ce);Si&&(Ge.horizontal[Un]=Si),Di(),Uc(Ne)&&$&&X&&(Ge.vertical=Yg(lt,g.glyphMap,g.glyphPositions,g.imagePositions,ve,Kn,U,Dn,Un,Yt,Ot,T.ai.vertical,!1,Be,Ce))}}let ln=!1;if(fe.icon&&fe.icon.name){const Ne=g.imageMap[fe.icon.name];Ne&&(Tt=e_(g.imagePositions[fe.icon.name],m.get("icon-offset").evaluate(fe,{},g.canonical),m.get("icon-anchor").evaluate(fe,{},g.canonical)),ln=!!Ne.sdf,g.bucket.sdfIcons===void 0?g.bucket.sdfIcons=ln:g.bucket.sdfIcons!==ln&&Zn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ne.pixelRatio!==g.bucket.pixelRatio||m.get("icon-rotate").constantOr(1)!==0)&&(g.bucket.iconsNeedLinear=!0))}const Zt=If(Ge.horizontal)||Ge.vertical;g.bucket.iconsInText=!!Zt&&Zt.iconsInText,(Zt||Tt)&&Bw(g.bucket,fe,Ge,Tt,g.imageMap,D,Be,je,Ot,ln,g.canonical,g.subdivisionGranularity)}g.showCollisionBoxes&&g.bucket.generateCollisionDebugBuffers()},T.cp=ra,T.cq=me,T.cr=dn,T.cs=Vn,T.ct=Su,T.cu=class{constructor(g){this._marks={start:[g.url,"start"].join("#"),end:[g.url,"end"].join("#"),measure:g.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let g=performance.getEntriesByName(this._marks.measure);return g.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),g=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),g}},T.cv=function(g,o,m,S,D){return t(this,void 0,void 0,function*(){if(Le())try{return yield Cn(g,o,m,S,D)}catch{}return function(U,$,X,oe,fe){const ve=U.width,Ce=U.height;zn&&vi||(zn=new OffscreenCanvas(ve,Ce),vi=zn.getContext("2d",{willReadFrequently:!0})),zn.width=ve,zn.height=Ce,vi.drawImage(U,0,0,ve,Ce);const Be=vi.getImageData($,X,oe,fe);return vi.clearRect(0,0,ve,Ce),Be.data}(g,o,m,S,D)})},T.cw=_y,T.cx=G,T.cy=ne,T.cz=En,T.d=g=>t(void 0,void 0,void 0,function*(){if(g.byteLength===0)return createImageBitmap(new ImageData(1,1));const o=new Blob([new Uint8Array(g)],{type:"image/png"});try{return createImageBitmap(o)}catch(m){throw new Error(`Could not load image because of ${m.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),T.e=Fi,T.f=g=>new Promise((o,m)=>{const S=new Image;S.onload=()=>{o(S),URL.revokeObjectURL(S.src),S.onload=null,window.requestAnimationFrame(()=>{S.src=bn})},S.onerror=()=>m(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const D=new Blob([new Uint8Array(g)],{type:"image/png"});S.src=g.byteLength?URL.createObjectURL(D):bn}),T.g=ui,T.h=(g,o)=>Ar(Fi(g,{type:"json"}),o),T.i=mt,T.j=to,T.k=As,T.l=(g,o)=>Ar(Fi(g,{type:"arrayBuffer"}),o),T.m=Ar,T.n=function(g){return new Su(g).readFields(Tu,[])},T.o=Vl,T.p=kd,T.q=$o,T.r=nm,T.s=Ta,T.t=lp,T.u=ml,T.v=bt,T.w=Zn,T.x=function([g,o,m]){return o+=90,o*=Math.PI/180,m*=Math.PI/180,{x:g*Math.cos(o)*Math.sin(m),y:g*Math.sin(o)*Math.sin(m),z:g*Math.cos(m)}},T.y=Oa,T.z=ls}),b("worker",["./shared"],function(T){class t{constructor(Qe){this.keyCache={},Qe&&this.replace(Qe)}replace(Qe){this._layerConfigs={},this._layers={},this.update(Qe,[])}update(Qe,dt){for(const Ut of Qe){this._layerConfigs[Ut.id]=Ut;const on=this._layers[Ut.id]=T.bv(Ut);on._featureFilter=T.a4(on.filter),this.keyCache[Ut.id]&&delete this.keyCache[Ut.id]}for(const Ut of dt)delete this.keyCache[Ut],delete this._layerConfigs[Ut],delete this._layers[Ut];this.familiesBySource={};const it=T.cj(Object.values(this._layerConfigs),this.keyCache);for(const Ut of it){const on=Ut.map(Sn=>this._layers[Sn.id]),un=on[0];if(un.visibility==="none")continue;const kn=un.source||"";let fn=this.familiesBySource[kn];fn||(fn=this.familiesBySource[kn]={});const Wn=un.sourceLayer||"_geojsonTileLayer";let Gn=fn[Wn];Gn||(Gn=fn[Wn]=[]),Gn.push(on)}}}class G{constructor(Qe){const dt={},it=[];for(const kn in Qe){const fn=Qe[kn],Wn=dt[kn]={};for(const Gn in fn){const Sn=fn[+Gn];if(!Sn||Sn.bitmap.width===0||Sn.bitmap.height===0)continue;const et={x:0,y:0,w:Sn.bitmap.width+2,h:Sn.bitmap.height+2};it.push(et),Wn[Gn]={rect:et,metrics:Sn.metrics}}}const{w:Ut,h:on}=T.p(it),un=new T.o({width:Ut||1,height:on||1});for(const kn in Qe){const fn=Qe[kn];for(const Wn in fn){const Gn=fn[+Wn];if(!Gn||Gn.bitmap.width===0||Gn.bitmap.height===0)continue;const Sn=dt[kn][Wn].rect;T.o.copy(Gn.bitmap,un,{x:0,y:0},{x:Sn.x+1,y:Sn.y+1},Gn.bitmap)}}this.image=un,this.positions=dt}}T.ck("GlyphAtlas",G);class W{constructor(Qe){this.tileID=new T.S(Qe.tileID.overscaledZ,Qe.tileID.wrap,Qe.tileID.canonical.z,Qe.tileID.canonical.x,Qe.tileID.canonical.y),this.uid=Qe.uid,this.zoom=Qe.zoom,this.pixelRatio=Qe.pixelRatio,this.tileSize=Qe.tileSize,this.source=Qe.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=Qe.showCollisionBoxes,this.collectResourceTiming=!!Qe.collectResourceTiming,this.returnDependencies=!!Qe.returnDependencies,this.promoteId=Qe.promoteId,this.inFlightDependencies=[]}parse(Qe,dt,it,Ut,on){return T._(this,void 0,void 0,function*(){this.status="parsing",this.data=Qe,this.collisionBoxArray=new T.a2;const un=new T.cl(Object.keys(Qe.layers).sort()),kn=new T.cm(this.tileID,this.promoteId);kn.bucketLayerIDs=[];const fn={},Wn={featureIndex:kn,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:it,subdivisionGranularity:on},Gn=dt.familiesBySource[this.source];for(const Xt in Gn){const Gt=Qe.layers[Xt];if(!Gt)continue;Gt.version===1&&T.w(`Vector tile source "${this.source}" layer "${Xt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const On=un.encode(Xt),_i=[];for(let li=0;li<Gt.length;li++){const Ui=Gt.feature(li),qi=kn.getId(Ui,Xt);_i.push({feature:Ui,id:qi,index:li,sourceLayerIndex:On})}for(const li of Gn[Xt]){const Ui=li[0];Ui.source!==this.source&&T.w(`layer.source = ${Ui.source} does not equal this.source = ${this.source}`),Ui.minzoom&&this.zoom<Math.floor(Ui.minzoom)||Ui.maxzoom&&this.zoom>=Ui.maxzoom||Ui.visibility!=="none"&&(Y(li,this.zoom,it),(fn[Ui.id]=Ui.createBucket({index:kn.bucketLayerIDs.length,layers:li,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:On,sourceID:this.source})).populate(_i,Wn,this.tileID.canonical),kn.bucketLayerIDs.push(li.map(qi=>qi.id)))}}const Sn=T.bA(Wn.glyphDependencies,Xt=>Object.keys(Xt).map(Number));this.inFlightDependencies.forEach(Xt=>Xt==null?void 0:Xt.abort()),this.inFlightDependencies=[];let et=Promise.resolve({});if(Object.keys(Sn).length){const Xt=new AbortController;this.inFlightDependencies.push(Xt),et=Ut.sendAsync({type:"GG",data:{stacks:Sn,source:this.source,tileID:this.tileID,type:"glyphs"}},Xt)}const we=Object.keys(Wn.iconDependencies);let Pe=Promise.resolve({});if(we.length){const Xt=new AbortController;this.inFlightDependencies.push(Xt),Pe=Ut.sendAsync({type:"GI",data:{icons:we,source:this.source,tileID:this.tileID,type:"icons"}},Xt)}const Ze=Object.keys(Wn.patternDependencies);let yt=Promise.resolve({});if(Ze.length){const Xt=new AbortController;this.inFlightDependencies.push(Xt),yt=Ut.sendAsync({type:"GI",data:{icons:Ze,source:this.source,tileID:this.tileID,type:"patterns"}},Xt)}const[We,pt,kt]=yield Promise.all([et,Pe,yt]),Dt=new G(We),Jt=new T.cn(pt,kt);for(const Xt in fn){const Gt=fn[Xt];Gt instanceof T.a3?(Y(Gt.layers,this.zoom,it),T.co({bucket:Gt,glyphMap:We,glyphPositions:Dt.positions,imageMap:pt,imagePositions:Jt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical,subdivisionGranularity:Wn.subdivisionGranularity})):Gt.hasPattern&&(Gt instanceof T.cp||Gt instanceof T.cq||Gt instanceof T.cr)&&(Y(Gt.layers,this.zoom,it),Gt.addFeatures(Wn,this.tileID.canonical,Jt.patternPositions))}return this.status="done",{buckets:Object.values(fn).filter(Xt=>!Xt.isEmpty()),featureIndex:kn,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Dt.image,imageAtlas:Jt,glyphMap:this.returnDependencies?We:null,iconMap:this.returnDependencies?pt:null,glyphPositions:this.returnDependencies?Dt.positions:null}})}}function Y(bt,Qe,dt){const it=new T.z(Qe);for(const Ut of bt)Ut.recalculate(it,dt)}class ne{constructor(Qe,dt,it){this.actor=Qe,this.layerIndex=dt,this.availableImages=it,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(Qe,dt){return T._(this,void 0,void 0,function*(){const it=yield T.l(Qe.request,dt);try{return{vectorTile:new T.cs.VectorTile(new T.ct(it.data)),rawData:it.data,cacheControl:it.cacheControl,expires:it.expires}}catch(Ut){const on=new Uint8Array(it.data);let un=`Unable to parse the tile at ${Qe.request.url}, `;throw un+=on[0]===31&&on[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Ut.message}`,new Error(un)}})}loadTile(Qe){return T._(this,void 0,void 0,function*(){const dt=Qe.uid,it=!!(Qe&&Qe.request&&Qe.request.collectResourceTiming)&&new T.cu(Qe.request),Ut=new W(Qe);this.loading[dt]=Ut;const on=new AbortController;Ut.abort=on;try{const un=yield this.loadVectorTile(Qe,on);if(delete this.loading[dt],!un)return null;const kn=un.rawData,fn={};un.expires&&(fn.expires=un.expires),un.cacheControl&&(fn.cacheControl=un.cacheControl);const Wn={};if(it){const Sn=it.finish();Sn&&(Wn.resourceTiming=JSON.parse(JSON.stringify(Sn)))}Ut.vectorTile=un.vectorTile;const Gn=Ut.parse(un.vectorTile,this.layerIndex,this.availableImages,this.actor,Qe.subdivisionGranularity);this.loaded[dt]=Ut,this.fetching[dt]={rawTileData:kn,cacheControl:fn,resourceTiming:Wn};try{const Sn=yield Gn;return T.e({rawTileData:kn.slice(0)},Sn,fn,Wn)}finally{delete this.fetching[dt]}}catch(un){throw delete this.loading[dt],Ut.status="done",this.loaded[dt]=Ut,un}})}reloadTile(Qe){return T._(this,void 0,void 0,function*(){const dt=Qe.uid;if(!this.loaded||!this.loaded[dt])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const it=this.loaded[dt];if(it.showCollisionBoxes=Qe.showCollisionBoxes,it.status==="parsing"){const Ut=yield it.parse(it.vectorTile,this.layerIndex,this.availableImages,this.actor,Qe.subdivisionGranularity);let on;if(this.fetching[dt]){const{rawTileData:un,cacheControl:kn,resourceTiming:fn}=this.fetching[dt];delete this.fetching[dt],on=T.e({rawTileData:un.slice(0)},Ut,kn,fn)}else on=Ut;return on}if(it.status==="done"&&it.vectorTile)return it.parse(it.vectorTile,this.layerIndex,this.availableImages,this.actor,Qe.subdivisionGranularity)})}abortTile(Qe){return T._(this,void 0,void 0,function*(){const dt=this.loading,it=Qe.uid;dt&&dt[it]&&dt[it].abort&&(dt[it].abort.abort(),delete dt[it])})}removeTile(Qe){return T._(this,void 0,void 0,function*(){this.loaded&&this.loaded[Qe.uid]&&delete this.loaded[Qe.uid]})}}class J{constructor(){this.loaded={}}loadTile(Qe){return T._(this,void 0,void 0,function*(){const{uid:dt,encoding:it,rawImageData:Ut,redFactor:on,greenFactor:un,blueFactor:kn,baseShift:fn}=Qe,Wn=Ut.width+2,Gn=Ut.height+2,Sn=T.b(Ut)?new T.R({width:Wn,height:Gn},yield T.cv(Ut,-1,-1,Wn,Gn)):Ut,et=new T.cw(dt,Sn,it,on,un,kn,fn);return this.loaded=this.loaded||{},this.loaded[dt]=et,et})}removeTile(Qe){const dt=this.loaded,it=Qe.uid;dt&&dt[it]&&delete dt[it]}}var Q,ce,ie=function(){if(ce)return Q;function bt(dt,it){if(dt.length!==0){Qe(dt[0],it);for(var Ut=1;Ut<dt.length;Ut++)Qe(dt[Ut],!it)}}function Qe(dt,it){for(var Ut=0,on=0,un=0,kn=dt.length,fn=kn-1;un<kn;fn=un++){var Wn=(dt[un][0]-dt[fn][0])*(dt[fn][1]+dt[un][1]),Gn=Ut+Wn;on+=Math.abs(Ut)>=Math.abs(Wn)?Ut-Gn+Wn:Wn-Gn+Ut,Ut=Gn}Ut+on>=0!=!!it&&dt.reverse()}return ce=1,Q=function dt(it,Ut){var on,un=it&&it.type;if(un==="FeatureCollection")for(on=0;on<it.features.length;on++)dt(it.features[on],Ut);else if(un==="GeometryCollection")for(on=0;on<it.geometries.length;on++)dt(it.geometries[on],Ut);else if(un==="Feature")dt(it.geometry,Ut);else if(un==="Polygon")bt(it.coordinates,Ut);else if(un==="MultiPolygon")for(on=0;on<it.coordinates.length;on++)bt(it.coordinates[on],Ut);return it}}(),pe=T.cx(ie);const be=T.cs.VectorTileFeature.prototype.toGeoJSON;class Ie{constructor(Qe){this._feature=Qe,this.extent=T.X,this.type=Qe.type,this.properties=Qe.tags,"id"in Qe&&!isNaN(Qe.id)&&(this.id=parseInt(Qe.id,10))}loadGeometry(){if(this._feature.type===1){const Qe=[];for(const dt of this._feature.geometry)Qe.push([new T.P(dt[0],dt[1])]);return Qe}{const Qe=[];for(const dt of this._feature.geometry){const it=[];for(const Ut of dt)it.push(new T.P(Ut[0],Ut[1]));Qe.push(it)}return Qe}}toGeoJSON(Qe,dt,it){return be.call(this,Qe,dt,it)}}class $e{constructor(Qe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=T.X,this.length=Qe.length,this._features=Qe}feature(Qe){return new Ie(this._features[Qe])}}var Le,Oe,Ve,Ue={exports:{}},qe=function(){if(Ve)return Ue.exports;Ve=1;var bt=T.cA(),Qe=function(){if(Oe)return Le;Oe=1;var Gn=T.cy(),Sn=T.cz().VectorTileFeature;function et(Pe,Ze){this.options=Ze||{},this.features=Pe,this.length=Pe.length}function we(Pe,Ze){this.id=typeof Pe.id=="number"?Pe.id:void 0,this.type=Pe.type,this.rawGeometry=Pe.type===1?[Pe.geometry]:Pe.geometry,this.properties=Pe.tags,this.extent=Ze||4096}return Le=et,et.prototype.feature=function(Pe){return new we(this.features[Pe],this.options.extent)},we.prototype.loadGeometry=function(){var Pe=this.rawGeometry;this.geometry=[];for(var Ze=0;Ze<Pe.length;Ze++){for(var yt=Pe[Ze],We=[],pt=0;pt<yt.length;pt++)We.push(new Gn(yt[pt][0],yt[pt][1]));this.geometry.push(We)}return this.geometry},we.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Pe=this.geometry,Ze=1/0,yt=-1/0,We=1/0,pt=-1/0,kt=0;kt<Pe.length;kt++)for(var Dt=Pe[kt],Jt=0;Jt<Dt.length;Jt++){var Xt=Dt[Jt];Ze=Math.min(Ze,Xt.x),yt=Math.max(yt,Xt.x),We=Math.min(We,Xt.y),pt=Math.max(pt,Xt.y)}return[Ze,We,yt,pt]},we.prototype.toGeoJSON=Sn.prototype.toGeoJSON,Le}();function dt(Gn){var Sn=new bt;return function(et,we){for(var Pe in et.layers)we.writeMessage(3,it,et.layers[Pe])}(Gn,Sn),Sn.finish()}function it(Gn,Sn){var et;Sn.writeVarintField(15,Gn.version||1),Sn.writeStringField(1,Gn.name||""),Sn.writeVarintField(5,Gn.extent||4096);var we={keys:[],values:[],keycache:{},valuecache:{}};for(et=0;et<Gn.length;et++)we.feature=Gn.feature(et),Sn.writeMessage(2,Ut,we);var Pe=we.keys;for(et=0;et<Pe.length;et++)Sn.writeStringField(3,Pe[et]);var Ze=we.values;for(et=0;et<Ze.length;et++)Sn.writeMessage(4,Wn,Ze[et])}function Ut(Gn,Sn){var et=Gn.feature;et.id!==void 0&&Sn.writeVarintField(1,et.id),Sn.writeMessage(2,on,Gn),Sn.writeVarintField(3,et.type),Sn.writeMessage(4,fn,et)}function on(Gn,Sn){var et=Gn.feature,we=Gn.keys,Pe=Gn.values,Ze=Gn.keycache,yt=Gn.valuecache;for(var We in et.properties){var pt=et.properties[We],kt=Ze[We];if(pt!==null){kt===void 0&&(we.push(We),Ze[We]=kt=we.length-1),Sn.writeVarint(kt);var Dt=typeof pt;Dt!=="string"&&Dt!=="boolean"&&Dt!=="number"&&(pt=JSON.stringify(pt));var Jt=Dt+":"+pt,Xt=yt[Jt];Xt===void 0&&(Pe.push(pt),yt[Jt]=Xt=Pe.length-1),Sn.writeVarint(Xt)}}}function un(Gn,Sn){return(Sn<<3)+(7&Gn)}function kn(Gn){return Gn<<1^Gn>>31}function fn(Gn,Sn){for(var et=Gn.loadGeometry(),we=Gn.type,Pe=0,Ze=0,yt=et.length,We=0;We<yt;We++){var pt=et[We],kt=1;we===1&&(kt=pt.length),Sn.writeVarint(un(1,kt));for(var Dt=we===3?pt.length-1:pt.length,Jt=0;Jt<Dt;Jt++){Jt===1&&we!==1&&Sn.writeVarint(un(2,Dt-1));var Xt=pt[Jt].x-Pe,Gt=pt[Jt].y-Ze;Sn.writeVarint(kn(Xt)),Sn.writeVarint(kn(Gt)),Pe+=Xt,Ze+=Gt}we===3&&Sn.writeVarint(un(7,1))}}function Wn(Gn,Sn){var et=typeof Gn;et==="string"?Sn.writeStringField(1,Gn):et==="boolean"?Sn.writeBooleanField(7,Gn):et==="number"&&(Gn%1!=0?Sn.writeDoubleField(3,Gn):Gn<0?Sn.writeSVarintField(6,Gn):Sn.writeVarintField(5,Gn))}return Ue.exports=dt,Ue.exports.fromVectorTileJs=dt,Ue.exports.fromGeojsonVt=function(Gn,Sn){Sn=Sn||{};var et={};for(var we in Gn)et[we]=new Qe(Gn[we].features,Sn),et[we].name=we,et[we].version=Sn.version,et[we].extent=Sn.extent;return dt({layers:et})},Ue.exports.GeoJSONWrapper=Qe,Ue.exports}(),He=T.cx(qe);const nt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:bt=>bt},rt=Math.fround||(ft=new Float32Array(1),bt=>(ft[0]=+bt,ft[0]));var ft;const $t=3,hn=5,gn=6;class pn{constructor(Qe){this.options=Object.assign(Object.create(nt),Qe),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(Qe){const{log:dt,minZoom:it,maxZoom:Ut}=this.options;dt&&console.time("total time");const on=`prepare ${Qe.length} points`;dt&&console.time(on),this.points=Qe;const un=[];for(let fn=0;fn<Qe.length;fn++){const Wn=Qe[fn];if(!Wn.geometry)continue;const[Gn,Sn]=Wn.geometry.coordinates,et=rt(_n(Gn)),we=rt(Bn(Sn));un.push(et,we,1/0,fn,-1,1),this.options.reduce&&un.push(0)}let kn=this.trees[Ut+1]=this._createTree(un);dt&&console.timeEnd(on);for(let fn=Ut;fn>=it;fn--){const Wn=+Date.now();kn=this.trees[fn]=this._createTree(this._cluster(kn,fn)),dt&&console.log("z%d: %d clusters in %dms",fn,kn.numItems,+Date.now()-Wn)}return dt&&console.timeEnd("total time"),this}getClusters(Qe,dt){let it=((Qe[0]+180)%360+360)%360-180;const Ut=Math.max(-90,Math.min(90,Qe[1]));let on=Qe[2]===180?180:((Qe[2]+180)%360+360)%360-180;const un=Math.max(-90,Math.min(90,Qe[3]));if(Qe[2]-Qe[0]>=360)it=-180,on=180;else if(it>on){const Sn=this.getClusters([it,Ut,180,un],dt),et=this.getClusters([-180,Ut,on,un],dt);return Sn.concat(et)}const kn=this.trees[this._limitZoom(dt)],fn=kn.range(_n(it),Bn(un),_n(on),Bn(Ut)),Wn=kn.data,Gn=[];for(const Sn of fn){const et=this.stride*Sn;Gn.push(Wn[et+hn]>1?ri(Wn,et,this.clusterProps):this.points[Wn[et+$t]])}return Gn}getChildren(Qe){const dt=this._getOriginId(Qe),it=this._getOriginZoom(Qe),Ut="No cluster with the specified id.",on=this.trees[it];if(!on)throw new Error(Ut);const un=on.data;if(dt*this.stride>=un.length)throw new Error(Ut);const kn=this.options.radius/(this.options.extent*Math.pow(2,it-1)),fn=on.within(un[dt*this.stride],un[dt*this.stride+1],kn),Wn=[];for(const Gn of fn){const Sn=Gn*this.stride;un[Sn+4]===Qe&&Wn.push(un[Sn+hn]>1?ri(un,Sn,this.clusterProps):this.points[un[Sn+$t]])}if(Wn.length===0)throw new Error(Ut);return Wn}getLeaves(Qe,dt,it){const Ut=[];return this._appendLeaves(Ut,Qe,dt=dt||10,it=it||0,0),Ut}getTile(Qe,dt,it){const Ut=this.trees[this._limitZoom(Qe)],on=Math.pow(2,Qe),{extent:un,radius:kn}=this.options,fn=kn/un,Wn=(it-fn)/on,Gn=(it+1+fn)/on,Sn={features:[]};return this._addTileFeatures(Ut.range((dt-fn)/on,Wn,(dt+1+fn)/on,Gn),Ut.data,dt,it,on,Sn),dt===0&&this._addTileFeatures(Ut.range(1-fn/on,Wn,1,Gn),Ut.data,on,it,on,Sn),dt===on-1&&this._addTileFeatures(Ut.range(0,Wn,fn/on,Gn),Ut.data,-1,it,on,Sn),Sn.features.length?Sn:null}getClusterExpansionZoom(Qe){let dt=this._getOriginZoom(Qe)-1;for(;dt<=this.options.maxZoom;){const it=this.getChildren(Qe);if(dt++,it.length!==1)break;Qe=it[0].properties.cluster_id}return dt}_appendLeaves(Qe,dt,it,Ut,on){const un=this.getChildren(dt);for(const kn of un){const fn=kn.properties;if(fn&&fn.cluster?on+fn.point_count<=Ut?on+=fn.point_count:on=this._appendLeaves(Qe,fn.cluster_id,it,Ut,on):on<Ut?on++:Qe.push(kn),Qe.length===it)break}return on}_createTree(Qe){const dt=new T.az(Qe.length/this.stride|0,this.options.nodeSize,Float32Array);for(let it=0;it<Qe.length;it+=this.stride)dt.add(Qe[it],Qe[it+1]);return dt.finish(),dt.data=Qe,dt}_addTileFeatures(Qe,dt,it,Ut,on,un){for(const kn of Qe){const fn=kn*this.stride,Wn=dt[fn+hn]>1;let Gn,Sn,et;if(Wn)Gn=ai(dt,fn,this.clusterProps),Sn=dt[fn],et=dt[fn+1];else{const Ze=this.points[dt[fn+$t]];Gn=Ze.properties;const[yt,We]=Ze.geometry.coordinates;Sn=_n(yt),et=Bn(We)}const we={type:1,geometry:[[Math.round(this.options.extent*(Sn*on-it)),Math.round(this.options.extent*(et*on-Ut))]],tags:Gn};let Pe;Pe=Wn||this.options.generateId?dt[fn+$t]:this.points[dt[fn+$t]].id,Pe!==void 0&&(we.id=Pe),un.features.push(we)}}_limitZoom(Qe){return Math.max(this.options.minZoom,Math.min(Math.floor(+Qe),this.options.maxZoom+1))}_cluster(Qe,dt){const{radius:it,extent:Ut,reduce:on,minPoints:un}=this.options,kn=it/(Ut*Math.pow(2,dt)),fn=Qe.data,Wn=[],Gn=this.stride;for(let Sn=0;Sn<fn.length;Sn+=Gn){if(fn[Sn+2]<=dt)continue;fn[Sn+2]=dt;const et=fn[Sn],we=fn[Sn+1],Pe=Qe.within(fn[Sn],fn[Sn+1],kn),Ze=fn[Sn+hn];let yt=Ze;for(const We of Pe){const pt=We*Gn;fn[pt+2]>dt&&(yt+=fn[pt+hn])}if(yt>Ze&&yt>=un){let We,pt=et*Ze,kt=we*Ze,Dt=-1;const Jt=((Sn/Gn|0)<<5)+(dt+1)+this.points.length;for(const Xt of Pe){const Gt=Xt*Gn;if(fn[Gt+2]<=dt)continue;fn[Gt+2]=dt;const On=fn[Gt+hn];pt+=fn[Gt]*On,kt+=fn[Gt+1]*On,fn[Gt+4]=Jt,on&&(We||(We=this._map(fn,Sn,!0),Dt=this.clusterProps.length,this.clusterProps.push(We)),on(We,this._map(fn,Gt)))}fn[Sn+4]=Jt,Wn.push(pt/yt,kt/yt,1/0,Jt,-1,yt),on&&Wn.push(Dt)}else{for(let We=0;We<Gn;We++)Wn.push(fn[Sn+We]);if(yt>1)for(const We of Pe){const pt=We*Gn;if(!(fn[pt+2]<=dt)){fn[pt+2]=dt;for(let kt=0;kt<Gn;kt++)Wn.push(fn[pt+kt])}}}}return Wn}_getOriginId(Qe){return Qe-this.points.length>>5}_getOriginZoom(Qe){return(Qe-this.points.length)%32}_map(Qe,dt,it){if(Qe[dt+hn]>1){const un=this.clusterProps[Qe[dt+gn]];return it?Object.assign({},un):un}const Ut=this.points[Qe[dt+$t]].properties,on=this.options.map(Ut);return it&&on===Ut?Object.assign({},on):on}}function ri(bt,Qe,dt){return{type:"Feature",id:bt[Qe+$t],properties:ai(bt,Qe,dt),geometry:{type:"Point",coordinates:[(it=bt[Qe],360*(it-.5)),mn(bt[Qe+1])]}};var it}function ai(bt,Qe,dt){const it=bt[Qe+hn],Ut=it>=1e4?`${Math.round(it/1e3)}k`:it>=1e3?Math.round(it/100)/10+"k":it,on=bt[Qe+gn],un=on===-1?{}:Object.assign({},dt[on]);return Object.assign(un,{cluster:!0,cluster_id:bt[Qe+$t],point_count:it,point_count_abbreviated:Ut})}function _n(bt){return bt/360+.5}function Bn(bt){const Qe=Math.sin(bt*Math.PI/180),dt=.5-.25*Math.log((1+Qe)/(1-Qe))/Math.PI;return dt<0?0:dt>1?1:dt}function mn(bt){const Qe=(180-360*bt)*Math.PI/180;return 360*Math.atan(Math.exp(Qe))/Math.PI-90}function Nn(bt,Qe,dt,it){let Ut=it;const on=Qe+(dt-Qe>>1);let un,kn=dt-Qe;const fn=bt[Qe],Wn=bt[Qe+1],Gn=bt[dt],Sn=bt[dt+1];for(let et=Qe+3;et<dt;et+=3){const we=Pn(bt[et],bt[et+1],fn,Wn,Gn,Sn);if(we>Ut)un=et,Ut=we;else if(we===Ut){const Pe=Math.abs(et-on);Pe<kn&&(un=et,kn=Pe)}}Ut>it&&(un-Qe>3&&Nn(bt,Qe,un,it),bt[un+2]=Ut,dt-un>3&&Nn(bt,un,dt,it))}function Pn(bt,Qe,dt,it,Ut,on){let un=Ut-dt,kn=on-it;if(un!==0||kn!==0){const fn=((bt-dt)*un+(Qe-it)*kn)/(un*un+kn*kn);fn>1?(dt=Ut,it=on):fn>0&&(dt+=un*fn,it+=kn*fn)}return un=bt-dt,kn=Qe-it,un*un+kn*kn}function Ci(bt,Qe,dt,it){const Ut={id:bt??null,type:Qe,geometry:dt,tags:it,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(Qe==="Point"||Qe==="MultiPoint"||Qe==="LineString")Fi(Ut,dt);else if(Qe==="Polygon")Fi(Ut,dt[0]);else if(Qe==="MultiLineString")for(const on of dt)Fi(Ut,on);else if(Qe==="MultiPolygon")for(const on of dt)Fi(Ut,on[0]);return Ut}function Fi(bt,Qe){for(let dt=0;dt<Qe.length;dt+=3)bt.minX=Math.min(bt.minX,Qe[dt]),bt.minY=Math.min(bt.minY,Qe[dt+1]),bt.maxX=Math.max(bt.maxX,Qe[dt]),bt.maxY=Math.max(bt.maxY,Qe[dt+1])}function Ln(bt,Qe,dt,it){if(!Qe.geometry)return;const Ut=Qe.geometry.coordinates;if(Ut&&Ut.length===0)return;const on=Qe.geometry.type,un=Math.pow(dt.tolerance/((1<<dt.maxZoom)*dt.extent),2);let kn=[],fn=Qe.id;if(dt.promoteId?fn=Qe.properties[dt.promoteId]:dt.generateId&&(fn=it||0),on==="Point")sn(Ut,kn);else if(on==="MultiPoint")for(const Wn of Ut)sn(Wn,kn);else if(on==="LineString")qn(Ut,kn,un,!1);else if(on==="MultiLineString"){if(dt.lineMetrics){for(const Wn of Ut)kn=[],qn(Wn,kn,un,!1),bt.push(Ci(fn,"LineString",kn,Qe.properties));return}pi(Ut,kn,un,!1)}else if(on==="Polygon")pi(Ut,kn,un,!0);else{if(on!=="MultiPolygon"){if(on==="GeometryCollection"){for(const Wn of Qe.geometry.geometries)Ln(bt,{id:fn,geometry:Wn,properties:Qe.properties},dt,it);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Wn of Ut){const Gn=[];pi(Wn,Gn,un,!0),kn.push(Gn)}}bt.push(Ci(fn,on,kn,Qe.properties))}function sn(bt,Qe){Qe.push(ht(bt[0]),Zn(bt[1]),0)}function qn(bt,Qe,dt,it){let Ut,on,un=0;for(let fn=0;fn<bt.length;fn++){const Wn=ht(bt[fn][0]),Gn=Zn(bt[fn][1]);Qe.push(Wn,Gn,0),fn>0&&(un+=it?(Ut*Gn-Wn*on)/2:Math.sqrt(Math.pow(Wn-Ut,2)+Math.pow(Gn-on,2))),Ut=Wn,on=Gn}const kn=Qe.length-3;Qe[2]=1,Nn(Qe,0,kn,dt),Qe[kn+2]=1,Qe.size=Math.abs(un),Qe.start=0,Qe.end=Qe.size}function pi(bt,Qe,dt,it){for(let Ut=0;Ut<bt.length;Ut++){const on=[];qn(bt[Ut],on,dt,it),Qe.push(on)}}function ht(bt){return bt/360+.5}function Zn(bt){const Qe=Math.sin(bt*Math.PI/180),dt=.5-.25*Math.log((1+Qe)/(1-Qe))/Math.PI;return dt<0?0:dt>1?1:dt}function St(bt,Qe,dt,it,Ut,on,un,kn){if(it/=Qe,on>=(dt/=Qe)&&un<it)return bt;if(un<dt||on>=it)return null;const fn=[];for(const Wn of bt){const Gn=Wn.geometry;let Sn=Wn.type;const et=Ut===0?Wn.minX:Wn.minY,we=Ut===0?Wn.maxX:Wn.maxY;if(et>=dt&&we<it){fn.push(Wn);continue}if(we<dt||et>=it)continue;let Pe=[];if(Sn==="Point"||Sn==="MultiPoint")mt(Gn,Pe,dt,it,Ut);else if(Sn==="LineString")at(Gn,Pe,dt,it,Ut,!1,kn.lineMetrics);else if(Sn==="MultiLineString")bn(Gn,Pe,dt,it,Ut,!1);else if(Sn==="Polygon")bn(Gn,Pe,dt,it,Ut,!0);else if(Sn==="MultiPolygon")for(const Ze of Gn){const yt=[];bn(Ze,yt,dt,it,Ut,!0),yt.length&&Pe.push(yt)}if(Pe.length){if(kn.lineMetrics&&Sn==="LineString"){for(const Ze of Pe)fn.push(Ci(Wn.id,Sn,Ze,Wn.tags));continue}Sn!=="LineString"&&Sn!=="MultiLineString"||(Pe.length===1?(Sn="LineString",Pe=Pe[0]):Sn="MultiLineString"),Sn!=="Point"&&Sn!=="MultiPoint"||(Sn=Pe.length===3?"Point":"MultiPoint"),fn.push(Ci(Wn.id,Sn,Pe,Wn.tags))}}return fn.length?fn:null}function mt(bt,Qe,dt,it,Ut){for(let on=0;on<bt.length;on+=3){const un=bt[on+Ut];un>=dt&&un<=it&&Cn(Qe,bt[on],bt[on+1],bt[on+2])}}function at(bt,Qe,dt,it,Ut,on,un){let kn=Tn(bt);const fn=Ut===0?zn:vi;let Wn,Gn,Sn=bt.start;for(let yt=0;yt<bt.length-3;yt+=3){const We=bt[yt],pt=bt[yt+1],kt=bt[yt+2],Dt=bt[yt+3],Jt=bt[yt+4],Xt=Ut===0?We:pt,Gt=Ut===0?Dt:Jt;let On=!1;un&&(Wn=Math.sqrt(Math.pow(We-Dt,2)+Math.pow(pt-Jt,2))),Xt<dt?Gt>dt&&(Gn=fn(kn,We,pt,Dt,Jt,dt),un&&(kn.start=Sn+Wn*Gn)):Xt>it?Gt<it&&(Gn=fn(kn,We,pt,Dt,Jt,it),un&&(kn.start=Sn+Wn*Gn)):Cn(kn,We,pt,kt),Gt<dt&&Xt>=dt&&(Gn=fn(kn,We,pt,Dt,Jt,dt),On=!0),Gt>it&&Xt<=it&&(Gn=fn(kn,We,pt,Dt,Jt,it),On=!0),!on&&On&&(un&&(kn.end=Sn+Wn*Gn),Qe.push(kn),kn=Tn(bt)),un&&(Sn+=Wn)}let et=bt.length-3;const we=bt[et],Pe=bt[et+1],Ze=Ut===0?we:Pe;Ze>=dt&&Ze<=it&&Cn(kn,we,Pe,bt[et+2]),et=kn.length-3,on&&et>=3&&(kn[et]!==kn[0]||kn[et+1]!==kn[1])&&Cn(kn,kn[0],kn[1],kn[2]),kn.length&&Qe.push(kn)}function Tn(bt){const Qe=[];return Qe.size=bt.size,Qe.start=bt.start,Qe.end=bt.end,Qe}function bn(bt,Qe,dt,it,Ut,on){for(const un of bt)at(un,Qe,dt,it,Ut,on,!1)}function Cn(bt,Qe,dt,it){bt.push(Qe,dt,it)}function zn(bt,Qe,dt,it,Ut,on){const un=(on-Qe)/(it-Qe);return Cn(bt,on,dt+(Ut-dt)*un,1),un}function vi(bt,Qe,dt,it,Ut,on){const un=(on-dt)/(Ut-dt);return Cn(bt,Qe+(it-Qe)*un,on,1),un}function ii(bt,Qe){const dt=[];for(let it=0;it<bt.length;it++){const Ut=bt[it],on=Ut.type;let un;if(on==="Point"||on==="MultiPoint"||on==="LineString")un=wi(Ut.geometry,Qe);else if(on==="MultiLineString"||on==="Polygon"){un=[];for(const kn of Ut.geometry)un.push(wi(kn,Qe))}else if(on==="MultiPolygon"){un=[];for(const kn of Ut.geometry){const fn=[];for(const Wn of kn)fn.push(wi(Wn,Qe));un.push(fn)}}dt.push(Ci(Ut.id,on,un,Ut.tags))}return dt}function wi(bt,Qe){const dt=[];dt.size=bt.size,bt.start!==void 0&&(dt.start=bt.start,dt.end=bt.end);for(let it=0;it<bt.length;it+=3)dt.push(bt[it]+Qe,bt[it+1],bt[it+2]);return dt}function Ki(bt,Qe){if(bt.transformed)return bt;const dt=1<<bt.z,it=bt.x,Ut=bt.y;for(const on of bt.features){const un=on.geometry,kn=on.type;if(on.geometry=[],kn===1)for(let fn=0;fn<un.length;fn+=2)on.geometry.push(Vi(un[fn],un[fn+1],Qe,dt,it,Ut));else for(let fn=0;fn<un.length;fn++){const Wn=[];for(let Gn=0;Gn<un[fn].length;Gn+=2)Wn.push(Vi(un[fn][Gn],un[fn][Gn+1],Qe,dt,it,Ut));on.geometry.push(Wn)}}return bt.transformed=!0,bt}function Vi(bt,Qe,dt,it,Ut,on){return[Math.round(dt*(bt*it-Ut)),Math.round(dt*(Qe*it-on))]}function ui(bt,Qe,dt,it,Ut){const on=Qe===Ut.maxZoom?0:Ut.tolerance/((1<<Qe)*Ut.extent),un={features:[],numPoints:0,numSimplified:0,numFeatures:bt.length,source:null,x:dt,y:it,z:Qe,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const kn of bt)pr(un,kn,on,Ut);return un}function pr(bt,Qe,dt,it){const Ut=Qe.geometry,on=Qe.type,un=[];if(bt.minX=Math.min(bt.minX,Qe.minX),bt.minY=Math.min(bt.minY,Qe.minY),bt.maxX=Math.max(bt.maxX,Qe.maxX),bt.maxY=Math.max(bt.maxY,Qe.maxY),on==="Point"||on==="MultiPoint")for(let kn=0;kn<Ut.length;kn+=3)un.push(Ut[kn],Ut[kn+1]),bt.numPoints++,bt.numSimplified++;else if(on==="LineString")Er(un,Ut,bt,dt,!1,!1);else if(on==="MultiLineString"||on==="Polygon")for(let kn=0;kn<Ut.length;kn++)Er(un,Ut[kn],bt,dt,on==="Polygon",kn===0);else if(on==="MultiPolygon")for(let kn=0;kn<Ut.length;kn++){const fn=Ut[kn];for(let Wn=0;Wn<fn.length;Wn++)Er(un,fn[Wn],bt,dt,!0,Wn===0)}if(un.length){let kn=Qe.tags||null;if(on==="LineString"&&it.lineMetrics){kn={};for(const Wn in Qe.tags)kn[Wn]=Qe.tags[Wn];kn.mapbox_clip_start=Ut.start/Ut.size,kn.mapbox_clip_end=Ut.end/Ut.size}const fn={geometry:un,type:on==="Polygon"||on==="MultiPolygon"?3:on==="LineString"||on==="MultiLineString"?2:1,tags:kn};Qe.id!==null&&(fn.id=Qe.id),bt.features.push(fn)}}function Er(bt,Qe,dt,it,Ut,on){const un=it*it;if(it>0&&Qe.size<(Ut?un:it))return void(dt.numPoints+=Qe.length/3);const kn=[];for(let fn=0;fn<Qe.length;fn+=3)(it===0||Qe[fn+2]>un)&&(dt.numSimplified++,kn.push(Qe[fn],Qe[fn+1])),dt.numPoints++;Ut&&function(fn,Wn){let Gn=0;for(let Sn=0,et=fn.length,we=et-2;Sn<et;we=Sn,Sn+=2)Gn+=(fn[Sn]-fn[we])*(fn[Sn+1]+fn[we+1]);if(Gn>0===Wn)for(let Sn=0,et=fn.length;Sn<et/2;Sn+=2){const we=fn[Sn],Pe=fn[Sn+1];fn[Sn]=fn[et-2-Sn],fn[Sn+1]=fn[et-1-Sn],fn[et-2-Sn]=we,fn[et-1-Sn]=Pe}}(kn,on),bt.push(kn)}const sa={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ar{constructor(Qe,dt){const it=(dt=this.options=function(on,un){for(const kn in un)on[kn]=un[kn];return on}(Object.create(sa),dt)).debug;if(it&&console.time("preprocess data"),dt.maxZoom<0||dt.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(dt.promoteId&&dt.generateId)throw new Error("promoteId and generateId cannot be used together.");let Ut=function(on,un){const kn=[];if(on.type==="FeatureCollection")for(let fn=0;fn<on.features.length;fn++)Ln(kn,on.features[fn],un,fn);else Ln(kn,on.type==="Feature"?on:{geometry:on},un);return kn}(Qe,dt);this.tiles={},this.tileCoords=[],it&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",dt.indexMaxZoom,dt.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ut=function(on,un){const kn=un.buffer/un.extent;let fn=on;const Wn=St(on,1,-1-kn,kn,0,-1,2,un),Gn=St(on,1,1-kn,2+kn,0,-1,2,un);return(Wn||Gn)&&(fn=St(on,1,-kn,1+kn,0,-1,2,un)||[],Wn&&(fn=ii(Wn,1).concat(fn)),Gn&&(fn=fn.concat(ii(Gn,-1)))),fn}(Ut,dt),Ut.length&&this.splitTile(Ut,0,0,0),it&&(Ut.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(Qe,dt,it,Ut,on,un,kn){const fn=[Qe,dt,it,Ut],Wn=this.options,Gn=Wn.debug;for(;fn.length;){Ut=fn.pop(),it=fn.pop(),dt=fn.pop(),Qe=fn.pop();const Sn=1<<dt,et=Ta(dt,it,Ut);let we=this.tiles[et];if(!we&&(Gn>1&&console.time("creation"),we=this.tiles[et]=ui(Qe,dt,it,Ut,Wn),this.tileCoords.push({z:dt,x:it,y:Ut}),Gn)){Gn>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",dt,it,Ut,we.numFeatures,we.numPoints,we.numSimplified),console.timeEnd("creation"));const On=`z${dt}`;this.stats[On]=(this.stats[On]||0)+1,this.total++}if(we.source=Qe,on==null){if(dt===Wn.indexMaxZoom||we.numPoints<=Wn.indexMaxPoints)continue}else{if(dt===Wn.maxZoom||dt===on)continue;if(on!=null){const On=on-dt;if(it!==un>>On||Ut!==kn>>On)continue}}if(we.source=null,Qe.length===0)continue;Gn>1&&console.time("clipping");const Pe=.5*Wn.buffer/Wn.extent,Ze=.5-Pe,yt=.5+Pe,We=1+Pe;let pt=null,kt=null,Dt=null,Jt=null,Xt=St(Qe,Sn,it-Pe,it+yt,0,we.minX,we.maxX,Wn),Gt=St(Qe,Sn,it+Ze,it+We,0,we.minX,we.maxX,Wn);Qe=null,Xt&&(pt=St(Xt,Sn,Ut-Pe,Ut+yt,1,we.minY,we.maxY,Wn),kt=St(Xt,Sn,Ut+Ze,Ut+We,1,we.minY,we.maxY,Wn),Xt=null),Gt&&(Dt=St(Gt,Sn,Ut-Pe,Ut+yt,1,we.minY,we.maxY,Wn),Jt=St(Gt,Sn,Ut+Ze,Ut+We,1,we.minY,we.maxY,Wn),Gt=null),Gn>1&&console.timeEnd("clipping"),fn.push(pt||[],dt+1,2*it,2*Ut),fn.push(kt||[],dt+1,2*it,2*Ut+1),fn.push(Dt||[],dt+1,2*it+1,2*Ut),fn.push(Jt||[],dt+1,2*it+1,2*Ut+1)}}getTile(Qe,dt,it){Qe=+Qe,dt=+dt,it=+it;const Ut=this.options,{extent:on,debug:un}=Ut;if(Qe<0||Qe>24)return null;const kn=1<<Qe,fn=Ta(Qe,dt=dt+kn&kn-1,it);if(this.tiles[fn])return Ki(this.tiles[fn],on);un>1&&console.log("drilling down to z%d-%d-%d",Qe,dt,it);let Wn,Gn=Qe,Sn=dt,et=it;for(;!Wn&&Gn>0;)Gn--,Sn>>=1,et>>=1,Wn=this.tiles[Ta(Gn,Sn,et)];return Wn&&Wn.source?(un>1&&(console.log("found parent tile z%d-%d-%d",Gn,Sn,et),console.time("drilling down")),this.splitTile(Wn.source,Gn,Sn,et,Qe,dt,it),un>1&&console.timeEnd("drilling down"),this.tiles[fn]?Ki(this.tiles[fn],on):null):null}}function Ta(bt,Qe,dt){return 32*((1<<bt)*dt+Qe)+bt}function Qa(bt,Qe){return Qe?bt.properties[Qe]:bt.id}function Os(bt,Qe){if(bt==null)return!0;if(bt.type==="Feature")return Qa(bt,Qe)!=null;if(bt.type==="FeatureCollection"){const dt=new Set;for(const it of bt.features){const Ut=Qa(it,Qe);if(Ut==null||dt.has(Ut))return!1;dt.add(Ut)}return!0}return!1}function As(bt,Qe){const dt=new Map;if(bt!=null)if(bt.type==="Feature")dt.set(Qa(bt,Qe),bt);else for(const it of bt.features)dt.set(Qa(it,Qe),it);return dt}class to extends ne{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(Qe,dt){return T._(this,void 0,void 0,function*(){const it=Qe.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Ut=this._geoJSONIndex.getTile(it.z,it.x,it.y);if(!Ut)return null;const on=new $e(Ut.features);let un=He(on);return un.byteOffset===0&&un.byteLength===un.buffer.byteLength||(un=new Uint8Array(un)),{vectorTile:on,rawData:un.buffer}})}loadData(Qe){return T._(this,void 0,void 0,function*(){var dt;(dt=this._pendingRequest)===null||dt===void 0||dt.abort();const it=!!(Qe&&Qe.request&&Qe.request.collectResourceTiming)&&new T.cu(Qe.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(Qe,this._pendingRequest),this._geoJSONIndex=Qe.cluster?new pn(function({superclusterOptions:un,clusterProperties:kn}){if(!kn||!un)return un;const fn={},Wn={},Gn={accumulated:null,zoom:0},Sn={properties:null},et=Object.keys(kn);for(const we of et){const[Pe,Ze]=kn[we],yt=T.cB(Ze),We=T.cB(typeof Pe=="string"?[Pe,["accumulated"],["get",we]]:Pe);fn[we]=yt.value,Wn[we]=We.value}return un.map=we=>{Sn.properties=we;const Pe={};for(const Ze of et)Pe[Ze]=fn[Ze].evaluate(Gn,Sn);return Pe},un.reduce=(we,Pe)=>{Sn.properties=Pe;for(const Ze of et)Gn.accumulated=we[Ze],we[Ze]=Wn[Ze].evaluate(Gn,Sn)},un}(Qe)).load((yield this._pendingData).features):(Ut=yield this._pendingData,new Ar(Ut,Qe.geojsonVtOptions)),this.loaded={};const on={};if(it){const un=it.finish();un&&(on.resourceTiming={},on.resourceTiming[Qe.source]=JSON.parse(JSON.stringify(un)))}return on}catch(on){if(delete this._pendingRequest,T.cf(on))return{abandoned:!0};throw on}var Ut})}getData(){return T._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(Qe){const dt=this.loaded;return dt&&dt[Qe.uid]?super.reloadTile(Qe):this.loadTile(Qe)}loadAndProcessGeoJSON(Qe,dt){return T._(this,void 0,void 0,function*(){let it=yield this.loadGeoJSON(Qe,dt);if(delete this._pendingRequest,typeof it!="object")throw new Error(`Input data given to '${Qe.source}' is not a valid GeoJSON object.`);if(pe(it,!0),Qe.filter){const Ut=T.cB(Qe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ut.result==="error")throw new Error(Ut.value.map(un=>`${un.key}: ${un.message}`).join(", "));it={type:"FeatureCollection",features:it.features.filter(un=>Ut.value.evaluate({zoom:0},un))}}return it})}loadGeoJSON(Qe,dt){return T._(this,void 0,void 0,function*(){const{promoteId:it}=Qe;if(Qe.request){const Ut=yield T.h(Qe.request,dt);return this._dataUpdateable=Os(Ut.data,it)?As(Ut.data,it):void 0,Ut.data}if(typeof Qe.data=="string")try{const Ut=JSON.parse(Qe.data);return this._dataUpdateable=Os(Ut,it)?As(Ut,it):void 0,Ut}catch{throw new Error(`Input data given to '${Qe.source}' is not a valid GeoJSON object.`)}if(!Qe.dataDiff)throw new Error(`Input data given to '${Qe.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${Qe.source}`);return function(Ut,on,un){var kn,fn,Wn,Gn;if(on.removeAll&&Ut.clear(),on.remove)for(const Sn of on.remove)Ut.delete(Sn);if(on.add)for(const Sn of on.add){const et=Qa(Sn,un);et!=null&&Ut.set(et,Sn)}if(on.update)for(const Sn of on.update){let et=Ut.get(Sn.id);if(et==null)continue;const we=!Sn.removeAllProperties&&(((kn=Sn.removeProperties)===null||kn===void 0?void 0:kn.length)>0||((fn=Sn.addOrUpdateProperties)===null||fn===void 0?void 0:fn.length)>0);if((Sn.newGeometry||Sn.removeAllProperties||we)&&(et=Object.assign({},et),Ut.set(Sn.id,et),we&&(et.properties=Object.assign({},et.properties))),Sn.newGeometry&&(et.geometry=Sn.newGeometry),Sn.removeAllProperties)et.properties={};else if(((Wn=Sn.removeProperties)===null||Wn===void 0?void 0:Wn.length)>0)for(const Pe of Sn.removeProperties)Object.prototype.hasOwnProperty.call(et.properties,Pe)&&delete et.properties[Pe];if(((Gn=Sn.addOrUpdateProperties)===null||Gn===void 0?void 0:Gn.length)>0)for(const{key:Pe,value:Ze}of Sn.addOrUpdateProperties)et.properties[Pe]=Ze}}(this._dataUpdateable,Qe.dataDiff,it),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(Qe){return T._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(Qe){return this._geoJSONIndex.getClusterExpansionZoom(Qe.clusterId)}getClusterChildren(Qe){return this._geoJSONIndex.getChildren(Qe.clusterId)}getClusterLeaves(Qe){return this._geoJSONIndex.getLeaves(Qe.clusterId,Qe.limit,Qe.offset)}}class ko{constructor(Qe){this.self=Qe,this.actor=new T.F(Qe),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(dt,it)=>{if(this.externalWorkerSourceTypes[dt])throw new Error(`Worker source with name "${dt}" already registered.`);this.externalWorkerSourceTypes[dt]=it},this.self.addProtocol=T.ch,this.self.removeProtocol=T.ci,this.self.registerRTLTextPlugin=dt=>{T.cC.setMethods(dt)},this.actor.registerMessageHandler("LDT",(dt,it)=>this._getDEMWorkerSource(dt,it.source).loadTile(it)),this.actor.registerMessageHandler("RDT",(dt,it)=>T._(this,void 0,void 0,function*(){this._getDEMWorkerSource(dt,it.source).removeTile(it)})),this.actor.registerMessageHandler("GCEZ",(dt,it)=>T._(this,void 0,void 0,function*(){return this._getWorkerSource(dt,it.type,it.source).getClusterExpansionZoom(it)})),this.actor.registerMessageHandler("GCC",(dt,it)=>T._(this,void 0,void 0,function*(){return this._getWorkerSource(dt,it.type,it.source).getClusterChildren(it)})),this.actor.registerMessageHandler("GCL",(dt,it)=>T._(this,void 0,void 0,function*(){return this._getWorkerSource(dt,it.type,it.source).getClusterLeaves(it)})),this.actor.registerMessageHandler("LD",(dt,it)=>this._getWorkerSource(dt,it.type,it.source).loadData(it)),this.actor.registerMessageHandler("GD",(dt,it)=>this._getWorkerSource(dt,it.type,it.source).getData()),this.actor.registerMessageHandler("LT",(dt,it)=>this._getWorkerSource(dt,it.type,it.source).loadTile(it)),this.actor.registerMessageHandler("RT",(dt,it)=>this._getWorkerSource(dt,it.type,it.source).reloadTile(it)),this.actor.registerMessageHandler("AT",(dt,it)=>this._getWorkerSource(dt,it.type,it.source).abortTile(it)),this.actor.registerMessageHandler("RMT",(dt,it)=>this._getWorkerSource(dt,it.type,it.source).removeTile(it)),this.actor.registerMessageHandler("RS",(dt,it)=>T._(this,void 0,void 0,function*(){if(!this.workerSources[dt]||!this.workerSources[dt][it.type]||!this.workerSources[dt][it.type][it.source])return;const Ut=this.workerSources[dt][it.type][it.source];delete this.workerSources[dt][it.type][it.source],Ut.removeSource!==void 0&&Ut.removeSource(it)})),this.actor.registerMessageHandler("RM",dt=>T._(this,void 0,void 0,function*(){delete this.layerIndexes[dt],delete this.availableImages[dt],delete this.workerSources[dt],delete this.demWorkerSources[dt]})),this.actor.registerMessageHandler("SR",(dt,it)=>T._(this,void 0,void 0,function*(){this.referrer=it})),this.actor.registerMessageHandler("SRPS",(dt,it)=>this._syncRTLPluginState(dt,it)),this.actor.registerMessageHandler("IS",(dt,it)=>T._(this,void 0,void 0,function*(){this.self.importScripts(it)})),this.actor.registerMessageHandler("SI",(dt,it)=>this._setImages(dt,it)),this.actor.registerMessageHandler("UL",(dt,it)=>T._(this,void 0,void 0,function*(){this._getLayerIndex(dt).update(it.layers,it.removedIds)})),this.actor.registerMessageHandler("SL",(dt,it)=>T._(this,void 0,void 0,function*(){this._getLayerIndex(dt).replace(it)}))}_setImages(Qe,dt){return T._(this,void 0,void 0,function*(){this.availableImages[Qe]=dt;for(const it in this.workerSources[Qe]){const Ut=this.workerSources[Qe][it];for(const on in Ut)Ut[on].availableImages=dt}})}_syncRTLPluginState(Qe,dt){return T._(this,void 0,void 0,function*(){return yield T.cC.syncState(dt,this.self.importScripts)})}_getAvailableImages(Qe){let dt=this.availableImages[Qe];return dt||(dt=[]),dt}_getLayerIndex(Qe){let dt=this.layerIndexes[Qe];return dt||(dt=this.layerIndexes[Qe]=new t),dt}_getWorkerSource(Qe,dt,it){if(this.workerSources[Qe]||(this.workerSources[Qe]={}),this.workerSources[Qe][dt]||(this.workerSources[Qe][dt]={}),!this.workerSources[Qe][dt][it]){const Ut={sendAsync:(on,un)=>(on.targetMapId=Qe,this.actor.sendAsync(on,un))};switch(dt){case"vector":this.workerSources[Qe][dt][it]=new ne(Ut,this._getLayerIndex(Qe),this._getAvailableImages(Qe));break;case"geojson":this.workerSources[Qe][dt][it]=new to(Ut,this._getLayerIndex(Qe),this._getAvailableImages(Qe));break;default:this.workerSources[Qe][dt][it]=new this.externalWorkerSourceTypes[dt](Ut,this._getLayerIndex(Qe),this._getAvailableImages(Qe))}}return this.workerSources[Qe][dt][it]}_getDEMWorkerSource(Qe,dt){return this.demWorkerSources[Qe]||(this.demWorkerSources[Qe]={}),this.demWorkerSources[Qe][dt]||(this.demWorkerSources[Qe][dt]=new J),this.demWorkerSources[Qe][dt]}}return T.i(self)&&(self.worker=new ko(self)),ko}),b("index",["exports","./shared"],function(T,t){var G="5.1.0";function W(){var B=new t.A(4);return t.A!=Float32Array&&(B[1]=0,B[2]=0),B[0]=1,B[3]=1,B}let Y,ne;const J={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(B,r,p){const C=requestAnimationFrame(r);B.signal.addEventListener("abort",()=>{cancelAnimationFrame(C),p(t.c())})},frameAsync(B){return new Promise((r,p)=>{this.frame(B,r,p)})},getImageData(B,r=0){return this.getImageCanvasContext(B).getImageData(-r,-r,B.width+2*r,B.height+2*r)},getImageCanvasContext(B){const r=window.document.createElement("canvas"),p=r.getContext("2d",{willReadFrequently:!0});if(!p)throw new Error("failed to create canvas 2d context");return r.width=B.width,r.height=B.height,p.drawImage(B,0,0,B.width,B.height),p},resolveURL:B=>(Y||(Y=document.createElement("a")),Y.href=B,Y.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(ne==null&&(ne=matchMedia("(prefers-reduced-motion: reduce)")),ne.matches)}};class Q{static testProp(r){if(!Q.docStyle)return r[0];for(let p=0;p<r.length;p++)if(r[p]in Q.docStyle)return r[p];return r[0]}static create(r,p,C){const k=window.document.createElement(r);return p!==void 0&&(k.className=p),C&&C.appendChild(k),k}static createNS(r,p){return window.document.createElementNS(r,p)}static disableDrag(){Q.docStyle&&Q.selectProp&&(Q.userSelect=Q.docStyle[Q.selectProp],Q.docStyle[Q.selectProp]="none")}static enableDrag(){Q.docStyle&&Q.selectProp&&(Q.docStyle[Q.selectProp]=Q.userSelect)}static setTransform(r,p){r.style[Q.transformProp]=p}static addEventListener(r,p,C,k={}){r.addEventListener(p,C,"passive"in k?k:k.capture)}static removeEventListener(r,p,C,k={}){r.removeEventListener(p,C,"passive"in k?k:k.capture)}static suppressClickInternal(r){r.preventDefault(),r.stopPropagation(),window.removeEventListener("click",Q.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",Q.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",Q.suppressClickInternal,!0)},0)}static getScale(r){const p=r.getBoundingClientRect();return{x:p.width/r.offsetWidth||1,y:p.height/r.offsetHeight||1,boundingClientRect:p}}static getPoint(r,p,C){const k=p.boundingClientRect;return new t.P((C.clientX-k.left)/p.x-r.clientLeft,(C.clientY-k.top)/p.y-r.clientTop)}static mousePos(r,p){const C=Q.getScale(r);return Q.getPoint(r,C,p)}static touchPos(r,p){const C=[],k=Q.getScale(r);for(let j=0;j<p.length;j++)C.push(Q.getPoint(r,k,p[j]));return C}static mouseButton(r){return r.button}static remove(r){r.parentNode&&r.parentNode.removeChild(r)}static sanitize(r){const p=new DOMParser().parseFromString(r,"text/html").body||document.createElement("body"),C=p.querySelectorAll("script");for(const k of C)k.remove();return Q.clean(p),p.innerHTML}static isPossiblyDangerous(r,p){const C=p.replace(/\s+/g,"").toLowerCase();return!(!["src","href","xlink:href"].includes(r)||!C.includes("javascript:")&&!C.includes("data:"))||!!r.startsWith("on")||void 0}static clean(r){const p=r.children;for(const C of p)Q.removeAttributes(C),Q.clean(C)}static removeAttributes(r){for(const{name:p,value:C}of r.attributes)Q.isPossiblyDangerous(p,C)&&r.removeAttribute(p)}}Q.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,Q.selectProp=Q.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),Q.transformProp=Q.testProp(["transform","WebkitTransform"]);const ce={supported:!1,testSupport:function(B){!be&&pe&&(Ie?$e(B):ie=B)}};let ie,pe,be=!1,Ie=!1;function $e(B){const r=B.createTexture();B.bindTexture(B.TEXTURE_2D,r);try{if(B.texImage2D(B.TEXTURE_2D,0,B.RGBA,B.RGBA,B.UNSIGNED_BYTE,pe),B.isContextLost())return;ce.supported=!0}catch{}B.deleteTexture(r),be=!0}var Le;typeof document<"u"&&(pe=document.createElement("img"),pe.onload=()=>{ie&&$e(ie),ie=null,Ie=!0},pe.onerror=()=>{be=!0,ie=null},pe.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(B){let r,p,C,k;B.resetRequestQueue=()=>{r=[],p=0,C=0,k={}},B.addThrottleControl=ue=>{const ye=C++;return k[ye]=ue,ye},B.removeThrottleControl=ue=>{delete k[ue],Z()},B.getImage=(ue,ye,Me=!0)=>new Promise((Re,ze)=>{ce.supported&&(ue.headers||(ue.headers={}),ue.headers.accept="image/webp,*/*"),t.e(ue,{type:"image"}),r.push({abortController:ye,requestParameters:ue,supportImageRefresh:Me,state:"queued",onError:Je=>{ze(Je)},onSuccess:Je=>{Re(Je)}}),Z()});const j=ue=>t._(this,void 0,void 0,function*(){ue.state="running";const{requestParameters:ye,supportImageRefresh:Me,onError:Re,onSuccess:ze,abortController:Je}=ue,ot=Me===!1&&!t.i(self)&&!t.g(ye.url)&&(!ye.headers||Object.keys(ye.headers).reduce((Lt,jt)=>Lt&&jt==="accept",!0));p++;const Pt=ot?re(ye,Je):t.m(ye,Je);try{const Lt=yield Pt;delete ue.abortController,ue.state="completed",Lt.data instanceof HTMLImageElement||t.b(Lt.data)?ze(Lt):Lt.data&&ze({data:yield(Et=Lt.data,typeof createImageBitmap=="function"?t.d(Et):t.f(Et)),cacheControl:Lt.cacheControl,expires:Lt.expires})}catch(Lt){delete ue.abortController,Re(Lt)}finally{p--,Z()}var Et}),Z=()=>{const ue=(()=>{for(const ye of Object.keys(k))if(k[ye]())return!0;return!1})()?t.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:t.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let ye=p;ye<ue&&r.length>0;ye++){const Me=r.shift();Me.abortController.signal.aborted?ye--:j(Me)}},re=(ue,ye)=>new Promise((Me,Re)=>{const ze=new Image,Je=ue.url,ot=ue.credentials;ot&&ot==="include"?ze.crossOrigin="use-credentials":(ot&&ot==="same-origin"||!t.s(Je))&&(ze.crossOrigin="anonymous"),ye.signal.addEventListener("abort",()=>{ze.src="",Re(t.c())}),ze.fetchPriority="high",ze.onload=()=>{ze.onerror=ze.onload=null,Me({data:ze})},ze.onerror=()=>{ze.onerror=ze.onload=null,ye.signal.aborted||Re(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},ze.src=Je})}(Le||(Le={})),Le.resetRequestQueue();class Oe{constructor(r){this._transformRequestFn=r}transformRequest(r,p){return this._transformRequestFn&&this._transformRequestFn(r,p)||{url:r}}setTransformRequest(r){this._transformRequestFn=r}}function Ve(B){const r=[];if(typeof B=="string")r.push({id:"default",url:B});else if(B&&B.length>0){const p=[];for(const{id:C,url:k}of B){const j=`${C}${k}`;p.indexOf(j)===-1&&(p.push(j),r.push({id:C,url:k}))}}return r}function Ue(B,r,p){try{const C=new URL(B);return C.pathname+=`${r}${p}`,C.toString()}catch{throw new Error(`Invalid sprite URL "${B}", must be absolute. Modify style specification directly or use TransformStyleFunction to correct the issue dynamically`)}}class qe{constructor(r,p,C,k){this.context=r,this.format=C,this.texture=r.gl.createTexture(),this.update(p,k)}update(r,p,C){const{width:k,height:j}=r,Z=!(this.size&&this.size[0]===k&&this.size[1]===j||C),{context:re}=this,{gl:ue}=re;if(this.useMipmap=!!(p&&p.useMipmap),ue.bindTexture(ue.TEXTURE_2D,this.texture),re.pixelStoreUnpackFlipY.set(!1),re.pixelStoreUnpack.set(1),re.pixelStoreUnpackPremultiplyAlpha.set(this.format===ue.RGBA&&(!p||p.premultiply!==!1)),Z)this.size=[k,j],r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||t.b(r)?ue.texImage2D(ue.TEXTURE_2D,0,this.format,this.format,ue.UNSIGNED_BYTE,r):ue.texImage2D(ue.TEXTURE_2D,0,this.format,k,j,0,this.format,ue.UNSIGNED_BYTE,r.data);else{const{x:ye,y:Me}=C||{x:0,y:0};r instanceof HTMLImageElement||r instanceof HTMLCanvasElement||r instanceof HTMLVideoElement||r instanceof ImageData||t.b(r)?ue.texSubImage2D(ue.TEXTURE_2D,0,ye,Me,ue.RGBA,ue.UNSIGNED_BYTE,r):ue.texSubImage2D(ue.TEXTURE_2D,0,ye,Me,k,j,ue.RGBA,ue.UNSIGNED_BYTE,r.data)}this.useMipmap&&this.isSizePowerOfTwo()&&ue.generateMipmap(ue.TEXTURE_2D)}bind(r,p,C){const{context:k}=this,{gl:j}=k;j.bindTexture(j.TEXTURE_2D,this.texture),C!==j.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(C=j.LINEAR),r!==this.filter&&(j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MAG_FILTER,r),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MIN_FILTER,C||r),this.filter=r),p!==this.wrap&&(j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_S,p),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_T,p),this.wrap=p)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}function He(B){const{userImage:r}=B;return!!(r&&r.render&&r.render())&&(B.data.replace(new Uint8Array(r.data.buffer)),!0)}class nt extends t.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new t.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:p,promiseResolve:C}of this.requestors)C(this._getImagesForIds(p));this.requestors=[]}}getImage(r){const p=this.images[r];if(p&&!p.data&&p.spriteData){const C=p.spriteData;p.data=new t.R({width:C.width,height:C.height},C.context.getImageData(C.x,C.y,C.width,C.height).data),p.spriteData=null}return p}addImage(r,p){if(this.images[r])throw new Error(`Image id ${r} already exist, use updateImage instead`);this._validate(r,p)&&(this.images[r]=p)}_validate(r,p){let C=!0;const k=p.data||p.spriteData;return this._validateStretch(p.stretchX,k&&k.width)||(this.fire(new t.j(new Error(`Image "${r}" has invalid "stretchX" value`))),C=!1),this._validateStretch(p.stretchY,k&&k.height)||(this.fire(new t.j(new Error(`Image "${r}" has invalid "stretchY" value`))),C=!1),this._validateContent(p.content,p)||(this.fire(new t.j(new Error(`Image "${r}" has invalid "content" value`))),C=!1),C}_validateStretch(r,p){if(!r)return!0;let C=0;for(const k of r){if(k[0]<C||k[1]<k[0]||p<k[1])return!1;C=k[1]}return!0}_validateContent(r,p){if(!r)return!0;if(r.length!==4)return!1;const C=p.spriteData,k=C&&C.width||p.data.width,j=C&&C.height||p.data.height;return!(r[0]<0||k<r[0]||r[1]<0||j<r[1]||r[2]<0||k<r[2]||r[3]<0||j<r[3]||r[2]<r[0]||r[3]<r[1])}updateImage(r,p,C=!0){const k=this.getImage(r);if(C&&(k.data.width!==p.data.width||k.data.height!==p.data.height))throw new Error(`size mismatch between old image (${k.data.width}x${k.data.height}) and new image (${p.data.width}x${p.data.height}).`);p.version=k.version+1,this.images[r]=p,this.updatedImages[r]=!0}removeImage(r){const p=this.images[r];delete this.images[r],delete this.patterns[r],p.userImage&&p.userImage.onRemove&&p.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r){return new Promise((p,C)=>{let k=!0;if(!this.isLoaded())for(const j of r)this.images[j]||(k=!1);this.isLoaded()||k?p(this._getImagesForIds(r)):this.requestors.push({ids:r,promiseResolve:p})})}_getImagesForIds(r){const p={};for(const C of r){let k=this.getImage(C);k||(this.fire(new t.k("styleimagemissing",{id:C})),k=this.getImage(C)),k?p[C]={data:k.data.clone(),pixelRatio:k.pixelRatio,sdf:k.sdf,version:k.version,stretchX:k.stretchX,stretchY:k.stretchY,content:k.content,textFitWidth:k.textFitWidth,textFitHeight:k.textFitHeight,hasRenderCallback:!!(k.userImage&&k.userImage.render)}:t.w(`Image "${C}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return p}getPixelSize(){const{width:r,height:p}=this.atlasImage;return{width:r,height:p}}getPattern(r){const p=this.patterns[r],C=this.getImage(r);if(!C)return null;if(p&&p.position.version===C.version)return p.position;if(p)p.position.version=C.version;else{const k={w:C.data.width+2,h:C.data.height+2,x:0,y:0},j=new t.I(k,C);this.patterns[r]={bin:k,position:j}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const p=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new qe(r,this.atlasImage,p.RGBA),this.atlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const j in this.patterns)r.push(this.patterns[j].bin);const{w:p,h:C}=t.p(r),k=this.atlasImage;k.resize({width:p||1,height:C||1});for(const j in this.patterns){const{bin:Z}=this.patterns[j],re=Z.x+1,ue=Z.y+1,ye=this.getImage(j).data,Me=ye.width,Re=ye.height;t.R.copy(ye,k,{x:0,y:0},{x:re,y:ue},{width:Me,height:Re}),t.R.copy(ye,k,{x:0,y:Re-1},{x:re,y:ue-1},{width:Me,height:1}),t.R.copy(ye,k,{x:0,y:0},{x:re,y:ue+Re},{width:Me,height:1}),t.R.copy(ye,k,{x:Me-1,y:0},{x:re-1,y:ue},{width:1,height:Re}),t.R.copy(ye,k,{x:0,y:0},{x:re+Me,y:ue},{width:1,height:Re})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const p of r){if(this.callbackDispatchedThisFrame[p])continue;this.callbackDispatchedThisFrame[p]=!0;const C=this.getImage(p);C||t.w(`Image with ID: "${p}" was not found`),He(C)&&this.updateImage(p,C)}}}const rt=1e20;function ft(B,r,p,C,k,j,Z,re,ue){for(let ye=r;ye<r+C;ye++)$t(B,p*j+ye,j,k,Z,re,ue);for(let ye=p;ye<p+k;ye++)$t(B,ye*j+r,1,C,Z,re,ue)}function $t(B,r,p,C,k,j,Z){j[0]=0,Z[0]=-1e20,Z[1]=rt,k[0]=B[r];for(let re=1,ue=0,ye=0;re<C;re++){k[re]=B[r+re*p];const Me=re*re;do{const Re=j[ue];ye=(k[re]-k[Re]+Me-Re*Re)/(re-Re)/2}while(ye<=Z[ue]&&--ue>-1);ue++,j[ue]=re,Z[ue]=ye,Z[ue+1]=rt}for(let re=0,ue=0;re<C;re++){for(;Z[ue+1]<re;)ue++;const ye=j[ue],Me=re-ye;B[r+re*p]=k[ye]+Me*Me}}class hn{constructor(r,p){this.requestManager=r,this.localIdeographFontFamily=p,this.entries={}}setURL(r){this.url=r}getGlyphs(r){return t._(this,void 0,void 0,function*(){const p=[];for(const j in r)for(const Z of r[j])p.push(this._getAndCacheGlyphsPromise(j,Z));const C=yield Promise.all(p),k={};for(const{stack:j,id:Z,glyph:re}of C)k[j]||(k[j]={}),k[j][Z]=re&&{id:re.id,bitmap:re.bitmap.clone(),metrics:re.metrics};return k})}_getAndCacheGlyphsPromise(r,p){return t._(this,void 0,void 0,function*(){let C=this.entries[r];C||(C=this.entries[r]={glyphs:{},requests:{},ranges:{}});let k=C.glyphs[p];if(k!==void 0)return{stack:r,id:p,glyph:k};if(k=this._tinySDF(C,r,p),k)return C.glyphs[p]=k,{stack:r,id:p,glyph:k};const j=Math.floor(p/256);if(256*j>65535)throw new Error("glyphs > 65535 not supported");if(C.ranges[j])return{stack:r,id:p,glyph:k};if(!this.url)throw new Error("glyphsUrl is not set");if(!C.requests[j]){const re=hn.loadGlyphRange(r,j,this.url,this.requestManager);C.requests[j]=re}const Z=yield C.requests[j];for(const re in Z)this._doesCharSupportLocalGlyph(+re)||(C.glyphs[+re]=Z[+re]);return C.ranges[j]=!0,{stack:r,id:p,glyph:Z[p]||null}})}_doesCharSupportLocalGlyph(r){return!!this.localIdeographFontFamily&&new RegExp("\\p{Ideo}|\\p{sc=Hang}|\\p{sc=Hira}|\\p{sc=Kana}","u").test(String.fromCodePoint(r))}_tinySDF(r,p,C){const k=this.localIdeographFontFamily;if(!k||!this._doesCharSupportLocalGlyph(C))return;let j=r.tinySDF;if(!j){let re="400";/bold/i.test(p)?re="900":/medium/i.test(p)?re="500":/light/i.test(p)&&(re="200"),j=r.tinySDF=new hn.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:k,fontWeight:re})}const Z=j.draw(String.fromCharCode(C));return{id:C,bitmap:new t.o({width:Z.width||60,height:Z.height||60},Z.data),metrics:{width:Z.glyphWidth/2||24,height:Z.glyphHeight/2||24,left:Z.glyphLeft/2+.5||0,top:Z.glyphTop/2-27.5||-8,advance:Z.glyphAdvance/2||24,isDoubleResolution:!0}}}}hn.loadGlyphRange=function(B,r,p,C){return t._(this,void 0,void 0,function*(){const k=256*r,j=k+255,Z=C.transformRequest(p.replace("{fontstack}",B).replace("{range}",`${k}-${j}`),"Glyphs"),re=yield t.l(Z,new AbortController);if(!re||!re.data)throw new Error(`Could not load glyph range. range: ${r}, ${k}-${j}`);const ue={};for(const ye of t.n(re.data))ue[ye.id]=ye;return ue})},hn.TinySDF=class{constructor({fontSize:B=24,buffer:r=3,radius:p=8,cutoff:C=.25,fontFamily:k="sans-serif",fontWeight:j="normal",fontStyle:Z="normal"}={}){this.buffer=r,this.cutoff=C,this.radius=p;const re=this.size=B+4*r,ue=this._createCanvas(re),ye=this.ctx=ue.getContext("2d",{willReadFrequently:!0});ye.font=`${Z} ${j} ${B}px ${k}`,ye.textBaseline="alphabetic",ye.textAlign="left",ye.fillStyle="black",this.gridOuter=new Float64Array(re*re),this.gridInner=new Float64Array(re*re),this.f=new Float64Array(re),this.z=new Float64Array(re+1),this.v=new Uint16Array(re)}_createCanvas(B){const r=document.createElement("canvas");return r.width=r.height=B,r}draw(B){const{width:r,actualBoundingBoxAscent:p,actualBoundingBoxDescent:C,actualBoundingBoxLeft:k,actualBoundingBoxRight:j}=this.ctx.measureText(B),Z=Math.ceil(p),re=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(j-k))),ue=Math.min(this.size-this.buffer,Z+Math.ceil(C)),ye=re+2*this.buffer,Me=ue+2*this.buffer,Re=Math.max(ye*Me,0),ze=new Uint8ClampedArray(Re),Je={data:ze,width:ye,height:Me,glyphWidth:re,glyphHeight:ue,glyphTop:Z,glyphLeft:0,glyphAdvance:r};if(re===0||ue===0)return Je;const{ctx:ot,buffer:Pt,gridInner:Et,gridOuter:Lt}=this;ot.clearRect(Pt,Pt,re,ue),ot.fillText(B,Pt,Pt+Z);const jt=ot.getImageData(Pt,Pt,re,ue);Lt.fill(rt,0,Re),Et.fill(0,0,Re);for(let Nt=0;Nt<ue;Nt++)for(let Bt=0;Bt<re;Bt++){const nn=jt.data[4*(Nt*re+Bt)+3]/255;if(nn===0)continue;const rn=(Nt+Pt)*ye+Bt+Pt;if(nn===1)Lt[rn]=0,Et[rn]=rt;else{const an=.5-nn;Lt[rn]=an>0?an*an:0,Et[rn]=an<0?an*an:0}}ft(Lt,0,0,ye,Me,ye,this.f,this.v,this.z),ft(Et,Pt,Pt,re,ue,ye,this.f,this.v,this.z);for(let Nt=0;Nt<Re;Nt++){const Bt=Math.sqrt(Lt[Nt])-Math.sqrt(Et[Nt]);ze[Nt]=Math.round(255-255*(Bt/this.radius+this.cutoff))}return Je}};class gn{constructor(){this.specification=t.v.light.position}possiblyEvaluate(r,p){return t.x(r.expression.evaluate(p))}interpolate(r,p,C){return{x:t.y.number(r.x,p.x,C),y:t.y.number(r.y,p.y,C),z:t.y.number(r.z,p.z,C)}}}let pn;class ri extends t.E{constructor(r){super(),pn=pn||new t.q({anchor:new t.D(t.v.light.anchor),position:new gn,color:new t.D(t.v.light.color),intensity:new t.D(t.v.light.intensity)}),this._transitionable=new t.T(pn),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,p={}){if(!this._validate(t.r,r,p))for(const C in r){const k=r[C];C.endsWith("-transition")?this._transitionable.setTransition(C.slice(0,-11),k):this._transitionable.setValue(C,k)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,p,C){return(!C||C.validate!==!1)&&t.t(this,r.call(t.u,{value:p,style:{glyphs:!0,sprite:!0},styleSpec:t.v}))}}const ai=new t.q({"sky-color":new t.D(t.v.sky["sky-color"]),"horizon-color":new t.D(t.v.sky["horizon-color"]),"fog-color":new t.D(t.v.sky["fog-color"]),"fog-ground-blend":new t.D(t.v.sky["fog-ground-blend"]),"horizon-fog-blend":new t.D(t.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new t.D(t.v.sky["sky-horizon-blend"]),"atmosphere-blend":new t.D(t.v.sky["atmosphere-blend"])});class _n extends t.E{constructor(r){super(),this._transitionable=new t.T(ai),this.setSky(r),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new t.z(0))}setSky(r,p={}){if(!this._validate(t.B,r,p)){r||(r={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const C in r){const k=r[C];C.endsWith("-transition")?this._transitionable.setTransition(C.slice(0,-11),k):this._transitionable.setValue(C,k)}}}getSky(){return this._transitionable.serialize()}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,p,C={}){return(C==null?void 0:C.validate)!==!1&&t.t(this,r.call(t.u,t.e({value:p,style:{glyphs:!0,sprite:!0},styleSpec:t.v})))}calculateFogBlendOpacity(r){return r<60?0:r<70?(r-60)/10:1}}class Bn{constructor(r,p){this.width=r,this.height=p,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(r,p){const C=r.join(",")+String(p);return this.dashEntry[C]||(this.dashEntry[C]=this.addDash(r,p)),this.dashEntry[C]}getDashRanges(r,p,C){const k=[];let j=r.length%2==1?-r[r.length-1]*C:0,Z=r[0]*C,re=!0;k.push({left:j,right:Z,isDash:re,zeroLength:r[0]===0});let ue=r[0];for(let ye=1;ye<r.length;ye++){re=!re;const Me=r[ye];j=ue*C,ue+=Me,Z=ue*C,k.push({left:j,right:Z,isDash:re,zeroLength:Me===0})}return k}addRoundDash(r,p,C){const k=p/2;for(let j=-C;j<=C;j++){const Z=this.width*(this.nextRow+C+j);let re=0,ue=r[re];for(let ye=0;ye<this.width;ye++){ye/ue.right>1&&(ue=r[++re]);const Me=Math.abs(ye-ue.left),Re=Math.abs(ye-ue.right),ze=Math.min(Me,Re);let Je;const ot=j/C*(k+1);if(ue.isDash){const Pt=k-Math.abs(ot);Je=Math.sqrt(ze*ze+Pt*Pt)}else Je=k-Math.sqrt(ze*ze+ot*ot);this.data[Z+ye]=Math.max(0,Math.min(255,Je+128))}}}addRegularDash(r){for(let re=r.length-1;re>=0;--re){const ue=r[re],ye=r[re+1];ue.zeroLength?r.splice(re,1):ye&&ye.isDash===ue.isDash&&(ye.left=ue.left,r.splice(re,1))}const p=r[0],C=r[r.length-1];p.isDash===C.isDash&&(p.left=C.left-this.width,C.right=p.right+this.width);const k=this.width*this.nextRow;let j=0,Z=r[j];for(let re=0;re<this.width;re++){re/Z.right>1&&(Z=r[++j]);const ue=Math.abs(re-Z.left),ye=Math.abs(re-Z.right),Me=Math.min(ue,ye);this.data[k+re]=Math.max(0,Math.min(255,(Z.isDash?Me:-Me)+128))}}addDash(r,p){const C=p?7:0,k=2*C+1;if(this.nextRow+k>this.height)return t.w("LineAtlas out of space"),null;let j=0;for(let re=0;re<r.length;re++)j+=r[re];if(j!==0){const re=this.width/j,ue=this.getDashRanges(r,this.width,re);p?this.addRoundDash(ue,re,C):this.addRegularDash(ue)}const Z={y:(this.nextRow+C+.5)/this.height,height:2*C/this.height,width:j};return this.nextRow+=k,this.dirty=!0,Z}bind(r){const p=r.gl;this.texture?(p.bindTexture(p.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,p.texSubImage2D(p.TEXTURE_2D,0,0,0,this.width,this.height,p.ALPHA,p.UNSIGNED_BYTE,this.data))):(this.texture=p.createTexture(),p.bindTexture(p.TEXTURE_2D,this.texture),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.REPEAT),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.REPEAT),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.LINEAR),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.LINEAR),p.texImage2D(p.TEXTURE_2D,0,p.ALPHA,this.width,this.height,0,p.ALPHA,p.UNSIGNED_BYTE,this.data))}}const mn="maplibre_preloaded_worker_pool";class Nn{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<Nn.workerCount;)this.workers.push(new Worker(t.a.WORKER_URL));return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],this.numActive()===0&&(this.workers.forEach(p=>{p.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[mn]}numActive(){return Object.keys(this.active).length}}const Pn=Math.floor(J.hardwareConcurrency/2);let Ci,Fi;function Ln(){return Ci||(Ci=new Nn),Ci}Nn.workerCount=t.C(globalThis)?Math.max(Math.min(Pn,3),1):1;class sn{constructor(r,p){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=p;const C=this.workerPool.acquire(p);for(let k=0;k<C.length;k++){const j=new t.F(C[k],p);j.name=`Worker ${k}`,this.actors.push(j)}if(!this.actors.length)throw new Error("No actors found")}broadcast(r,p){const C=[];for(const k of this.actors)C.push(k.sendAsync({type:r,data:p}));return Promise.all(C)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(r=!0){this.actors.forEach(p=>{p.remove()}),this.actors=[],r&&this.workerPool.release(this.id)}registerMessageHandler(r,p){for(const C of this.actors)C.registerMessageHandler(r,p)}}function qn(){return Fi||(Fi=new sn(Ln(),t.G),Fi.registerMessageHandler("GR",(B,r,p)=>t.m(r,p))),Fi}function pi(B,r){const p=t.H();return t.J(p,p,[1,1,0]),t.K(p,p,[.5*B.width,.5*B.height,1]),B.calculatePosMatrix?t.L(p,p,B.calculatePosMatrix(r.toUnwrapped())):p}function ht(B,r,p,C,k,j){var Z;const re=function(Re,ze,Je){if(Re)for(const ot of Re){const Pt=ze[ot];if(Pt&&Pt.source===Je&&Pt.type==="fill-extrusion")return!0}else for(const ot in ze){const Pt=ze[ot];if(Pt.source===Je&&Pt.type==="fill-extrusion")return!0}return!1}((Z=k==null?void 0:k.layers)!==null&&Z!==void 0?Z:null,r,B.id),ue=j.maxPitchScaleFactor(),ye=B.tilesIn(C,ue,re);ye.sort(Zn);const Me=[];for(const Re of ye)Me.push({wrappedTileID:Re.tileID.wrapped().key,queryResults:Re.tile.queryRenderedFeatures(r,p,B._state,Re.queryGeometry,Re.cameraQueryGeometry,Re.scale,k,j,ue,pi(B.transform,Re.tileID))});return function(Re,ze){for(const Je in Re)for(const ot of Re[Je])St(ot,ze);return Re}(function(Re){const ze={},Je={};for(const ot of Re){const Pt=ot.queryResults,Et=ot.wrappedTileID,Lt=Je[Et]=Je[Et]||{};for(const jt in Pt){const Nt=Pt[jt],Bt=Lt[jt]=Lt[jt]||{},nn=ze[jt]=ze[jt]||[];for(const rn of Nt)Bt[rn.featureIndex]||(Bt[rn.featureIndex]=!0,nn.push(rn))}}return ze}(Me),B)}function Zn(B,r){const p=B.tileID,C=r.tileID;return p.overscaledZ-C.overscaledZ||p.canonical.y-C.canonical.y||p.wrap-C.wrap||p.canonical.x-C.canonical.x}function St(B,r){const p=B.feature,C=r.getFeatureState(p.layer["source-layer"],p.id);p.source=p.layer.source,p.layer["source-layer"]&&(p.sourceLayer=p.layer["source-layer"]),p.state=C}function mt(B,r,p){return t._(this,void 0,void 0,function*(){let C=B;if(B.url?C=(yield t.h(r.transformRequest(B.url,"Source"),p)).data:yield J.frameAsync(p),!C)return null;const k=t.M(t.e(C,B),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in C&&C.vector_layers&&(k.vectorLayerIds=C.vector_layers.map(j=>j.id)),k})}class at{constructor(r,p){r&&(p?this.setSouthWest(r).setNorthEast(p):Array.isArray(r)&&(r.length===4?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1])))}setNorthEast(r){return this._ne=r instanceof t.N?new t.N(r.lng,r.lat):t.N.convert(r),this}setSouthWest(r){return this._sw=r instanceof t.N?new t.N(r.lng,r.lat):t.N.convert(r),this}extend(r){const p=this._sw,C=this._ne;let k,j;if(r instanceof t.N)k=r,j=r;else{if(!(r instanceof at))return Array.isArray(r)?r.length===4||r.every(Array.isArray)?this.extend(at.convert(r)):this.extend(t.N.convert(r)):r&&("lng"in r||"lon"in r)&&"lat"in r?this.extend(t.N.convert(r)):this;if(k=r._sw,j=r._ne,!k||!j)return this}return p||C?(p.lng=Math.min(k.lng,p.lng),p.lat=Math.min(k.lat,p.lat),C.lng=Math.max(j.lng,C.lng),C.lat=Math.max(j.lat,C.lat)):(this._sw=new t.N(k.lng,k.lat),this._ne=new t.N(j.lng,j.lat)),this}getCenter(){return new t.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new t.N(this.getWest(),this.getNorth())}getSouthEast(){return new t.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:p,lat:C}=t.N.convert(r);let k=this._sw.lng<=p&&p<=this._ne.lng;return this._sw.lng>this._ne.lng&&(k=this._sw.lng>=p&&p>=this._ne.lng),this._sw.lat<=C&&C<=this._ne.lat&&k}static convert(r){return r instanceof at?r:r&&new at(r)}static fromLngLat(r,p=0){const C=360*p/40075017,k=C/Math.cos(Math.PI/180*r.lat);return new at(new t.N(r.lng-k,r.lat-C),new t.N(r.lng+k,r.lat+C))}adjustAntiMeridian(){const r=new t.N(this._sw.lng,this._sw.lat),p=new t.N(this._ne.lng,this._ne.lat);return new at(r,r.lng>p.lng?new t.N(p.lng+360,p.lat):p)}}class Tn{constructor(r,p,C){this.bounds=at.convert(this.validateBounds(r)),this.minzoom=p||0,this.maxzoom=C||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const p=Math.pow(2,r.z),C=Math.floor(t.O(this.bounds.getWest())*p),k=Math.floor(t.Q(this.bounds.getNorth())*p),j=Math.ceil(t.O(this.bounds.getEast())*p),Z=Math.ceil(t.Q(this.bounds.getSouth())*p);return r.x>=C&&r.x<j&&r.y>=k&&r.y<Z}}class bn extends t.E{constructor(r,p,C,k){if(super(),this.id=r,this.dispatcher=C,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.e(this,t.M(p,["url","scheme","tileSize","promoteId"])),this._options=t.e({type:"vector"},p),this._collectResourceTiming=p.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(k)}load(){return t._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new t.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const r=yield mt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),r&&(t.e(this,r),r.bounds&&(this.tileBounds=new Tn(r.bounds,this.minzoom,this.maxzoom)),this.fire(new t.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.k("data",{dataType:"source",sourceDataType:"content"})))}catch(r){this._tileJSONRequest=null,this.fire(new t.j(r))}})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}setSourceProperty(r){this._tileJSONRequest&&this._tileJSONRequest.abort(),r(),this.load()}setTiles(r){return this.setSourceProperty(()=>{this._options.tiles=r}),this}setUrl(r){return this.setSourceProperty(()=>{this.url=r,this._options.url=r}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return t.e({},this._options)}loadTile(r){return t._(this,void 0,void 0,function*(){const p=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),C={request:this.map._requestManager.transformRequest(p,"Tile"),uid:r.uid,tileID:r.tileID,zoom:r.tileID.overscaledZ,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};C.request.collectResourceTiming=this._collectResourceTiming;let k="RT";if(r.actor&&r.state!=="expired"){if(r.state==="loading")return new Promise((j,Z)=>{r.reloadPromise={resolve:j,reject:Z}})}else r.actor=this.dispatcher.getActor(),k="LT";r.abortController=new AbortController;try{const j=yield r.actor.sendAsync({type:k,data:C},r.abortController);if(delete r.abortController,r.aborted)return;this._afterTileLoadWorkerResponse(r,j)}catch(j){if(delete r.abortController,r.aborted)return;if(j&&j.status!==404)throw j;this._afterTileLoadWorkerResponse(r,null)}})}_afterTileLoadWorkerResponse(r,p){if(p&&p.resourceTiming&&(r.resourceTiming=p.resourceTiming),p&&this.map._refreshExpiredTiles&&r.setExpiryData(p),r.loadVectorData(p,this.map.painter),r.reloadPromise){const C=r.reloadPromise;r.reloadPromise=null,this.loadTile(r).then(C.resolve).catch(C.reject)}}abortTile(r){return t._(this,void 0,void 0,function*(){r.abortController&&(r.abortController.abort(),delete r.abortController),r.actor&&(yield r.actor.sendAsync({type:"AT",data:{uid:r.uid,type:this.type,source:this.id}}))})}unloadTile(r){return t._(this,void 0,void 0,function*(){r.unloadVectorData(),r.actor&&(yield r.actor.sendAsync({type:"RMT",data:{uid:r.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class Cn extends t.E{constructor(r,p,C,k){super(),this.id=r,this.dispatcher=C,this.setEventedParent(k),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.e({type:"raster"},p),t.e(this,t.M(p,["url","scheme","tileSize"]))}load(){return t._(this,arguments,void 0,function*(r=!1){this._loaded=!1,this.fire(new t.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const p=yield mt(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,p&&(t.e(this,p),p.bounds&&(this.tileBounds=new Tn(p.bounds,this.minzoom,this.maxzoom)),this.fire(new t.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.k("data",{dataType:"source",sourceDataType:"content",sourceDataChanged:r})))}catch(p){this._tileJSONRequest=null,this.fire(new t.j(p))}})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(r){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),r(),this.load(!0)}setTiles(r){return this.setSourceProperty(()=>{this._options.tiles=r}),this}setUrl(r){return this.setSourceProperty(()=>{this.url=r,this._options.url=r}),this}serialize(){return t.e({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r){return t._(this,void 0,void 0,function*(){const p=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);r.abortController=new AbortController;try{const C=yield Le.getImage(this.map._requestManager.transformRequest(p,"Tile"),r.abortController,this.map._refreshExpiredTiles);if(delete r.abortController,r.aborted)return void(r.state="unloaded");if(C&&C.data){this.map._refreshExpiredTiles&&C.cacheControl&&C.expires&&r.setExpiryData({cacheControl:C.cacheControl,expires:C.expires});const k=this.map.painter.context,j=k.gl,Z=C.data;r.texture=this.map.painter.getTileTexture(Z.width),r.texture?r.texture.update(Z,{useMipmap:!0}):(r.texture=new qe(k,Z,j.RGBA,{useMipmap:!0}),r.texture.bind(j.LINEAR,j.CLAMP_TO_EDGE,j.LINEAR_MIPMAP_NEAREST)),r.state="loaded"}}catch(C){if(delete r.abortController,r.aborted)r.state="unloaded";else if(C)throw r.state="errored",C}})}abortTile(r){return t._(this,void 0,void 0,function*(){r.abortController&&(r.abortController.abort(),delete r.abortController)})}unloadTile(r){return t._(this,void 0,void 0,function*(){r.texture&&this.map.painter.saveTileTexture(r.texture)})}hasTransition(){return!1}}class zn extends Cn{constructor(r,p,C,k){super(r,p,C,k),this.type="raster-dem",this.maxzoom=22,this._options=t.e({type:"raster-dem"},p),this.encoding=p.encoding||"mapbox",this.redFactor=p.redFactor,this.greenFactor=p.greenFactor,this.blueFactor=p.blueFactor,this.baseShift=p.baseShift}loadTile(r){return t._(this,void 0,void 0,function*(){const p=r.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),C=this.map._requestManager.transformRequest(p,"Tile");r.neighboringTiles=this._getNeighboringTiles(r.tileID),r.abortController=new AbortController;try{const k=yield Le.getImage(C,r.abortController,this.map._refreshExpiredTiles);if(delete r.abortController,r.aborted)return void(r.state="unloaded");if(k&&k.data){const j=k.data;this.map._refreshExpiredTiles&&k.cacheControl&&k.expires&&r.setExpiryData({cacheControl:k.cacheControl,expires:k.expires});const Z=t.b(j)&&t.U()?j:yield this.readImageNow(j),re={type:this.type,uid:r.uid,source:this.id,rawImageData:Z,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!r.actor||r.state==="expired"){r.actor=this.dispatcher.getActor();const ue=yield r.actor.sendAsync({type:"LDT",data:re});r.dem=ue,r.needsHillshadePrepare=!0,r.needsTerrainPrepare=!0,r.state="loaded"}}}catch(k){if(delete r.abortController,r.aborted)r.state="unloaded";else if(k)throw r.state="errored",k}})}readImageNow(r){return t._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&t.V()){const p=r.width+2,C=r.height+2;try{return new t.R({width:p,height:C},yield t.W(r,-1,-1,p,C))}catch{}}return J.getImageData(r,1)})}_getNeighboringTiles(r){const p=r.canonical,C=Math.pow(2,p.z),k=(p.x-1+C)%C,j=p.x===0?r.wrap-1:r.wrap,Z=(p.x+1+C)%C,re=p.x+1===C?r.wrap+1:r.wrap,ue={};return ue[new t.S(r.overscaledZ,j,p.z,k,p.y).key]={backfilled:!1},ue[new t.S(r.overscaledZ,re,p.z,Z,p.y).key]={backfilled:!1},p.y>0&&(ue[new t.S(r.overscaledZ,j,p.z,k,p.y-1).key]={backfilled:!1},ue[new t.S(r.overscaledZ,r.wrap,p.z,p.x,p.y-1).key]={backfilled:!1},ue[new t.S(r.overscaledZ,re,p.z,Z,p.y-1).key]={backfilled:!1}),p.y+1<C&&(ue[new t.S(r.overscaledZ,j,p.z,k,p.y+1).key]={backfilled:!1},ue[new t.S(r.overscaledZ,r.wrap,p.z,p.x,p.y+1).key]={backfilled:!1},ue[new t.S(r.overscaledZ,re,p.z,Z,p.y+1).key]={backfilled:!1}),ue}unloadTile(r){return t._(this,void 0,void 0,function*(){r.demTexture&&this.map.painter.saveTileTexture(r.demTexture),r.fbo&&(r.fbo.destroy(),delete r.fbo),r.dem&&delete r.dem,delete r.neighboringTiles,r.state="unloaded",r.actor&&(yield r.actor.sendAsync({type:"RDT",data:{type:this.type,uid:r.uid,source:this.id}}))})}}class vi extends t.E{constructor(r,p,C,k){super(),this.id=r,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=C.getActor(),this.setEventedParent(k),this._data=p.data,this._options=t.e({},p),this._collectResourceTiming=p.collectResourceTiming,p.maxzoom!==void 0&&(this.maxzoom=p.maxzoom),p.type&&(this.type=p.type),p.attribution&&(this.attribution=p.attribution),this.promoteId=p.promoteId,p.clusterMaxZoom!==void 0&&this.maxzoom<=p.clusterMaxZoom&&t.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${p.clusterMaxZoom}".`),this.workerOptions=t.e({source:this.id,cluster:p.cluster||!1,geojsonVtOptions:{buffer:this._pixelsToTileUnits(p.buffer!==void 0?p.buffer:128),tolerance:this._pixelsToTileUnits(p.tolerance!==void 0?p.tolerance:.375),extent:t.X,maxZoom:this.maxzoom,lineMetrics:p.lineMetrics||!1,generateId:p.generateId||!1},superclusterOptions:{maxZoom:p.clusterMaxZoom!==void 0?p.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,p.clusterMinPoints||2),extent:t.X,radius:this._pixelsToTileUnits(p.clusterRadius||50),log:!1,generateId:p.generateId||!1},clusterProperties:p.clusterProperties,filter:p.filter},p.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}_pixelsToTileUnits(r){return r*(t.X/this.tileSize)}load(){return t._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(r){this.map=r,this.load()}setData(r){return this._data=r,this._updateWorkerData(),this}updateData(r){return this._updateWorkerData(r),this}getData(){return t._(this,void 0,void 0,function*(){const r=t.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:r})})}setClusterOptions(r){return this.workerOptions.cluster=r.cluster,r&&(r.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=this._pixelsToTileUnits(r.clusterRadius)),r.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=r.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(r){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:r,source:this.id}})}getClusterChildren(r){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:r,source:this.id}})}getClusterLeaves(r,p,C){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:r,limit:p,offset:C}})}_updateWorkerData(r){return t._(this,void 0,void 0,function*(){const p=t.e({type:this.type},this.workerOptions);r?p.dataDiff=r:typeof this._data=="string"?(p.request=this.map._requestManager.transformRequest(J.resolveURL(this._data),"Source"),p.request.collectResourceTiming=this._collectResourceTiming):p.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new t.k("dataloading",{dataType:"source"}));try{const C=yield this.actor.sendAsync({type:"LD",data:p});if(this._pendingLoads--,this._removed||C.abandoned)return void this.fire(new t.k("dataabort",{dataType:"source"}));let k=null;C.resourceTiming&&C.resourceTiming[this.id]&&(k=C.resourceTiming[this.id].slice(0));const j={dataType:"source"};this._collectResourceTiming&&k&&k.length>0&&t.e(j,{resourceTiming:k}),this.fire(new t.k("data",Object.assign(Object.assign({},j),{sourceDataType:"metadata"}))),this.fire(new t.k("data",Object.assign(Object.assign({},j),{sourceDataType:"content"})))}catch(C){if(this._pendingLoads--,this._removed)return void this.fire(new t.k("dataabort",{dataType:"source"}));this.fire(new t.j(C))}})}loaded(){return this._pendingLoads===0}loadTile(r){return t._(this,void 0,void 0,function*(){const p=r.actor?"RT":"LT";r.actor=this.actor;const C={type:this.type,uid:r.uid,tileID:r.tileID,zoom:r.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,subdivisionGranularity:this.map.style.projection.subdivisionGranularity};r.abortController=new AbortController;const k=yield this.actor.sendAsync({type:p,data:C},r.abortController);delete r.abortController,r.unloadVectorData(),r.aborted||r.loadVectorData(k,this.map.painter,p==="RT")})}abortTile(r){return t._(this,void 0,void 0,function*(){r.abortController&&(r.abortController.abort(),delete r.abortController),r.aborted=!0})}unloadTile(r){return t._(this,void 0,void 0,function*(){r.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:r.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return t.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}class ii extends t.E{constructor(r,p,C,k){super(),this.flippedWindingOrder=!1,this.id=r,this.dispatcher=C,this.coordinates=p.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(k),this.options=p}load(r){return t._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new t.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const p=yield Le.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,p&&p.data&&(this.image=p.data,r&&(this.coordinates=r),this._finishLoading())}catch(p){this._request=null,this._loaded=!0,this.fire(new t.j(p))}})}loaded(){return this._loaded}updateImage(r){return r.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=r.url,this.load(r.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new t.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(r){this.coordinates=r;const p=r.map(t.Y.fromLngLat);var C;return this.tileID=function(k){let j=1/0,Z=1/0,re=-1/0,ue=-1/0;for(const ze of k)j=Math.min(j,ze.x),Z=Math.min(Z,ze.y),re=Math.max(re,ze.x),ue=Math.max(ue,ze.y);const ye=Math.max(re-j,ue-Z),Me=Math.max(0,Math.floor(-Math.log(ye)/Math.LN2)),Re=Math.pow(2,Me);return new t.Z(Me,Math.floor((j+re)/2*Re),Math.floor((Z+ue)/2*Re))}(p),this.minzoom=this.maxzoom=this.tileID.z,this.tileCoords=p.map(k=>this.tileID.getTilePoint(k)._round()),this.flippedWindingOrder=((C=this.tileCoords)[1].x-C[0].x)*(C[2].y-C[0].y)-(C[1].y-C[0].y)*(C[2].x-C[0].x)<0,this.fire(new t.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const r=this.map.painter.context,p=r.gl;this.texture||(this.texture=new qe(r,this.image,p.RGBA),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE));let C=!1;for(const k in this.tiles){const j=this.tiles[k];j.state!=="loaded"&&(j.state="loaded",j.texture=this.texture,C=!0)}C&&this.fire(new t.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(r){return t._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={}):r.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class wi extends ii{constructor(r,p,C,k){super(r,p,C,k),this.roundZoom=!0,this.type="video",this.options=p}load(){return t._(this,void 0,void 0,function*(){this._loaded=!1;const r=this.options;this.urls=[];for(const p of r.urls)this.urls.push(this.map._requestManager.transformRequest(p,"Source").url);try{const p=yield t.a0(this.urls);if(this._loaded=!0,!p)return;this.video=p,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(p){this.fire(new t.j(p))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(r){if(this.video){const p=this.video.seekable;r<p.start(0)||r>p.end(0)?this.fire(new t.j(new t.$(`sources.${this.id}`,null,`Playback for this video can be set only between the ${p.start(0)} and ${p.end(0)}-second mark.`))):this.video.currentTime=r}}getVideo(){return this.video}onAdd(r){this.map||(this.map=r,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const r=this.map.painter.context,p=r.gl;this.texture?this.video.paused||(this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE),p.texSubImage2D(p.TEXTURE_2D,0,0,0,p.RGBA,p.UNSIGNED_BYTE,this.video)):(this.texture=new qe(r,this.video,p.RGBA),this.texture.bind(p.LINEAR,p.CLAMP_TO_EDGE));let C=!1;for(const k in this.tiles){const j=this.tiles[k];j.state!=="loaded"&&(j.state="loaded",j.texture=this.texture,C=!0)}C&&this.fire(new t.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Ki extends ii{constructor(r,p,C,k){super(r,p,C,k),p.coordinates?Array.isArray(p.coordinates)&&p.coordinates.length===4&&!p.coordinates.some(j=>!Array.isArray(j)||j.length!==2||j.some(Z=>typeof Z!="number"))||this.fire(new t.j(new t.$(`sources.${r}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.j(new t.$(`sources.${r}`,null,'missing required property "coordinates"'))),p.animate&&typeof p.animate!="boolean"&&this.fire(new t.j(new t.$(`sources.${r}`,null,'optional "animate" property must be a boolean value'))),p.canvas?typeof p.canvas=="string"||p.canvas instanceof HTMLCanvasElement||this.fire(new t.j(new t.$(`sources.${r}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.j(new t.$(`sources.${r}`,null,'missing required property "canvas"'))),this.options=p,this.animate=p.animate===void 0||p.animate}load(){return t._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(r){this.map=r,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let r=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,r=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,r=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const p=this.map.painter.context,C=p.gl;this.texture?(r||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new qe(p,this.canvas,C.RGBA,{premultiply:!0});let k=!1;for(const j in this.tiles){const Z=this.tiles[j];Z.state!=="loaded"&&(Z.state="loaded",Z.texture=this.texture,k=!0)}k&&this.fire(new t.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const r of[this.canvas.width,this.canvas.height])if(isNaN(r)||r<=0)return!0;return!1}}const Vi={},ui=B=>{switch(B){case"geojson":return vi;case"image":return ii;case"raster":return Cn;case"raster-dem":return zn;case"vector":return bn;case"video":return wi;case"canvas":return Ki}return Vi[B]},pr="RTLPluginLoaded";class Er extends t.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=qn()}_syncState(r){return this.status=r,this.dispatcher.broadcast("SRPS",{pluginStatus:r,pluginURL:this.url}).catch(p=>{throw this.status="error",p})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(r){return t._(this,arguments,void 0,function*(p,C=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=J.resolveURL(p),!this.url)throw new Error(`requested url ${p} is invalid`);if(this.status==="unavailable"){if(!C)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return t._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new t.k(pr))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let sa=null;function Ar(){return sa||(sa=new Er),sa}class Ta{constructor(r,p){this.timeAdded=0,this.fadeEndTime=0,this.tileID=r,this.uid=t.a1(),this.uses=0,this.tileSize=p,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(r){const p=r+this.timeAdded;p<this.fadeEndTime||(this.fadeEndTime=p)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(r){this.demTexture&&r.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(r,p,C){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(k,j){const Z={};if(!j)return Z;for(const re of k){const ue=re.layerIds.map(ye=>j.getLayer(ye)).filter(Boolean);if(ue.length!==0){re.layers=ue,re.stateDependentLayerIds&&(re.stateDependentLayers=re.stateDependentLayerIds.map(ye=>ue.filter(Me=>Me.id===ye)[0]));for(const ye of ue)Z[ye.id]=re}}return Z}(r.buckets,p==null?void 0:p.style),this.hasSymbolBuckets=!1;for(const k in this.buckets){const j=this.buckets[k];if(j instanceof t.a3){if(this.hasSymbolBuckets=!0,!C)break;j.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const k in this.buckets){const j=this.buckets[k];if(j instanceof t.a3&&j.hasRTLText){this.hasRTLText=!0,Ar().lazyLoad();break}}this.queryPadding=0;for(const k in this.buckets){const j=this.buckets[k];this.queryPadding=Math.max(this.queryPadding,p.style.getLayer(k).queryRadius(j))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage)}else this.collisionBoxArray=new t.a2}unloadVectorData(){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(r){return this.buckets[r.id]}upload(r){for(const C in this.buckets){const k=this.buckets[C];k.uploadPending()&&k.upload(r)}const p=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new qe(r,this.imageAtlas.image,p.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new qe(r,this.glyphAtlasImage,p.ALPHA),this.glyphAtlasImage=null)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,p,C,k,j,Z,re,ue,ye,Me){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:k,cameraQueryGeometry:j,scale:Z,tileSize:this.tileSize,pixelPosMatrix:Me,transform:ue,params:re,queryPadding:this.queryPadding*ye},r,p,C):{}}querySourceFeatures(r,p){const C=this.latestFeatureIndex;if(!C||!C.rawTileData)return;const k=C.loadVTLayers(),j=p&&p.sourceLayer?p.sourceLayer:"",Z=k._geojsonTileLayer||k[j];if(!Z)return;const re=t.a4(p&&p.filter),{z:ue,x:ye,y:Me}=this.tileID.canonical,Re={z:ue,x:ye,y:Me};for(let ze=0;ze<Z.length;ze++){const Je=Z.feature(ze);if(re.needGeometry){const Et=t.a5(Je,!0);if(!re.filter(new t.z(this.tileID.overscaledZ),Et,this.tileID.canonical))continue}else if(!re.filter(new t.z(this.tileID.overscaledZ),Je))continue;const ot=C.getId(Je,j),Pt=new t.a6(Je,ue,ye,Me,ot);Pt.tile=Re,r.push(Pt)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const p=this.expirationTime;if(r.cacheControl){const C=t.a7(r.cacheControl);C["max-age"]&&(this.expirationTime=Date.now()+1e3*C["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const C=Date.now();let k=!1;if(this.expirationTime>C)k=!1;else if(p)if(this.expirationTime<p)k=!0;else{const j=this.expirationTime-p;j?this.expirationTime=C+Math.max(j,3e4):k=!0}else k=!0;k?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(r,p){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(r).length===0)return;const C=this.latestFeatureIndex.loadVTLayers();for(const k in this.buckets){if(!p.style.hasLayer(k))continue;const j=this.buckets[k],Z=j.layers[0].sourceLayer||"_geojsonTileLayer",re=C[Z],ue=r[Z];if(!re||!ue||Object.keys(ue).length===0)continue;j.update(ue,re,this.imageAtlas&&this.imageAtlas.patternPositions||{});const ye=p&&p.style&&p.style.getLayer(k);ye&&(this.queryPadding=Math.max(this.queryPadding,ye.queryRadius(j)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<J.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=J.now()+r}setDependencies(r,p){const C={};for(const k of p)C[k]=!0;this.dependencies[r]=C}hasDependency(r,p){for(const C of r){const k=this.dependencies[C];if(k){for(const j of p)if(k[j])return!0}}return!1}}class Qa{constructor(r,p){this.max=r,this.onRemove=p,this.reset()}reset(){for(const r in this.data)for(const p of this.data[r])p.timeout&&clearTimeout(p.timeout),this.onRemove(p.value);return this.data={},this.order=[],this}add(r,p,C){const k=r.wrapped().key;this.data[k]===void 0&&(this.data[k]=[]);const j={value:p,timeout:void 0};if(C!==void 0&&(j.timeout=setTimeout(()=>{this.remove(r,j)},C)),this.data[k].push(j),this.order.push(k),this.order.length>this.max){const Z=this._getAndRemoveByKey(this.order[0]);Z&&this.onRemove(Z)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const p=this.data[r].shift();return p.timeout&&clearTimeout(p.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),p.value}getByKey(r){const p=this.data[r];return p?p[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,p){if(!this.has(r))return this;const C=r.wrapped().key,k=p===void 0?0:this.data[C].indexOf(p),j=this.data[C][k];return this.data[C].splice(k,1),j.timeout&&clearTimeout(j.timeout),this.data[C].length===0&&delete this.data[C],this.onRemove(j.value),this.order.splice(this.order.indexOf(C),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const p=this._getAndRemoveByKey(this.order[0]);p&&this.onRemove(p)}return this}filter(r){const p=[];for(const C in this.data)for(const k of this.data[C])r(k.value)||p.push(k);for(const C of p)this.remove(C.value.tileID,C)}}class Os{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,p,C){const k=String(p);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][k]=this.stateChanges[r][k]||{},t.e(this.stateChanges[r][k],C),this.deletedStates[r]===null){this.deletedStates[r]={};for(const j in this.state[r])j!==k&&(this.deletedStates[r][j]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][k]===null){this.deletedStates[r][k]={};for(const j in this.state[r][k])C[j]||(this.deletedStates[r][k][j]=null)}else for(const j in C)this.deletedStates[r]&&this.deletedStates[r][k]&&this.deletedStates[r][k][j]===null&&delete this.deletedStates[r][k][j]}removeFeatureState(r,p,C){if(this.deletedStates[r]===null)return;const k=String(p);if(this.deletedStates[r]=this.deletedStates[r]||{},C&&p!==void 0)this.deletedStates[r][k]!==null&&(this.deletedStates[r][k]=this.deletedStates[r][k]||{},this.deletedStates[r][k][C]=null);else if(p!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][k])for(C in this.deletedStates[r][k]={},this.stateChanges[r][k])this.deletedStates[r][k][C]=null;else this.deletedStates[r][k]=null;else this.deletedStates[r]=null}getState(r,p){const C=String(p),k=t.e({},(this.state[r]||{})[C],(this.stateChanges[r]||{})[C]);if(this.deletedStates[r]===null)return{};if(this.deletedStates[r]){const j=this.deletedStates[r][p];if(j===null)return{};for(const Z in j)delete k[Z]}return k}initializeTileState(r,p){r.setFeatureState(this.state,p)}coalesceChanges(r,p){const C={};for(const k in this.stateChanges){this.state[k]=this.state[k]||{};const j={};for(const Z in this.stateChanges[k])this.state[k][Z]||(this.state[k][Z]={}),t.e(this.state[k][Z],this.stateChanges[k][Z]),j[Z]=this.state[k][Z];C[k]=j}for(const k in this.deletedStates){this.state[k]=this.state[k]||{};const j={};if(this.deletedStates[k]===null)for(const Z in this.state[k])j[Z]={},this.state[k][Z]={};else for(const Z in this.deletedStates[k]){if(this.deletedStates[k][Z]===null)this.state[k][Z]={};else for(const re of Object.keys(this.deletedStates[k][Z]))delete this.state[k][Z][re];j[Z]=this.state[k][Z]}C[k]=C[k]||{},t.e(C[k],j)}if(this.stateChanges={},this.deletedStates={},Object.keys(C).length!==0)for(const k in r)r[k].setFeatureState(C,p)}}function As(B,r,p){const C=r.intersectsFrustum(B);if(!p)return C;const k=r.intersectsPlane(p);return C===0||k===0?0:C===2&&k===2?2:1}function to(B,r,p,C,k){let j=B;const Z=Math.atan(r/p),re=Math.hypot(r,p);return j=B+t.a8(C/re/Math.max(.5,Math.cos(t.aa(k/2)))),j+=1*t.a8(Math.cos(Z))/2,j+=t.ab(B-j,-0,0),j}function ko(B,r){const p=(r.roundZoom?Math.round:Math.floor)(B.zoom+t.a8(B.tileSize/r.tileSize));return Math.max(0,p)}function bt(B,r){const p=B.getCameraFrustum(),C=B.getClippingPlane(),k=B.screenPointToMercatorCoordinate(B.getCameraPoint()),j=t.Y.fromLngLat(B.center,B.elevation);k.z=j.z+Math.cos(B.pitchInRadians)*B.cameraToCenterDistance/B.worldSize;const Z=B.getCoveringTilesDetailsProvider(),re=Z.allowVariableZoom(B,r),ue=ko(B,r),ye=r.minzoom||0,Me=r.maxzoom!==void 0?r.maxzoom:B.maxZoom,Re=Math.min(Math.max(0,ue),Me),ze=Math.pow(2,Re),Je=[ze*k.x,ze*k.y,0],ot=[ze*j.x,ze*j.y,0],Pt=Math.hypot(j.x-k.x,j.y-k.y),Et=Math.abs(j.z-k.z),Lt=Math.hypot(Pt,Et),jt=nn=>({zoom:0,x:0,y:0,wrap:nn,fullyVisible:!1}),Nt=[],Bt=[];if(B.renderWorldCopies&&Z.allowWorldCopies())for(let nn=1;nn<=3;nn++)Nt.push(jt(-nn)),Nt.push(jt(nn));for(Nt.push(jt(0));Nt.length>0;){const nn=Nt.pop(),rn=nn.x,an=nn.y;let Mn=nn.fullyVisible;const Rn={x:rn,y:an,z:nn.zoom},Hn=Z.getTileAABB(Rn,nn.wrap,B.elevation,r);if(!Mn){const zi=As(p,Hn,C);if(zi===0)continue;Mn=zi===2}const ei=Z.distanceToTile2d(k.x,k.y,Rn,Hn);let jn=ue;re&&(jn=(r.calculateTileZoom||to)(B.zoom+t.a8(B.tileSize/r.tileSize),ei,Et,Lt,B.fov)),jn=(r.roundZoom?Math.round:Math.floor)(jn),jn=Math.max(0,jn);const Ri=Math.min(jn,Me);if(nn.wrap=Z.getWrap(j,Rn,nn.wrap),nn.zoom>=Ri){if(nn.zoom<ye)continue;const zi=Re-nn.zoom,xi=Je[0]-.5-(rn<<zi),Gi=Je[1]-.5-(an<<zi),Hr=r.reparseOverscaled?Math.max(nn.zoom,jn):nn.zoom;Bt.push({tileID:new t.S(nn.zoom===Me?Hr:nn.zoom,nn.wrap,nn.zoom,rn,an),distanceSq:t.a9([ot[0]-.5-rn,ot[1]-.5-an]),tileDistanceToCamera:Math.sqrt(xi*xi+Gi*Gi)})}else for(let zi=0;zi<4;zi++)Nt.push({zoom:nn.zoom+1,x:(rn<<1)+zi%2,y:(an<<1)+(zi>>1),wrap:nn.wrap,fullyVisible:Mn})}return Bt.sort((nn,rn)=>nn.distanceSq-rn.distanceSq).map(nn=>nn.tileID)}class Qe extends t.E{constructor(r,p,C){super(),this.id=r,this.dispatcher=C,this.on("data",k=>this._dataHandler(k)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((k,j,Z,re)=>{const ue=new(ui(j.type))(k,j,Z,re);if(ue.id!==k)throw new Error(`Expected Source id to be ${k} instead of ${ue.id}`);return ue})(r,p,C,this),this._tiles={},this._cache=new Qa(0,k=>this._unloadTile(k)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Os,this._didEmitContent=!1,this._updated=!1}onAdd(r){this.map=r,this._maxTileCacheSize=r?r._maxTileCacheSize:null,this._maxTileCacheZoomLevels=r?r._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(r)}onRemove(r){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(r)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const r in this._tiles){const p=this._tiles[r];if(p.state!=="loaded"&&p.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(r,p,C){return t._(this,void 0,void 0,function*(){try{yield this._source.loadTile(r),this._tileLoaded(r,p,C)}catch(k){r.state="errored",k.status!==404?this._source.fire(new t.j(k,{tile:r})):this.update(this.transform,this.terrain)}})}_unloadTile(r){this._source.unloadTile&&this._source.unloadTile(r)}_abortTile(r){this._source.abortTile&&this._source.abortTile(r),this._source.fire(new t.k("dataabort",{tile:r,coord:r.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const p in this._tiles){const C=this._tiles[p];C.upload(r),C.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(r=>r.tileID).sort(dt).map(r=>r.key)}getRenderableIds(r){const p=[];for(const C in this._tiles)this._isIdRenderable(C,r)&&p.push(this._tiles[C]);return r?p.sort((C,k)=>{const j=C.tileID,Z=k.tileID,re=new t.P(j.canonical.x,j.canonical.y)._rotate(-this.transform.bearingInRadians),ue=new t.P(Z.canonical.x,Z.canonical.y)._rotate(-this.transform.bearingInRadians);return j.overscaledZ-Z.overscaledZ||ue.y-re.y||ue.x-re.x}).map(C=>C.tileID.key):p.map(C=>C.tileID).sort(dt).map(C=>C.key)}hasRenderableParent(r){const p=this.findLoadedParent(r,0);return!!p&&this._isIdRenderable(p.tileID.key)}_isIdRenderable(r,p){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(p||!this._tiles[r].holdingForFade())}reload(r){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const p in this._tiles)(r||this._tiles[p].state!=="errored")&&this._reloadTile(p,"reloading")}}_reloadTile(r,p){return t._(this,void 0,void 0,function*(){const C=this._tiles[r];C&&(C.state!=="loading"&&(C.state=p),yield this._loadTile(C,r,p))})}_tileLoaded(r,p,C){r.timeAdded=J.now(),C==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(p,r),this.getSource().type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),r.aborted||this._source.fire(new t.k("data",{dataType:"source",tile:r,coord:r.tileID}))}_backfillDEM(r){const p=this.getRenderableIds();for(let k=0;k<p.length;k++){const j=p[k];if(r.neighboringTiles&&r.neighboringTiles[j]){const Z=this.getTileByID(j);C(r,Z),C(Z,r)}}function C(k,j){k.needsHillshadePrepare=!0,k.needsTerrainPrepare=!0;let Z=j.tileID.canonical.x-k.tileID.canonical.x;const re=j.tileID.canonical.y-k.tileID.canonical.y,ue=Math.pow(2,k.tileID.canonical.z),ye=j.tileID.key;Z===0&&re===0||Math.abs(re)>1||(Math.abs(Z)>1&&(Math.abs(Z+ue)===1?Z+=ue:Math.abs(Z-ue)===1&&(Z-=ue)),j.dem&&k.dem&&(k.dem.backfillBorder(j.dem,Z,re),k.neighboringTiles&&k.neighboringTiles[ye]&&(k.neighboringTiles[ye].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,p,C,k){for(const j in this._tiles){let Z=this._tiles[j];if(k[j]||!Z.hasData()||Z.tileID.overscaledZ<=p||Z.tileID.overscaledZ>C)continue;let re=Z.tileID;for(;Z&&Z.tileID.overscaledZ>p+1;){const ye=Z.tileID.scaledTo(Z.tileID.overscaledZ-1);Z=this._tiles[ye.key],Z&&Z.hasData()&&(re=ye)}let ue=re;for(;ue.overscaledZ>p;)if(ue=ue.scaledTo(ue.overscaledZ-1),r[ue.key]||r[ue.canonical.key]){k[re.key]=re;break}}}findLoadedParent(r,p){if(r.key in this._loadedParentTiles){const C=this._loadedParentTiles[r.key];return C&&C.tileID.overscaledZ>=p?C:null}for(let C=r.overscaledZ-1;C>=p;C--){const k=r.scaledTo(C),j=this._getLoadedTile(k);if(j)return j}}findLoadedSibling(r){return this._getLoadedTile(r)}_getLoadedTile(r){const p=this._tiles[r.key];return p&&p.hasData()?p:this._cache.getByKey(r.wrapped().key)}updateCacheSize(r){const p=Math.ceil(r.width/this._source.tileSize)+1,C=Math.ceil(r.height/this._source.tileSize)+1,k=Math.floor(p*C*(this._maxTileCacheZoomLevels===null?t.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),j=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,k):k;this._cache.setMaxSize(j)}handleWrapJump(r){const p=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,p){const C={};for(const k in this._tiles){const j=this._tiles[k];j.tileID=j.tileID.unwrapTo(j.tileID.wrap+p),C[j.tileID.key]=j}this._tiles=C;for(const k in this._timers)clearTimeout(this._timers[k]),delete this._timers[k];for(const k in this._tiles)this._setTileReloadTimer(k,this._tiles[k])}}_updateCoveredAndRetainedTiles(r,p,C,k,j,Z){const re={},ue={},ye=Object.keys(r),Me=J.now();for(const Re of ye){const ze=r[Re],Je=this._tiles[Re];if(!Je||Je.fadeEndTime!==0&&Je.fadeEndTime<=Me)continue;const ot=this.findLoadedParent(ze,p),Pt=this.findLoadedSibling(ze),Et=ot||Pt||null;Et&&(this._addTile(Et.tileID),re[Et.tileID.key]=Et.tileID),ue[Re]=ze}this._retainLoadedChildren(ue,k,C,r);for(const Re in re)r[Re]||(this._coveredTiles[Re]=!0,r[Re]=re[Re]);if(Z){const Re={},ze={};for(const Je of j)this._tiles[Je.key].hasData()?Re[Je.key]=Je:ze[Je.key]=Je;for(const Je in ze){const ot=ze[Je].children(this._source.maxzoom);this._tiles[ot[0].key]&&this._tiles[ot[1].key]&&this._tiles[ot[2].key]&&this._tiles[ot[3].key]&&(Re[ot[0].key]=r[ot[0].key]=ot[0],Re[ot[1].key]=r[ot[1].key]=ot[1],Re[ot[2].key]=r[ot[2].key]=ot[2],Re[ot[3].key]=r[ot[3].key]=ot[3],delete ze[Je])}for(const Je in ze){const ot=ze[Je],Pt=this.findLoadedParent(ot,this._source.minzoom),Et=this.findLoadedSibling(ot),Lt=Pt||Et||null;if(Lt){Re[Lt.tileID.key]=r[Lt.tileID.key]=Lt.tileID;for(const jt in Re)Re[jt].isChildOf(Lt.tileID)&&delete Re[jt]}}for(const Je in this._tiles)Re[Je]||(this._coveredTiles[Je]=!0)}}update(r,p){if(!this._sourceLoaded||this._paused)return;let C;this.transform=r,this.terrain=p,this.updateCacheSize(r),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?C=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(Me=>new t.S(Me.canonical.z,Me.wrap,Me.canonical.z,Me.canonical.x,Me.canonical.y)):(C=bt(r,{tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:p,calculateTileZoom:this._source.calculateTileZoom}),this._source.hasTile&&(C=C.filter(Me=>this._source.hasTile(Me)))):C=[];const k=ko(r,this._source),j=Math.max(k-Qe.maxOverzooming,this._source.minzoom),Z=Math.max(k+Qe.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const Me={};for(const Re of C)if(Re.canonical.z>this._source.minzoom){const ze=Re.scaledTo(Re.canonical.z-1);Me[ze.key]=ze;const Je=Re.scaledTo(Math.max(this._source.minzoom,Math.min(Re.canonical.z,5)));Me[Je.key]=Je}C=C.concat(Object.values(Me))}const re=C.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,re&&this.fire(new t.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const ue=this._updateRetainedTiles(C,k);it(this._source.type)&&this._updateCoveredAndRetainedTiles(ue,j,Z,k,C,p);for(const Me in ue)this._tiles[Me].clearFadeHold();const ye=t.ac(this._tiles,ue);for(const Me of ye){const Re=this._tiles[Me];Re.hasSymbolBuckets&&!Re.holdingForFade()?Re.setHoldDuration(this.map._fadeDuration):Re.hasSymbolBuckets&&!Re.symbolFadeFinished()||this._removeTile(Me)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(r)}_updateRetainedTiles(r,p){var C;const k={},j={},Z=Math.max(p-Qe.maxOverzooming,this._source.minzoom),re=Math.max(p+Qe.maxUnderzooming,this._source.minzoom),ue={};for(const ye of r){const Me=this._addTile(ye);k[ye.key]=ye,Me.hasData()||p<this._source.maxzoom&&(ue[ye.key]=ye)}this._retainLoadedChildren(ue,p,re,k);for(const ye of r){let Me=this._tiles[ye.key];if(Me.hasData())continue;if(p+1>this._source.maxzoom){const ze=ye.children(this._source.maxzoom)[0],Je=this.getTile(ze);if(Je&&Je.hasData()){k[ze.key]=ze;continue}}else{const ze=ye.children(this._source.maxzoom);if(k[ze[0].key]&&k[ze[1].key]&&k[ze[2].key]&&k[ze[3].key])continue}let Re=Me.wasRequested();for(let ze=ye.overscaledZ-1;ze>=Z;--ze){const Je=ye.scaledTo(ze);if(j[Je.key])break;if(j[Je.key]=!0,Me=this.getTile(Je),!Me&&Re&&(Me=this._addTile(Je)),Me){const ot=Me.hasData();if((ot||!(!((C=this.map)===null||C===void 0)&&C.cancelPendingTileRequestsWhileZooming)||Re)&&(k[Je.key]=Je),Re=Me.wasRequested(),ot)break}}}return k}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const p=[];let C,k=this._tiles[r].tileID;for(;k.overscaledZ>0;){if(k.key in this._loadedParentTiles){C=this._loadedParentTiles[k.key];break}p.push(k.key);const j=k.scaledTo(k.overscaledZ-1);if(C=this._getLoadedTile(j),C)break;k=j}for(const j of p)this._loadedParentTiles[j]=C}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const r in this._tiles){const p=this._tiles[r].tileID,C=this._getLoadedTile(p);this._loadedSiblingTiles[p.key]=C}}_addTile(r){let p=this._tiles[r.key];if(p)return p;p=this._cache.getAndRemove(r),p&&(this._setTileReloadTimer(r.key,p),p.tileID=r,this._state.initializeTileState(p,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,p)));const C=p;return p||(p=new Ta(r,this._source.tileSize*r.overscaleFactor()),this._loadTile(p,r.key,p.state)),p.uses++,this._tiles[r.key]=p,C||this._source.fire(new t.k("dataloading",{tile:p,coord:p.tileID,dataType:"source"})),p}_setTileReloadTimer(r,p){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const C=p.getExpiryTimeout();C&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},C))}_removeTile(r){const p=this._tiles[r];p&&(p.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),p.uses>0||(p.hasData()&&p.state!=="reloading"?this._cache.add(p.tileID,p,p.getExpiryTimeout()):(p.aborted=!0,this._abortTile(p),this._unloadTile(p))))}_dataHandler(r){const p=r.sourceDataType;r.dataType==="source"&&p==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&r.dataType==="source"&&p==="content"&&(this.reload(r.sourceDataChanged),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(r);this._cache.reset()}tilesIn(r,p,C){const k=[],j=this.transform;if(!j)return k;const Z=C?j.getCameraQueryGeometry(r):r,re=r.map(ot=>j.screenPointToMercatorCoordinate(ot,this.terrain)),ue=Z.map(ot=>j.screenPointToMercatorCoordinate(ot,this.terrain)),ye=this.getIds();let Me=1/0,Re=1/0,ze=-1/0,Je=-1/0;for(const ot of ue)Me=Math.min(Me,ot.x),Re=Math.min(Re,ot.y),ze=Math.max(ze,ot.x),Je=Math.max(Je,ot.y);for(let ot=0;ot<ye.length;ot++){const Pt=this._tiles[ye[ot]];if(Pt.holdingForFade())continue;const Et=Pt.tileID,Lt=Math.pow(2,j.zoom-Pt.tileID.overscaledZ),jt=p*Pt.queryPadding*t.X/Pt.tileSize/Lt,Nt=[Et.getTilePoint(new t.Y(Me,Re)),Et.getTilePoint(new t.Y(ze,Je))];if(Nt[0].x-jt<t.X&&Nt[0].y-jt<t.X&&Nt[1].x+jt>=0&&Nt[1].y+jt>=0){const Bt=re.map(rn=>Et.getTilePoint(rn)),nn=ue.map(rn=>Et.getTilePoint(rn));k.push({tile:Pt,tileID:Et,queryGeometry:Bt,cameraQueryGeometry:nn,scale:Lt})}}return k}getVisibleCoordinates(r){const p=this.getRenderableIds(r).map(C=>this._tiles[C].tileID);return this.transform&&this.transform.populateCache(p),p}hasTransition(){if(this._source.hasTransition())return!0;if(it(this._source.type)){const r=J.now();for(const p in this._tiles)if(this._tiles[p].fadeEndTime>=r)return!0}return!1}setFeatureState(r,p,C){this._state.updateState(r=r||"_geojsonTileLayer",p,C)}removeFeatureState(r,p,C){this._state.removeFeatureState(r=r||"_geojsonTileLayer",p,C)}getFeatureState(r,p){return this._state.getState(r=r||"_geojsonTileLayer",p)}setDependencies(r,p,C){const k=this._tiles[r];k&&k.setDependencies(p,C)}reloadTilesForDependencies(r,p){for(const C in this._tiles)this._tiles[C].hasDependency(r,p)&&this._reloadTile(C,"reloading");this._cache.filter(C=>!C.hasDependency(r,p))}}function dt(B,r){const p=Math.abs(2*B.wrap)-+(B.wrap<0),C=Math.abs(2*r.wrap)-+(r.wrap<0);return B.overscaledZ-r.overscaledZ||C-p||r.canonical.y-B.canonical.y||r.canonical.x-B.canonical.x}function it(B){return B==="raster"||B==="image"||B==="video"}Qe.maxOverzooming=10,Qe.maxUnderzooming=3;class Ut{constructor(r,p){this.reset(r,p)}reset(r,p){this.points=r||[],this._distances=[0];for(let C=1;C<this.points.length;C++)this._distances[C]=this._distances[C-1]+this.points[C].dist(this.points[C-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(p||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=t.ab(r,0,1);let p=1,C=this._distances[p];const k=r*this.paddedLength+this.padding;for(;C<k&&p<this._distances.length;)C=this._distances[++p];const j=p-1,Z=this._distances[j],re=C-Z,ue=re>0?(k-Z)/re:0;return this.points[j].mult(1-ue).add(this.points[p].mult(ue))}}function on(B,r){let p=!0;return B==="always"||B!=="never"&&r!=="never"||(p=!1),p}class un{constructor(r,p,C){const k=this.boxCells=[],j=this.circleCells=[];this.xCellCount=Math.ceil(r/C),this.yCellCount=Math.ceil(p/C);for(let Z=0;Z<this.xCellCount*this.yCellCount;Z++)k.push([]),j.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=p,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/p,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,p,C,k,j){this._forEachCell(p,C,k,j,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(p),this.bboxes.push(C),this.bboxes.push(k),this.bboxes.push(j)}insertCircle(r,p,C,k){this._forEachCell(p-k,C-k,p+k,C+k,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(p),this.circles.push(C),this.circles.push(k)}_insertBoxCell(r,p,C,k,j,Z){this.boxCells[j].push(Z)}_insertCircleCell(r,p,C,k,j,Z){this.circleCells[j].push(Z)}_query(r,p,C,k,j,Z,re){if(C<0||r>this.width||k<0||p>this.height)return[];const ue=[];if(r<=0&&p<=0&&this.width<=C&&this.height<=k){if(j)return[{key:null,x1:r,y1:p,x2:C,y2:k}];for(let ye=0;ye<this.boxKeys.length;ye++)ue.push({key:this.boxKeys[ye],x1:this.bboxes[4*ye],y1:this.bboxes[4*ye+1],x2:this.bboxes[4*ye+2],y2:this.bboxes[4*ye+3]});for(let ye=0;ye<this.circleKeys.length;ye++){const Me=this.circles[3*ye],Re=this.circles[3*ye+1],ze=this.circles[3*ye+2];ue.push({key:this.circleKeys[ye],x1:Me-ze,y1:Re-ze,x2:Me+ze,y2:Re+ze})}}else this._forEachCell(r,p,C,k,this._queryCell,ue,{hitTest:j,overlapMode:Z,seenUids:{box:{},circle:{}}},re);return ue}query(r,p,C,k){return this._query(r,p,C,k,!1,null)}hitTest(r,p,C,k,j,Z){return this._query(r,p,C,k,!0,j,Z).length>0}hitTestCircle(r,p,C,k,j){const Z=r-C,re=r+C,ue=p-C,ye=p+C;if(re<0||Z>this.width||ye<0||ue>this.height)return!1;const Me=[];return this._forEachCell(Z,ue,re,ye,this._queryCellCircle,Me,{hitTest:!0,overlapMode:k,circle:{x:r,y:p,radius:C},seenUids:{box:{},circle:{}}},j),Me.length>0}_queryCell(r,p,C,k,j,Z,re,ue){const{seenUids:ye,hitTest:Me,overlapMode:Re}=re,ze=this.boxCells[j];if(ze!==null){const ot=this.bboxes;for(const Pt of ze)if(!ye.box[Pt]){ye.box[Pt]=!0;const Et=4*Pt,Lt=this.boxKeys[Pt];if(r<=ot[Et+2]&&p<=ot[Et+3]&&C>=ot[Et+0]&&k>=ot[Et+1]&&(!ue||ue(Lt))&&(!Me||!on(Re,Lt.overlapMode))&&(Z.push({key:Lt,x1:ot[Et],y1:ot[Et+1],x2:ot[Et+2],y2:ot[Et+3]}),Me))return!0}}const Je=this.circleCells[j];if(Je!==null){const ot=this.circles;for(const Pt of Je)if(!ye.circle[Pt]){ye.circle[Pt]=!0;const Et=3*Pt,Lt=this.circleKeys[Pt];if(this._circleAndRectCollide(ot[Et],ot[Et+1],ot[Et+2],r,p,C,k)&&(!ue||ue(Lt))&&(!Me||!on(Re,Lt.overlapMode))){const jt=ot[Et],Nt=ot[Et+1],Bt=ot[Et+2];if(Z.push({key:Lt,x1:jt-Bt,y1:Nt-Bt,x2:jt+Bt,y2:Nt+Bt}),Me)return!0}}}return!1}_queryCellCircle(r,p,C,k,j,Z,re,ue){const{circle:ye,seenUids:Me,overlapMode:Re}=re,ze=this.boxCells[j];if(ze!==null){const ot=this.bboxes;for(const Pt of ze)if(!Me.box[Pt]){Me.box[Pt]=!0;const Et=4*Pt,Lt=this.boxKeys[Pt];if(this._circleAndRectCollide(ye.x,ye.y,ye.radius,ot[Et+0],ot[Et+1],ot[Et+2],ot[Et+3])&&(!ue||ue(Lt))&&!on(Re,Lt.overlapMode))return Z.push(!0),!0}}const Je=this.circleCells[j];if(Je!==null){const ot=this.circles;for(const Pt of Je)if(!Me.circle[Pt]){Me.circle[Pt]=!0;const Et=3*Pt,Lt=this.circleKeys[Pt];if(this._circlesCollide(ot[Et],ot[Et+1],ot[Et+2],ye.x,ye.y,ye.radius)&&(!ue||ue(Lt))&&!on(Re,Lt.overlapMode))return Z.push(!0),!0}}}_forEachCell(r,p,C,k,j,Z,re,ue){const ye=this._convertToXCellCoord(r),Me=this._convertToYCellCoord(p),Re=this._convertToXCellCoord(C),ze=this._convertToYCellCoord(k);for(let Je=ye;Je<=Re;Je++)for(let ot=Me;ot<=ze;ot++)if(j.call(this,r,p,C,k,this.xCellCount*ot+Je,Z,re,ue))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,p,C,k,j,Z){const re=k-r,ue=j-p,ye=C+Z;return ye*ye>re*re+ue*ue}_circleAndRectCollide(r,p,C,k,j,Z,re){const ue=(Z-k)/2,ye=Math.abs(r-(k+ue));if(ye>ue+C)return!1;const Me=(re-j)/2,Re=Math.abs(p-(j+Me));if(Re>Me+C)return!1;if(ye<=ue||Re<=Me)return!0;const ze=ye-ue,Je=Re-Me;return ze*ze+Je*Je<=C*C}}function kn(B,r,p){const C=t.H();if(!B){const{vecSouth:Re,vecEast:ze}=Wn(r),Je=W();Je[0]=ze[0],Je[1]=ze[1],Je[2]=Re[0],Je[3]=Re[1],k=Je,(Me=(Z=(j=Je)[0])*(ye=j[3])-(ue=j[2])*(re=j[1]))&&(k[0]=ye*(Me=1/Me),k[1]=-re*Me,k[2]=-ue*Me,k[3]=Z*Me),C[0]=Je[0],C[1]=Je[1],C[4]=Je[2],C[5]=Je[3]}var k,j,Z,re,ue,ye,Me;return t.K(C,C,[1/p,1/p,1]),C}function fn(B,r,p,C){if(B){const k=t.H();if(!r){const{vecSouth:j,vecEast:Z}=Wn(p);k[0]=Z[0],k[1]=Z[1],k[4]=j[0],k[5]=j[1]}return t.K(k,k,[C,C,1]),k}return p.pixelsToClipSpaceMatrix}function Wn(B){const r=Math.cos(B.rollInRadians),p=Math.sin(B.rollInRadians),C=Math.cos(B.pitchInRadians),k=Math.cos(B.bearingInRadians),j=Math.sin(B.bearingInRadians),Z=t.ad();Z[0]=-k*C*p-j*r,Z[1]=-j*C*p+k*r;const re=t.ae(Z);re<1e-9?t.af(Z):t.ag(Z,Z,1/re);const ue=t.ad();ue[0]=k*C*r-j*p,ue[1]=j*C*r+k*p;const ye=t.ae(ue);return ye<1e-9?t.af(ue):t.ag(ue,ue,1/ye),{vecEast:ue,vecSouth:Z}}function Gn(B,r,p,C){let k;C?(k=[B,r,C(B,r),1],t.al(k,k,p)):(k=[B,r,0,1],Ui(k,k,p));const j=k[3];return{point:new t.P(k[0]/j,k[1]/j),signedDistanceFromCamera:j,isOccluded:!1}}function Sn(B,r){return .5+B/r*.5}function et(B,r){return B.x>=-r[0]&&B.x<=r[0]&&B.y>=-r[1]&&B.y<=r[1]}function we(B,r,p,C,k,j,Z,re,ue,ye,Me,Re,ze){const Je=p?B.textSizeData:B.iconSizeData,ot=t.ah(Je,r.transform.zoom),Pt=[256/r.width*2+1,256/r.height*2+1],Et=p?B.text.dynamicLayoutVertexArray:B.icon.dynamicLayoutVertexArray;Et.clear();const Lt=B.lineVertexArray,jt=p?B.text.placedSymbolArray:B.icon.placedSymbolArray,Nt=r.transform.width/r.transform.height;let Bt=!1;for(let nn=0;nn<jt.length;nn++){const rn=jt.get(nn);if(rn.hidden||rn.writingMode===t.ai.vertical&&!Bt){li(rn.numGlyphs,Et);continue}Bt=!1;const an=new t.P(rn.anchorX,rn.anchorY),Mn={getElevation:ze,pitchedLabelPlaneMatrix:C,lineVertexArray:Lt,pitchWithMap:j,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:r.transform,tileAnchorPoint:an,unwrappedTileID:ue,width:ye,height:Me,translation:Re},Rn=Jt(rn.anchorX,rn.anchorY,Mn);if(!et(Rn.point,Pt)){li(rn.numGlyphs,Et);continue}const Hn=Sn(r.transform.cameraToCenterDistance,Rn.signedDistanceFromCamera),ei=t.aj(Je,ot,rn),jn=j?ei*r.transform.getPitchedTextCorrection(rn.anchorX,rn.anchorY,ue)/Hn:ei*Hn,Ri=yt({projectionContext:Mn,pitchedLabelPlaneMatrixInverse:k,symbol:rn,fontSize:jn,flip:!1,keepUpright:Z,glyphOffsetArray:B.glyphOffsetArray,dynamicLayoutVertexArray:Et,aspectRatio:Nt,rotateToLine:re});Bt=Ri.useVertical,(Ri.notEnoughRoom||Bt||Ri.needsFlipping&&yt({projectionContext:Mn,pitchedLabelPlaneMatrixInverse:k,symbol:rn,fontSize:jn,flip:!0,keepUpright:Z,glyphOffsetArray:B.glyphOffsetArray,dynamicLayoutVertexArray:Et,aspectRatio:Nt,rotateToLine:re}).notEnoughRoom)&&li(rn.numGlyphs,Et)}p?B.text.dynamicLayoutVertexBuffer.updateData(Et):B.icon.dynamicLayoutVertexBuffer.updateData(Et)}function Pe(B,r,p,C,k,j,Z,re){const ue=j.glyphStartIndex+j.numGlyphs,ye=j.lineStartIndex,Me=j.lineStartIndex+j.lineLength,Re=r.getoffsetX(j.glyphStartIndex),ze=r.getoffsetX(ue-1),Je=On(B*Re,p,C,k,j.segment,ye,Me,re,Z);if(!Je)return null;const ot=On(B*ze,p,C,k,j.segment,ye,Me,re,Z);return ot?re.projectionCache.anyProjectionOccluded?null:{first:Je,last:ot}:null}function Ze(B,r,p,C){return B===t.ai.horizontal&&Math.abs(p.y-r.y)>Math.abs(p.x-r.x)*C?{useVertical:!0}:(B===t.ai.vertical?r.y<p.y:r.x>p.x)?{needsFlipping:!0}:null}function yt(B){const{projectionContext:r,pitchedLabelPlaneMatrixInverse:p,symbol:C,fontSize:k,flip:j,keepUpright:Z,glyphOffsetArray:re,dynamicLayoutVertexArray:ue,aspectRatio:ye,rotateToLine:Me}=B,Re=k/24,ze=C.lineOffsetX*Re,Je=C.lineOffsetY*Re;let ot;if(C.numGlyphs>1){const Pt=C.glyphStartIndex+C.numGlyphs,Et=C.lineStartIndex,Lt=C.lineStartIndex+C.lineLength,jt=Pe(Re,re,ze,Je,j,C,Me,r);if(!jt)return{notEnoughRoom:!0};const Nt=Dt(jt.first.point.x,jt.first.point.y,r,p),Bt=Dt(jt.last.point.x,jt.last.point.y,r,p);if(Z&&!j){const nn=Ze(C.writingMode,Nt,Bt,ye);if(nn)return nn}ot=[jt.first];for(let nn=C.glyphStartIndex+1;nn<Pt-1;nn++)ot.push(On(Re*re.getoffsetX(nn),ze,Je,j,C.segment,Et,Lt,r,Me));ot.push(jt.last)}else{if(Z&&!j){const Et=kt(r.tileAnchorPoint.x,r.tileAnchorPoint.y,r).point,Lt=C.lineStartIndex+C.segment+1,jt=new t.P(r.lineVertexArray.getx(Lt),r.lineVertexArray.gety(Lt)),Nt=kt(jt.x,jt.y,r),Bt=Nt.signedDistanceFromCamera>0?Nt.point:We(r.tileAnchorPoint,jt,Et,1,r),nn=Dt(Et.x,Et.y,r,p),rn=Dt(Bt.x,Bt.y,r,p),an=Ze(C.writingMode,nn,rn,ye);if(an)return an}const Pt=On(Re*re.getoffsetX(C.glyphStartIndex),ze,Je,j,C.segment,C.lineStartIndex,C.lineStartIndex+C.lineLength,r,Me);if(!Pt||r.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};ot=[Pt]}for(const Pt of ot)t.ak(ue,Pt.point,Pt.angle);return{}}function We(B,r,p,C,k){const j=B.add(B.sub(r)._unit()),Z=kt(j.x,j.y,k).point,re=p.sub(Z);return p.add(re._mult(C/re.mag()))}function pt(B,r,p){const C=r.projectionCache;if(C.projections[B])return C.projections[B];const k=new t.P(r.lineVertexArray.getx(B),r.lineVertexArray.gety(B)),j=kt(k.x,k.y,r);if(j.signedDistanceFromCamera>0)return C.projections[B]=j.point,C.anyProjectionOccluded=C.anyProjectionOccluded||j.isOccluded,j.point;const Z=B-p.direction;return We(p.distanceFromAnchor===0?r.tileAnchorPoint:new t.P(r.lineVertexArray.getx(Z),r.lineVertexArray.gety(Z)),k,p.previousVertex,p.absOffsetX-p.distanceFromAnchor+1,r)}function kt(B,r,p){const C=B+p.translation[0],k=r+p.translation[1];let j;return p.pitchWithMap?(j=Gn(C,k,p.pitchedLabelPlaneMatrix,p.getElevation),j.isOccluded=!1):(j=p.transform.projectTileCoordinates(C,k,p.unwrappedTileID,p.getElevation),j.point.x=(.5*j.point.x+.5)*p.width,j.point.y=(.5*-j.point.y+.5)*p.height),j}function Dt(B,r,p,C){if(p.pitchWithMap){const k=[B,r,0,1];return t.al(k,k,C),p.transform.projectTileCoordinates(k[0]/k[3],k[1]/k[3],p.unwrappedTileID,p.getElevation).point}return{x:B/p.width*2-1,y:r/p.height*2-1}}function Jt(B,r,p){return p.transform.projectTileCoordinates(B,r,p.unwrappedTileID,p.getElevation)}function Xt(B,r,p){return B._unit()._perp()._mult(r*p)}function Gt(B,r,p,C,k,j,Z,re,ue){if(re.projectionCache.offsets[B])return re.projectionCache.offsets[B];const ye=p.add(r);if(B+ue.direction<C||B+ue.direction>=k)return re.projectionCache.offsets[B]=ye,ye;const Me=pt(B+ue.direction,re,ue),Re=Xt(Me.sub(p),Z,ue.direction),ze=p.add(Re),Je=Me.add(Re);return re.projectionCache.offsets[B]=t.am(j,ye,ze,Je)||ye,re.projectionCache.offsets[B]}function On(B,r,p,C,k,j,Z,re,ue){const ye=C?B-r:B+r;let Me=ye>0?1:-1,Re=0;C&&(Me*=-1,Re=Math.PI),Me<0&&(Re+=Math.PI);let ze,Je=Me>0?j+k:j+k+1;re.projectionCache.cachedAnchorPoint?ze=re.projectionCache.cachedAnchorPoint:(ze=kt(re.tileAnchorPoint.x,re.tileAnchorPoint.y,re).point,re.projectionCache.cachedAnchorPoint=ze);let ot,Pt,Et=ze,Lt=ze,jt=0,Nt=0;const Bt=Math.abs(ye),nn=[];let rn;for(;jt+Nt<=Bt;){if(Je+=Me,Je<j||Je>=Z)return null;jt+=Nt,Lt=Et,Pt=ot;const Rn={absOffsetX:Bt,direction:Me,distanceFromAnchor:jt,previousVertex:Lt};if(Et=pt(Je,re,Rn),p===0)nn.push(Lt),rn=Et.sub(Lt);else{let Hn;const ei=Et.sub(Lt);Hn=ei.mag()===0?Xt(pt(Je+Me,re,Rn).sub(Et),p,Me):Xt(ei,p,Me),Pt||(Pt=Lt.add(Hn)),ot=Gt(Je,Hn,Et,j,Z,Pt,p,re,Rn),nn.push(Pt),rn=ot.sub(Pt)}Nt=rn.mag()}const an=rn._mult((Bt-jt)/Nt)._add(Pt||Lt),Mn=Re+Math.atan2(Et.y-Lt.y,Et.x-Lt.x);return nn.push(an),{point:an,angle:ue?Mn:0,path:nn}}const _i=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function li(B,r){for(let p=0;p<B;p++){const C=r.length;r.resize(C+4),r.float32.set(_i,3*C)}}function Ui(B,r,p){const C=r[0],k=r[1];return B[0]=p[0]*C+p[4]*k+p[12],B[1]=p[1]*C+p[5]*k+p[13],B[3]=p[3]*C+p[7]*k+p[15],B}const qi=100;class Qi{constructor(r,p=new un(r.width+200,r.height+200,25),C=new un(r.width+200,r.height+200,25)){this.transform=r,this.grid=p,this.ignoredGrid=C,this.pitchFactor=Math.cos(r.pitch*Math.PI/180)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+qi,this.screenBottomBoundary=r.height+qi,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(r,p,C,k,j,Z,re,ue,ye,Me,Re,ze){const Je=this.projectAndGetPerspectiveRatio(r.anchorPointX+ue[0],r.anchorPointY+ue[1],j,Me,ze),ot=C*Je.perspectiveRatio;let Pt;if(Z||re)Pt=this._projectCollisionBox(r,ot,k,j,Z,re,ue,Je,Me,Re,ze);else{const rn=Je.x+(Re?Re.x*ot:0),an=Je.y+(Re?Re.y*ot:0);Pt={allPointsOccluded:!1,box:[rn+r.x1*ot,an+r.y1*ot,rn+r.x2*ot,an+r.y2*ot]}}const[Et,Lt,jt,Nt]=Pt.box,Bt=Z?Pt.allPointsOccluded:Je.isOccluded;let nn=Bt;return nn||(nn=Je.perspectiveRatio<this.perspectiveRatioCutoff),nn||(nn=!this.isInsideGrid(Et,Lt,jt,Nt)),nn||p!=="always"&&this.grid.hitTest(Et,Lt,jt,Nt,p,ye)?{box:[Et,Lt,jt,Nt],placeable:!1,offscreen:!1,occluded:Bt}:{box:[Et,Lt,jt,Nt],placeable:!0,offscreen:this.isOffscreen(Et,Lt,jt,Nt),occluded:Bt}}placeCollisionCircles(r,p,C,k,j,Z,re,ue,ye,Me,Re,ze,Je,ot){const Pt=[],Et=new t.P(p.anchorX,p.anchorY),Lt=this.getPerspectiveRatio(Et.x,Et.y,Z,ot),jt=(ye?j*this.transform.getPitchedTextCorrection(p.anchorX,p.anchorY,Z)/Lt:j*Lt)/t.as,Nt={getElevation:ot,pitchedLabelPlaneMatrix:re,lineVertexArray:C,pitchWithMap:ye,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},transform:this.transform,tileAnchorPoint:Et,unwrappedTileID:Z,width:this.transform.width,height:this.transform.height,translation:Je},Bt=Pe(jt,k,p.lineOffsetX*jt,p.lineOffsetY*jt,!1,p,!1,Nt);let nn=!1,rn=!1,an=!0;if(Bt){const Mn=.5*Re*Lt+ze,Rn=new t.P(-100,-100),Hn=new t.P(this.screenRightBoundary,this.screenBottomBoundary),ei=new Ut,jn=Bt.first,Ri=Bt.last;let zi=[];for(let Hr=jn.path.length-1;Hr>=1;Hr--)zi.push(jn.path[Hr]);for(let Hr=1;Hr<Ri.path.length;Hr++)zi.push(Ri.path[Hr]);const xi=2.5*Mn;if(ye){const Hr=this.projectPathToScreenSpace(zi,Nt);zi=Hr.some(ua=>ua.signedDistanceFromCamera<=0)?[]:Hr.map(ua=>ua.point)}let Gi=[];if(zi.length>0){const Hr=zi[0].clone(),ua=zi[0].clone();for(let Ma=1;Ma<zi.length;Ma++)Hr.x=Math.min(Hr.x,zi[Ma].x),Hr.y=Math.min(Hr.y,zi[Ma].y),ua.x=Math.max(ua.x,zi[Ma].x),ua.y=Math.max(ua.y,zi[Ma].y);Gi=Hr.x>=Rn.x&&ua.x<=Hn.x&&Hr.y>=Rn.y&&ua.y<=Hn.y?[zi]:ua.x<Rn.x||Hr.x>Hn.x||ua.y<Rn.y||Hr.y>Hn.y?[]:t.ao([zi],Rn.x,Rn.y,Hn.x,Hn.y)}for(const Hr of Gi){ei.reset(Hr,.25*Mn);let ua=0;ua=ei.length<=.5*Mn?1:Math.ceil(ei.paddedLength/xi)+1;for(let Ma=0;Ma<ua;Ma++){const La=Ma/Math.max(ua-1,1),Ha=ei.lerp(La),Ia=Ha.x+qi,Pa=Ha.y+qi;Pt.push(Ia,Pa,Mn,0);const Wr=Ia-Mn,ro=Pa-Mn,Is=Ia+Mn,gs=Pa+Mn;if(an=an&&this.isOffscreen(Wr,ro,Is,gs),rn=rn||this.isInsideGrid(Wr,ro,Is,gs),r!=="always"&&this.grid.hitTestCircle(Ia,Pa,Mn,r,Me)&&(nn=!0,!ue))return{circles:[],offscreen:!1,collisionDetected:nn}}}}return{circles:!ue&&nn||!rn||Lt<this.perspectiveRatioCutoff?[]:Pt,offscreen:an,collisionDetected:nn}}projectPathToScreenSpace(r,p){const C=function(k,j){const Z=t.H();return t.an(Z,j.pitchedLabelPlaneMatrix),k.map(re=>{const ue=Gn(re.x,re.y,Z,j.getElevation),ye=j.transform.projectTileCoordinates(ue.point.x,ue.point.y,j.unwrappedTileID,j.getElevation);return ye.point.x=(.5*ye.point.x+.5)*j.width,ye.point.y=(.5*-ye.point.y+.5)*j.height,ye})}(r,p);return function(k){let j=0,Z=0,re=0,ue=0;for(let ye=0;ye<k.length;ye++)k[ye].isOccluded?(re=ye+1,ue=0):(ue++,ue>Z&&(Z=ue,j=re));return k.slice(j,j+Z)}(C)}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const p=[];let C=1/0,k=1/0,j=-1/0,Z=-1/0;for(const Me of r){const Re=new t.P(Me.x+qi,Me.y+qi);C=Math.min(C,Re.x),k=Math.min(k,Re.y),j=Math.max(j,Re.x),Z=Math.max(Z,Re.y),p.push(Re)}const re=this.grid.query(C,k,j,Z).concat(this.ignoredGrid.query(C,k,j,Z)),ue={},ye={};for(const Me of re){const Re=Me.key;if(ue[Re.bucketInstanceId]===void 0&&(ue[Re.bucketInstanceId]={}),ue[Re.bucketInstanceId][Re.featureIndex])continue;const ze=[new t.P(Me.x1,Me.y1),new t.P(Me.x2,Me.y1),new t.P(Me.x2,Me.y2),new t.P(Me.x1,Me.y2)];t.ap(p,ze)&&(ue[Re.bucketInstanceId][Re.featureIndex]=!0,ye[Re.bucketInstanceId]===void 0&&(ye[Re.bucketInstanceId]=[]),ye[Re.bucketInstanceId].push(Re.featureIndex))}return ye}insertCollisionBox(r,p,C,k,j,Z){(C?this.ignoredGrid:this.grid).insert({bucketInstanceId:k,featureIndex:j,collisionGroupID:Z,overlapMode:p},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,p,C,k,j,Z){const re=C?this.ignoredGrid:this.grid,ue={bucketInstanceId:k,featureIndex:j,collisionGroupID:Z,overlapMode:p};for(let ye=0;ye<r.length;ye+=4)re.insertCircle(ue,r[ye],r[ye+1],r[ye+2])}projectAndGetPerspectiveRatio(r,p,C,k,j){if(j){let Z;k?(Z=[r,p,k(r,p),1],t.al(Z,Z,j)):(Z=[r,p,0,1],Ui(Z,Z,j));const re=Z[3];return{x:(Z[0]/re+1)/2*this.transform.width+qi,y:(-Z[1]/re+1)/2*this.transform.height+qi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/re*.5,isOccluded:!1,signedDistanceFromCamera:re}}{const Z=this.transform.projectTileCoordinates(r,p,C,k);return{x:(Z.point.x+1)/2*this.transform.width+qi,y:(1-Z.point.y)/2*this.transform.height+qi,perspectiveRatio:.5+this.transform.cameraToCenterDistance/Z.signedDistanceFromCamera*.5,isOccluded:Z.isOccluded,signedDistanceFromCamera:Z.signedDistanceFromCamera}}}getPerspectiveRatio(r,p,C,k){const j=this.transform.projectTileCoordinates(r,p,C,k);return .5+this.transform.cameraToCenterDistance/j.signedDistanceFromCamera*.5}isOffscreen(r,p,C,k){return C<qi||r>=this.screenRightBoundary||k<qi||p>this.screenBottomBoundary}isInsideGrid(r,p,C,k){return C>=0&&r<this.gridRightBoundary&&k>=0&&p<this.gridBottomBoundary}getViewportMatrix(){const r=t.aq([]);return t.J(r,r,[-100,-100,0]),r}_projectCollisionBox(r,p,C,k,j,Z,re,ue,ye,Me,Re){let ze=1,Je=0,ot=0,Pt=1;const Et=r.anchorPointX+re[0],Lt=r.anchorPointY+re[1];if(Z&&!j){const zi=this.projectAndGetPerspectiveRatio(Et+1,Lt,k,ye,Re),xi=zi.x-ue.x,Gi=Math.atan((zi.y-ue.y)/xi)+(xi<0?Math.PI:0),Hr=Math.sin(Gi),ua=Math.cos(Gi);ze=ua,Je=Hr,ot=-Hr,Pt=ua}else if(!Z&&j){const zi=Wn(this.transform);ze=zi.vecEast[0],Je=zi.vecEast[1],ot=zi.vecSouth[0],Pt=zi.vecSouth[1]}let jt=ue.x,Nt=ue.y,Bt=p;j&&(jt=Et,Nt=Lt,Bt=Math.pow(2,-(this.transform.zoom-C.overscaledZ)),Bt*=this.transform.getPitchedTextCorrection(Et,Lt,k),Me||(Bt*=t.ab(.5+ue.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))),Me&&(jt+=ze*Me.x*Bt+ot*Me.y*Bt,Nt+=Je*Me.x*Bt+Pt*Me.y*Bt);const nn=r.x1*Bt,rn=r.x2*Bt,an=(nn+rn)/2,Mn=r.y1*Bt,Rn=r.y2*Bt,Hn=(Mn+Rn)/2,ei=[{offsetX:nn,offsetY:Mn},{offsetX:an,offsetY:Mn},{offsetX:rn,offsetY:Mn},{offsetX:rn,offsetY:Hn},{offsetX:rn,offsetY:Rn},{offsetX:an,offsetY:Rn},{offsetX:nn,offsetY:Rn},{offsetX:nn,offsetY:Hn}];let jn=[];for(const{offsetX:zi,offsetY:xi}of ei)jn.push(new t.P(jt+ze*zi+ot*xi,Nt+Je*zi+Pt*xi));let Ri=!1;if(j){const zi=jn.map(xi=>this.projectAndGetPerspectiveRatio(xi.x,xi.y,k,ye,Re));Ri=zi.some(xi=>!xi.isOccluded),jn=zi.map(xi=>new t.P(xi.x,xi.y))}else Ri=!0;return{box:t.ar(jn),allPointsOccluded:!Ri}}}class Ni{constructor(r,p,C,k){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?p:-p))):k&&C?1:0,this.placed=C}isHidden(){return this.opacity===0&&!this.placed}}class Jr{constructor(r,p,C,k,j){this.text=new Ni(r?r.text:null,p,C,j),this.icon=new Ni(r?r.icon:null,p,k,j)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Nr{constructor(r,p,C){this.text=r,this.icon=p,this.skipFade=C}}class kr{constructor(r,p,C,k,j){this.bucketInstanceId=r,this.featureIndex=p,this.sourceLayerIndex=C,this.bucketIndex=k,this.tileID=j}}class Zr{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const p=++this.maxGroupID;this.collisionGroups[r]={ID:p,predicate:C=>C.collisionGroupID===p}}return this.collisionGroups[r]}}function Xr(B,r,p,C,k){const{horizontalAlign:j,verticalAlign:Z}=t.ay(B);return new t.P(-(j-.5)*r+C[0]*k,-(Z-.5)*p+C[1]*k)}class xs{constructor(r,p,C,k,j){this.transform=r.clone(),this.terrain=p,this.collisionIndex=new Qi(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=C,this.retainedQueryData={},this.collisionGroups=new Zr(k),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=j,j&&(j.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(r){const p=this.terrain;return p?(C,k)=>p.getElevation(r,C,k):null}getBucketParts(r,p,C,k){const j=C.getBucket(p),Z=C.latestFeatureIndex;if(!j||!Z||p.id!==j.layerIds[0])return;const re=C.collisionBoxArray,ue=j.layers[0].layout,ye=j.layers[0].paint,Me=Math.pow(2,this.transform.zoom-C.tileID.overscaledZ),Re=C.tileSize/t.X,ze=C.tileID.toUnwrapped(),Je=ue.get("text-rotation-alignment")==="map",ot=t.at(C,1,this.transform.zoom),Pt=t.au(this.collisionIndex.transform,C,ye.get("text-translate"),ye.get("text-translate-anchor")),Et=t.au(this.collisionIndex.transform,C,ye.get("icon-translate"),ye.get("icon-translate-anchor")),Lt=kn(Je,this.transform,ot);this.retainedQueryData[j.bucketInstanceId]=new kr(j.bucketInstanceId,Z,j.sourceLayerIndex,j.index,C.tileID);const jt={bucket:j,layout:ue,translationText:Pt,translationIcon:Et,unwrappedTileID:ze,pitchedLabelPlaneMatrix:Lt,scale:Me,textPixelRatio:Re,holdingForFade:C.holdingForFade(),collisionBoxArray:re,partiallyEvaluatedTextSize:t.ah(j.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(j.sourceID)};if(k)for(const Nt of j.sortKeyRanges){const{sortKey:Bt,symbolInstanceStart:nn,symbolInstanceEnd:rn}=Nt;r.push({sortKey:Bt,symbolInstanceStart:nn,symbolInstanceEnd:rn,parameters:jt})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:j.symbolInstances.length,parameters:jt})}attemptAnchorPlacement(r,p,C,k,j,Z,re,ue,ye,Me,Re,ze,Je,ot,Pt,Et,Lt,jt,Nt,Bt){const nn=t.av[r.textAnchor],rn=[r.textOffset0,r.textOffset1],an=Xr(nn,C,k,rn,j),Mn=this.collisionIndex.placeCollisionBox(p,ze,ue,ye,Me,re,Z,Et,Re.predicate,Nt,an,Bt);if((!jt||this.collisionIndex.placeCollisionBox(jt,ze,ue,ye,Me,re,Z,Lt,Re.predicate,Nt,an,Bt).placeable)&&Mn.placeable){let Rn;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Je.crossTileID]&&this.prevPlacement.placements[Je.crossTileID]&&this.prevPlacement.placements[Je.crossTileID].text&&(Rn=this.prevPlacement.variableOffsets[Je.crossTileID].anchor),Je.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[Je.crossTileID]={textOffset:rn,width:C,height:k,anchor:nn,textBoxScale:j,prevAnchor:Rn},this.markUsedJustification(ot,nn,Je,Pt),ot.allowVerticalPlacement&&(this.markUsedOrientation(ot,Pt,Je),this.placedOrientations[Je.crossTileID]=Pt),{shift:an,placedGlyphBoxes:Mn}}}placeLayerBucketPart(r,p,C){const{bucket:k,layout:j,translationText:Z,translationIcon:re,unwrappedTileID:ue,pitchedLabelPlaneMatrix:ye,textPixelRatio:Me,holdingForFade:Re,collisionBoxArray:ze,partiallyEvaluatedTextSize:Je,collisionGroup:ot}=r.parameters,Pt=j.get("text-optional"),Et=j.get("icon-optional"),Lt=t.aw(j,"text-overlap","text-allow-overlap"),jt=Lt==="always",Nt=t.aw(j,"icon-overlap","icon-allow-overlap"),Bt=Nt==="always",nn=j.get("text-rotation-alignment")==="map",rn=j.get("text-pitch-alignment")==="map",an=j.get("icon-text-fit")!=="none",Mn=j.get("symbol-z-order")==="viewport-y",Rn=jt&&(Bt||!k.hasIconData()||Et),Hn=Bt&&(jt||!k.hasTextData()||Pt);!k.collisionArrays&&ze&&k.deserializeCollisionBoxes(ze);const ei=this.retainedQueryData[k.bucketInstanceId].tileID,jn=this._getTerrainElevationFunc(ei),Ri=this.transform.getFastPathSimpleProjectionMatrix(ei),zi=(xi,Gi,Hr)=>{var ua,Ma;if(p[xi.crossTileID])return;if(Re)return void(this.placements[xi.crossTileID]=new Nr(!1,!1,!1));let La=!1,Ha=!1,Ia=!0,Pa=null,Wr={box:null,placeable:!1,offscreen:null,occluded:!1},ro={box:null,placeable:!1,offscreen:null},Is=null,gs=null,Za=null,tc=0,nc=0,il=0;Gi.textFeatureIndex?tc=Gi.textFeatureIndex:xi.useRuntimeCollisionCircles&&(tc=xi.featureIndex),Gi.verticalTextFeatureIndex&&(nc=Gi.verticalTextFeatureIndex);const rl=Gi.textBox;if(rl){const yo=Fa=>{let us=t.ai.horizontal;if(k.allowVerticalPlacement&&!Fa&&this.prevPlacement){const _l=this.prevPlacement.placedOrientations[xi.crossTileID];_l&&(this.placedOrientations[xi.crossTileID]=_l,us=_l,this.markUsedOrientation(k,us,xi))}return us},gl=(Fa,us)=>{if(k.allowVerticalPlacement&&xi.numVerticalGlyphVertices>0&&Gi.verticalTextBox){for(const _l of k.writingModes)if(_l===t.ai.vertical?(Wr=us(),ro=Wr):Wr=Fa(),Wr&&Wr.placeable)break}else Wr=Fa()},al=xi.textAnchorOffsetStartIndex,Oo=xi.textAnchorOffsetEndIndex;if(Oo===al){const Fa=(us,_l)=>{const _s=this.collisionIndex.placeCollisionBox(us,Lt,Me,ei,ue,rn,nn,Z,ot.predicate,jn,void 0,Ri);return _s&&_s.placeable&&(this.markUsedOrientation(k,_l,xi),this.placedOrientations[xi.crossTileID]=_l),_s};gl(()=>Fa(rl,t.ai.horizontal),()=>{const us=Gi.verticalTextBox;return k.allowVerticalPlacement&&xi.numVerticalGlyphVertices>0&&us?Fa(us,t.ai.vertical):{box:null,offscreen:null}}),yo(Wr&&Wr.placeable)}else{let Fa=t.av[(Ma=(ua=this.prevPlacement)===null||ua===void 0?void 0:ua.variableOffsets[xi.crossTileID])===null||Ma===void 0?void 0:Ma.anchor];const us=(_s,Zm,Td)=>{const Lh=_s.x2-_s.x1,sl=_s.y2-_s.y1,wc=xi.textBoxScale,sh=an&&Nt==="never"?Zm:null;let bu=null,rm=Lt==="never"?1:2,gp="never";Fa&&rm++;for(let vf=0;vf<rm;vf++){for(let Wa=al;Wa<Oo;Wa++){const Cd=k.textAnchorOffsets.get(Wa);if(Fa&&Cd.textAnchor!==Fa)continue;const am=this.attemptAnchorPlacement(Cd,_s,Lh,sl,wc,nn,rn,Me,ei,ue,ot,gp,xi,k,Td,Z,re,sh,jn);if(am&&(bu=am.placedGlyphBoxes,bu&&bu.placeable))return La=!0,Pa=am.shift,bu}Fa?Fa=null:gp=Lt}return C&&!bu&&(bu={box:this.collisionIndex.placeCollisionBox(rl,"always",Me,ei,ue,rn,nn,Z,ot.predicate,jn,void 0,Ri).box,offscreen:!1,placeable:!1,occluded:!1}),bu};gl(()=>us(rl,Gi.iconBox,t.ai.horizontal),()=>{const _s=Gi.verticalTextBox;return k.allowVerticalPlacement&&(!Wr||!Wr.placeable)&&xi.numVerticalGlyphVertices>0&&_s?us(_s,Gi.verticalIconBox,t.ai.vertical):{box:null,occluded:!0,offscreen:null}}),Wr&&(La=Wr.placeable,Ia=Wr.offscreen);const _l=yo(Wr&&Wr.placeable);if(!La&&this.prevPlacement){const _s=this.prevPlacement.variableOffsets[xi.crossTileID];_s&&(this.variableOffsets[xi.crossTileID]=_s,this.markUsedJustification(k,_s.anchor,xi,_l))}}}if(Is=Wr,La=Is&&Is.placeable,Ia=Is&&Is.offscreen,xi.useRuntimeCollisionCircles){const yo=k.text.placedSymbolArray.get(xi.centerJustifiedTextSymbolIndex),gl=t.aj(k.textSizeData,Je,yo),al=j.get("text-padding");gs=this.collisionIndex.placeCollisionCircles(Lt,yo,k.lineVertexArray,k.glyphOffsetArray,gl,ue,ye,C,rn,ot.predicate,xi.collisionCircleDiameter,al,Z,jn),gs.circles.length&&gs.collisionDetected&&!C&&t.w("Collisions detected, but collision boxes are not shown"),La=jt||gs.circles.length>0&&!gs.collisionDetected,Ia=Ia&&gs.offscreen}if(Gi.iconFeatureIndex&&(il=Gi.iconFeatureIndex),Gi.iconBox){const yo=gl=>this.collisionIndex.placeCollisionBox(gl,Nt,Me,ei,ue,rn,nn,re,ot.predicate,jn,an&&Pa?Pa:void 0,Ri);ro&&ro.placeable&&Gi.verticalIconBox?(Za=yo(Gi.verticalIconBox),Ha=Za.placeable):(Za=yo(Gi.iconBox),Ha=Za.placeable),Ia=Ia&&Za.offscreen}const xu=Pt||xi.numHorizontalGlyphVertices===0&&xi.numVerticalGlyphVertices===0,rh=Et||xi.numIconVertices===0;xu||rh?rh?xu||(Ha=Ha&&La):La=Ha&&La:Ha=La=Ha&&La;const ah=Ha&&Za.placeable;if(La&&Is.placeable&&this.collisionIndex.insertCollisionBox(Is.box,Lt,j.get("text-ignore-placement"),k.bucketInstanceId,ro&&ro.placeable&&nc?nc:tc,ot.ID),ah&&this.collisionIndex.insertCollisionBox(Za.box,Nt,j.get("icon-ignore-placement"),k.bucketInstanceId,il,ot.ID),gs&&La&&this.collisionIndex.insertCollisionCircles(gs.circles,Lt,j.get("text-ignore-placement"),k.bucketInstanceId,tc,ot.ID),C&&this.storeCollisionData(k.bucketInstanceId,Hr,Gi,Is,Za,gs),xi.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(k.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[xi.crossTileID]=new Nr((La||Rn)&&!(Is!=null&&Is.occluded),(Ha||Hn)&&!(Za!=null&&Za.occluded),Ia||k.justReloaded),p[xi.crossTileID]=!0};if(Mn){if(r.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const xi=k.getSortedSymbolIndexes(-this.transform.bearingInRadians);for(let Gi=xi.length-1;Gi>=0;--Gi){const Hr=xi[Gi];zi(k.symbolInstances.get(Hr),k.collisionArrays[Hr],Hr)}}else for(let xi=r.symbolInstanceStart;xi<r.symbolInstanceEnd;xi++)zi(k.symbolInstances.get(xi),k.collisionArrays[xi],xi);k.justReloaded=!1}storeCollisionData(r,p,C,k,j,Z){if(C.textBox||C.iconBox){let re,ue;this.collisionBoxArrays.has(r)?re=this.collisionBoxArrays.get(r):(re=new Map,this.collisionBoxArrays.set(r,re)),re.has(p)?ue=re.get(p):(ue={text:null,icon:null},re.set(p,ue)),C.textBox&&(ue.text=k.box),C.iconBox&&(ue.icon=j.box)}if(Z){let re=this.collisionCircleArrays[r];re===void 0&&(re=this.collisionCircleArrays[r]=[]);for(let ue=0;ue<Z.circles.length;ue+=4)re.push(Z.circles[ue+0]-qi),re.push(Z.circles[ue+1]-qi),re.push(Z.circles[ue+2]),re.push(Z.collisionDetected?1:0)}}markUsedJustification(r,p,C,k){let j;j=k===t.ai.vertical?C.verticalPlacedTextSymbolIndex:{left:C.leftJustifiedTextSymbolIndex,center:C.centerJustifiedTextSymbolIndex,right:C.rightJustifiedTextSymbolIndex}[t.ax(p)];const Z=[C.leftJustifiedTextSymbolIndex,C.centerJustifiedTextSymbolIndex,C.rightJustifiedTextSymbolIndex,C.verticalPlacedTextSymbolIndex];for(const re of Z)re>=0&&(r.text.placedSymbolArray.get(re).crossTileID=j>=0&&re!==j?0:C.crossTileID)}markUsedOrientation(r,p,C){const k=p===t.ai.horizontal||p===t.ai.horizontalOnly?p:0,j=p===t.ai.vertical?p:0,Z=[C.leftJustifiedTextSymbolIndex,C.centerJustifiedTextSymbolIndex,C.rightJustifiedTextSymbolIndex];for(const re of Z)r.text.placedSymbolArray.get(re).placedOrientation=k;C.verticalPlacedTextSymbolIndex&&(r.text.placedSymbolArray.get(C.verticalPlacedTextSymbolIndex).placedOrientation=j)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const p=this.prevPlacement;let C=!1;this.prevZoomAdjustment=p?p.zoomAdjustment(this.transform.zoom):0;const k=p?p.symbolFadeChange(r):1,j=p?p.opacities:{},Z=p?p.variableOffsets:{},re=p?p.placedOrientations:{};for(const ue in this.placements){const ye=this.placements[ue],Me=j[ue];Me?(this.opacities[ue]=new Jr(Me,k,ye.text,ye.icon),C=C||ye.text!==Me.text.placed||ye.icon!==Me.icon.placed):(this.opacities[ue]=new Jr(null,k,ye.text,ye.icon,ye.skipFade),C=C||ye.text||ye.icon)}for(const ue in j){const ye=j[ue];if(!this.opacities[ue]){const Me=new Jr(ye,k,!1,!1);Me.isHidden()||(this.opacities[ue]=Me,C=C||ye.text.placed||ye.icon.placed)}}for(const ue in Z)this.variableOffsets[ue]||!this.opacities[ue]||this.opacities[ue].isHidden()||(this.variableOffsets[ue]=Z[ue]);for(const ue in re)this.placedOrientations[ue]||!this.opacities[ue]||this.opacities[ue].isHidden()||(this.placedOrientations[ue]=re[ue]);if(p&&p.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");C?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=p?p.lastPlacementChangeTime:r)}updateLayerOpacities(r,p){const C={};for(const k of p){const j=k.getBucket(r);j&&k.latestFeatureIndex&&r.id===j.layerIds[0]&&this.updateBucketOpacities(j,k.tileID,C,k.collisionBoxArray)}}updateBucketOpacities(r,p,C,k){r.hasTextData()&&(r.text.opacityVertexArray.clear(),r.text.hasVisibleVertices=!1),r.hasIconData()&&(r.icon.opacityVertexArray.clear(),r.icon.hasVisibleVertices=!1),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const j=r.layers[0],Z=j.layout,re=new Jr(null,0,!1,!1,!0),ue=Z.get("text-allow-overlap"),ye=Z.get("icon-allow-overlap"),Me=j._unevaluatedLayout.hasValue("text-variable-anchor")||j._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Re=Z.get("text-rotation-alignment")==="map",ze=Z.get("text-pitch-alignment")==="map",Je=Z.get("icon-text-fit")!=="none",ot=new Jr(null,0,ue&&(ye||!r.hasIconData()||Z.get("icon-optional")),ye&&(ue||!r.hasTextData()||Z.get("text-optional")),!0);!r.collisionArrays&&k&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(k);const Pt=(Lt,jt,Nt)=>{for(let Bt=0;Bt<jt/4;Bt++)Lt.opacityVertexArray.emplaceBack(Nt);Lt.hasVisibleVertices=Lt.hasVisibleVertices||Nt!==Zl},Et=this.collisionBoxArrays.get(r.bucketInstanceId);for(let Lt=0;Lt<r.symbolInstances.length;Lt++){const jt=r.symbolInstances.get(Lt),{numHorizontalGlyphVertices:Nt,numVerticalGlyphVertices:Bt,crossTileID:nn}=jt;let rn=this.opacities[nn];C[nn]?rn=re:rn||(rn=ot,this.opacities[nn]=rn),C[nn]=!0;const an=jt.numIconVertices>0,Mn=this.placedOrientations[jt.crossTileID],Rn=Mn===t.ai.vertical,Hn=Mn===t.ai.horizontal||Mn===t.ai.horizontalOnly;if(Nt>0||Bt>0){const jn=Yh(rn.text);Pt(r.text,Nt,Rn?Zl:jn),Pt(r.text,Bt,Hn?Zl:jn);const Ri=rn.text.isHidden();[jt.rightJustifiedTextSymbolIndex,jt.centerJustifiedTextSymbolIndex,jt.leftJustifiedTextSymbolIndex].forEach(Gi=>{Gi>=0&&(r.text.placedSymbolArray.get(Gi).hidden=Ri||Rn?1:0)}),jt.verticalPlacedTextSymbolIndex>=0&&(r.text.placedSymbolArray.get(jt.verticalPlacedTextSymbolIndex).hidden=Ri||Hn?1:0);const zi=this.variableOffsets[jt.crossTileID];zi&&this.markUsedJustification(r,zi.anchor,jt,Mn);const xi=this.placedOrientations[jt.crossTileID];xi&&(this.markUsedJustification(r,"left",jt,xi),this.markUsedOrientation(r,xi,jt))}if(an){const jn=Yh(rn.icon),Ri=!(Je&&jt.verticalPlacedIconSymbolIndex&&Rn);jt.placedIconSymbolIndex>=0&&(Pt(r.icon,jt.numIconVertices,Ri?jn:Zl),r.icon.placedSymbolArray.get(jt.placedIconSymbolIndex).hidden=rn.icon.isHidden()),jt.verticalPlacedIconSymbolIndex>=0&&(Pt(r.icon,jt.numVerticalIconVertices,Ri?Zl:jn),r.icon.placedSymbolArray.get(jt.verticalPlacedIconSymbolIndex).hidden=rn.icon.isHidden())}const ei=Et&&Et.has(Lt)?Et.get(Lt):{text:null,icon:null};if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const jn=r.collisionArrays[Lt];if(jn){let Ri=new t.P(0,0);if(jn.textBox||jn.verticalTextBox){let zi=!0;if(Me){const xi=this.variableOffsets[nn];xi?(Ri=Xr(xi.anchor,xi.width,xi.height,xi.textOffset,xi.textBoxScale),Re&&Ri._rotate(ze?-this.transform.bearingInRadians:this.transform.bearingInRadians)):zi=!1}if(jn.textBox||jn.verticalTextBox){let xi;jn.textBox&&(xi=Rn),jn.verticalTextBox&&(xi=Hn),go(r.textCollisionBox.collisionVertexArray,rn.text.placed,!zi||xi,ei.text,Ri.x,Ri.y)}}if(jn.iconBox||jn.verticalIconBox){const zi=!!(!Hn&&jn.verticalIconBox);let xi;jn.iconBox&&(xi=zi),jn.verticalIconBox&&(xi=!zi),go(r.iconCollisionBox.collisionVertexArray,rn.icon.placed,xi,ei.icon,Je?Ri.x:0,Je?Ri.y:0)}}}}if(r.sortFeatures(-this.transform.bearingInRadians),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.text.opacityVertexArray.length!==r.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${r.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${r.text.layoutVertexArray.length}) / 4`);if(r.icon.opacityVertexArray.length!==r.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${r.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${r.icon.layoutVertexArray.length}) / 4`);r.bucketInstanceId in this.collisionCircleArrays&&(r.collisionCircleArray=this.collisionCircleArrays[r.bucketInstanceId],delete this.collisionCircleArrays[r.bucketInstanceId])}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,p){const C=this.zoomAtLastRecencyCheck===p?1-this.zoomAdjustment(p):1;return this.zoomAtLastRecencyCheck=p,this.commitTime+this.fadeDuration*C>r}setStale(){this.stale=!0}}function go(B,r,p,C,k,j){C&&C.length!==0||(C=[0,0,0,0]);const Z=C[0]-qi,re=C[1]-qi,ue=C[2]-qi,ye=C[3]-qi;B.emplaceBack(r?1:0,p?1:0,k||0,j||0,Z,re),B.emplaceBack(r?1:0,p?1:0,k||0,j||0,ue,re),B.emplaceBack(r?1:0,p?1:0,k||0,j||0,ue,ye),B.emplaceBack(r?1:0,p?1:0,k||0,j||0,Z,ye)}const Fs=Math.pow(2,25),bs=Math.pow(2,24),Ou=Math.pow(2,17),Lc=Math.pow(2,16),Xp=Math.pow(2,9),Gf=Math.pow(2,8),Fu=Math.pow(2,1);function Yh(B){if(B.opacity===0&&!B.placed)return 0;if(B.opacity===1&&B.placed)return 4294967295;const r=B.placed?1:0,p=Math.floor(127*B.opacity);return p*Fs+r*bs+p*Ou+r*Lc+p*Xp+r*Gf+p*Fu+r}const Zl=0;class dc{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&!r.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(r,p,C,k,j){const Z=this._bucketParts;for(;this._currentTileIndex<r.length;)if(p.getBucketParts(Z,k,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,j())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,Z.sort((re,ue)=>re.sortKey-ue.sortKey));this._currentPartIndex<Z.length;)if(p.placeLayerBucketPart(Z[this._currentPartIndex],this._seenCrossTileIDs,C),this._currentPartIndex++,j())return!0;return!1}}class Bu{constructor(r,p,C,k,j,Z,re,ue){this.placement=new xs(r,p,Z,re,ue),this._currentPlacementIndex=C.length-1,this._forceFullPlacement=k,this._showCollisionBoxes=j,this._done=!1}isDone(){return this._done}continuePlacement(r,p,C){const k=J.now(),j=()=>!this._forceFullPlacement&&J.now()-k>2;for(;this._currentPlacementIndex>=0;){const Z=p[r[this._currentPlacementIndex]],re=this.placement.collisionIndex.transform.zoom;if(Z.type==="symbol"&&(!Z.minzoom||Z.minzoom<=re)&&(!Z.maxzoom||Z.maxzoom>re)){if(this._inProgressLayer||(this._inProgressLayer=new dc(Z)),this._inProgressLayer.continuePlacement(C[Z.source],this.placement,this._showCollisionBoxes,Z,j))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const ru=512/t.X/2;class qf{constructor(r,p,C){this.tileID=r,this.bucketInstanceId=C,this._symbolsByKey={};const k=new Map;for(let j=0;j<p.length;j++){const Z=p.get(j),re=Z.key,ue=k.get(re);ue?ue.push(Z):k.set(re,[Z])}for(const[j,Z]of k){const re={positions:Z.map(ue=>({x:Math.floor(ue.anchorX*ru),y:Math.floor(ue.anchorY*ru)})),crossTileIDs:Z.map(ue=>ue.crossTileID)};if(re.positions.length>128){const ue=new t.az(re.positions.length,16,Uint16Array);for(const{x:ye,y:Me}of re.positions)ue.add(ye,Me);ue.finish(),delete re.positions,re.index=ue}this._symbolsByKey[j]=re}}getScaledCoordinates(r,p){const{x:C,y:k,z:j}=this.tileID.canonical,{x:Z,y:re,z:ue}=p.canonical,ye=ru/Math.pow(2,ue-j),Me=(re*t.X+r.anchorY)*ye,Re=k*t.X*ru;return{x:Math.floor((Z*t.X+r.anchorX)*ye-C*t.X*ru),y:Math.floor(Me-Re)}}findMatches(r,p,C){const k=this.tileID.canonical.z<p.canonical.z?1:Math.pow(2,this.tileID.canonical.z-p.canonical.z);for(let j=0;j<r.length;j++){const Z=r.get(j);if(Z.crossTileID)continue;const re=this._symbolsByKey[Z.key];if(!re)continue;const ue=this.getScaledCoordinates(Z,p);if(re.index){const ye=re.index.range(ue.x-k,ue.y-k,ue.x+k,ue.y+k).sort();for(const Me of ye){const Re=re.crossTileIDs[Me];if(!C[Re]){C[Re]=!0,Z.crossTileID=Re;break}}}else if(re.positions)for(let ye=0;ye<re.positions.length;ye++){const Me=re.positions[ye],Re=re.crossTileIDs[ye];if(Math.abs(Me.x-ue.x)<=k&&Math.abs(Me.y-ue.y)<=k&&!C[Re]){C[Re]=!0,Z.crossTileID=Re;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:r})=>r)}}class _h{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Kh{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const p=Math.round((r-this.lng)/360);if(p!==0)for(const C in this.indexes){const k=this.indexes[C],j={};for(const Z in k){const re=k[Z];re.tileID=re.tileID.unwrapTo(re.tileID.wrap+p),j[re.tileID.key]=re}this.indexes[C]=j}this.lng=r}addBucket(r,p,C){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===p.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let j=0;j<p.symbolInstances.length;j++)p.symbolInstances.get(j).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]={});const k=this.usedCrossTileIDs[r.overscaledZ];for(const j in this.indexes){const Z=this.indexes[j];if(Number(j)>r.overscaledZ)for(const re in Z){const ue=Z[re];ue.tileID.isChildOf(r)&&ue.findMatches(p.symbolInstances,r,k)}else{const re=Z[r.scaledTo(Number(j)).key];re&&re.findMatches(p.symbolInstances,r,k)}}for(let j=0;j<p.symbolInstances.length;j++){const Z=p.symbolInstances.get(j);Z.crossTileID||(Z.crossTileID=C.generate(),k[Z.crossTileID]=!0)}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new qf(r,p.symbolInstances,p.bucketInstanceId),!0}removeBucketCrossTileIDs(r,p){for(const C of p.getCrossTileIDsLists())for(const k of C)delete this.usedCrossTileIDs[r][k]}removeStaleBuckets(r){let p=!1;for(const C in this.indexes){const k=this.indexes[C];for(const j in k)r[k[j].bucketInstanceId]||(this.removeBucketCrossTileIDs(C,k[j]),delete k[j],p=!0)}return p}}class zc{constructor(){this.layerIndexes={},this.crossTileIDs=new _h,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,p,C){let k=this.layerIndexes[r.id];k===void 0&&(k=this.layerIndexes[r.id]=new Kh);let j=!1;const Z={};k.handleWrapJump(C);for(const re of p){const ue=re.getBucket(r);ue&&r.id===ue.layerIds[0]&&(ue.bucketInstanceId||(ue.bucketInstanceId=++this.maxBucketInstanceId),k.addBucket(re.tileID,ue,this.crossTileIDs)&&(j=!0),Z[ue.bucketInstanceId]=!0)}return k.removeStaleBuckets(Z)&&(j=!0),j}pruneUnusedLayers(r){const p={};r.forEach(C=>{p[C]=!0});for(const C in this.layerIndexes)p[C]||delete this.layerIndexes[C]}}var Gd="void main() {fragColor=vec4(1.0);}";const ks={prelude:zr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
out highp vec4 fragColor;`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}mat3 rotationMatrixFromAxisAngle(vec3 u,float angle) {float c=cos(angle);float s=sin(angle);float c2=1.0-c;return mat3(u.x*u.x*c2+      c,u.x*u.y*c2-u.z*s,u.x*u.z*c2+u.y*s,u.y*u.x*c2+u.z*s,u.y*u.y*c2+    c,u.y*u.z*c2-u.x*s,u.z*u.x*c2-u.y*s,u.z*u.y*c2+u.x*s,u.z*u.z*c2+    c
);}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
#ifdef GLOBE
if ((pos.y <-32767.5) || (pos.y > 32766.5)) {return 0.0;}
#endif
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}const float PI=3.141592653589793;uniform mat4 u_projection_matrix;`),projectionMercator:zr("","float projectLineThickness(float tileY) {return 1.0;}float projectCircleRadius(float tileY) {return 1.0;}vec4 projectTile(vec2 p) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);return result;}vec4 projectTile(vec2 p,vec2 rawPos) {vec4 result=u_projection_matrix*vec4(p,0.0,1.0);if (rawPos.y <-32767.5 || rawPos.y > 32766.5) {result.z=-10000000.0;}return result;}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_projection_matrix*vec4(posInTile,elevation,1.0);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {return projectTileWithElevation(posInTile,elevation);}"),projectionGlobe:zr("",`#define GLOBE_RADIUS 6371008.8
uniform highp vec4 u_projection_tile_mercator_coords;uniform highp vec4 u_projection_clipping_plane;uniform highp float u_projection_transition;uniform mat4 u_projection_fallback_matrix;vec3 globeRotateVector(vec3 vec,vec2 angles) {vec3 axisRight=vec3(vec.z,0.0,-vec.x);vec3 axisUp=cross(axisRight,vec);axisRight=normalize(axisRight);axisUp=normalize(axisUp);vec2 t=tan(angles);return normalize(vec+axisRight*t.x+axisUp*t.y);}mat3 globeGetRotationMatrix(vec3 spherePos) {vec3 axisRight=vec3(spherePos.z,0.0,-spherePos.x);vec3 axisDown=cross(axisRight,spherePos);axisRight=normalize(axisRight);axisDown=normalize(axisDown);return mat3(axisRight,axisDown,spherePos
);}float circumferenceRatioAtTileY(float tileY) {float mercator_pos_y=u_projection_tile_mercator_coords.y+u_projection_tile_mercator_coords.w*tileY;float spherical_y=2.0*atan(exp(PI-(mercator_pos_y*PI*2.0)))-PI*0.5;return cos(spherical_y);}float projectLineThickness(float tileY) {float thickness=1.0/circumferenceRatioAtTileY(tileY); 
if (u_projection_transition < 0.999) {return mix(1.0,thickness,u_projection_transition);} else {return thickness;}}vec3 projectToSphere(vec2 translatedPos,vec2 rawPos) {vec2 mercator_pos=u_projection_tile_mercator_coords.xy+u_projection_tile_mercator_coords.zw*translatedPos;vec2 spherical;spherical.x=mercator_pos.x*PI*2.0+PI;spherical.y=2.0*atan(exp(PI-(mercator_pos.y*PI*2.0)))-PI*0.5;float len=cos(spherical.y);vec3 pos=vec3(sin(spherical.x)*len,sin(spherical.y),cos(spherical.x)*len
);if (rawPos.y <-32767.5) {pos=vec3(0.0,1.0,0.0);}if (rawPos.y > 32766.5) {pos=vec3(0.0,-1.0,0.0);}return pos;}vec3 projectToSphere(vec2 posInTile) {return projectToSphere(posInTile,vec2(0.0,0.0));}float globeComputeClippingZ(vec3 spherePos) {return (1.0-(dot(spherePos,u_projection_clipping_plane.xyz)+u_projection_clipping_plane.w));}vec4 interpolateProjection(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);globePosition.z=globeComputeClippingZ(elevatedPos)*globePosition.w;if (u_projection_transition > 0.999) {return globePosition;}vec4 flatPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);const float z_globeness_threshold=0.2;vec4 result=globePosition;result.z=mix(0.0,globePosition.z,clamp((u_projection_transition-z_globeness_threshold)/(1.0-z_globeness_threshold),0.0,1.0));result.xyw=mix(flatPosition.xyw,globePosition.xyw,u_projection_transition);if ((posInTile.y <-32767.5) || (posInTile.y > 32766.5)) {result=globePosition;const float poles_hidden_anim_percentage=0.02;result.z=mix(globePosition.z,100.0,pow(max((1.0-u_projection_transition)/poles_hidden_anim_percentage,0.0),8.0));}return result;}vec4 interpolateProjectionFor3D(vec2 posInTile,vec3 spherePos,float elevation) {vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);vec4 globePosition=u_projection_matrix*vec4(elevatedPos,1.0);if (u_projection_transition > 0.999) {return globePosition;}vec4 fallbackPosition=u_projection_fallback_matrix*vec4(posInTile,elevation,1.0);return mix(fallbackPosition,globePosition,u_projection_transition);}vec4 projectTile(vec2 posInTile) {return interpolateProjection(posInTile,projectToSphere(posInTile),0.0);}vec4 projectTile(vec2 posInTile,vec2 rawPos) {return interpolateProjection(posInTile,projectToSphere(posInTile,rawPos),0.0);}vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return interpolateProjection(posInTile,projectToSphere(posInTile),elevation);}vec4 projectTileFor3D(vec2 posInTile,float elevation) {vec3 spherePos=projectToSphere(posInTile,posInTile);return interpolateProjectionFor3D(posInTile,spherePos,elevation);}`),background:zr(`uniform vec4 u_color;uniform float u_opacity;void main() {fragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),backgroundPattern:zr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;void main() {gl_Position=projectTile(a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:zr(`in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));fragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);const float epsilon=0.5/255.0;if (fragColor.r < epsilon && fragColor.g < epsilon && fragColor.b < epsilon && fragColor.a < epsilon) {discard;}
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform highp float u_globe_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;uniform vec2 u_translate;in vec2 a_pos;out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 pos_raw=a_pos+32768.0;vec2 extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);vec2 circle_center=floor(pos_raw/8.0)+u_translate;float ele=get_elevation(circle_center);v_visibility=calculate_visibility(projectTileWithElevation(circle_center,ele));if (u_pitch_with_map) {
#ifdef GLOBE
vec3 center_vector=projectToSphere(circle_center);
#endif
float angle_scale=u_globe_extrude_scale;vec2 corner_position=circle_center;if (u_scale_with_map) {angle_scale*=(radius+stroke_width);corner_position+=extrude*u_extrude_scale*(radius+stroke_width);} else {
#ifdef GLOBE
vec4 projected_center=interpolateProjection(circle_center,center_vector,ele);
#else
vec4 projected_center=projectTileWithElevation(circle_center,ele);
#endif
corner_position+=extrude*u_extrude_scale*(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);angle_scale*=(radius+stroke_width)*(projected_center.w/u_camera_to_center_distance);}
#ifdef GLOBE
vec2 angles=extrude*angle_scale;vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(corner_position,corner_vector,ele);
#else
gl_Position=projectTileWithElevation(corner_position,ele);
#endif
} else {gl_Position=projectTileWithElevation(circle_center,ele);if (gl_Position.z/gl_Position.w > 1.0) {gl_Position.xy=vec2(10000.0);}if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:zr(Gd,"in vec2 a_pos;void main() {gl_Position=projectTile(a_pos);}"),heatmap:zr(`uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);fragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;uniform highp float u_globe_extrude_scale;in vec2 a_pos;out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 pos_raw=a_pos+32768.0;vec2 unscaled_extrude=vec2(mod(pos_raw,8.0)/7.0*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 circle_center=floor(pos_raw/8.0);
#ifdef GLOBE
vec2 angles=v_extrude*radius*u_globe_extrude_scale;vec3 center_vector=projectToSphere(circle_center);vec3 corner_vector=globeRotateVector(center_vector,angles);gl_Position=interpolateProjection(circle_center+extrude,corner_vector,0.0);
#else
gl_Position=projectTileFor3D(circle_center+extrude,get_elevation(circle_center));
#endif
}`),heatmapTexture:zr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));fragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:zr("in float v_placed;in float v_notUsed;void main() {float alpha=0.5;fragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {fragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {fragColor*=.1;}}","in vec2 a_anchor_pos;in vec2 a_placed;in vec2 a_box_real;uniform vec2 u_pixel_extrude_scale;out float v_placed;out float v_notUsed;void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:zr("in float v_radius;in vec2 v_extrude;in float v_collision;void main() {float alpha=0.5;float stroke_radius=0.9;float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);fragColor=color*alpha*opacity_t;}","in vec2 a_pos;in float a_radius;in vec2 a_flags;uniform vec2 u_viewport_size;out float v_radius;out vec2 v_extrude;out float v_collision;void main() {float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_collision=collision;gl_Position=vec4((a_pos/u_viewport_size*2.0-1.0)*vec2(1.0,-1.0),0.0,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:zr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);fragColor=mix(u_color,overlay_color,overlay_color.a);}","in vec2 a_pos;out vec2 v_uv;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=projectTileWithElevation(a_pos*u_overlay_scale,get_elevation(a_pos));}"),depth:zr(Gd,`in vec2 a_pos;void main() {
#ifdef GLOBE
gl_Position=projectTileFor3D(a_pos,0.0);
#else
gl_Position=u_projection_matrix*vec4(a_pos,0.0,1.0);
#endif
}`),fill:zr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
fragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_fill_translate;in vec2 a_pos;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);}`),fillOutline:zr(`in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=outline_color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillOutlinePattern:zr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;in vec2 v_pos_a;in vec2 v_pos_b;in vec2 v_pos;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);fragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;out vec2 v_pos;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
}`),fillPattern:zr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);fragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;uniform vec2 u_fill_translate;in vec2 a_pos;out vec2 v_pos_a;out vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=projectTile(a_pos+u_fill_translate,a_pos);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:zr(`in vec4 v_color;void main() {fragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
out vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;vec3 normalForLighting=normal/16384.0;float directional=clamp(dot(normalForLighting,u_lightpos),0.0,1.0);
#ifdef GLOBE
mat3 rotMatrix=globeGetRotationMatrix(spherePos);normalForLighting=rotMatrix*normalForLighting;directional=mix(directional,clamp(dot(normalForLighting,u_lightpos_globe),0.0,1.0),u_projection_transition);
#endif
directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:zr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;in vec2 v_pos_a;in vec2 v_pos_b;in vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);fragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec2 u_fill_translate;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp vec3 u_lightpos_globe;uniform lowp float u_lightintensity;in vec2 a_pos;in vec4 a_normal_ed;
#ifdef TERRAIN3D
in vec2 a_centroid;
#endif
#ifdef GLOBE
out vec3 v_sphere_pos;
#endif
out vec2 v_pos_a;out vec2 v_pos_b;out vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float elevation=t > 0.0 ? height : base;vec2 posInTile=a_pos+u_fill_translate;
#ifdef GLOBE
vec3 spherePos=projectToSphere(posInTile,a_pos);vec3 elevatedPos=spherePos*(1.0+elevation/GLOBE_RADIUS);v_sphere_pos=elevatedPos;gl_Position=interpolateProjectionFor3D(posInTile,spherePos,elevation);
#else
gl_Position=u_projection_matrix*vec4(posInTile,elevation,1.0);
#endif
vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,elevation*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:zr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));fragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:zr(`uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);fragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=projectTile(a_pos,a_pos);v_pos=a_pos/8192.0;if (a_pos.y <-32767.5) {v_pos.y=0.0;}if (a_pos.y > 32766.5) {v_pos.y=1.0;}}"),line:zr(`uniform lowp float u_device_pixel_ratio;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp float v_linesofar;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:zr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec2 v_uv;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture(u_image,v_uv);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_uv_x;in float a_split_index;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec2 v_uv;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:zr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture(u_image,pos_a),texture(u_image,pos_b),u_fade);fragColor=color*alpha*opacity;
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:zr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;in vec2 v_normal;in vec2 v_width2;in vec2 v_tex_a;in vec2 v_tex_b;in float v_gamma_scale;
#ifdef GLOBE
in float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture(u_image,v_tex_a).a;float sdfdist_b=texture(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);fragColor=color*(alpha*opacity);
#ifdef GLOBE
if (v_depth > 1.0) {discard;}
#endif
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
in vec2 a_pos_normal;in vec4 a_data;uniform vec2 u_translation;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;out vec2 v_normal;out vec2 v_width2;out vec2 v_tex_a;out vec2 v_tex_b;out float v_gamma_scale;
#ifdef GLOBE
out float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float adjustedThickness=projectLineThickness(pos.y);vec4 projected_no_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation);vec4 projected_with_extrude=projectTile(pos+offset2/u_ratio*adjustedThickness+u_translation+dist/u_ratio*adjustedThickness);gl_Position=projected_with_extrude;
#ifdef GLOBE
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length((projected_with_extrude.xy-projected_no_extrude.xy)/projected_with_extrude.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:zr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;in vec2 v_pos0;in vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture(u_image0,v_pos0);vec4 color1=texture(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);fragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;uniform vec4 u_coords_top;uniform vec4 u_coords_bottom;in vec2 a_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {vec2 fractionalPos=a_pos/8192.0;vec2 position=mix(mix(u_coords_top.xy,u_coords_top.zw,fractionalPos.x),mix(u_coords_bottom.xy,u_coords_bottom.zw,fractionalPos.x),fractionalPos.y);gl_Position=projectTile(position,position);v_pos0=((fractionalPos-0.5)/u_buffer_scale)+0.5;
#ifdef GLOBE
if (a_pos.y <-32767.5) {v_pos0.y=0.0;}if (a_pos.y > 32766.5) {v_pos0.y=1.0;}
#endif
v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),symbolIcon:zr(`uniform sampler2D u_texture;in vec2 v_tex;in float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;fragColor=texture(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_tex;out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:zr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec4 a_pixeloffset;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:zr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;fragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);fragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
fragColor=vec4(1.0);
#endif
}`,`in vec4 a_pos_offset;in vec4 a_data;in vec3 a_projected_pos;in float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;
#ifdef GLOBE
if(u_pitch_with_map && !u_is_along_line) {float anchor_pos_tile_y=(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w,z,1.0)).y;projectionScaling=mix(projectionScaling,1.0/circumferenceRatioAtTileY(anchor_pos_tile_y)*u_pitched_scale,u_projection_transition);}
#endif
vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:zr("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;uniform bool u_is_globe_mode;in vec2 v_texture_pos;in float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture(u_texture,vec2(v_texture_pos.x,1.0-v_texture_pos.y));if (!u_is_globe_mode && v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);fragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {fragColor=surface_color;}}","in vec3 a_pos3d;uniform mat4 u_fog_matrix;uniform float u_ele_delta;out vec2 v_texture_pos;out float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:zr("in float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {fragColor=pack(v_depth);}","in vec3 a_pos3d;uniform float u_ele_delta;out float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:zr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;in vec2 v_texture_pos;void main() {vec4 rgba=texture(u_texture,v_texture_pos);fragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","in vec3 a_pos3d;uniform float u_ele_delta;out vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=projectTileFor3D(a_pos3d.xy,ele-ele_delta);}"),projectionErrorMeasurement:zr("in vec4 v_output_error_encoded;void main() {fragColor=v_output_error_encoded;}","in vec2 a_pos;uniform highp float u_input;uniform highp float u_output_expected;out vec4 v_output_error_encoded;void main() {float real_output=2.0*atan(exp(PI-(u_input*PI*2.0)))-PI*0.5;float error=real_output-u_output_expected;float abs_error=abs(error)*128.0;v_output_error_encoded.x=min(floor(abs_error*256.0),255.0)/255.0;abs_error-=v_output_error_encoded.x;v_output_error_encoded.y=min(floor(abs_error*65536.0),255.0)/255.0;abs_error-=v_output_error_encoded.x/255.0;v_output_error_encoded.z=min(floor(abs_error*16777216.0),255.0)/255.0;v_output_error_encoded.w=error >=0.0 ? 1.0 : 0.0;gl_Position=vec4(a_pos,0.0,1.0);}"),atmosphere:zr(`in vec3 view_direction;uniform vec3 u_sun_pos;uniform vec3 u_globe_position;uniform float u_globe_radius;uniform float u_atmosphere_blend;/**Shader use from https:*Made some change to adapt to MapLibre Globe geometry*/const float PI=3.141592653589793;const int iSteps=5;const int jSteps=3;/*radius of the planet*/const float EARTH_RADIUS=6371e3;/*radius of the atmosphere*/const float ATMOS_RADIUS=6471e3;vec2 rsi(vec3 r0,vec3 rd,float sr) {float a=dot(rd,rd);float b=2.0*dot(rd,r0);float c=dot(r0,r0)-(sr*sr);float d=(b*b)-4.0*a*c;if (d < 0.0) return vec2(1e5,-1e5);return vec2((-b-sqrt(d))/(2.0*a),(-b+sqrt(d))/(2.0*a));}vec4 atmosphere(vec3 r,vec3 r0,vec3 pSun,float iSun,float rPlanet,float rAtmos,vec3 kRlh,float kMie,float shRlh,float shMie,float g) {pSun=normalize(pSun);r=normalize(r);vec2 p=rsi(r0,r,rAtmos);if (p.x > p.y) {return vec4(0.0,0.0,0.0,1.0);}if (p.x < 0.0) {p.x=0.0;}vec3 pos=r0+r*p.x;vec2 p2=rsi(r0,r,rPlanet);if (p2.x <=p2.y && p2.x > 0.0) {p.y=min(p.y,p2.x);}float iStepSize=(p.y-p.x)/float(iSteps);float iTime=p.x+iStepSize*0.5;vec3 totalRlh=vec3(0,0,0);vec3 totalMie=vec3(0,0,0);float iOdRlh=0.0;float iOdMie=0.0;float mu=dot(r,pSun);float mumu=mu*mu;float gg=g*g;float pRlh=3.0/(16.0*PI)*(1.0+mumu);float pMie=3.0/(8.0*PI)*((1.0-gg)*(mumu+1.0))/(pow(1.0+gg-2.0*mu*g,1.5)*(2.0+gg));for (int i=0; i < iSteps; i++) {vec3 iPos=r0+r*iTime;float iHeight=length(iPos)-rPlanet;float odStepRlh=exp(-iHeight/shRlh)*iStepSize;float odStepMie=exp(-iHeight/shMie)*iStepSize;iOdRlh+=odStepRlh;iOdMie+=odStepMie;float jStepSize=rsi(iPos,pSun,rAtmos).y/float(jSteps);float jTime=jStepSize*0.5;float jOdRlh=0.0;float jOdMie=0.0;for (int j=0; j < jSteps; j++) {vec3 jPos=iPos+pSun*jTime;float jHeight=length(jPos)-rPlanet;jOdRlh+=exp(-jHeight/shRlh)*jStepSize;jOdMie+=exp(-jHeight/shMie)*jStepSize;jTime+=jStepSize;}vec3 attn=exp(-(kMie*(iOdMie+jOdMie)+kRlh*(iOdRlh+jOdRlh)));totalRlh+=odStepRlh*attn;totalMie+=odStepMie*attn;iTime+=iStepSize;}float opacity=exp(-(length(kRlh)*length(totalRlh)+kMie*length(totalMie)));vec3 color=iSun*(pRlh*kRlh*totalRlh+pMie*kMie*totalMie);return vec4(color,opacity);}void main() {vec3 scale_camera_pos=-u_globe_position*EARTH_RADIUS/u_globe_radius;vec4 color=atmosphere(normalize(view_direction),scale_camera_pos,u_sun_pos,22.0,EARTH_RADIUS,ATMOS_RADIUS,vec3(5.5e-6,13.0e-6,22.4e-6),21e-6,8e3,1.2e3,0.758
);color.rgb=1.0-exp(-1.0*color.rgb);color=pow(color,vec4(1.0/2.2));fragColor=vec4(color.rgb,1.0-color.a)*u_atmosphere_blend;}`,"in vec2 a_pos;uniform mat4 u_inv_proj_matrix;out vec3 view_direction;void main() {view_direction=(u_inv_proj_matrix*vec4(a_pos,0.0,1.0)).xyz;gl_Position=vec4(a_pos,0.0,1.0);}"),sky:zr("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform vec2 u_horizon;uniform vec2 u_horizon_normal;uniform float u_sky_horizon_blend;uniform float u_sky_blend;void main() {float x=gl_FragCoord.x;float y=gl_FragCoord.y;float blend=(y-u_horizon.y)*u_horizon_normal.y+(x-u_horizon.x)*u_horizon_normal.x;if (blend > 0.0) {if (blend < u_sky_horizon_blend) {fragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {fragColor=u_sky_color;}}fragColor=mix(fragColor,vec4(vec3(0.0),0.0),u_sky_blend);}","in vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function zr(B,r){const p=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,C=r.match(/in ([\w]+) ([\w]+)/g),k=B.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),j=r.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),Z=j?j.concat(k):k,re={};return{fragmentSource:B=B.replace(p,(ue,ye,Me,Re,ze)=>(re[ze]=!0,ye==="define"?`
#ifndef HAS_UNIFORM_u_${ze}
in ${Me} ${Re} ${ze};
#else
uniform ${Me} ${Re} u_${ze};
#endif
`:`
#ifdef HAS_UNIFORM_u_${ze}
    ${Me} ${Re} ${ze} = u_${ze};
#endif
`)),vertexSource:r=r.replace(p,(ue,ye,Me,Re,ze)=>{const Je=Re==="float"?"vec2":"vec4",ot=ze.match(/color/)?"color":Je;return re[ze]?ye==="define"?`
#ifndef HAS_UNIFORM_u_${ze}
uniform lowp float u_${ze}_t;
in ${Me} ${Je} a_${ze};
out ${Me} ${Re} ${ze};
#else
uniform ${Me} ${Re} u_${ze};
#endif
`:ot==="vec4"?`
#ifndef HAS_UNIFORM_u_${ze}
    ${ze} = a_${ze};
#else
    ${Me} ${Re} ${ze} = u_${ze};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ze}
    ${ze} = unpack_mix_${ot}(a_${ze}, u_${ze}_t);
#else
    ${Me} ${Re} ${ze} = u_${ze};
#endif
`:ye==="define"?`
#ifndef HAS_UNIFORM_u_${ze}
uniform lowp float u_${ze}_t;
in ${Me} ${Je} a_${ze};
#else
uniform ${Me} ${Re} u_${ze};
#endif
`:ot==="vec4"?`
#ifndef HAS_UNIFORM_u_${ze}
    ${Me} ${Re} ${ze} = a_${ze};
#else
    ${Me} ${Re} ${ze} = u_${ze};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ze}
    ${Me} ${Re} ${ze} = unpack_mix_${ot}(a_${ze}, u_${ze}_t);
#else
    ${Me} ${Re} ${ze} = u_${ze};
#endif
`}),staticAttributes:C,staticUniforms:Z}}class Bs{constructor(r,p,C){this.vertexBuffer=r,this.indexBuffer=p,this.segments=C}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}var Br=t.aA([{name:"a_pos",type:"Int16",components:2}]);const Wl="#define PROJECTION_MERCATOR",qd="mercator";class au{constructor(){this._cachedMesh=null}get name(){return"mercator"}get useSubdivision(){return!1}get shaderVariantName(){return qd}get shaderDefine(){return Wl}get shaderPreludeCode(){return ks.projectionMercator}get vertexShaderPreludeCode(){return ks.projectionMercator.vertexSource}get subdivisionGranularity(){return t.aB.noSubdivision}get useGlobeControls(){return!1}get transitionState(){return 0}get latitudeErrorCorrectionRadians(){return 0}destroy(){}updateGPUdependent(r){}getMeshFromTileID(r,p,C,k,j){if(this._cachedMesh)return this._cachedMesh;const Z=new t.aC;Z.emplaceBack(0,0),Z.emplaceBack(t.X,0),Z.emplaceBack(0,t.X),Z.emplaceBack(t.X,t.X);const re=r.createVertexBuffer(Z,Br.members),ue=t.aD.simpleSegment(0,0,4,2),ye=new t.aE;ye.emplaceBack(1,0,2),ye.emplaceBack(1,2,3);const Me=r.createIndexBuffer(ye);return this._cachedMesh=new Bs(re,Me,ue),this._cachedMesh}recalculate(){}hasTransition(){return!1}setErrorQueryLatitudeDegrees(r){}}function $a(B,r){const p=t.ab(r.lat,-85.051129,t.aF);return new t.P(t.O(r.lng)*B,t.Q(p)*B)}function ss(B,r){return new t.Y(r.x/B,r.y/B).toLngLat()}function es(B){return B.cameraToCenterDistance*Math.min(.85*Math.tan(t.aa(90-B.pitch)),Math.tan(t.aa(89.25-B.pitch)))}function Hd(B,r){const p=B.canonical,C=r/t.aG(p.z),k=p.x+Math.pow(2,p.z)*B.wrap,j=t.aq(new Float64Array(16));return t.J(j,j,[k*C,p.y*C,0]),t.K(j,j,[C/t.X,C/t.X,1]),j}function Vs(B,r,p,C,k){const j=t.Y.fromLngLat(B,r),Z=k*t.aH(1,B.lat),re=Z*Math.cos(t.aa(p)),ue=Math.sqrt(Z*Z-re*re),ye=ue*Math.sin(t.aa(-C)),Me=ue*Math.cos(t.aa(-C));return new t.Y(j.x+ye,j.y+Me,j.z+re)}class ts{constructor(r=0,p=0,C=0,k=0){if(isNaN(r)||r<0||isNaN(p)||p<0||isNaN(C)||C<0||isNaN(k)||k<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=p,this.left=C,this.right=k}interpolate(r,p,C){return p.top!=null&&r.top!=null&&(this.top=t.y.number(r.top,p.top,C)),p.bottom!=null&&r.bottom!=null&&(this.bottom=t.y.number(r.bottom,p.bottom,C)),p.left!=null&&r.left!=null&&(this.left=t.y.number(r.left,p.left,C)),p.right!=null&&r.right!=null&&(this.right=t.y.number(r.right,p.right,C)),this}getCenter(r,p){const C=t.ab((this.left+r-this.right)/2,0,r),k=t.ab((this.top+p-this.bottom)/2,0,p);return new t.P(C,k)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new ts(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function no(B,r){if(!B.renderWorldCopies||B.lngRange)return;const p=r.lng-B.center.lng;r.lng+=p>180?-360:p<-180?360:0}function Jh(B){return Math.max(0,Math.floor(B))}class Or{constructor(r,p,C,k,j,Z){this._callbacks=r,this._tileSize=512,this._renderWorldCopies=Z===void 0||!!Z,this._minZoom=p||0,this._maxZoom=C||22,this._minPitch=k??0,this._maxPitch=j??60,this.setMaxBounds(),this._width=0,this._height=0,this._center=new t.N(0,0),this._elevation=0,this._zoom=0,this._tileZoom=Jh(this._zoom),this._scale=t.aG(this._zoom),this._bearingInRadians=0,this._fovInRadians=.6435011087932844,this._pitchInRadians=0,this._rollInRadians=0,this._unmodified=!0,this._edgeInsets=new ts,this._minElevationForCurrentTile=0,this._autoCalculateNearFarZ=!0}apply(r,p,C){this._latRange=r.latRange,this._lngRange=r.lngRange,this._width=r.width,this._height=r.height,this._center=r.center,this._elevation=r.elevation,this._minElevationForCurrentTile=r.minElevationForCurrentTile,this._zoom=r.zoom,this._tileZoom=Jh(this._zoom),this._scale=t.aG(this._zoom),this._bearingInRadians=r.bearingInRadians,this._fovInRadians=r.fovInRadians,this._pitchInRadians=r.pitchInRadians,this._rollInRadians=r.rollInRadians,this._unmodified=r.unmodified,this._edgeInsets=new ts(r.padding.top,r.padding.bottom,r.padding.left,r.padding.right),this._minZoom=r.minZoom,this._maxZoom=r.maxZoom,this._minPitch=r.minPitch,this._maxPitch=r.maxPitch,this._renderWorldCopies=r.renderWorldCopies,this._cameraToCenterDistance=r.cameraToCenterDistance,this._nearZ=r.nearZ,this._farZ=r.farZ,this._autoCalculateNearFarZ=!C&&r.autoCalculateNearFarZ,p&&this._constrain(),this._calcMatrices()}get pixelsToClipSpaceMatrix(){return this._pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._clipSpaceToPixelsMatrix}get minElevationForCurrentTile(){return this._minElevationForCurrentTile}setMinElevationForCurrentTile(r){this._minElevationForCurrentTile=r}get tileSize(){return this._tileSize}get tileZoom(){return this._tileZoom}get scale(){return this._scale}get width(){return this._width}get height(){return this._height}get bearingInRadians(){return this._bearingInRadians}get lngRange(){return this._lngRange}get latRange(){return this._latRange}get pixelsToGLUnits(){return this._pixelsToGLUnits}get minZoom(){return this._minZoom}setMinZoom(r){this._minZoom!==r&&(this._minZoom=r,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get maxZoom(){return this._maxZoom}setMaxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.setZoom(this.getConstrained(this._center,this.zoom).zoom))}get minPitch(){return this._minPitch}setMinPitch(r){this._minPitch!==r&&(this._minPitch=r,this.setPitch(Math.max(this.pitch,r)))}get maxPitch(){return this._maxPitch}setMaxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.setPitch(Math.min(this.pitch,r)))}get renderWorldCopies(){return this._renderWorldCopies}setRenderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this._tileSize*this._scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new t.P(this._width,this._height)}get bearing(){return this._bearingInRadians/Math.PI*180}setBearing(r){const p=t.aI(r,-180,180)*Math.PI/180;var C,k,j,Z,re,ue,ye,Me,Re;this._bearingInRadians!==p&&(this._unmodified=!1,this._bearingInRadians=p,this._calcMatrices(),this._rotationMatrix=W(),C=this._rotationMatrix,j=-this._bearingInRadians,Z=(k=this._rotationMatrix)[0],re=k[1],ue=k[2],ye=k[3],Me=Math.sin(j),Re=Math.cos(j),C[0]=Z*Re+ue*Me,C[1]=re*Re+ye*Me,C[2]=Z*-Me+ue*Re,C[3]=re*-Me+ye*Re)}get rotationMatrix(){return this._rotationMatrix}get pitchInRadians(){return this._pitchInRadians}get pitch(){return this._pitchInRadians/Math.PI*180}setPitch(r){const p=t.ab(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitchInRadians!==p&&(this._unmodified=!1,this._pitchInRadians=p,this._calcMatrices())}get rollInRadians(){return this._rollInRadians}get roll(){return this._rollInRadians/Math.PI*180}setRoll(r){const p=r/180*Math.PI;this._rollInRadians!==p&&(this._unmodified=!1,this._rollInRadians=p,this._calcMatrices())}get fovInRadians(){return this._fovInRadians}get fov(){return t.aJ(this._fovInRadians)}setFov(r){r=t.ab(r,.1,150),this.fov!==r&&(this._unmodified=!1,this._fovInRadians=t.aa(r),this._calcMatrices())}get zoom(){return this._zoom}setZoom(r){const p=this.getConstrained(this._center,r).zoom;this._zoom!==p&&(this._unmodified=!1,this._zoom=p,this._tileZoom=Math.max(0,Math.floor(p)),this._scale=t.aG(p),this._constrain(),this._calcMatrices())}get center(){return this._center}setCenter(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}setElevation(r){r!==this._elevation&&(this._elevation=r,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}setPadding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this._width,this._height)}get pixelsPerMeter(){return this._pixelPerMeter}get unmodified(){return this._unmodified}get cameraToCenterDistance(){return this._cameraToCenterDistance}get nearZ(){return this._nearZ}get farZ(){return this._farZ}get autoCalculateNearFarZ(){return this._autoCalculateNearFarZ}overrideNearFarZ(r,p){this._autoCalculateNearFarZ=!1,this._nearZ=r,this._farZ=p,this._calcMatrices()}clearNearFarZOverride(){this._autoCalculateNearFarZ=!0,this._calcMatrices()}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,p,C){this._unmodified=!1,this._edgeInsets.interpolate(r,p,C),this._constrain(),this._calcMatrices()}resize(r,p,C=!0){this._width=r,this._height=p,C&&this._constrain(),this._calcMatrices()}getMaxBounds(){return this._latRange&&this._latRange.length===2&&this._lngRange&&this._lngRange.length===2?new at([this._lngRange[0],this._latRange[0]],[this._lngRange[1],this._latRange[1]]):null}setMaxBounds(r){r?(this._lngRange=[r.getWest(),r.getEast()],this._latRange=[r.getSouth(),r.getNorth()],this._constrain()):(this._lngRange=null,this._latRange=[-85.051129,t.aF])}getConstrained(r,p){return this._callbacks.getConstrained(r,p)}getCameraQueryGeometry(r,p){if(p.length===1)return[p[0],r];{let C=r.x,k=r.y,j=r.x,Z=r.y;for(const re of p)C=Math.min(C,re.x),k=Math.min(k,re.y),j=Math.max(j,re.x),Z=Math.max(Z,re.y);return[new t.P(C,k),new t.P(j,k),new t.P(j,Z),new t.P(C,Z),new t.P(C,k)]}}_constrain(){if(!this.center||!this._width||!this._height||this._constraining)return;this._constraining=!0;const r=this._unmodified,{center:p,zoom:C}=this.getConstrained(this.center,this.zoom);this.setCenter(p),this.setZoom(C),this._unmodified=r,this._constraining=!1}_calcMatrices(){if(this._width&&this._height){this._pixelsToGLUnits=[2/this._width,-2/this._height];let r=t.aq(new Float64Array(16));t.K(r,r,[this._width/2,-this._height/2,1]),t.J(r,r,[1,-1,0]),this._clipSpaceToPixelsMatrix=r,r=t.aq(new Float64Array(16)),t.K(r,r,[1,-1,1]),t.J(r,r,[-1,-1,0]),t.K(r,r,[2/this._width,2/this._height,1]),this._pixelsToClipSpaceMatrix=r,this._cameraToCenterDistance=.5/Math.tan(this.fovInRadians/2)*this._height}this._callbacks.calcMatrices()}calculateCenterFromCameraLngLatAlt(r,p,C,k){const j=C!==void 0?C:this.bearing,Z=k=k!==void 0?k:this.pitch,re=t.Y.fromLngLat(r,p),ue=-Math.cos(t.aa(Z)),ye=Math.sin(t.aa(Z)),Me=ye*Math.sin(t.aa(j)),Re=-ye*Math.cos(t.aa(j));let ze=this.elevation;const Je=p-ze;let ot;ue*Je>=0||Math.abs(ue)<.1?(ot=1e4,ze=p+ot*ue):ot=-Je/ue;let Pt,Et,Lt=t.aK(1,re.y),jt=0;do{if(jt+=1,jt>10)break;Et=ot/Lt,Pt=new t.Y(re.x+Me*Et,re.y+Re*Et),Lt=1/Pt.meterInMercatorCoordinateUnits()}while(Math.abs(ot-Et*Lt)>1e-12);return{center:Pt.toLngLat(),elevation:ze,zoom:t.a8(this.height/2/Math.tan(this.fovInRadians/2)/Et/this.tileSize)}}recalculateZoomAndCenter(r){if(this.elevation-r==0)return;const p=t.aH(1,this.center.lat)*this.worldSize,C=this.cameraToCenterDistance/p,k=t.Y.fromLngLat(this.center,this.elevation),j=Vs(this.center,this.elevation,this.pitch,this.bearing,C);this._elevation=r;const Z=this.calculateCenterFromCameraLngLatAlt(j.toLngLat(),t.aK(j.z,k.y),this.bearing,this.pitch);this._elevation=Z.elevation,this._center=Z.center,this.setZoom(Z.zoom)}getCameraPoint(){const r=Math.tan(this.pitchInRadians)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.P(r*Math.sin(this.rollInRadians),r*Math.cos(this.rollInRadians)))}getCameraAltitude(){return Math.cos(this.pitchInRadians)*this._cameraToCenterDistance/this._pixelPerMeter+this.elevation}getCameraLngLat(){const r=t.aH(1,this.center.lat)*this.worldSize;return Vs(this.center,this.elevation,this.pitch,this.bearing,this.cameraToCenterDistance/r).toLngLat()}getMercatorTileCoordinates(r){if(!r)return[0,0,1,1];const p=r.canonical.z>=0?1<<r.canonical.z:Math.pow(2,r.canonical.z);return[r.canonical.x/p,r.canonical.y/p,1/p/t.X,1/p/t.X]}}class os{constructor(r,p){this.min=r,this.max=p,this.center=t.aL([],t.aM([],this.min,this.max),.5)}quadrant(r){const p=[r%2==0,r<2],C=t.aN(this.min),k=t.aN(this.max);for(let j=0;j<p.length;j++)C[j]=p[j]?this.min[j]:this.center[j],k[j]=p[j]?this.center[j]:this.max[j];return k[2]=this.max[2],new os(C,k)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}intersectsFrustum(r){let p=!0;for(let C=0;C<r.planes.length;C++){const k=this.intersectsPlane(r.planes[C]);if(k===0)return 0;k===1&&(p=!1)}return p?2:r.aabb.min[0]>this.max[0]||r.aabb.min[1]>this.max[1]||r.aabb.min[2]>this.max[2]||r.aabb.max[0]<this.min[0]||r.aabb.max[1]<this.min[1]||r.aabb.max[2]<this.min[2]?0:1}intersectsPlane(r){let p=r[3],C=r[3];for(let k=0;k<3;k++)r[k]>0?(p+=r[k]*this.min[k],C+=r[k]*this.max[k]):(C+=r[k]*this.min[k],p+=r[k]*this.max[k]);return p>=0?2:C<0?0:1}}class ir{distanceToTile2d(r,p,C,k){const j=k.distanceX([r,p]),Z=k.distanceY([r,p]);return Math.hypot(j,Z)}getWrap(r,p,C){return C}getTileAABB(r,p,C,k){var j,Z;let re=C,ue=C;if(k.terrain){const Me=new t.S(r.z,p,r.z,r.x,r.y),Re=k.terrain.getMinMaxElevation(Me);re=(j=Re.minElevation)!==null&&j!==void 0?j:C,ue=(Z=Re.maxElevation)!==null&&Z!==void 0?Z:C}const ye=1<<r.z;return new os([p+r.x/ye,r.y/ye,re],[p+(r.x+1)/ye,(r.y+1)/ye,ue])}allowVariableZoom(r,p){const C=r.fov*(Math.abs(Math.cos(r.rollInRadians))*r.height+Math.abs(Math.sin(r.rollInRadians))*r.width)/r.height,k=t.ab(78.5-C/2,0,60);return!!p.terrain||r.pitch>k||r.padding.top>=.1}allowWorldCopies(){return!0}recalculateCache(){}}class Xl{constructor(r,p,C){this.points=r,this.planes=p,this.aabb=C}static fromInvProjectionMatrix(r,p=1,C=0){const k=Math.pow(2,C),j=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(ye=>{const Me=1/(ye=t.al([],ye,r))[3]/p*k;return t.aO(ye,ye,[Me,Me,1/ye[3],Me])}),Z=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(ye=>{const Me=t.aP([],j[ye[0]],j[ye[1]]),Re=t.aP([],j[ye[2]],j[ye[1]]),ze=t.aQ([],t.aR([],Me,Re)),Je=-t.aS(ze,j[ye[1]]);return ze.concat(Je)}),re=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY],ue=[Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];for(const ye of j)for(let Me=0;Me<3;Me++)re[Me]=Math.min(re[Me],ye[Me]),ue[Me]=Math.max(ue[Me],ye[Me]);return new Xl(j,Z,new os(re,ue))}}class Dr{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(r){this._helper.setMinZoom(r)}setMaxZoom(r){this._helper.setMaxZoom(r)}setMinPitch(r){this._helper.setMinPitch(r)}setMaxPitch(r){this._helper.setMaxPitch(r)}setRenderWorldCopies(r){this._helper.setRenderWorldCopies(r)}setBearing(r){this._helper.setBearing(r)}setPitch(r){this._helper.setPitch(r)}setRoll(r){this._helper.setRoll(r)}setFov(r){this._helper.setFov(r)}setZoom(r){this._helper.setZoom(r)}setCenter(r){this._helper.setCenter(r)}setElevation(r){this._helper.setElevation(r)}setMinElevationForCurrentTile(r){this._helper.setMinElevationForCurrentTile(r)}setPadding(r){this._helper.setPadding(r)}interpolatePadding(r,p,C){return this._helper.interpolatePadding(r,p,C)}isPaddingEqual(r){return this._helper.isPaddingEqual(r)}resize(r,p,C=!0){this._helper.resize(r,p,C)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(r){this._helper.setMaxBounds(r)}overrideNearFarZ(r,p){this._helper.overrideNearFarZ(r,p)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(r){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),r)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(r,p){}constructor(r,p,C,k,j){this._posMatrixCache=new Map,this._alignedPosMatrixCache=new Map,this._fogMatrixCacheF32=new Map,this._helper=new Or({calcMatrices:()=>{this._calcMatrices()},getConstrained:(Z,re)=>this.getConstrained(Z,re)},r,p,C,k,j),this._coveringTilesDetailsProvider=new ir}clone(){const r=new Dr;return r.apply(this),r}apply(r,p,C){this._helper.apply(r,p,C)}get cameraPosition(){return this._cameraPosition}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._viewProjMatrix}get inverseProjectionMatrix(){return this._invProjMatrix}get mercatorMatrix(){return this._mercatorMatrix}getVisibleUnwrappedCoordinates(r){const p=[new t.aT(0,r)];if(this._helper._renderWorldCopies){const C=this.screenPointToMercatorCoordinate(new t.P(0,0)),k=this.screenPointToMercatorCoordinate(new t.P(this._helper._width,0)),j=this.screenPointToMercatorCoordinate(new t.P(this._helper._width,this._helper._height)),Z=this.screenPointToMercatorCoordinate(new t.P(0,this._helper._height)),re=Math.floor(Math.min(C.x,k.x,j.x,Z.x)),ue=Math.floor(Math.max(C.x,k.x,j.x,Z.x)),ye=1;for(let Me=re-ye;Me<=ue+ye;Me++)Me!==0&&p.push(new t.aT(Me,r))}return p}getCameraFrustum(){return Xl.fromInvProjectionMatrix(this._invViewProjMatrix,this.worldSize)}getClippingPlane(){return null}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(r){const p=this.screenPointToLocation(this.centerPoint,r),C=r?r.getElevationForLngLatZoom(p,this._helper._tileZoom):0;this._helper.recalculateZoomAndCenter(C)}setLocationAtPoint(r,p){const C=t.aH(this.elevation,this.center.lat),k=this.screenPointToMercatorCoordinateAtZ(p,C),j=this.screenPointToMercatorCoordinateAtZ(this.centerPoint,C),Z=t.Y.fromLngLat(r),re=new t.Y(Z.x-(k.x-j.x),Z.y-(k.y-j.y));this.setCenter(re==null?void 0:re.toLngLat()),this._helper._renderWorldCopies&&this.setCenter(this.center.wrap())}locationToScreenPoint(r,p){return p?this.coordinatePoint(t.Y.fromLngLat(r),p.getElevationForLngLatZoom(r,this._helper._tileZoom),this._pixelMatrix3D):this.coordinatePoint(t.Y.fromLngLat(r))}screenPointToLocation(r,p){var C;return(C=this.screenPointToMercatorCoordinate(r,p))===null||C===void 0?void 0:C.toLngLat()}screenPointToMercatorCoordinate(r,p){if(p){const C=p.pointCoordinate(r);if(C!=null)return C}return this.screenPointToMercatorCoordinateAtZ(r)}screenPointToMercatorCoordinateAtZ(r,p){const C=p||0,k=[r.x,r.y,0,1],j=[r.x,r.y,1,1];t.al(k,k,this._pixelMatrixInverse),t.al(j,j,this._pixelMatrixInverse);const Z=k[3],re=j[3],ue=k[1]/Z,ye=j[1]/re,Me=k[2]/Z,Re=j[2]/re,ze=Me===Re?0:(C-Me)/(Re-Me);return new t.Y(t.y.number(k[0]/Z,j[0]/re,ze)/this.worldSize,t.y.number(ue,ye,ze)/this.worldSize,C)}coordinatePoint(r,p=0,C=this._pixelMatrix){const k=[r.x*this.worldSize,r.y*this.worldSize,p,1];return t.al(k,k,C),new t.P(k[0]/k[3],k[1]/k[3])}getBounds(){const r=Math.max(0,this._helper._height/2-es(this));return new at().extend(this.screenPointToLocation(new t.P(0,r))).extend(this.screenPointToLocation(new t.P(this._helper._width,r))).extend(this.screenPointToLocation(new t.P(this._helper._width,this._helper._height))).extend(this.screenPointToLocation(new t.P(0,this._helper._height)))}isPointOnMapSurface(r,p){return p?p.pointCoordinate(r)!=null:r.y>this.height/2-es(this)}calculatePosMatrix(r,p=!1,C){var k;const j=(k=r.key)!==null&&k!==void 0?k:t.aU(r.wrap,r.canonical.z,r.canonical.z,r.canonical.x,r.canonical.y),Z=p?this._alignedPosMatrixCache:this._posMatrixCache;if(Z.has(j)){const ye=Z.get(j);return C?ye.f32:ye.f64}const re=Hd(r,this.worldSize);t.L(re,p?this._alignedProjMatrix:this._viewProjMatrix,re);const ue={f64:re,f32:new Float32Array(re)};return Z.set(j,ue),C?ue.f32:ue.f64}calculateFogMatrix(r){const p=r.key,C=this._fogMatrixCacheF32;if(C.has(p))return C.get(p);const k=Hd(r,this.worldSize);return t.L(k,this._fogMatrix,k),C.set(p,new Float32Array(k)),C.get(p)}getConstrained(r,p){p=t.ab(+p,this.minZoom,this.maxZoom);const C={center:new t.N(r.lng,r.lat),zoom:p};let k=this._helper._lngRange;this._helper._renderWorldCopies||k!==null||(k=[-179.9999999999,180-1e-10]);const j=this.tileSize*t.aG(C.zoom);let Z=0,re=j,ue=0,ye=j,Me=0,Re=0;const{x:ze,y:Je}=this.size;if(this._helper._latRange){const Nt=this._helper._latRange;Z=t.Q(Nt[1])*j,re=t.Q(Nt[0])*j,re-Z<Je&&(Me=Je/(re-Z))}k&&(ue=t.aI(t.O(k[0])*j,0,j),ye=t.aI(t.O(k[1])*j,0,j),ye<ue&&(ye+=j),ye-ue<ze&&(Re=ze/(ye-ue)));const{x:ot,y:Pt}=$a(j,r);let Et,Lt;const jt=Math.max(Re||0,Me||0);if(jt){const Nt=new t.P(Re?(ye+ue)/2:ot,Me?(re+Z)/2:Pt);return C.center=ss(j,Nt).wrap(),C.zoom+=t.a8(jt),C}if(this._helper._latRange){const Nt=Je/2;Pt-Nt<Z&&(Lt=Z+Nt),Pt+Nt>re&&(Lt=re-Nt)}if(k){const Nt=(ue+ye)/2;let Bt=ot;this._helper._renderWorldCopies&&(Bt=t.aI(ot,Nt-j/2,Nt+j/2));const nn=ze/2;Bt-nn<ue&&(Et=ue+nn),Bt+nn>ye&&(Et=ye-nn)}if(Et!==void 0||Lt!==void 0){const Nt=new t.P(Et??ot,Lt??Pt);C.center=ss(j,Nt).wrap()}return C}calculateCenterFromCameraLngLatAlt(r,p,C,k){return this._helper.calculateCenterFromCameraLngLatAlt(r,p,C,k)}_calculateNearFarZIfNeeded(r,p,C){if(!this._helper.autoCalculateNearFarZ)return;const k=Math.min(this.elevation,this.minElevationForCurrentTile,this.getCameraAltitude()-100),j=r-k*this._helper._pixelPerMeter/Math.cos(p),Z=k<0?j:r,re=Math.PI/2+this.pitchInRadians,ue=t.aa(this.fov)*(Math.abs(Math.cos(t.aa(this.roll)))*this.height+Math.abs(Math.sin(t.aa(this.roll)))*this.width)/this.height*(.5+C.y/this.height),ye=Math.sin(ue)*Z/Math.sin(t.ab(Math.PI-re-ue,.01,Math.PI-.01)),Me=es(this),Re=Math.atan(Me/this._helper.cameraToCenterDistance),ze=t.aa(.75),Je=Re>ze?2*Re*(.5+C.y/(2*Me)):ze,ot=Math.sin(Je)*Z/Math.sin(t.ab(Math.PI-re-Je,.01,Math.PI-.01)),Pt=Math.min(ye,ot);this._helper._farZ=1.01*(Math.cos(Math.PI/2-p)*Pt+Z),this._helper._nearZ=this._helper._height/50}_calcMatrices(){if(!this._helper._height)return;const r=this.centerOffset,p=$a(this.worldSize,this.center),C=p.x,k=p.y;this._helper._pixelPerMeter=t.aH(1,this.center.lat)*this.worldSize;const j=t.aa(Math.min(this.pitch,89.25)),Z=Math.max(this._helper.cameraToCenterDistance/2,this._helper.cameraToCenterDistance+this._helper._elevation*this._helper._pixelPerMeter/Math.cos(j));let re;this._calculateNearFarZIfNeeded(Z,j,r),re=new Float64Array(16),t.aV(re,this.fovInRadians,this._helper._width/this._helper._height,this._helper._nearZ,this._helper._farZ),this._invProjMatrix=new Float64Array(16),t.an(this._invProjMatrix,re),re[8]=2*-r.x/this._helper._width,re[9]=2*r.y/this._helper._height,this._projectionMatrix=t.aW(re),t.K(re,re,[1,-1,1]),t.J(re,re,[0,0,-this._helper.cameraToCenterDistance]),t.aX(re,re,-this.rollInRadians),t.aY(re,re,this.pitchInRadians),t.aX(re,re,-this.bearingInRadians),t.J(re,re,[-C,-k,0]),this._mercatorMatrix=t.K([],re,[this.worldSize,this.worldSize,this.worldSize]),t.K(re,re,[1,1,this._helper._pixelPerMeter]),this._pixelMatrix=t.L(new Float64Array(16),this.clipSpaceToPixelsMatrix,re),t.J(re,re,[0,0,-this.elevation]),this._viewProjMatrix=re,this._invViewProjMatrix=t.an([],re);const ue=[0,0,-1,1];t.al(ue,ue,this._invViewProjMatrix),this._cameraPosition=[ue[0]/ue[3],ue[1]/ue[3],ue[2]/ue[3]],this._fogMatrix=new Float64Array(16),t.aV(this._fogMatrix,this.fovInRadians,this.width/this.height,Z,this._helper._farZ),this._fogMatrix[8]=2*-r.x/this.width,this._fogMatrix[9]=2*r.y/this.height,t.K(this._fogMatrix,this._fogMatrix,[1,-1,1]),t.J(this._fogMatrix,this._fogMatrix,[0,0,-this.cameraToCenterDistance]),t.aX(this._fogMatrix,this._fogMatrix,-this.rollInRadians),t.aY(this._fogMatrix,this._fogMatrix,this.pitchInRadians),t.aX(this._fogMatrix,this._fogMatrix,-this.bearingInRadians),t.J(this._fogMatrix,this._fogMatrix,[-C,-k,0]),t.K(this._fogMatrix,this._fogMatrix,[1,1,this._helper._pixelPerMeter]),t.J(this._fogMatrix,this._fogMatrix,[0,0,-this.elevation]),this._pixelMatrix3D=t.L(new Float64Array(16),this.clipSpaceToPixelsMatrix,re);const ye=this._helper._width%2/2,Me=this._helper._height%2/2,Re=Math.cos(this.bearingInRadians),ze=Math.sin(-this.bearingInRadians),Je=C-Math.round(C)+Re*ye+ze*Me,ot=k-Math.round(k)+Re*Me+ze*ye,Pt=new Float64Array(re);if(t.J(Pt,Pt,[Je>.5?Je-1:Je,ot>.5?ot-1:ot,0]),this._alignedProjMatrix=Pt,re=t.an(new Float64Array(16),this._pixelMatrix),!re)throw new Error("failed to invert matrix");this._pixelMatrixInverse=re,this._clearMatrixCaches()}_clearMatrixCaches(){this._posMatrixCache.clear(),this._alignedPosMatrixCache.clear(),this._fogMatrixCacheF32.clear()}maxPitchScaleFactor(){if(!this._pixelMatrixInverse)return 1;const r=this.screenPointToMercatorCoordinate(new t.P(0,0)),p=[r.x*this.worldSize,r.y*this.worldSize,0,1];return t.al(p,p,this._pixelMatrix)[3]/this._helper.cameraToCenterDistance}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){const r=t.aH(1,this.center.lat)*this.worldSize;return Vs(this.center,this.elevation,this.pitch,this.bearing,this._helper.cameraToCenterDistance/r).toLngLat()}lngLatToCameraDepth(r,p){const C=t.Y.fromLngLat(r),k=[C.x*this.worldSize,C.y*this.worldSize,p,1];return t.al(k,k,this._viewProjMatrix),k[2]/k[3]}getProjectionData(r){const{overscaledTileID:p,aligned:C,applyTerrainMatrix:k}=r,j=this._helper.getMercatorTileCoordinates(p),Z=p?this.calculatePosMatrix(p,C,!0):null;let re;return re=p&&p.terrainRttPosMatrix32f&&k?p.terrainRttPosMatrix32f:Z||t.aZ(),{mainMatrix:re,tileMercatorCoords:j,clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:re}}isLocationOccluded(r){return!1}getPixelScale(){return 1}getCircleRadiusCorrection(){return 1}getPitchedTextCorrection(r,p,C){return 1}transformLightDirection(r){return t.aN(r)}getRayDirectionFromPixel(r){throw new Error("Not implemented.")}projectTileCoordinates(r,p,C,k){const j=this.calculatePosMatrix(C);let Z;k?(Z=[r,p,k(r,p),1],t.al(Z,Z,j)):(Z=[r,p,0,1],Ui(Z,Z,j));const re=Z[3];return{point:new t.P(Z[0]/re,Z[1]/re),signedDistanceFromCamera:re,isOccluded:!1}}populateCache(r){for(const p of r)this.calculatePosMatrix(p)}getMatrixForModel(r,p){const C=t.Y.fromLngLat(r,p),k=C.meterInMercatorCoordinateUnits(),j=t.a_();return t.J(j,j,[C.x,C.y,C.z]),t.aX(j,j,Math.PI),t.aY(j,j,Math.PI/2),t.K(j,j,[-k,k,k]),j}getProjectionDataForCustomLayer(r=!0){const p=new t.S(0,0,0,0,0),C=this.getProjectionData({overscaledTileID:p,applyGlobeMatrix:r}),k=Hd(p,this.worldSize);t.L(k,this._viewProjMatrix,k),C.tileMercatorCoords=[0,0,1,1];const j=[t.X,t.X,this.worldSize/this._helper.pixelsPerMeter],Z=t.a$();return t.K(Z,k,j),C.fallbackMatrix=Z,C.mainMatrix=Z,C}getFastPathSimpleProjectionMatrix(r){return this.calculatePosMatrix(r)}}function Qo(){t.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}function fl(B){if(B.useSlerp)if(B.k<1){const r=t.b0(B.startEulerAngles.roll,B.startEulerAngles.pitch,B.startEulerAngles.bearing),p=t.b0(B.endEulerAngles.roll,B.endEulerAngles.pitch,B.endEulerAngles.bearing),C=new Float64Array(4);t.b1(C,r,p,B.k);const k=t.b2(C);B.tr.setRoll(k.roll),B.tr.setPitch(k.pitch),B.tr.setBearing(k.bearing)}else B.tr.setRoll(B.endEulerAngles.roll),B.tr.setPitch(B.endEulerAngles.pitch),B.tr.setBearing(B.endEulerAngles.bearing);else B.tr.setRoll(t.y.number(B.startEulerAngles.roll,B.endEulerAngles.roll,B.k)),B.tr.setPitch(t.y.number(B.startEulerAngles.pitch,B.endEulerAngles.pitch,B.k)),B.tr.setBearing(t.y.number(B.startEulerAngles.bearing,B.endEulerAngles.bearing,B.k))}function fc(B,r,p,C,k){const j=k.padding,Z=$a(k.worldSize,p.getNorthWest()),re=$a(k.worldSize,p.getNorthEast()),ue=$a(k.worldSize,p.getSouthEast()),ye=$a(k.worldSize,p.getSouthWest()),Me=t.aa(-C),Re=Z.rotate(Me),ze=re.rotate(Me),Je=ue.rotate(Me),ot=ye.rotate(Me),Pt=new t.P(Math.max(Re.x,ze.x,ot.x,Je.x),Math.max(Re.y,ze.y,ot.y,Je.y)),Et=new t.P(Math.min(Re.x,ze.x,ot.x,Je.x),Math.min(Re.y,ze.y,ot.y,Je.y)),Lt=Pt.sub(Et),jt=(k.width-(j.left+j.right+r.left+r.right))/Lt.x,Nt=(k.height-(j.top+j.bottom+r.top+r.bottom))/Lt.y;if(Nt<0||jt<0)return void Qo();const Bt=Math.min(t.a8(k.scale*Math.min(jt,Nt)),B.maxZoom),nn=t.P.convert(B.offset),rn=new t.P((r.left-r.right)/2,(r.top-r.bottom)/2).rotate(t.aa(C)),an=nn.add(rn).mult(k.scale/t.aG(Bt));return{center:ss(k.worldSize,Z.add(ue).div(2).sub(an)),zoom:Bt,bearing:C}}class su{get useGlobeControls(){return!1}handlePanInertia(r,p){return{easingOffset:r,easingCenter:p.center}}handleMapControlsRollPitchBearingZoom(r,p){r.bearingDelta&&p.setBearing(p.bearing+r.bearingDelta),r.pitchDelta&&p.setPitch(p.pitch+r.pitchDelta),r.rollDelta&&p.setRoll(p.roll+r.rollDelta),r.zoomDelta&&p.setZoom(p.zoom+r.zoomDelta)}handleMapControlsPan(r,p,C){r.around.distSqr(p.centerPoint)<.01||p.setLocationAtPoint(C,r.around)}cameraForBoxAndBearing(r,p,C,k,j){return fc(r,p,C,k,j)}handleJumpToCenterZoom(r,p){r.zoom!==(p.zoom!==void 0?+p.zoom:r.zoom)&&r.setZoom(+p.zoom),p.center!==void 0&&r.setCenter(t.N.convert(p.center))}handleEaseTo(r,p){const C=r.zoom,k=r.padding,j={roll:r.roll,pitch:r.pitch,bearing:r.bearing},Z={roll:p.roll===void 0?r.roll:p.roll,pitch:p.pitch===void 0?r.pitch:p.pitch,bearing:p.bearing===void 0?r.bearing:p.bearing},re=p.zoom!==void 0,ue=!r.isPaddingEqual(p.padding);let ye=!1;const Me=re?+p.zoom:r.zoom;let Re=r.centerPoint.add(p.offsetAsPoint);const ze=r.screenPointToLocation(Re),{center:Je,zoom:ot}=r.getConstrained(t.N.convert(p.center||ze),Me??C);no(r,Je);const Pt=$a(r.worldSize,ze),Et=$a(r.worldSize,Je).sub(Pt),Lt=t.aG(ot-C);return ye=ot!==C,{easeFunc:jt=>{if(ye&&r.setZoom(t.y.number(C,ot,jt)),t.b3(j,Z)||fl({startEulerAngles:j,endEulerAngles:Z,tr:r,k:jt,useSlerp:j.roll!=Z.roll}),ue&&(r.interpolatePadding(k,p.padding,jt),Re=r.centerPoint.add(p.offsetAsPoint)),p.around)r.setLocationAtPoint(p.around,p.aroundPoint);else{const Nt=t.aG(r.zoom-C),Bt=ot>C?Math.min(2,Lt):Math.max(.5,Lt),nn=Math.pow(Bt,1-jt),rn=ss(r.worldSize,Pt.add(Et.mult(jt*nn)).mult(Nt));r.setLocationAtPoint(r.renderWorldCopies?rn.wrap():rn,Re)}},isZooming:ye,elevationCenter:Je}}handleFlyTo(r,p){const C=p.zoom!==void 0,k=r.zoom,j=r.getConstrained(t.N.convert(p.center||p.locationAtOffset),C?+p.zoom:k),Z=j.center,re=j.zoom;no(r,Z);const ue=$a(r.worldSize,p.locationAtOffset),ye=$a(r.worldSize,Z).sub(ue),Me=ye.mag(),Re=t.aG(re-k);let ze;if(p.minZoom!==void 0){const Je=Math.min(+p.minZoom,k,re),ot=r.getConstrained(Z,Je).zoom;ze=t.aG(ot-k)}return{easeFunc:(Je,ot,Pt,Et)=>{r.setZoom(Je===1?re:k+t.a8(ot));const Lt=Je===1?Z:ss(r.worldSize,ue.add(ye.mult(Pt)).mult(ot));r.setLocationAtPoint(r.renderWorldCopies?Lt.wrap():Lt,Et)},scaleOfZoom:Re,targetCenter:Z,scaleOfMinZoom:ze,pixelPathLength:Me}}}class hi{constructor(r,p,C){this.blendFunction=r,this.blendColor=p,this.mask=C}}hi.Replace=[1,0],hi.disabled=new hi(hi.Replace,t.b4.transparent,[!1,!1,!1,!1]),hi.unblended=new hi(hi.Replace,t.b4.transparent,[!0,!0,!0,!0]),hi.alphaBlended=new hi([1,771],t.b4.transparent,[!0,!0,!0,!0]);const jr=2305;class Wi{constructor(r,p,C){this.enable=r,this.mode=p,this.frontFace=C}}Wi.disabled=new Wi(!1,1029,jr),Wi.backCCW=new Wi(!0,1029,jr),Wi.frontCCW=new Wi(!0,1028,jr);class Sr{constructor(r,p,C){this.func=r,this.mask=p,this.range=C}}Sr.ReadOnly=!1,Sr.ReadWrite=!0,Sr.disabled=new Sr(519,Sr.ReadOnly,[0,1]);const pc=7680;class Hi{constructor(r,p,C,k,j,Z){this.test=r,this.ref=p,this.mask=C,this.fail=k,this.depthFail=j,this.pass=Z}}Hi.disabled=new Hi({func:519,mask:0},0,0,pc,pc,pc);const ou=new WeakMap;function io(B){var r;if(ou.has(B))return ou.get(B);{const p=(r=B.getParameter(B.VERSION))===null||r===void 0?void 0:r.startsWith("WebGL 2.0");return ou.set(B,p),p}}class mc{get awaitingQuery(){return!!this._readbackQueue}constructor(r){this._readbackWaitFrames=4,this._measureWaitFrames=6,this._texWidth=1,this._texHeight=1,this._measuredError=0,this._updateCount=0,this._lastReadbackFrame=-1e3,this._readbackQueue=null,this._cachedRenderContext=r;const p=r.context,C=p.gl;this._texFormat=C.RGBA,this._texType=C.UNSIGNED_BYTE;const k=new t.aC;k.emplaceBack(-1,-1),k.emplaceBack(2,-1),k.emplaceBack(-1,2);const j=new t.aE;j.emplaceBack(0,1,2),this._fullscreenTriangle=new Bs(p.createVertexBuffer(k,Br.members),p.createIndexBuffer(j),t.aD.simpleSegment(0,0,k.length,j.length)),this._resultBuffer=new Uint8Array(4),p.activeTexture.set(C.TEXTURE1);const Z=C.createTexture();C.bindTexture(C.TEXTURE_2D,Z),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_S,C.CLAMP_TO_EDGE),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_T,C.CLAMP_TO_EDGE),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MIN_FILTER,C.NEAREST),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MAG_FILTER,C.NEAREST),C.texImage2D(C.TEXTURE_2D,0,this._texFormat,this._texWidth,this._texHeight,0,this._texFormat,this._texType,null),this._fbo=p.createFramebuffer(this._texWidth,this._texHeight,!1,!1),this._fbo.colorAttachment.set(Z),io(C)&&(this._pbo=C.createBuffer(),C.bindBuffer(C.PIXEL_PACK_BUFFER,this._pbo),C.bufferData(C.PIXEL_PACK_BUFFER,4,C.STREAM_READ),C.bindBuffer(C.PIXEL_PACK_BUFFER,null))}destroy(){const r=this._cachedRenderContext.context.gl;this._fullscreenTriangle.destroy(),this._fbo.destroy(),r.deleteBuffer(this._pbo),this._fullscreenTriangle=null,this._fbo=null,this._pbo=null,this._resultBuffer=null}updateErrorLoop(r,p){const C=this._updateCount;return this._readbackQueue?C>=this._readbackQueue.frameNumberIssued+this._readbackWaitFrames&&this._tryReadback():C>=this._lastReadbackFrame+this._measureWaitFrames&&this._renderErrorTexture(r,p),this._updateCount++,this._measuredError}_bindFramebuffer(){const r=this._cachedRenderContext.context,p=r.gl;r.activeTexture.set(p.TEXTURE1),p.bindTexture(p.TEXTURE_2D,this._fbo.colorAttachment.get()),r.bindFramebuffer.set(this._fbo.framebuffer)}_renderErrorTexture(r,p){const C=this._cachedRenderContext.context,k=C.gl;if(this._bindFramebuffer(),C.viewport.set([0,0,this._texWidth,this._texHeight]),C.clear({color:t.b4.transparent}),this._cachedRenderContext.useProgram("projectionErrorMeasurement").draw(C,k.TRIANGLES,Sr.disabled,Hi.disabled,hi.unblended,Wi.disabled,((j,Z)=>({u_input:j,u_output_expected:Z}))(r,p),null,null,"$clipping",this._fullscreenTriangle.vertexBuffer,this._fullscreenTriangle.indexBuffer,this._fullscreenTriangle.segments),this._pbo&&io(k)){k.bindBuffer(k.PIXEL_PACK_BUFFER,this._pbo),k.readBuffer(k.COLOR_ATTACHMENT0),k.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,0),k.bindBuffer(k.PIXEL_PACK_BUFFER,null);const j=k.fenceSync(k.SYNC_GPU_COMMANDS_COMPLETE,0);k.flush(),this._readbackQueue={frameNumberIssued:this._updateCount,sync:j}}else this._readbackQueue={frameNumberIssued:this._updateCount,sync:null}}_tryReadback(){const r=this._cachedRenderContext.context.gl;if(this._pbo&&this._readbackQueue&&io(r)){const p=r.clientWaitSync(this._readbackQueue.sync,0,0);if(p===r.WAIT_FAILED)return t.w("WebGL2 clientWaitSync failed."),this._readbackQueue=null,void(this._lastReadbackFrame=this._updateCount);if(p===r.TIMEOUT_EXPIRED)return;r.bindBuffer(r.PIXEL_PACK_BUFFER,this._pbo),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,this._resultBuffer,0,4),r.bindBuffer(r.PIXEL_PACK_BUFFER,null)}else this._bindFramebuffer(),r.readPixels(0,0,this._texWidth,this._texHeight,this._texFormat,this._texType,this._resultBuffer);this._readbackQueue=null,this._measuredError=mc._parseRGBA8float(this._resultBuffer),this._lastReadbackFrame=this._updateCount}static _parseRGBA8float(r){let p=0;return p+=r[0]/256,p+=r[1]/65536,p+=r[2]/16777216,r[3]<127&&(p=-p),p/128}}const Ns=t.X/128;function ca(B,r){const p=B.granularity!==void 0?Math.max(B.granularity,1):1,C=p+(B.generateBorders?2:0),k=p+(B.extendToNorthPole||B.generateBorders?1:0)+(B.extendToSouthPole||B.generateBorders?1:0),j=C+1,Z=k+1,re=B.generateBorders?-1:0,ue=B.generateBorders||B.extendToNorthPole?-1:0,ye=p+(B.generateBorders?1:0),Me=p+(B.generateBorders||B.extendToSouthPole?1:0),Re=j*Z,ze=C*k*6,Je=j*Z>65536;if(Je&&r==="16bit")throw new Error("Granularity is too large and meshes would not fit inside 16 bit vertex indices.");const ot=Je||r==="32bit",Pt=new Int16Array(2*Re);let Et=0;for(let Nt=ue;Nt<=Me;Nt++)for(let Bt=re;Bt<=ye;Bt++){let nn=Bt/p*t.X;Bt===-1&&(nn=-64),Bt===p+1&&(nn=t.X+Ns);let rn=Nt/p*t.X;Nt===-1&&(rn=B.extendToNorthPole?t.b6:-64),Nt===p+1&&(rn=B.extendToSouthPole?t.b7:t.X+Ns),Pt[Et++]=nn,Pt[Et++]=rn}const Lt=ot?new Uint32Array(ze):new Uint16Array(ze);let jt=0;for(let Nt=0;Nt<k;Nt++)for(let Bt=0;Bt<C;Bt++){const nn=Bt+1+Nt*j,rn=Bt+(Nt+1)*j,an=Bt+1+(Nt+1)*j;Lt[jt++]=Bt+Nt*j,Lt[jt++]=rn,Lt[jt++]=nn,Lt[jt++]=nn,Lt[jt++]=rn,Lt[jt++]=an}return{vertices:Pt.buffer.slice(0),indices:Lt.buffer.slice(0),uses32bitIndices:ot}}const Vu=new t.aB({fill:new t.b8(128,2),line:new t.b8(512,0),tile:new t.b8(128,32),stencil:new t.b8(128,1),circle:3});class Qh{constructor(){this._tileMeshCache={},this._errorCorrectionUsable=0,this._errorMeasurementLastValue=0,this._errorCorrectionPreviousValue=0,this._errorMeasurementLastChangeTime=-1e3}get name(){return"vertical-perspective"}get transitionState(){return 1}get useSubdivision(){return!0}get shaderVariantName(){return"globe"}get shaderDefine(){return"#define GLOBE"}get shaderPreludeCode(){return ks.projectionGlobe}get vertexShaderPreludeCode(){return ks.projectionMercator.vertexSource}get subdivisionGranularity(){return Vu}get useGlobeControls(){return!0}get latitudeErrorCorrectionRadians(){return this._errorCorrectionUsable}destroy(){this._errorMeasurement&&this._errorMeasurement.destroy()}updateGPUdependent(r){this._errorMeasurement||(this._errorMeasurement=new mc(r));const p=t.Q(this._errorQueryLatitudeDegrees),C=2*Math.atan(Math.exp(Math.PI-p*Math.PI*2))-.5*Math.PI,k=this._errorMeasurement.updateErrorLoop(p,C),j=J.now();k!==this._errorMeasurementLastValue&&(this._errorCorrectionPreviousValue=this._errorCorrectionUsable,this._errorMeasurementLastValue=k,this._errorMeasurementLastChangeTime=j);const Z=Math.min(Math.max((j-this._errorMeasurementLastChangeTime)/1e3/.5,0),1);this._errorCorrectionUsable=t.b9(this._errorCorrectionPreviousValue,-this._errorMeasurementLastValue,t.ba(Z))}_getMeshKey(r){return`${r.granularity.toString(36)}_${r.generateBorders?"b":""}${r.extendToNorthPole?"n":""}${r.extendToSouthPole?"s":""}`}getMeshFromTileID(r,p,C,k,j){const Z=(j==="stencil"?Vu.stencil:Vu.tile).getGranularityForZoomLevel(p.z);return this._getMesh(r,{granularity:Z,generateBorders:C,extendToNorthPole:p.y===0&&k,extendToSouthPole:p.y===(1<<p.z)-1&&k})}_getMesh(r,p){const C=this._getMeshKey(p);if(C in this._tileMeshCache)return this._tileMeshCache[C];const k=function(j,Z){const re=ca(Z,"16bit"),ue=t.aC.deserialize({arrayBuffer:re.vertices,length:re.vertices.byteLength/2/2}),ye=t.aE.deserialize({arrayBuffer:re.indices,length:re.indices.byteLength/2/3});return new Bs(j.createVertexBuffer(ue,Br.members),j.createIndexBuffer(ye),t.aD.simpleSegment(0,0,ue.length,ye.length))}(r,p);return this._tileMeshCache[C]=k,k}recalculate(r){}hasTransition(){const r=J.now();let p=!1;return p=p||(r-this._errorMeasurementLastChangeTime)/1e3<.7,p=p||this._errorMeasurement&&this._errorMeasurement.awaitingQuery,p}setErrorQueryLatitudeDegrees(r){this._errorQueryLatitudeDegrees=r}}const ed=new t.q({type:new t.D(t.v.projection.type)});class Nu extends t.E{constructor(r){super(),this._transitionable=new t.T(ed),this.setProjection(r),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new t.z(0)),this._mercatorProjection=new au,this._verticalPerspectiveProjection=new Qh}get transitionState(){const r=this.properties.get("type");if(typeof r=="string"&&r==="mercator")return 0;if(typeof r=="string"&&r==="vertical-perspective")return 1;if(r instanceof t.bb){if(r.from==="vertical-perspective"&&r.to==="mercator")return 1-r.transition;if(r.from==="mercator"&&r.to==="vertical-perspective")return r.transition}return 1}get useGlobeRendering(){return this.transitionState>0}get latitudeErrorCorrectionRadians(){return this._verticalPerspectiveProjection.latitudeErrorCorrectionRadians}get currentProjection(){return this.useGlobeRendering?this._verticalPerspectiveProjection:this._mercatorProjection}get name(){return"globe"}get useSubdivision(){return this.currentProjection.useSubdivision}get shaderVariantName(){return this.currentProjection.shaderVariantName}get shaderDefine(){return this.currentProjection.shaderDefine}get shaderPreludeCode(){return this.currentProjection.shaderPreludeCode}get vertexShaderPreludeCode(){return this.currentProjection.vertexShaderPreludeCode}get subdivisionGranularity(){return this.currentProjection.subdivisionGranularity}get useGlobeControls(){return this.transitionState>0}destroy(){this._mercatorProjection.destroy(),this._verticalPerspectiveProjection.destroy()}updateGPUdependent(r){this._mercatorProjection.updateGPUdependent(r),this._verticalPerspectiveProjection.updateGPUdependent(r)}getMeshFromTileID(r,p,C,k,j){return this.currentProjection.getMeshFromTileID(r,p,C,k,j)}setProjection(r){this._transitionable.setValue("type",(r==null?void 0:r.type)||"mercator")}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()||this.currentProjection.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}setErrorQueryLatitudeDegrees(r){this._verticalPerspectiveProjection.setErrorQueryLatitudeDegrees(r),this._mercatorProjection.setErrorQueryLatitudeDegrees(r)}}function Zd(B){const r=el(B.worldSize,B.center.lat);return 2*Math.PI*r}function lu(B,r,p,C,k){const j=1/(1<<k),Z=r/t.X*j+C*j,re=t.bd((B/t.X*j+p*j)*Math.PI*2+Math.PI,2*Math.PI),ue=2*Math.atan(Math.exp(Math.PI-Z*Math.PI*2))-.5*Math.PI,ye=Math.cos(ue),Me=new Float64Array(3);return Me[0]=Math.sin(re)*ye,Me[1]=Math.sin(ue),Me[2]=Math.cos(re)*ye,Me}function Yr(B){return function(r,p){const C=Math.cos(p),k=new Float64Array(3);return k[0]=Math.sin(r)*C,k[1]=Math.sin(p),k[2]=Math.cos(r)*C,k}(B.lng*Math.PI/180,B.lat*Math.PI/180)}function el(B,r){return B/(2*Math.PI)/Math.cos(r*Math.PI/180)}function Oa(B){const r=Math.asin(B[1])/Math.PI*180,p=Math.sqrt(B[0]*B[0]+B[2]*B[2]);if(p>1e-6){const C=B[0]/p,k=Math.acos(B[2]/p),j=(C>0?k:-k)/Math.PI*180;return new t.N(t.aI(j,-180,180),r)}return new t.N(0,r)}function Ml(B){return Math.cos(B*Math.PI/180)}function fs(B,r){const p=Ml(B),C=Ml(r);return t.a8(C/p)}function Ca(B,r){const p=B.rotate(r.bearingInRadians),C=r.zoom+fs(r.center.lat,0),k=t.b9(1/Ml(r.center.lat),1/Ml(Math.min(Math.abs(r.center.lat),60)),t.bc(C,7,3,0,1)),j=360/Zd({worldSize:r.worldSize,center:{lat:r.center.lat}});return new t.N(r.center.lng-p.x*j*k,t.ab(r.center.lat+p.y*j,-85.051129,t.aF))}function _o(B){const r=.5*B,p=Math.sin(r),C=Math.cos(r);return Math.log(p+C)-Math.log(C-p)}function Il(B,r,p,C){const k=B.lat+p*C;if(Math.abs(p)>1){const j=(Math.sign(B.lat+p)!==Math.sign(B.lat)?-Math.abs(B.lat):Math.abs(B.lat))*Math.PI/180,Z=Math.abs(B.lat+p)*Math.PI/180,re=_o(j+C*(Z-j)),ue=_o(j),ye=_o(Z);return new t.N(B.lng+r*((re-ue)/(ye-ue)),k)}return new t.N(B.lng+r*C,k)}class ws{constructor(r){this._cachePrevious=new Map,this._cache=new Map,this._hadAnyChanges=!1,this._aabbFactory=r}recalculateCache(){if(!this._hadAnyChanges)return;const r=this._cachePrevious;this._cachePrevious=this._cache,this._cache=r,this._cache.clear(),this._hadAnyChanges=!1}getTileAABB(r,p,C,k){const j=`${r.z}_${r.x}_${r.y}`,Z=this._cache.get(j);if(Z)return Z;const re=this._cachePrevious.get(j);if(re)return this._cache.set(j,re),re;const ue=this._aabbFactory(r,p,C,k);return this._cache.set(j,ue),this._hadAnyChanges=!0,ue}}function ju(B,r,p){const C=B-r;return C<0?-C:Math.max(0,C-p)}function pl(B,r,p,C,k){const j=B-p;let Z;return Z=j<0?Math.min(-j,1+j-k):j>1?Math.min(Math.max(j-k,0),1-j):0,Math.max(Z,ju(r,C,k))}class cu{constructor(){this._aabbCache=new ws(this._computeTileAABB)}recalculateCache(){this._aabbCache.recalculateCache()}distanceToTile2d(r,p,C,k){const j=1<<C.z,Z=1/j,re=C.x/j,ue=C.y/j;let ye=2;return ye=Math.min(ye,pl(r,p,re,ue,Z)),ye=Math.min(ye,pl(r,p,re+.5,-ue-Z,Z)),ye=Math.min(ye,pl(r,p,re+.5,2-ue-Z,Z)),ye}getWrap(r,p,C){const k=1<<p.z,j=1/k,Z=p.x/k,re=ju(r.x,Z,j),ue=ju(r.x,Z-1,j),ye=ju(r.x,Z+1,j),Me=Math.min(re,ue,ye);return Me===ye?1:Me===ue?-1:0}allowVariableZoom(r,p){return ko(r,p)>4}allowWorldCopies(){return!1}getTileAABB(r,p,C,k){return this._aabbCache.getTileAABB(r,p,C,k)}_computeTileAABB(r,p,C,k){if(r.z<=0)return new os([-1,-1,-1],[1,1,1]);if(r.z===1)return new os([r.x===0?-1:0,r.y===0?0:-1,-1],[r.x===0?0:1,r.y===0?1:0,1]);{const j=[lu(0,0,r.x,r.y,r.z),lu(t.X,0,r.x,r.y,r.z),lu(t.X,t.X,r.x,r.y,r.z),lu(0,t.X,r.x,r.y,r.z)],Z=[1,1,1],re=[-1,-1,-1];for(const ue of j)for(let ye=0;ye<3;ye++)Z[ye]=Math.min(Z[ye],ue[ye]),re[ye]=Math.max(re[ye],ue[ye]);if(r.y===0||r.y===(1<<r.z)-1){const ue=[0,r.y===0?1:-1,0];for(let ye=0;ye<3;ye++)Z[ye]=Math.min(Z[ye],ue[ye]),re[ye]=Math.max(re[ye],ue[ye])}return new os(Z,re)}}}class uu{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(r){this._helper.setMinZoom(r)}setMaxZoom(r){this._helper.setMaxZoom(r)}setMinPitch(r){this._helper.setMinPitch(r)}setMaxPitch(r){this._helper.setMaxPitch(r)}setRenderWorldCopies(r){this._helper.setRenderWorldCopies(r)}setBearing(r){this._helper.setBearing(r)}setPitch(r){this._helper.setPitch(r)}setRoll(r){this._helper.setRoll(r)}setFov(r){this._helper.setFov(r)}setZoom(r){this._helper.setZoom(r)}setCenter(r){this._helper.setCenter(r)}setElevation(r){this._helper.setElevation(r)}setMinElevationForCurrentTile(r){this._helper.setMinElevationForCurrentTile(r)}setPadding(r){this._helper.setPadding(r)}interpolatePadding(r,p,C){return this._helper.interpolatePadding(r,p,C)}isPaddingEqual(r){return this._helper.isPaddingEqual(r)}resize(r,p){this._helper.resize(r,p)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(r){this._helper.setMaxBounds(r)}overrideNearFarZ(r,p){this._helper.overrideNearFarZ(r,p)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(r){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),r)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}setTransitionState(r){}constructor(){this._cachedClippingPlane=t.be(),this._projectionMatrix=t.a_(),this._globeViewProjMatrix32f=t.aZ(),this._globeViewProjMatrixNoCorrection=t.a_(),this._globeViewProjMatrixNoCorrectionInverted=t.a_(),this._globeProjMatrixInverted=t.a_(),this._cameraPosition=t.bf(),this._globeLatitudeErrorCorrectionRadians=0,this._helper=new Or({calcMatrices:()=>{this._calcMatrices()},getConstrained:(r,p)=>this.getConstrained(r,p)}),this._coveringTilesDetailsProvider=new cu}clone(){const r=new uu;return r.apply(this),r}apply(r,p){this._globeLatitudeErrorCorrectionRadians=p||0,this._helper.apply(r)}get projectionMatrix(){return this._projectionMatrix}get modelViewProjectionMatrix(){return this._globeViewProjMatrixNoCorrection}get inverseProjectionMatrix(){return this._globeProjMatrixInverted}get cameraPosition(){const r=t.bf();return r[0]=this._cameraPosition[0],r[1]=this._cameraPosition[1],r[2]=this._cameraPosition[2],r}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}getProjectionData(r){const{overscaledTileID:p,applyGlobeMatrix:C}=r,k=this._helper.getMercatorTileCoordinates(p);return{mainMatrix:this._globeViewProjMatrix32f,tileMercatorCoords:k,clippingPlane:this._cachedClippingPlane,projectionTransition:C?1:0,fallbackMatrix:this._globeViewProjMatrix32f}}_computeClippingPlane(r){const p=this.pitchInRadians,C=this.cameraToCenterDistance/r,k=Math.sin(p)*C,j=Math.cos(p)*C+1,Z=1/Math.sqrt(k*k+j*j)*1;let re=-k,ue=j;const ye=Math.sqrt(re*re+ue*ue);re/=ye,ue/=ye;const Me=[0,re,ue];return t.bg(Me,Me,[0,0,0],-this.bearingInRadians),t.bh(Me,Me,[0,0,0],-1*this.center.lat*Math.PI/180),t.bi(Me,Me,[0,0,0],this.center.lng*Math.PI/180),t.aL(Me,Me,.25),[...Me,.25*-Z]}isLocationOccluded(r){return!this.isSurfacePointVisible(Yr(r))}transformLightDirection(r){const p=this._helper._center.lng*Math.PI/180,C=this._helper._center.lat*Math.PI/180,k=Math.cos(C),j=[Math.sin(p)*k,Math.sin(C),Math.cos(p)*k],Z=[j[2],0,-j[0]],re=[0,0,0];t.aR(re,Z,j),t.aQ(Z,Z),t.aQ(re,re);const ue=[0,0,0];return t.aQ(ue,[Z[0]*r[0]+re[0]*r[1]+j[0]*r[2],Z[1]*r[0]+re[1]*r[1]+j[1]*r[2],Z[2]*r[0]+re[2]*r[1]+j[2]*r[2]]),ue}getPixelScale(){return 1/Math.cos(this._helper._center.lat*Math.PI/180)}getCircleRadiusCorrection(){return Math.cos(this._helper._center.lat*Math.PI/180)}getPitchedTextCorrection(r,p,C){const k=function(re,ue,ye){const Me=1/(1<<ye.z);return new t.Y(re/t.X*Me+ye.x*Me,ue/t.X*Me+ye.y*Me)}(r,p,C.canonical),j=(Z=k.y,[t.bd(k.x*Math.PI*2+Math.PI,2*Math.PI),2*Math.atan(Math.exp(Math.PI-Z*Math.PI*2))-.5*Math.PI]);var Z;return this.getCircleRadiusCorrection()/Math.cos(j[1])}projectTileCoordinates(r,p,C,k){const j=C.canonical,Z=lu(r,p,j.x,j.y,j.z),re=1+(k?k(r,p):0)/t.bo,ue=[Z[0]*re,Z[1]*re,Z[2]*re,1];t.al(ue,ue,this._globeViewProjMatrixNoCorrection);const ye=this._cachedClippingPlane,Me=ye[0]*Z[0]+ye[1]*Z[1]+ye[2]*Z[2]+ye[3]<0;return{point:new t.P(ue[0]/ue[3],ue[1]/ue[3]),signedDistanceFromCamera:ue[3],isOccluded:Me}}_calcMatrices(){if(!this._helper._width||!this._helper._height)return;const r=el(this.worldSize,this.center.lat),p=t.a$(),C=t.a$();this._helper.autoCalculateNearFarZ&&(this._helper._nearZ=.5,this._helper._farZ=this.cameraToCenterDistance+2*r),t.aV(p,this.fovInRadians,this.width/this.height,this._helper._nearZ,this._helper._farZ);const k=this.centerOffset;p[8]=2*-k.x/this._helper._width,p[9]=2*k.y/this._helper._height,this._projectionMatrix=t.aW(p),this._globeProjMatrixInverted=t.a$(),t.an(this._globeProjMatrixInverted,p),t.J(p,p,[0,0,-this.cameraToCenterDistance]),t.aX(p,p,this.rollInRadians),t.aY(p,p,-this.pitchInRadians),t.aX(p,p,this.bearingInRadians),t.J(p,p,[0,0,-r]);const j=t.bf();j[0]=r,j[1]=r,j[2]=r,t.aY(C,p,this.center.lat*Math.PI/180),t.bj(C,C,-this.center.lng*Math.PI/180),t.K(C,C,j),this._globeViewProjMatrixNoCorrection=C,t.aY(p,p,this.center.lat*Math.PI/180-this._globeLatitudeErrorCorrectionRadians),t.bj(p,p,-this.center.lng*Math.PI/180),t.K(p,p,j),this._globeViewProjMatrix32f=new Float32Array(p),this._globeViewProjMatrixNoCorrectionInverted=t.a$(),t.an(this._globeViewProjMatrixNoCorrectionInverted,C);const Z=t.bf();this._cameraPosition=t.bf(),this._cameraPosition[2]=this.cameraToCenterDistance/r,t.bg(this._cameraPosition,this._cameraPosition,Z,-this.rollInRadians),t.bh(this._cameraPosition,this._cameraPosition,Z,this.pitchInRadians),t.bg(this._cameraPosition,this._cameraPosition,Z,-this.bearingInRadians),t.aM(this._cameraPosition,this._cameraPosition,[0,0,1]),t.bh(this._cameraPosition,this._cameraPosition,Z,-this.center.lat*Math.PI/180),t.bi(this._cameraPosition,this._cameraPosition,Z,this.center.lng*Math.PI/180),this._cachedClippingPlane=this._computeClippingPlane(r);const re=t.aW(this._globeViewProjMatrixNoCorrectionInverted);t.K(re,re,[1,1,-1]),this._cachedFrustum=Xl.fromInvProjectionMatrix(re)}calculateFogMatrix(r){t.w("calculateFogMatrix is not supported on globe projection.");const p=t.a$();return t.aq(p),p}getVisibleUnwrappedCoordinates(r){return[new t.aT(0,r)]}getCameraFrustum(){return this._cachedFrustum}getClippingPlane(){return this._cachedClippingPlane}getCoveringTilesDetailsProvider(){return this._coveringTilesDetailsProvider}recalculateZoomAndCenter(r){r&&t.w("terrain is not fully supported on vertical perspective projection."),this._helper.recalculateZoomAndCenter(0)}maxPitchScaleFactor(){return 1}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(r,p){if(!this._globeViewProjMatrixNoCorrection)return 1;const C=Yr(r);t.aL(C,C,1+p/t.bo);const k=t.be();return t.al(k,[C[0],C[1],C[2],1],this._globeViewProjMatrixNoCorrection),k[2]/k[3]}populateCache(r){}getBounds(){const r=.5*this.width,p=.5*this.height,C=[new t.P(0,0),new t.P(r,0),new t.P(this.width,0),new t.P(this.width,p),new t.P(this.width,this.height),new t.P(r,this.height),new t.P(0,this.height),new t.P(0,p)],k=[];for(const Re of C)k.push(this.unprojectScreenPoint(Re));let j=0,Z=0,re=0,ue=0;const ye=this.center;for(const Re of k){const ze=t.bk(ye.lng,Re.lng),Je=t.bk(ye.lat,Re.lat);ze<Z&&(Z=ze),ze>j&&(j=ze),Je<ue&&(ue=Je),Je>re&&(re=Je)}const Me=[ye.lng+Z,ye.lat+ue,ye.lng+j,ye.lat+re];return this.isSurfacePointOnScreen([0,1,0])&&(Me[3]=90,Me[0]=-180,Me[2]=180),this.isSurfacePointOnScreen([0,-1,0])&&(Me[1]=-90,Me[0]=-180,Me[2]=180),new at(Me)}getConstrained(r,p){const C=t.ab(r.lat,-85.051129,t.aF),k=t.ab(+p,this.minZoom+fs(0,C),this.maxZoom);return{center:new t.N(r.lng,C),zoom:k}}calculateCenterFromCameraLngLatAlt(r,p,C,k){return this._helper.calculateCenterFromCameraLngLatAlt(r,p,C,k)}setLocationAtPoint(r,p){const C=Yr(this.unprojectScreenPoint(p)),k=Yr(r),j=t.bf();t.bl(j);const Z=t.bf();t.bi(Z,C,j,-this.center.lng*Math.PI/180),t.bh(Z,Z,j,this.center.lat*Math.PI/180);const re=k[0]*k[0]+k[2]*k[2],ue=Z[0]*Z[0];if(re<ue)return;const ye=Math.sqrt(re-ue),Me=-ye,Re=t.bm(k[0],k[2],Z[0],ye),ze=t.bm(k[0],k[2],Z[0],Me),Je=t.bf();t.bi(Je,k,j,-Re);const ot=t.bm(Je[1],Je[2],Z[1],Z[2]),Pt=t.bf();t.bi(Pt,k,j,-ze);const Et=t.bm(Pt[1],Pt[2],Z[1],Z[2]),Lt=.5*Math.PI,jt=ot>=-Lt&&ot<=Lt,Nt=Et>=-Lt&&Et<=Lt;let Bt,nn;if(jt&&Nt){const Rn=this.center.lng*Math.PI/180,Hn=this.center.lat*Math.PI/180;t.bp(Re,Rn)+t.bp(ot,Hn)<t.bp(ze,Rn)+t.bp(Et,Hn)?(Bt=Re,nn=ot):(Bt=ze,nn=Et)}else if(jt)Bt=Re,nn=ot;else{if(!Nt)return;Bt=ze,nn=Et}const rn=Bt/Math.PI*180,an=nn/Math.PI*180,Mn=this.center.lat;this.setCenter(new t.N(rn,t.ab(an,-90,90))),this.setZoom(this.zoom+fs(Mn,this.center.lat))}locationToScreenPoint(r,p){const C=Yr(r);if(p){const k=p.getElevationForLngLatZoom(r,this._helper._tileZoom);t.aL(C,C,1+k/t.bo)}return this._projectSurfacePointToScreen(C)}_projectSurfacePointToScreen(r){const p=t.be();return t.al(p,[...r,1],this._globeViewProjMatrixNoCorrection),p[0]/=p[3],p[1]/=p[3],new t.P((.5*p[0]+.5)*this.width,(.5*-p[1]+.5)*this.height)}screenPointToMercatorCoordinate(r,p){if(p){const C=p.pointCoordinate(r);if(C)return C}return t.Y.fromLngLat(this.unprojectScreenPoint(r))}screenPointToLocation(r,p){var C;return(C=this.screenPointToMercatorCoordinate(r,p))===null||C===void 0?void 0:C.toLngLat()}isPointOnMapSurface(r,p){const C=this._cameraPosition,k=this.getRayDirectionFromPixel(r);return!!this.rayPlanetIntersection(C,k)}getRayDirectionFromPixel(r){const p=t.be();p[0]=r.x/this.width*2-1,p[1]=-1*(r.y/this.height*2-1),p[2]=1,p[3]=1,t.al(p,p,this._globeViewProjMatrixNoCorrectionInverted),p[0]/=p[3],p[1]/=p[3],p[2]/=p[3];const C=t.bf();C[0]=p[0]-this._cameraPosition[0],C[1]=p[1]-this._cameraPosition[1],C[2]=p[2]-this._cameraPosition[2];const k=t.bf();return t.aQ(k,C),k}isSurfacePointVisible(r){const p=this._cachedClippingPlane;return p[0]*r[0]+p[1]*r[1]+p[2]*r[2]+p[3]>=0}isSurfacePointOnScreen(r){if(!this.isSurfacePointVisible(r))return!1;const p=t.be();return t.al(p,[...r,1],this._globeViewProjMatrixNoCorrection),p[0]/=p[3],p[1]/=p[3],p[2]/=p[3],p[0]>-1&&p[0]<1&&p[1]>-1&&p[1]<1&&p[2]>-1&&p[2]<1}rayPlanetIntersection(r,p){const C=t.aS(r,p),k=t.bf(),j=t.bf();t.aL(j,p,C),t.aP(k,r,j);const Z=1-t.aS(k,k);if(Z<0)return null;const re=t.aS(r,r)-1,ue=-C+(C<0?1:-1)*Math.sqrt(Z),ye=re/ue,Me=ue;return{tMin:Math.min(ye,Me),tMax:Math.max(ye,Me)}}unprojectScreenPoint(r){const p=this._cameraPosition,C=this.getRayDirectionFromPixel(r),k=this.rayPlanetIntersection(p,C);if(k){const ye=t.bf();t.aM(ye,p,[C[0]*k.tMin,C[1]*k.tMin,C[2]*k.tMin]);const Me=t.bf();return t.aQ(Me,ye),Oa(Me)}const j=this._cachedClippingPlane[0]*C[0]+this._cachedClippingPlane[1]*C[1]+this._cachedClippingPlane[2]*C[2],Z=-t.bn(this._cachedClippingPlane,p)/j,re=t.bf();if(Z>0)t.aM(re,p,[C[0]*Z,C[1]*Z,C[2]*Z]);else{const ye=t.bf();t.aM(ye,p,[2*C[0],2*C[1],2*C[2]]);const Me=t.bn(this._cachedClippingPlane,ye);t.aP(re,ye,[this._cachedClippingPlane[0]*Me,this._cachedClippingPlane[1]*Me,this._cachedClippingPlane[2]*Me])}const ue=t.bf();return t.aQ(ue,re),Oa(ue)}getMatrixForModel(r,p){const C=t.N.convert(r),k=1/t.bo,j=t.a_();return t.bj(j,j,C.lng/180*Math.PI),t.aY(j,j,-C.lat/180*Math.PI),t.J(j,j,[0,0,1+p/t.bo]),t.aY(j,j,.5*Math.PI),t.K(j,j,[k,k,k]),j}getProjectionDataForCustomLayer(r=!0){const p=this.getProjectionData({overscaledTileID:new t.S(0,0,0,0,0),applyGlobeMatrix:r});return p.tileMercatorCoords=[0,0,1,1],p}getFastPathSimpleProjectionMatrix(r){}}class Pl{get pixelsToClipSpaceMatrix(){return this._helper.pixelsToClipSpaceMatrix}get clipSpaceToPixelsMatrix(){return this._helper.clipSpaceToPixelsMatrix}get pixelsToGLUnits(){return this._helper.pixelsToGLUnits}get centerOffset(){return this._helper.centerOffset}get size(){return this._helper.size}get rotationMatrix(){return this._helper.rotationMatrix}get centerPoint(){return this._helper.centerPoint}get pixelsPerMeter(){return this._helper.pixelsPerMeter}setMinZoom(r){this._helper.setMinZoom(r)}setMaxZoom(r){this._helper.setMaxZoom(r)}setMinPitch(r){this._helper.setMinPitch(r)}setMaxPitch(r){this._helper.setMaxPitch(r)}setRenderWorldCopies(r){this._helper.setRenderWorldCopies(r)}setBearing(r){this._helper.setBearing(r)}setPitch(r){this._helper.setPitch(r)}setRoll(r){this._helper.setRoll(r)}setFov(r){this._helper.setFov(r)}setZoom(r){this._helper.setZoom(r)}setCenter(r){this._helper.setCenter(r)}setElevation(r){this._helper.setElevation(r)}setMinElevationForCurrentTile(r){this._helper.setMinElevationForCurrentTile(r)}setPadding(r){this._helper.setPadding(r)}interpolatePadding(r,p,C){return this._helper.interpolatePadding(r,p,C)}isPaddingEqual(r){return this._helper.isPaddingEqual(r)}resize(r,p,C=!0){this._helper.resize(r,p,C)}getMaxBounds(){return this._helper.getMaxBounds()}setMaxBounds(r){this._helper.setMaxBounds(r)}overrideNearFarZ(r,p){this._helper.overrideNearFarZ(r,p)}clearNearFarZOverride(){this._helper.clearNearFarZOverride()}getCameraQueryGeometry(r){return this._helper.getCameraQueryGeometry(this.getCameraPoint(),r)}get tileSize(){return this._helper.tileSize}get tileZoom(){return this._helper.tileZoom}get scale(){return this._helper.scale}get worldSize(){return this._helper.worldSize}get width(){return this._helper.width}get height(){return this._helper.height}get lngRange(){return this._helper.lngRange}get latRange(){return this._helper.latRange}get minZoom(){return this._helper.minZoom}get maxZoom(){return this._helper.maxZoom}get zoom(){return this._helper.zoom}get center(){return this._helper.center}get minPitch(){return this._helper.minPitch}get maxPitch(){return this._helper.maxPitch}get pitch(){return this._helper.pitch}get pitchInRadians(){return this._helper.pitchInRadians}get roll(){return this._helper.roll}get rollInRadians(){return this._helper.rollInRadians}get bearing(){return this._helper.bearing}get bearingInRadians(){return this._helper.bearingInRadians}get fov(){return this._helper.fov}get fovInRadians(){return this._helper.fovInRadians}get elevation(){return this._helper.elevation}get minElevationForCurrentTile(){return this._helper.minElevationForCurrentTile}get padding(){return this._helper.padding}get unmodified(){return this._helper.unmodified}get renderWorldCopies(){return this._helper.renderWorldCopies}get cameraToCenterDistance(){return this._helper.cameraToCenterDistance}get nearZ(){return this._helper.nearZ}get farZ(){return this._helper.farZ}get autoCalculateNearFarZ(){return this._helper.autoCalculateNearFarZ}get isGlobeRendering(){return this._globeness>0}setTransitionState(r,p){this._globeness=r,this._globeLatitudeErrorCorrectionRadians=p,this._calcMatrices(),this._verticalPerspectiveTransform.getCoveringTilesDetailsProvider().recalculateCache(),this._mercatorTransform.getCoveringTilesDetailsProvider().recalculateCache()}get currentTransform(){return this.isGlobeRendering?this._verticalPerspectiveTransform:this._mercatorTransform}constructor(){this._globeLatitudeErrorCorrectionRadians=0,this._globeness=1,this._helper=new Or({calcMatrices:()=>{this._calcMatrices()},getConstrained:(r,p)=>this.getConstrained(r,p)}),this._globeness=1,this._mercatorTransform=new Dr,this._verticalPerspectiveTransform=new uu}clone(){const r=new Pl;return r._globeness=this._globeness,r._globeLatitudeErrorCorrectionRadians=this._globeLatitudeErrorCorrectionRadians,r.apply(this),r}apply(r){this._helper.apply(r),this._mercatorTransform.apply(this),this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians)}get projectionMatrix(){return this.currentTransform.projectionMatrix}get modelViewProjectionMatrix(){return this.currentTransform.modelViewProjectionMatrix}get inverseProjectionMatrix(){return this.currentTransform.inverseProjectionMatrix}get cameraPosition(){return this.currentTransform.cameraPosition}getProjectionData(r){const p=this._mercatorTransform.getProjectionData(r),C=this._verticalPerspectiveTransform.getProjectionData(r);return{mainMatrix:this.isGlobeRendering?C.mainMatrix:p.mainMatrix,clippingPlane:C.clippingPlane,tileMercatorCoords:C.tileMercatorCoords,projectionTransition:r.applyGlobeMatrix?this._globeness:0,fallbackMatrix:p.fallbackMatrix}}isLocationOccluded(r){return this.currentTransform.isLocationOccluded(r)}transformLightDirection(r){return this.currentTransform.transformLightDirection(r)}getPixelScale(){return t.b9(this._mercatorTransform.getPixelScale(),this._verticalPerspectiveTransform.getPixelScale(),this._globeness)}getCircleRadiusCorrection(){return t.b9(this._mercatorTransform.getCircleRadiusCorrection(),this._verticalPerspectiveTransform.getCircleRadiusCorrection(),this._globeness)}getPitchedTextCorrection(r,p,C){const k=this._mercatorTransform.getPitchedTextCorrection(r,p,C),j=this._verticalPerspectiveTransform.getPitchedTextCorrection(r,p,C);return t.b9(k,j,this._globeness)}projectTileCoordinates(r,p,C,k){return this.currentTransform.projectTileCoordinates(r,p,C,k)}_calcMatrices(){this._helper._width&&this._helper._height&&(this._verticalPerspectiveTransform.apply(this,this._globeLatitudeErrorCorrectionRadians),this._helper._nearZ=this._verticalPerspectiveTransform.nearZ,this._helper._farZ=this._verticalPerspectiveTransform.farZ,this._mercatorTransform.apply(this,!0,this.isGlobeRendering),this._helper._nearZ=this._mercatorTransform.nearZ,this._helper._farZ=this._mercatorTransform.farZ)}calculateFogMatrix(r){return this.currentTransform.calculateFogMatrix(r)}getVisibleUnwrappedCoordinates(r){return this.currentTransform.getVisibleUnwrappedCoordinates(r)}getCameraFrustum(){return this.currentTransform.getCameraFrustum()}getClippingPlane(){return this.currentTransform.getClippingPlane()}getCoveringTilesDetailsProvider(){return this.currentTransform.getCoveringTilesDetailsProvider()}recalculateZoomAndCenter(r){this._mercatorTransform.recalculateZoomAndCenter(r),this._verticalPerspectiveTransform.recalculateZoomAndCenter(r)}maxPitchScaleFactor(){return this._mercatorTransform.maxPitchScaleFactor()}getCameraPoint(){return this._helper.getCameraPoint()}getCameraAltitude(){return this._helper.getCameraAltitude()}getCameraLngLat(){return this._helper.getCameraLngLat()}lngLatToCameraDepth(r,p){return this.currentTransform.lngLatToCameraDepth(r,p)}populateCache(r){this._mercatorTransform.populateCache(r),this._verticalPerspectiveTransform.populateCache(r)}getBounds(){return this.currentTransform.getBounds()}getConstrained(r,p){return this.currentTransform.getConstrained(r,p)}calculateCenterFromCameraLngLatAlt(r,p,C,k){return this._helper.calculateCenterFromCameraLngLatAlt(r,p,C,k)}setLocationAtPoint(r,p){if(!this.isGlobeRendering)return this._mercatorTransform.setLocationAtPoint(r,p),void this.apply(this._mercatorTransform);this._verticalPerspectiveTransform.setLocationAtPoint(r,p),this.apply(this._verticalPerspectiveTransform)}locationToScreenPoint(r,p){return this.currentTransform.locationToScreenPoint(r,p)}screenPointToMercatorCoordinate(r,p){return this.currentTransform.screenPointToMercatorCoordinate(r,p)}screenPointToLocation(r,p){return this.currentTransform.screenPointToLocation(r,p)}isPointOnMapSurface(r,p){return this.currentTransform.isPointOnMapSurface(r,p)}getRayDirectionFromPixel(r){return this._verticalPerspectiveTransform.getRayDirectionFromPixel(r)}getMatrixForModel(r,p){return this.currentTransform.getMatrixForModel(r,p)}getProjectionDataForCustomLayer(r=!0){const p=this._mercatorTransform.getProjectionDataForCustomLayer(r);if(!this.isGlobeRendering)return p;const C=this._verticalPerspectiveTransform.getProjectionDataForCustomLayer(r);return C.fallbackMatrix=p.mainMatrix,C}getFastPathSimpleProjectionMatrix(r){return this.currentTransform.getFastPathSimpleProjectionMatrix(r)}}class Al{get useGlobeControls(){return!0}handlePanInertia(r,p){const C=Ca(r,p);return Math.abs(C.lng-p.center.lng)>180&&(C.lng=p.center.lng+179.5*Math.sign(C.lng-p.center.lng)),{easingCenter:C,easingOffset:new t.P(0,0)}}handleMapControlsRollPitchBearingZoom(r,p){const C=r.around,k=p.screenPointToLocation(C);r.bearingDelta&&p.setBearing(p.bearing+r.bearingDelta),r.pitchDelta&&p.setPitch(p.pitch+r.pitchDelta),r.rollDelta&&p.setRoll(p.roll+r.rollDelta);const j=p.zoom;r.zoomDelta&&p.setZoom(p.zoom+r.zoomDelta);const Z=p.zoom-j;if(Z===0)return;const re=t.bk(p.center.lng,k.lng),ue=re/(Math.abs(re/180)+1),ye=t.bk(p.center.lat,k.lat),Me=p.getRayDirectionFromPixel(C),Re=p.cameraPosition,ze=-1*t.aS(Re,Me),Je=t.bf();t.aM(Je,Re,[Me[0]*ze,Me[1]*ze,Me[2]*ze]);const ot=t.bq(Je)-1,Pt=Math.exp(.5*-Math.max(ot-.3,0)),Et=el(p.worldSize,p.center.lat)/Math.min(p.width,p.height),Lt=t.bc(Et,.9,.5,1,.25),jt=(1-t.aG(-Z))*Math.min(Pt,Lt),Nt=p.center.lat,Bt=p.zoom,nn=new t.N(p.center.lng+ue*jt,t.ab(p.center.lat+ye*jt,-85.051129,t.aF));p.setLocationAtPoint(k,C);const rn=p.center,an=t.bc(Math.abs(re),45,85,0,1),Mn=t.bc(Et,.75,.35,0,1),Rn=Math.pow(Math.max(an,Mn),.25),Hn=t.bk(rn.lng,nn.lng),ei=t.bk(rn.lat,nn.lat);p.setCenter(new t.N(rn.lng+Hn*Rn,rn.lat+ei*Rn).wrap()),p.setZoom(Bt+fs(Nt,p.center.lat))}handleMapControlsPan(r,p,C){if(!r.panDelta)return;const k=p.center.lat,j=p.zoom;p.setCenter(Ca(r.panDelta,p).wrap()),p.setZoom(j+fs(k,p.center.lat))}cameraForBoxAndBearing(r,p,C,k,j){const Z=fc(r,p,C,k,j),re=p.left/j.width*2-1,ue=(j.width-p.right)/j.width*2-1,ye=p.top/j.height*-2+1,Me=(j.height-p.bottom)/j.height*-2+1,Re=t.bk(C.getWest(),C.getEast())<0,ze=Re?C.getEast():C.getWest(),Je=Re?C.getWest():C.getEast(),ot=Math.max(C.getNorth(),C.getSouth()),Pt=Math.min(C.getNorth(),C.getSouth()),Et=ze+.5*t.bk(ze,Je),Lt=ot+.5*t.bk(ot,Pt),jt=j.clone();jt.setCenter(Z.center),jt.setBearing(Z.bearing),jt.setPitch(0),jt.setRoll(0),jt.setZoom(Z.zoom);const Nt=jt.modelViewProjectionMatrix,Bt=[Yr(C.getNorthWest()),Yr(C.getNorthEast()),Yr(C.getSouthWest()),Yr(C.getSouthEast()),Yr(new t.N(Je,Lt)),Yr(new t.N(ze,Lt)),Yr(new t.N(Et,ot)),Yr(new t.N(Et,Pt))],nn=Yr(Z.center);let rn=Number.POSITIVE_INFINITY;for(const an of Bt)re<0&&(rn=Al.getLesserNonNegativeNonNull(rn,Al.solveVectorScale(an,nn,Nt,"x",re))),ue>0&&(rn=Al.getLesserNonNegativeNonNull(rn,Al.solveVectorScale(an,nn,Nt,"x",ue))),ye>0&&(rn=Al.getLesserNonNegativeNonNull(rn,Al.solveVectorScale(an,nn,Nt,"y",ye))),Me<0&&(rn=Al.getLesserNonNegativeNonNull(rn,Al.solveVectorScale(an,nn,Nt,"y",Me)));if(Number.isFinite(rn)&&rn!==0)return Z.zoom=jt.zoom+t.a8(rn),Z;Qo()}handleJumpToCenterZoom(r,p){const C=r.center.lat,k=r.getConstrained(p.center?t.N.convert(p.center):r.center,r.zoom).center;r.setCenter(k.wrap());const j=p.zoom!==void 0?+p.zoom:r.zoom+fs(C,k.lat);r.zoom!==j&&r.setZoom(j)}handleEaseTo(r,p){const C=r.zoom,k=r.center,j=r.padding,Z={roll:r.roll,pitch:r.pitch,bearing:r.bearing},re={roll:p.roll===void 0?r.roll:p.roll,pitch:p.pitch===void 0?r.pitch:p.pitch,bearing:p.bearing===void 0?r.bearing:p.bearing},ue=p.zoom!==void 0,ye=!r.isPaddingEqual(p.padding);let Me=!1;const Re=p.center?t.N.convert(p.center):k,ze=r.getConstrained(Re,C).center;no(r,ze);const Je=r.clone();Je.setCenter(ze),Je.setZoom(ue?+p.zoom:C+fs(k.lat,Re.lat)),Je.setBearing(p.bearing);const ot=new t.P(t.ab(r.centerPoint.x+p.offsetAsPoint.x,0,r.width),t.ab(r.centerPoint.y+p.offsetAsPoint.y,0,r.height));Je.setLocationAtPoint(ze,ot);const Pt=(p.offset&&p.offsetAsPoint.mag())>0?Je.center:ze,Et=ue?+p.zoom:C+fs(k.lat,Pt.lat),Lt=C+fs(k.lat,0),jt=Et+fs(Pt.lat,0),Nt=t.bk(k.lng,Pt.lng),Bt=t.bk(k.lat,Pt.lat),nn=t.aG(jt-Lt);return Me=Et!==C,{easeFunc:rn=>{if(t.b3(Z,re)||fl({startEulerAngles:Z,endEulerAngles:re,tr:r,k:rn,useSlerp:Z.roll!=re.roll}),ye&&r.interpolatePadding(j,p.padding,rn),p.around)t.w("Easing around a point is not supported under globe projection."),r.setLocationAtPoint(p.around,p.aroundPoint);else{const an=jt>Lt?Math.min(2,nn):Math.max(.5,nn),Mn=Math.pow(an,1-rn),Rn=Il(k,Nt,Bt,rn*Mn);r.setCenter(Rn.wrap())}if(Me){const an=t.y.number(Lt,jt,rn)+fs(0,r.center.lat);r.setZoom(an)}},isZooming:Me,elevationCenter:Pt}}handleFlyTo(r,p){const C=p.zoom!==void 0,k=r.center,j=r.zoom,Z=!r.isPaddingEqual(p.padding),re=r.getConstrained(t.N.convert(p.center||p.locationAtOffset),j).center,ue=C?+p.zoom:r.zoom+fs(r.center.lat,re.lat),ye=r.clone();ye.setCenter(re),Z&&ye.setPadding(p.padding),ye.setZoom(ue),ye.setBearing(p.bearing);const Me=new t.P(t.ab(r.centerPoint.x+p.offsetAsPoint.x,0,r.width),t.ab(r.centerPoint.y+p.offsetAsPoint.y,0,r.height));ye.setLocationAtPoint(re,Me);const Re=ye.center;no(r,Re);const ze=function(Nt,Bt,nn){const rn=Yr(Bt),an=Yr(nn),Mn=t.aS(rn,an),Rn=Math.acos(Mn),Hn=Zd(Nt);return Rn/(2*Math.PI)*Hn}(r,k,Re),Je=j+fs(k.lat,0),ot=ue+fs(Re.lat,0),Pt=t.aG(ot-Je);let Et;if(typeof p.minZoom=="number"){const Nt=+p.minZoom+fs(Re.lat,0),Bt=Math.min(Nt,Je,ot)+fs(0,Re.lat),nn=r.getConstrained(Re,Bt).zoom+fs(Re.lat,0);Et=t.aG(nn-Je)}const Lt=t.bk(k.lng,Re.lng),jt=t.bk(k.lat,Re.lat);return{easeFunc:(Nt,Bt,nn,rn)=>{const an=Il(k,Lt,jt,nn),Mn=Nt===1?Re:an;r.setCenter(Mn.wrap());const Rn=Je+t.a8(Bt);r.setZoom(Nt===1?ue:Rn+fs(0,Mn.lat))},scaleOfZoom:Pt,targetCenter:Re,scaleOfMinZoom:Et,pixelPathLength:ze}}static solveVectorScale(r,p,C,k,j){const Z=k==="x"?[C[0],C[4],C[8],C[12]]:[C[1],C[5],C[9],C[13]],re=[C[3],C[7],C[11],C[15]],ue=r[0]*Z[0]+r[1]*Z[1]+r[2]*Z[2],ye=r[0]*re[0]+r[1]*re[1]+r[2]*re[2],Me=p[0]*Z[0]+p[1]*Z[1]+p[2]*Z[2],Re=p[0]*re[0]+p[1]*re[1]+p[2]*re[2];return Me+j*ye===ue+j*Re||re[3]*(ue-Me)+Z[3]*(Re-ye)+ue*Re==Me*ye?null:(Me+Z[3]-j*Re-j*re[3])/(Me-ue-j*Re+j*ye)}static getLesserNonNegativeNonNull(r,p){return p!==null&&p>=0&&p<r?p:r}}class kl{constructor(r){this._globe=r,this._mercatorCameraHelper=new su,this._verticalPerspectiveCameraHelper=new Al}get useGlobeControls(){return this._globe.useGlobeRendering}get currentHelper(){return this.useGlobeControls?this._verticalPerspectiveCameraHelper:this._mercatorCameraHelper}handlePanInertia(r,p){return this.currentHelper.handlePanInertia(r,p)}handleMapControlsRollPitchBearingZoom(r,p){return this.currentHelper.handleMapControlsRollPitchBearingZoom(r,p)}handleMapControlsPan(r,p,C){this.currentHelper.handleMapControlsPan(r,p,C)}cameraForBoxAndBearing(r,p,C,k,j){return this.currentHelper.cameraForBoxAndBearing(r,p,C,k,j)}handleJumpToCenterZoom(r,p){this.currentHelper.handleJumpToCenterZoom(r,p)}handleEaseTo(r,p){return this.currentHelper.handleEaseTo(r,p)}handleFlyTo(r,p){return this.currentHelper.handleFlyTo(r,p)}}const yh=(B,r)=>t.t(B,r&&r.filter(p=>p.identifier!=="source.canvas")),td=t.br();class ps extends t.E{constructor(r,p={}){super(),this._rtlPluginLoaded=()=>{for(const C in this.sourceCaches){const k=this.sourceCaches[C].getSource().type;k!=="vector"&&k!=="geojson"||this.sourceCaches[C].reload()}},this.map=r,this.dispatcher=new sn(Ln(),r._getMapId()),this.dispatcher.registerMessageHandler("GG",(C,k)=>this.getGlyphs(C,k)),this.dispatcher.registerMessageHandler("GI",(C,k)=>this.getImages(C,k)),this.imageManager=new nt,this.imageManager.setEventedParent(this),this.glyphManager=new hn(r._requestManager,p.localIdeographFontFamily),this.lineAtlas=new Bn(256,512),this.crossTileSymbolIndex=new zc,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new t.bs,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",t.bt()),Ar().on(pr,this._rtlPluginLoaded),this.on("data",C=>{if(C.dataType!=="source"||C.sourceDataType!=="metadata")return;const k=this.sourceCaches[C.sourceId];if(!k)return;const j=k.getSource();if(j&&j.vectorLayerIds)for(const Z in this._layers){const re=this._layers[Z];re.source===j.id&&this._validateLayer(re)}})}loadURL(r,p={},C){this.fire(new t.k("dataloading",{dataType:"style"})),p.validate=typeof p.validate!="boolean"||p.validate;const k=this.map._requestManager.transformRequest(r,"Style");this._loadStyleRequest=new AbortController;const j=this._loadStyleRequest;t.h(k,this._loadStyleRequest).then(Z=>{this._loadStyleRequest=null,this._load(Z.data,p,C)}).catch(Z=>{this._loadStyleRequest=null,Z&&!j.signal.aborted&&this.fire(new t.j(Z))})}loadJSON(r,p={},C){this.fire(new t.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,J.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,p.validate=p.validate!==!1,this._load(r,p,C)}).catch(()=>{})}loadEmpty(){this.fire(new t.k("dataloading",{dataType:"style"})),this._load(td,{validate:!1})}_load(r,p,C){var k,j;const Z=p.transformStyle?p.transformStyle(C,r):r;if(!p.validate||!yh(this,t.u(Z))){this._loaded=!0,this.stylesheet=Z;for(const re in Z.sources)this.addSource(re,Z.sources[re],{validate:!1});Z.sprite?this._loadSprite(Z.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(Z.glyphs),this._createLayers(),this.light=new ri(this.stylesheet.light),this._setProjectionInternal(((k=this.stylesheet.projection)===null||k===void 0?void 0:k.type)||"mercator"),this.sky=new _n(this.stylesheet.sky),this.map.setTerrain((j=this.stylesheet.terrain)!==null&&j!==void 0?j:null),this.fire(new t.k("data",{dataType:"style"})),this.fire(new t.k("style.load"))}}_createLayers(){const r=t.bu(this.stylesheet.layers);this.dispatcher.broadcast("SL",r),this._order=r.map(p=>p.id),this._layers={},this._serializedLayers=null;for(const p of r){const C=t.bv(p);C.setEventedParent(this,{layer:{id:p.id}}),this._layers[p.id]=C}}_loadSprite(r,p=!1,C=void 0){let k;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(j,Z,re,ue){return t._(this,void 0,void 0,function*(){const ye=Ve(j),Me=re>1?"@2x":"",Re={},ze={};for(const{id:Je,url:ot}of ye){const Pt=Z.transformRequest(Ue(ot,Me,".json"),"SpriteJSON");Re[Je]=t.h(Pt,ue);const Et=Z.transformRequest(Ue(ot,Me,".png"),"SpriteImage");ze[Je]=Le.getImage(Et,ue)}return yield Promise.all([...Object.values(Re),...Object.values(ze)]),function(Je,ot){return t._(this,void 0,void 0,function*(){const Pt={};for(const Et in Je){Pt[Et]={};const Lt=J.getImageCanvasContext((yield ot[Et]).data),jt=(yield Je[Et]).data;for(const Nt in jt){const{width:Bt,height:nn,x:rn,y:an,sdf:Mn,pixelRatio:Rn,stretchX:Hn,stretchY:ei,content:jn,textFitWidth:Ri,textFitHeight:zi}=jt[Nt];Pt[Et][Nt]={data:null,pixelRatio:Rn,sdf:Mn,stretchX:Hn,stretchY:ei,content:jn,textFitWidth:Ri,textFitHeight:zi,spriteData:{width:Bt,height:nn,x:rn,y:an,context:Lt}}}}return Pt})}(Re,ze)})}(r,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(j=>{if(this._spriteRequest=null,j)for(const Z in j){this._spritesImagesIds[Z]=[];const re=this._spritesImagesIds[Z]?this._spritesImagesIds[Z].filter(ue=>!(ue in j)):[];for(const ue of re)this.imageManager.removeImage(ue),this._changedImages[ue]=!0;for(const ue in j[Z]){const ye=Z==="default"?ue:`${Z}:${ue}`;this._spritesImagesIds[Z].push(ye),ye in this.imageManager.images?this.imageManager.updateImage(ye,j[Z][ue],!1):this.imageManager.addImage(ye,j[Z][ue]),p&&(this._changedImages[ye]=!0)}}}).catch(j=>{this._spriteRequest=null,k=j,this.fire(new t.j(k))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),p&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new t.k("data",{dataType:"style"})),C&&C(k)})}_unloadSprite(){for(const r of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(r),this._changedImages[r]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new t.k("data",{dataType:"style"}))}_validateLayer(r){const p=this.sourceCaches[r.source];if(!p)return;const C=r.sourceLayer;if(!C)return;const k=p.getSource();(k.type==="geojson"||k.vectorLayerIds&&k.vectorLayerIds.indexOf(C)===-1)&&this.fire(new t.j(new Error(`Source layer "${C}" does not exist on source "${k.id}" as specified by style layer "${r.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this.sourceCaches)if(!this.sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(r,p=!1){const C=this._serializedAllLayers();if(!r||r.length===0)return Object.values(p?t.bw(C):C);const k=[];for(const j of r)if(C[j]){const Z=p?t.bw(C[j]):C[j];k.push(Z)}return k}_serializedAllLayers(){let r=this._serializedLayers;if(r)return r;r=this._serializedLayers={};const p=Object.keys(this._layers);for(const C of p){const k=this._layers[C];k.type!=="custom"&&(r[C]=k.serialize())}return r}hasTransitions(){var r,p,C;if(!((r=this.light)===null||r===void 0)&&r.hasTransition()||!((p=this.sky)===null||p===void 0)&&p.hasTransition()||!((C=this.projection)===null||C===void 0)&&C.hasTransition())return!0;for(const k in this.sourceCaches)if(this.sourceCaches[k].hasTransition())return!0;for(const k in this._layers)if(this._layers[k].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(r){if(!this._loaded)return;const p=this._changed;if(p){const k=Object.keys(this._updatedLayers),j=Object.keys(this._removedLayers);(k.length||j.length)&&this._updateWorkerLayers(k,j);for(const Z in this._updatedSources){const re=this._updatedSources[Z];if(re==="reload")this._reloadSource(Z);else{if(re!=="clear")throw new Error(`Invalid action ${re}`);this._clearSource(Z)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const Z in this._updatedPaintProps)this._layers[Z].updateTransitions(r);this.light.updateTransitions(r),this.sky.updateTransitions(r),this._resetUpdates()}const C={};for(const k in this.sourceCaches){const j=this.sourceCaches[k];C[k]=j.used,j.used=!1}for(const k of this._order){const j=this._layers[k];j.recalculate(r,this._availableImages),!j.isHidden(r.zoom)&&j.source&&(this.sourceCaches[j.source].used=!0)}for(const k in C){const j=this.sourceCaches[k];!!C[k]!=!!j.used&&j.fire(new t.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:k}))}this.light.recalculate(r),this.sky.recalculate(r),this.projection.recalculate(r),this.z=r.zoom,p&&this.fire(new t.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const p in this.sourceCaches)this.sourceCaches[p].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const r in this.sourceCaches)this.sourceCaches[r].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(r,p){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(r,!1),removedIds:p})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(r,p={}){var C;this._checkLoaded();const k=this.serialize();if(r=p.transformStyle?p.transformStyle(k,r):r,((C=p.validate)===null||C===void 0||C)&&yh(this,t.u(r)))return!1;(r=t.bw(r)).layers=t.bu(r.layers);const j=t.bx(k,r),Z=this._getOperationsToPerform(j);if(Z.unimplemented.length>0)throw new Error(`Unimplemented: ${Z.unimplemented.join(", ")}.`);if(Z.operations.length===0)return!1;for(const re of Z.operations)re();return this.stylesheet=r,this._serializedLayers=null,!0}_getOperationsToPerform(r){const p=[],C=[];for(const k of r)switch(k.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":case"setRoll":continue;case"addLayer":p.push(()=>this.addLayer.apply(this,k.args));break;case"removeLayer":p.push(()=>this.removeLayer.apply(this,k.args));break;case"setPaintProperty":p.push(()=>this.setPaintProperty.apply(this,k.args));break;case"setLayoutProperty":p.push(()=>this.setLayoutProperty.apply(this,k.args));break;case"setFilter":p.push(()=>this.setFilter.apply(this,k.args));break;case"addSource":p.push(()=>this.addSource.apply(this,k.args));break;case"removeSource":p.push(()=>this.removeSource.apply(this,k.args));break;case"setLayerZoomRange":p.push(()=>this.setLayerZoomRange.apply(this,k.args));break;case"setLight":p.push(()=>this.setLight.apply(this,k.args));break;case"setGeoJSONSourceData":p.push(()=>this.setGeoJSONSourceData.apply(this,k.args));break;case"setGlyphs":p.push(()=>this.setGlyphs.apply(this,k.args));break;case"setSprite":p.push(()=>this.setSprite.apply(this,k.args));break;case"setTerrain":p.push(()=>this.map.setTerrain.apply(this,k.args));break;case"setSky":p.push(()=>this.setSky.apply(this,k.args));break;case"setProjection":this.setProjection.apply(this,k.args);break;case"setTransition":p.push(()=>{});break;default:C.push(k.command)}return{operations:p,unimplemented:C}}addImage(r,p){if(this.getImage(r))return this.fire(new t.j(new Error(`An image named "${r}" already exists.`)));this.imageManager.addImage(r,p),this._afterImageUpdated(r)}updateImage(r,p){this.imageManager.updateImage(r,p)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){if(!this.getImage(r))return this.fire(new t.j(new Error(`An image named "${r}" does not exist.`)));this.imageManager.removeImage(r),this._afterImageUpdated(r)}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new t.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(r,p,C={}){if(this._checkLoaded(),this.sourceCaches[r]!==void 0)throw new Error(`Source "${r}" already exists.`);if(!p.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(p).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(p.type)>=0&&this._validate(t.u.source,`sources.${r}`,p,null,C))return;this.map&&this.map._collectResourceTiming&&(p.collectResourceTiming=!0);const k=this.sourceCaches[r]=new Qe(r,p,this.dispatcher);k.style=this,k.setEventedParent(this,()=>({isSourceLoaded:k.loaded(),source:k.serialize(),sourceId:r})),k.onAdd(this.map),this._changed=!0}removeSource(r){if(this._checkLoaded(),this.sourceCaches[r]===void 0)throw new Error("There is no source with this ID");for(const C in this._layers)if(this._layers[C].source===r)return this.fire(new t.j(new Error(`Source "${r}" cannot be removed while layer "${C}" is using it.`)));const p=this.sourceCaches[r];delete this.sourceCaches[r],delete this._updatedSources[r],p.fire(new t.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:r})),p.setEventedParent(null),p.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(r,p){if(this._checkLoaded(),this.sourceCaches[r]===void 0)throw new Error(`There is no source with this ID=${r}`);const C=this.sourceCaches[r].getSource();if(C.type!=="geojson")throw new Error(`geojsonSource.type is ${C.type}, which is !== 'geojson`);C.setData(p),this._changed=!0}getSource(r){return this.sourceCaches[r]&&this.sourceCaches[r].getSource()}addLayer(r,p,C={}){this._checkLoaded();const k=r.id;if(this.getLayer(k))return void this.fire(new t.j(new Error(`Layer "${k}" already exists on this map.`)));let j;if(r.type==="custom"){if(yh(this,t.by(r)))return;j=t.bv(r)}else{if("source"in r&&typeof r.source=="object"&&(this.addSource(k,r.source),r=t.bw(r),r=t.e(r,{source:k})),this._validate(t.u.layer,`layers.${k}`,r,{arrayIndex:-1},C))return;j=t.bv(r),this._validateLayer(j),j.setEventedParent(this,{layer:{id:k}})}const Z=p?this._order.indexOf(p):this._order.length;if(p&&Z===-1)this.fire(new t.j(new Error(`Cannot add layer "${k}" before non-existing layer "${p}".`)));else{if(this._order.splice(Z,0,k),this._layerOrderChanged=!0,this._layers[k]=j,this._removedLayers[k]&&j.source&&j.type!=="custom"){const re=this._removedLayers[k];delete this._removedLayers[k],re.type!==j.type?this._updatedSources[j.source]="clear":(this._updatedSources[j.source]="reload",this.sourceCaches[j.source].pause())}this._updateLayer(j),j.onAdd&&j.onAdd(this.map)}}moveLayer(r,p){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new t.j(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===p)return;const C=this._order.indexOf(r);this._order.splice(C,1);const k=p?this._order.indexOf(p):this._order.length;p&&k===-1?this.fire(new t.j(new Error(`Cannot move layer "${r}" before non-existing layer "${p}".`))):(this._order.splice(k,0,r),this._layerOrderChanged=!0)}removeLayer(r){this._checkLoaded();const p=this._layers[r];if(!p)return void this.fire(new t.j(new Error(`Cannot remove non-existing layer "${r}".`)));p.setEventedParent(null);const C=this._order.indexOf(r);this._order.splice(C,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=p,delete this._layers[r],this._serializedLayers&&delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],p.onRemove&&p.onRemove(this.map)}getLayer(r){return this._layers[r]}getLayersOrder(){return[...this._order]}hasLayer(r){return r in this._layers}setLayerZoomRange(r,p,C){this._checkLoaded();const k=this.getLayer(r);k?k.minzoom===p&&k.maxzoom===C||(p!=null&&(k.minzoom=p),C!=null&&(k.maxzoom=C),this._updateLayer(k)):this.fire(new t.j(new Error(`Cannot set the zoom range of non-existing layer "${r}".`)))}setFilter(r,p,C={}){this._checkLoaded();const k=this.getLayer(r);if(k){if(!t.bz(k.filter,p))return p==null?(k.filter=void 0,void this._updateLayer(k)):void(this._validate(t.u.filter,`layers.${k.id}.filter`,p,null,C)||(k.filter=t.bw(p),this._updateLayer(k)))}else this.fire(new t.j(new Error(`Cannot filter non-existing layer "${r}".`)))}getFilter(r){return t.bw(this.getLayer(r).filter)}setLayoutProperty(r,p,C,k={}){this._checkLoaded();const j=this.getLayer(r);j?t.bz(j.getLayoutProperty(p),C)||(j.setLayoutProperty(p,C,k),this._updateLayer(j)):this.fire(new t.j(new Error(`Cannot style non-existing layer "${r}".`)))}getLayoutProperty(r,p){const C=this.getLayer(r);if(C)return C.getLayoutProperty(p);this.fire(new t.j(new Error(`Cannot get style of non-existing layer "${r}".`)))}setPaintProperty(r,p,C,k={}){this._checkLoaded();const j=this.getLayer(r);j?t.bz(j.getPaintProperty(p),C)||(j.setPaintProperty(p,C,k)&&this._updateLayer(j),this._changed=!0,this._updatedPaintProps[r]=!0,this._serializedLayers=null):this.fire(new t.j(new Error(`Cannot style non-existing layer "${r}".`)))}getPaintProperty(r,p){return this.getLayer(r).getPaintProperty(p)}setFeatureState(r,p){this._checkLoaded();const C=r.source,k=r.sourceLayer,j=this.sourceCaches[C];if(j===void 0)return void this.fire(new t.j(new Error(`The source '${C}' does not exist in the map's style.`)));const Z=j.getSource().type;Z==="geojson"&&k?this.fire(new t.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):Z!=="vector"||k?(r.id===void 0&&this.fire(new t.j(new Error("The feature id parameter must be provided."))),j.setFeatureState(k,r.id,p)):this.fire(new t.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(r,p){this._checkLoaded();const C=r.source,k=this.sourceCaches[C];if(k===void 0)return void this.fire(new t.j(new Error(`The source '${C}' does not exist in the map's style.`)));const j=k.getSource().type,Z=j==="vector"?r.sourceLayer:void 0;j!=="vector"||Z?p&&typeof r.id!="string"&&typeof r.id!="number"?this.fire(new t.j(new Error("A feature id is required to remove its specific state property."))):k.removeFeatureState(Z,r.id,p):this.fire(new t.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(r){this._checkLoaded();const p=r.source,C=r.sourceLayer,k=this.sourceCaches[p];if(k!==void 0)return k.getSource().type!=="vector"||C?(r.id===void 0&&this.fire(new t.j(new Error("The feature id parameter must be provided."))),k.getFeatureState(C,r.id)):void this.fire(new t.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new t.j(new Error(`The source '${p}' does not exist in the map's style.`)))}getTransition(){return t.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const r=t.bA(this.sourceCaches,j=>j.serialize()),p=this._serializeByIds(this._order,!0),C=this.map.getTerrain()||void 0,k=this.stylesheet;return t.bB({version:k.version,name:k.name,metadata:k.metadata,light:k.light,sky:k.sky,center:k.center,zoom:k.zoom,bearing:k.bearing,pitch:k.pitch,sprite:k.sprite,glyphs:k.glyphs,transition:k.transition,projection:k.projection,sources:r,layers:p,terrain:C},j=>j!==void 0)}_updateLayer(r){this._updatedLayers[r.id]=!0,r.source&&!this._updatedSources[r.source]&&this.sourceCaches[r.source].getSource().type!=="raster"&&(this._updatedSources[r.source]="reload",this.sourceCaches[r.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(r){const p=Z=>this._layers[Z].type==="fill-extrusion",C={},k=[];for(let Z=this._order.length-1;Z>=0;Z--){const re=this._order[Z];if(p(re)){C[re]=Z;for(const ue of r){const ye=ue[re];if(ye)for(const Me of ye)k.push(Me)}}}k.sort((Z,re)=>re.intersectionZ-Z.intersectionZ);const j=[];for(let Z=this._order.length-1;Z>=0;Z--){const re=this._order[Z];if(p(re))for(let ue=k.length-1;ue>=0;ue--){const ye=k[ue].feature;if(C[ye.layer.id]<Z)break;j.push(ye),k.pop()}else for(const ue of r){const ye=ue[re];if(ye)for(const Me of ye)j.push(Me.feature)}}return j}queryRenderedFeatures(r,p,C){p&&p.filter&&this._validate(t.u.filter,"queryRenderedFeatures.filter",p.filter,null,p);const k={};if(p&&p.layers){if(!(Array.isArray(p.layers)||p.layers instanceof Set))return this.fire(new t.j(new Error("parameters.layers must be an Array or a Set of strings"))),[];for(const ye of p.layers){const Me=this._layers[ye];if(!Me)return this.fire(new t.j(new Error(`The layer '${ye}' does not exist in the map's style and cannot be queried for features.`))),[];k[Me.source]=!0}}const j=[];p.availableImages=this._availableImages;const Z=this._serializedAllLayers(),re=p.layers instanceof Set?p.layers:Array.isArray(p.layers)?new Set(p.layers):null,ue=Object.assign(Object.assign({},p),{layers:re});for(const ye in this.sourceCaches)p.layers&&!k[ye]||j.push(ht(this.sourceCaches[ye],this._layers,Z,r,ue,C));return this.placement&&j.push(function(ye,Me,Re,ze,Je,ot,Pt){const Et={},Lt=ot.queryRenderedSymbols(ze),jt=[];for(const Nt of Object.keys(Lt).map(Number))jt.push(Pt[Nt]);jt.sort(Zn);for(const Nt of jt){const Bt=Nt.featureIndex.lookupSymbolFeatures(Lt[Nt.bucketInstanceId],Me,Nt.bucketIndex,Nt.sourceLayerIndex,Je.filter,Je.layers,Je.availableImages,ye);for(const nn in Bt){const rn=Et[nn]=Et[nn]||[],an=Bt[nn];an.sort((Mn,Rn)=>{const Hn=Nt.featureSortOrder;if(Hn){const ei=Hn.indexOf(Mn.featureIndex);return Hn.indexOf(Rn.featureIndex)-ei}return Rn.featureIndex-Mn.featureIndex});for(const Mn of an)rn.push(Mn)}}return function(Nt,Bt,nn){for(const rn in Nt)for(const an of Nt[rn])St(an,nn[Bt[rn].source]);return Nt}(Et,ye,Re)}(this._layers,Z,this.sourceCaches,r,ue,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(j)}querySourceFeatures(r,p){p&&p.filter&&this._validate(t.u.filter,"querySourceFeatures.filter",p.filter,null,p);const C=this.sourceCaches[r];return C?function(k,j){const Z=k.getRenderableIds().map(ye=>k.getTileByID(ye)),re=[],ue={};for(let ye=0;ye<Z.length;ye++){const Me=Z[ye],Re=Me.tileID.canonical.key;ue[Re]||(ue[Re]=!0,Me.querySourceFeatures(re,j))}return re}(C,p):[]}getLight(){return this.light.getLight()}setLight(r,p={}){this._checkLoaded();const C=this.light.getLight();let k=!1;for(const Z in r)if(!t.bz(r[Z],C[Z])){k=!0;break}if(!k)return;const j={now:J.now(),transition:t.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(r,p),this.light.updateTransitions(j)}getProjection(){var r;return(r=this.stylesheet)===null||r===void 0?void 0:r.projection}setProjection(r){if(this._checkLoaded(),this.projection){if(this.projection.name===r.type)return;this.projection.destroy(),delete this.projection}this.stylesheet.projection=r,this._setProjectionInternal(r.type)}getSky(){var r;return(r=this.stylesheet)===null||r===void 0?void 0:r.sky}setSky(r,p={}){this._checkLoaded();const C=this.getSky();let k=!1;if(!r&&!C)return;if(r&&!C)k=!0;else if(!r&&C)k=!0;else for(const Z in r)if(!t.bz(r[Z],C[Z])){k=!0;break}if(!k)return;const j={now:J.now(),transition:t.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=r,this.sky.setSky(r,p),this.sky.updateTransitions(j)}_setProjectionInternal(r){const p=function(C){if(Array.isArray(C)){const k=new Nu({type:C});return{projection:k,transform:new Pl,cameraHelper:new kl(k)}}switch(C){case"mercator":return{projection:new au,transform:new Dr,cameraHelper:new su};case"globe":{const k=new Nu({type:["interpolate",["linear"],["zoom"],11,"vertical-perspective",12,"mercator"]});return{projection:k,transform:new Pl,cameraHelper:new kl(k)}}case"vertical-perspective":return{projection:new Qh,transform:new uu,cameraHelper:new Al};default:return t.w(`Unknown projection name: ${C}. Falling back to mercator projection.`),{projection:new au,transform:new Dr,cameraHelper:new su}}}(r);this.projection=p.projection,this.map.migrateProjection(p.transform,p.cameraHelper);for(const C in this.sourceCaches)this.sourceCaches[C].reload()}_validate(r,p,C,k,j={}){return(!j||j.validate!==!1)&&yh(this,r.call(t.u,t.e({key:p,style:this.serialize(),value:C,styleSpec:t.v},k)))}_remove(r=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Ar().off(pr,this._rtlPluginLoaded);for(const p in this._layers)this._layers[p].setEventedParent(null);for(const p in this.sourceCaches){const C=this.sourceCaches[p];C.setEventedParent(null),C.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),r&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(r)}_clearSource(r){this.sourceCaches[r].clearTiles()}_reloadSource(r){this.sourceCaches[r].resume(),this.sourceCaches[r].reload()}_updateSources(r){for(const p in this.sourceCaches)this.sourceCaches[p].update(r,this.map.terrain)}_generateCollisionBoxes(){for(const r in this.sourceCaches)this._reloadSource(r)}_updatePlacement(r,p,C,k,j=!1){let Z=!1,re=!1;const ue={};for(const ye of this._order){const Me=this._layers[ye];if(Me.type!=="symbol")continue;if(!ue[Me.source]){const ze=this.sourceCaches[Me.source];ue[Me.source]=ze.getRenderableIds(!0).map(Je=>ze.getTileByID(Je)).sort((Je,ot)=>ot.tileID.overscaledZ-Je.tileID.overscaledZ||(Je.tileID.isLessThan(ot.tileID)?-1:1))}const Re=this.crossTileSymbolIndex.addLayer(Me,ue[Me.source],r.center.lng);Z=Z||Re}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((j=j||this._layerOrderChanged||C===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(J.now(),r.zoom))&&(this.pauseablePlacement=new Bu(r,this.map.terrain,this._order,j,p,C,k,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,ue),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(J.now()),re=!0),Z&&this.pauseablePlacement.placement.setStale()),re||Z)for(const ye of this._order){const Me=this._layers[ye];Me.type==="symbol"&&this.placement.updateLayerOpacities(Me,ue[Me.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(J.now())}_releaseSymbolFadeTiles(){for(const r in this.sourceCaches)this.sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,p){return t._(this,void 0,void 0,function*(){const C=yield this.imageManager.getImages(p.icons);this._updateTilesForChangedImages();const k=this.sourceCaches[p.source];return k&&k.setDependencies(p.tileID.key,p.type,p.icons),C})}getGlyphs(r,p){return t._(this,void 0,void 0,function*(){const C=yield this.glyphManager.getGlyphs(p.stacks),k=this.sourceCaches[p.source];return k&&k.setDependencies(p.tileID.key,p.type,[""]),C})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(r,p={}){this._checkLoaded(),r&&this._validate(t.u.glyphs,"glyphs",r,null,p)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=r,this.glyphManager.entries={},this.glyphManager.setURL(r))}addSprite(r,p,C={},k){this._checkLoaded();const j=[{id:r,url:p}],Z=[...Ve(this.stylesheet.sprite),...j];this._validate(t.u.sprite,"sprite",Z,null,C)||(this.stylesheet.sprite=Z,this._loadSprite(j,!0,k))}removeSprite(r){this._checkLoaded();const p=Ve(this.stylesheet.sprite);if(p.find(C=>C.id===r)){if(this._spritesImagesIds[r])for(const C of this._spritesImagesIds[r])this.imageManager.removeImage(C),this._changedImages[C]=!0;p.splice(p.findIndex(C=>C.id===r),1),this.stylesheet.sprite=p.length>0?p:void 0,delete this._spritesImagesIds[r],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new t.k("data",{dataType:"style"}))}else this.fire(new t.j(new Error(`Sprite "${r}" doesn't exists on this map.`)))}getSprite(){return Ve(this.stylesheet.sprite)}setSprite(r,p={},C){this._checkLoaded(),r&&this._validate(t.u.sprite,"sprite",r,null,p)||(this.stylesheet.sprite=r,r?this._loadSprite(r,!0,C):(this._unloadSprite(),C&&C(null)))}}var Hf=t.aA([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class nd{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(r,p,C,k,j,Z,re,ue,ye){this.context=r;let Me=this.boundPaintVertexBuffers.length!==k.length;for(let Re=0;!Me&&Re<k.length;Re++)this.boundPaintVertexBuffers[Re]!==k[Re]&&(Me=!0);!this.vao||this.boundProgram!==p||this.boundLayoutVertexBuffer!==C||Me||this.boundIndexBuffer!==j||this.boundVertexOffset!==Z||this.boundDynamicVertexBuffer!==re||this.boundDynamicVertexBuffer2!==ue||this.boundDynamicVertexBuffer3!==ye?this.freshBind(p,C,k,j,Z,re,ue,ye):(r.bindVertexArray.set(this.vao),re&&re.bind(),j&&j.dynamicDraw&&j.bind(),ue&&ue.bind(),ye&&ye.bind())}freshBind(r,p,C,k,j,Z,re,ue){const ye=r.numAttributes,Me=this.context,Re=Me.gl;this.vao&&this.destroy(),this.vao=Me.createVertexArray(),Me.bindVertexArray.set(this.vao),this.boundProgram=r,this.boundLayoutVertexBuffer=p,this.boundPaintVertexBuffers=C,this.boundIndexBuffer=k,this.boundVertexOffset=j,this.boundDynamicVertexBuffer=Z,this.boundDynamicVertexBuffer2=re,this.boundDynamicVertexBuffer3=ue,p.enableAttributes(Re,r);for(const ze of C)ze.enableAttributes(Re,r);Z&&Z.enableAttributes(Re,r),re&&re.enableAttributes(Re,r),ue&&ue.enableAttributes(Re,r),p.bind(),p.setVertexAttribPointers(Re,r,j);for(const ze of C)ze.bind(),ze.setVertexAttribPointers(Re,r,j);Z&&(Z.bind(),Z.setVertexAttribPointers(Re,r,j)),k&&k.bind(),re&&(re.bind(),re.setVertexAttribPointers(Re,r,j)),ue&&(ue.bind(),ue.setVertexAttribPointers(Re,r,j)),Me.currentNumAttributes=ye}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const id=(B,r,p,C,k)=>({u_texture:0,u_ele_delta:B,u_fog_matrix:r,u_fog_color:p?p.properties.get("fog-color"):t.b4.white,u_fog_ground_blend:p?p.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:k?0:p?p.calculateFogBlendOpacity(C):0,u_horizon_color:p?p.properties.get("horizon-color"):t.b4.white,u_horizon_fog_blend:p?p.properties.get("horizon-fog-blend"):1,u_is_globe_mode:k?1:0}),hu={mainMatrix:"u_projection_matrix",tileMercatorCoords:"u_projection_tile_mercator_coords",clippingPlane:"u_projection_clipping_plane",projectionTransition:"u_projection_transition",fallbackMatrix:"u_projection_fallback_matrix"};function Zf(B){const r=[];for(let p=0;p<B.length;p++){if(B[p]===null)continue;const C=B[p].split(" ");r.push(C.pop())}return r}class Wf{constructor(r,p,C,k,j,Z,re,ue){const ye=r.gl;this.program=ye.createProgram();const Me=Zf(p.staticAttributes),Re=C?C.getBinderAttributes():[],ze=Me.concat(Re),Je=ks.prelude.staticUniforms?Zf(ks.prelude.staticUniforms):[],ot=re.staticUniforms?Zf(re.staticUniforms):[],Pt=p.staticUniforms?Zf(p.staticUniforms):[],Et=C?C.getBinderUniforms():[],Lt=Je.concat(ot).concat(Pt).concat(Et),jt=[];for(const Rn of Lt)jt.indexOf(Rn)<0&&jt.push(Rn);const Nt=C?C.defines():[];io(ye)&&Nt.unshift("#version 300 es"),j&&Nt.push("#define OVERDRAW_INSPECTOR;"),Z&&Nt.push("#define TERRAIN3D;"),ue&&Nt.push(ue);let Bt=Nt.concat(ks.prelude.fragmentSource,re.fragmentSource,p.fragmentSource).join(`
`),nn=Nt.concat(ks.prelude.vertexSource,re.vertexSource,p.vertexSource).join(`
`);io(ye)||(Bt=function(Rn){return Rn.replace(/\bin\s/g,"varying ").replace("out highp vec4 fragColor;","").replace(/fragColor/g,"gl_FragColor").replace(/texture\(/g,"texture2D(")}(Bt),nn=function(Rn){return Rn.replace(/\bin\s/g,"attribute ").replace(/\bout\s/g,"varying ").replace(/texture\(/g,"texture2D(")}(nn));const rn=ye.createShader(ye.FRAGMENT_SHADER);if(ye.isContextLost())return void(this.failedToCreate=!0);if(ye.shaderSource(rn,Bt),ye.compileShader(rn),!ye.getShaderParameter(rn,ye.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${ye.getShaderInfoLog(rn)}`);ye.attachShader(this.program,rn);const an=ye.createShader(ye.VERTEX_SHADER);if(ye.isContextLost())return void(this.failedToCreate=!0);if(ye.shaderSource(an,nn),ye.compileShader(an),!ye.getShaderParameter(an,ye.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${ye.getShaderInfoLog(an)}`);ye.attachShader(this.program,an),this.attributes={};const Mn={};this.numAttributes=ze.length;for(let Rn=0;Rn<this.numAttributes;Rn++)ze[Rn]&&(ye.bindAttribLocation(this.program,Rn,ze[Rn]),this.attributes[ze[Rn]]=Rn);if(ye.linkProgram(this.program),!ye.getProgramParameter(this.program,ye.LINK_STATUS))throw new Error(`Program failed to link: ${ye.getProgramInfoLog(this.program)}`);ye.deleteShader(an),ye.deleteShader(rn);for(let Rn=0;Rn<jt.length;Rn++){const Hn=jt[Rn];if(Hn&&!Mn[Hn]){const ei=ye.getUniformLocation(this.program,Hn);ei&&(Mn[Hn]=ei)}}this.fixedUniforms=k(r,Mn),this.terrainUniforms=((Rn,Hn)=>({u_depth:new t.bC(Rn,Hn.u_depth),u_terrain:new t.bC(Rn,Hn.u_terrain),u_terrain_dim:new t.b5(Rn,Hn.u_terrain_dim),u_terrain_matrix:new t.bD(Rn,Hn.u_terrain_matrix),u_terrain_unpack:new t.bE(Rn,Hn.u_terrain_unpack),u_terrain_exaggeration:new t.b5(Rn,Hn.u_terrain_exaggeration)}))(r,Mn),this.projectionUniforms=((Rn,Hn)=>({u_projection_matrix:new t.bD(Rn,Hn.u_projection_matrix),u_projection_tile_mercator_coords:new t.bE(Rn,Hn.u_projection_tile_mercator_coords),u_projection_clipping_plane:new t.bE(Rn,Hn.u_projection_clipping_plane),u_projection_transition:new t.b5(Rn,Hn.u_projection_transition),u_projection_fallback_matrix:new t.bD(Rn,Hn.u_projection_fallback_matrix)}))(r,Mn),this.binderUniforms=C?C.getUniforms(r,Mn):[]}draw(r,p,C,k,j,Z,re,ue,ye,Me,Re,ze,Je,ot,Pt,Et,Lt,jt,Nt){const Bt=r.gl;if(this.failedToCreate)return;if(r.program.set(this.program),r.setDepthMode(C),r.setStencilMode(k),r.setColorMode(j),r.setCullFace(Z),ue){r.activeTexture.set(Bt.TEXTURE2),Bt.bindTexture(Bt.TEXTURE_2D,ue.depthTexture),r.activeTexture.set(Bt.TEXTURE3),Bt.bindTexture(Bt.TEXTURE_2D,ue.texture);for(const rn in this.terrainUniforms)this.terrainUniforms[rn].set(ue[rn])}if(ye)for(const rn in ye)this.projectionUniforms[hu[rn]].set(ye[rn]);if(re)for(const rn in this.fixedUniforms)this.fixedUniforms[rn].set(re[rn]);Et&&Et.setUniforms(r,this.binderUniforms,ot,{zoom:Pt});let nn=0;switch(p){case Bt.LINES:nn=2;break;case Bt.TRIANGLES:nn=3;break;case Bt.LINE_STRIP:nn=1}for(const rn of Je.get()){const an=rn.vaos||(rn.vaos={});(an[Me]||(an[Me]=new nd)).bind(r,this,Re,Et?Et.getPaintVertexBuffers():[],ze,rn.vertexOffset,Lt,jt,Nt),Bt.drawElements(p,rn.primitiveLength*nn,Bt.UNSIGNED_SHORT,rn.primitiveOffset*nn*2)}}}function rd(B,r,p){const C=1/t.at(p,1,r.transform.tileZoom),k=Math.pow(2,p.tileID.overscaledZ),j=p.tileSize*Math.pow(2,r.transform.tileZoom)/k,Z=j*(p.tileID.canonical.x+p.tileID.wrap*k),re=j*p.tileID.canonical.y;return{u_image:0,u_texsize:p.imageAtlasTexture.size,u_scale:[C,B.fromScale,B.toScale],u_fade:B.t,u_pixel_coord_upper:[Z>>16,re>>16],u_pixel_coord_lower:[65535&Z,65535&re]}}const gc=(B,r,p,C)=>{const k=B.style.light,j=k.properties.get("position"),Z=[j.x,j.y,j.z],re=t.bI();k.properties.get("anchor")==="viewport"&&t.bJ(re,B.transform.bearingInRadians),t.bK(Z,Z,re);const ue=B.transform.transformLightDirection(Z),ye=k.properties.get("color");return{u_lightpos:Z,u_lightpos_globe:ue,u_lightintensity:k.properties.get("intensity"),u_lightcolor:[ye.r,ye.g,ye.b],u_vertical_gradient:+r,u_opacity:p,u_fill_translate:C}},Bm=(B,r,p,C,k,j,Z)=>t.e(gc(B,r,p,C),rd(j,B,Z),{u_height_factor:-Math.pow(2,k.overscaledZ)/Z.tileSize/8}),Dl=(B,r,p,C)=>t.e(rd(r,B,p),{u_fill_translate:C}),Vm=(B,r)=>({u_world:B,u_fill_translate:r}),Wd=(B,r,p,C,k)=>t.e(Dl(B,r,p,k),{u_world:C}),Yl=(B,r,p,C,k)=>{const j=B.transform;let Z,re,ue=0;if(p.paint.get("circle-pitch-alignment")==="map"){const ye=t.at(r,1,j.zoom);Z=!0,re=[ye,ye],ue=ye/(t.X*Math.pow(2,r.tileID.overscaledZ))*2*Math.PI*k}else Z=!1,re=j.pixelsToGLUnits;return{u_camera_to_center_distance:j.cameraToCenterDistance,u_scale_with_map:+(p.paint.get("circle-pitch-scale")==="map"),u_pitch_with_map:+Z,u_device_pixel_ratio:B.pixelRatio,u_extrude_scale:re,u_globe_extrude_scale:ue,u_translate:C}},Nm=B=>({u_pixel_extrude_scale:[1/B.width,1/B.height]}),jm=B=>({u_viewport_size:[B.width,B.height]}),Yp=(B,r=1)=>({u_color:B,u_overlay:0,u_overlay_scale:r}),Xf=(B,r,p,C)=>{const k=t.at(B,1,r)/(t.X*Math.pow(2,B.tileID.overscaledZ))*2*Math.PI*C;return{u_extrude_scale:t.at(B,1,r),u_intensity:p,u_globe_extrude_scale:k}},Rl=(B,r,p,C)=>{const k=t.H();t.bL(k,0,B.width,B.height,0,0,1);const j=B.context.gl;return{u_matrix:k,u_world:[j.drawingBufferWidth,j.drawingBufferHeight],u_image:p,u_color_ramp:C,u_opacity:r.paint.get("heatmap-opacity")}},Tr=(B,r,p)=>{const C=p.paint.get("hillshade-shadow-color"),k=p.paint.get("hillshade-highlight-color"),j=p.paint.get("hillshade-accent-color");let Z=p.paint.get("hillshade-illumination-direction")*(Math.PI/180);return p.paint.get("hillshade-illumination-anchor")==="viewport"&&(Z+=B.transform.bearingInRadians),{u_image:0,u_latrange:Uu(0,r.tileID),u_light:[p.paint.get("hillshade-exaggeration"),Z],u_shadow:C,u_highlight:k,u_accent:j}},Zi=(B,r)=>{const p=r.stride,C=t.H();return t.bL(C,0,t.X,-8192,0,0,1),t.J(C,C,[0,-8192,0]),{u_matrix:C,u_image:1,u_dimension:[p,p],u_zoom:B.overscaledZ,u_unpack:r.getUnpackVector()}};function Uu(B,r){const p=Math.pow(2,r.canonical.z),C=r.canonical.y;return[new t.Y(0,C/p).toLngLat().lat,new t.Y(0,(C+1)/p).toLngLat().lat]}const lr=(B,r,p,C)=>{const k=B.transform;return{u_translation:ad(B,r,p),u_ratio:C/t.at(r,1,k.zoom),u_device_pixel_ratio:B.pixelRatio,u_units_to_pixels:[1/k.pixelsToGLUnits[0],1/k.pixelsToGLUnits[1]]}},vh=(B,r,p,C,k)=>t.e(lr(B,r,p,C),{u_image:0,u_image_height:k}),du=(B,r,p,C,k)=>{const j=B.transform,Z=Xd(r,j);return{u_translation:ad(B,r,p),u_texsize:r.imageAtlasTexture.size,u_ratio:C/t.at(r,1,j.zoom),u_device_pixel_ratio:B.pixelRatio,u_image:0,u_scale:[Z,k.fromScale,k.toScale],u_fade:k.t,u_units_to_pixels:[1/j.pixelsToGLUnits[0],1/j.pixelsToGLUnits[1]]}},or=(B,r,p,C,k,j)=>{const Z=B.lineAtlas,re=Xd(r,B.transform),ue=p.layout.get("line-cap")==="round",ye=Z.getDash(k.from,ue),Me=Z.getDash(k.to,ue),Re=ye.width*j.fromScale,ze=Me.width*j.toScale;return t.e(lr(B,r,p,C),{u_patternscale_a:[re/Re,-ye.height/2],u_patternscale_b:[re/ze,-Me.height/2],u_sdfgamma:Z.width/(256*Math.min(Re,ze)*B.pixelRatio)/2,u_image:0,u_tex_y_a:ye.y,u_tex_y_b:Me.y,u_mix:j.t})};function Xd(B,r){return 1/t.at(B,1,r.tileZoom)}function ad(B,r,p){return t.au(B.transform,r,p.paint.get("line-translate"),p.paint.get("line-translate-anchor"))}const xh=(B,r,p,C,k)=>{return{u_tl_parent:B,u_scale_parent:r,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*C.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:C.paint.get("raster-brightness-min"),u_brightness_high:C.paint.get("raster-brightness-max"),u_saturation_factor:(Z=C.paint.get("raster-saturation"),Z>0?1-1/(1.001-Z):-Z),u_contrast_factor:(j=C.paint.get("raster-contrast"),j>0?1/(1-j):1+j),u_spin_weights:$u(C.paint.get("raster-hue-rotate")),u_coords_top:[k[0].x,k[0].y,k[1].x,k[1].y],u_coords_bottom:[k[3].x,k[3].y,k[2].x,k[2].y]};var j,Z};function $u(B){B*=Math.PI/180;const r=Math.sin(B),p=Math.cos(B);return[(2*p+1)/3,(-Math.sqrt(3)*r-p+1)/3,(Math.sqrt(3)*r-p+1)/3]}const bh=(B,r,p,C,k,j,Z,re,ue,ye,Me,Re,ze)=>{const Je=Z.transform;return{u_is_size_zoom_constant:+(B==="constant"||B==="source"),u_is_size_feature_constant:+(B==="constant"||B==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:Je.cameraToCenterDistance,u_pitch:Je.pitch/360*2*Math.PI,u_rotate_symbol:+p,u_aspect_ratio:Je.width/Je.height,u_fade_change:Z.options.fadeDuration?Z.symbolFadeChange:1,u_label_plane_matrix:re,u_coord_matrix:ue,u_is_text:+Me,u_pitch_with_map:+C,u_is_along_line:k,u_is_variable_anchor:j,u_texsize:Re,u_texture:0,u_translation:ye,u_pitched_scale:ze}},Ds=(B,r,p,C,k,j,Z,re,ue,ye,Me,Re,ze,Je)=>{const ot=Z.transform;return t.e(bh(B,r,p,C,k,j,Z,re,ue,ye,Me,Re,Je),{u_gamma_scale:C?Math.cos(ot.pitch*Math.PI/180)*ot.cameraToCenterDistance:1,u_device_pixel_ratio:Z.pixelRatio,u_is_halo:1})},Rs=(B,r,p,C,k,j,Z,re,ue,ye,Me,Re,ze)=>t.e(Ds(B,r,p,C,k,j,Z,re,ue,ye,!0,Me,0,ze),{u_texsize_icon:Re,u_texture_icon:1}),sd=(B,r)=>({u_opacity:B,u_color:r}),mi=(B,r,p,C,k)=>t.e(function(j,Z,re,ue){const ye=re.imageManager.getPattern(j.from.toString()),Me=re.imageManager.getPattern(j.to.toString()),{width:Re,height:ze}=re.imageManager.getPixelSize(),Je=Math.pow(2,ue.tileID.overscaledZ),ot=ue.tileSize*Math.pow(2,re.transform.tileZoom)/Je,Pt=ot*(ue.tileID.canonical.x+ue.tileID.wrap*Je),Et=ot*ue.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:ye.tl,u_pattern_br_a:ye.br,u_pattern_tl_b:Me.tl,u_pattern_br_b:Me.br,u_texsize:[Re,ze],u_mix:Z.t,u_pattern_size_a:ye.displaySize,u_pattern_size_b:Me.displaySize,u_scale_a:Z.fromScale,u_scale_b:Z.toScale,u_tile_units_to_pixels:1/t.at(ue,1,re.transform.tileZoom),u_pixel_coord_upper:[Pt>>16,Et>>16],u_pixel_coord_lower:[65535&Pt,65535&Et]}}(p,k,r,C),{u_opacity:B}),wh=(B,r)=>{},Oc={fillExtrusion:(B,r)=>({u_lightpos:new t.bG(B,r.u_lightpos),u_lightpos_globe:new t.bG(B,r.u_lightpos_globe),u_lightintensity:new t.b5(B,r.u_lightintensity),u_lightcolor:new t.bG(B,r.u_lightcolor),u_vertical_gradient:new t.b5(B,r.u_vertical_gradient),u_opacity:new t.b5(B,r.u_opacity),u_fill_translate:new t.bH(B,r.u_fill_translate)}),fillExtrusionPattern:(B,r)=>({u_lightpos:new t.bG(B,r.u_lightpos),u_lightpos_globe:new t.bG(B,r.u_lightpos_globe),u_lightintensity:new t.b5(B,r.u_lightintensity),u_lightcolor:new t.bG(B,r.u_lightcolor),u_vertical_gradient:new t.b5(B,r.u_vertical_gradient),u_height_factor:new t.b5(B,r.u_height_factor),u_opacity:new t.b5(B,r.u_opacity),u_fill_translate:new t.bH(B,r.u_fill_translate),u_image:new t.bC(B,r.u_image),u_texsize:new t.bH(B,r.u_texsize),u_pixel_coord_upper:new t.bH(B,r.u_pixel_coord_upper),u_pixel_coord_lower:new t.bH(B,r.u_pixel_coord_lower),u_scale:new t.bG(B,r.u_scale),u_fade:new t.b5(B,r.u_fade)}),fill:(B,r)=>({u_fill_translate:new t.bH(B,r.u_fill_translate)}),fillPattern:(B,r)=>({u_image:new t.bC(B,r.u_image),u_texsize:new t.bH(B,r.u_texsize),u_pixel_coord_upper:new t.bH(B,r.u_pixel_coord_upper),u_pixel_coord_lower:new t.bH(B,r.u_pixel_coord_lower),u_scale:new t.bG(B,r.u_scale),u_fade:new t.b5(B,r.u_fade),u_fill_translate:new t.bH(B,r.u_fill_translate)}),fillOutline:(B,r)=>({u_world:new t.bH(B,r.u_world),u_fill_translate:new t.bH(B,r.u_fill_translate)}),fillOutlinePattern:(B,r)=>({u_world:new t.bH(B,r.u_world),u_image:new t.bC(B,r.u_image),u_texsize:new t.bH(B,r.u_texsize),u_pixel_coord_upper:new t.bH(B,r.u_pixel_coord_upper),u_pixel_coord_lower:new t.bH(B,r.u_pixel_coord_lower),u_scale:new t.bG(B,r.u_scale),u_fade:new t.b5(B,r.u_fade),u_fill_translate:new t.bH(B,r.u_fill_translate)}),circle:(B,r)=>({u_camera_to_center_distance:new t.b5(B,r.u_camera_to_center_distance),u_scale_with_map:new t.bC(B,r.u_scale_with_map),u_pitch_with_map:new t.bC(B,r.u_pitch_with_map),u_extrude_scale:new t.bH(B,r.u_extrude_scale),u_device_pixel_ratio:new t.b5(B,r.u_device_pixel_ratio),u_globe_extrude_scale:new t.b5(B,r.u_globe_extrude_scale),u_translate:new t.bH(B,r.u_translate)}),collisionBox:(B,r)=>({u_pixel_extrude_scale:new t.bH(B,r.u_pixel_extrude_scale)}),collisionCircle:(B,r)=>({u_viewport_size:new t.bH(B,r.u_viewport_size)}),debug:(B,r)=>({u_color:new t.bF(B,r.u_color),u_overlay:new t.bC(B,r.u_overlay),u_overlay_scale:new t.b5(B,r.u_overlay_scale)}),depth:wh,clippingMask:wh,heatmap:(B,r)=>({u_extrude_scale:new t.b5(B,r.u_extrude_scale),u_intensity:new t.b5(B,r.u_intensity),u_globe_extrude_scale:new t.b5(B,r.u_globe_extrude_scale)}),heatmapTexture:(B,r)=>({u_matrix:new t.bD(B,r.u_matrix),u_world:new t.bH(B,r.u_world),u_image:new t.bC(B,r.u_image),u_color_ramp:new t.bC(B,r.u_color_ramp),u_opacity:new t.b5(B,r.u_opacity)}),hillshade:(B,r)=>({u_image:new t.bC(B,r.u_image),u_latrange:new t.bH(B,r.u_latrange),u_light:new t.bH(B,r.u_light),u_shadow:new t.bF(B,r.u_shadow),u_highlight:new t.bF(B,r.u_highlight),u_accent:new t.bF(B,r.u_accent)}),hillshadePrepare:(B,r)=>({u_matrix:new t.bD(B,r.u_matrix),u_image:new t.bC(B,r.u_image),u_dimension:new t.bH(B,r.u_dimension),u_zoom:new t.b5(B,r.u_zoom),u_unpack:new t.bE(B,r.u_unpack)}),line:(B,r)=>({u_translation:new t.bH(B,r.u_translation),u_ratio:new t.b5(B,r.u_ratio),u_device_pixel_ratio:new t.b5(B,r.u_device_pixel_ratio),u_units_to_pixels:new t.bH(B,r.u_units_to_pixels)}),lineGradient:(B,r)=>({u_translation:new t.bH(B,r.u_translation),u_ratio:new t.b5(B,r.u_ratio),u_device_pixel_ratio:new t.b5(B,r.u_device_pixel_ratio),u_units_to_pixels:new t.bH(B,r.u_units_to_pixels),u_image:new t.bC(B,r.u_image),u_image_height:new t.b5(B,r.u_image_height)}),linePattern:(B,r)=>({u_translation:new t.bH(B,r.u_translation),u_texsize:new t.bH(B,r.u_texsize),u_ratio:new t.b5(B,r.u_ratio),u_device_pixel_ratio:new t.b5(B,r.u_device_pixel_ratio),u_image:new t.bC(B,r.u_image),u_units_to_pixels:new t.bH(B,r.u_units_to_pixels),u_scale:new t.bG(B,r.u_scale),u_fade:new t.b5(B,r.u_fade)}),lineSDF:(B,r)=>({u_translation:new t.bH(B,r.u_translation),u_ratio:new t.b5(B,r.u_ratio),u_device_pixel_ratio:new t.b5(B,r.u_device_pixel_ratio),u_units_to_pixels:new t.bH(B,r.u_units_to_pixels),u_patternscale_a:new t.bH(B,r.u_patternscale_a),u_patternscale_b:new t.bH(B,r.u_patternscale_b),u_sdfgamma:new t.b5(B,r.u_sdfgamma),u_image:new t.bC(B,r.u_image),u_tex_y_a:new t.b5(B,r.u_tex_y_a),u_tex_y_b:new t.b5(B,r.u_tex_y_b),u_mix:new t.b5(B,r.u_mix)}),raster:(B,r)=>({u_tl_parent:new t.bH(B,r.u_tl_parent),u_scale_parent:new t.b5(B,r.u_scale_parent),u_buffer_scale:new t.b5(B,r.u_buffer_scale),u_fade_t:new t.b5(B,r.u_fade_t),u_opacity:new t.b5(B,r.u_opacity),u_image0:new t.bC(B,r.u_image0),u_image1:new t.bC(B,r.u_image1),u_brightness_low:new t.b5(B,r.u_brightness_low),u_brightness_high:new t.b5(B,r.u_brightness_high),u_saturation_factor:new t.b5(B,r.u_saturation_factor),u_contrast_factor:new t.b5(B,r.u_contrast_factor),u_spin_weights:new t.bG(B,r.u_spin_weights),u_coords_top:new t.bE(B,r.u_coords_top),u_coords_bottom:new t.bE(B,r.u_coords_bottom)}),symbolIcon:(B,r)=>({u_is_size_zoom_constant:new t.bC(B,r.u_is_size_zoom_constant),u_is_size_feature_constant:new t.bC(B,r.u_is_size_feature_constant),u_size_t:new t.b5(B,r.u_size_t),u_size:new t.b5(B,r.u_size),u_camera_to_center_distance:new t.b5(B,r.u_camera_to_center_distance),u_pitch:new t.b5(B,r.u_pitch),u_rotate_symbol:new t.bC(B,r.u_rotate_symbol),u_aspect_ratio:new t.b5(B,r.u_aspect_ratio),u_fade_change:new t.b5(B,r.u_fade_change),u_label_plane_matrix:new t.bD(B,r.u_label_plane_matrix),u_coord_matrix:new t.bD(B,r.u_coord_matrix),u_is_text:new t.bC(B,r.u_is_text),u_pitch_with_map:new t.bC(B,r.u_pitch_with_map),u_is_along_line:new t.bC(B,r.u_is_along_line),u_is_variable_anchor:new t.bC(B,r.u_is_variable_anchor),u_texsize:new t.bH(B,r.u_texsize),u_texture:new t.bC(B,r.u_texture),u_translation:new t.bH(B,r.u_translation),u_pitched_scale:new t.b5(B,r.u_pitched_scale)}),symbolSDF:(B,r)=>({u_is_size_zoom_constant:new t.bC(B,r.u_is_size_zoom_constant),u_is_size_feature_constant:new t.bC(B,r.u_is_size_feature_constant),u_size_t:new t.b5(B,r.u_size_t),u_size:new t.b5(B,r.u_size),u_camera_to_center_distance:new t.b5(B,r.u_camera_to_center_distance),u_pitch:new t.b5(B,r.u_pitch),u_rotate_symbol:new t.bC(B,r.u_rotate_symbol),u_aspect_ratio:new t.b5(B,r.u_aspect_ratio),u_fade_change:new t.b5(B,r.u_fade_change),u_label_plane_matrix:new t.bD(B,r.u_label_plane_matrix),u_coord_matrix:new t.bD(B,r.u_coord_matrix),u_is_text:new t.bC(B,r.u_is_text),u_pitch_with_map:new t.bC(B,r.u_pitch_with_map),u_is_along_line:new t.bC(B,r.u_is_along_line),u_is_variable_anchor:new t.bC(B,r.u_is_variable_anchor),u_texsize:new t.bH(B,r.u_texsize),u_texture:new t.bC(B,r.u_texture),u_gamma_scale:new t.b5(B,r.u_gamma_scale),u_device_pixel_ratio:new t.b5(B,r.u_device_pixel_ratio),u_is_halo:new t.bC(B,r.u_is_halo),u_translation:new t.bH(B,r.u_translation),u_pitched_scale:new t.b5(B,r.u_pitched_scale)}),symbolTextAndIcon:(B,r)=>({u_is_size_zoom_constant:new t.bC(B,r.u_is_size_zoom_constant),u_is_size_feature_constant:new t.bC(B,r.u_is_size_feature_constant),u_size_t:new t.b5(B,r.u_size_t),u_size:new t.b5(B,r.u_size),u_camera_to_center_distance:new t.b5(B,r.u_camera_to_center_distance),u_pitch:new t.b5(B,r.u_pitch),u_rotate_symbol:new t.bC(B,r.u_rotate_symbol),u_aspect_ratio:new t.b5(B,r.u_aspect_ratio),u_fade_change:new t.b5(B,r.u_fade_change),u_label_plane_matrix:new t.bD(B,r.u_label_plane_matrix),u_coord_matrix:new t.bD(B,r.u_coord_matrix),u_is_text:new t.bC(B,r.u_is_text),u_pitch_with_map:new t.bC(B,r.u_pitch_with_map),u_is_along_line:new t.bC(B,r.u_is_along_line),u_is_variable_anchor:new t.bC(B,r.u_is_variable_anchor),u_texsize:new t.bH(B,r.u_texsize),u_texsize_icon:new t.bH(B,r.u_texsize_icon),u_texture:new t.bC(B,r.u_texture),u_texture_icon:new t.bC(B,r.u_texture_icon),u_gamma_scale:new t.b5(B,r.u_gamma_scale),u_device_pixel_ratio:new t.b5(B,r.u_device_pixel_ratio),u_is_halo:new t.bC(B,r.u_is_halo),u_translation:new t.bH(B,r.u_translation),u_pitched_scale:new t.b5(B,r.u_pitched_scale)}),background:(B,r)=>({u_opacity:new t.b5(B,r.u_opacity),u_color:new t.bF(B,r.u_color)}),backgroundPattern:(B,r)=>({u_opacity:new t.b5(B,r.u_opacity),u_image:new t.bC(B,r.u_image),u_pattern_tl_a:new t.bH(B,r.u_pattern_tl_a),u_pattern_br_a:new t.bH(B,r.u_pattern_br_a),u_pattern_tl_b:new t.bH(B,r.u_pattern_tl_b),u_pattern_br_b:new t.bH(B,r.u_pattern_br_b),u_texsize:new t.bH(B,r.u_texsize),u_mix:new t.b5(B,r.u_mix),u_pattern_size_a:new t.bH(B,r.u_pattern_size_a),u_pattern_size_b:new t.bH(B,r.u_pattern_size_b),u_scale_a:new t.b5(B,r.u_scale_a),u_scale_b:new t.b5(B,r.u_scale_b),u_pixel_coord_upper:new t.bH(B,r.u_pixel_coord_upper),u_pixel_coord_lower:new t.bH(B,r.u_pixel_coord_lower),u_tile_units_to_pixels:new t.b5(B,r.u_tile_units_to_pixels)}),terrain:(B,r)=>({u_texture:new t.bC(B,r.u_texture),u_ele_delta:new t.b5(B,r.u_ele_delta),u_fog_matrix:new t.bD(B,r.u_fog_matrix),u_fog_color:new t.bF(B,r.u_fog_color),u_fog_ground_blend:new t.b5(B,r.u_fog_ground_blend),u_fog_ground_blend_opacity:new t.b5(B,r.u_fog_ground_blend_opacity),u_horizon_color:new t.bF(B,r.u_horizon_color),u_horizon_fog_blend:new t.b5(B,r.u_horizon_fog_blend),u_is_globe_mode:new t.b5(B,r.u_is_globe_mode)}),terrainDepth:(B,r)=>({u_ele_delta:new t.b5(B,r.u_ele_delta)}),terrainCoords:(B,r)=>({u_texture:new t.bC(B,r.u_texture),u_terrain_coords_id:new t.b5(B,r.u_terrain_coords_id),u_ele_delta:new t.b5(B,r.u_ele_delta)}),projectionErrorMeasurement:(B,r)=>({u_input:new t.b5(B,r.u_input),u_output_expected:new t.b5(B,r.u_output_expected)}),atmosphere:(B,r)=>({u_sun_pos:new t.bG(B,r.u_sun_pos),u_atmosphere_blend:new t.b5(B,r.u_atmosphere_blend),u_globe_position:new t.bG(B,r.u_globe_position),u_globe_radius:new t.b5(B,r.u_globe_radius),u_inv_proj_matrix:new t.bD(B,r.u_inv_proj_matrix)}),sky:(B,r)=>({u_sky_color:new t.bF(B,r.u_sky_color),u_horizon_color:new t.bF(B,r.u_horizon_color),u_horizon:new t.bH(B,r.u_horizon),u_horizon_normal:new t.bH(B,r.u_horizon_normal),u_sky_horizon_blend:new t.b5(B,r.u_sky_horizon_blend),u_sky_blend:new t.b5(B,r.u_sky_blend)})};class Zs{constructor(r,p,C){this.context=r;const k=r.gl;this.buffer=k.createBuffer(),this.dynamicDraw=!!C,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),k.bufferData(k.ELEMENT_ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?k.DYNAMIC_DRAW:k.STATIC_DRAW),this.dynamicDraw||delete p.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const p=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),p.bufferSubData(p.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Gu={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class od{constructor(r,p,C,k){this.length=p.length,this.attributes=C,this.itemSize=p.bytesPerElement,this.dynamicDraw=k,this.context=r;const j=r.gl;this.buffer=j.createBuffer(),r.bindVertexBuffer.set(this.buffer),j.bufferData(j.ARRAY_BUFFER,p.arrayBuffer,this.dynamicDraw?j.DYNAMIC_DRAW:j.STATIC_DRAW),this.dynamicDraw||delete p.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){if(r.length!==this.length)throw new Error(`Length of new data is ${r.length}, which doesn't match current length of ${this.length}`);const p=this.context.gl;this.bind(),p.bufferSubData(p.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,p){for(let C=0;C<this.attributes.length;C++){const k=p.attributes[this.attributes[C].name];k!==void 0&&r.enableVertexAttribArray(k)}}setVertexAttribPointers(r,p,C){for(let k=0;k<this.attributes.length;k++){const j=this.attributes[k],Z=p.attributes[j.name];Z!==void 0&&r.vertexAttribPointer(Z,j.components,r[Gu[j.type]],!1,this.itemSize,j.offset+this.itemSize*(C||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class oa{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ld extends oa{getDefault(){return t.b4.transparent}set(r){const p=this.current;(r.r!==p.r||r.g!==p.g||r.b!==p.b||r.a!==p.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class qu extends oa{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class cd extends oa{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class Sh extends oa{getDefault(){return[!0,!0,!0,!0]}set(r){const p=this.current;(r[0]!==p[0]||r[1]!==p[1]||r[2]!==p[2]||r[3]!==p[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Ng extends oa{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class Um extends oa{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class ud extends oa{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const p=this.current;(r.func!==p.func||r.ref!==p.ref||r.mask!==p.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class Yd extends oa{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const p=this.current;(r[0]!==p[0]||r[1]!==p[1]||r[2]!==p[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class Kd extends oa{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const p=this.gl;r?p.enable(p.STENCIL_TEST):p.disable(p.STENCIL_TEST),this.current=r,this.dirty=!1}}class Yf extends oa{getDefault(){return[0,1]}set(r){const p=this.current;(r[0]!==p[0]||r[1]!==p[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class Fc extends oa{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const p=this.gl;r?p.enable(p.DEPTH_TEST):p.disable(p.DEPTH_TEST),this.current=r,this.dirty=!1}}class Kl extends oa{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class Jl extends oa{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const p=this.gl;r?p.enable(p.BLEND):p.disable(p.BLEND),this.current=r,this.dirty=!1}}class $m extends oa{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const p=this.current;(r[0]!==p[0]||r[1]!==p[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class Kf extends oa{getDefault(){return t.b4.transparent}set(r){const p=this.current;(r.r!==p.r||r.g!==p.g||r.b!==p.b||r.a!==p.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Jd extends oa{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class Hu extends oa{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const p=this.gl;r?p.enable(p.CULL_FACE):p.disable(p.CULL_FACE),this.current=r,this.dirty=!1}}class Do extends oa{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class Qd extends oa{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}class Th extends oa{getDefault(){return null}set(r){(r!==this.current||this.dirty)&&(this.gl.useProgram(r),this.current=r,this.dirty=!1)}}class Ch extends oa{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class hd extends oa{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const p=this.current;(r[0]!==p[0]||r[1]!==p[1]||r[2]!==p[2]||r[3]!==p[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class fu extends oa{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const p=this.gl;p.bindFramebuffer(p.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class Ll extends oa{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const p=this.gl;p.bindRenderbuffer(p.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class ef extends oa{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const p=this.gl;p.bindTexture(p.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class tf extends oa{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const p=this.gl;p.bindBuffer(p.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class aa extends oa{getDefault(){return null}set(r){const p=this.gl;p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class pu extends oa{getDefault(){return null}set(r){var p;if(r===this.current&&!this.dirty)return;const C=this.gl;io(C)?C.bindVertexArray(r):(p=C.getExtension("OES_vertex_array_object"))===null||p===void 0||p.bindVertexArrayOES(r),this.current=r,this.dirty=!1}}class nf extends oa{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class Zu extends oa{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class zl extends oa{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const p=this.gl;p.pixelStorei(p.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class mu extends oa{constructor(r,p){super(r),this.context=r,this.parent=p}getDefault(){return null}}class Jf extends mu{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferTexture2D(p.FRAMEBUFFER,p.COLOR_ATTACHMENT0,p.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class Qf extends mu{set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferRenderbuffer(p.FRAMEBUFFER,p.DEPTH_ATTACHMENT,p.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class ep extends mu{set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const p=this.gl;p.framebufferRenderbuffer(p.FRAMEBUFFER,p.DEPTH_STENCIL_ATTACHMENT,p.RENDERBUFFER,r),this.current=r,this.dirty=!1}}const Ql="Framebuffer is not complete";class Rr{constructor(r,p,C,k,j){this.context=r,this.width=p,this.height=C;const Z=r.gl,re=this.framebuffer=Z.createFramebuffer();if(this.colorAttachment=new Jf(r,re),k)this.depthAttachment=j?new ep(r,re):new Qf(r,re);else if(j)throw new Error("Stencil cannot be set without depth");if(Z.checkFramebufferStatus(Z.FRAMEBUFFER)!==Z.FRAMEBUFFER_COMPLETE)throw new Error(Ql)}destroy(){const r=this.context.gl,p=this.colorAttachment.get();if(p&&r.deleteTexture(p),this.depthAttachment){const C=this.depthAttachment.get();C&&r.deleteRenderbuffer(C)}r.deleteFramebuffer(this.framebuffer)}}class rf{constructor(r){var p,C;if(this.gl=r,this.clearColor=new ld(this),this.clearDepth=new qu(this),this.clearStencil=new cd(this),this.colorMask=new Sh(this),this.depthMask=new Ng(this),this.stencilMask=new Um(this),this.stencilFunc=new ud(this),this.stencilOp=new Yd(this),this.stencilTest=new Kd(this),this.depthRange=new Yf(this),this.depthTest=new Fc(this),this.depthFunc=new Kl(this),this.blend=new Jl(this),this.blendFunc=new $m(this),this.blendColor=new Kf(this),this.blendEquation=new Jd(this),this.cullFace=new Hu(this),this.cullFaceSide=new Do(this),this.frontFace=new Qd(this),this.program=new Th(this),this.activeTexture=new Ch(this),this.viewport=new hd(this),this.bindFramebuffer=new fu(this),this.bindRenderbuffer=new Ll(this),this.bindTexture=new ef(this),this.bindVertexBuffer=new tf(this),this.bindElementBuffer=new aa(this),this.bindVertexArray=new pu(this),this.pixelStoreUnpack=new nf(this),this.pixelStoreUnpackPremultiplyAlpha=new Zu(this),this.pixelStoreUnpackFlipY=new zl(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),io(r)){this.HALF_FLOAT=r.HALF_FLOAT;const k=r.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(p=r.RGBA16F)!==null&&p!==void 0?p:k==null?void 0:k.RGBA16F_EXT,this.RGB16F=(C=r.RGB16F)!==null&&C!==void 0?C:k==null?void 0:k.RGB16F_EXT,r.getExtension("EXT_color_buffer_float")}else{r.getExtension("EXT_color_buffer_half_float"),r.getExtension("OES_texture_half_float_linear");const k=r.getExtension("OES_texture_half_float");this.HALF_FLOAT=k==null?void 0:k.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,p){return new Zs(this,r,p)}createVertexBuffer(r,p,C){return new od(this,r,p,C)}createRenderbuffer(r,p,C){const k=this.gl,j=k.createRenderbuffer();return this.bindRenderbuffer.set(j),k.renderbufferStorage(k.RENDERBUFFER,r,p,C),this.bindRenderbuffer.set(null),j}createFramebuffer(r,p,C,k){return new Rr(this,r,p,C,k)}clear({color:r,depth:p,stencil:C}){const k=this.gl;let j=0;r&&(j|=k.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),p!==void 0&&(j|=k.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(p),this.depthMask.set(!0)),C!==void 0&&(j|=k.STENCIL_BUFFER_BIT,this.clearStencil.set(C),this.stencilMask.set(255)),k.clear(j)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){t.bz(r.blendFunction,hi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}createVertexArray(){var r;return io(this.gl)?this.gl.createVertexArray():(r=this.gl.getExtension("OES_vertex_array_object"))===null||r===void 0?void 0:r.createVertexArrayOES()}deleteVertexArray(r){var p;return io(this.gl)?this.gl.deleteVertexArray(r):(p=this.gl.getExtension("OES_vertex_array_object"))===null||p===void 0?void 0:p.deleteVertexArrayOES(r)}unbindVAO(){this.bindVertexArray.set(null)}}let Eh;function af(B,r,p,C,k){const j=B.context,Z=B.transform,re=j.gl,ue=B.useProgram("collisionBox"),ye=[];let Me=0,Re=0;for(let Lt=0;Lt<C.length;Lt++){const jt=C[Lt],Nt=r.getTile(jt).getBucket(p);if(!Nt)continue;const Bt=k?Nt.textCollisionBox:Nt.iconCollisionBox,nn=Nt.collisionCircleArray;nn.length>0&&(ye.push({circleArray:nn,circleOffset:Re,coord:jt}),Me+=nn.length/4,Re=Me),Bt&&ue.draw(j,re.LINES,Sr.disabled,Hi.disabled,B.colorModeForRenderPass(),Wi.disabled,Nm(B.transform),B.style.map.terrain&&B.style.map.terrain.getTerrainData(jt),Z.getProjectionData({overscaledTileID:jt,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),p.id,Bt.layoutVertexBuffer,Bt.indexBuffer,Bt.segments,null,B.transform.zoom,null,null,Bt.collisionVertexBuffer)}if(!k||!ye.length)return;const ze=B.useProgram("collisionCircle"),Je=new t.bM;Je.resize(4*Me),Je._trim();let ot=0;for(const Lt of ye)for(let jt=0;jt<Lt.circleArray.length/4;jt++){const Nt=4*jt,Bt=Lt.circleArray[Nt+0],nn=Lt.circleArray[Nt+1],rn=Lt.circleArray[Nt+2],an=Lt.circleArray[Nt+3];Je.emplace(ot++,Bt,nn,rn,an,0),Je.emplace(ot++,Bt,nn,rn,an,1),Je.emplace(ot++,Bt,nn,rn,an,2),Je.emplace(ot++,Bt,nn,rn,an,3)}(!Eh||Eh.length<2*Me)&&(Eh=function(Lt){const jt=2*Lt,Nt=new t.bO;Nt.resize(jt),Nt._trim();for(let Bt=0;Bt<jt;Bt++){const nn=6*Bt;Nt.uint16[nn+0]=4*Bt+0,Nt.uint16[nn+1]=4*Bt+1,Nt.uint16[nn+2]=4*Bt+2,Nt.uint16[nn+3]=4*Bt+2,Nt.uint16[nn+4]=4*Bt+3,Nt.uint16[nn+5]=4*Bt+0}return Nt}(Me));const Pt=j.createIndexBuffer(Eh,!0),Et=j.createVertexBuffer(Je,t.bN.members,!0);for(const Lt of ye){const jt=jm(B.transform);ze.draw(j,re.TRIANGLES,Sr.disabled,Hi.disabled,B.colorModeForRenderPass(),Wi.disabled,jt,B.style.map.terrain&&B.style.map.terrain.getTerrainData(Lt.coord),null,p.id,Et,Pt,t.aD.simpleSegment(0,2*Lt.circleOffset,Lt.circleArray.length,Lt.circleArray.length/2),null,B.transform.zoom,null,null,null)}Et.destroy(),Pt.destroy()}const Wu=t.aq(new Float32Array(16));function sf(B,r,p,C,k,j){const{horizontalAlign:Z,verticalAlign:re}=t.ay(B);return new t.P((-(Z-.5)*r/k+C[0])*j,(-(re-.5)*p/k+C[1])*j)}function ga(B,r,p,C,k,j){const Z=r.tileAnchorPoint.add(new t.P(r.translation[0],r.translation[1]));if(r.pitchWithMap){let re=C.mult(j);p||(re=re.rotate(-k));const ue=Z.add(re);return Gn(ue.x,ue.y,r.pitchedLabelPlaneMatrix,r.getElevation).point}if(p){const re=kt(r.tileAnchorPoint.x+1,r.tileAnchorPoint.y,r).point.sub(B),ue=Math.atan(re.y/re.x)+(re.x<0?Math.PI:0);return B.add(C.rotate(ue))}return B.add(C)}function Kp(B,r,p,C,k,j,Z,re,ue,ye,Me,Re){const ze=B.text.placedSymbolArray,Je=B.text.dynamicLayoutVertexArray,ot=B.icon.dynamicLayoutVertexArray,Pt={};Je.clear();for(let Et=0;Et<ze.length;Et++){const Lt=ze.get(Et),jt=Lt.hidden||!Lt.crossTileID||B.allowVerticalPlacement&&!Lt.placedOrientation?null:C[Lt.crossTileID];if(jt){const Nt=new t.P(Lt.anchorX,Lt.anchorY),Bt={getElevation:Re,width:k.width,height:k.height,pitchedLabelPlaneMatrix:j,lineVertexArray:null,pitchWithMap:p,transform:k,projectionCache:null,tileAnchorPoint:Nt,translation:ye,unwrappedTileID:Me},nn=p?Jt(Nt.x,Nt.y,Bt):kt(Nt.x,Nt.y,Bt),rn=Sn(k.cameraToCenterDistance,nn.signedDistanceFromCamera);let an=t.aj(B.textSizeData,re,Lt)*rn/t.as;p&&(an*=B.tilePixelRatio/Z);const{width:Mn,height:Rn,anchor:Hn,textOffset:ei,textBoxScale:jn}=jt,Ri=sf(Hn,Mn,Rn,ei,jn,an),zi=k.getPitchedTextCorrection(Nt.x+ye[0],Nt.y+ye[1],Me),xi=ga(nn.point,Bt,r,Ri,-k.bearingInRadians,zi),Gi=B.allowVerticalPlacement&&Lt.placedOrientation===t.ai.vertical?Math.PI/2:0;for(let Hr=0;Hr<Lt.numGlyphs;Hr++)t.ak(Je,xi,Gi);ue&&Lt.associatedIconIndex>=0&&(Pt[Lt.associatedIconIndex]={shiftedAnchor:xi,angle:Gi})}else li(Lt.numGlyphs,Je)}if(ue){ot.clear();const Et=B.icon.placedSymbolArray;for(let Lt=0;Lt<Et.length;Lt++){const jt=Et.get(Lt);if(jt.hidden)li(jt.numGlyphs,ot);else{const Nt=Pt[Lt];if(Nt)for(let Bt=0;Bt<jt.numGlyphs;Bt++)t.ak(ot,Nt.shiftedAnchor,Nt.angle);else li(jt.numGlyphs,ot)}}B.icon.dynamicLayoutVertexBuffer.updateData(ot)}B.text.dynamicLayoutVertexBuffer.updateData(Je)}function jg(B,r,p){return p.iconsInText&&r?"symbolTextAndIcon":B?"symbolSDF":"symbolIcon"}function dd(B,r,p,C,k,j,Z,re,ue,ye,Me,Re,ze){const Je=B.context,ot=Je.gl,Pt=B.transform,Et=re==="map",Lt=ue==="map",jt=re!=="viewport"&&p.layout.get("symbol-placement")!=="point",Nt=Et&&!Lt&&!jt,Bt=!p.layout.get("symbol-sort-key").isConstant();let nn=!1;const rn=B.getDepthModeForSublayer(0,Sr.ReadOnly),an=p._unevaluatedLayout.hasValue("text-variable-anchor")||p._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Mn=[],Rn=Pt.getCircleRadiusCorrection();for(const Hn of C){const ei=r.getTile(Hn),jn=ei.getBucket(p);if(!jn)continue;const Ri=k?jn.text:jn.icon;if(!Ri||!Ri.segments.get().length||!Ri.hasVisibleVertices)continue;const zi=Ri.programConfigurations.get(p.id),xi=k||jn.sdfIcons,Gi=k?jn.textSizeData:jn.iconSizeData,Hr=Lt||Pt.pitch!==0,ua=B.useProgram(jg(xi,k,jn),zi),Ma=t.ah(Gi,Pt.zoom),La=B.style.map.terrain&&B.style.map.terrain.getTerrainData(Hn);let Ha,Ia,Pa,Wr,ro=[0,0],Is=null;if(k)Ia=ei.glyphAtlasTexture,Pa=ot.LINEAR,Ha=ei.glyphAtlasTexture.size,jn.iconsInText&&(ro=ei.imageAtlasTexture.size,Is=ei.imageAtlasTexture,Wr=Hr||B.options.rotating||B.options.zooming||Gi.kind==="composite"||Gi.kind==="camera"?ot.LINEAR:ot.NEAREST);else{const Fa=p.layout.get("icon-size").constantOr(0)!==1||jn.iconsNeedLinear;Ia=ei.imageAtlasTexture,Pa=xi||B.options.rotating||B.options.zooming||Fa||Hr?ot.LINEAR:ot.NEAREST,Ha=ei.imageAtlasTexture.size}const gs=t.at(ei,1,B.transform.zoom),Za=kn(Et,B.transform,gs),tc=t.H();t.an(tc,Za);const nc=fn(Lt,Et,B.transform,gs),il=t.au(Pt,ei,j,Z),rl=Pt.getProjectionData({overscaledTileID:Hn,applyGlobeMatrix:!ze,applyTerrainMatrix:!0}),xu=an&&jn.hasTextData(),rh=p.layout.get("icon-text-fit")!=="none"&&xu&&jn.hasIconData();if(jt){const Fa=B.style.map.terrain?(_l,_s)=>B.style.map.terrain.getElevation(Hn,_l,_s):null,us=p.layout.get("text-rotation-alignment")==="map";we(jn,B,k,Za,tc,Lt,ye,us,Hn.toUnwrapped(),Pt.width,Pt.height,il,Fa)}const ah=k&&an||rh,yo=jt||ah?Wu:Lt?Za:B.transform.clipSpaceToPixelsMatrix,gl=xi&&p.paint.get(k?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let al;al=xi?jn.iconsInText?Rs(Gi.kind,Ma,Nt,Lt,jt,ah,B,yo,nc,il,Ha,ro,Rn):Ds(Gi.kind,Ma,Nt,Lt,jt,ah,B,yo,nc,il,k,Ha,0,Rn):bh(Gi.kind,Ma,Nt,Lt,jt,ah,B,yo,nc,il,k,Ha,Rn);const Oo={program:ua,buffers:Ri,uniformValues:al,projectionData:rl,atlasTexture:Ia,atlasTextureIcon:Is,atlasInterpolation:Pa,atlasInterpolationIcon:Wr,isSDF:xi,hasHalo:gl};if(Bt&&jn.canOverlap){nn=!0;const Fa=Ri.segments.get();for(const us of Fa)Mn.push({segments:new t.aD([us]),sortKey:us.sortKey,state:Oo,terrainData:La})}else Mn.push({segments:Ri.segments,sortKey:0,state:Oo,terrainData:La})}nn&&Mn.sort((Hn,ei)=>Hn.sortKey-ei.sortKey);for(const Hn of Mn){const ei=Hn.state;if(Je.activeTexture.set(ot.TEXTURE0),ei.atlasTexture.bind(ei.atlasInterpolation,ot.CLAMP_TO_EDGE),ei.atlasTextureIcon&&(Je.activeTexture.set(ot.TEXTURE1),ei.atlasTextureIcon&&ei.atlasTextureIcon.bind(ei.atlasInterpolationIcon,ot.CLAMP_TO_EDGE)),ei.isSDF){const jn=ei.uniformValues;ei.hasHalo&&(jn.u_is_halo=1,tp(ei.buffers,Hn.segments,p,B,ei.program,rn,Me,Re,jn,ei.projectionData,Hn.terrainData)),jn.u_is_halo=0}tp(ei.buffers,Hn.segments,p,B,ei.program,rn,Me,Re,ei.uniformValues,ei.projectionData,Hn.terrainData)}}function tp(B,r,p,C,k,j,Z,re,ue,ye,Me){const Re=C.context;k.draw(Re,Re.gl.TRIANGLES,j,Z,re,Wi.backCCW,ue,Me,ye,p.id,B.layoutVertexBuffer,B.indexBuffer,r,p.paint,C.transform.zoom,B.programConfigurations.get(p.id),B.dynamicLayoutVertexBuffer,B.opacityVertexBuffer)}function np(B,r,p,C,k){const j=B.context,Z=j.gl,re=Hi.disabled,ue=new hi([Z.ONE,Z.ONE],t.b4.transparent,[!0,!0,!0,!0]),ye=r.getBucket(p);if(!ye)return;const Me=C.key;let Re=p.heatmapFbos.get(Me);Re||(Re=of(j,r.tileSize,r.tileSize),p.heatmapFbos.set(Me,Re)),j.bindFramebuffer.set(Re.framebuffer),j.viewport.set([0,0,r.tileSize,r.tileSize]),j.clear({color:t.b4.transparent});const ze=ye.programConfigurations.get(p.id),Je=B.useProgram("heatmap",ze,!k),ot=B.transform.getProjectionData({overscaledTileID:r.tileID,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),Pt=B.style.map.terrain.getTerrainData(C);Je.draw(j,Z.TRIANGLES,Sr.disabled,re,ue,Wi.disabled,Xf(r,B.transform.zoom,p.paint.get("heatmap-intensity"),1),Pt,ot,p.id,ye.layoutVertexBuffer,ye.indexBuffer,ye.segments,p.paint,B.transform.zoom,ze)}function fd(B,r,p,C,k){const j=B.context,Z=j.gl,re=B.transform;j.setColorMode(B.colorModeForRenderPass());const ue=ip(j,r),ye=p.key,Me=r.heatmapFbos.get(ye);if(!Me)return;j.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_2D,Me.colorAttachment.get()),j.activeTexture.set(Z.TEXTURE1),ue.bind(Z.LINEAR,Z.CLAMP_TO_EDGE);const Re=re.getProjectionData({overscaledTileID:p,applyTerrainMatrix:k,applyGlobeMatrix:!C});B.useProgram("heatmapTexture").draw(j,Z.TRIANGLES,Sr.disabled,Hi.disabled,B.colorModeForRenderPass(),Wi.disabled,Rl(B,r,0,1),null,Re,r.id,B.rasterBoundsBuffer,B.quadTriangleIndexBuffer,B.rasterBoundsSegments,r.paint,re.zoom),Me.destroy(),r.heatmapFbos.delete(ye)}function of(B,r,p){var C,k;const j=B.gl,Z=j.createTexture();j.bindTexture(j.TEXTURE_2D,Z),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_S,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_WRAP_T,j.CLAMP_TO_EDGE),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MIN_FILTER,j.LINEAR),j.texParameteri(j.TEXTURE_2D,j.TEXTURE_MAG_FILTER,j.LINEAR);const re=(C=B.HALF_FLOAT)!==null&&C!==void 0?C:j.UNSIGNED_BYTE,ue=(k=B.RGBA16F)!==null&&k!==void 0?k:j.RGBA;j.texImage2D(j.TEXTURE_2D,0,ue,r,p,0,j.RGBA,re,null);const ye=B.createFramebuffer(r,p,!1,!1);return ye.colorAttachment.set(Z),ye}function ip(B,r){return r.colorRampTexture||(r.colorRampTexture=new qe(B,r.colorRamp,B.gl.RGBA)),r.colorRampTexture}function Jp(B,r,p,C,k){if(!p||!C||!C.imageAtlas)return;const j=C.imageAtlas.patternPositions;let Z=j[p.to.toString()],re=j[p.from.toString()];if(!Z&&re&&(Z=re),!re&&Z&&(re=Z),!Z||!re){const ue=k.getPaintProperty(r);Z=j[ue],re=j[ue]}Z&&re&&B.setConstantPatternPositions(Z,re)}function gu(B,r,p,C,k,j,Z,re){const ue=B.context.gl,ye="fill-pattern",Me=p.paint.get(ye),Re=Me&&Me.constantOr(1),ze=p.getCrossfadeParameters();let Je,ot,Pt,Et,Lt;const jt=B.transform,Nt=p.paint.get("fill-translate"),Bt=p.paint.get("fill-translate-anchor");Z?(ot=Re&&!p.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Je=ue.LINES):(ot=Re?"fillPattern":"fill",Je=ue.TRIANGLES);const nn=Me.constantOr(null);for(const rn of C){const an=r.getTile(rn);if(Re&&!an.patternsLoaded())continue;const Mn=an.getBucket(p);if(!Mn)continue;const Rn=Mn.programConfigurations.get(p.id),Hn=B.useProgram(ot,Rn),ei=B.style.map.terrain&&B.style.map.terrain.getTerrainData(rn);Re&&(B.context.activeTexture.set(ue.TEXTURE0),an.imageAtlasTexture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE),Rn.updatePaintBuffers(ze)),Jp(Rn,ye,nn,an,p);const jn=jt.getProjectionData({overscaledTileID:rn,applyGlobeMatrix:!re,applyTerrainMatrix:!0}),Ri=t.au(jt,an,Nt,Bt);if(Z){Et=Mn.indexBuffer2,Lt=Mn.segments2;const xi=[ue.drawingBufferWidth,ue.drawingBufferHeight];Pt=ot==="fillOutlinePattern"&&Re?Wd(B,ze,an,xi,Ri):Vm(xi,Ri)}else Et=Mn.indexBuffer,Lt=Mn.segments,Pt=Re?Dl(B,ze,an,Ri):{u_fill_translate:Ri};let zi;if(B.renderPass==="translucent"&&re){const[xi]=B.getStencilConfigForOverlapAndUpdateStencilID(C);zi=xi[rn.overscaledZ]}else zi=B.stencilModeForClipping(rn);Hn.draw(B.context,Je,k,zi,j,Wi.backCCW,Pt,ei,jn,p.id,Mn.layoutVertexBuffer,Et,Lt,p.paint,B.transform.zoom,Rn)}}function _u(B,r,p,C,k,j,Z,re){const ue=B.context,ye=ue.gl,Me="fill-extrusion-pattern",Re=p.paint.get(Me),ze=Re.constantOr(1),Je=p.getCrossfadeParameters(),ot=p.paint.get("fill-extrusion-opacity"),Pt=Re.constantOr(null),Et=B.transform;for(const Lt of C){const jt=r.getTile(Lt),Nt=jt.getBucket(p);if(!Nt)continue;const Bt=B.style.map.terrain&&B.style.map.terrain.getTerrainData(Lt),nn=Nt.programConfigurations.get(p.id),rn=B.useProgram(ze?"fillExtrusionPattern":"fillExtrusion",nn);ze&&(B.context.activeTexture.set(ye.TEXTURE0),jt.imageAtlasTexture.bind(ye.LINEAR,ye.CLAMP_TO_EDGE),nn.updatePaintBuffers(Je));const an=Et.getProjectionData({overscaledTileID:Lt,applyGlobeMatrix:!re,applyTerrainMatrix:!0});Jp(nn,Me,Pt,jt,p);const Mn=t.au(Et,jt,p.paint.get("fill-extrusion-translate"),p.paint.get("fill-extrusion-translate-anchor")),Rn=p.paint.get("fill-extrusion-vertical-gradient"),Hn=ze?Bm(B,Rn,ot,Mn,Lt,Je,jt):gc(B,Rn,ot,Mn);rn.draw(ue,ue.gl.TRIANGLES,k,j,Z,Wi.backCCW,Hn,Bt,an,p.id,Nt.layoutVertexBuffer,Nt.indexBuffer,Nt.segments,p.paint,B.transform.zoom,nn,B.style.map.terrain&&Nt.centroidVertexBuffer)}}function rp(B,r,p,C,k,j,Z,re,ue){var ye;const Me=B.style.projection,Re=B.context,ze=B.transform,Je=Re.gl,ot=B.useProgram("hillshade"),Pt=!B.options.moving;for(const Et of C){const Lt=r.getTile(Et),jt=Lt.fbo;if(!jt)continue;const Nt=Me.getMeshFromTileID(Re,Et.canonical,re,!0,"raster"),Bt=(ye=B.style.map.terrain)===null||ye===void 0?void 0:ye.getTerrainData(Et);Re.activeTexture.set(Je.TEXTURE0),Je.bindTexture(Je.TEXTURE_2D,jt.colorAttachment.get());const nn=ze.getProjectionData({overscaledTileID:Et,aligned:Pt,applyGlobeMatrix:!ue,applyTerrainMatrix:!0});ot.draw(Re,Je.TRIANGLES,j,k[Et.overscaledZ],Z,Wi.backCCW,Tr(B,Lt,p),Bt,nn,p.id,Nt.vertexBuffer,Nt.indexBuffer,Nt.segments)}}const Ro=[new t.P(0,0),new t.P(t.X,0),new t.P(t.X,t.X),new t.P(0,t.X)];function ns(B,r,p,C,k,j,Z,re,ue=!1,ye=!1){const Me=C[C.length-1].overscaledZ,Re=B.context,ze=Re.gl,Je=B.useProgram("raster"),ot=B.transform,Pt=B.style.projection,Et=B.colorModeForRenderPass(),Lt=!B.options.moving;for(const jt of C){const Nt=B.getDepthModeForSublayer(jt.overscaledZ-Me,p.paint.get("raster-opacity")===1?Sr.ReadWrite:Sr.ReadOnly,ze.LESS),Bt=r.getTile(jt);Bt.registerFadeDuration(p.paint.get("raster-fade-duration"));const nn=r.findLoadedParent(jt,0),rn=r.findLoadedSibling(jt),an=Bc(Bt,nn||rn||null,r,p,B.transform,B.style.map.terrain);let Mn,Rn;const Hn=p.paint.get("raster-resampling")==="nearest"?ze.NEAREST:ze.LINEAR;Re.activeTexture.set(ze.TEXTURE0),Bt.texture.bind(Hn,ze.CLAMP_TO_EDGE,ze.LINEAR_MIPMAP_NEAREST),Re.activeTexture.set(ze.TEXTURE1),nn?(nn.texture.bind(Hn,ze.CLAMP_TO_EDGE,ze.LINEAR_MIPMAP_NEAREST),Mn=Math.pow(2,nn.tileID.overscaledZ-Bt.tileID.overscaledZ),Rn=[Bt.tileID.canonical.x*Mn%1,Bt.tileID.canonical.y*Mn%1]):Bt.texture.bind(Hn,ze.CLAMP_TO_EDGE,ze.LINEAR_MIPMAP_NEAREST),Bt.texture.useMipmap&&Re.extTextureFilterAnisotropic&&B.transform.pitch>20&&ze.texParameterf(ze.TEXTURE_2D,Re.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Re.extTextureFilterAnisotropicMax);const ei=B.style.map.terrain&&B.style.map.terrain.getTerrainData(jt),jn=ot.getProjectionData({overscaledTileID:jt,aligned:Lt,applyGlobeMatrix:!ye,applyTerrainMatrix:!0}),Ri=xh(Rn||[0,0],Mn||1,an,p,re),zi=Pt.getMeshFromTileID(Re,jt.canonical,j,Z,"raster");Je.draw(Re,ze.TRIANGLES,Nt,k?k[jt.overscaledZ]:Hi.disabled,Et,ue?Wi.frontCCW:Wi.backCCW,Ri,ei,jn,p.id,zi.vertexBuffer,zi.indexBuffer,zi.segments)}}function Bc(B,r,p,C,k,j){const Z=C.paint.get("raster-fade-duration");if(!j&&Z>0){const re=J.now(),ue=(re-B.timeAdded)/Z,ye=r?(re-r.timeAdded)/Z:-1,Me=p.getSource(),Re=ko(k,{tileSize:Me.tileSize,roundZoom:Me.roundZoom}),ze=!r||Math.abs(r.tileID.overscaledZ-Re)>Math.abs(B.tileID.overscaledZ-Re),Je=ze&&B.refreshedUponExpiration?1:t.ab(ze?ue:1-ye,0,1);return B.refreshedUponExpiration&&ue>=1&&(B.refreshedUponExpiration=!1),r?{opacity:1,mix:1-Je}:{opacity:Je,mix:0}}return{opacity:1,mix:0}}const tl=new t.b4(1,0,0,1),lf=new t.b4(0,1,0,1),cf=new t.b4(0,0,1,1),uf=new t.b4(1,0,1,1),Xu=new t.b4(0,1,1,1);function Yu(B,r,p,C){pd(B,0,r+p/2,B.transform.width,p,C)}function Mh(B,r,p,C){pd(B,r-p/2,0,p,B.transform.height,C)}function pd(B,r,p,C,k,j){const Z=B.context,re=Z.gl;re.enable(re.SCISSOR_TEST),re.scissor(r*B.pixelRatio,p*B.pixelRatio,C*B.pixelRatio,k*B.pixelRatio),Z.clear({color:j}),re.disable(re.SCISSOR_TEST)}function Qp(B,r,p){const C=B.context,k=C.gl,j=B.useProgram("debug"),Z=Sr.disabled,re=Hi.disabled,ue=B.colorModeForRenderPass(),ye="$debug",Me=B.style.map.terrain&&B.style.map.terrain.getTerrainData(p);C.activeTexture.set(k.TEXTURE0);const Re=r.getTileByID(p.key).latestRawTileData,ze=Math.floor((Re&&Re.byteLength||0)/1024),Je=r.getTile(p).tileSize,ot=512/Math.min(Je,512)*(p.overscaledZ/B.transform.zoom)*.5;let Pt=p.canonical.toString();p.overscaledZ!==p.canonical.z&&(Pt+=` => ${p.overscaledZ}`),function(Lt,jt){Lt.initDebugOverlayCanvas();const Nt=Lt.debugOverlayCanvas,Bt=Lt.context.gl,nn=Lt.debugOverlayCanvas.getContext("2d");nn.clearRect(0,0,Nt.width,Nt.height),nn.shadowColor="white",nn.shadowBlur=2,nn.lineWidth=1.5,nn.strokeStyle="white",nn.textBaseline="top",nn.font="bold 36px Open Sans, sans-serif",nn.fillText(jt,5,5),nn.strokeText(jt,5,5),Lt.debugOverlayTexture.update(Nt),Lt.debugOverlayTexture.bind(Bt.LINEAR,Bt.CLAMP_TO_EDGE)}(B,`${Pt} ${ze}kB`);const Et=B.transform.getProjectionData({overscaledTileID:p,applyGlobeMatrix:!0,applyTerrainMatrix:!0});j.draw(C,k.TRIANGLES,Z,re,hi.alphaBlended,Wi.disabled,Yp(t.b4.transparent,ot),null,Et,ye,B.debugBuffer,B.quadTriangleIndexBuffer,B.debugSegments),j.draw(C,k.LINE_STRIP,Z,re,ue,Wi.disabled,Yp(t.b4.red),Me,Et,ye,B.debugBuffer,B.tileBorderIndexBuffer,B.debugSegments)}function Ku(B,r,p,C){const{isRenderingGlobe:k}=C,j=B.context,Z=j.gl,re=B.transform,ue=B.colorModeForRenderPass(),ye=B.getDepthModeFor3D(),Me=B.useProgram("terrain");j.bindFramebuffer.set(null),j.viewport.set([0,0,B.width,B.height]);for(const Re of p){const ze=r.getTerrainMesh(Re.tileID),Je=B.renderToTexture.getTexture(Re),ot=r.getTerrainData(Re.tileID);j.activeTexture.set(Z.TEXTURE0),Z.bindTexture(Z.TEXTURE_2D,Je.texture);const Pt=r.getMeshFrameDelta(re.zoom),Et=re.calculateFogMatrix(Re.tileID.toUnwrapped()),Lt=id(Pt,Et,B.style.sky,re.pitch,k),jt=re.getProjectionData({overscaledTileID:Re.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});Me.draw(j,Z.TRIANGLES,ye,Hi.disabled,ue,Wi.backCCW,Lt,ot,jt,"terrain",ze.vertexBuffer,ze.indexBuffer,ze.segments)}}function em(B,r){if(!r.mesh){const p=new t.aC;p.emplaceBack(-1,-1),p.emplaceBack(1,-1),p.emplaceBack(1,1),p.emplaceBack(-1,1);const C=new t.aE;C.emplaceBack(0,1,2),C.emplaceBack(0,2,3),r.mesh=new Bs(B.createVertexBuffer(p,Br.members),B.createIndexBuffer(C),t.aD.simpleSegment(0,0,p.length,C.length))}return r.mesh}class Gm{constructor(r,p){this.context=new rf(r),this.transform=p,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:t.aq(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=Qe.maxUnderzooming+Qe.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new zc}resize(r,p,C){if(this.width=Math.floor(r*C),this.height=Math.floor(p*C),this.pixelRatio=C,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const k of this.style._order)this.style._layers[k].resize()}setup(){const r=this.context,p=new t.aC;p.emplaceBack(0,0),p.emplaceBack(t.X,0),p.emplaceBack(0,t.X),p.emplaceBack(t.X,t.X),this.tileExtentBuffer=r.createVertexBuffer(p,Br.members),this.tileExtentSegments=t.aD.simpleSegment(0,0,4,2);const C=new t.aC;C.emplaceBack(0,0),C.emplaceBack(t.X,0),C.emplaceBack(0,t.X),C.emplaceBack(t.X,t.X),this.debugBuffer=r.createVertexBuffer(C,Br.members),this.debugSegments=t.aD.simpleSegment(0,0,4,5);const k=new t.bT;k.emplaceBack(0,0,0,0),k.emplaceBack(t.X,0,t.X,0),k.emplaceBack(0,t.X,0,t.X),k.emplaceBack(t.X,t.X,t.X,t.X),this.rasterBoundsBuffer=r.createVertexBuffer(k,Hf.members),this.rasterBoundsSegments=t.aD.simpleSegment(0,0,4,2);const j=new t.aC;j.emplaceBack(0,0),j.emplaceBack(t.X,0),j.emplaceBack(0,t.X),j.emplaceBack(t.X,t.X),this.rasterBoundsBufferPosOnly=r.createVertexBuffer(j,Br.members),this.rasterBoundsSegmentsPosOnly=t.aD.simpleSegment(0,0,4,5);const Z=new t.aC;Z.emplaceBack(0,0),Z.emplaceBack(1,0),Z.emplaceBack(0,1),Z.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(Z,Br.members),this.viewportSegments=t.aD.simpleSegment(0,0,4,2);const re=new t.bU;re.emplaceBack(0),re.emplaceBack(1),re.emplaceBack(3),re.emplaceBack(2),re.emplaceBack(0),this.tileBorderIndexBuffer=r.createIndexBuffer(re);const ue=new t.aE;ue.emplaceBack(1,0,2),ue.emplaceBack(1,2,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(ue);const ye=this.context.gl;this.stencilClearMode=new Hi({func:ye.ALWAYS,mask:0},0,255,ye.ZERO,ye.ZERO,ye.ZERO),this.tileExtentMesh=new Bs(this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}clearStencil(){const r=this.context,p=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const C=t.H();t.bL(C,0,this.width,this.height,0,0,1),t.K(C,C,[p.drawingBufferWidth,p.drawingBufferHeight,0]);const k={mainMatrix:C,tileMercatorCoords:[0,0,1,1],clippingPlane:[0,0,0,0],projectionTransition:0,fallbackMatrix:C};this.useProgram("clippingMask",null,!0).draw(r,p.TRIANGLES,Sr.disabled,this.stencilClearMode,hi.disabled,Wi.disabled,null,null,k,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(r,p,C){if(this.currentStencilSource===r.source||!r.isTileClipped()||!p||!p.length)return;this.currentStencilSource=r.source,this.nextStencilID+p.length>256&&this.clearStencil();const k=this.context;k.setColorMode(hi.disabled),k.setDepthMode(Sr.disabled);const j={};for(const Z of p)j[Z.key]=this.nextStencilID++;this._renderTileMasks(j,p,C,!0),this._renderTileMasks(j,p,C,!1),this._tileClippingMaskIDs=j}_renderTileMasks(r,p,C,k){const j=this.context,Z=j.gl,re=this.style.projection,ue=this.transform,ye=this.useProgram("clippingMask");for(const Me of p){const Re=r[Me.key],ze=this.style.map.terrain&&this.style.map.terrain.getTerrainData(Me),Je=re.getMeshFromTileID(this.context,Me.canonical,k,!0,"stencil"),ot=ue.getProjectionData({overscaledTileID:Me,applyGlobeMatrix:!0,applyTerrainMatrix:!0});ye.draw(j,Z.TRIANGLES,Sr.disabled,new Hi({func:Z.ALWAYS,mask:0},Re,255,Z.KEEP,Z.KEEP,Z.REPLACE),hi.disabled,C?Wi.disabled:Wi.backCCW,null,ze,ot,"$clipping",Je.vertexBuffer,Je.indexBuffer,Je.segments)}}_renderTilesDepthBuffer(){const r=this.context,p=r.gl,C=this.style.projection,k=this.transform,j=this.useProgram("depth"),Z=this.getDepthModeFor3D(),re=bt(k,{tileSize:k.tileSize});for(const ue of re){const ye=this.style.map.terrain&&this.style.map.terrain.getTerrainData(ue),Me=C.getMeshFromTileID(this.context,ue.canonical,!0,!0,"raster"),Re=k.getProjectionData({overscaledTileID:ue,applyGlobeMatrix:!0,applyTerrainMatrix:!0});j.draw(r,p.TRIANGLES,Z,Hi.disabled,hi.disabled,Wi.backCCW,null,ye,Re,"$clipping",Me.vertexBuffer,Me.indexBuffer,Me.segments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,p=this.context.gl;return new Hi({func:p.NOTEQUAL,mask:255},r,255,p.KEEP,p.KEEP,p.REPLACE)}stencilModeForClipping(r){const p=this.context.gl;return new Hi({func:p.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,p.KEEP,p.KEEP,p.REPLACE)}getStencilConfigForOverlapAndUpdateStencilID(r){const p=this.context.gl,C=r.sort((Z,re)=>re.overscaledZ-Z.overscaledZ),k=C[C.length-1].overscaledZ,j=C[0].overscaledZ-k+1;if(j>1){this.currentStencilSource=void 0,this.nextStencilID+j>256&&this.clearStencil();const Z={};for(let re=0;re<j;re++)Z[re+k]=new Hi({func:p.GEQUAL,mask:255},re+this.nextStencilID,255,p.KEEP,p.KEEP,p.REPLACE);return this.nextStencilID+=j,[Z,C]}return[{[k]:Hi.disabled},C]}stencilConfigForOverlapTwoPass(r){const p=this.context.gl,C=r.sort((Z,re)=>re.overscaledZ-Z.overscaledZ),k=C[C.length-1].overscaledZ,j=C[0].overscaledZ-k+1;if(this.clearStencil(),j>1){const Z={},re={};for(let ue=0;ue<j;ue++)Z[ue+k]=new Hi({func:p.GREATER,mask:255},j+1+ue,255,p.KEEP,p.KEEP,p.REPLACE),re[ue+k]=new Hi({func:p.GREATER,mask:255},1+ue,255,p.KEEP,p.KEEP,p.REPLACE);return this.nextStencilID=2*j+1,[Z,re,C]}return this.nextStencilID=3,[{[k]:new Hi({func:p.GREATER,mask:255},2,255,p.KEEP,p.KEEP,p.REPLACE)},{[k]:new Hi({func:p.GREATER,mask:255},1,255,p.KEEP,p.KEEP,p.REPLACE)},C]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new hi([r.CONSTANT_COLOR,r.ONE],new t.b4(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?hi.unblended:hi.alphaBlended}getDepthModeForSublayer(r,p,C){if(!this.opaquePassEnabledForLayer())return Sr.disabled;const k=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new Sr(C||this.context.gl.LEQUAL,p,[k,k])}getDepthModeFor3D(){return new Sr(this.context.gl.LEQUAL,Sr.ReadWrite,this.depthRangeFor3D)}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,p){var C,k;this.style=r,this.options=p,this.lineAtlas=r.lineAtlas,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(J.now()),this.imageManager.beginFrame();const j=this.style._order,Z=this.style.sourceCaches,re={},ue={},ye={},Me={isRenderingToTexture:!1,isRenderingGlobe:((C=r.projection)===null||C===void 0?void 0:C.transitionState)>0};for(const ze in Z){const Je=Z[ze];Je.used&&Je.prepare(this.context),re[ze]=Je.getVisibleCoordinates(!1),ue[ze]=re[ze].slice().reverse(),ye[ze]=Je.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let ze=0;ze<j.length;ze++)if(this.style._layers[j[ze]].is3D()){this.opaquePassCutoff=ze;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const ze of j){const Je=this.style._layers[ze];if(!Je.hasOffscreenPass()||Je.isHidden(this.transform.zoom))continue;const ot=ue[Je.source];(Je.type==="custom"||ot.length)&&this.renderLayer(this,Z[Je.source],Je,ot,Me)}if((k=this.style.projection)===null||k===void 0||k.updateGPUdependent({context:this.context,useProgram:ze=>this.useProgram(ze)}),this.context.viewport.set([0,0,this.width,this.height]),this.context.bindFramebuffer.set(null),this.context.clear({color:p.showOverdrawInspector?t.b4.black:t.b4.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(ze,Je){const ot=ze.context,Pt=ot.gl,Et=((rn,an,Mn)=>{const Rn=Math.cos(an.rollInRadians),Hn=Math.sin(an.rollInRadians),ei=es(an),jn=an.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}).projectionTransition;return{u_sky_color:rn.properties.get("sky-color"),u_horizon_color:rn.properties.get("horizon-color"),u_horizon:[(an.width/2-ei*Hn)*Mn,(an.height/2+ei*Rn)*Mn],u_horizon_normal:[-Hn,Rn],u_sky_horizon_blend:rn.properties.get("sky-horizon-blend")*an.height/2*Mn,u_sky_blend:jn}})(Je,ze.style.map.transform,ze.pixelRatio),Lt=new Sr(Pt.LEQUAL,Sr.ReadWrite,[0,1]),jt=Hi.disabled,Nt=ze.colorModeForRenderPass(),Bt=ze.useProgram("sky"),nn=em(ot,Je);Bt.draw(ot,Pt.TRIANGLES,Lt,jt,Nt,Wi.disabled,Et,null,void 0,"sky",nn.vertexBuffer,nn.indexBuffer,nn.segments)}(this,this.style.sky),this._showOverdrawInspector=p.showOverdrawInspector,this.depthRangeFor3D=[0,1-(r._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=j.length-1;this.currentLayer>=0;this.currentLayer--){const ze=this.style._layers[j[this.currentLayer]],Je=Z[ze.source],ot=re[ze.source];this._renderTileClippingMasks(ze,ot,!1),this.renderLayer(this,Je,ze,ot,Me)}this.renderPass="translucent";let Re=!1;for(this.currentLayer=0;this.currentLayer<j.length;this.currentLayer++){const ze=this.style._layers[j[this.currentLayer]],Je=Z[ze.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(ze,Me))continue;this.opaquePassEnabledForLayer()||Re||(Re=!0,Me.isRenderingGlobe&&!this.style.map.terrain&&this._renderTilesDepthBuffer());const ot=(ze.type==="symbol"?ye:ue)[ze.source];this._renderTileClippingMasks(ze,re[ze.source],!1),this.renderLayer(this,Je,ze,ot,Me)}if(Me.isRenderingGlobe&&function(ze,Je,ot){const Pt=ze.context,Et=Pt.gl,Lt=ze.useProgram("atmosphere"),jt=new Sr(Et.LEQUAL,Sr.ReadOnly,[0,1]),Nt=ze.transform,Bt=function(jn,Ri){const zi=jn.properties.get("position"),xi=[-zi.x,-zi.y,-zi.z],Gi=t.aq(new Float64Array(16));return jn.properties.get("anchor")==="map"&&(t.aX(Gi,Gi,Ri.rollInRadians),t.aY(Gi,Gi,-Ri.pitchInRadians),t.aX(Gi,Gi,Ri.bearingInRadians),t.aY(Gi,Gi,Ri.center.lat*Math.PI/180),t.bj(Gi,Gi,-Ri.center.lng*Math.PI/180)),t.bS(xi,xi,Gi),xi}(ot,ze.transform),nn=Nt.getProjectionData({overscaledTileID:null,applyGlobeMatrix:!0,applyTerrainMatrix:!0}),rn=Je.properties.get("atmosphere-blend")*nn.projectionTransition;if(rn===0)return;const an=el(Nt.worldSize,Nt.center.lat),Mn=Nt.inverseProjectionMatrix,Rn=new Float64Array(4);Rn[3]=1,t.al(Rn,Rn,Nt.modelViewProjectionMatrix),Rn[0]/=Rn[3],Rn[1]/=Rn[3],Rn[2]/=Rn[3],Rn[3]=1,t.al(Rn,Rn,Mn),Rn[0]/=Rn[3],Rn[1]/=Rn[3],Rn[2]/=Rn[3],Rn[3]=1;const Hn=((jn,Ri,zi,xi,Gi)=>({u_sun_pos:jn,u_atmosphere_blend:Ri,u_globe_position:zi,u_globe_radius:xi,u_inv_proj_matrix:Gi}))(Bt,rn,[Rn[0],Rn[1],Rn[2]],an,Mn),ei=em(Pt,Je);Lt.draw(Pt,Et.TRIANGLES,jt,Hi.disabled,hi.alphaBlended,Wi.disabled,Hn,null,null,"atmosphere",ei.vertexBuffer,ei.indexBuffer,ei.segments)}(this,this.style.sky,this.style.light),this.options.showTileBoundaries){const ze=function(Je,ot){let Pt=null;const Et=Object.values(Je._layers).flatMap(Bt=>Bt.source&&!Bt.isHidden(ot)?[Je.sourceCaches[Bt.source]]:[]),Lt=Et.filter(Bt=>Bt.getSource().type==="vector"),jt=Et.filter(Bt=>Bt.getSource().type!=="vector"),Nt=Bt=>{(!Pt||Pt.getSource().maxzoom<Bt.getSource().maxzoom)&&(Pt=Bt)};return Lt.forEach(Bt=>Nt(Bt)),Pt||jt.forEach(Bt=>Nt(Bt)),Pt}(this.style,this.transform.zoom);ze&&function(Je,ot,Pt){for(let Et=0;Et<Pt.length;Et++)Qp(Je,ot,Pt[Et])}(this,ze,ze.getVisibleCoordinates())}this.options.showPadding&&function(ze){const Je=ze.transform.padding;Yu(ze,ze.transform.height-(Je.top||0),3,tl),Yu(ze,Je.bottom||0,3,lf),Mh(ze,Je.left||0,3,cf),Mh(ze,ze.transform.width-(Je.right||0),3,uf);const ot=ze.transform.centerPoint;(function(Pt,Et,Lt,jt){pd(Pt,Et-1,Lt-10,2,20,jt),pd(Pt,Et-10,Lt-1,20,2,jt)})(ze,ot.x,ze.transform.height-ot.y,Xu)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(r){if(!this.style||!this.style.map||!this.style.map.terrain)return;const p=this.terrainFacilitator.matrix,C=this.transform.modelViewProjectionMatrix;let k=this.terrainFacilitator.dirty;k||(k=r?!t.bV(p,C):!t.bW(p,C)),k||(k=this.style.map.terrain.sourceCache.anyTilesAfterTime(this.terrainFacilitator.renderTime)),k&&(t.bX(p,C),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(j,Z){const re=j.context,ue=re.gl,ye=j.transform,Me=hi.unblended,Re=new Sr(ue.LEQUAL,Sr.ReadWrite,[0,1]),ze=Z.sourceCache.getRenderableTiles(),Je=j.useProgram("terrainDepth");re.bindFramebuffer.set(Z.getFramebuffer("depth").framebuffer),re.viewport.set([0,0,j.width/devicePixelRatio,j.height/devicePixelRatio]),re.clear({color:t.b4.transparent,depth:1});for(const ot of ze){const Pt=Z.getTerrainMesh(ot.tileID),Et=Z.getTerrainData(ot.tileID),Lt=ye.getProjectionData({overscaledTileID:ot.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0}),jt={u_ele_delta:Z.getMeshFrameDelta(ye.zoom)};Je.draw(re,ue.TRIANGLES,Re,Hi.disabled,Me,Wi.backCCW,jt,Et,Lt,"terrain",Pt.vertexBuffer,Pt.indexBuffer,Pt.segments)}re.bindFramebuffer.set(null),re.viewport.set([0,0,j.width,j.height])}(this,this.style.map.terrain),function(j,Z){const re=j.context,ue=re.gl,ye=j.transform,Me=hi.unblended,Re=new Sr(ue.LEQUAL,Sr.ReadWrite,[0,1]),ze=Z.getCoordsTexture(),Je=Z.sourceCache.getRenderableTiles(),ot=j.useProgram("terrainCoords");re.bindFramebuffer.set(Z.getFramebuffer("coords").framebuffer),re.viewport.set([0,0,j.width/devicePixelRatio,j.height/devicePixelRatio]),re.clear({color:t.b4.transparent,depth:1}),Z.coordsIndex=[];for(const Pt of Je){const Et=Z.getTerrainMesh(Pt.tileID),Lt=Z.getTerrainData(Pt.tileID);re.activeTexture.set(ue.TEXTURE0),ue.bindTexture(ue.TEXTURE_2D,ze.texture);const jt={u_terrain_coords_id:(255-Z.coordsIndex.length)/255,u_texture:0,u_ele_delta:Z.getMeshFrameDelta(ye.zoom)},Nt=ye.getProjectionData({overscaledTileID:Pt.tileID,applyTerrainMatrix:!1,applyGlobeMatrix:!0});ot.draw(re,ue.TRIANGLES,Re,Hi.disabled,Me,Wi.backCCW,jt,Lt,Nt,"terrain",Et.vertexBuffer,Et.indexBuffer,Et.segments),Z.coordsIndex.push(Pt.tileID.key)}re.bindFramebuffer.set(null),re.viewport.set([0,0,j.width,j.height])}(this,this.style.map.terrain))}renderLayer(r,p,C,k,j){C.isHidden(this.transform.zoom)||(C.type==="background"||C.type==="custom"||(k||[]).length)&&(this.id=C.id,t.bY(C)?function(Z,re,ue,ye,Me,Re){if(Z.renderPass!=="translucent")return;const{isRenderingToTexture:ze}=Re,Je=Hi.disabled,ot=Z.colorModeForRenderPass();(ue._unevaluatedLayout.hasValue("text-variable-anchor")||ue._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(Pt,Et,Lt,jt,Nt,Bt,nn,rn,an){const Mn=Et.transform,Rn=Et.style.map.terrain,Hn=Nt==="map",ei=Bt==="map";for(const jn of Pt){const Ri=jt.getTile(jn),zi=Ri.getBucket(Lt);if(!zi||!zi.text||!zi.text.segments.get().length)continue;const xi=t.ah(zi.textSizeData,Mn.zoom),Gi=t.at(Ri,1,Et.transform.zoom),Hr=kn(Hn,Et.transform,Gi),ua=Lt.layout.get("icon-text-fit")!=="none"&&zi.hasIconData();{const Ma=Math.pow(2,Mn.zoom-Ri.tileID.overscaledZ),La=Rn?(Ha,Ia)=>Rn.getElevation(jn,Ha,Ia):null;Kp(zi,Hn,ei,an,Mn,Hr,Ma,xi,ua,t.au(Mn,Ri,nn,rn),jn.toUnwrapped(),La)}}}(ye,Z,ue,re,ue.layout.get("text-rotation-alignment"),ue.layout.get("text-pitch-alignment"),ue.paint.get("text-translate"),ue.paint.get("text-translate-anchor"),Me),ue.paint.get("icon-opacity").constantOr(1)!==0&&dd(Z,re,ue,ye,!1,ue.paint.get("icon-translate"),ue.paint.get("icon-translate-anchor"),ue.layout.get("icon-rotation-alignment"),ue.layout.get("icon-pitch-alignment"),ue.layout.get("icon-keep-upright"),Je,ot,ze),ue.paint.get("text-opacity").constantOr(1)!==0&&dd(Z,re,ue,ye,!0,ue.paint.get("text-translate"),ue.paint.get("text-translate-anchor"),ue.layout.get("text-rotation-alignment"),ue.layout.get("text-pitch-alignment"),ue.layout.get("text-keep-upright"),Je,ot,ze),re.map.showCollisionBoxes&&(af(Z,re,ue,ye,!0),af(Z,re,ue,ye,!1))}(r,p,C,k,this.style.placement.variableOffsets,j):t.bZ(C)?function(Z,re,ue,ye,Me){if(Z.renderPass!=="translucent")return;const{isRenderingToTexture:Re}=Me,ze=ue.paint.get("circle-opacity"),Je=ue.paint.get("circle-stroke-width"),ot=ue.paint.get("circle-stroke-opacity"),Pt=!ue.layout.get("circle-sort-key").isConstant();if(ze.constantOr(1)===0&&(Je.constantOr(1)===0||ot.constantOr(1)===0))return;const Et=Z.context,Lt=Et.gl,jt=Z.transform,Nt=Z.getDepthModeForSublayer(0,Sr.ReadOnly),Bt=Hi.disabled,nn=Z.colorModeForRenderPass(),rn=[],an=jt.getCircleRadiusCorrection();for(let Mn=0;Mn<ye.length;Mn++){const Rn=ye[Mn],Hn=re.getTile(Rn),ei=Hn.getBucket(ue);if(!ei)continue;const jn=ue.paint.get("circle-translate"),Ri=ue.paint.get("circle-translate-anchor"),zi=t.au(jt,Hn,jn,Ri),xi=ei.programConfigurations.get(ue.id),Gi=Z.useProgram("circle",xi),Hr=ei.layoutVertexBuffer,ua=ei.indexBuffer,Ma=Z.style.map.terrain&&Z.style.map.terrain.getTerrainData(Rn),La={programConfiguration:xi,program:Gi,layoutVertexBuffer:Hr,indexBuffer:ua,uniformValues:Yl(Z,Hn,ue,zi,an),terrainData:Ma,projectionData:jt.getProjectionData({overscaledTileID:Rn,applyGlobeMatrix:!Re,applyTerrainMatrix:!0})};if(Pt){const Ha=ei.segments.get();for(const Ia of Ha)rn.push({segments:new t.aD([Ia]),sortKey:Ia.sortKey,state:La})}else rn.push({segments:ei.segments,sortKey:0,state:La})}Pt&&rn.sort((Mn,Rn)=>Mn.sortKey-Rn.sortKey);for(const Mn of rn){const{programConfiguration:Rn,program:Hn,layoutVertexBuffer:ei,indexBuffer:jn,uniformValues:Ri,terrainData:zi,projectionData:xi}=Mn.state;Hn.draw(Et,Lt.TRIANGLES,Nt,Bt,nn,Wi.backCCW,Ri,zi,xi,ue.id,ei,jn,Mn.segments,ue.paint,Z.transform.zoom,Rn)}}(r,p,C,k,j):t.b_(C)?function(Z,re,ue,ye,Me){if(ue.paint.get("heatmap-opacity")===0)return;const Re=Z.context,{isRenderingToTexture:ze,isRenderingGlobe:Je}=Me;if(Z.style.map.terrain){for(const ot of ye){const Pt=re.getTile(ot);re.hasRenderableParent(ot)||(Z.renderPass==="offscreen"?np(Z,Pt,ue,ot,Je):Z.renderPass==="translucent"&&fd(Z,ue,ot,ze,Je))}Re.viewport.set([0,0,Z.width,Z.height])}else Z.renderPass==="offscreen"?function(ot,Pt,Et,Lt){const jt=ot.context,Nt=jt.gl,Bt=ot.transform,nn=Hi.disabled,rn=new hi([Nt.ONE,Nt.ONE],t.b4.transparent,[!0,!0,!0,!0]);(function(an,Mn,Rn){const Hn=an.gl;an.activeTexture.set(Hn.TEXTURE1),an.viewport.set([0,0,Mn.width/4,Mn.height/4]);let ei=Rn.heatmapFbos.get(t.bP);ei?(Hn.bindTexture(Hn.TEXTURE_2D,ei.colorAttachment.get()),an.bindFramebuffer.set(ei.framebuffer)):(ei=of(an,Mn.width/4,Mn.height/4),Rn.heatmapFbos.set(t.bP,ei))})(jt,ot,Et),jt.clear({color:t.b4.transparent});for(let an=0;an<Lt.length;an++){const Mn=Lt[an];if(Pt.hasRenderableParent(Mn))continue;const Rn=Pt.getTile(Mn),Hn=Rn.getBucket(Et);if(!Hn)continue;const ei=Hn.programConfigurations.get(Et.id),jn=ot.useProgram("heatmap",ei),Ri=Bt.getProjectionData({overscaledTileID:Mn,applyGlobeMatrix:!0,applyTerrainMatrix:!1}),zi=Bt.getCircleRadiusCorrection();jn.draw(jt,Nt.TRIANGLES,Sr.disabled,nn,rn,Wi.backCCW,Xf(Rn,Bt.zoom,Et.paint.get("heatmap-intensity"),zi),null,Ri,Et.id,Hn.layoutVertexBuffer,Hn.indexBuffer,Hn.segments,Et.paint,Bt.zoom,ei)}jt.viewport.set([0,0,ot.width,ot.height])}(Z,re,ue,ye):Z.renderPass==="translucent"&&function(ot,Pt){const Et=ot.context,Lt=Et.gl;Et.setColorMode(ot.colorModeForRenderPass());const jt=Pt.heatmapFbos.get(t.bP);jt&&(Et.activeTexture.set(Lt.TEXTURE0),Lt.bindTexture(Lt.TEXTURE_2D,jt.colorAttachment.get()),Et.activeTexture.set(Lt.TEXTURE1),ip(Et,Pt).bind(Lt.LINEAR,Lt.CLAMP_TO_EDGE),ot.useProgram("heatmapTexture").draw(Et,Lt.TRIANGLES,Sr.disabled,Hi.disabled,ot.colorModeForRenderPass(),Wi.disabled,Rl(ot,Pt,0,1),null,null,Pt.id,ot.viewportBuffer,ot.quadTriangleIndexBuffer,ot.viewportSegments,Pt.paint,ot.transform.zoom))}(Z,ue)}(r,p,C,k,j):t.b$(C)?function(Z,re,ue,ye,Me){if(Z.renderPass!=="translucent")return;const{isRenderingToTexture:Re}=Me,ze=ue.paint.get("line-opacity"),Je=ue.paint.get("line-width");if(ze.constantOr(1)===0||Je.constantOr(1)===0)return;const ot=Z.getDepthModeForSublayer(0,Sr.ReadOnly),Pt=Z.colorModeForRenderPass(),Et=ue.paint.get("line-dasharray"),Lt=ue.paint.get("line-pattern"),jt=Lt.constantOr(1),Nt=ue.paint.get("line-gradient"),Bt=ue.getCrossfadeParameters(),nn=jt?"linePattern":Et?"lineSDF":Nt?"lineGradient":"line",rn=Z.context,an=rn.gl,Mn=Z.transform;let Rn=!0;for(const Hn of ye){const ei=re.getTile(Hn);if(jt&&!ei.patternsLoaded())continue;const jn=ei.getBucket(ue);if(!jn)continue;const Ri=jn.programConfigurations.get(ue.id),zi=Z.context.program.get(),xi=Z.useProgram(nn,Ri),Gi=Rn||xi.program!==zi,Hr=Z.style.map.terrain&&Z.style.map.terrain.getTerrainData(Hn),ua=Lt.constantOr(null);if(ua&&ei.imageAtlas){const Pa=ei.imageAtlas,Wr=Pa.patternPositions[ua.to.toString()],ro=Pa.patternPositions[ua.from.toString()];Wr&&ro&&Ri.setConstantPatternPositions(Wr,ro)}const Ma=Mn.getProjectionData({overscaledTileID:Hn,applyGlobeMatrix:!Re,applyTerrainMatrix:!0}),La=Mn.getPixelScale(),Ha=jt?du(Z,ei,ue,La,Bt):Et?or(Z,ei,ue,La,Et,Bt):Nt?vh(Z,ei,ue,La,jn.lineClipsArray.length):lr(Z,ei,ue,La);if(jt)rn.activeTexture.set(an.TEXTURE0),ei.imageAtlasTexture.bind(an.LINEAR,an.CLAMP_TO_EDGE),Ri.updatePaintBuffers(Bt);else if(Et&&(Gi||Z.lineAtlas.dirty))rn.activeTexture.set(an.TEXTURE0),Z.lineAtlas.bind(rn);else if(Nt){const Pa=jn.gradients[ue.id];let Wr=Pa.texture;if(ue.gradientVersion!==Pa.version){let ro=256;if(ue.stepInterpolant){const Is=re.getSource().maxzoom,gs=Hn.canonical.z===Is?Math.ceil(1<<Z.transform.maxZoom-Hn.canonical.z):1;ro=t.ab(t.bQ(jn.maxLineLength/t.X*1024*gs),256,rn.maxTextureSize)}Pa.gradient=t.bR({expression:ue.gradientExpression(),evaluationKey:"lineProgress",resolution:ro,image:Pa.gradient||void 0,clips:jn.lineClipsArray}),Pa.texture?Pa.texture.update(Pa.gradient):Pa.texture=new qe(rn,Pa.gradient,an.RGBA),Pa.version=ue.gradientVersion,Wr=Pa.texture}rn.activeTexture.set(an.TEXTURE0),Wr.bind(ue.stepInterpolant?an.NEAREST:an.LINEAR,an.CLAMP_TO_EDGE)}let Ia;if(Re){const[Pa]=Z.getStencilConfigForOverlapAndUpdateStencilID(ye);Ia=Pa[Hn.overscaledZ]}else Ia=Z.stencilModeForClipping(Hn);xi.draw(rn,an.TRIANGLES,ot,Ia,Pt,Wi.disabled,Ha,Hr,Ma,ue.id,jn.layoutVertexBuffer,jn.indexBuffer,jn.segments,ue.paint,Z.transform.zoom,Ri,jn.layoutVertexBuffer2),Rn=!1}}(r,p,C,k,j):t.c0(C)?function(Z,re,ue,ye,Me){const Re=ue.paint.get("fill-color"),ze=ue.paint.get("fill-opacity");if(ze.constantOr(1)===0)return;const{isRenderingToTexture:Je}=Me,ot=Z.colorModeForRenderPass(),Pt=ue.paint.get("fill-pattern"),Et=Z.opaquePassEnabledForLayer()&&!Pt.constantOr(1)&&Re.constantOr(t.b4.transparent).a===1&&ze.constantOr(0)===1?"opaque":"translucent";if(Z.renderPass===Et){const Lt=Z.getDepthModeForSublayer(1,Z.renderPass==="opaque"?Sr.ReadWrite:Sr.ReadOnly);gu(Z,re,ue,ye,Lt,ot,!1,Je)}if(Z.renderPass==="translucent"&&ue.paint.get("fill-antialias")){const Lt=Z.getDepthModeForSublayer(ue.getPaintProperty("fill-outline-color")?2:0,Sr.ReadOnly);gu(Z,re,ue,ye,Lt,ot,!0,Je)}}(r,p,C,k,j):t.c1(C)?function(Z,re,ue,ye,Me){const Re=ue.paint.get("fill-extrusion-opacity");if(Re===0)return;const{isRenderingToTexture:ze}=Me;if(Z.renderPass==="translucent"){const Je=new Sr(Z.context.gl.LEQUAL,Sr.ReadWrite,Z.depthRangeFor3D);if(Re!==1||ue.paint.get("fill-extrusion-pattern").constantOr(1))_u(Z,re,ue,ye,Je,Hi.disabled,hi.disabled,ze),_u(Z,re,ue,ye,Je,Z.stencilModeFor3D(),Z.colorModeForRenderPass(),ze);else{const ot=Z.colorModeForRenderPass();_u(Z,re,ue,ye,Je,Hi.disabled,ot,ze)}}}(r,p,C,k,j):t.c2(C)?function(Z,re,ue,ye,Me){if(Z.renderPass!=="offscreen"&&Z.renderPass!=="translucent")return;const{isRenderingToTexture:Re}=Me,ze=Z.context,Je=Z.style.projection.useSubdivision,ot=Z.getDepthModeForSublayer(0,Sr.ReadOnly),Pt=Z.colorModeForRenderPass();if(Z.renderPass==="offscreen")(function(Et,Lt,jt,Nt,Bt,nn,rn){const an=Et.context,Mn=an.gl;for(const Rn of jt){const Hn=Lt.getTile(Rn),ei=Hn.dem;if(!ei||!ei.data||!Hn.needsHillshadePrepare)continue;const jn=ei.dim,Ri=ei.stride,zi=ei.getPixels();if(an.activeTexture.set(Mn.TEXTURE1),an.pixelStoreUnpackPremultiplyAlpha.set(!1),Hn.demTexture=Hn.demTexture||Et.getTileTexture(Ri),Hn.demTexture){const Gi=Hn.demTexture;Gi.update(zi,{premultiply:!1}),Gi.bind(Mn.NEAREST,Mn.CLAMP_TO_EDGE)}else Hn.demTexture=new qe(an,zi,Mn.RGBA,{premultiply:!1}),Hn.demTexture.bind(Mn.NEAREST,Mn.CLAMP_TO_EDGE);an.activeTexture.set(Mn.TEXTURE0);let xi=Hn.fbo;if(!xi){const Gi=new qe(an,{width:jn,height:jn,data:null},Mn.RGBA);Gi.bind(Mn.LINEAR,Mn.CLAMP_TO_EDGE),xi=Hn.fbo=an.createFramebuffer(jn,jn,!0,!1),xi.colorAttachment.set(Gi.texture)}an.bindFramebuffer.set(xi.framebuffer),an.viewport.set([0,0,jn,jn]),Et.useProgram("hillshadePrepare").draw(an,Mn.TRIANGLES,Bt,nn,rn,Wi.disabled,Zi(Hn.tileID,ei),null,null,Nt.id,Et.rasterBoundsBuffer,Et.quadTriangleIndexBuffer,Et.rasterBoundsSegments),Hn.needsHillshadePrepare=!1}})(Z,re,ye,ue,ot,Hi.disabled,Pt),ze.viewport.set([0,0,Z.width,Z.height]);else if(Z.renderPass==="translucent")if(Je){const[Et,Lt,jt]=Z.stencilConfigForOverlapTwoPass(ye);rp(Z,re,ue,jt,Et,ot,Pt,!1,Re),rp(Z,re,ue,jt,Lt,ot,Pt,!0,Re)}else{const[Et,Lt]=Z.getStencilConfigForOverlapAndUpdateStencilID(ye);rp(Z,re,ue,Lt,Et,ot,Pt,!1,Re)}}(r,p,C,k,j):t.c3(C)?function(Z,re,ue,ye,Me){if(Z.renderPass!=="translucent"||ue.paint.get("raster-opacity")===0||!ye.length)return;const{isRenderingToTexture:Re}=Me,ze=re.getSource(),Je=Z.style.projection.useSubdivision;if(ze instanceof ii)ns(Z,re,ue,ye,null,!1,!1,ze.tileCoords,ze.flippedWindingOrder,Re);else if(Je){const[ot,Pt,Et]=Z.stencilConfigForOverlapTwoPass(ye);ns(Z,re,ue,Et,ot,!1,!0,Ro,!1,Re),ns(Z,re,ue,Et,Pt,!0,!0,Ro,!1,Re)}else{const[ot,Pt]=Z.getStencilConfigForOverlapAndUpdateStencilID(ye);ns(Z,re,ue,Pt,ot,!1,!0,Ro,!1,Re)}}(r,p,C,k,j):t.c4(C)?function(Z,re,ue,ye,Me){const Re=ue.paint.get("background-color"),ze=ue.paint.get("background-opacity");if(ze===0)return;const{isRenderingToTexture:Je}=Me,ot=Z.context,Pt=ot.gl,Et=Z.style.projection,Lt=Z.transform,jt=Lt.tileSize,Nt=ue.paint.get("background-pattern");if(Z.isPatternMissing(Nt))return;const Bt=!Nt&&Re.a===1&&ze===1&&Z.opaquePassEnabledForLayer()?"opaque":"translucent";if(Z.renderPass!==Bt)return;const nn=Hi.disabled,rn=Z.getDepthModeForSublayer(0,Bt==="opaque"?Sr.ReadWrite:Sr.ReadOnly),an=Z.colorModeForRenderPass(),Mn=Z.useProgram(Nt?"backgroundPattern":"background"),Rn=ye||bt(Lt,{tileSize:jt,terrain:Z.style.map.terrain});Nt&&(ot.activeTexture.set(Pt.TEXTURE0),Z.imageManager.bind(Z.context));const Hn=ue.getCrossfadeParameters();for(const ei of Rn){const jn=Lt.getProjectionData({overscaledTileID:ei,applyGlobeMatrix:!Je,applyTerrainMatrix:!0}),Ri=Nt?mi(ze,Z,Nt,{tileID:ei,tileSize:jt},Hn):sd(ze,Re),zi=Z.style.map.terrain&&Z.style.map.terrain.getTerrainData(ei),xi=Et.getMeshFromTileID(ot,ei.canonical,!1,!0,"raster");Mn.draw(ot,Pt.TRIANGLES,rn,nn,an,Wi.backCCW,Ri,zi,jn,ue.id,xi.vertexBuffer,xi.indexBuffer,xi.segments)}}(r,0,C,k,j):t.c5(C)&&function(Z,re,ue,ye){const{isRenderingGlobe:Me}=ye,Re=Z.context,ze=ue.implementation,Je=Z.style.projection,ot=Z.transform,Pt=ot.getProjectionDataForCustomLayer(Me),Et={farZ:ot.farZ,nearZ:ot.nearZ,fov:ot.fov*Math.PI/180,modelViewProjectionMatrix:ot.modelViewProjectionMatrix,projectionMatrix:ot.projectionMatrix,shaderData:{variantName:Je.shaderVariantName,vertexShaderPrelude:`const float PI = 3.141592653589793;
uniform mat4 u_projection_matrix;
${Je.shaderPreludeCode.vertexSource}`,define:Je.shaderDefine},defaultProjectionData:Pt},Lt=ze.renderingMode?ze.renderingMode:"2d";if(Z.renderPass==="offscreen"){const jt=ze.prerender;jt&&(Z.setCustomLayerDefaults(),Re.setColorMode(Z.colorModeForRenderPass()),jt.call(ze,Re.gl,Et),Re.setDirty(),Z.setBaseState())}else if(Z.renderPass==="translucent"){Z.setCustomLayerDefaults(),Re.setColorMode(Z.colorModeForRenderPass()),Re.setStencilMode(Hi.disabled);const jt=Lt==="3d"?Z.getDepthModeFor3D():Z.getDepthModeForSublayer(0,Sr.ReadOnly);Re.setDepthMode(jt),ze.render(Re.gl,Et),Re.setDirty(),Z.setBaseState(),Re.bindFramebuffer.set(null)}}(r,0,C,j))}saveTileTexture(r){const p=this._tileTextures[r.size[0]];p?p.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const p=this._tileTextures[r];return p&&p.length>0?p.pop():null}isPatternMissing(r){if(!r)return!1;if(!r.from||!r.to)return!0;const p=this.imageManager.getPattern(r.from.toString()),C=this.imageManager.getPattern(r.to.toString());return!p||!C}useProgram(r,p,C=!1){this.cache=this.cache||{};const k=!!this.style.map.terrain,j=this.style.projection,Z=r+(p?p.cacheKey:"")+`/${C?qd:j.shaderVariantName}`+(this._showOverdrawInspector?"/overdraw":"")+(k?"/terrain":"");return this.cache[Z]||(this.cache[Z]=new Wf(this.context,ks[r],p,Oc[r],this._showOverdrawInspector,k,C?ks.projectionMercator:j.shaderPreludeCode,C?Wl:j.shaderDefine)),this.cache[Z]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new qe(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:r,drawingBufferHeight:p}=this.context.gl;return this.width!==r||this.height!==p}}function Ju(B,r){let p,C=!1,k=null,j=null;const Z=()=>{k=null,C&&(B.apply(j,p),k=setTimeout(Z,r),C=!1)};return(...re)=>(C=!0,j=this,p=re,k||Z(),k)}class tm{constructor(r){this._getCurrentHash=()=>{const p=window.location.hash.replace("#","");if(this._hashName){let C;return p.split("&").map(k=>k.split("=")).forEach(k=>{k[0]===this._hashName&&(C=k)}),(C&&C[1]||"").split("/")}return p.split("/")},this._onHashChange=()=>{const p=this._getCurrentHash();if(!this._isValidHash(p))return!1;const C=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(p[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+p[2],+p[1]],zoom:+p[0],bearing:C,pitch:+(p[4]||0)}),!0},this._updateHashUnthrottled=()=>{const p=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,p)},this._removeHash=()=>{const p=this._getCurrentHash();if(p.length===0)return;const C=p.join("/");let k=C;k.split("&").length>0&&(k=k.split("&")[0]),this._hashName&&(k=`${this._hashName}=${C}`);let j=window.location.hash.replace(k,"");j.startsWith("#&")?j=j.slice(0,1)+j.slice(2):j==="#"&&(j="");let Z=window.location.href.replace(/(#.+)?$/,j);Z=Z.replace("&&","&"),window.history.replaceState(window.history.state,null,Z)},this._updateHash=Ju(this._updateHashUnthrottled,300),this._hashName=r&&encodeURIComponent(r)}addTo(r){return this._map=r,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(r){const p=this._map.getCenter(),C=Math.round(100*this._map.getZoom())/100,k=Math.ceil((C*Math.LN2+Math.log(512/360/.5))/Math.LN10),j=Math.pow(10,k),Z=Math.round(p.lng*j)/j,re=Math.round(p.lat*j)/j,ue=this._map.getBearing(),ye=this._map.getPitch();let Me="";if(Me+=r?`/${Z}/${re}/${C}`:`${C}/${re}/${Z}`,(ue||ye)&&(Me+="/"+Math.round(10*ue)/10),ye&&(Me+=`/${Math.round(ye)}`),this._hashName){const Re=this._hashName;let ze=!1;const Je=window.location.hash.slice(1).split("&").map(ot=>{const Pt=ot.split("=")[0];return Pt===Re?(ze=!0,`${Pt}=${Me}`):ot}).filter(ot=>ot);return ze||Je.push(`${Re}=${Me}`),`#${Je.join("&")}`}return`#${Me}`}_isValidHash(r){if(r.length<3||r.some(isNaN))return!1;try{new t.N(+r[2],+r[1])}catch{return!1}const p=+r[0],C=+(r[3]||0),k=+(r[4]||0);return p>=this._map.getMinZoom()&&p<=this._map.getMaxZoom()&&C>=0&&C<=180&&k>=this._map.getMinPitch()&&k<=this._map.getMaxPitch()}}const md={linearity:.3,easing:t.c6(0,0,.3,1)},qm=t.e({deceleration:2500,maxSpeed:1400},md),gd=t.e({deceleration:20,maxSpeed:1400},md),ap=t.e({deceleration:1e3,maxSpeed:360},md),sp=t.e({deceleration:1e3,maxSpeed:90},md),Ih=t.e({deceleration:1e3,maxSpeed:360},md);class _d{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:J.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,p=J.now();for(;r.length>0&&p-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const p={zoom:0,bearing:0,pitch:0,roll:0,pan:new t.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:j}of this._inertiaBuffer)p.zoom+=j.zoomDelta||0,p.bearing+=j.bearingDelta||0,p.pitch+=j.pitchDelta||0,p.roll+=j.rollDelta||0,j.panDelta&&p.pan._add(j.panDelta),j.around&&(p.around=j.around),j.pinchAround&&(p.pinchAround=j.pinchAround);const C=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,k={};if(p.pan.mag()){const j=Lo(p.pan.mag(),C,t.e({},qm,r||{})),Z=p.pan.mult(j.amount/p.pan.mag()),re=this._map.cameraHelper.handlePanInertia(Z,this._map.transform);k.center=re.easingCenter,k.offset=re.easingOffset,Ph(k,j)}if(p.zoom){const j=Lo(p.zoom,C,gd);k.zoom=this._map.transform.zoom+j.amount,Ph(k,j)}if(p.bearing){const j=Lo(p.bearing,C,ap);k.bearing=this._map.transform.bearing+t.ab(j.amount,-179,179),Ph(k,j)}if(p.pitch){const j=Lo(p.pitch,C,sp);k.pitch=this._map.transform.pitch+j.amount,Ph(k,j)}if(p.roll){const j=Lo(p.roll,C,Ih);k.roll=this._map.transform.roll+t.ab(j.amount,-179,179),Ph(k,j)}if(k.zoom||k.bearing){const j=p.pinchAround===void 0?p.around:p.pinchAround;k.around=j?this._map.unproject(j):this._map.getCenter()}return this.clear(),t.e(k,{noMoveStart:!0})}}function Ph(B,r){(!B.duration||B.duration<r.duration)&&(B.duration=r.duration,B.easing=r.easing)}function Lo(B,r,p){const{maxSpeed:C,linearity:k,deceleration:j}=p,Z=t.ab(B*k/(r/1e3),-C,C),re=Math.abs(Z)/(j*k);return{easing:p.easing,duration:1e3*re,amount:Z*(re/2)}}class ms extends t.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,p,C,k={}){const j=Q.mousePos(p.getCanvas(),C),Z=p.unproject(j);super(r,t.e({point:j,lngLat:Z,originalEvent:C},k)),this._defaultPrevented=!1,this.target=p}}class zo extends t.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,p,C){const k=r==="touchend"?C.changedTouches:C.touches,j=Q.touchPos(p.getCanvasContainer(),k),Z=j.map(ue=>p.unproject(ue)),re=j.reduce((ue,ye,Me,Re)=>ue.add(ye.div(Re.length)),new t.P(0,0));super(r,{points:j,point:re,lngLats:Z,lngLat:p.unproject(re),originalEvent:C}),this._defaultPrevented=!1}}class Ol extends t.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,p,C){super(r,{originalEvent:C}),this._defaultPrevented=!1}}class ml{constructor(r,p){this._map=r,this._clickTolerance=p.clickTolerance}reset(){delete this._mousedownPos}wheel(r){return this._firePreventable(new Ol(r.type,this._map,r))}mousedown(r,p){return this._mousedownPos=p,this._firePreventable(new ms(r.type,this._map,r))}mouseup(r){this._map.fire(new ms(r.type,this._map,r))}click(r,p){this._mousedownPos&&this._mousedownPos.dist(p)>=this._clickTolerance||this._map.fire(new ms(r.type,this._map,r))}dblclick(r){return this._firePreventable(new ms(r.type,this._map,r))}mouseover(r){this._map.fire(new ms(r.type,this._map,r))}mouseout(r){this._map.fire(new ms(r.type,this._map,r))}touchstart(r){return this._firePreventable(new zo(r.type,this._map,r))}touchmove(r){this._map.fire(new zo(r.type,this._map,r))}touchend(r){this._map.fire(new zo(r.type,this._map,r))}touchcancel(r){this._map.fire(new zo(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class nm{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(r){this._map.fire(new ms(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ms("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._ignoreContextMenu||this._map.fire(new ms(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Vc{constructor(r){this._map=r}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(r){return this.transform.screenPointToLocation(t.P.convert(r),this._map.terrain)}}class hf{constructor(r,p){this._map=r,this._tr=new Vc(r),this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=p.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,p){this.isEnabled()&&r.shiftKey&&r.button===0&&(Q.disableDrag(),this._startPos=this._lastPos=p,this._active=!0)}mousemoveWindow(r,p){if(!this._active)return;const C=p;if(this._lastPos.equals(C)||!this._box&&C.dist(this._startPos)<this._clickTolerance)return;const k=this._startPos;this._lastPos=C,this._box||(this._box=Q.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",r));const j=Math.min(k.x,C.x),Z=Math.max(k.x,C.x),re=Math.min(k.y,C.y),ue=Math.max(k.y,C.y);Q.setTransform(this._box,`translate(${j}px,${re}px)`),this._box.style.width=Z-j+"px",this._box.style.height=ue-re+"px"}mouseupWindow(r,p){if(!this._active||r.button!==0)return;const C=this._startPos,k=p;if(this.reset(),Q.suppressClick(),C.x!==k.x||C.y!==k.y)return this._map.fire(new t.k("boxzoomend",{originalEvent:r})),{cameraAnimation:j=>j.fitScreenCoordinates(C,k,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",r)}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(Q.remove(this._box),this._box=null),Q.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(r,p){return this._map.fire(new t.k(r,{originalEvent:p}))}}function op(B,r){if(B.length!==r.length)throw new Error(`The number of touches and points are not equal - touches ${B.length}, points ${r.length}`);const p={};for(let C=0;C<B.length;C++)p[B[C].identifier]=r[C];return p}class lp{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(r,p,C){(this.centroid||C.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=r.timeStamp),C.length===this.numTouches&&(this.centroid=function(k){const j=new t.P(0,0);for(const Z of k)j._add(Z);return j.div(k.length)}(p),this.touches=op(C,p)))}touchmove(r,p,C){if(this.aborted||!this.centroid)return;const k=op(C,p);for(const j in this.touches){const Z=k[j];(!Z||Z.dist(this.touches[j])>30)&&(this.aborted=!0)}}touchend(r,p,C){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),C.length===0){const k=!this.aborted&&this.centroid;if(this.reset(),k)return k}}}class Nc{constructor(r){this.singleTap=new lp(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(r,p,C){this.singleTap.touchstart(r,p,C)}touchmove(r,p,C){this.singleTap.touchmove(r,p,C)}touchend(r,p,C){const k=this.singleTap.touchend(r,p,C);if(k){const j=r.timeStamp-this.lastTime<500,Z=!this.lastTap||this.lastTap.dist(k)<30;if(j&&Z||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=k,this.count===this.numTaps)return this.reset(),k}}}class jc{constructor(r){this._tr=new Vc(r),this._zoomIn=new Nc({numTouches:1,numTaps:2}),this._zoomOut=new Nc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,p,C){this._zoomIn.touchstart(r,p,C),this._zoomOut.touchstart(r,p,C)}touchmove(r,p,C){this._zoomIn.touchmove(r,p,C),this._zoomOut.touchmove(r,p,C)}touchend(r,p,C){const k=this._zoomIn.touchend(r,p,C),j=this._zoomOut.touchend(r,p,C),Z=this._tr;return k?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:re=>re.easeTo({duration:300,zoom:Z.zoom+1,around:Z.unproject(k)},{originalEvent:r})}):j?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:re=>re.easeTo({duration:300,zoom:Z.zoom-1,around:Z.unproject(j)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Yi{constructor(r){this._enabled=!!r.enable,this._moveStateManager=r.moveStateManager,this._clickTolerance=r.clickTolerance||1,this._moveFunction=r.move,this._activateOnStart=!!r.activateOnStart,r.assignEvents(this),this.reset()}reset(r){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(r)}_move(...r){const p=this._moveFunction(...r);if(p.bearingDelta||p.pitchDelta||p.rollDelta||p.around||p.panDelta)return this._active=!0,p}dragStart(r,p){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(r)&&(this._moveStateManager.startMove(r),this._lastPoint=Array.isArray(p)?p[0]:p,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(r,p){if(!this.isEnabled())return;const C=this._lastPoint;if(!C)return;if(r.preventDefault(),!this._moveStateManager.isValidMoveEvent(r))return void this.reset(r);const k=Array.isArray(p)?p[0]:p;return!this._moved&&k.dist(C)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=k,this._move(C,k))}dragEnd(r){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(r)&&(this._moved&&Q.suppressClick(),this.reset(r))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const yd={0:1,2:2};class Ah{constructor(r){this._correctEvent=r.checkCorrectEvent}startMove(r){const p=Q.mouseButton(r);this._eventButton=p}endMove(r){delete this._eventButton}isValidStartEvent(r){return this._correctEvent(r)}isValidMoveEvent(r){return!function(p,C){const k=yd[C];return p.buttons===void 0||(p.buttons&k)!==k}(r,this._eventButton)}isValidEndEvent(r){return Q.mouseButton(r)===this._eventButton}}class im{constructor(){this._firstTouch=void 0}_isOneFingerTouch(r){return r.targetTouches.length===1}_isSameTouchEvent(r){return r.targetTouches[0].identifier===this._firstTouch}startMove(r){this._firstTouch=r.targetTouches[0].identifier}endMove(r){delete this._firstTouch}isValidStartEvent(r){return this._isOneFingerTouch(r)}isValidMoveEvent(r){return this._isOneFingerTouch(r)&&this._isSameTouchEvent(r)}isValidEndEvent(r){return this._isOneFingerTouch(r)&&this._isSameTouchEvent(r)}}class kh{constructor(r=new Ah({checkCorrectEvent:()=>!0}),p=new im){this.mouseMoveStateManager=r,this.oneFingerTouchMoveStateManager=p}_executeRelevantHandler(r,p,C){return r instanceof MouseEvent?p(r):typeof TouchEvent<"u"&&r instanceof TouchEvent?C(r):void 0}startMove(r){this._executeRelevantHandler(r,p=>this.mouseMoveStateManager.startMove(p),p=>this.oneFingerTouchMoveStateManager.startMove(p))}endMove(r){this._executeRelevantHandler(r,p=>this.mouseMoveStateManager.endMove(p),p=>this.oneFingerTouchMoveStateManager.endMove(p))}isValidStartEvent(r){return this._executeRelevantHandler(r,p=>this.mouseMoveStateManager.isValidStartEvent(p),p=>this.oneFingerTouchMoveStateManager.isValidStartEvent(p))}isValidMoveEvent(r){return this._executeRelevantHandler(r,p=>this.mouseMoveStateManager.isValidMoveEvent(p),p=>this.oneFingerTouchMoveStateManager.isValidMoveEvent(p))}isValidEndEvent(r){return this._executeRelevantHandler(r,p=>this.mouseMoveStateManager.isValidEndEvent(p),p=>this.oneFingerTouchMoveStateManager.isValidEndEvent(p))}}const _c=B=>{B.mousedown=B.dragStart,B.mousemoveWindow=B.dragMove,B.mouseup=B.dragEnd,B.contextmenu=r=>{r.preventDefault()}};class cp{constructor(r,p){this._clickTolerance=r.clickTolerance||1,this._map=p,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new t.P(0,0)}_shouldBePrevented(r){return r<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(r,p,C){return this._calculateTransform(r,p,C)}touchmove(r,p,C){if(this._active){if(!this._shouldBePrevented(C.length))return r.preventDefault(),this._calculateTransform(r,p,C);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",r)}}touchend(r,p,C){this._calculateTransform(r,p,C),this._active&&this._shouldBePrevented(C.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,p,C){C.length>0&&(this._active=!0);const k=op(C,p),j=new t.P(0,0),Z=new t.P(0,0);let re=0;for(const ye in k){const Me=k[ye],Re=this._touches[ye];Re&&(j._add(Me),Z._add(Me.sub(Re)),re++,k[ye]=Me)}if(this._touches=k,this._shouldBePrevented(re)||!Z.mag())return;const ue=Z.div(re);return this._sum._add(ue),this._sum.mag()<this._clickTolerance?void 0:{around:j.div(re),panDelta:ue}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qr{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(r,p,C){this._firstTwoTouches||C.length<2||(this._firstTwoTouches=[C[0].identifier,C[1].identifier],this._start([p[0],p[1]]))}touchmove(r,p,C){if(!this._firstTwoTouches)return;r.preventDefault();const[k,j]=this._firstTwoTouches,Z=Uc(C,p,k),re=Uc(C,p,j);if(!Z||!re)return;const ue=this._aroundCenter?null:Z.add(re).div(2);return this._move([Z,re],ue,r)}touchend(r,p,C){if(!this._firstTwoTouches)return;const[k,j]=this._firstTwoTouches,Z=Uc(C,p,k),re=Uc(C,p,j);Z&&re||(this._active&&Q.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Uc(B,r,p){for(let C=0;C<B.length;C++)if(B[C].identifier===p)return r[C]}function up(B,r){return Math.log(B/r)/Math.LN2}class yu extends Qr{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,p){const C=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(up(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:up(this._distance,C),pinchAround:p}}}function hp(B,r){return 180*B.angleWith(r)/Math.PI}class df extends Qr{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,p,C){const k=this._vector;if(this._vector=r[0].sub(r[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:hp(this._vector,k),pinchAround:p}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const p=25/(Math.PI*this._minDiameter)*360,C=hp(r,this._startVector);return Math.abs(C)<p}}function Dh(B){return Math.abs(B.y)>Math.abs(B.x)}class vd extends Qr{constructor(r){super(),this._currentTouchCount=0,this._map=r}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(r,p,C){super.touchstart(r,p,C),this._currentTouchCount=C.length}_start(r){this._lastPoints=r,Dh(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,p,C){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const k=r[0].sub(this._lastPoints[0]),j=r[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(k,j,C.timeStamp),this._valid?(this._lastPoints=r,this._active=!0,{pitchDelta:(k.y+j.y)/2*-.5}):void 0}gestureBeginsVertically(r,p,C){if(this._valid!==void 0)return this._valid;const k=r.mag()>=2,j=p.mag()>=2;if(!k&&!j)return;if(!k||!j)return this._firstMove===void 0&&(this._firstMove=C),C-this._firstMove<100&&void 0;const Z=r.y>0==p.y>0;return Dh(r)&&Dh(p)&&Z}}const dp={panStep:100,bearingStep:15,pitchStep:10};class Hm{constructor(r){this._tr=new Vc(r);const p=dp;this._panStep=p.panStep,this._bearingStep=p.bearingStep,this._pitchStep=p.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let p=0,C=0,k=0,j=0,Z=0;switch(r.keyCode){case 61:case 107:case 171:case 187:p=1;break;case 189:case 109:case 173:p=-1;break;case 37:r.shiftKey?C=-1:(r.preventDefault(),j=-1);break;case 39:r.shiftKey?C=1:(r.preventDefault(),j=1);break;case 38:r.shiftKey?k=1:(r.preventDefault(),Z=-1);break;case 40:r.shiftKey?k=-1:(r.preventDefault(),Z=1);break;default:return}return this._rotationDisabled&&(C=0,k=0),{cameraAnimation:re=>{const ue=this._tr;re.easeTo({duration:300,easeId:"keyboardHandler",easing:Rh,zoom:p?Math.round(ue.zoom)+p*(r.shiftKey?2:1):ue.zoom,bearing:ue.bearing+C*this._bearingStep,pitch:ue.pitch+k*this._pitchStep,offset:[-j*this._panStep,-Z*this._panStep],center:ue.center},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Rh(B){return B*(2-B)}const xd=4.000244140625;class ki{constructor(r,p){this._onTimeout=C=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(C)},this._map=r,this._tr=new Vc(r),this._triggerRenderFrame=p,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(r){return!!this._map.cooperativeGestures.isEnabled()&&!(r.ctrlKey||this._map.cooperativeGestures.isBypassed(r))}wheel(r){if(!this.isEnabled())return;if(this._shouldBePrevented(r))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",r);let p=r.deltaMode===WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const C=J.now(),k=C-(this._lastWheelEventTime||0);this._lastWheelEventTime=C,p!==0&&p%xd==0?this._type="wheel":p!==0&&Math.abs(p)<4?this._type="trackpad":k>400?(this._type=null,this._lastValue=p,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(k*p)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,p+=this._lastValue)),r.shiftKey&&p&&(p/=4),this._type&&(this._lastWheelEvent=r,this._delta-=p,this._active||this._start(r)),r.preventDefault()}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const p=Q.mousePos(this._map.getCanvas(),r),C=this._tr;this._aroundPoint=this._aroundCenter?C.transform.locationToScreenPoint(t.N.convert(C.center)):p,this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._tr.transform;if(typeof this._lastExpectedZoom=="number"){const re=r.zoom-this._lastExpectedZoom;typeof this._startZoom=="number"&&(this._startZoom+=re),typeof this._targetZoom=="number"&&(this._targetZoom+=re)}if(this._delta!==0){const re=this._type==="wheel"&&Math.abs(this._delta)>xd?this._wheelZoomRate:this._defaultZoomRate;let ue=2/(1+Math.exp(-Math.abs(this._delta*re)));this._delta<0&&ue!==0&&(ue=1/ue);const ye=typeof this._targetZoom!="number"?r.scale:t.aG(this._targetZoom);this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,t.a8(ye*ue))),this._type==="wheel"&&(this._startZoom=r.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const p=typeof this._targetZoom!="number"?r.zoom:this._targetZoom,C=this._startZoom,k=this._easing;let j,Z=!1;if(this._type==="wheel"&&C&&k){const re=J.now()-this._lastWheelEventTime,ue=Math.min((re+5)/200,1),ye=k(ue);j=t.y.number(C,p,ye),ue<1?this._frameId||(this._frameId=!0):Z=!0}else j=p,Z=!0;return this._active=!0,Z&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._lastExpectedZoom,delete this._finishTimeout},200)),this._lastExpectedZoom=j,{noInertia:!0,needsRenderFrame:!Z,zoomDelta:j-r.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let p=t.c8;if(this._prevEase){const C=this._prevEase,k=(J.now()-C.start)/C.duration,j=C.easing(k+.01)-C.easing(k),Z=.27/Math.sqrt(j*j+1e-4)*.01,re=Math.sqrt(.0729-Z*Z);p=t.c6(Z,re,.25,1)}return this._prevEase={start:J.now(),duration:r,easing:p},p}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,delete this._lastExpectedZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class yc{constructor(r,p){this._clickZoom=r,this._tapZoom=p}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ls{constructor(r){this._tr=new Vc(r),this.reset()}reset(){this._active=!1}dblclick(r,p){return r.preventDefault(),{cameraAnimation:C=>{C.easeTo({duration:300,zoom:this._tr.zoom+(r.shiftKey?-1:1),around:this._tr.unproject(p)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class nl{constructor(){this._tap=new Nc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(r,p,C){if(!this._swipePoint)if(this._tapTime){const k=p[0],j=r.timeStamp-this._tapTime<500,Z=this._tapPoint.dist(k)<30;j&&Z?C.length>0&&(this._swipePoint=k,this._swipeTouch=C[0].identifier):this.reset()}else this._tap.touchstart(r,p,C)}touchmove(r,p,C){if(this._tapTime){if(this._swipePoint){if(C[0].identifier!==this._swipeTouch)return;const k=p[0],j=k.y-this._swipePoint.y;return this._swipePoint=k,r.preventDefault(),this._active=!0,{zoomDelta:j/128}}}else this._tap.touchmove(r,p,C)}touchend(r,p,C){if(this._tapTime)this._swipePoint&&C.length===0&&this.reset();else{const k=this._tap.touchend(r,p,C);k&&(this._tapTime=r.timeStamp,this._tapPoint=k)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $c{constructor(r,p,C){this._el=r,this._mousePan=p,this._touchPan=C}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class $i{constructor(r,p,C,k){this._pitchWithRotate=r.pitchWithRotate,this._rollEnabled=r.rollEnabled,this._mouseRotate=p,this._mousePitch=C,this._mouseRoll=k}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable(),this._rollEnabled&&this._mouseRoll.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable(),this._mouseRoll.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())&&(!this._rollEnabled||this._mouseRoll.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()||this._mouseRoll.isActive()}}class ff{constructor(r,p,C,k){this._el=r,this._touchZoom=p,this._touchRotate=C,this._tapDragZoom=k,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class fp{constructor(r,p){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=r,this._options=p,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const r=this._map.getCanvasContainer();r.classList.add("maplibregl-cooperative-gestures"),this._container=Q.create("div","maplibregl-cooperative-gesture-screen",r);let p=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(p=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const C=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),k=document.createElement("div");k.className="maplibregl-desktop-message",k.textContent=p,this._container.appendChild(k);const j=document.createElement("div");j.className="maplibregl-mobile-message",j.textContent=C,this._container.appendChild(j),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(Q.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(r){return r[this._bypassKey]}notifyGestureBlocked(r,p){this._enabled&&(this._map.fire(new t.k("cooperativegestureprevented",{gestureType:r,originalEvent:p})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const pf=B=>B.zoom||B.drag||B.roll||B.pitch||B.rotate;class Fl extends t.k{}function Qu(B){return B.panDelta&&B.panDelta.mag()||B.zoomDelta||B.bearingDelta||B.pitchDelta||B.rollDelta}class cr{constructor(r,p){this.handleWindowEvent=k=>{this.handleEvent(k,`${k.type}Window`)},this.handleEvent=(k,j)=>{if(k.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const Z=k.type==="renderFrame"?void 0:k,re={needsRenderFrame:!1},ue={},ye={},Me=k.touches,Re=Me?this._getMapTouches(Me):void 0,ze=Re?Q.touchPos(this._map.getCanvas(),Re):Q.mousePos(this._map.getCanvas(),k);for(const{handlerName:Pt,handler:Et,allowed:Lt}of this._handlers){if(!Et.isEnabled())continue;let jt;this._blockedByActive(ye,Lt,Pt)?Et.reset():Et[j||k.type]&&(jt=Et[j||k.type](k,ze,Re),this.mergeHandlerResult(re,ue,jt,Pt,Z),jt&&jt.needsRenderFrame&&this._triggerRenderFrame()),(jt||Et.isActive())&&(ye[Pt]=Et)}const Je={};for(const Pt in this._previousActiveHandlers)ye[Pt]||(Je[Pt]=Z);this._previousActiveHandlers=ye,(Object.keys(Je).length||Qu(re))&&(this._changes.push([re,ue,Je]),this._triggerRenderFrame()),(Object.keys(ye).length||Qu(re))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ot}=re;ot&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ot(this._map))},this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new _d(r),this._bearingSnap=p.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(p);const C=this._el;this._listeners=[[C,"touchstart",{passive:!0}],[C,"touchmove",{passive:!1}],[C,"touchend",void 0],[C,"touchcancel",void 0],[C,"mousedown",void 0],[C,"mousemove",void 0],[C,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[C,"mouseover",void 0],[C,"mouseout",void 0],[C,"dblclick",void 0],[C,"click",void 0],[C,"keydown",{capture:!1}],[C,"keyup",void 0],[C,"wheel",{passive:!1}],[C,"contextmenu",void 0],[window,"blur",void 0]];for(const[k,j,Z]of this._listeners)Q.addEventListener(k,j,k===document?this.handleWindowEvent:this.handleEvent,Z)}destroy(){for(const[r,p,C]of this._listeners)Q.removeEventListener(r,p,r===document?this.handleWindowEvent:this.handleEvent,C)}_addDefaultHandlers(r){const p=this._map,C=p.getCanvasContainer();this._add("mapEvent",new ml(p,r));const k=p.boxZoom=new hf(p,r);this._add("boxZoom",k),r.interactive&&r.boxZoom&&k.enable();const j=p.cooperativeGestures=new fp(p,r.cooperativeGestures);this._add("cooperativeGestures",j),r.cooperativeGestures&&j.enable();const Z=new jc(p),re=new ls(p);p.doubleClickZoom=new yc(re,Z),this._add("tapZoom",Z),this._add("clickZoom",re),r.interactive&&r.doubleClickZoom&&p.doubleClickZoom.enable();const ue=new nl;this._add("tapDragZoom",ue);const ye=p.touchPitch=new vd(p);this._add("touchPitch",ye),r.interactive&&r.touchPitch&&p.touchPitch.enable(r.touchPitch);const Me=()=>p.project(p.getCenter()),Re=function({enable:Bt,clickTolerance:nn,aroundCenter:rn=!0,minPixelCenterThreshold:an=100,rotateDegreesPerPixelMoved:Mn=.8},Rn){const Hn=new Ah({checkCorrectEvent:ei=>Q.mouseButton(ei)===0&&ei.ctrlKey||Q.mouseButton(ei)===2&&!ei.ctrlKey});return new Yi({clickTolerance:nn,move:(ei,jn)=>{const Ri=Rn();if(rn&&Math.abs(Ri.y-ei.y)>an)return{bearingDelta:t.c7(new t.P(ei.x,jn.y),jn,Ri)};let zi=(jn.x-ei.x)*Mn;return rn&&jn.y<Ri.y&&(zi=-zi),{bearingDelta:zi}},moveStateManager:Hn,enable:Bt,assignEvents:_c})}(r,Me),ze=function({enable:Bt,clickTolerance:nn,pitchDegreesPerPixelMoved:rn=-.5}){const an=new Ah({checkCorrectEvent:Mn=>Q.mouseButton(Mn)===0&&Mn.ctrlKey||Q.mouseButton(Mn)===2});return new Yi({clickTolerance:nn,move:(Mn,Rn)=>({pitchDelta:(Rn.y-Mn.y)*rn}),moveStateManager:an,enable:Bt,assignEvents:_c})}(r),Je=function({enable:Bt,clickTolerance:nn,rollDegreesPerPixelMoved:rn=.3},an){const Mn=new Ah({checkCorrectEvent:Rn=>Q.mouseButton(Rn)===2&&Rn.ctrlKey});return new Yi({clickTolerance:nn,move:(Rn,Hn)=>{const ei=an();let jn=(Hn.x-Rn.x)*rn;return Hn.y<ei.y&&(jn=-jn),{rollDelta:jn}},moveStateManager:Mn,enable:Bt,assignEvents:_c})}(r,Me);p.dragRotate=new $i(r,Re,ze,Je),this._add("mouseRotate",Re,["mousePitch"]),this._add("mousePitch",ze,["mouseRotate","mouseRoll"]),this._add("mouseRoll",Je,["mousePitch"]),r.interactive&&r.dragRotate&&p.dragRotate.enable();const ot=function({enable:Bt,clickTolerance:nn}){const rn=new Ah({checkCorrectEvent:an=>Q.mouseButton(an)===0&&!an.ctrlKey});return new Yi({clickTolerance:nn,move:(an,Mn)=>({around:Mn,panDelta:Mn.sub(an)}),activateOnStart:!0,moveStateManager:rn,enable:Bt,assignEvents:_c})}(r),Pt=new cp(r,p);p.dragPan=new $c(C,ot,Pt),this._add("mousePan",ot),this._add("touchPan",Pt,["touchZoom","touchRotate"]),r.interactive&&r.dragPan&&p.dragPan.enable(r.dragPan);const Et=new df,Lt=new yu;p.touchZoomRotate=new ff(C,Lt,Et,ue),this._add("touchRotate",Et,["touchPan","touchZoom"]),this._add("touchZoom",Lt,["touchPan","touchRotate"]),r.interactive&&r.touchZoomRotate&&p.touchZoomRotate.enable(r.touchZoomRotate);const jt=p.scrollZoom=new ki(p,()=>this._triggerRenderFrame());this._add("scrollZoom",jt,["mousePan"]),r.interactive&&r.scrollZoom&&p.scrollZoom.enable(r.scrollZoom);const Nt=p.keyboard=new Hm(p);this._add("keyboard",Nt),r.interactive&&r.keyboard&&p.keyboard.enable(),this._add("blockableMapEvent",new nm(p))}_add(r,p,C){this._handlers.push({handlerName:r,handler:p,allowed:C}),this._handlersById[r]=p}stop(r){if(!this._updatingCamera){for(const{handler:p}of this._handlers)p.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!pf(this._eventsInProgress)||this.isZooming()}_blockedByActive(r,p,C){for(const k in r)if(k!==C&&(!p||p.indexOf(k)<0))return!0;return!1}_getMapTouches(r){const p=[];for(const C of r)this._el.contains(C.target)&&p.push(C);return p}mergeHandlerResult(r,p,C,k,j){if(!C)return;t.e(r,C);const Z={handlerName:k,originalEvent:C.originalEvent||j};C.zoomDelta!==void 0&&(p.zoom=Z),C.panDelta!==void 0&&(p.drag=Z),C.rollDelta!==void 0&&(p.roll=Z),C.pitchDelta!==void 0&&(p.pitch=Z),C.bearingDelta!==void 0&&(p.rotate=Z)}_applyChanges(){const r={},p={},C={};for(const[k,j,Z]of this._changes)k.panDelta&&(r.panDelta=(r.panDelta||new t.P(0,0))._add(k.panDelta)),k.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+k.zoomDelta),k.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+k.bearingDelta),k.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+k.pitchDelta),k.rollDelta&&(r.rollDelta=(r.rollDelta||0)+k.rollDelta),k.around!==void 0&&(r.around=k.around),k.pinchAround!==void 0&&(r.pinchAround=k.pinchAround),k.noInertia&&(r.noInertia=k.noInertia),t.e(p,j),t.e(C,Z);this._updateMapTransform(r,p,C),this._changes=[]}_updateMapTransform(r,p,C){const k=this._map,j=k._getTransformForUpdate(),Z=k.terrain;if(!(Qu(r)||Z&&this._terrainMovement))return this._fireEvents(p,C,!0);k._stop(!0);let{panDelta:re,zoomDelta:ue,bearingDelta:ye,pitchDelta:Me,rollDelta:Re,around:ze,pinchAround:Je}=r;Je!==void 0&&(ze=Je),ze=ze||k.transform.centerPoint,Z&&!j.isPointOnMapSurface(ze)&&(ze=j.centerPoint);const ot={panDelta:re,zoomDelta:ue,rollDelta:Re,pitchDelta:Me,bearingDelta:ye,around:ze};this._map.cameraHelper.useGlobeControls&&!j.isPointOnMapSurface(ze)&&(ze=j.centerPoint);const Pt=ze.distSqr(j.centerPoint)<.01?j.center:j.screenPointToLocation(re?ze.sub(re):ze);Z?(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(ot,j),this._terrainMovement||!p.drag&&!p.zoom?p.drag&&this._terrainMovement?j.setCenter(j.screenPointToLocation(j.centerPoint.sub(re))):this._map.cameraHelper.handleMapControlsPan(ot,j,Pt):(this._terrainMovement=!0,this._map._elevationFreeze=!0,this._map.cameraHelper.handleMapControlsPan(ot,j,Pt))):(this._map.cameraHelper.handleMapControlsRollPitchBearingZoom(ot,j),this._map.cameraHelper.handleMapControlsPan(ot,j,Pt)),k._applyUpdatedTransform(j),this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(p,C,!0)}_fireEvents(r,p,C){const k=pf(this._eventsInProgress),j=pf(r),Z={};for(const Re in r){const{originalEvent:ze}=r[Re];this._eventsInProgress[Re]||(Z[`${Re}start`]=ze),this._eventsInProgress[Re]=r[Re]}!k&&j&&this._fireEvent("movestart",j.originalEvent);for(const Re in Z)this._fireEvent(Re,Z[Re]);j&&this._fireEvent("move",j.originalEvent);for(const Re in r){const{originalEvent:ze}=r[Re];this._fireEvent(Re,ze)}const re={};let ue;for(const Re in this._eventsInProgress){const{handlerName:ze,originalEvent:Je}=this._eventsInProgress[Re];this._handlersById[ze].isActive()||(delete this._eventsInProgress[Re],ue=p[ze]||Je,re[`${Re}end`]=ue)}for(const Re in re)this._fireEvent(Re,re[Re]);const ye=pf(this._eventsInProgress),Me=(k||j)&&!ye;if(Me&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const Re=this._map._getTransformForUpdate();this._map.getCenterClampedToGround()&&Re.recalculateZoomAndCenter(this._map.terrain),this._map._applyUpdatedTransform(Re)}if(C&&Me){this._updatingCamera=!0;const Re=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),ze=Je=>Je!==0&&-this._bearingSnap<Je&&Je<this._bearingSnap;!Re||!Re.essential&&J.prefersReducedMotion?(this._map.fire(new t.k("moveend",{originalEvent:ue})),ze(this._map.getBearing())&&this._map.resetNorth()):(ze(Re.bearing||this._map.getBearing())&&(Re.bearing=0),Re.freezeElevation=!0,this._map.easeTo(Re,{originalEvent:ue})),this._updatingCamera=!1}}_fireEvent(r,p){this._map.fire(new t.k(r,p?{originalEvent:p}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{delete this._frameId,this.handleEvent(new Fl("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class xr extends t.E{constructor(r,p,C){super(),this._renderFrameCallback=()=>{const k=Math.min((J.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(k)),k<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=C.bearingSnap,this.cameraHelper=p,this.on("moveend",()=>{delete this._requestedCameraState})}migrateProjection(r,p){r.apply(this.transform),this.transform=r,this.cameraHelper=p}getCenter(){return new t.N(this.transform.center.lng,this.transform.center.lat)}setCenter(r,p){return this.jumpTo({center:r},p)}getCenterElevation(){return this.transform.elevation}setCenterElevation(r,p){return this.jumpTo({elevation:r},p),this}getCenterClampedToGround(){return this._centerClampedToGround}setCenterClampedToGround(r){this._centerClampedToGround=r}panBy(r,p,C){return r=t.P.convert(r).mult(-1),this.panTo(this.transform.center,t.e({offset:r},p),C)}panTo(r,p,C){return this.easeTo(t.e({center:r},p),C)}getZoom(){return this.transform.zoom}setZoom(r,p){return this.jumpTo({zoom:r},p),this}zoomTo(r,p,C){return this.easeTo(t.e({zoom:r},p),C)}zoomIn(r,p){return this.zoomTo(this.getZoom()+1,r,p),this}zoomOut(r,p){return this.zoomTo(this.getZoom()-1,r,p),this}getVerticalFieldOfView(){return this.transform.fov}setVerticalFieldOfView(r,p){return r!=this.transform.fov&&(this.transform.setFov(r),this.fire(new t.k("movestart",p)).fire(new t.k("move",p)).fire(new t.k("moveend",p))),this}getBearing(){return this.transform.bearing}setBearing(r,p){return this.jumpTo({bearing:r},p),this}getPadding(){return this.transform.padding}setPadding(r,p){return this.jumpTo({padding:r},p),this}rotateTo(r,p,C){return this.easeTo(t.e({bearing:r},p),C)}resetNorth(r,p){return this.rotateTo(0,t.e({duration:1e3},r),p),this}resetNorthPitch(r,p){return this.easeTo(t.e({bearing:0,pitch:0,roll:0,duration:1e3},r),p),this}snapToNorth(r,p){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,p):this}getPitch(){return this.transform.pitch}setPitch(r,p){return this.jumpTo({pitch:r},p),this}getRoll(){return this.transform.roll}setRoll(r,p){return this.jumpTo({roll:r},p),this}cameraForBounds(r,p){r=at.convert(r).adjustAntiMeridian();const C=p&&p.bearing||0;return this._cameraForBoxAndBearing(r.getNorthWest(),r.getSouthEast(),C,p)}_cameraForBoxAndBearing(r,p,C,k){const j={top:0,bottom:0,right:0,left:0};if(typeof(k=t.e({padding:j,offset:[0,0],maxZoom:this.transform.maxZoom},k)).padding=="number"){const ye=k.padding;k.padding={top:ye,bottom:ye,right:ye,left:ye}}const Z=t.e(j,k.padding);k.padding=Z;const re=this.transform,ue=new at(r,p);return this.cameraHelper.cameraForBoxAndBearing(k,Z,ue,C,re)}fitBounds(r,p,C){return this._fitInternal(this.cameraForBounds(r,p),p,C)}fitScreenCoordinates(r,p,C,k,j){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.screenPointToLocation(t.P.convert(r)),this.transform.screenPointToLocation(t.P.convert(p)),C,k),k,j)}_fitInternal(r,p,C){return r?(delete(p=t.e(r,p)).padding,p.linear?this.easeTo(p,C):this.flyTo(p,C)):this}jumpTo(r,p){this.stop();const C=this._getTransformForUpdate();let k=!1,j=!1,Z=!1;const re=C.zoom;this.cameraHelper.handleJumpToCenterZoom(C,r);const ue=C.zoom!==re;return"elevation"in r&&C.elevation!==+r.elevation&&C.setElevation(+r.elevation),"bearing"in r&&C.bearing!==+r.bearing&&(k=!0,C.setBearing(+r.bearing)),"pitch"in r&&C.pitch!==+r.pitch&&(j=!0,C.setPitch(+r.pitch)),"roll"in r&&C.roll!==+r.roll&&(Z=!0,C.setRoll(+r.roll)),r.padding==null||C.isPaddingEqual(r.padding)||C.setPadding(r.padding),this._applyUpdatedTransform(C),this.fire(new t.k("movestart",p)).fire(new t.k("move",p)),ue&&this.fire(new t.k("zoomstart",p)).fire(new t.k("zoom",p)).fire(new t.k("zoomend",p)),k&&this.fire(new t.k("rotatestart",p)).fire(new t.k("rotate",p)).fire(new t.k("rotateend",p)),j&&this.fire(new t.k("pitchstart",p)).fire(new t.k("pitch",p)).fire(new t.k("pitchend",p)),Z&&this.fire(new t.k("rollstart",p)).fire(new t.k("roll",p)).fire(new t.k("rollend",p)),this.fire(new t.k("moveend",p))}calculateCameraOptionsFromTo(r,p,C,k=0){const j=t.Y.fromLngLat(r,p),Z=t.Y.fromLngLat(C,k),re=Z.x-j.x,ue=Z.y-j.y,ye=Z.z-j.z,Me=Math.hypot(re,ue,ye);if(Me===0)throw new Error("Can't calculate camera options with same From and To");const Re=Math.hypot(re,ue),ze=t.a8(this.transform.cameraToCenterDistance/Me/this.transform.tileSize),Je=180*Math.atan2(re,-ue)/Math.PI;let ot=180*Math.acos(Re/Me)/Math.PI;return ot=ye<0?90-ot:90+ot,{center:Z.toLngLat(),elevation:k,zoom:ze,pitch:ot,bearing:Je}}calculateCameraOptionsFromCameraLngLatAltRotation(r,p,C,k,j){const Z=this.transform.calculateCenterFromCameraLngLatAlt(r,p,C,k);return{center:Z.center,elevation:Z.elevation,zoom:Z.zoom,bearing:C,pitch:k,roll:j}}easeTo(r,p){this._stop(!1,r.easeId),((r=t.e({offset:[0,0],duration:500,easing:t.c8},r)).animate===!1||!r.essential&&J.prefersReducedMotion)&&(r.duration=0);const C=this._getTransformForUpdate(),k=this.getBearing(),j=C.pitch,Z=C.roll,re="bearing"in r?this._normalizeBearing(r.bearing,k):k,ue="pitch"in r?+r.pitch:j,ye="roll"in r?this._normalizeBearing(r.roll,Z):Z,Me="padding"in r?r.padding:C.padding,Re=t.P.convert(r.offset);let ze,Je;r.around&&(ze=t.N.convert(r.around),Je=C.locationToScreenPoint(ze));const ot={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching,rolling:this._rolling},Pt=this.cameraHelper.handleEaseTo(C,{bearing:re,pitch:ue,roll:ye,padding:Me,around:ze,aroundPoint:Je,offsetAsPoint:Re,offset:r.offset,zoom:r.zoom,center:r.center});return this._rotating=this._rotating||k!==re,this._pitching=this._pitching||ue!==j,this._rolling=this._rolling||ye!==Z,this._padding=!C.isPaddingEqual(Me),this._zooming=this._zooming||Pt.isZooming,this._easeId=r.easeId,this._prepareEase(p,r.noMoveStart,ot),this.terrain&&this._prepareElevation(Pt.elevationCenter),this._ease(Et=>{Pt.easeFunc(Et),this.terrain&&!r.freezeElevation&&this._updateElevation(Et),this._applyUpdatedTransform(C),this._fireMoveEvents(p)},Et=>{this.terrain&&r.freezeElevation&&this._finalizeElevation(),this._afterEase(p,Et)},r),this}_prepareEase(r,p,C={}){this._moving=!0,p||C.moving||this.fire(new t.k("movestart",r)),this._zooming&&!C.zooming&&this.fire(new t.k("zoomstart",r)),this._rotating&&!C.rotating&&this.fire(new t.k("rotatestart",r)),this._pitching&&!C.pitching&&this.fire(new t.k("pitchstart",r)),this._rolling&&!C.rolling&&this.fire(new t.k("rollstart",r))}_prepareElevation(r){this._elevationCenter=r,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(r,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(r){this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom));const p=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(r<1&&p!==this._elevationTarget){const C=this._elevationTarget-this._elevationStart;this._elevationStart+=r*(C-(p-(C*r+this._elevationStart))/(1-r)),this._elevationTarget=p}this.transform.setElevation(t.y.number(this._elevationStart,this._elevationTarget,r))}_finalizeElevation(){this._elevationFreeze=!1,this.getCenterClampedToGround()&&this.transform.recalculateZoomAndCenter(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(r){if(!this.terrain&&r.elevation>=0&&r.pitch<=90)return{};const p=r.getCameraLngLat(),C=r.getCameraAltitude(),k=this.terrain?this.terrain.getElevationForLngLatZoom(p,r.zoom):0;if(C<k){const j=this.calculateCameraOptionsFromTo(p,k,r.center,r.elevation);return{pitch:j.pitch,zoom:j.zoom}}return{}}_applyUpdatedTransform(r){const p=[];if(p.push(k=>this._elevateCameraIfInsideTerrain(k)),this.transformCameraUpdate&&p.push(k=>this.transformCameraUpdate(k)),!p.length)return;const C=r.clone();for(const k of p){const j=C.clone(),{center:Z,zoom:re,roll:ue,pitch:ye,bearing:Me,elevation:Re}=k(j);Z&&j.setCenter(Z),Re!==void 0&&j.setElevation(Re),re!==void 0&&j.setZoom(re),ue!==void 0&&j.setRoll(ue),ye!==void 0&&j.setPitch(ye),Me!==void 0&&j.setBearing(Me),C.apply(j)}this.transform.apply(C)}_fireMoveEvents(r){this.fire(new t.k("move",r)),this._zooming&&this.fire(new t.k("zoom",r)),this._rotating&&this.fire(new t.k("rotate",r)),this._pitching&&this.fire(new t.k("pitch",r)),this._rolling&&this.fire(new t.k("roll",r))}_afterEase(r,p){if(this._easeId&&p&&this._easeId===p)return;delete this._easeId;const C=this._zooming,k=this._rotating,j=this._pitching,Z=this._rolling;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._rolling=!1,this._padding=!1,C&&this.fire(new t.k("zoomend",r)),k&&this.fire(new t.k("rotateend",r)),j&&this.fire(new t.k("pitchend",r)),Z&&this.fire(new t.k("rollend",r)),this.fire(new t.k("moveend",r))}flyTo(r,p){if(!r.essential&&J.prefersReducedMotion){const jn=t.M(r,["center","zoom","bearing","pitch","roll","elevation"]);return this.jumpTo(jn,p)}this.stop(),r=t.e({offset:[0,0],speed:1.2,curve:1.42,easing:t.c8},r);const C=this._getTransformForUpdate(),k=C.bearing,j=C.pitch,Z=C.roll,re=C.padding,ue="bearing"in r?this._normalizeBearing(r.bearing,k):k,ye="pitch"in r?+r.pitch:j,Me="roll"in r?this._normalizeBearing(r.roll,Z):Z,Re="padding"in r?r.padding:C.padding,ze=t.P.convert(r.offset);let Je=C.centerPoint.add(ze);const ot=C.screenPointToLocation(Je),Pt=this.cameraHelper.handleFlyTo(C,{bearing:ue,pitch:ye,roll:Me,padding:Re,locationAtOffset:ot,offsetAsPoint:ze,center:r.center,minZoom:r.minZoom,zoom:r.zoom});let Et=r.curve;const Lt=Math.max(C.width,C.height),jt=Lt/Pt.scaleOfZoom,Nt=Pt.pixelPathLength;typeof Pt.scaleOfMinZoom=="number"&&(Et=Math.sqrt(Lt/Pt.scaleOfMinZoom/Nt*2));const Bt=Et*Et;function nn(jn){const Ri=(jt*jt-Lt*Lt+(jn?-1:1)*Bt*Bt*Nt*Nt)/(2*(jn?jt:Lt)*Bt*Nt);return Math.log(Math.sqrt(Ri*Ri+1)-Ri)}function rn(jn){return(Math.exp(jn)-Math.exp(-jn))/2}function an(jn){return(Math.exp(jn)+Math.exp(-jn))/2}const Mn=nn(!1);let Rn=function(jn){return an(Mn)/an(Mn+Et*jn)},Hn=function(jn){return Lt*((an(Mn)*(rn(Ri=Mn+Et*jn)/an(Ri))-rn(Mn))/Bt)/Nt;var Ri},ei=(nn(!0)-Mn)/Et;if(Math.abs(Nt)<2e-6||!isFinite(ei)){if(Math.abs(Lt-jt)<1e-6)return this.easeTo(r,p);const jn=jt<Lt?-1:1;ei=Math.abs(Math.log(jt/Lt))/Et,Hn=()=>0,Rn=Ri=>Math.exp(jn*Et*Ri)}return r.duration="duration"in r?+r.duration:1e3*ei/("screenSpeed"in r?+r.screenSpeed/Et:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0),this._zooming=!0,this._rotating=k!==ue,this._pitching=ye!==j,this._rolling=Me!==Z,this._padding=!C.isPaddingEqual(Re),this._prepareEase(p,!1),this.terrain&&this._prepareElevation(Pt.targetCenter),this._ease(jn=>{const Ri=jn*ei,zi=1/Rn(Ri),xi=Hn(Ri);this._rotating&&C.setBearing(t.y.number(k,ue,jn)),this._pitching&&C.setPitch(t.y.number(j,ye,jn)),this._rolling&&C.setRoll(t.y.number(Z,Me,jn)),this._padding&&(C.interpolatePadding(re,Re,jn),Je=C.centerPoint.add(ze)),Pt.easeFunc(jn,zi,xi,Je),this.terrain&&!r.freezeElevation&&this._updateElevation(jn),this._applyUpdatedTransform(C),this._fireMoveEvents(p)},()=>{this.terrain&&r.freezeElevation&&this._finalizeElevation(),this._afterEase(p)},r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,p){var C;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const k=this._onEaseEnd;delete this._onEaseEnd,k.call(this,p)}return r||(C=this.handlers)===null||C===void 0||C.stop(!1),this}_ease(r,p,C){C.animate===!1||C.duration===0?(r(1),p()):(this._easeStart=J.now(),this._easeOptions=C,this._onEaseFrame=r,this._onEaseEnd=p,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(r,p){r=t.aI(r,-180,180);const C=Math.abs(r-p);return Math.abs(r-360-p)<C&&(r-=360),Math.abs(r+360-p)<C&&(r+=360),r}queryTerrainElevation(r){return this.terrain?this.terrain.getElevationForLngLatZoom(t.N.convert(r),this.transform.tileZoom):null}}const bd={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class wd{constructor(r=bd){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=p=>{!p||p.sourceDataType!=="metadata"&&p.sourceDataType!=="visibility"&&p.dataType!=="style"&&p.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=r}getDefaultPosition(){return"bottom-right"}onAdd(r){return this._map=r,this._compact=this.options.compact,this._container=Q.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=Q.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Q.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){Q.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._sanitizedAttributionHTML=void 0}_setElementTitle(r,p){const C=this._map._getUIString(`AttributionControl.${p}`);r.title=C,r.setAttribute("aria-label",C)}_updateAttributions(){if(!this._map.style)return;let r=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=r.concat(this.options.customAttribution.map(k=>typeof k!="string"?"":k)):typeof this.options.customAttribution=="string"&&r.push(this.options.customAttribution)),this._map.style.stylesheet){const k=this._map.style.stylesheet;this.styleOwner=k.owner,this.styleId=k.id}const p=this._map.style.sourceCaches;for(const k in p){const j=p[k];if(j.used||j.usedForTerrain){const Z=j.getSource();Z.attribution&&r.indexOf(Z.attribution)<0&&r.push(Z.attribution)}}r=r.filter(k=>String(k).trim()),r.sort((k,j)=>k.length-j.length),r=r.filter((k,j)=>{for(let Z=j+1;Z<r.length;Z++)if(r[Z].indexOf(k)>=0)return!1;return!0});const C=r.join(" | ");C!==this._sanitizedAttributionHTML&&(this._sanitizedAttributionHTML=Q.sanitize(C),r.length?(this._innerContainer.innerHTML=this._sanitizedAttributionHTML,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Bl{constructor(r={}){this._updateCompact=()=>{const p=this._container.children;if(p.length){const C=p[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&C.classList.add("maplibregl-compact"):C.classList.remove("maplibregl-compact")}},this.options=r}getDefaultPosition(){return"bottom-left"}onAdd(r){this._map=r,this._compact=this.options&&this.options.compact,this._container=Q.create("div","maplibregl-ctrl");const p=Q.create("a","maplibregl-ctrl-logo");return p.target="_blank",p.rel="noopener nofollow",p.href="https://maplibre.org/",p.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),p.setAttribute("rel","noopener nofollow"),this._container.appendChild(p),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){Q.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class $o{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const p=++this._id;return this._queue.push({callback:r,id:p,cancelled:!1}),p}remove(r){const p=this._currentlyRunning,C=p?this._queue.concat(p):this._queue;for(const k of C)if(k.id===r)return void(k.cancelled=!0)}run(r=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const p=this._currentlyRunning=this._queue;this._queue=[];for(const C of p)if(!C.cancelled&&(C.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var pp=t.aA([{name:"a_pos3d",type:"Int16",components:3}]);class Ss extends t.E{constructor(r){super(),this._lastTilesetChange=J.now(),this.sourceCache=r,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.deltaZoom=1,this.tileSize=r._source.tileSize*2**this.deltaZoom,r.usedForTerrain=!0,r.tileSize=this.tileSize}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(r,p){this.sourceCache.update(r,p),this._renderableTilesKeys=[];const C={};for(const k of bt(r,{tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:p,calculateTileZoom:this.sourceCache._source.calculateTileZoom}))C[k.key]=!0,this._renderableTilesKeys.push(k.key),this._tiles[k.key]||(k.terrainRttPosMatrix32f=new Float64Array(16),t.bL(k.terrainRttPosMatrix32f,0,t.X,t.X,0,0,1),this._tiles[k.key]=new Ta(k,this.tileSize),this._lastTilesetChange=J.now());for(const k in this._tiles)C[k]||delete this._tiles[k]}freeRtt(r){for(const p in this._tiles){const C=this._tiles[p];(!r||C.tileID.equals(r)||C.tileID.isChildOf(r)||r.isChildOf(C.tileID))&&(C.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(r=>this.getTileByID(r))}getTileByID(r){return this._tiles[r]}getTerrainCoords(r){const p={};for(const C of this._renderableTilesKeys){const k=this._tiles[C].tileID,j=r.clone(),Z=t.a$();if(k.canonical.equals(r.canonical))t.bL(Z,0,t.X,t.X,0,0,1);else if(k.canonical.isChildOf(r.canonical)){const re=k.canonical.z-r.canonical.z,ue=k.canonical.x-(k.canonical.x>>re<<re),ye=k.canonical.y-(k.canonical.y>>re<<re),Me=t.X>>re;t.bL(Z,0,Me,Me,0,0,1),t.J(Z,Z,[-ue*Me,-ye*Me,0])}else{if(!r.canonical.isChildOf(k.canonical))continue;{const re=r.canonical.z-k.canonical.z,ue=r.canonical.x-(r.canonical.x>>re<<re),ye=r.canonical.y-(r.canonical.y>>re<<re),Me=t.X>>re;t.bL(Z,0,t.X,t.X,0,0,1),t.J(Z,Z,[ue*Me,ye*Me,0]),t.K(Z,Z,[1/2**re,1/2**re,0])}}j.terrainRttPosMatrix32f=new Float32Array(Z),p[C]=j}return p}getSourceTile(r,p){const C=this.sourceCache._source;let k=r.overscaledZ-this.deltaZoom;if(k>C.maxzoom&&(k=C.maxzoom),k<C.minzoom)return null;this._sourceTileCache[r.key]||(this._sourceTileCache[r.key]=r.scaledTo(k).key);let j=this.sourceCache.getTileByID(this._sourceTileCache[r.key]);if((!j||!j.dem)&&p)for(;k>=C.minzoom&&(!j||!j.dem);)j=this.sourceCache.getTileByID(r.scaledTo(k--).key);return j}anyTilesAfterTime(r=Date.now()){return this._lastTilesetChange>=r}}class eh{constructor(r,p,C){this._meshCache={},this.painter=r,this.sourceCache=new Ss(p),this.options=C,this.exaggeration=typeof C.exaggeration=="number"?C.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(r,p,C,k=t.X){var j;if(!(p>=0&&p<k&&C>=0&&C<k))return 0;const Z=this.getTerrainData(r),re=(j=Z.tile)===null||j===void 0?void 0:j.dem;if(!re)return 0;const ue=t.c9([],[p/k*t.X,C/k*t.X],Z.u_terrain_matrix),ye=[ue[0]*re.dim,ue[1]*re.dim],Me=Math.floor(ye[0]),Re=Math.floor(ye[1]),ze=ye[0]-Me,Je=ye[1]-Re;return re.get(Me,Re)*(1-ze)*(1-Je)+re.get(Me+1,Re)*ze*(1-Je)+re.get(Me,Re+1)*(1-ze)*Je+re.get(Me+1,Re+1)*ze*Je}getElevationForLngLatZoom(r,p){if(!t.ca(p,r.wrap()))return 0;const{tileID:C,mercatorX:k,mercatorY:j}=this._getOverscaledTileIDFromLngLatZoom(r,p);return this.getElevation(C,k%t.X,j%t.X,t.X)}getElevation(r,p,C,k=t.X){return this.getDEMElevation(r,p,C,k)*this.exaggeration}getTerrainData(r){if(!this._emptyDemTexture){const k=this.painter.context,j=new t.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new qe(k,j,k.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new qe(k,new t.R({width:1,height:1}),k.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(k.gl.NEAREST,k.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=t.aq([])}const p=this.sourceCache.getSourceTile(r,!0);if(p&&p.dem&&(!p.demTexture||p.needsTerrainPrepare)){const k=this.painter.context;p.demTexture=this.painter.getTileTexture(p.dem.stride),p.demTexture?p.demTexture.update(p.dem.getPixels(),{premultiply:!1}):p.demTexture=new qe(k,p.dem.getPixels(),k.gl.RGBA,{premultiply:!1}),p.demTexture.bind(k.gl.NEAREST,k.gl.CLAMP_TO_EDGE),p.needsTerrainPrepare=!1}const C=p&&p+p.tileID.key+r.key;if(C&&!this._demMatrixCache[C]){const k=this.sourceCache.sourceCache._source.maxzoom;let j=r.canonical.z-p.tileID.canonical.z;r.overscaledZ>r.canonical.z&&(r.canonical.z>=k?j=r.canonical.z-k:t.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const Z=r.canonical.x-(r.canonical.x>>j<<j),re=r.canonical.y-(r.canonical.y>>j<<j),ue=t.cb(new Float64Array(16),[1/(t.X<<j),1/(t.X<<j),0]);t.J(ue,ue,[Z*t.X,re*t.X,0]),this._demMatrixCache[r.key]={matrix:ue,coord:r}}return{u_depth:2,u_terrain:3,u_terrain_dim:p&&p.dem&&p.dem.dim||1,u_terrain_matrix:C?this._demMatrixCache[r.key].matrix:this._emptyDemMatrix,u_terrain_unpack:p&&p.dem&&p.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(p&&p.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:p}}getFramebuffer(r){const p=this.painter,C=p.width/devicePixelRatio,k=p.height/devicePixelRatio;return!this._fbo||this._fbo.width===C&&this._fbo.height===k||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new qe(p.context,{width:C,height:k,data:null},p.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(p.context.gl.NEAREST,p.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new qe(p.context,{width:C,height:k,data:null},p.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(p.context.gl.NEAREST,p.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=p.context.createFramebuffer(C,k,!0,!1),this._fbo.depthAttachment.set(p.context.createRenderbuffer(p.context.gl.DEPTH_COMPONENT16,C,k))),this._fbo.colorAttachment.set(r==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const r=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const p=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let j=0,Z=0;j<this._coordsTextureSize;j++)for(let re=0;re<this._coordsTextureSize;re++,Z+=4)p[Z+0]=255&re,p[Z+1]=255&j,p[Z+2]=re>>8<<4|j>>8,p[Z+3]=0;const C=new t.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(p.buffer)),k=new qe(r,C,r.gl.RGBA,{premultiply:!1});return k.bind(r.gl.NEAREST,r.gl.CLAMP_TO_EDGE),this._coordsTexture=k,k}pointCoordinate(r){this.painter.maybeDrawDepthAndCoords(!0);const p=new Uint8Array(4),C=this.painter.context,k=C.gl,j=Math.round(r.x*this.painter.pixelRatio/devicePixelRatio),Z=Math.round(r.y*this.painter.pixelRatio/devicePixelRatio),re=Math.round(this.painter.height/devicePixelRatio);C.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),k.readPixels(j,re-Z-1,1,1,k.RGBA,k.UNSIGNED_BYTE,p),C.bindFramebuffer.set(null);const ue=p[0]+(p[2]>>4<<8),ye=p[1]+((15&p[2])<<8),Me=this.coordsIndex[255-p[3]],Re=Me&&this.sourceCache.getTileByID(Me);if(!Re)return null;const ze=this._coordsTextureSize,Je=(1<<Re.tileID.canonical.z)*ze;return new t.Y((Re.tileID.canonical.x*ze+ue)/Je+Re.tileID.wrap,(Re.tileID.canonical.y*ze+ye)/Je,this.getElevation(Re.tileID,ue,ye,ze))}depthAtPoint(r){const p=new Uint8Array(4),C=this.painter.context,k=C.gl;return C.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),k.readPixels(r.x,this.painter.height/devicePixelRatio-r.y-1,1,1,k.RGBA,k.UNSIGNED_BYTE,p),C.bindFramebuffer.set(null),(p[0]/16777216+p[1]/65536+p[2]/256+p[3])/256}getTerrainMesh(r){var p;const C=((p=this.painter.style.projection)===null||p===void 0?void 0:p.transitionState)>0,k=C&&r.canonical.y===0,j=C&&r.canonical.y===(1<<r.canonical.z)-1,Z=`m_${k?"n":""}_${j?"s":""}`;if(this._meshCache[Z])return this._meshCache[Z];const re=this.painter.context,ue=new t.cc,ye=new t.aE,Me=this.meshSize,Re=t.X/Me,ze=Me*Me;for(let an=0;an<=Me;an++)for(let Mn=0;Mn<=Me;Mn++)ue.emplaceBack(Mn*Re,an*Re,0);for(let an=0;an<ze;an+=Me+1)for(let Mn=0;Mn<Me;Mn++)ye.emplaceBack(Mn+an,Me+Mn+an+1,Me+Mn+an+2),ye.emplaceBack(Mn+an,Me+Mn+an+2,Mn+an+1);const Je=ue.length,ot=Je+(Me+1),Pt=(Me+1)*Me,Et=k?t.b6:0,Lt=k?0:1,jt=j?t.b7:t.X,Nt=j?0:1;for(let an=0;an<=Me;an++)ue.emplaceBack(an*Re,Et,Lt);for(let an=0;an<=Me;an++)ue.emplaceBack(an*Re,jt,Nt);for(let an=0;an<Me;an++)ye.emplaceBack(Pt+an,ot+an,ot+an+1),ye.emplaceBack(Pt+an,ot+an+1,Pt+an+1),ye.emplaceBack(0+an,Je+an+1,Je+an),ye.emplaceBack(0+an,0+an+1,Je+an+1);const Bt=ue.length,nn=Bt+2*(Me+1);for(const an of[0,1])for(let Mn=0;Mn<=Me;Mn++)for(const Rn of[0,1])ue.emplaceBack(an*t.X,Mn*Re,Rn);for(let an=0;an<2*Me;an+=2)ye.emplaceBack(Bt+an,Bt+an+1,Bt+an+3),ye.emplaceBack(Bt+an,Bt+an+3,Bt+an+2),ye.emplaceBack(nn+an,nn+an+3,nn+an+1),ye.emplaceBack(nn+an,nn+an+2,nn+an+3);const rn=new Bs(re.createVertexBuffer(ue,pp.members),re.createIndexBuffer(ye),t.aD.simpleSegment(0,0,ue.length,ye.length));return this._meshCache[Z]=rn,rn}getMeshFrameDelta(r){return 2*Math.PI*t.bo/Math.pow(2,Math.max(r,0))/5}getMinTileElevationForLngLatZoom(r,p){var C;const{tileID:k}=this._getOverscaledTileIDFromLngLatZoom(r,p);return(C=this.getMinMaxElevation(k).minElevation)!==null&&C!==void 0?C:0}getMinMaxElevation(r){const p=this.getTerrainData(r).tile,C={minElevation:null,maxElevation:null};return p&&p.dem&&(C.minElevation=p.dem.min*this.exaggeration,C.maxElevation=p.dem.max*this.exaggeration),C}_getOverscaledTileIDFromLngLatZoom(r,p){const C=t.Y.fromLngLat(r.wrap()),k=(1<<p)*t.X,j=C.x*k,Z=C.y*k,re=Math.floor(j/t.X),ue=Math.floor(Z/t.X);return{tileID:new t.S(p,0,p,re,ue),mercatorX:j,mercatorY:Z}}}class vu{constructor(r,p,C){this._context=r,this._size=p,this._tileSize=C,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const r of this._objects)r.texture.destroy(),r.fbo.destroy()}_createObject(r){const p=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),C=new qe(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return C.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),this._context.extTextureFilterAnisotropic&&this._context.gl.texParameterf(this._context.gl.TEXTURE_2D,this._context.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._context.extTextureFilterAnisotropicMax),p.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),p.colorAttachment.set(C.texture),{id:r,fbo:p,texture:C,stamp:-1,inUse:!1}}getObjectForId(r){return this._objects[r]}useObject(r){r.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(p=>r.id!==p),this._recentlyUsed.push(r.id)}stampObject(r){r.stamp=++this._stamp}getOrCreateFreeObject(){for(const p of this._recentlyUsed)if(!this._objects[p].inUse)return this._objects[p];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const r=this._createObject(this._objects.length);return this._objects.push(r),r}freeObject(r){r.inUse=!1}freeAllObjects(){for(const r of this._objects)this.freeObject(r)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(r=>!r.inUse)===!1}}const Ra={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class cs{constructor(r,p){this.painter=r,this.terrain=p,this.pool=new vu(r.context,30,p.sourceCache.tileSize*p.qualityFactor)}destruct(){this.pool.destruct()}getTexture(r){return this.pool.getObjectForId(r.rtt[this._stacks.length-1].id).texture}prepareForRender(r,p){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=r._order.filter(C=>!r._layers[C].isHidden(p)),this._coordsAscending={};for(const C in r.sourceCaches){this._coordsAscending[C]={};const k=r.sourceCaches[C].getVisibleCoordinates();for(const j of k){const Z=this.terrain.sourceCache.getTerrainCoords(j);for(const re in Z)this._coordsAscending[C][re]||(this._coordsAscending[C][re]=[]),this._coordsAscending[C][re].push(Z[re])}}this._coordsAscendingStr={};for(const C of r._order){const k=r._layers[C],j=k.source;if(Ra[k.type]&&!this._coordsAscendingStr[j]){this._coordsAscendingStr[j]={};for(const Z in this._coordsAscending[j])this._coordsAscendingStr[j][Z]=this._coordsAscending[j][Z].map(re=>re.key).sort().join()}}for(const C of this._renderableTiles)for(const k in this._coordsAscendingStr){const j=this._coordsAscendingStr[k][C.tileID.key];j&&j!==C.rttCoords[k]&&(C.rtt=[])}}renderLayer(r,p){if(r.isHidden(this.painter.transform.zoom))return!1;const C=Object.assign(Object.assign({},p),{isRenderingToTexture:!0}),k=r.type,j=this.painter,Z=this._renderableLayerIds[this._renderableLayerIds.length-1]===r.id;if(Ra[k]&&(this._prevType&&Ra[this._prevType]||this._stacks.push([]),this._prevType=k,this._stacks[this._stacks.length-1].push(r.id),!Z))return!0;if(Ra[this._prevType]||Ra[k]&&Z){this._prevType=k;const re=this._stacks.length-1,ue=this._stacks[re]||[];for(const ye of this._renderableTiles){if(this.pool.isFull()&&(Ku(this.painter,this.terrain,this._rttTiles,C),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(ye),ye.rtt[re]){const Re=this.pool.getObjectForId(ye.rtt[re].id);if(Re.stamp===ye.rtt[re].stamp){this.pool.useObject(Re);continue}}const Me=this.pool.getOrCreateFreeObject();this.pool.useObject(Me),this.pool.stampObject(Me),ye.rtt[re]={id:Me.id,stamp:Me.stamp},j.context.bindFramebuffer.set(Me.fbo.framebuffer),j.context.clear({color:t.b4.transparent,stencil:0}),j.currentStencilSource=void 0;for(let Re=0;Re<ue.length;Re++){const ze=j.style._layers[ue[Re]],Je=ze.source?this._coordsAscending[ze.source][ye.tileID.key]:[ye.tileID];j.context.viewport.set([0,0,Me.fbo.width,Me.fbo.height]),j._renderTileClippingMasks(ze,Je,!0),j.renderLayer(j,j.style.sourceCaches[ze.source],ze,Je,C),ze.source&&(ye.rttCoords[ze.source]=this._coordsAscendingStr[ze.source][ye.tileID.key])}}return Ku(this.painter,this.terrain,this._rttTiles,C),this._rttTiles=[],this.pool.freeAllObjects(),Ra[k]}return!1}}const mf={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","GlobeControl.Enable":"Enable globe","GlobeControl.Disable":"Disable globe","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Sd=G,Go={hash:!1,interactive:!0,bearingSnap:7,attributionControl:bd,maplibreLogo:!1,refreshExpiredTiles:!0,canvasContextAttributes:{antialias:!1,preserveDrawingBuffer:!1,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,desynchronized:!1,contextType:void 0},scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],elevation:0,zoom:0,bearing:0,pitch:0,roll:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:t.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,rollEnabled:!1,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0,centerClampedToGround:!0},ba={showCompass:!0,showZoom:!0,visualizePitch:!1,visualizeRoll:!0};class th{constructor(r,p,C=!1){this.mousedown=j=>{this.startMove(j,Q.mousePos(this.element,j)),Q.addEventListener(window,"mousemove",this.mousemove),Q.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=j=>{this.move(j,Q.mousePos(this.element,j))},this.mouseup=j=>{this._rotatePitchHanlder.dragEnd(j),this.offTemp()},this.touchstart=j=>{j.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Q.touchPos(this.element,j.targetTouches)[0],this.startMove(j,this._startPos),Q.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),Q.addEventListener(window,"touchend",this.touchend))},this.touchmove=j=>{j.targetTouches.length!==1?this.reset():(this._lastPos=Q.touchPos(this.element,j.targetTouches)[0],this.move(j,this._lastPos))},this.touchend=j=>{j.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this._rotatePitchHanlder.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10,this.element=p;const k=new kh;this._rotatePitchHanlder=new Yi({clickTolerance:3,move:(j,Z)=>{const re=p.getBoundingClientRect(),ue=new t.P((re.bottom-re.top)/2,(re.right-re.left)/2);return{bearingDelta:t.c7(new t.P(j.x,Z.y),Z,ue),pitchDelta:C?-.5*(Z.y-j.y):void 0}},moveStateManager:k,enable:!0,assignEvents:()=>{}}),this.map=r,Q.addEventListener(p,"mousedown",this.mousedown),Q.addEventListener(p,"touchstart",this.touchstart,{passive:!1}),Q.addEventListener(p,"touchcancel",this.reset)}startMove(r,p){this._rotatePitchHanlder.dragStart(r,p),Q.disableDrag()}move(r,p){const C=this.map,{bearingDelta:k,pitchDelta:j}=this._rotatePitchHanlder.dragMove(r,p)||{};k&&C.setBearing(C.getBearing()+k),j&&C.setPitch(C.getPitch()+j)}off(){const r=this.element;Q.removeEventListener(r,"mousedown",this.mousedown),Q.removeEventListener(r,"touchstart",this.touchstart,{passive:!1}),Q.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Q.removeEventListener(window,"touchend",this.touchend),Q.removeEventListener(r,"touchcancel",this.reset),this.offTemp()}offTemp(){Q.enableDrag(),Q.removeEventListener(window,"mousemove",this.mousemove),Q.removeEventListener(window,"mouseup",this.mouseup),Q.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),Q.removeEventListener(window,"touchend",this.touchend)}}let ec;function Gc(B,r,p){const C=new t.N(B.lng,B.lat);if(B=new t.N(B.lng,B.lat),r){const k=new t.N(B.lng-360,B.lat),j=new t.N(B.lng+360,B.lat),Z=p.locationToScreenPoint(B).distSqr(r);p.locationToScreenPoint(k).distSqr(r)<Z?B=k:p.locationToScreenPoint(j).distSqr(r)<Z&&(B=j)}for(;Math.abs(B.lng-p.center.lng)>180;){const k=p.locationToScreenPoint(B);if(k.x>=0&&k.y>=0&&k.x<=p.width&&k.y<=p.height)break;B.lng>p.center.lng?B.lng-=360:B.lng+=360}return B.lng!==C.lng&&p.isPointOnMapSurface(p.locationToScreenPoint(B))?B:C}const vc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function gf(B,r,p){const C=B.classList;for(const k in vc)C.remove(`maplibregl-${p}-anchor-${k}`);C.add(`maplibregl-${p}-anchor-${r}`)}class _f extends t.E{constructor(r){if(super(),this._onKeyPress=p=>{const C=p.code,k=p.charCode||p.keyCode;C!=="Space"&&C!=="Enter"&&k!==32&&k!==13||this.togglePopup()},this._onMapClick=p=>{const C=p.originalEvent.target,k=this._element;this._popup&&(C===k||k.contains(C))&&this.togglePopup()},this._update=p=>{var C;if(!this._map)return;const k=this._map.loaded()&&!this._map.isMoving();((p==null?void 0:p.type)==="terrain"||(p==null?void 0:p.type)==="render"&&!k)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Gc(this._lngLat,this._flatPos,this._map.transform):(C=this._lngLat)===null||C===void 0?void 0:C.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationToScreenPoint(this._lngLat)._add(this._offset));let j="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?j=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(j=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let Z="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?Z="rotateX(0deg)":this._pitchAlignment==="map"&&(Z=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||p&&p.type!=="moveend"||(this._pos=this._pos.round()),Q.setTransform(this._element,`${vc[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${Z} ${j}`),J.frameAsync(new AbortController).then(()=>{this._updateOpacity(p&&p.type==="moveend")}).catch(()=>{})},this._onMove=p=>{if(!this._isDragging){const C=this._clickTolerance||this._map._clickTolerance;this._isDragging=p.point.dist(this._pointerdownPos)>=C}this._isDragging&&(this._pos=p.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new t.k("dragstart"))),this.fire(new t.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new t.k("dragend")),this._state="inactive"},this._addDragHandler=p=>{this._element.contains(p.originalEvent.target)&&(p.preventDefault(),this._positionDelta=p.point.sub(this._pos).add(this._offset),this._pointerdownPos=p.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._subpixelPositioning=r&&r.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment!=="auto"?r.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(r==null?void 0:r.opacity,r==null?void 0:r.opacityWhenCovered),r&&r.element)this._element=r.element,this._offset=t.P.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=Q.create("div");const p=Q.createNS("http://www.w3.org/2000/svg","svg"),C=41,k=27;p.setAttributeNS(null,"display","block"),p.setAttributeNS(null,"height",`${C}px`),p.setAttributeNS(null,"width",`${k}px`),p.setAttributeNS(null,"viewBox",`0 0 ${k} ${C}`);const j=Q.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"stroke","none"),j.setAttributeNS(null,"stroke-width","1"),j.setAttributeNS(null,"fill","none"),j.setAttributeNS(null,"fill-rule","evenodd");const Z=Q.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"fill-rule","nonzero");const re=Q.createNS("http://www.w3.org/2000/svg","g");re.setAttributeNS(null,"transform","translate(3.0, 29.0)"),re.setAttributeNS(null,"fill","#000000");const ue=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Lt of ue){const jt=Q.createNS("http://www.w3.org/2000/svg","ellipse");jt.setAttributeNS(null,"opacity","0.04"),jt.setAttributeNS(null,"cx","10.5"),jt.setAttributeNS(null,"cy","5.80029008"),jt.setAttributeNS(null,"rx",Lt.rx),jt.setAttributeNS(null,"ry",Lt.ry),re.appendChild(jt)}const ye=Q.createNS("http://www.w3.org/2000/svg","g");ye.setAttributeNS(null,"fill",this._color);const Me=Q.createNS("http://www.w3.org/2000/svg","path");Me.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),ye.appendChild(Me);const Re=Q.createNS("http://www.w3.org/2000/svg","g");Re.setAttributeNS(null,"opacity","0.25"),Re.setAttributeNS(null,"fill","#000000");const ze=Q.createNS("http://www.w3.org/2000/svg","path");ze.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Re.appendChild(ze);const Je=Q.createNS("http://www.w3.org/2000/svg","g");Je.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Je.setAttributeNS(null,"fill","#FFFFFF");const ot=Q.createNS("http://www.w3.org/2000/svg","g");ot.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Pt=Q.createNS("http://www.w3.org/2000/svg","circle");Pt.setAttributeNS(null,"fill","#000000"),Pt.setAttributeNS(null,"opacity","0.25"),Pt.setAttributeNS(null,"cx","5.5"),Pt.setAttributeNS(null,"cy","5.5"),Pt.setAttributeNS(null,"r","5.4999962");const Et=Q.createNS("http://www.w3.org/2000/svg","circle");Et.setAttributeNS(null,"fill","#FFFFFF"),Et.setAttributeNS(null,"cx","5.5"),Et.setAttributeNS(null,"cy","5.5"),Et.setAttributeNS(null,"r","5.4999962"),ot.appendChild(Pt),ot.appendChild(Et),Z.appendChild(re),Z.appendChild(ye),Z.appendChild(Re),Z.appendChild(Je),Z.appendChild(ot),p.appendChild(Z),p.setAttributeNS(null,"height",C*this._scale+"px"),p.setAttributeNS(null,"width",k*this._scale+"px"),this._element.appendChild(p),this._offset=t.P.convert(r&&r.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",p=>{p.preventDefault()}),this._element.addEventListener("mousedown",p=>{p.preventDefault()}),gf(this._element,this._anchor,"marker"),r&&r.className)for(const p of r.className.split(" "))this._element.classList.add(p);this._popup=null}addTo(r){return this.remove(),this._map=r,this._element.setAttribute("aria-label",r._getUIString("Marker.Title")),r.getCanvasContainer().appendChild(this._element),r.on("move",this._update),r.on("moveend",this._update),r.on("terrain",this._update),r.on("projectiontransition",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("projectiontransition",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Q.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=t.N.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const k=Math.abs(13.5)/Math.SQRT2;r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[k,-1*(38.1-13.5+k)],"bottom-right":[-k,-1*(38.1-13.5+k)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(r){return this._subpixelPositioning=r,this}getPopup(){return this._popup}togglePopup(){const r=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:r?(r.isOpen()?r.remove():(r.setLngLat(this._lngLat),r.addTo(this._map)),this):this}_updateOpacity(r=!1){var p,C;if(!(!((p=this._map)===null||p===void 0)&&p.terrain)){const Re=this._map.transform.isLocationOccluded(this._lngLat)?this._opacityWhenCovered:this._opacity;return void(this._element.style.opacity!==Re&&(this._element.style.opacity=Re))}if(r)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const k=this._map,j=k.terrain.depthAtPoint(this._pos),Z=k.terrain.getElevationForLngLatZoom(this._lngLat,k.transform.tileZoom);if(k.transform.lngLatToCameraDepth(this._lngLat,Z)-j<.006)return void(this._element.style.opacity=this._opacity);const re=-this._offset.y/k.transform.pixelsPerMeter,ue=Math.sin(k.getPitch()*Math.PI/180)*re,ye=k.terrain.depthAtPoint(new t.P(this._pos.x,this._pos.y-this._offset.y)),Me=k.transform.lngLatToCameraDepth(this._lngLat,Z+ue)-ye>.006;!((C=this._popup)===null||C===void 0)&&C.isOpen()&&Me&&this._popup.remove(),this._element.style.opacity=Me?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(r){return this._offset=t.P.convert(r),this._update(),this}addClassName(r){this._element.classList.add(r)}removeClassName(r){this._element.classList.remove(r)}toggleClassName(r){return this._element.classList.toggle(r)}setDraggable(r){return this._draggable=!!r,this._map&&(r?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r&&r!=="auto"?r:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(r,p){return r===void 0&&p===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),r!==void 0&&(this._opacity=r),p!==void 0&&(this._opacityWhenCovered=p),this._map&&this._updateOpacity(!0),this}}const nh={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let xc=0,Xn=!1;const Ei={maxWidth:100,unit:"metric"};function bc(B,r,p){const C=p&&p.maxWidth||100,k=B._container.clientHeight/2,j=B._container.clientWidth/2,Z=B.unproject([j-C/2,k]),re=B.unproject([j+C/2,k]),ue=Math.round(B.project(re).x-B.project(Z).x),ye=Math.min(C,ue,B._container.clientWidth),Me=Z.distanceTo(re);if(p&&p.unit==="imperial"){const Re=3.2808*Me;Re>5280?_a(r,ye,Re/5280,B._getUIString("ScaleControl.Miles")):_a(r,ye,Re,B._getUIString("ScaleControl.Feet"))}else p&&p.unit==="nautical"?_a(r,ye,Me/1852,B._getUIString("ScaleControl.NauticalMiles")):Me>=1e3?_a(r,ye,Me/1e3,B._getUIString("ScaleControl.Kilometers")):_a(r,ye,Me,B._getUIString("ScaleControl.Meters"))}function _a(B,r,p,C){const k=function(j){const Z=Math.pow(10,`${Math.floor(j)}`.length-1);let re=j/Z;return re=re>=10?10:re>=5?5:re>=3?3:re>=2?2:re>=1?1:function(ue){const ye=Math.pow(10,Math.ceil(-Math.log(ue)/Math.LN10));return Math.round(ue*ye)/ye}(re),Z*re}(p);B.style.width=r*(k/p)+"px",B.innerHTML=`${k}&nbsp;${C}`}const tn={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},mp=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ih(B){if(B){if(typeof B=="number"){const r=Math.round(Math.abs(B)/Math.SQRT2);return{center:new t.P(0,0),top:new t.P(0,B),"top-left":new t.P(r,r),"top-right":new t.P(-r,r),bottom:new t.P(0,-B),"bottom-left":new t.P(r,-r),"bottom-right":new t.P(-r,-r),left:new t.P(B,0),right:new t.P(-B,0)}}if(B instanceof t.P||Array.isArray(B)){const r=t.P.convert(B);return{center:r,top:r,"top-left":r,"top-right":r,bottom:r,"bottom-left":r,"bottom-right":r,left:r,right:r}}return{center:t.P.convert(B.center||[0,0]),top:t.P.convert(B.top||[0,0]),"top-left":t.P.convert(B["top-left"]||[0,0]),"top-right":t.P.convert(B["top-right"]||[0,0]),bottom:t.P.convert(B.bottom||[0,0]),"bottom-left":t.P.convert(B["bottom-left"]||[0,0]),"bottom-right":t.P.convert(B["bottom-right"]||[0,0]),left:t.P.convert(B.left||[0,0]),right:t.P.convert(B.right||[0,0])}}return ih(new t.P(0,0))}const yf=G;T.AJAXError=t.cg,T.Event=t.k,T.Evented=t.E,T.LngLat=t.N,T.MercatorCoordinate=t.Y,T.Point=t.P,T.addProtocol=t.ch,T.config=t.a,T.removeProtocol=t.ci,T.AttributionControl=wd,T.BoxZoomHandler=hf,T.CanvasSource=Ki,T.CooperativeGesturesHandler=fp,T.DoubleClickZoomHandler=yc,T.DragPanHandler=$c,T.DragRotateHandler=$i,T.EdgeInsets=ts,T.FullscreenControl=class extends t.E{constructor(B={}){super(),this._onFullscreenChange=()=>{var r;let p=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((r=p==null?void 0:p.shadowRoot)===null||r===void 0)&&r.fullscreenElement;)p=p.shadowRoot.fullscreenElement;p===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,B&&B.container&&(B.container instanceof HTMLElement?this._container=B.container:t.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(B){return this._map=B,this._container||(this._container=this._map.getContainer()),this._controlContainer=Q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){Q.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const B=this._fullscreenButton=Q.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);Q.create("span","maplibregl-ctrl-icon",B).setAttribute("aria-hidden","true"),B.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const B=this._getTitle();this._fullscreenButton.setAttribute("aria-label",B),this._fullscreenButton.title=B}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new t.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new t.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},T.GeoJSONSource=vi,T.GeolocateControl=class extends t.E{constructor(B){super(),this._onSuccess=r=>{if(this._map){if(this._isOutOfMapMaxBounds(r))return this._setErrorState(),this.fire(new t.k("outofmaxbounds",r)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=r,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(r),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(r),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new t.k("geolocate",r)),this._finish()}},this._updateCamera=r=>{const p=new t.N(r.coords.longitude,r.coords.latitude),C=r.coords.accuracy,k=this._map.getBearing(),j=t.e({bearing:k},this.options.fitBoundsOptions),Z=at.fromLngLat(p,C);this._map.fitBounds(Z,j,{geolocateSource:!0})},this._updateMarker=r=>{if(r){const p=new t.N(r.coords.longitude,r.coords.latitude);this._accuracyCircleMarker.setLngLat(p).addTo(this._map),this._userLocationDotMarker.setLngLat(p).addTo(this._map),this._accuracy=r.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=r=>{if(this._map){if(this.options.trackUserLocation)if(r.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const p=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=p,this._geolocateButton.setAttribute("aria-label",p),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(r.code===3&&Xn)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new t.k("error",r)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=Q.create("button","maplibregl-ctrl-geolocate",this._container),Q.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=r=>{if(this._map){if(r===!1){t.w("Geolocation support is not available so the GeolocateControl will be disabled.");const p=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=p,this._geolocateButton.setAttribute("aria-label",p)}else{const p=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=p,this._geolocateButton.setAttribute("aria-label",p)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Q.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new _f({element:this._dotElement}),this._circleElement=Q.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new _f({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",p=>{p.geolocateSource||this._watchState!=="ACTIVE_LOCK"||p.originalEvent&&p.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new t.k("trackuserlocationend")),this.fire(new t.k("userlocationlostfocus")))})}},this.options=t.e({},nh,B)}onAdd(B){return this._map=B,this._container=Q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return t._(this,arguments,void 0,function*(r=!1){if(ec!==void 0&&!r)return ec;if(window.navigator.permissions===void 0)return ec=!!window.navigator.geolocation,ec;try{ec=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{ec=!!window.navigator.geolocation}return ec})}().then(r=>this._finishSetupUI(r)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Q.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,xc=0,Xn=!1}_isOutOfMapMaxBounds(B){const r=this._map.getMaxBounds(),p=B.coords;return r&&(p.longitude<r.getWest()||p.longitude>r.getEast()||p.latitude<r.getSouth()||p.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const B=this._map.getBounds(),r=B.getSouthEast(),p=B.getNorthEast(),C=r.distanceTo(p),k=Math.ceil(this._accuracy/(C/this._map._container.clientHeight)*2);this._circleElement.style.width=`${k}px`,this._circleElement.style.height=`${k}px`}trigger(){if(!this._setup)return t.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":xc--,Xn=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new t.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.k("trackuserlocationstart")),this.fire(new t.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let B;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),xc++,xc>1?(B={maximumAge:6e5,timeout:0},Xn=!0):(B=this.options.positionOptions,Xn=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,B)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},T.GlobeControl=class{constructor(){this._toggleProjection=()=>{var B;const r=(B=this._map.getProjection())===null||B===void 0?void 0:B.type;this._map.setProjection(r!=="mercator"&&r?{type:"mercator"}:{type:"globe"}),this._updateGlobeIcon()},this._updateGlobeIcon=()=>{var B;this._globeButton.classList.remove("maplibregl-ctrl-globe"),this._globeButton.classList.remove("maplibregl-ctrl-globe-enabled"),((B=this._map.getProjection())===null||B===void 0?void 0:B.type)==="globe"?(this._globeButton.classList.add("maplibregl-ctrl-globe-enabled"),this._globeButton.title=this._map._getUIString("GlobeControl.Disable")):(this._globeButton.classList.add("maplibregl-ctrl-globe"),this._globeButton.title=this._map._getUIString("GlobeControl.Enable"))}}onAdd(B){return this._map=B,this._container=Q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._globeButton=Q.create("button","maplibregl-ctrl-globe",this._container),Q.create("span","maplibregl-ctrl-icon",this._globeButton).setAttribute("aria-hidden","true"),this._globeButton.type="button",this._globeButton.addEventListener("click",this._toggleProjection),this._updateGlobeIcon(),this._map.on("styledata",this._updateGlobeIcon),this._container}onRemove(){Q.remove(this._container),this._map.off("styledata",this._updateGlobeIcon),this._globeButton.removeEventListener("click",this._toggleProjection),this._map=void 0}},T.Hash=tm,T.ImageSource=ii,T.KeyboardHandler=Hm,T.LngLatBounds=at,T.LogoControl=Bl,T.Map=class extends xr{constructor(B){var r,p;t.cd.mark(t.ce.create);const C=Object.assign(Object.assign(Object.assign({},Go),B),{canvasContextAttributes:Object.assign(Object.assign({},Go.canvasContextAttributes),B.canvasContextAttributes)});if(C.minZoom!=null&&C.maxZoom!=null&&C.minZoom>C.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(C.minPitch!=null&&C.maxPitch!=null&&C.minPitch>C.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(C.minPitch!=null&&C.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(C.maxPitch!=null&&C.maxPitch>180)throw new Error("maxPitch must be less than or equal to 180");const k=new Dr,j=new su;if(C.minZoom!==void 0&&k.setMinZoom(C.minZoom),C.maxZoom!==void 0&&k.setMaxZoom(C.maxZoom),C.minPitch!==void 0&&k.setMinPitch(C.minPitch),C.maxPitch!==void 0&&k.setMaxPitch(C.maxPitch),C.renderWorldCopies!==void 0&&k.setRenderWorldCopies(C.renderWorldCopies),super(k,j,{bearingSnap:C.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new $o,this._controls=[],this._mapId=t.a1(),this._contextLost=re=>{re.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new t.k("webglcontextlost",{originalEvent:re}))},this._contextRestored=re=>{this._setupPainter(),this.resize(),this._update(),this.fire(new t.k("webglcontextrestored",{originalEvent:re}))},this._onMapScroll=re=>{if(re.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=C.interactive,this._maxTileCacheSize=C.maxTileCacheSize,this._maxTileCacheZoomLevels=C.maxTileCacheZoomLevels,this._canvasContextAttributes=Object.assign({},C.canvasContextAttributes),this._trackResize=C.trackResize===!0,this._bearingSnap=C.bearingSnap,this._centerClampedToGround=C.centerClampedToGround,this._refreshExpiredTiles=C.refreshExpiredTiles===!0,this._fadeDuration=C.fadeDuration,this._crossSourceCollisions=C.crossSourceCollisions===!0,this._collectResourceTiming=C.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},mf),C.locale),this._clickTolerance=C.clickTolerance,this._overridePixelRatio=C.pixelRatio,this._maxCanvasSize=C.maxCanvasSize,this.transformCameraUpdate=C.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=C.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=Le.addThrottleControl(()=>this.isMoving()),this._requestManager=new Oe(C.transformRequest),typeof C.container=="string"){if(this._container=document.getElementById(C.container),!this._container)throw new Error(`Container '${C.container}' not found.`)}else{if(!(C.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=C.container}if(C.maxBounds&&this.setMaxBounds(C.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let re=!1;const ue=Ju(ye=>{this._trackResize&&!this._removed&&(this.resize(ye),this.redraw())},50);this._resizeObserver=new ResizeObserver(ye=>{re?ue(ye):re=!0}),this._resizeObserver.observe(this._container)}this.handlers=new cr(this,C),this._hash=C.hash&&new tm(typeof C.hash=="string"&&C.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:C.center,elevation:C.elevation,zoom:C.zoom,bearing:C.bearing,pitch:C.pitch,roll:C.roll}),C.bounds&&(this.resize(),this.fitBounds(C.bounds,t.e({},C.fitBoundsOptions,{duration:0}))));const Z=typeof C.style=="string"||((p=(r=C.style)===null||r===void 0?void 0:r.projection)===null||p===void 0?void 0:p.type)!=="globe";this.resize(null,Z),this._localIdeographFontFamily=C.localIdeographFontFamily,this._validateStyle=C.validateStyle,C.style&&this.setStyle(C.style,{localIdeographFontFamily:C.localIdeographFontFamily}),C.attributionControl&&this.addControl(new wd(typeof C.attributionControl=="boolean"?void 0:C.attributionControl)),C.maplibreLogo&&this.addControl(new Bl,C.logoPosition),this.on("style.load",()=>{if(Z||this._resizeTransform(),this.transform.unmodified){const re=t.M(this.style.stylesheet,["center","zoom","bearing","pitch","roll"]);this.jumpTo(re)}}),this.on("data",re=>{this._update(re.dataType==="style"),this.fire(new t.k(`${re.dataType}data`,re))}),this.on("dataloading",re=>{this.fire(new t.k(`${re.dataType}dataloading`,re))}),this.on("dataabort",re=>{this.fire(new t.k("sourcedataabort",re))})}_getMapId(){return this._mapId}addControl(B,r){if(r===void 0&&(r=B.getDefaultPosition?B.getDefaultPosition():"top-right"),!B||!B.onAdd)return this.fire(new t.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const p=B.onAdd(this);this._controls.push(B);const C=this._controlPositions[r];return r.indexOf("bottom")!==-1?C.insertBefore(p,C.firstChild):C.appendChild(p),this}removeControl(B){if(!B||!B.onRemove)return this.fire(new t.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(B);return r>-1&&this._controls.splice(r,1),B.onRemove(this),this}hasControl(B){return this._controls.indexOf(B)>-1}calculateCameraOptionsFromTo(B,r,p,C){return C==null&&this.terrain&&(C=this.terrain.getElevationForLngLatZoom(p,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(B,r,p,C)}resize(B,r=!0){const[p,C]=this._containerDimensions(),k=this._getClampedPixelRatio(p,C);if(this._resizeCanvas(p,C,k),this.painter.resize(p,C,k),this.painter.overLimit()){const Z=this.painter.context.gl;this._maxCanvasSize=[Z.drawingBufferWidth,Z.drawingBufferHeight];const re=this._getClampedPixelRatio(p,C);this._resizeCanvas(p,C,re),this.painter.resize(p,C,re)}this._resizeTransform(r);const j=!this._moving;return j&&(this.stop(),this.fire(new t.k("movestart",B)).fire(new t.k("move",B))),this.fire(new t.k("resize",B)),j&&this.fire(new t.k("moveend",B)),this}_resizeTransform(B=!0){var r;const[p,C]=this._containerDimensions();this.transform.resize(p,C,B),(r=this._requestedCameraState)===null||r===void 0||r.resize(p,C,B)}_getClampedPixelRatio(B,r){const{0:p,1:C}=this._maxCanvasSize,k=this.getPixelRatio(),j=B*k,Z=r*k;return Math.min(j>p?p/j:1,Z>C?C/Z:1)*k}getPixelRatio(){var B;return(B=this._overridePixelRatio)!==null&&B!==void 0?B:devicePixelRatio}setPixelRatio(B){this._overridePixelRatio=B,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(B){return this.transform.setMaxBounds(at.convert(B)),this._update()}setMinZoom(B){if((B=B??-2)>=-2&&B<=this.transform.maxZoom)return this.transform.setMinZoom(B),this._update(),this.getZoom()<B&&this.setZoom(B),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(B){if((B=B??22)>=this.transform.minZoom)return this.transform.setMaxZoom(B),this._update(),this.getZoom()>B&&this.setZoom(B),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(B){if((B=B??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(B>=0&&B<=this.transform.maxPitch)return this.transform.setMinPitch(B),this._update(),this.getPitch()<B&&this.setPitch(B),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(B){if((B=B??60)>180)throw new Error("maxPitch must be less than or equal to 180");if(B>=this.transform.minPitch)return this.transform.setMaxPitch(B),this._update(),this.getPitch()>B&&this.setPitch(B),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(B){return this.transform.setRenderWorldCopies(B),this._update()}project(B){return this.transform.locationToScreenPoint(t.N.convert(B),this.style&&this.terrain)}unproject(B){return this.transform.screenPointToLocation(t.P.convert(B),this.terrain)}isMoving(){var B;return this._moving||((B=this.handlers)===null||B===void 0?void 0:B.isMoving())}isZooming(){var B;return this._zooming||((B=this.handlers)===null||B===void 0?void 0:B.isZooming())}isRotating(){var B;return this._rotating||((B=this.handlers)===null||B===void 0?void 0:B.isRotating())}_createDelegatedListener(B,r,p){if(B==="mouseenter"||B==="mouseover"){let C=!1;return{layers:r,listener:p,delegates:{mousemove:j=>{const Z=r.filter(ue=>this.getLayer(ue)),re=Z.length!==0?this.queryRenderedFeatures(j.point,{layers:Z}):[];re.length?C||(C=!0,p.call(this,new ms(B,this,j.originalEvent,{features:re}))):C=!1},mouseout:()=>{C=!1}}}}if(B==="mouseleave"||B==="mouseout"){let C=!1;return{layers:r,listener:p,delegates:{mousemove:Z=>{const re=r.filter(ue=>this.getLayer(ue));(re.length!==0?this.queryRenderedFeatures(Z.point,{layers:re}):[]).length?C=!0:C&&(C=!1,p.call(this,new ms(B,this,Z.originalEvent)))},mouseout:Z=>{C&&(C=!1,p.call(this,new ms(B,this,Z.originalEvent)))}}}}{const C=k=>{const j=r.filter(re=>this.getLayer(re)),Z=j.length!==0?this.queryRenderedFeatures(k.point,{layers:j}):[];Z.length&&(k.features=Z,p.call(this,k),delete k.features)};return{layers:r,listener:p,delegates:{[B]:C}}}}_saveDelegatedListener(B,r){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[B]=this._delegatedListeners[B]||[],this._delegatedListeners[B].push(r)}_removeDelegatedListener(B,r,p){if(!this._delegatedListeners||!this._delegatedListeners[B])return;const C=this._delegatedListeners[B];for(let k=0;k<C.length;k++){const j=C[k];if(j.listener===p&&j.layers.length===r.length&&j.layers.every(Z=>r.includes(Z))){for(const Z in j.delegates)this.off(Z,j.delegates[Z]);return void C.splice(k,1)}}}on(B,r,p){if(p===void 0)return super.on(B,r);const C=typeof r=="string"?[r]:r,k=this._createDelegatedListener(B,C,p);this._saveDelegatedListener(B,k);for(const j in k.delegates)this.on(j,k.delegates[j]);return{unsubscribe:()=>{this._removeDelegatedListener(B,C,p)}}}once(B,r,p){if(p===void 0)return super.once(B,r);const C=typeof r=="string"?[r]:r,k=this._createDelegatedListener(B,C,p);for(const j in k.delegates){const Z=k.delegates[j];k.delegates[j]=(...re)=>{this._removeDelegatedListener(B,C,p),Z(...re)}}this._saveDelegatedListener(B,k);for(const j in k.delegates)this.once(j,k.delegates[j]);return this}off(B,r,p){return p===void 0?super.off(B,r):(this._removeDelegatedListener(B,typeof r=="string"?[r]:r,p),this)}queryRenderedFeatures(B,r){if(!this.style)return[];let p;const C=B instanceof t.P||Array.isArray(B),k=C?B:[[0,0],[this.transform.width,this.transform.height]];if(r=r||(C?{}:B)||{},k instanceof t.P||typeof k[0]=="number")p=[t.P.convert(k)];else{const j=t.P.convert(k[0]),Z=t.P.convert(k[1]);p=[j,new t.P(Z.x,j.y),Z,new t.P(j.x,Z.y),j]}return this.style.queryRenderedFeatures(p,r,this.transform)}querySourceFeatures(B,r){return this.style.querySourceFeatures(B,r)}setStyle(B,r){return(r=t.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},r)).diff!==!1&&r.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&B?(this._diffStyle(B,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._updateStyle(B,r))}setTransformRequest(B){return this._requestManager.setTransformRequest(B),this}_getUIString(B){const r=this._locale[B];if(r==null)throw new Error(`Missing UI string '${B}'`);return r}_updateStyle(B,r){var p,C;if(r.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(B,r));const k=this.style&&r.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!B)),B?(this.style=new ps(this,r||{}),this.style.setEventedParent(this,{style:this.style}),typeof B=="string"?this.style.loadURL(B,r,k):this.style.loadJSON(B,r,k),this):((C=(p=this.style)===null||p===void 0?void 0:p.projection)===null||C===void 0||C.destroy(),delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ps(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(B,r){if(typeof B=="string"){const p=this._requestManager.transformRequest(B,"Style");t.h(p,new AbortController).then(C=>{this._updateDiff(C.data,r)}).catch(C=>{C&&this.fire(new t.j(C))})}else typeof B=="object"&&this._updateDiff(B,r)}_updateDiff(B,r){try{this.style.setState(B,r)&&this._update(!0)}catch(p){t.w(`Unable to perform style diff: ${p.message||p.error||p}.  Rebuilding the style from scratch.`),this._updateStyle(B,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():t.w("There is no style added to the map.")}addSource(B,r){return this._lazyInitEmptyStyle(),this.style.addSource(B,r),this._update(!0)}isSourceLoaded(B){const r=this.style&&this.style.sourceCaches[B];if(r!==void 0)return r.loaded();this.fire(new t.j(new Error(`There is no source with ID '${B}'`)))}setTerrain(B){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),B){const r=this.style.sourceCaches[B.source];if(!r)throw new Error(`cannot load terrain, because there exists no source with ID: ${B.source}`);this.terrain===null&&r.reload();for(const p in this.style._layers){const C=this.style._layers[p];C.type==="hillshade"&&C.source===B.source&&t.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new eh(this.painter,r,B),this.painter.renderToTexture=new cs(this.painter,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._terrainDataCallback=p=>{p.dataType==="style"?this.terrain.sourceCache.freeRtt():p.dataType==="source"&&p.tile&&(p.sourceId!==B.source||this._elevationFreeze||(this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))),this.terrain.sourceCache.freeRtt(p.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0);return this.fire(new t.k("terrain",{terrain:B})),this}getTerrain(){var B,r;return(r=(B=this.terrain)===null||B===void 0?void 0:B.options)!==null&&r!==void 0?r:null}areTilesLoaded(){const B=this.style&&this.style.sourceCaches;for(const r in B){const p=B[r]._tiles;for(const C in p){const k=p[C];if(k.state!=="loaded"&&k.state!=="errored")return!1}}return!0}removeSource(B){return this.style.removeSource(B),this._update(!0)}getSource(B){return this.style.getSource(B)}addImage(B,r,p={}){const{pixelRatio:C=1,sdf:k=!1,stretchX:j,stretchY:Z,content:re,textFitWidth:ue,textFitHeight:ye}=p;if(this._lazyInitEmptyStyle(),!(r instanceof HTMLImageElement||t.b(r))){if(r.width===void 0||r.height===void 0)return this.fire(new t.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:Me,height:Re,data:ze}=r,Je=r;return this.style.addImage(B,{data:new t.R({width:Me,height:Re},new Uint8Array(ze)),pixelRatio:C,stretchX:j,stretchY:Z,content:re,textFitWidth:ue,textFitHeight:ye,sdf:k,version:0,userImage:Je}),Je.onAdd&&Je.onAdd(this,B),this}}{const{width:Me,height:Re,data:ze}=J.getImageData(r);this.style.addImage(B,{data:new t.R({width:Me,height:Re},ze),pixelRatio:C,stretchX:j,stretchY:Z,content:re,textFitWidth:ue,textFitHeight:ye,sdf:k,version:0})}}updateImage(B,r){const p=this.style.getImage(B);if(!p)return this.fire(new t.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const C=r instanceof HTMLImageElement||t.b(r)?J.getImageData(r):r,{width:k,height:j,data:Z}=C;if(k===void 0||j===void 0)return this.fire(new t.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(k!==p.data.width||j!==p.data.height)return this.fire(new t.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const re=!(r instanceof HTMLImageElement||t.b(r));return p.data.replace(Z,re),this.style.updateImage(B,p),this}getImage(B){return this.style.getImage(B)}hasImage(B){return B?!!this.style.getImage(B):(this.fire(new t.j(new Error("Missing required image id"))),!1)}removeImage(B){this.style.removeImage(B)}loadImage(B){return Le.getImage(this._requestManager.transformRequest(B,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(B,r){return this._lazyInitEmptyStyle(),this.style.addLayer(B,r),this._update(!0)}moveLayer(B,r){return this.style.moveLayer(B,r),this._update(!0)}removeLayer(B){return this.style.removeLayer(B),this._update(!0)}getLayer(B){return this.style.getLayer(B)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(B,r,p){return this.style.setLayerZoomRange(B,r,p),this._update(!0)}setFilter(B,r,p={}){return this.style.setFilter(B,r,p),this._update(!0)}getFilter(B){return this.style.getFilter(B)}setPaintProperty(B,r,p,C={}){return this.style.setPaintProperty(B,r,p,C),this._update(!0)}getPaintProperty(B,r){return this.style.getPaintProperty(B,r)}setLayoutProperty(B,r,p,C={}){return this.style.setLayoutProperty(B,r,p,C),this._update(!0)}getLayoutProperty(B,r){return this.style.getLayoutProperty(B,r)}setGlyphs(B,r={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(B,r),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(B,r,p={}){return this._lazyInitEmptyStyle(),this.style.addSprite(B,r,p,C=>{C||this._update(!0)}),this}removeSprite(B){return this._lazyInitEmptyStyle(),this.style.removeSprite(B),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(B,r={}){return this._lazyInitEmptyStyle(),this.style.setSprite(B,r,p=>{p||this._update(!0)}),this}setLight(B,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(B,r),this._update(!0)}getLight(){return this.style.getLight()}setSky(B,r={}){return this._lazyInitEmptyStyle(),this.style.setSky(B,r),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(B,r){return this.style.setFeatureState(B,r),this._update()}removeFeatureState(B,r){return this.style.removeFeatureState(B,r),this._update()}getFeatureState(B){return this.style.getFeatureState(B)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let B=0,r=0;return this._container&&(B=this._container.clientWidth||400,r=this._container.clientHeight||300),[B,r]}_setupContainer(){const B=this._container;B.classList.add("maplibregl-map");const r=this._canvasContainer=Q.create("div","maplibregl-canvas-container",B);this._interactive&&r.classList.add("maplibregl-interactive"),this._canvas=Q.create("canvas","maplibregl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const p=this._containerDimensions(),C=this._getClampedPixelRatio(p[0],p[1]);this._resizeCanvas(p[0],p[1],C);const k=this._controlContainer=Q.create("div","maplibregl-control-container",B),j=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(Z=>{j[Z]=Q.create("div",`maplibregl-ctrl-${Z} `,k)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(B,r,p){this._canvas.width=Math.floor(p*B),this._canvas.height=Math.floor(p*r),this._canvas.style.width=`${B}px`,this._canvas.style.height=`${r}px`}_setupPainter(){const B=Object.assign(Object.assign({},this._canvasContextAttributes),{alpha:!0,depth:!0,stencil:!0,premultipliedAlpha:!0});let r=null;this._canvas.addEventListener("webglcontextcreationerror",C=>{r={requestedAttributes:B},C&&(r.statusMessage=C.statusMessage,r.type=C.type)},{once:!0});let p=null;if(p=this._canvasContextAttributes.contextType?this._canvas.getContext(this._canvasContextAttributes.contextType,B):this._canvas.getContext("webgl2",B)||this._canvas.getContext("webgl",B),!p){const C="Failed to initialize WebGL";throw r?(r.message=C,new Error(JSON.stringify(r))):new Error(C)}this.painter=new Gm(p,this.transform),ce.testSupport(p)}migrateProjection(B,r){super.migrateProjection(B,r),this.painter.transform=B,this.fire(new t.k("projectiontransition",{newProjection:this.style.projection.name}))}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(B){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||B,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(B){return this._update(),this._renderTaskQueue.add(B)}_cancelRenderFrame(B){this._renderTaskQueue.remove(B)}_render(B){var r,p,C,k,j;const Z=this._idleTriggered?this._fadeDuration:0,re=((r=this.style.projection)===null||r===void 0?void 0:r.transitionState)>0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(B),this._removed)return;let ue=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const Re=this.transform.zoom,ze=J.now();this.style.zoomHistory.update(Re,ze);const Je=new t.z(Re,{now:ze,fadeDuration:Z,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),ot=Je.crossFadingFactor();ot===1&&ot===this._crossFadingFactor||(ue=!0,this._crossFadingFactor=ot),this.style.update(Je)}const ye=((p=this.style.projection)===null||p===void 0?void 0:p.transitionState)>0!==re;(C=this.style.projection)===null||C===void 0||C.setErrorQueryLatitudeDegrees(this.transform.center.lat),this.transform.setTransitionState((k=this.style.projection)===null||k===void 0?void 0:k.transitionState,(j=this.style.projection)===null||j===void 0?void 0:j.latitudeErrorCorrectionRadians),this.style&&(this._sourcesDirty||ye)&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.setMinElevationForCurrentTile(this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),!this._elevationFreeze&&this._centerClampedToGround&&this.transform.setElevation(this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.setMinElevationForCurrentTile(0),this._centerClampedToGround&&this.transform.setElevation(0)),this._placementDirty=this.style&&this.style._updatePlacement(this.transform,this.showCollisionBoxes,Z,this._crossSourceCollisions,ye),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:Z,showPadding:this.showPadding}),this.fire(new t.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,t.cd.mark(t.ce.load),this.fire(new t.k("load"))),this.style&&(this.style.hasTransitions()||ue)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const Me=this._sourcesDirty||this._styleDirty||this._placementDirty;return Me||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new t.k("idle")),!this._loaded||this._fullyLoaded||Me||(this._fullyLoaded=!0,t.cd.mark(t.ce.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var B;this._hash&&this._hash.remove();for(const p of this._controls)p.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),Le.removeThrottleControl(this._imageQueueHandle),(B=this._resizeObserver)===null||B===void 0||B.disconnect();const r=this.painter.context.gl.getExtension("WEBGL_lose_context");r!=null&&r.loseContext&&r.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),Q.remove(this._canvasContainer),Q.remove(this._controlContainer),this._container.removeEventListener("scroll",this._onMapScroll,!1),this._container.classList.remove("maplibregl-map"),t.cd.clearMetrics(),this._removed=!0,this.fire(new t.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,J.frame(this._frameRequest,B=>{t.cd.frame(B),this._frameRequest=null;try{this._render(B)}catch(r){if(!t.cf(r)&&!function(p){return p.message===Ql}(r))throw r}},()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(B){this._showTileBoundaries!==B&&(this._showTileBoundaries=B,this._update())}get showPadding(){return!!this._showPadding}set showPadding(B){this._showPadding!==B&&(this._showPadding=B,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(B){this._showCollisionBoxes!==B&&(this._showCollisionBoxes=B,B?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(B){this._showOverdrawInspector!==B&&(this._showOverdrawInspector=B,this._update())}get repaint(){return!!this._repaint}set repaint(B){this._repaint!==B&&(this._repaint=B,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(B){this._vertices=B,this._update()}get version(){return Sd}getCameraTargetElevation(){return this.transform.elevation}getProjection(){return this.style.getProjection()}setProjection(B){return this._lazyInitEmptyStyle(),this.style.setProjection(B),this._update(!0)}},T.MapMouseEvent=ms,T.MapTouchEvent=zo,T.MapWheelEvent=Ol,T.Marker=_f,T.NavigationControl=class{constructor(B){this._updateZoomButtons=()=>{const r=this._map.getZoom(),p=r===this._map.getMaxZoom(),C=r===this._map.getMinZoom();this._zoomInButton.disabled=p,this._zoomOutButton.disabled=C,this._zoomInButton.setAttribute("aria-disabled",p.toString()),this._zoomOutButton.setAttribute("aria-disabled",C.toString())},this._rotateCompassArrow=()=>{this._compassIcon.style.transform=this.options.visualizePitch&&this.options.visualizeRoll?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateZ(${-this._map.transform.roll}deg) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitchInRadians),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${-this._map.transform.bearing}deg)`:this.options.visualizeRoll?`rotate(${-this._map.transform.bearing-this._map.transform.roll}deg)`:`rotate(${-this._map.transform.bearing}deg)`},this._setButtonTitle=(r,p)=>{const C=this._map._getUIString(`NavigationControl.${p}`);r.title=C,r.setAttribute("aria-label",C)},this.options=t.e({},ba,B),this._container=Q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",r=>this._map.zoomIn({},{originalEvent:r})),Q.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",r=>this._map.zoomOut({},{originalEvent:r})),Q.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",r=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:r}):this._map.resetNorth({},{originalEvent:r})}),this._compassIcon=Q.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(B){return this._map=B,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.on("roll",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new th(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){Q.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this.options.visualizeRoll&&this._map.off("roll",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(B,r){const p=Q.create("button",B,this._container);return p.type="button",p.addEventListener("click",r),p}},T.Popup=class extends t.E{constructor(B){super(),this.remove=()=>(this._content&&Q.remove(this._content),this._container&&(Q.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new t.k("close"))),this),this._onMouseUp=r=>{this._update(r.point)},this._onMouseMove=r=>{this._update(r.point)},this._onDrag=r=>{this._update(r.point)},this._update=r=>{var p;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=Q.create("div","maplibregl-popup",this._map.getContainer()),this._tip=Q.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const re of this.options.className.split(" "))this._container.classList.add(re);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Gc(this._lngLat,this._flatPos,this._map.transform):(p=this._lngLat)===null||p===void 0?void 0:p.wrap(),this._trackPointer&&!r)return;const C=this._flatPos=this._pos=this._trackPointer&&r?r:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&r?r:this._map.transform.locationToScreenPoint(this._lngLat));let k=this.options.anchor;const j=ih(this.options.offset);if(!k){const re=this._container.offsetWidth,ue=this._container.offsetHeight;let ye;ye=C.y+j.bottom.y<ue?["top"]:C.y>this._map.transform.height-ue?["bottom"]:[],C.x<re/2?ye.push("left"):C.x>this._map.transform.width-re/2&&ye.push("right"),k=ye.length===0?"bottom":ye.join("-")}let Z=C.add(j[k]);this.options.subpixelPositioning||(Z=Z.round()),Q.setTransform(this._container,`${vc[k]} translate(${Z.x}px,${Z.y}px)`),gf(this._container,k,"popup")},this._onClose=()=>{this.remove()},this.options=t.e(Object.create(tn),B)}addTo(B){return this._map&&this.remove(),this._map=B,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new t.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(B){return this._lngLat=t.N.convert(B),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(B){return this.setDOMContent(document.createTextNode(B))}setHTML(B){const r=document.createDocumentFragment(),p=document.createElement("body");let C;for(p.innerHTML=B;C=p.firstChild,C;)r.appendChild(C);return this.setDOMContent(r)}getMaxWidth(){var B;return(B=this._container)===null||B===void 0?void 0:B.style.maxWidth}setMaxWidth(B){return this.options.maxWidth=B,this._update(),this}setDOMContent(B){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Q.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(B),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(B){return this._container&&this._container.classList.add(B),this}removeClassName(B){return this._container&&this._container.classList.remove(B),this}setOffset(B){return this.options.offset=B,this._update(),this}toggleClassName(B){if(this._container)return this._container.classList.toggle(B)}setSubpixelPositioning(B){this.options.subpixelPositioning=B}_createCloseButton(){this.options.closeButton&&(this._closeButton=Q.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const B=this._container.querySelector(mp);B&&B.focus()}},T.RasterDEMTileSource=zn,T.RasterTileSource=Cn,T.ScaleControl=class{constructor(B){this._onMove=()=>{bc(this._map,this._container,this.options)},this.setUnit=r=>{this.options.unit=r,bc(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},Ei),B)}getDefaultPosition(){return"bottom-left"}onAdd(B){return this._map=B,this._container=Q.create("div","maplibregl-ctrl maplibregl-ctrl-scale",B.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){Q.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},T.ScrollZoomHandler=ki,T.Style=ps,T.TerrainControl=class{constructor(B){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=B}onAdd(B){return this._map=B,this._container=Q.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=Q.create("button","maplibregl-ctrl-terrain",this._container),Q.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){Q.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},T.TwoFingersTouchPitchHandler=vd,T.TwoFingersTouchRotateHandler=df,T.TwoFingersTouchZoomHandler=yu,T.TwoFingersTouchZoomRotateHandler=ff,T.VectorTileSource=bn,T.VideoSource=wi,T.addSourceType=(B,r)=>t._(void 0,void 0,void 0,function*(){if(ui(B))throw new Error(`A source type called "${B}" already exists.`);((p,C)=>{Vi[p]=C})(B,r)}),T.clearPrewarmedResources=function(){const B=Ci;B&&(B.isPreloaded()&&B.numActive()===1?(B.release(mn),Ci=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},T.createTileMesh=ca,T.getMaxParallelImageRequests=function(){return t.a.MAX_PARALLEL_IMAGE_REQUESTS},T.getRTLTextPluginStatus=function(){return Ar().getRTLTextPluginStatus()},T.getVersion=function(){return yf},T.getWorkerCount=function(){return Nn.workerCount},T.getWorkerUrl=function(){return t.a.WORKER_URL},T.importScriptInWorkers=function(B){return qn().broadcast("IS",B)},T.prewarm=function(){Ln().acquire(mn)},T.setMaxParallelImageRequests=function(B){t.a.MAX_PARALLEL_IMAGE_REQUESTS=B},T.setRTLTextPlugin=function(B,r){return Ar().setRTLTextPlugin(B,r)},T.setWorkerCount=function(B){Nn.workerCount=B},T.setWorkerUrl=function(B){t.a.WORKER_URL=B}});var E=u;return E})}(s1)),s1.exports}var ZS=UV(),WS={exports:{}},SP;function $V(){return SP||(SP=1,function(e){const s="maplibre_gl_dates";function u(J,Q){let ce=d(Q);J.getStyle().layers.map(function(ie){if(!("source-layer"in ie))return;let pe=t(J.getFilter(ie.id),ce);J.setFilter(ie.id,pe)})}function d(J){let Q;if(typeof J=="string")Q=b(J);else if(J instanceof Date&&!isNaN(J)){let ce=T(J),ie=J.toISOString().split("T")[0];Q={startDate:J,startDecimalYear:ce,startISODate:ie,endDate:J,endDecimalYear:ce,endISODate:ie}}return Q}function b(J){if(!J||!/^-?\d{1,4}(?:-\d\d){0,2}$/.test(J))return;let Q=J.split("-");Q[0]===""&&(Q.shift(),Q[0]*=-1);let ie=+Q[0],pe=+Q[0],be,Ie;Q[1]?be=Ie=+Q[1]-1:(pe++,be=Ie=0);let $e,Le;Q[2]?$e=Le=+Q[2]:Q[1]&&(Ie++,$e=Le=1);let Oe=E(ie,be,$e),Ve=E(pe,Ie,Le);return{startDate:!isNaN(Oe)&&Oe,startDecimalYear:!isNaN(Oe)&&T(Oe),startISODate:!isNaN(Oe)&&Oe.toISOString().split("T")[0],endDate:!isNaN(Ve)&&Ve,endDecimalYear:!isNaN(Ve)&&T(Ve),endISODate:!isNaN(Ve)&&Ve.toISOString().split("T")[0]}}function E(J,Q,ce){let ie=new Date(Date.UTC(J,Q,ce));return ie.setUTCFullYear(J),ie}function T(J){let Q=J.getUTCFullYear(),ce=E(Q+1,0,1).getTime(),ie=E(Q,0,1).getTime();return Q<0&&Q--,Q+(J.getTime()-ie)/(ce-ie)}function t(J,Q){return typeof J<"u"&&Y(J)?G(J,Q):W(J,Q)}function G(J,Q){return J[0]==="all"&&J[2]&&J[1][0]==="any"&&J[2][0]==="any"?(J[1][1]&&J[1][1][0]==="all"&&J[1][1][2]&&J[1][1][2][0]==="<"&&J[1][1][2][1]==="start_decdate"&&(J[1][1][2][2]=Q.endDecimalYear),J[1][2]&&J[1][2][0]==="all"&&J[1][2][2]&&J[1][2][2][0]==="<"&&J[1][2][2][2]==="start_date"&&(J[1][2][2][3]=Q.endISODate),J[2][1]&&J[2][1][0]==="all"&&J[2][1][2]&&J[2][1][2][0]===">="&&J[2][1][2][1]==="end_decdate"&&(J[2][1][2][2]=Q.startDecimalYear),J[2][2]&&J[2][2][0]==="all"&&J[2][2][2]&&J[2][2][2][0]===">="&&J[2][2][2][2]==="end_date"&&(J[2][2][2][3]=Q.startISODate),J):["all",["any",["all",["has","start_decdate"],["<","start_decdate",Q.endDecimalYear]],["all",["!has","start_decdate"],["has","start_date"],["<","start_date",Q.endISODate]],["all",["!has","start_decdate"],["!has","start_date"]]],["any",["all",["has","end_decdate"],[">=","end_decdate",Q.startDecimalYear]],["all",["!has","end_decdate"],["has","end_date"],[">=","end_date",Q.startISODate]],["all",["!has","end_decdate"],["!has","end_date"]]],J]}function W(J,Q){const ce=`${s}__startDecimalYear`,ie=`${s}__startISODate`,pe=`${s}__endDecimalYear`,be=`${s}__endISODate`;if(Array.isArray(J)&&J[0]==="let")return ne(J,ce,Q.startDecimalYear),ne(J,ie,Q.startISODate),ne(J,pe,Q.endDecimalYear),ne(J,be,Q.endISODate),J;let Ie=["all",["any",["all",["has","start_decdate"],["<",["get","start_decdate"],["var",pe]]],["all",["!",["has","start_decdate"]],["has","start_date"],["<",["get","start_date"],["var",be]]],["all",["!",["has","start_decdate"]],["!",["has","start_date"]]]],["any",["all",["has","end_decdate"],[">=",["get","end_decdate"],["var",ce]]],["all",["!",["has","end_decdate"]],["has","end_date"],[">=",["get","end_date"],["var",ie]]],["all",["!",["has","end_decdate"]],["!",["has","end_date"]]]]];return J&&Ie.push(J),["let",ce,Q.startDecimalYear,ie,Q.startISODate,pe,Q.endDecimalYear,be,Q.endISODate,Ie]}function Y(J){if(!Array.isArray(J)||J.length<2)return!1;let Q=J.slice(1);switch(J[0]){case"!has":case"!in":case"none":return!0;case"has":return Q[0]==="$id"||Q[0]==="$type";case"in":return Q.length>2||Q[0]==="$id"||Q[0]==="$type"||typeof Q[1]=="number"||typeof Q[1]=="boolean"||typeof Q[0]=="string"&&typeof Q[1]=="string";case"==":case"!=":case">":case">=":case"<":case"<=":return typeof Q[0]=="string"&&!Array.isArray(Q[1]);case"all":case"any":return Q.some(Y);default:return!1}}function ne(J,Q,ce){if(J[0]!=="let")return;let ie=J.indexOf(Q);ie!==-1&&ie%2===1?J[ie+1]=ce:J.splice(-1,0,Q,ce)}typeof window<"u"&&"maplibregl"in window?maplibregl.Map.prototype.filterByDate=function(J){u(this,J)}:e.exports={filterByDate:u,dateRangeFromDate:d,decimalYearFromDate:T,dateRangeFromISODate:b,constrainFilterByDateRange:t,constrainLegacyFilterByDateRange:G,constrainExpressionFilterByDateRange:W,isLegacyFilter:Y,updateVariable:ne}}(WS)),WS.exports}var GV=$V();const qV={id:"map"},HV=mo({__name:"LibreMap",props:{date:{type:String,required:!0}},setup(e){const s=e;return Ua(()=>{const u=new ZS.Map({container:"map",style:"https://www.openhistoricalmap.org/map-styles/main/main.json",attributionControl:{customAttribution:'<a href="https://www.openhistoricalmap.org/">OpenHistoricalMap</a>'},center:[-95.9872222,36.1619444],zoom:15});u.addControl(new ZS.NavigationControl,"top-left"),u.addControl(new ZS.FullscreenControl,"top-left");function d(b){u.once("styledata",function(E){GV.filterByDate(u,b)})}d(s.date)}),(u,d)=>(ja(),Gs("div",qV))}}),gR=H_(HV,[["__scopeId","data-v-4c3153e6"]]),ZV={name:"Map1910",components:{LibreMap:gR}};function WV(e,s,u,d,b,E){const T=Ul("LibreMap");return ja(),Em(T,{date:"1910-04-15"})}const XV=H_(ZV,[["render",WV]]),YV={name:"Map1920",components:{LibreMap:gR}};function KV(e,s,u,d,b,E){const T=Ul("LibreMap");return ja(),Em(T,{date:"1920-01-02"})}const JV=H_(YV,[["render",KV]]);var o1={exports:{}},QV=o1.exports,TP;function eN(){return TP||(TP=1,function(e,s){(function(u,d){e.exports=d()})(QV,function(){var u,d,b;function E(t,G){if(!u)u=G;else if(!d)d=G;else{var W="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+u+")(sharedChunk); ("+d+")(sharedChunk); self.onerror = null;",Y={};u(Y),b=G(Y),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(b.workerUrl=window.URL.createObjectURL(new Blob([W],{type:"text/javascript"})))}}E(["exports"],function(t){function G(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var W,Y={},ne={};function J(){if(W)return ne;W=1,Object.defineProperty(ne,"__esModule",{value:!0}),ne.setMatrixArrayType=function(v){ne.ARRAY_TYPE=n=v},ne.toRadian=function(v){return v*h},ne.equals=function(v,f){return Math.abs(v-f)<=c*Math.max(1,Math.abs(v),Math.abs(f))},ne.RANDOM=ne.ARRAY_TYPE=ne.EPSILON=void 0;var c=1e-6;ne.EPSILON=c;var n=typeof Float32Array<"u"?Float32Array:Array;ne.ARRAY_TYPE=n;var a=Math.random;ne.RANDOM=a;var h=Math.PI/180;return Math.hypot||(Math.hypot=function(){for(var v=0,f=arguments.length;f--;)v+=arguments[f]*arguments[f];return Math.sqrt(v)}),ne}var Q,ce={};function ie(){if(Q)return ce;function c(f){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(x){return typeof x}:function(x){return x&&typeof Symbol=="function"&&x.constructor===Symbol&&x!==Symbol.prototype?"symbol":typeof x},c(f)}Q=1,Object.defineProperty(ce,"__esModule",{value:!0}),ce.create=function(){var f=new n.ARRAY_TYPE(4);return n.ARRAY_TYPE!=Float32Array&&(f[1]=0,f[2]=0),f[0]=1,f[3]=1,f},ce.clone=function(f){var x=new n.ARRAY_TYPE(4);return x[0]=f[0],x[1]=f[1],x[2]=f[2],x[3]=f[3],x},ce.copy=function(f,x){return f[0]=x[0],f[1]=x[1],f[2]=x[2],f[3]=x[3],f},ce.identity=function(f){return f[0]=1,f[1]=0,f[2]=0,f[3]=1,f},ce.fromValues=function(f,x,P,L){var N=new n.ARRAY_TYPE(4);return N[0]=f,N[1]=x,N[2]=P,N[3]=L,N},ce.set=function(f,x,P,L,N){return f[0]=x,f[1]=P,f[2]=L,f[3]=N,f},ce.transpose=function(f,x){if(f===x){var P=x[1];f[1]=x[2],f[2]=P}else f[0]=x[0],f[1]=x[2],f[2]=x[1],f[3]=x[3];return f},ce.invert=function(f,x){var P=x[0],L=x[1],N=x[2],I=x[3],z=P*I-N*L;return z?(f[0]=I*(z=1/z),f[1]=-L*z,f[2]=-N*z,f[3]=P*z,f):null},ce.adjoint=function(f,x){var P=x[0];return f[0]=x[3],f[1]=-x[1],f[2]=-x[2],f[3]=P,f},ce.determinant=function(f){return f[0]*f[3]-f[2]*f[1]},ce.multiply=h,ce.rotate=function(f,x,P){var L=x[0],N=x[1],I=x[2],z=x[3],F=Math.sin(P),R=Math.cos(P);return f[0]=L*R+I*F,f[1]=N*R+z*F,f[2]=L*-F+I*R,f[3]=N*-F+z*R,f},ce.scale=function(f,x,P){var L=x[1],N=x[2],I=x[3],z=P[0],F=P[1];return f[0]=x[0]*z,f[1]=L*z,f[2]=N*F,f[3]=I*F,f},ce.fromRotation=function(f,x){var P=Math.sin(x),L=Math.cos(x);return f[0]=L,f[1]=P,f[2]=-P,f[3]=L,f},ce.fromScaling=function(f,x){return f[0]=x[0],f[1]=0,f[2]=0,f[3]=x[1],f},ce.str=function(f){return"mat2("+f[0]+", "+f[1]+", "+f[2]+", "+f[3]+")"},ce.frob=function(f){return Math.hypot(f[0],f[1],f[2],f[3])},ce.LDU=function(f,x,P,L){return f[2]=L[2]/L[0],P[0]=L[0],P[1]=L[1],P[3]=L[3]-f[2]*P[1],[f,x,P]},ce.add=function(f,x,P){return f[0]=x[0]+P[0],f[1]=x[1]+P[1],f[2]=x[2]+P[2],f[3]=x[3]+P[3],f},ce.subtract=v,ce.exactEquals=function(f,x){return f[0]===x[0]&&f[1]===x[1]&&f[2]===x[2]&&f[3]===x[3]},ce.equals=function(f,x){var P=f[0],L=f[1],N=f[2],I=f[3],z=x[0],F=x[1],R=x[2],O=x[3];return Math.abs(P-z)<=n.EPSILON*Math.max(1,Math.abs(P),Math.abs(z))&&Math.abs(L-F)<=n.EPSILON*Math.max(1,Math.abs(L),Math.abs(F))&&Math.abs(N-R)<=n.EPSILON*Math.max(1,Math.abs(N),Math.abs(R))&&Math.abs(I-O)<=n.EPSILON*Math.max(1,Math.abs(I),Math.abs(O))},ce.multiplyScalar=function(f,x,P){return f[0]=x[0]*P,f[1]=x[1]*P,f[2]=x[2]*P,f[3]=x[3]*P,f},ce.multiplyScalarAndAdd=function(f,x,P,L){return f[0]=x[0]+P[0]*L,f[1]=x[1]+P[1]*L,f[2]=x[2]+P[2]*L,f[3]=x[3]+P[3]*L,f},ce.sub=ce.mul=void 0;var n=function(f,x){if(f&&f.__esModule)return f;if(f===null||c(f)!=="object"&&typeof f!="function")return{default:f};var P=a(void 0);if(P&&P.has(f))return P.get(f);var L={},N=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var I in f)if(I!=="default"&&Object.prototype.hasOwnProperty.call(f,I)){var z=N?Object.getOwnPropertyDescriptor(f,I):null;z&&(z.get||z.set)?Object.defineProperty(L,I,z):L[I]=f[I]}return L.default=f,P&&P.set(f,L),L}(J());function a(f){if(typeof WeakMap!="function")return null;var x=new WeakMap,P=new WeakMap;return(a=function(L){return L?P:x})(f)}function h(f,x,P){var L=x[0],N=x[1],I=x[2],z=x[3],F=P[0],R=P[1],O=P[2],q=P[3];return f[0]=L*F+I*R,f[1]=N*F+z*R,f[2]=L*O+I*q,f[3]=N*O+z*q,f}function v(f,x,P){return f[0]=x[0]-P[0],f[1]=x[1]-P[1],f[2]=x[2]-P[2],f[3]=x[3]-P[3],f}return ce.mul=h,ce.sub=v,ce}var pe,be={};function Ie(){if(pe)return be;function c(f){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(x){return typeof x}:function(x){return x&&typeof Symbol=="function"&&x.constructor===Symbol&&x!==Symbol.prototype?"symbol":typeof x},c(f)}pe=1,Object.defineProperty(be,"__esModule",{value:!0}),be.create=function(){var f=new n.ARRAY_TYPE(6);return n.ARRAY_TYPE!=Float32Array&&(f[1]=0,f[2]=0,f[4]=0,f[5]=0),f[0]=1,f[3]=1,f},be.clone=function(f){var x=new n.ARRAY_TYPE(6);return x[0]=f[0],x[1]=f[1],x[2]=f[2],x[3]=f[3],x[4]=f[4],x[5]=f[5],x},be.copy=function(f,x){return f[0]=x[0],f[1]=x[1],f[2]=x[2],f[3]=x[3],f[4]=x[4],f[5]=x[5],f},be.identity=function(f){return f[0]=1,f[1]=0,f[2]=0,f[3]=1,f[4]=0,f[5]=0,f},be.fromValues=function(f,x,P,L,N,I){var z=new n.ARRAY_TYPE(6);return z[0]=f,z[1]=x,z[2]=P,z[3]=L,z[4]=N,z[5]=I,z},be.set=function(f,x,P,L,N,I,z){return f[0]=x,f[1]=P,f[2]=L,f[3]=N,f[4]=I,f[5]=z,f},be.invert=function(f,x){var P=x[0],L=x[1],N=x[2],I=x[3],z=x[4],F=x[5],R=P*I-L*N;return R?(f[0]=I*(R=1/R),f[1]=-L*R,f[2]=-N*R,f[3]=P*R,f[4]=(N*F-I*z)*R,f[5]=(L*z-P*F)*R,f):null},be.determinant=function(f){return f[0]*f[3]-f[1]*f[2]},be.multiply=h,be.rotate=function(f,x,P){var L=x[0],N=x[1],I=x[2],z=x[3],F=x[4],R=x[5],O=Math.sin(P),q=Math.cos(P);return f[0]=L*q+I*O,f[1]=N*q+z*O,f[2]=L*-O+I*q,f[3]=N*-O+z*q,f[4]=F,f[5]=R,f},be.scale=function(f,x,P){var L=x[1],N=x[2],I=x[3],z=x[4],F=x[5],R=P[0],O=P[1];return f[0]=x[0]*R,f[1]=L*R,f[2]=N*O,f[3]=I*O,f[4]=z,f[5]=F,f},be.translate=function(f,x,P){var L=x[0],N=x[1],I=x[2],z=x[3],F=x[4],R=x[5],O=P[0],q=P[1];return f[0]=L,f[1]=N,f[2]=I,f[3]=z,f[4]=L*O+I*q+F,f[5]=N*O+z*q+R,f},be.fromRotation=function(f,x){var P=Math.sin(x),L=Math.cos(x);return f[0]=L,f[1]=P,f[2]=-P,f[3]=L,f[4]=0,f[5]=0,f},be.fromScaling=function(f,x){return f[0]=x[0],f[1]=0,f[2]=0,f[3]=x[1],f[4]=0,f[5]=0,f},be.fromTranslation=function(f,x){return f[0]=1,f[1]=0,f[2]=0,f[3]=1,f[4]=x[0],f[5]=x[1],f},be.str=function(f){return"mat2d("+f[0]+", "+f[1]+", "+f[2]+", "+f[3]+", "+f[4]+", "+f[5]+")"},be.frob=function(f){return Math.hypot(f[0],f[1],f[2],f[3],f[4],f[5],1)},be.add=function(f,x,P){return f[0]=x[0]+P[0],f[1]=x[1]+P[1],f[2]=x[2]+P[2],f[3]=x[3]+P[3],f[4]=x[4]+P[4],f[5]=x[5]+P[5],f},be.subtract=v,be.multiplyScalar=function(f,x,P){return f[0]=x[0]*P,f[1]=x[1]*P,f[2]=x[2]*P,f[3]=x[3]*P,f[4]=x[4]*P,f[5]=x[5]*P,f},be.multiplyScalarAndAdd=function(f,x,P,L){return f[0]=x[0]+P[0]*L,f[1]=x[1]+P[1]*L,f[2]=x[2]+P[2]*L,f[3]=x[3]+P[3]*L,f[4]=x[4]+P[4]*L,f[5]=x[5]+P[5]*L,f},be.exactEquals=function(f,x){return f[0]===x[0]&&f[1]===x[1]&&f[2]===x[2]&&f[3]===x[3]&&f[4]===x[4]&&f[5]===x[5]},be.equals=function(f,x){var P=f[0],L=f[1],N=f[2],I=f[3],z=f[4],F=f[5],R=x[0],O=x[1],q=x[2],te=x[3],ae=x[4],ge=x[5];return Math.abs(P-R)<=n.EPSILON*Math.max(1,Math.abs(P),Math.abs(R))&&Math.abs(L-O)<=n.EPSILON*Math.max(1,Math.abs(L),Math.abs(O))&&Math.abs(N-q)<=n.EPSILON*Math.max(1,Math.abs(N),Math.abs(q))&&Math.abs(I-te)<=n.EPSILON*Math.max(1,Math.abs(I),Math.abs(te))&&Math.abs(z-ae)<=n.EPSILON*Math.max(1,Math.abs(z),Math.abs(ae))&&Math.abs(F-ge)<=n.EPSILON*Math.max(1,Math.abs(F),Math.abs(ge))},be.sub=be.mul=void 0;var n=function(f,x){if(f&&f.__esModule)return f;if(f===null||c(f)!=="object"&&typeof f!="function")return{default:f};var P=a(void 0);if(P&&P.has(f))return P.get(f);var L={},N=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var I in f)if(I!=="default"&&Object.prototype.hasOwnProperty.call(f,I)){var z=N?Object.getOwnPropertyDescriptor(f,I):null;z&&(z.get||z.set)?Object.defineProperty(L,I,z):L[I]=f[I]}return L.default=f,P&&P.set(f,L),L}(J());function a(f){if(typeof WeakMap!="function")return null;var x=new WeakMap,P=new WeakMap;return(a=function(L){return L?P:x})(f)}function h(f,x,P){var L=x[0],N=x[1],I=x[2],z=x[3],F=x[4],R=x[5],O=P[0],q=P[1],te=P[2],ae=P[3],ge=P[4],_e=P[5];return f[0]=L*O+I*q,f[1]=N*O+z*q,f[2]=L*te+I*ae,f[3]=N*te+z*ae,f[4]=L*ge+I*_e+F,f[5]=N*ge+z*_e+R,f}function v(f,x,P){return f[0]=x[0]-P[0],f[1]=x[1]-P[1],f[2]=x[2]-P[2],f[3]=x[3]-P[3],f[4]=x[4]-P[4],f[5]=x[5]-P[5],f}return be.mul=h,be.sub=v,be}var $e,Le={};function Oe(){if($e)return Le;function c(f){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(x){return typeof x}:function(x){return x&&typeof Symbol=="function"&&x.constructor===Symbol&&x!==Symbol.prototype?"symbol":typeof x},c(f)}$e=1,Object.defineProperty(Le,"__esModule",{value:!0}),Le.create=function(){var f=new n.ARRAY_TYPE(9);return n.ARRAY_TYPE!=Float32Array&&(f[1]=0,f[2]=0,f[3]=0,f[5]=0,f[6]=0,f[7]=0),f[0]=1,f[4]=1,f[8]=1,f},Le.fromMat4=function(f,x){return f[0]=x[0],f[1]=x[1],f[2]=x[2],f[3]=x[4],f[4]=x[5],f[5]=x[6],f[6]=x[8],f[7]=x[9],f[8]=x[10],f},Le.clone=function(f){var x=new n.ARRAY_TYPE(9);return x[0]=f[0],x[1]=f[1],x[2]=f[2],x[3]=f[3],x[4]=f[4],x[5]=f[5],x[6]=f[6],x[7]=f[7],x[8]=f[8],x},Le.copy=function(f,x){return f[0]=x[0],f[1]=x[1],f[2]=x[2],f[3]=x[3],f[4]=x[4],f[5]=x[5],f[6]=x[6],f[7]=x[7],f[8]=x[8],f},Le.fromValues=function(f,x,P,L,N,I,z,F,R){var O=new n.ARRAY_TYPE(9);return O[0]=f,O[1]=x,O[2]=P,O[3]=L,O[4]=N,O[5]=I,O[6]=z,O[7]=F,O[8]=R,O},Le.set=function(f,x,P,L,N,I,z,F,R,O){return f[0]=x,f[1]=P,f[2]=L,f[3]=N,f[4]=I,f[5]=z,f[6]=F,f[7]=R,f[8]=O,f},Le.identity=function(f){return f[0]=1,f[1]=0,f[2]=0,f[3]=0,f[4]=1,f[5]=0,f[6]=0,f[7]=0,f[8]=1,f},Le.transpose=function(f,x){if(f===x){var P=x[1],L=x[2],N=x[5];f[1]=x[3],f[2]=x[6],f[3]=P,f[5]=x[7],f[6]=L,f[7]=N}else f[0]=x[0],f[1]=x[3],f[2]=x[6],f[3]=x[1],f[4]=x[4],f[5]=x[7],f[6]=x[2],f[7]=x[5],f[8]=x[8];return f},Le.invert=function(f,x){var P=x[0],L=x[1],N=x[2],I=x[3],z=x[4],F=x[5],R=x[6],O=x[7],q=x[8],te=q*z-F*O,ae=-q*I+F*R,ge=O*I-z*R,_e=P*te+L*ae+N*ge;return _e?(f[0]=te*(_e=1/_e),f[1]=(-q*L+N*O)*_e,f[2]=(F*L-N*z)*_e,f[3]=ae*_e,f[4]=(q*P-N*R)*_e,f[5]=(-F*P+N*I)*_e,f[6]=ge*_e,f[7]=(-O*P+L*R)*_e,f[8]=(z*P-L*I)*_e,f):null},Le.adjoint=function(f,x){var P=x[0],L=x[1],N=x[2],I=x[3],z=x[4],F=x[5],R=x[6],O=x[7],q=x[8];return f[0]=z*q-F*O,f[1]=N*O-L*q,f[2]=L*F-N*z,f[3]=F*R-I*q,f[4]=P*q-N*R,f[5]=N*I-P*F,f[6]=I*O-z*R,f[7]=L*R-P*O,f[8]=P*z-L*I,f},Le.determinant=function(f){var x=f[3],P=f[4],L=f[5],N=f[6],I=f[7],z=f[8];return f[0]*(z*P-L*I)+f[1]*(-z*x+L*N)+f[2]*(I*x-P*N)},Le.multiply=h,Le.translate=function(f,x,P){var L=x[0],N=x[1],I=x[2],z=x[3],F=x[4],R=x[5],O=x[6],q=x[7],te=x[8],ae=P[0],ge=P[1];return f[0]=L,f[1]=N,f[2]=I,f[3]=z,f[4]=F,f[5]=R,f[6]=ae*L+ge*z+O,f[7]=ae*N+ge*F+q,f[8]=ae*I+ge*R+te,f},Le.rotate=function(f,x,P){var L=x[0],N=x[1],I=x[2],z=x[3],F=x[4],R=x[5],O=x[6],q=x[7],te=x[8],ae=Math.sin(P),ge=Math.cos(P);return f[0]=ge*L+ae*z,f[1]=ge*N+ae*F,f[2]=ge*I+ae*R,f[3]=ge*z-ae*L,f[4]=ge*F-ae*N,f[5]=ge*R-ae*I,f[6]=O,f[7]=q,f[8]=te,f},Le.scale=function(f,x,P){var L=P[0],N=P[1];return f[0]=L*x[0],f[1]=L*x[1],f[2]=L*x[2],f[3]=N*x[3],f[4]=N*x[4],f[5]=N*x[5],f[6]=x[6],f[7]=x[7],f[8]=x[8],f},Le.fromTranslation=function(f,x){return f[0]=1,f[1]=0,f[2]=0,f[3]=0,f[4]=1,f[5]=0,f[6]=x[0],f[7]=x[1],f[8]=1,f},Le.fromRotation=function(f,x){var P=Math.sin(x),L=Math.cos(x);return f[0]=L,f[1]=P,f[2]=0,f[3]=-P,f[4]=L,f[5]=0,f[6]=0,f[7]=0,f[8]=1,f},Le.fromScaling=function(f,x){return f[0]=x[0],f[1]=0,f[2]=0,f[3]=0,f[4]=x[1],f[5]=0,f[6]=0,f[7]=0,f[8]=1,f},Le.fromMat2d=function(f,x){return f[0]=x[0],f[1]=x[1],f[2]=0,f[3]=x[2],f[4]=x[3],f[5]=0,f[6]=x[4],f[7]=x[5],f[8]=1,f},Le.fromQuat=function(f,x){var P=x[0],L=x[1],N=x[2],I=x[3],z=P+P,F=L+L,R=N+N,O=P*z,q=L*z,te=L*F,ae=N*z,ge=N*F,_e=N*R,he=I*z,xe=I*F,Te=I*R;return f[0]=1-te-_e,f[3]=q-Te,f[6]=ae+xe,f[1]=q+Te,f[4]=1-O-_e,f[7]=ge-he,f[2]=ae-xe,f[5]=ge+he,f[8]=1-O-te,f},Le.normalFromMat4=function(f,x){var P=x[0],L=x[1],N=x[2],I=x[3],z=x[4],F=x[5],R=x[6],O=x[7],q=x[8],te=x[9],ae=x[10],ge=x[11],_e=x[12],he=x[13],xe=x[14],Te=x[15],Ae=P*F-L*z,tt=P*R-N*z,Ke=P*O-I*z,Ye=L*R-N*F,Ct=L*O-I*F,ct=N*O-I*R,It=q*he-te*_e,Rt=q*xe-ae*_e,At=q*Te-ge*_e,Vt=te*xe-ae*he,Wt=te*Te-ge*he,Kt=ae*Te-ge*xe,qt=Ae*Kt-tt*Wt+Ke*Vt+Ye*At-Ct*Rt+ct*It;return qt?(f[0]=(F*Kt-R*Wt+O*Vt)*(qt=1/qt),f[1]=(R*At-z*Kt-O*Rt)*qt,f[2]=(z*Wt-F*At+O*It)*qt,f[3]=(N*Wt-L*Kt-I*Vt)*qt,f[4]=(P*Kt-N*At+I*Rt)*qt,f[5]=(L*At-P*Wt-I*It)*qt,f[6]=(he*ct-xe*Ct+Te*Ye)*qt,f[7]=(xe*Ke-_e*ct-Te*tt)*qt,f[8]=(_e*Ct-he*Ke+Te*Ae)*qt,f):null},Le.projection=function(f,x,P){return f[0]=2/x,f[1]=0,f[2]=0,f[3]=0,f[4]=-2/P,f[5]=0,f[6]=-1,f[7]=1,f[8]=1,f},Le.str=function(f){return"mat3("+f[0]+", "+f[1]+", "+f[2]+", "+f[3]+", "+f[4]+", "+f[5]+", "+f[6]+", "+f[7]+", "+f[8]+")"},Le.frob=function(f){return Math.hypot(f[0],f[1],f[2],f[3],f[4],f[5],f[6],f[7],f[8])},Le.add=function(f,x,P){return f[0]=x[0]+P[0],f[1]=x[1]+P[1],f[2]=x[2]+P[2],f[3]=x[3]+P[3],f[4]=x[4]+P[4],f[5]=x[5]+P[5],f[6]=x[6]+P[6],f[7]=x[7]+P[7],f[8]=x[8]+P[8],f},Le.subtract=v,Le.multiplyScalar=function(f,x,P){return f[0]=x[0]*P,f[1]=x[1]*P,f[2]=x[2]*P,f[3]=x[3]*P,f[4]=x[4]*P,f[5]=x[5]*P,f[6]=x[6]*P,f[7]=x[7]*P,f[8]=x[8]*P,f},Le.multiplyScalarAndAdd=function(f,x,P,L){return f[0]=x[0]+P[0]*L,f[1]=x[1]+P[1]*L,f[2]=x[2]+P[2]*L,f[3]=x[3]+P[3]*L,f[4]=x[4]+P[4]*L,f[5]=x[5]+P[5]*L,f[6]=x[6]+P[6]*L,f[7]=x[7]+P[7]*L,f[8]=x[8]+P[8]*L,f},Le.exactEquals=function(f,x){return f[0]===x[0]&&f[1]===x[1]&&f[2]===x[2]&&f[3]===x[3]&&f[4]===x[4]&&f[5]===x[5]&&f[6]===x[6]&&f[7]===x[7]&&f[8]===x[8]},Le.equals=function(f,x){var P=f[0],L=f[1],N=f[2],I=f[3],z=f[4],F=f[5],R=f[6],O=f[7],q=f[8],te=x[0],ae=x[1],ge=x[2],_e=x[3],he=x[4],xe=x[5],Te=x[6],Ae=x[7],tt=x[8];return Math.abs(P-te)<=n.EPSILON*Math.max(1,Math.abs(P),Math.abs(te))&&Math.abs(L-ae)<=n.EPSILON*Math.max(1,Math.abs(L),Math.abs(ae))&&Math.abs(N-ge)<=n.EPSILON*Math.max(1,Math.abs(N),Math.abs(ge))&&Math.abs(I-_e)<=n.EPSILON*Math.max(1,Math.abs(I),Math.abs(_e))&&Math.abs(z-he)<=n.EPSILON*Math.max(1,Math.abs(z),Math.abs(he))&&Math.abs(F-xe)<=n.EPSILON*Math.max(1,Math.abs(F),Math.abs(xe))&&Math.abs(R-Te)<=n.EPSILON*Math.max(1,Math.abs(R),Math.abs(Te))&&Math.abs(O-Ae)<=n.EPSILON*Math.max(1,Math.abs(O),Math.abs(Ae))&&Math.abs(q-tt)<=n.EPSILON*Math.max(1,Math.abs(q),Math.abs(tt))},Le.sub=Le.mul=void 0;var n=function(f,x){if(f&&f.__esModule)return f;if(f===null||c(f)!=="object"&&typeof f!="function")return{default:f};var P=a(void 0);if(P&&P.has(f))return P.get(f);var L={},N=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var I in f)if(I!=="default"&&Object.prototype.hasOwnProperty.call(f,I)){var z=N?Object.getOwnPropertyDescriptor(f,I):null;z&&(z.get||z.set)?Object.defineProperty(L,I,z):L[I]=f[I]}return L.default=f,P&&P.set(f,L),L}(J());function a(f){if(typeof WeakMap!="function")return null;var x=new WeakMap,P=new WeakMap;return(a=function(L){return L?P:x})(f)}function h(f,x,P){var L=x[0],N=x[1],I=x[2],z=x[3],F=x[4],R=x[5],O=x[6],q=x[7],te=x[8],ae=P[0],ge=P[1],_e=P[2],he=P[3],xe=P[4],Te=P[5],Ae=P[6],tt=P[7],Ke=P[8];return f[0]=ae*L+ge*z+_e*O,f[1]=ae*N+ge*F+_e*q,f[2]=ae*I+ge*R+_e*te,f[3]=he*L+xe*z+Te*O,f[4]=he*N+xe*F+Te*q,f[5]=he*I+xe*R+Te*te,f[6]=Ae*L+tt*z+Ke*O,f[7]=Ae*N+tt*F+Ke*q,f[8]=Ae*I+tt*R+Ke*te,f}function v(f,x,P){return f[0]=x[0]-P[0],f[1]=x[1]-P[1],f[2]=x[2]-P[2],f[3]=x[3]-P[3],f[4]=x[4]-P[4],f[5]=x[5]-P[5],f[6]=x[6]-P[6],f[7]=x[7]-P[7],f[8]=x[8]-P[8],f}return Le.mul=h,Le.sub=v,Le}var Ve,Ue={};function qe(){if(Ve)return Ue;function c(I){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(z){return typeof z}:function(z){return z&&typeof Symbol=="function"&&z.constructor===Symbol&&z!==Symbol.prototype?"symbol":typeof z},c(I)}Ve=1,Object.defineProperty(Ue,"__esModule",{value:!0}),Ue.create=function(){var I=new n.ARRAY_TYPE(16);return n.ARRAY_TYPE!=Float32Array&&(I[1]=0,I[2]=0,I[3]=0,I[4]=0,I[6]=0,I[7]=0,I[8]=0,I[9]=0,I[11]=0,I[12]=0,I[13]=0,I[14]=0),I[0]=1,I[5]=1,I[10]=1,I[15]=1,I},Ue.clone=function(I){var z=new n.ARRAY_TYPE(16);return z[0]=I[0],z[1]=I[1],z[2]=I[2],z[3]=I[3],z[4]=I[4],z[5]=I[5],z[6]=I[6],z[7]=I[7],z[8]=I[8],z[9]=I[9],z[10]=I[10],z[11]=I[11],z[12]=I[12],z[13]=I[13],z[14]=I[14],z[15]=I[15],z},Ue.copy=function(I,z){return I[0]=z[0],I[1]=z[1],I[2]=z[2],I[3]=z[3],I[4]=z[4],I[5]=z[5],I[6]=z[6],I[7]=z[7],I[8]=z[8],I[9]=z[9],I[10]=z[10],I[11]=z[11],I[12]=z[12],I[13]=z[13],I[14]=z[14],I[15]=z[15],I},Ue.fromValues=function(I,z,F,R,O,q,te,ae,ge,_e,he,xe,Te,Ae,tt,Ke){var Ye=new n.ARRAY_TYPE(16);return Ye[0]=I,Ye[1]=z,Ye[2]=F,Ye[3]=R,Ye[4]=O,Ye[5]=q,Ye[6]=te,Ye[7]=ae,Ye[8]=ge,Ye[9]=_e,Ye[10]=he,Ye[11]=xe,Ye[12]=Te,Ye[13]=Ae,Ye[14]=tt,Ye[15]=Ke,Ye},Ue.set=function(I,z,F,R,O,q,te,ae,ge,_e,he,xe,Te,Ae,tt,Ke,Ye){return I[0]=z,I[1]=F,I[2]=R,I[3]=O,I[4]=q,I[5]=te,I[6]=ae,I[7]=ge,I[8]=_e,I[9]=he,I[10]=xe,I[11]=Te,I[12]=Ae,I[13]=tt,I[14]=Ke,I[15]=Ye,I},Ue.identity=h,Ue.transpose=function(I,z){if(I===z){var F=z[1],R=z[2],O=z[3],q=z[6],te=z[7],ae=z[11];I[1]=z[4],I[2]=z[8],I[3]=z[12],I[4]=F,I[6]=z[9],I[7]=z[13],I[8]=R,I[9]=q,I[11]=z[14],I[12]=O,I[13]=te,I[14]=ae}else I[0]=z[0],I[1]=z[4],I[2]=z[8],I[3]=z[12],I[4]=z[1],I[5]=z[5],I[6]=z[9],I[7]=z[13],I[8]=z[2],I[9]=z[6],I[10]=z[10],I[11]=z[14],I[12]=z[3],I[13]=z[7],I[14]=z[11],I[15]=z[15];return I},Ue.invert=function(I,z){var F=z[0],R=z[1],O=z[2],q=z[3],te=z[4],ae=z[5],ge=z[6],_e=z[7],he=z[8],xe=z[9],Te=z[10],Ae=z[11],tt=z[12],Ke=z[13],Ye=z[14],Ct=z[15],ct=F*ae-R*te,It=F*ge-O*te,Rt=F*_e-q*te,At=R*ge-O*ae,Vt=R*_e-q*ae,Wt=O*_e-q*ge,Kt=he*Ke-xe*tt,qt=he*Ye-Te*tt,yn=he*Ct-Ae*tt,Yn=xe*Ye-Te*Ke,xn=xe*Ct-Ae*Ke,di=Te*Ct-Ae*Ye,ci=ct*di-It*xn+Rt*Yn+At*yn-Vt*qt+Wt*Kt;return ci?(I[0]=(ae*di-ge*xn+_e*Yn)*(ci=1/ci),I[1]=(O*xn-R*di-q*Yn)*ci,I[2]=(Ke*Wt-Ye*Vt+Ct*At)*ci,I[3]=(Te*Vt-xe*Wt-Ae*At)*ci,I[4]=(ge*yn-te*di-_e*qt)*ci,I[5]=(F*di-O*yn+q*qt)*ci,I[6]=(Ye*Rt-tt*Wt-Ct*It)*ci,I[7]=(he*Wt-Te*Rt+Ae*It)*ci,I[8]=(te*xn-ae*yn+_e*Kt)*ci,I[9]=(R*yn-F*xn-q*Kt)*ci,I[10]=(tt*Vt-Ke*Rt+Ct*ct)*ci,I[11]=(xe*Rt-he*Vt-Ae*ct)*ci,I[12]=(ae*qt-te*Yn-ge*Kt)*ci,I[13]=(F*Yn-R*qt+O*Kt)*ci,I[14]=(Ke*It-tt*At-Ye*ct)*ci,I[15]=(he*At-xe*It+Te*ct)*ci,I):null},Ue.adjoint=function(I,z){var F=z[0],R=z[1],O=z[2],q=z[3],te=z[4],ae=z[5],ge=z[6],_e=z[7],he=z[8],xe=z[9],Te=z[10],Ae=z[11],tt=z[12],Ke=z[13],Ye=z[14],Ct=z[15];return I[0]=ae*(Te*Ct-Ae*Ye)-xe*(ge*Ct-_e*Ye)+Ke*(ge*Ae-_e*Te),I[1]=-(R*(Te*Ct-Ae*Ye)-xe*(O*Ct-q*Ye)+Ke*(O*Ae-q*Te)),I[2]=R*(ge*Ct-_e*Ye)-ae*(O*Ct-q*Ye)+Ke*(O*_e-q*ge),I[3]=-(R*(ge*Ae-_e*Te)-ae*(O*Ae-q*Te)+xe*(O*_e-q*ge)),I[4]=-(te*(Te*Ct-Ae*Ye)-he*(ge*Ct-_e*Ye)+tt*(ge*Ae-_e*Te)),I[5]=F*(Te*Ct-Ae*Ye)-he*(O*Ct-q*Ye)+tt*(O*Ae-q*Te),I[6]=-(F*(ge*Ct-_e*Ye)-te*(O*Ct-q*Ye)+tt*(O*_e-q*ge)),I[7]=F*(ge*Ae-_e*Te)-te*(O*Ae-q*Te)+he*(O*_e-q*ge),I[8]=te*(xe*Ct-Ae*Ke)-he*(ae*Ct-_e*Ke)+tt*(ae*Ae-_e*xe),I[9]=-(F*(xe*Ct-Ae*Ke)-he*(R*Ct-q*Ke)+tt*(R*Ae-q*xe)),I[10]=F*(ae*Ct-_e*Ke)-te*(R*Ct-q*Ke)+tt*(R*_e-q*ae),I[11]=-(F*(ae*Ae-_e*xe)-te*(R*Ae-q*xe)+he*(R*_e-q*ae)),I[12]=-(te*(xe*Ye-Te*Ke)-he*(ae*Ye-ge*Ke)+tt*(ae*Te-ge*xe)),I[13]=F*(xe*Ye-Te*Ke)-he*(R*Ye-O*Ke)+tt*(R*Te-O*xe),I[14]=-(F*(ae*Ye-ge*Ke)-te*(R*Ye-O*Ke)+tt*(R*ge-O*ae)),I[15]=F*(ae*Te-ge*xe)-te*(R*Te-O*xe)+he*(R*ge-O*ae),I},Ue.determinant=function(I){var z=I[0],F=I[1],R=I[2],O=I[3],q=I[4],te=I[5],ae=I[6],ge=I[7],_e=I[8],he=I[9],xe=I[10],Te=I[11],Ae=I[12],tt=I[13],Ke=I[14],Ye=I[15];return(z*te-F*q)*(xe*Ye-Te*Ke)-(z*ae-R*q)*(he*Ye-Te*tt)+(z*ge-O*q)*(he*Ke-xe*tt)+(F*ae-R*te)*(_e*Ye-Te*Ae)-(F*ge-O*te)*(_e*Ke-xe*Ae)+(R*ge-O*ae)*(_e*tt-he*Ae)},Ue.multiply=v,Ue.translate=function(I,z,F){var R,O,q,te,ae,ge,_e,he,xe,Te,Ae,tt,Ke=F[0],Ye=F[1],Ct=F[2];return z===I?(I[12]=z[0]*Ke+z[4]*Ye+z[8]*Ct+z[12],I[13]=z[1]*Ke+z[5]*Ye+z[9]*Ct+z[13],I[14]=z[2]*Ke+z[6]*Ye+z[10]*Ct+z[14],I[15]=z[3]*Ke+z[7]*Ye+z[11]*Ct+z[15]):(O=z[1],q=z[2],te=z[3],ae=z[4],ge=z[5],_e=z[6],he=z[7],xe=z[8],Te=z[9],Ae=z[10],tt=z[11],I[0]=R=z[0],I[1]=O,I[2]=q,I[3]=te,I[4]=ae,I[5]=ge,I[6]=_e,I[7]=he,I[8]=xe,I[9]=Te,I[10]=Ae,I[11]=tt,I[12]=R*Ke+ae*Ye+xe*Ct+z[12],I[13]=O*Ke+ge*Ye+Te*Ct+z[13],I[14]=q*Ke+_e*Ye+Ae*Ct+z[14],I[15]=te*Ke+he*Ye+tt*Ct+z[15]),I},Ue.scale=function(I,z,F){var R=F[0],O=F[1],q=F[2];return I[0]=z[0]*R,I[1]=z[1]*R,I[2]=z[2]*R,I[3]=z[3]*R,I[4]=z[4]*O,I[5]=z[5]*O,I[6]=z[6]*O,I[7]=z[7]*O,I[8]=z[8]*q,I[9]=z[9]*q,I[10]=z[10]*q,I[11]=z[11]*q,I[12]=z[12],I[13]=z[13],I[14]=z[14],I[15]=z[15],I},Ue.rotate=function(I,z,F,R){var O,q,te,ae,ge,_e,he,xe,Te,Ae,tt,Ke,Ye,Ct,ct,It,Rt,At,Vt,Wt,Kt,qt,yn,Yn,xn=R[0],di=R[1],ci=R[2],Ti=Math.hypot(xn,di,ci);return Ti<n.EPSILON?null:(xn*=Ti=1/Ti,di*=Ti,ci*=Ti,O=Math.sin(F),q=Math.cos(F),ge=z[1],_e=z[2],he=z[3],Te=z[5],Ae=z[6],tt=z[7],Ye=z[9],Ct=z[10],ct=z[11],It=xn*xn*(te=1-q)+q,Vt=xn*di*te-ci*O,Wt=di*di*te+q,Kt=ci*di*te+xn*O,qt=xn*ci*te+di*O,yn=di*ci*te-xn*O,Yn=ci*ci*te+q,I[0]=(ae=z[0])*It+(xe=z[4])*(Rt=di*xn*te+ci*O)+(Ke=z[8])*(At=ci*xn*te-di*O),I[1]=ge*It+Te*Rt+Ye*At,I[2]=_e*It+Ae*Rt+Ct*At,I[3]=he*It+tt*Rt+ct*At,I[4]=ae*Vt+xe*Wt+Ke*Kt,I[5]=ge*Vt+Te*Wt+Ye*Kt,I[6]=_e*Vt+Ae*Wt+Ct*Kt,I[7]=he*Vt+tt*Wt+ct*Kt,I[8]=ae*qt+xe*yn+Ke*Yn,I[9]=ge*qt+Te*yn+Ye*Yn,I[10]=_e*qt+Ae*yn+Ct*Yn,I[11]=he*qt+tt*yn+ct*Yn,z!==I&&(I[12]=z[12],I[13]=z[13],I[14]=z[14],I[15]=z[15]),I)},Ue.rotateX=function(I,z,F){var R=Math.sin(F),O=Math.cos(F),q=z[4],te=z[5],ae=z[6],ge=z[7],_e=z[8],he=z[9],xe=z[10],Te=z[11];return z!==I&&(I[0]=z[0],I[1]=z[1],I[2]=z[2],I[3]=z[3],I[12]=z[12],I[13]=z[13],I[14]=z[14],I[15]=z[15]),I[4]=q*O+_e*R,I[5]=te*O+he*R,I[6]=ae*O+xe*R,I[7]=ge*O+Te*R,I[8]=_e*O-q*R,I[9]=he*O-te*R,I[10]=xe*O-ae*R,I[11]=Te*O-ge*R,I},Ue.rotateY=function(I,z,F){var R=Math.sin(F),O=Math.cos(F),q=z[0],te=z[1],ae=z[2],ge=z[3],_e=z[8],he=z[9],xe=z[10],Te=z[11];return z!==I&&(I[4]=z[4],I[5]=z[5],I[6]=z[6],I[7]=z[7],I[12]=z[12],I[13]=z[13],I[14]=z[14],I[15]=z[15]),I[0]=q*O-_e*R,I[1]=te*O-he*R,I[2]=ae*O-xe*R,I[3]=ge*O-Te*R,I[8]=q*R+_e*O,I[9]=te*R+he*O,I[10]=ae*R+xe*O,I[11]=ge*R+Te*O,I},Ue.rotateZ=function(I,z,F){var R=Math.sin(F),O=Math.cos(F),q=z[0],te=z[1],ae=z[2],ge=z[3],_e=z[4],he=z[5],xe=z[6],Te=z[7];return z!==I&&(I[8]=z[8],I[9]=z[9],I[10]=z[10],I[11]=z[11],I[12]=z[12],I[13]=z[13],I[14]=z[14],I[15]=z[15]),I[0]=q*O+_e*R,I[1]=te*O+he*R,I[2]=ae*O+xe*R,I[3]=ge*O+Te*R,I[4]=_e*O-q*R,I[5]=he*O-te*R,I[6]=xe*O-ae*R,I[7]=Te*O-ge*R,I},Ue.fromTranslation=function(I,z){return I[0]=1,I[1]=0,I[2]=0,I[3]=0,I[4]=0,I[5]=1,I[6]=0,I[7]=0,I[8]=0,I[9]=0,I[10]=1,I[11]=0,I[12]=z[0],I[13]=z[1],I[14]=z[2],I[15]=1,I},Ue.fromScaling=function(I,z){return I[0]=z[0],I[1]=0,I[2]=0,I[3]=0,I[4]=0,I[5]=z[1],I[6]=0,I[7]=0,I[8]=0,I[9]=0,I[10]=z[2],I[11]=0,I[12]=0,I[13]=0,I[14]=0,I[15]=1,I},Ue.fromRotation=function(I,z,F){var R,O,q,te=F[0],ae=F[1],ge=F[2],_e=Math.hypot(te,ae,ge);return _e<n.EPSILON?null:(te*=_e=1/_e,ae*=_e,ge*=_e,R=Math.sin(z),O=Math.cos(z),I[0]=te*te*(q=1-O)+O,I[1]=ae*te*q+ge*R,I[2]=ge*te*q-ae*R,I[3]=0,I[4]=te*ae*q-ge*R,I[5]=ae*ae*q+O,I[6]=ge*ae*q+te*R,I[7]=0,I[8]=te*ge*q+ae*R,I[9]=ae*ge*q-te*R,I[10]=ge*ge*q+O,I[11]=0,I[12]=0,I[13]=0,I[14]=0,I[15]=1,I)},Ue.fromXRotation=function(I,z){var F=Math.sin(z),R=Math.cos(z);return I[0]=1,I[1]=0,I[2]=0,I[3]=0,I[4]=0,I[5]=R,I[6]=F,I[7]=0,I[8]=0,I[9]=-F,I[10]=R,I[11]=0,I[12]=0,I[13]=0,I[14]=0,I[15]=1,I},Ue.fromYRotation=function(I,z){var F=Math.sin(z),R=Math.cos(z);return I[0]=R,I[1]=0,I[2]=-F,I[3]=0,I[4]=0,I[5]=1,I[6]=0,I[7]=0,I[8]=F,I[9]=0,I[10]=R,I[11]=0,I[12]=0,I[13]=0,I[14]=0,I[15]=1,I},Ue.fromZRotation=function(I,z){var F=Math.sin(z),R=Math.cos(z);return I[0]=R,I[1]=F,I[2]=0,I[3]=0,I[4]=-F,I[5]=R,I[6]=0,I[7]=0,I[8]=0,I[9]=0,I[10]=1,I[11]=0,I[12]=0,I[13]=0,I[14]=0,I[15]=1,I},Ue.fromRotationTranslation=f,Ue.fromQuat2=function(I,z){var F=new n.ARRAY_TYPE(3),R=-z[0],O=-z[1],q=-z[2],te=z[3],ae=z[4],ge=z[5],_e=z[6],he=z[7],xe=R*R+O*O+q*q+te*te;return xe>0?(F[0]=2*(ae*te+he*R+ge*q-_e*O)/xe,F[1]=2*(ge*te+he*O+_e*R-ae*q)/xe,F[2]=2*(_e*te+he*q+ae*O-ge*R)/xe):(F[0]=2*(ae*te+he*R+ge*q-_e*O),F[1]=2*(ge*te+he*O+_e*R-ae*q),F[2]=2*(_e*te+he*q+ae*O-ge*R)),f(I,z,F),I},Ue.getTranslation=function(I,z){return I[0]=z[12],I[1]=z[13],I[2]=z[14],I},Ue.getScaling=x,Ue.getRotation=function(I,z){var F=new n.ARRAY_TYPE(3);x(F,z);var R=1/F[0],O=1/F[1],q=1/F[2],te=z[0]*R,ae=z[1]*O,ge=z[2]*q,_e=z[4]*R,he=z[5]*O,xe=z[6]*q,Te=z[8]*R,Ae=z[9]*O,tt=z[10]*q,Ke=te+he+tt,Ye=0;return Ke>0?(Ye=2*Math.sqrt(Ke+1),I[3]=.25*Ye,I[0]=(xe-Ae)/Ye,I[1]=(Te-ge)/Ye,I[2]=(ae-_e)/Ye):te>he&&te>tt?(Ye=2*Math.sqrt(1+te-he-tt),I[3]=(xe-Ae)/Ye,I[0]=.25*Ye,I[1]=(ae+_e)/Ye,I[2]=(Te+ge)/Ye):he>tt?(Ye=2*Math.sqrt(1+he-te-tt),I[3]=(Te-ge)/Ye,I[0]=(ae+_e)/Ye,I[1]=.25*Ye,I[2]=(xe+Ae)/Ye):(Ye=2*Math.sqrt(1+tt-te-he),I[3]=(ae-_e)/Ye,I[0]=(Te+ge)/Ye,I[1]=(xe+Ae)/Ye,I[2]=.25*Ye),I},Ue.fromRotationTranslationScale=function(I,z,F,R){var O=z[0],q=z[1],te=z[2],ae=z[3],ge=O+O,_e=q+q,he=te+te,xe=O*ge,Te=O*_e,Ae=O*he,tt=q*_e,Ke=q*he,Ye=te*he,Ct=ae*ge,ct=ae*_e,It=ae*he,Rt=R[0],At=R[1],Vt=R[2];return I[0]=(1-(tt+Ye))*Rt,I[1]=(Te+It)*Rt,I[2]=(Ae-ct)*Rt,I[3]=0,I[4]=(Te-It)*At,I[5]=(1-(xe+Ye))*At,I[6]=(Ke+Ct)*At,I[7]=0,I[8]=(Ae+ct)*Vt,I[9]=(Ke-Ct)*Vt,I[10]=(1-(xe+tt))*Vt,I[11]=0,I[12]=F[0],I[13]=F[1],I[14]=F[2],I[15]=1,I},Ue.fromRotationTranslationScaleOrigin=function(I,z,F,R,O){var q=z[0],te=z[1],ae=z[2],ge=z[3],_e=q+q,he=te+te,xe=ae+ae,Te=q*_e,Ae=q*he,tt=q*xe,Ke=te*he,Ye=te*xe,Ct=ae*xe,ct=ge*_e,It=ge*he,Rt=ge*xe,At=R[0],Vt=R[1],Wt=R[2],Kt=O[0],qt=O[1],yn=O[2],Yn=(1-(Ke+Ct))*At,xn=(Ae+Rt)*At,di=(tt-It)*At,ci=(Ae-Rt)*Vt,Ti=(1-(Te+Ct))*Vt,In=(Ye+ct)*Vt,ji=(tt+It)*Wt,gi=(Ye-ct)*Wt,Oi=(1-(Te+Ke))*Wt;return I[0]=Yn,I[1]=xn,I[2]=di,I[3]=0,I[4]=ci,I[5]=Ti,I[6]=In,I[7]=0,I[8]=ji,I[9]=gi,I[10]=Oi,I[11]=0,I[12]=F[0]+Kt-(Yn*Kt+ci*qt+ji*yn),I[13]=F[1]+qt-(xn*Kt+Ti*qt+gi*yn),I[14]=F[2]+yn-(di*Kt+In*qt+Oi*yn),I[15]=1,I},Ue.fromQuat=function(I,z){var F=z[0],R=z[1],O=z[2],q=z[3],te=F+F,ae=R+R,ge=O+O,_e=F*te,he=R*te,xe=R*ae,Te=O*te,Ae=O*ae,tt=O*ge,Ke=q*te,Ye=q*ae,Ct=q*ge;return I[0]=1-xe-tt,I[1]=he+Ct,I[2]=Te-Ye,I[3]=0,I[4]=he-Ct,I[5]=1-_e-tt,I[6]=Ae+Ke,I[7]=0,I[8]=Te+Ye,I[9]=Ae-Ke,I[10]=1-_e-xe,I[11]=0,I[12]=0,I[13]=0,I[14]=0,I[15]=1,I},Ue.frustum=function(I,z,F,R,O,q,te){var ae=1/(F-z),ge=1/(O-R),_e=1/(q-te);return I[0]=2*q*ae,I[1]=0,I[2]=0,I[3]=0,I[4]=0,I[5]=2*q*ge,I[6]=0,I[7]=0,I[8]=(F+z)*ae,I[9]=(O+R)*ge,I[10]=(te+q)*_e,I[11]=-1,I[12]=0,I[13]=0,I[14]=te*q*2*_e,I[15]=0,I},Ue.perspectiveNO=P,Ue.perspectiveZO=function(I,z,F,R,O){var q,te=1/Math.tan(z/2);return I[0]=te/F,I[1]=0,I[2]=0,I[3]=0,I[4]=0,I[5]=te,I[6]=0,I[7]=0,I[8]=0,I[9]=0,I[11]=-1,I[12]=0,I[13]=0,I[15]=0,O!=null&&O!==1/0?(I[10]=O*(q=1/(R-O)),I[14]=O*R*q):(I[10]=-1,I[14]=-R),I},Ue.perspectiveFromFieldOfView=function(I,z,F,R){var O=Math.tan(z.upDegrees*Math.PI/180),q=Math.tan(z.downDegrees*Math.PI/180),te=Math.tan(z.leftDegrees*Math.PI/180),ae=Math.tan(z.rightDegrees*Math.PI/180),ge=2/(te+ae),_e=2/(O+q);return I[0]=ge,I[1]=0,I[2]=0,I[3]=0,I[4]=0,I[5]=_e,I[6]=0,I[7]=0,I[8]=-(te-ae)*ge*.5,I[9]=(O-q)*_e*.5,I[10]=R/(F-R),I[11]=-1,I[12]=0,I[13]=0,I[14]=R*F/(F-R),I[15]=0,I},Ue.orthoNO=L,Ue.orthoZO=function(I,z,F,R,O,q,te){var ae=1/(z-F),ge=1/(R-O),_e=1/(q-te);return I[0]=-2*ae,I[1]=0,I[2]=0,I[3]=0,I[4]=0,I[5]=-2*ge,I[6]=0,I[7]=0,I[8]=0,I[9]=0,I[10]=_e,I[11]=0,I[12]=(z+F)*ae,I[13]=(O+R)*ge,I[14]=q*_e,I[15]=1,I},Ue.lookAt=function(I,z,F,R){var O,q,te,ae,ge,_e,he,xe,Te,Ae,tt=z[0],Ke=z[1],Ye=z[2],Ct=R[0],ct=R[1],It=R[2],Rt=F[0],At=F[1],Vt=F[2];return Math.abs(tt-Rt)<n.EPSILON&&Math.abs(Ke-At)<n.EPSILON&&Math.abs(Ye-Vt)<n.EPSILON?h(I):(he=tt-Rt,xe=Ke-At,Te=Ye-Vt,O=ct*(Te*=Ae=1/Math.hypot(he,xe,Te))-It*(xe*=Ae),q=It*(he*=Ae)-Ct*Te,te=Ct*xe-ct*he,(Ae=Math.hypot(O,q,te))?(O*=Ae=1/Ae,q*=Ae,te*=Ae):(O=0,q=0,te=0),ae=xe*te-Te*q,ge=Te*O-he*te,_e=he*q-xe*O,(Ae=Math.hypot(ae,ge,_e))?(ae*=Ae=1/Ae,ge*=Ae,_e*=Ae):(ae=0,ge=0,_e=0),I[0]=O,I[1]=ae,I[2]=he,I[3]=0,I[4]=q,I[5]=ge,I[6]=xe,I[7]=0,I[8]=te,I[9]=_e,I[10]=Te,I[11]=0,I[12]=-(O*tt+q*Ke+te*Ye),I[13]=-(ae*tt+ge*Ke+_e*Ye),I[14]=-(he*tt+xe*Ke+Te*Ye),I[15]=1,I)},Ue.targetTo=function(I,z,F,R){var O=z[0],q=z[1],te=z[2],ae=R[0],ge=R[1],_e=R[2],he=O-F[0],xe=q-F[1],Te=te-F[2],Ae=he*he+xe*xe+Te*Te;Ae>0&&(he*=Ae=1/Math.sqrt(Ae),xe*=Ae,Te*=Ae);var tt=ge*Te-_e*xe,Ke=_e*he-ae*Te,Ye=ae*xe-ge*he;return(Ae=tt*tt+Ke*Ke+Ye*Ye)>0&&(tt*=Ae=1/Math.sqrt(Ae),Ke*=Ae,Ye*=Ae),I[0]=tt,I[1]=Ke,I[2]=Ye,I[3]=0,I[4]=xe*Ye-Te*Ke,I[5]=Te*tt-he*Ye,I[6]=he*Ke-xe*tt,I[7]=0,I[8]=he,I[9]=xe,I[10]=Te,I[11]=0,I[12]=O,I[13]=q,I[14]=te,I[15]=1,I},Ue.str=function(I){return"mat4("+I[0]+", "+I[1]+", "+I[2]+", "+I[3]+", "+I[4]+", "+I[5]+", "+I[6]+", "+I[7]+", "+I[8]+", "+I[9]+", "+I[10]+", "+I[11]+", "+I[12]+", "+I[13]+", "+I[14]+", "+I[15]+")"},Ue.frob=function(I){return Math.hypot(I[0],I[1],I[2],I[3],I[4],I[5],I[6],I[7],I[8],I[9],I[10],I[11],I[12],I[13],I[14],I[15])},Ue.add=function(I,z,F){return I[0]=z[0]+F[0],I[1]=z[1]+F[1],I[2]=z[2]+F[2],I[3]=z[3]+F[3],I[4]=z[4]+F[4],I[5]=z[5]+F[5],I[6]=z[6]+F[6],I[7]=z[7]+F[7],I[8]=z[8]+F[8],I[9]=z[9]+F[9],I[10]=z[10]+F[10],I[11]=z[11]+F[11],I[12]=z[12]+F[12],I[13]=z[13]+F[13],I[14]=z[14]+F[14],I[15]=z[15]+F[15],I},Ue.subtract=N,Ue.multiplyScalar=function(I,z,F){return I[0]=z[0]*F,I[1]=z[1]*F,I[2]=z[2]*F,I[3]=z[3]*F,I[4]=z[4]*F,I[5]=z[5]*F,I[6]=z[6]*F,I[7]=z[7]*F,I[8]=z[8]*F,I[9]=z[9]*F,I[10]=z[10]*F,I[11]=z[11]*F,I[12]=z[12]*F,I[13]=z[13]*F,I[14]=z[14]*F,I[15]=z[15]*F,I},Ue.multiplyScalarAndAdd=function(I,z,F,R){return I[0]=z[0]+F[0]*R,I[1]=z[1]+F[1]*R,I[2]=z[2]+F[2]*R,I[3]=z[3]+F[3]*R,I[4]=z[4]+F[4]*R,I[5]=z[5]+F[5]*R,I[6]=z[6]+F[6]*R,I[7]=z[7]+F[7]*R,I[8]=z[8]+F[8]*R,I[9]=z[9]+F[9]*R,I[10]=z[10]+F[10]*R,I[11]=z[11]+F[11]*R,I[12]=z[12]+F[12]*R,I[13]=z[13]+F[13]*R,I[14]=z[14]+F[14]*R,I[15]=z[15]+F[15]*R,I},Ue.exactEquals=function(I,z){return I[0]===z[0]&&I[1]===z[1]&&I[2]===z[2]&&I[3]===z[3]&&I[4]===z[4]&&I[5]===z[5]&&I[6]===z[6]&&I[7]===z[7]&&I[8]===z[8]&&I[9]===z[9]&&I[10]===z[10]&&I[11]===z[11]&&I[12]===z[12]&&I[13]===z[13]&&I[14]===z[14]&&I[15]===z[15]},Ue.equals=function(I,z){var F=I[0],R=I[1],O=I[2],q=I[3],te=I[4],ae=I[5],ge=I[6],_e=I[7],he=I[8],xe=I[9],Te=I[10],Ae=I[11],tt=I[12],Ke=I[13],Ye=I[14],Ct=I[15],ct=z[0],It=z[1],Rt=z[2],At=z[3],Vt=z[4],Wt=z[5],Kt=z[6],qt=z[7],yn=z[8],Yn=z[9],xn=z[10],di=z[11],ci=z[12],Ti=z[13],In=z[14],ji=z[15];return Math.abs(F-ct)<=n.EPSILON*Math.max(1,Math.abs(F),Math.abs(ct))&&Math.abs(R-It)<=n.EPSILON*Math.max(1,Math.abs(R),Math.abs(It))&&Math.abs(O-Rt)<=n.EPSILON*Math.max(1,Math.abs(O),Math.abs(Rt))&&Math.abs(q-At)<=n.EPSILON*Math.max(1,Math.abs(q),Math.abs(At))&&Math.abs(te-Vt)<=n.EPSILON*Math.max(1,Math.abs(te),Math.abs(Vt))&&Math.abs(ae-Wt)<=n.EPSILON*Math.max(1,Math.abs(ae),Math.abs(Wt))&&Math.abs(ge-Kt)<=n.EPSILON*Math.max(1,Math.abs(ge),Math.abs(Kt))&&Math.abs(_e-qt)<=n.EPSILON*Math.max(1,Math.abs(_e),Math.abs(qt))&&Math.abs(he-yn)<=n.EPSILON*Math.max(1,Math.abs(he),Math.abs(yn))&&Math.abs(xe-Yn)<=n.EPSILON*Math.max(1,Math.abs(xe),Math.abs(Yn))&&Math.abs(Te-xn)<=n.EPSILON*Math.max(1,Math.abs(Te),Math.abs(xn))&&Math.abs(Ae-di)<=n.EPSILON*Math.max(1,Math.abs(Ae),Math.abs(di))&&Math.abs(tt-ci)<=n.EPSILON*Math.max(1,Math.abs(tt),Math.abs(ci))&&Math.abs(Ke-Ti)<=n.EPSILON*Math.max(1,Math.abs(Ke),Math.abs(Ti))&&Math.abs(Ye-In)<=n.EPSILON*Math.max(1,Math.abs(Ye),Math.abs(In))&&Math.abs(Ct-ji)<=n.EPSILON*Math.max(1,Math.abs(Ct),Math.abs(ji))},Ue.sub=Ue.mul=Ue.ortho=Ue.perspective=void 0;var n=function(I,z){if(I&&I.__esModule)return I;if(I===null||c(I)!=="object"&&typeof I!="function")return{default:I};var F=a(void 0);if(F&&F.has(I))return F.get(I);var R={},O=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var q in I)if(q!=="default"&&Object.prototype.hasOwnProperty.call(I,q)){var te=O?Object.getOwnPropertyDescriptor(I,q):null;te&&(te.get||te.set)?Object.defineProperty(R,q,te):R[q]=I[q]}return R.default=I,F&&F.set(I,R),R}(J());function a(I){if(typeof WeakMap!="function")return null;var z=new WeakMap,F=new WeakMap;return(a=function(R){return R?F:z})(I)}function h(I){return I[0]=1,I[1]=0,I[2]=0,I[3]=0,I[4]=0,I[5]=1,I[6]=0,I[7]=0,I[8]=0,I[9]=0,I[10]=1,I[11]=0,I[12]=0,I[13]=0,I[14]=0,I[15]=1,I}function v(I,z,F){var R=z[0],O=z[1],q=z[2],te=z[3],ae=z[4],ge=z[5],_e=z[6],he=z[7],xe=z[8],Te=z[9],Ae=z[10],tt=z[11],Ke=z[12],Ye=z[13],Ct=z[14],ct=z[15],It=F[0],Rt=F[1],At=F[2],Vt=F[3];return I[0]=It*R+Rt*ae+At*xe+Vt*Ke,I[1]=It*O+Rt*ge+At*Te+Vt*Ye,I[2]=It*q+Rt*_e+At*Ae+Vt*Ct,I[3]=It*te+Rt*he+At*tt+Vt*ct,I[4]=(It=F[4])*R+(Rt=F[5])*ae+(At=F[6])*xe+(Vt=F[7])*Ke,I[5]=It*O+Rt*ge+At*Te+Vt*Ye,I[6]=It*q+Rt*_e+At*Ae+Vt*Ct,I[7]=It*te+Rt*he+At*tt+Vt*ct,I[8]=(It=F[8])*R+(Rt=F[9])*ae+(At=F[10])*xe+(Vt=F[11])*Ke,I[9]=It*O+Rt*ge+At*Te+Vt*Ye,I[10]=It*q+Rt*_e+At*Ae+Vt*Ct,I[11]=It*te+Rt*he+At*tt+Vt*ct,I[12]=(It=F[12])*R+(Rt=F[13])*ae+(At=F[14])*xe+(Vt=F[15])*Ke,I[13]=It*O+Rt*ge+At*Te+Vt*Ye,I[14]=It*q+Rt*_e+At*Ae+Vt*Ct,I[15]=It*te+Rt*he+At*tt+Vt*ct,I}function f(I,z,F){var R=z[0],O=z[1],q=z[2],te=z[3],ae=R+R,ge=O+O,_e=q+q,he=R*ae,xe=R*ge,Te=R*_e,Ae=O*ge,tt=O*_e,Ke=q*_e,Ye=te*ae,Ct=te*ge,ct=te*_e;return I[0]=1-(Ae+Ke),I[1]=xe+ct,I[2]=Te-Ct,I[3]=0,I[4]=xe-ct,I[5]=1-(he+Ke),I[6]=tt+Ye,I[7]=0,I[8]=Te+Ct,I[9]=tt-Ye,I[10]=1-(he+Ae),I[11]=0,I[12]=F[0],I[13]=F[1],I[14]=F[2],I[15]=1,I}function x(I,z){var F=z[4],R=z[5],O=z[6],q=z[8],te=z[9],ae=z[10];return I[0]=Math.hypot(z[0],z[1],z[2]),I[1]=Math.hypot(F,R,O),I[2]=Math.hypot(q,te,ae),I}function P(I,z,F,R,O){var q,te=1/Math.tan(z/2);return I[0]=te/F,I[1]=0,I[2]=0,I[3]=0,I[4]=0,I[5]=te,I[6]=0,I[7]=0,I[8]=0,I[9]=0,I[11]=-1,I[12]=0,I[13]=0,I[15]=0,O!=null&&O!==1/0?(I[10]=(O+R)*(q=1/(R-O)),I[14]=2*O*R*q):(I[10]=-1,I[14]=-2*R),I}function L(I,z,F,R,O,q,te){var ae=1/(z-F),ge=1/(R-O),_e=1/(q-te);return I[0]=-2*ae,I[1]=0,I[2]=0,I[3]=0,I[4]=0,I[5]=-2*ge,I[6]=0,I[7]=0,I[8]=0,I[9]=0,I[10]=2*_e,I[11]=0,I[12]=(z+F)*ae,I[13]=(O+R)*ge,I[14]=(te+q)*_e,I[15]=1,I}function N(I,z,F){return I[0]=z[0]-F[0],I[1]=z[1]-F[1],I[2]=z[2]-F[2],I[3]=z[3]-F[3],I[4]=z[4]-F[4],I[5]=z[5]-F[5],I[6]=z[6]-F[6],I[7]=z[7]-F[7],I[8]=z[8]-F[8],I[9]=z[9]-F[9],I[10]=z[10]-F[10],I[11]=z[11]-F[11],I[12]=z[12]-F[12],I[13]=z[13]-F[13],I[14]=z[14]-F[14],I[15]=z[15]-F[15],I}return Ue.perspective=P,Ue.ortho=L,Ue.mul=v,Ue.sub=N,Ue}var He,nt={},rt={};function ft(){if(He)return rt;function c(O){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(q){return typeof q}:function(q){return q&&typeof Symbol=="function"&&q.constructor===Symbol&&q!==Symbol.prototype?"symbol":typeof q},c(O)}He=1,Object.defineProperty(rt,"__esModule",{value:!0}),rt.create=h,rt.clone=function(O){var q=new n.ARRAY_TYPE(3);return q[0]=O[0],q[1]=O[1],q[2]=O[2],q},rt.length=v,rt.fromValues=function(O,q,te){var ae=new n.ARRAY_TYPE(3);return ae[0]=O,ae[1]=q,ae[2]=te,ae},rt.copy=function(O,q){return O[0]=q[0],O[1]=q[1],O[2]=q[2],O},rt.set=function(O,q,te,ae){return O[0]=q,O[1]=te,O[2]=ae,O},rt.add=function(O,q,te){return O[0]=q[0]+te[0],O[1]=q[1]+te[1],O[2]=q[2]+te[2],O},rt.subtract=f,rt.multiply=x,rt.divide=P,rt.ceil=function(O,q){return O[0]=Math.ceil(q[0]),O[1]=Math.ceil(q[1]),O[2]=Math.ceil(q[2]),O},rt.floor=function(O,q){return O[0]=Math.floor(q[0]),O[1]=Math.floor(q[1]),O[2]=Math.floor(q[2]),O},rt.min=function(O,q,te){return O[0]=Math.min(q[0],te[0]),O[1]=Math.min(q[1],te[1]),O[2]=Math.min(q[2],te[2]),O},rt.max=function(O,q,te){return O[0]=Math.max(q[0],te[0]),O[1]=Math.max(q[1],te[1]),O[2]=Math.max(q[2],te[2]),O},rt.round=function(O,q){return O[0]=Math.round(q[0]),O[1]=Math.round(q[1]),O[2]=Math.round(q[2]),O},rt.scale=function(O,q,te){return O[0]=q[0]*te,O[1]=q[1]*te,O[2]=q[2]*te,O},rt.scaleAndAdd=function(O,q,te,ae){return O[0]=q[0]+te[0]*ae,O[1]=q[1]+te[1]*ae,O[2]=q[2]+te[2]*ae,O},rt.distance=L,rt.squaredDistance=N,rt.squaredLength=I,rt.negate=function(O,q){return O[0]=-q[0],O[1]=-q[1],O[2]=-q[2],O},rt.inverse=function(O,q){return O[0]=1/q[0],O[1]=1/q[1],O[2]=1/q[2],O},rt.normalize=function(O,q){var te=q[0],ae=q[1],ge=q[2],_e=te*te+ae*ae+ge*ge;return _e>0&&(_e=1/Math.sqrt(_e)),O[0]=q[0]*_e,O[1]=q[1]*_e,O[2]=q[2]*_e,O},rt.dot=z,rt.cross=function(O,q,te){var ae=q[0],ge=q[1],_e=q[2],he=te[0],xe=te[1],Te=te[2];return O[0]=ge*Te-_e*xe,O[1]=_e*he-ae*Te,O[2]=ae*xe-ge*he,O},rt.lerp=function(O,q,te,ae){var ge=q[0],_e=q[1],he=q[2];return O[0]=ge+ae*(te[0]-ge),O[1]=_e+ae*(te[1]-_e),O[2]=he+ae*(te[2]-he),O},rt.hermite=function(O,q,te,ae,ge,_e){var he=_e*_e,xe=he*(2*_e-3)+1,Te=he*(_e-2)+_e,Ae=he*(_e-1),tt=he*(3-2*_e);return O[0]=q[0]*xe+te[0]*Te+ae[0]*Ae+ge[0]*tt,O[1]=q[1]*xe+te[1]*Te+ae[1]*Ae+ge[1]*tt,O[2]=q[2]*xe+te[2]*Te+ae[2]*Ae+ge[2]*tt,O},rt.bezier=function(O,q,te,ae,ge,_e){var he=1-_e,xe=he*he,Te=_e*_e,Ae=xe*he,tt=3*_e*xe,Ke=3*Te*he,Ye=Te*_e;return O[0]=q[0]*Ae+te[0]*tt+ae[0]*Ke+ge[0]*Ye,O[1]=q[1]*Ae+te[1]*tt+ae[1]*Ke+ge[1]*Ye,O[2]=q[2]*Ae+te[2]*tt+ae[2]*Ke+ge[2]*Ye,O},rt.random=function(O,q){q=q||1;var te=2*n.RANDOM()*Math.PI,ae=2*n.RANDOM()-1,ge=Math.sqrt(1-ae*ae)*q;return O[0]=Math.cos(te)*ge,O[1]=Math.sin(te)*ge,O[2]=ae*q,O},rt.transformMat4=function(O,q,te){var ae=q[0],ge=q[1],_e=q[2],he=te[3]*ae+te[7]*ge+te[11]*_e+te[15];return O[0]=(te[0]*ae+te[4]*ge+te[8]*_e+te[12])/(he=he||1),O[1]=(te[1]*ae+te[5]*ge+te[9]*_e+te[13])/he,O[2]=(te[2]*ae+te[6]*ge+te[10]*_e+te[14])/he,O},rt.transformMat3=function(O,q,te){var ae=q[0],ge=q[1],_e=q[2];return O[0]=ae*te[0]+ge*te[3]+_e*te[6],O[1]=ae*te[1]+ge*te[4]+_e*te[7],O[2]=ae*te[2]+ge*te[5]+_e*te[8],O},rt.transformQuat=function(O,q,te){var ae=te[0],ge=te[1],_e=te[2],he=q[0],xe=q[1],Te=q[2],Ae=ge*Te-_e*xe,tt=_e*he-ae*Te,Ke=ae*xe-ge*he,Ye=ge*Ke-_e*tt,Ct=_e*Ae-ae*Ke,ct=ae*tt-ge*Ae,It=2*te[3];return tt*=It,Ke*=It,Ct*=2,ct*=2,O[0]=he+(Ae*=It)+(Ye*=2),O[1]=xe+tt+Ct,O[2]=Te+Ke+ct,O},rt.rotateX=function(O,q,te,ae){var ge=[],_e=[];return ge[0]=q[0]-te[0],ge[1]=q[1]-te[1],ge[2]=q[2]-te[2],_e[0]=ge[0],_e[1]=ge[1]*Math.cos(ae)-ge[2]*Math.sin(ae),_e[2]=ge[1]*Math.sin(ae)+ge[2]*Math.cos(ae),O[0]=_e[0]+te[0],O[1]=_e[1]+te[1],O[2]=_e[2]+te[2],O},rt.rotateY=function(O,q,te,ae){var ge=[],_e=[];return ge[0]=q[0]-te[0],ge[1]=q[1]-te[1],ge[2]=q[2]-te[2],_e[0]=ge[2]*Math.sin(ae)+ge[0]*Math.cos(ae),_e[1]=ge[1],_e[2]=ge[2]*Math.cos(ae)-ge[0]*Math.sin(ae),O[0]=_e[0]+te[0],O[1]=_e[1]+te[1],O[2]=_e[2]+te[2],O},rt.rotateZ=function(O,q,te,ae){var ge=[],_e=[];return ge[0]=q[0]-te[0],ge[1]=q[1]-te[1],ge[2]=q[2]-te[2],_e[0]=ge[0]*Math.cos(ae)-ge[1]*Math.sin(ae),_e[1]=ge[0]*Math.sin(ae)+ge[1]*Math.cos(ae),_e[2]=ge[2],O[0]=_e[0]+te[0],O[1]=_e[1]+te[1],O[2]=_e[2]+te[2],O},rt.angle=function(O,q){var te=O[0],ae=O[1],ge=O[2],_e=q[0],he=q[1],xe=q[2],Te=Math.sqrt(te*te+ae*ae+ge*ge)*Math.sqrt(_e*_e+he*he+xe*xe),Ae=Te&&z(O,q)/Te;return Math.acos(Math.min(Math.max(Ae,-1),1))},rt.zero=function(O){return O[0]=0,O[1]=0,O[2]=0,O},rt.str=function(O){return"vec3("+O[0]+", "+O[1]+", "+O[2]+")"},rt.exactEquals=function(O,q){return O[0]===q[0]&&O[1]===q[1]&&O[2]===q[2]},rt.equals=function(O,q){var te=O[0],ae=O[1],ge=O[2],_e=q[0],he=q[1],xe=q[2];return Math.abs(te-_e)<=n.EPSILON*Math.max(1,Math.abs(te),Math.abs(_e))&&Math.abs(ae-he)<=n.EPSILON*Math.max(1,Math.abs(ae),Math.abs(he))&&Math.abs(ge-xe)<=n.EPSILON*Math.max(1,Math.abs(ge),Math.abs(xe))},rt.forEach=rt.sqrLen=rt.len=rt.sqrDist=rt.dist=rt.div=rt.mul=rt.sub=void 0;var n=function(O,q){if(O&&O.__esModule)return O;if(O===null||c(O)!=="object"&&typeof O!="function")return{default:O};var te=a(void 0);if(te&&te.has(O))return te.get(O);var ae={},ge=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var _e in O)if(_e!=="default"&&Object.prototype.hasOwnProperty.call(O,_e)){var he=ge?Object.getOwnPropertyDescriptor(O,_e):null;he&&(he.get||he.set)?Object.defineProperty(ae,_e,he):ae[_e]=O[_e]}return ae.default=O,te&&te.set(O,ae),ae}(J());function a(O){if(typeof WeakMap!="function")return null;var q=new WeakMap,te=new WeakMap;return(a=function(ae){return ae?te:q})(O)}function h(){var O=new n.ARRAY_TYPE(3);return n.ARRAY_TYPE!=Float32Array&&(O[0]=0,O[1]=0,O[2]=0),O}function v(O){return Math.hypot(O[0],O[1],O[2])}function f(O,q,te){return O[0]=q[0]-te[0],O[1]=q[1]-te[1],O[2]=q[2]-te[2],O}function x(O,q,te){return O[0]=q[0]*te[0],O[1]=q[1]*te[1],O[2]=q[2]*te[2],O}function P(O,q,te){return O[0]=q[0]/te[0],O[1]=q[1]/te[1],O[2]=q[2]/te[2],O}function L(O,q){return Math.hypot(q[0]-O[0],q[1]-O[1],q[2]-O[2])}function N(O,q){var te=q[0]-O[0],ae=q[1]-O[1],ge=q[2]-O[2];return te*te+ae*ae+ge*ge}function I(O){var q=O[0],te=O[1],ae=O[2];return q*q+te*te+ae*ae}function z(O,q){return O[0]*q[0]+O[1]*q[1]+O[2]*q[2]}rt.sub=f,rt.mul=x,rt.div=P,rt.dist=L,rt.sqrDist=N,rt.len=v,rt.sqrLen=I;var F,R=(F=h(),function(O,q,te,ae,ge,_e){var he,xe;for(q||(q=3),te||(te=0),xe=ae?Math.min(ae*q+te,O.length):O.length,he=te;he<xe;he+=q)F[0]=O[he],F[1]=O[he+1],F[2]=O[he+2],ge(F,F,_e),O[he]=F[0],O[he+1]=F[1],O[he+2]=F[2];return O});return rt.forEach=R,rt}var $t,hn,gn={};function pn(){if($t)return gn;function c(R){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(O){return typeof O}:function(O){return O&&typeof Symbol=="function"&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O},c(R)}$t=1,Object.defineProperty(gn,"__esModule",{value:!0}),gn.create=h,gn.clone=function(R){var O=new n.ARRAY_TYPE(4);return O[0]=R[0],O[1]=R[1],O[2]=R[2],O[3]=R[3],O},gn.fromValues=function(R,O,q,te){var ae=new n.ARRAY_TYPE(4);return ae[0]=R,ae[1]=O,ae[2]=q,ae[3]=te,ae},gn.copy=function(R,O){return R[0]=O[0],R[1]=O[1],R[2]=O[2],R[3]=O[3],R},gn.set=function(R,O,q,te,ae){return R[0]=O,R[1]=q,R[2]=te,R[3]=ae,R},gn.add=function(R,O,q){return R[0]=O[0]+q[0],R[1]=O[1]+q[1],R[2]=O[2]+q[2],R[3]=O[3]+q[3],R},gn.subtract=v,gn.multiply=f,gn.divide=x,gn.ceil=function(R,O){return R[0]=Math.ceil(O[0]),R[1]=Math.ceil(O[1]),R[2]=Math.ceil(O[2]),R[3]=Math.ceil(O[3]),R},gn.floor=function(R,O){return R[0]=Math.floor(O[0]),R[1]=Math.floor(O[1]),R[2]=Math.floor(O[2]),R[3]=Math.floor(O[3]),R},gn.min=function(R,O,q){return R[0]=Math.min(O[0],q[0]),R[1]=Math.min(O[1],q[1]),R[2]=Math.min(O[2],q[2]),R[3]=Math.min(O[3],q[3]),R},gn.max=function(R,O,q){return R[0]=Math.max(O[0],q[0]),R[1]=Math.max(O[1],q[1]),R[2]=Math.max(O[2],q[2]),R[3]=Math.max(O[3],q[3]),R},gn.round=function(R,O){return R[0]=Math.round(O[0]),R[1]=Math.round(O[1]),R[2]=Math.round(O[2]),R[3]=Math.round(O[3]),R},gn.scale=function(R,O,q){return R[0]=O[0]*q,R[1]=O[1]*q,R[2]=O[2]*q,R[3]=O[3]*q,R},gn.scaleAndAdd=function(R,O,q,te){return R[0]=O[0]+q[0]*te,R[1]=O[1]+q[1]*te,R[2]=O[2]+q[2]*te,R[3]=O[3]+q[3]*te,R},gn.distance=P,gn.squaredDistance=L,gn.length=N,gn.squaredLength=I,gn.negate=function(R,O){return R[0]=-O[0],R[1]=-O[1],R[2]=-O[2],R[3]=-O[3],R},gn.inverse=function(R,O){return R[0]=1/O[0],R[1]=1/O[1],R[2]=1/O[2],R[3]=1/O[3],R},gn.normalize=function(R,O){var q=O[0],te=O[1],ae=O[2],ge=O[3],_e=q*q+te*te+ae*ae+ge*ge;return _e>0&&(_e=1/Math.sqrt(_e)),R[0]=q*_e,R[1]=te*_e,R[2]=ae*_e,R[3]=ge*_e,R},gn.dot=function(R,O){return R[0]*O[0]+R[1]*O[1]+R[2]*O[2]+R[3]*O[3]},gn.cross=function(R,O,q,te){var ae=q[0]*te[1]-q[1]*te[0],ge=q[0]*te[2]-q[2]*te[0],_e=q[0]*te[3]-q[3]*te[0],he=q[1]*te[2]-q[2]*te[1],xe=q[1]*te[3]-q[3]*te[1],Te=q[2]*te[3]-q[3]*te[2],Ae=O[0],tt=O[1],Ke=O[2],Ye=O[3];return R[0]=tt*Te-Ke*xe+Ye*he,R[1]=-Ae*Te+Ke*_e-Ye*ge,R[2]=Ae*xe-tt*_e+Ye*ae,R[3]=-Ae*he+tt*ge-Ke*ae,R},gn.lerp=function(R,O,q,te){var ae=O[0],ge=O[1],_e=O[2],he=O[3];return R[0]=ae+te*(q[0]-ae),R[1]=ge+te*(q[1]-ge),R[2]=_e+te*(q[2]-_e),R[3]=he+te*(q[3]-he),R},gn.random=function(R,O){var q,te,ae,ge,_e,he;O=O||1;do _e=(q=2*n.RANDOM()-1)*q+(te=2*n.RANDOM()-1)*te;while(_e>=1);do he=(ae=2*n.RANDOM()-1)*ae+(ge=2*n.RANDOM()-1)*ge;while(he>=1);var xe=Math.sqrt((1-_e)/he);return R[0]=O*q,R[1]=O*te,R[2]=O*ae*xe,R[3]=O*ge*xe,R},gn.transformMat4=function(R,O,q){var te=O[0],ae=O[1],ge=O[2],_e=O[3];return R[0]=q[0]*te+q[4]*ae+q[8]*ge+q[12]*_e,R[1]=q[1]*te+q[5]*ae+q[9]*ge+q[13]*_e,R[2]=q[2]*te+q[6]*ae+q[10]*ge+q[14]*_e,R[3]=q[3]*te+q[7]*ae+q[11]*ge+q[15]*_e,R},gn.transformQuat=function(R,O,q){var te=O[0],ae=O[1],ge=O[2],_e=q[0],he=q[1],xe=q[2],Te=q[3],Ae=Te*te+he*ge-xe*ae,tt=Te*ae+xe*te-_e*ge,Ke=Te*ge+_e*ae-he*te,Ye=-_e*te-he*ae-xe*ge;return R[0]=Ae*Te+Ye*-_e+tt*-xe-Ke*-he,R[1]=tt*Te+Ye*-he+Ke*-_e-Ae*-xe,R[2]=Ke*Te+Ye*-xe+Ae*-he-tt*-_e,R[3]=O[3],R},gn.zero=function(R){return R[0]=0,R[1]=0,R[2]=0,R[3]=0,R},gn.str=function(R){return"vec4("+R[0]+", "+R[1]+", "+R[2]+", "+R[3]+")"},gn.exactEquals=function(R,O){return R[0]===O[0]&&R[1]===O[1]&&R[2]===O[2]&&R[3]===O[3]},gn.equals=function(R,O){var q=R[0],te=R[1],ae=R[2],ge=R[3],_e=O[0],he=O[1],xe=O[2],Te=O[3];return Math.abs(q-_e)<=n.EPSILON*Math.max(1,Math.abs(q),Math.abs(_e))&&Math.abs(te-he)<=n.EPSILON*Math.max(1,Math.abs(te),Math.abs(he))&&Math.abs(ae-xe)<=n.EPSILON*Math.max(1,Math.abs(ae),Math.abs(xe))&&Math.abs(ge-Te)<=n.EPSILON*Math.max(1,Math.abs(ge),Math.abs(Te))},gn.forEach=gn.sqrLen=gn.len=gn.sqrDist=gn.dist=gn.div=gn.mul=gn.sub=void 0;var n=function(R,O){if(R&&R.__esModule)return R;if(R===null||c(R)!=="object"&&typeof R!="function")return{default:R};var q=a(void 0);if(q&&q.has(R))return q.get(R);var te={},ae=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ge in R)if(ge!=="default"&&Object.prototype.hasOwnProperty.call(R,ge)){var _e=ae?Object.getOwnPropertyDescriptor(R,ge):null;_e&&(_e.get||_e.set)?Object.defineProperty(te,ge,_e):te[ge]=R[ge]}return te.default=R,q&&q.set(R,te),te}(J());function a(R){if(typeof WeakMap!="function")return null;var O=new WeakMap,q=new WeakMap;return(a=function(te){return te?q:O})(R)}function h(){var R=new n.ARRAY_TYPE(4);return n.ARRAY_TYPE!=Float32Array&&(R[0]=0,R[1]=0,R[2]=0,R[3]=0),R}function v(R,O,q){return R[0]=O[0]-q[0],R[1]=O[1]-q[1],R[2]=O[2]-q[2],R[3]=O[3]-q[3],R}function f(R,O,q){return R[0]=O[0]*q[0],R[1]=O[1]*q[1],R[2]=O[2]*q[2],R[3]=O[3]*q[3],R}function x(R,O,q){return R[0]=O[0]/q[0],R[1]=O[1]/q[1],R[2]=O[2]/q[2],R[3]=O[3]/q[3],R}function P(R,O){return Math.hypot(O[0]-R[0],O[1]-R[1],O[2]-R[2],O[3]-R[3])}function L(R,O){var q=O[0]-R[0],te=O[1]-R[1],ae=O[2]-R[2],ge=O[3]-R[3];return q*q+te*te+ae*ae+ge*ge}function N(R){return Math.hypot(R[0],R[1],R[2],R[3])}function I(R){var O=R[0],q=R[1],te=R[2],ae=R[3];return O*O+q*q+te*te+ae*ae}gn.sub=v,gn.mul=f,gn.div=x,gn.dist=P,gn.sqrDist=L,gn.len=N,gn.sqrLen=I;var z,F=(z=h(),function(R,O,q,te,ae,ge){var _e,he;for(O||(O=4),q||(q=0),he=te?Math.min(te*O+q,R.length):R.length,_e=q;_e<he;_e+=O)z[0]=R[_e],z[1]=R[_e+1],z[2]=R[_e+2],z[3]=R[_e+3],ae(z,z,ge),R[_e]=z[0],R[_e+1]=z[1],R[_e+2]=z[2],R[_e+3]=z[3];return R});return gn.forEach=F,gn}function ri(){if(hn)return nt;function c(ct){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(It){return typeof It}:function(It){return It&&typeof Symbol=="function"&&It.constructor===Symbol&&It!==Symbol.prototype?"symbol":typeof It},c(ct)}hn=1,Object.defineProperty(nt,"__esModule",{value:!0}),nt.create=P,nt.identity=function(ct){return ct[0]=0,ct[1]=0,ct[2]=0,ct[3]=1,ct},nt.setAxisAngle=L,nt.getAxisAngle=function(ct,It){var Rt=2*Math.acos(It[3]),At=Math.sin(Rt/2);return At>n.EPSILON?(ct[0]=It[0]/At,ct[1]=It[1]/At,ct[2]=It[2]/At):(ct[0]=1,ct[1]=0,ct[2]=0),Rt},nt.getAngle=function(ct,It){var Rt=q(ct,It);return Math.acos(2*Rt*Rt-1)},nt.multiply=N,nt.rotateX=function(ct,It,Rt){Rt*=.5;var At=It[0],Vt=It[1],Wt=It[2],Kt=It[3],qt=Math.sin(Rt),yn=Math.cos(Rt);return ct[0]=At*yn+Kt*qt,ct[1]=Vt*yn+Wt*qt,ct[2]=Wt*yn-Vt*qt,ct[3]=Kt*yn-At*qt,ct},nt.rotateY=function(ct,It,Rt){Rt*=.5;var At=It[0],Vt=It[1],Wt=It[2],Kt=It[3],qt=Math.sin(Rt),yn=Math.cos(Rt);return ct[0]=At*yn-Wt*qt,ct[1]=Vt*yn+Kt*qt,ct[2]=Wt*yn+At*qt,ct[3]=Kt*yn-Vt*qt,ct},nt.rotateZ=function(ct,It,Rt){Rt*=.5;var At=It[0],Vt=It[1],Wt=It[2],Kt=It[3],qt=Math.sin(Rt),yn=Math.cos(Rt);return ct[0]=At*yn+Vt*qt,ct[1]=Vt*yn-At*qt,ct[2]=Wt*yn+Kt*qt,ct[3]=Kt*yn-Wt*qt,ct},nt.calculateW=function(ct,It){var Rt=It[0],At=It[1],Vt=It[2];return ct[0]=Rt,ct[1]=At,ct[2]=Vt,ct[3]=Math.sqrt(Math.abs(1-Rt*Rt-At*At-Vt*Vt)),ct},nt.exp=I,nt.ln=z,nt.pow=function(ct,It,Rt){return z(ct,It),O(ct,ct,Rt),I(ct,ct),ct},nt.slerp=F,nt.random=function(ct){var It=n.RANDOM(),Rt=n.RANDOM(),At=n.RANDOM(),Vt=Math.sqrt(1-It),Wt=Math.sqrt(It);return ct[0]=Vt*Math.sin(2*Math.PI*Rt),ct[1]=Vt*Math.cos(2*Math.PI*Rt),ct[2]=Wt*Math.sin(2*Math.PI*At),ct[3]=Wt*Math.cos(2*Math.PI*At),ct},nt.invert=function(ct,It){var Rt=It[0],At=It[1],Vt=It[2],Wt=It[3],Kt=Rt*Rt+At*At+Vt*Vt+Wt*Wt,qt=Kt?1/Kt:0;return ct[0]=-Rt*qt,ct[1]=-At*qt,ct[2]=-Vt*qt,ct[3]=Wt*qt,ct},nt.conjugate=function(ct,It){return ct[0]=-It[0],ct[1]=-It[1],ct[2]=-It[2],ct[3]=It[3],ct},nt.fromMat3=R,nt.fromEuler=function(ct,It,Rt,At){var Vt=.5*Math.PI/180;It*=Vt,Rt*=Vt,At*=Vt;var Wt=Math.sin(It),Kt=Math.cos(It),qt=Math.sin(Rt),yn=Math.cos(Rt),Yn=Math.sin(At),xn=Math.cos(At);return ct[0]=Wt*yn*xn-Kt*qt*Yn,ct[1]=Kt*qt*xn+Wt*yn*Yn,ct[2]=Kt*yn*Yn-Wt*qt*xn,ct[3]=Kt*yn*xn+Wt*qt*Yn,ct},nt.str=function(ct){return"quat("+ct[0]+", "+ct[1]+", "+ct[2]+", "+ct[3]+")"},nt.setAxes=nt.sqlerp=nt.rotationTo=nt.equals=nt.exactEquals=nt.normalize=nt.sqrLen=nt.squaredLength=nt.len=nt.length=nt.lerp=nt.dot=nt.scale=nt.mul=nt.add=nt.set=nt.copy=nt.fromValues=nt.clone=void 0;var n=x(J()),a=x(Oe()),h=x(ft()),v=x(pn());function f(ct){if(typeof WeakMap!="function")return null;var It=new WeakMap,Rt=new WeakMap;return(f=function(At){return At?Rt:It})(ct)}function x(ct,It){if(ct&&ct.__esModule)return ct;if(ct===null||c(ct)!=="object"&&typeof ct!="function")return{default:ct};var Rt=f(It);if(Rt&&Rt.has(ct))return Rt.get(ct);var At={},Vt=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Wt in ct)if(Wt!=="default"&&Object.prototype.hasOwnProperty.call(ct,Wt)){var Kt=Vt?Object.getOwnPropertyDescriptor(ct,Wt):null;Kt&&(Kt.get||Kt.set)?Object.defineProperty(At,Wt,Kt):At[Wt]=ct[Wt]}return At.default=ct,Rt&&Rt.set(ct,At),At}function P(){var ct=new n.ARRAY_TYPE(4);return n.ARRAY_TYPE!=Float32Array&&(ct[0]=0,ct[1]=0,ct[2]=0),ct[3]=1,ct}function L(ct,It,Rt){Rt*=.5;var At=Math.sin(Rt);return ct[0]=At*It[0],ct[1]=At*It[1],ct[2]=At*It[2],ct[3]=Math.cos(Rt),ct}function N(ct,It,Rt){var At=It[0],Vt=It[1],Wt=It[2],Kt=It[3],qt=Rt[0],yn=Rt[1],Yn=Rt[2],xn=Rt[3];return ct[0]=At*xn+Kt*qt+Vt*Yn-Wt*yn,ct[1]=Vt*xn+Kt*yn+Wt*qt-At*Yn,ct[2]=Wt*xn+Kt*Yn+At*yn-Vt*qt,ct[3]=Kt*xn-At*qt-Vt*yn-Wt*Yn,ct}function I(ct,It){var Rt=It[0],At=It[1],Vt=It[2],Wt=It[3],Kt=Math.sqrt(Rt*Rt+At*At+Vt*Vt),qt=Math.exp(Wt),yn=Kt>0?qt*Math.sin(Kt)/Kt:0;return ct[0]=Rt*yn,ct[1]=At*yn,ct[2]=Vt*yn,ct[3]=qt*Math.cos(Kt),ct}function z(ct,It){var Rt=It[0],At=It[1],Vt=It[2],Wt=It[3],Kt=Math.sqrt(Rt*Rt+At*At+Vt*Vt),qt=Kt>0?Math.atan2(Kt,Wt)/Kt:0;return ct[0]=Rt*qt,ct[1]=At*qt,ct[2]=Vt*qt,ct[3]=.5*Math.log(Rt*Rt+At*At+Vt*Vt+Wt*Wt),ct}function F(ct,It,Rt,At){var Vt,Wt,Kt,qt,yn,Yn=It[0],xn=It[1],di=It[2],ci=It[3],Ti=Rt[0],In=Rt[1],ji=Rt[2],gi=Rt[3];return(Wt=Yn*Ti+xn*In+di*ji+ci*gi)<0&&(Wt=-Wt,Ti=-Ti,In=-In,ji=-ji,gi=-gi),1-Wt>n.EPSILON?(Vt=Math.acos(Wt),Kt=Math.sin(Vt),qt=Math.sin((1-At)*Vt)/Kt,yn=Math.sin(At*Vt)/Kt):(qt=1-At,yn=At),ct[0]=qt*Yn+yn*Ti,ct[1]=qt*xn+yn*In,ct[2]=qt*di+yn*ji,ct[3]=qt*ci+yn*gi,ct}function R(ct,It){var Rt,At=It[0]+It[4]+It[8];if(At>0)Rt=Math.sqrt(At+1),ct[3]=.5*Rt,ct[0]=(It[5]-It[7])*(Rt=.5/Rt),ct[1]=(It[6]-It[2])*Rt,ct[2]=(It[1]-It[3])*Rt;else{var Vt=0;It[4]>It[0]&&(Vt=1),It[8]>It[3*Vt+Vt]&&(Vt=2);var Wt=(Vt+1)%3,Kt=(Vt+2)%3;Rt=Math.sqrt(It[3*Vt+Vt]-It[3*Wt+Wt]-It[3*Kt+Kt]+1),ct[Vt]=.5*Rt,ct[3]=(It[3*Wt+Kt]-It[3*Kt+Wt])*(Rt=.5/Rt),ct[Wt]=(It[3*Wt+Vt]+It[3*Vt+Wt])*Rt,ct[Kt]=(It[3*Kt+Vt]+It[3*Vt+Kt])*Rt}return ct}nt.clone=v.clone,nt.fromValues=v.fromValues,nt.copy=v.copy,nt.set=v.set,nt.add=v.add,nt.mul=N;var O=v.scale;nt.scale=O;var q=v.dot;nt.dot=q,nt.lerp=v.lerp;var te=v.length;nt.length=te,nt.len=te;var ae=v.squaredLength;nt.squaredLength=ae,nt.sqrLen=ae;var ge=v.normalize;nt.normalize=ge,nt.exactEquals=v.exactEquals,nt.equals=v.equals;var _e,he,xe,Te=(_e=h.create(),he=h.fromValues(1,0,0),xe=h.fromValues(0,1,0),function(ct,It,Rt){var At=h.dot(It,Rt);return At<-.999999?(h.cross(_e,he,It),h.len(_e)<1e-6&&h.cross(_e,xe,It),h.normalize(_e,_e),L(ct,_e,Math.PI),ct):At>.999999?(ct[0]=0,ct[1]=0,ct[2]=0,ct[3]=1,ct):(h.cross(_e,It,Rt),ct[0]=_e[0],ct[1]=_e[1],ct[2]=_e[2],ct[3]=1+At,ge(ct,ct))});nt.rotationTo=Te;var Ae,tt,Ke=(Ae=P(),tt=P(),function(ct,It,Rt,At,Vt,Wt){return F(Ae,It,Vt,Wt),F(tt,Rt,At,Wt),F(ct,Ae,tt,2*Wt*(1-Wt)),ct});nt.sqlerp=Ke;var Ye,Ct=(Ye=a.create(),function(ct,It,Rt,At){return Ye[0]=Rt[0],Ye[3]=Rt[1],Ye[6]=Rt[2],Ye[1]=At[0],Ye[4]=At[1],Ye[7]=At[2],Ye[2]=-It[0],Ye[5]=-It[1],Ye[8]=-It[2],ge(ct,R(ct,Ye))});return nt.setAxes=Ct,nt}var ai,_n={};function Bn(){if(ai)return _n;function c(F){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(R){return typeof R}:function(R){return R&&typeof Symbol=="function"&&R.constructor===Symbol&&R!==Symbol.prototype?"symbol":typeof R},c(F)}ai=1,Object.defineProperty(_n,"__esModule",{value:!0}),_n.create=function(){var F=new n.ARRAY_TYPE(8);return n.ARRAY_TYPE!=Float32Array&&(F[0]=0,F[1]=0,F[2]=0,F[4]=0,F[5]=0,F[6]=0,F[7]=0),F[3]=1,F},_n.clone=function(F){var R=new n.ARRAY_TYPE(8);return R[0]=F[0],R[1]=F[1],R[2]=F[2],R[3]=F[3],R[4]=F[4],R[5]=F[5],R[6]=F[6],R[7]=F[7],R},_n.fromValues=function(F,R,O,q,te,ae,ge,_e){var he=new n.ARRAY_TYPE(8);return he[0]=F,he[1]=R,he[2]=O,he[3]=q,he[4]=te,he[5]=ae,he[6]=ge,he[7]=_e,he},_n.fromRotationTranslationValues=function(F,R,O,q,te,ae,ge){var _e=new n.ARRAY_TYPE(8);_e[0]=F,_e[1]=R,_e[2]=O,_e[3]=q;var he=.5*te,xe=.5*ae,Te=.5*ge;return _e[4]=he*q+xe*O-Te*R,_e[5]=xe*q+Te*F-he*O,_e[6]=Te*q+he*R-xe*F,_e[7]=-he*F-xe*R-Te*O,_e},_n.fromRotationTranslation=x,_n.fromTranslation=function(F,R){return F[0]=0,F[1]=0,F[2]=0,F[3]=1,F[4]=.5*R[0],F[5]=.5*R[1],F[6]=.5*R[2],F[7]=0,F},_n.fromRotation=function(F,R){return F[0]=R[0],F[1]=R[1],F[2]=R[2],F[3]=R[3],F[4]=0,F[5]=0,F[6]=0,F[7]=0,F},_n.fromMat4=function(F,R){var O=a.create();h.getRotation(O,R);var q=new n.ARRAY_TYPE(3);return h.getTranslation(q,R),x(F,O,q),F},_n.copy=P,_n.identity=function(F){return F[0]=0,F[1]=0,F[2]=0,F[3]=1,F[4]=0,F[5]=0,F[6]=0,F[7]=0,F},_n.set=function(F,R,O,q,te,ae,ge,_e,he){return F[0]=R,F[1]=O,F[2]=q,F[3]=te,F[4]=ae,F[5]=ge,F[6]=_e,F[7]=he,F},_n.getDual=function(F,R){return F[0]=R[4],F[1]=R[5],F[2]=R[6],F[3]=R[7],F},_n.setDual=function(F,R){return F[4]=R[0],F[5]=R[1],F[6]=R[2],F[7]=R[3],F},_n.getTranslation=function(F,R){var O=R[4],q=R[5],te=R[6],ae=R[7],ge=-R[0],_e=-R[1],he=-R[2],xe=R[3];return F[0]=2*(O*xe+ae*ge+q*he-te*_e),F[1]=2*(q*xe+ae*_e+te*ge-O*he),F[2]=2*(te*xe+ae*he+O*_e-q*ge),F},_n.translate=function(F,R,O){var q=R[0],te=R[1],ae=R[2],ge=R[3],_e=.5*O[0],he=.5*O[1],xe=.5*O[2],Te=R[4],Ae=R[5],tt=R[6],Ke=R[7];return F[0]=q,F[1]=te,F[2]=ae,F[3]=ge,F[4]=ge*_e+te*xe-ae*he+Te,F[5]=ge*he+ae*_e-q*xe+Ae,F[6]=ge*xe+q*he-te*_e+tt,F[7]=-q*_e-te*he-ae*xe+Ke,F},_n.rotateX=function(F,R,O){var q=-R[0],te=-R[1],ae=-R[2],ge=R[3],_e=R[4],he=R[5],xe=R[6],Te=R[7],Ae=_e*ge+Te*q+he*ae-xe*te,tt=he*ge+Te*te+xe*q-_e*ae,Ke=xe*ge+Te*ae+_e*te-he*q,Ye=Te*ge-_e*q-he*te-xe*ae;return a.rotateX(F,R,O),F[4]=Ae*(ge=F[3])+Ye*(q=F[0])+tt*(ae=F[2])-Ke*(te=F[1]),F[5]=tt*ge+Ye*te+Ke*q-Ae*ae,F[6]=Ke*ge+Ye*ae+Ae*te-tt*q,F[7]=Ye*ge-Ae*q-tt*te-Ke*ae,F},_n.rotateY=function(F,R,O){var q=-R[0],te=-R[1],ae=-R[2],ge=R[3],_e=R[4],he=R[5],xe=R[6],Te=R[7],Ae=_e*ge+Te*q+he*ae-xe*te,tt=he*ge+Te*te+xe*q-_e*ae,Ke=xe*ge+Te*ae+_e*te-he*q,Ye=Te*ge-_e*q-he*te-xe*ae;return a.rotateY(F,R,O),F[4]=Ae*(ge=F[3])+Ye*(q=F[0])+tt*(ae=F[2])-Ke*(te=F[1]),F[5]=tt*ge+Ye*te+Ke*q-Ae*ae,F[6]=Ke*ge+Ye*ae+Ae*te-tt*q,F[7]=Ye*ge-Ae*q-tt*te-Ke*ae,F},_n.rotateZ=function(F,R,O){var q=-R[0],te=-R[1],ae=-R[2],ge=R[3],_e=R[4],he=R[5],xe=R[6],Te=R[7],Ae=_e*ge+Te*q+he*ae-xe*te,tt=he*ge+Te*te+xe*q-_e*ae,Ke=xe*ge+Te*ae+_e*te-he*q,Ye=Te*ge-_e*q-he*te-xe*ae;return a.rotateZ(F,R,O),F[4]=Ae*(ge=F[3])+Ye*(q=F[0])+tt*(ae=F[2])-Ke*(te=F[1]),F[5]=tt*ge+Ye*te+Ke*q-Ae*ae,F[6]=Ke*ge+Ye*ae+Ae*te-tt*q,F[7]=Ye*ge-Ae*q-tt*te-Ke*ae,F},_n.rotateByQuatAppend=function(F,R,O){var q=O[0],te=O[1],ae=O[2],ge=O[3],_e=R[0],he=R[1],xe=R[2],Te=R[3];return F[0]=_e*ge+Te*q+he*ae-xe*te,F[1]=he*ge+Te*te+xe*q-_e*ae,F[2]=xe*ge+Te*ae+_e*te-he*q,F[3]=Te*ge-_e*q-he*te-xe*ae,F[4]=(_e=R[4])*ge+(Te=R[7])*q+(he=R[5])*ae-(xe=R[6])*te,F[5]=he*ge+Te*te+xe*q-_e*ae,F[6]=xe*ge+Te*ae+_e*te-he*q,F[7]=Te*ge-_e*q-he*te-xe*ae,F},_n.rotateByQuatPrepend=function(F,R,O){var q=R[0],te=R[1],ae=R[2],ge=R[3],_e=O[0],he=O[1],xe=O[2],Te=O[3];return F[0]=q*Te+ge*_e+te*xe-ae*he,F[1]=te*Te+ge*he+ae*_e-q*xe,F[2]=ae*Te+ge*xe+q*he-te*_e,F[3]=ge*Te-q*_e-te*he-ae*xe,F[4]=q*(Te=O[7])+ge*(_e=O[4])+te*(xe=O[6])-ae*(he=O[5]),F[5]=te*Te+ge*he+ae*_e-q*xe,F[6]=ae*Te+ge*xe+q*he-te*_e,F[7]=ge*Te-q*_e-te*he-ae*xe,F},_n.rotateAroundAxis=function(F,R,O,q){if(Math.abs(q)<n.EPSILON)return P(F,R);var te=Math.hypot(O[0],O[1],O[2]);q*=.5;var ae=Math.sin(q),ge=ae*O[0]/te,_e=ae*O[1]/te,he=ae*O[2]/te,xe=Math.cos(q),Te=R[0],Ae=R[1],tt=R[2],Ke=R[3];F[0]=Te*xe+Ke*ge+Ae*he-tt*_e,F[1]=Ae*xe+Ke*_e+tt*ge-Te*he,F[2]=tt*xe+Ke*he+Te*_e-Ae*ge,F[3]=Ke*xe-Te*ge-Ae*_e-tt*he;var Ye=R[4],Ct=R[5],ct=R[6],It=R[7];return F[4]=Ye*xe+It*ge+Ct*he-ct*_e,F[5]=Ct*xe+It*_e+ct*ge-Ye*he,F[6]=ct*xe+It*he+Ye*_e-Ct*ge,F[7]=It*xe-Ye*ge-Ct*_e-ct*he,F},_n.add=function(F,R,O){return F[0]=R[0]+O[0],F[1]=R[1]+O[1],F[2]=R[2]+O[2],F[3]=R[3]+O[3],F[4]=R[4]+O[4],F[5]=R[5]+O[5],F[6]=R[6]+O[6],F[7]=R[7]+O[7],F},_n.multiply=L,_n.scale=function(F,R,O){return F[0]=R[0]*O,F[1]=R[1]*O,F[2]=R[2]*O,F[3]=R[3]*O,F[4]=R[4]*O,F[5]=R[5]*O,F[6]=R[6]*O,F[7]=R[7]*O,F},_n.lerp=function(F,R,O,q){var te=1-q;return N(R,O)<0&&(q=-q),F[0]=R[0]*te+O[0]*q,F[1]=R[1]*te+O[1]*q,F[2]=R[2]*te+O[2]*q,F[3]=R[3]*te+O[3]*q,F[4]=R[4]*te+O[4]*q,F[5]=R[5]*te+O[5]*q,F[6]=R[6]*te+O[6]*q,F[7]=R[7]*te+O[7]*q,F},_n.invert=function(F,R){var O=z(R);return F[0]=-R[0]/O,F[1]=-R[1]/O,F[2]=-R[2]/O,F[3]=R[3]/O,F[4]=-R[4]/O,F[5]=-R[5]/O,F[6]=-R[6]/O,F[7]=R[7]/O,F},_n.conjugate=function(F,R){return F[0]=-R[0],F[1]=-R[1],F[2]=-R[2],F[3]=R[3],F[4]=-R[4],F[5]=-R[5],F[6]=-R[6],F[7]=R[7],F},_n.normalize=function(F,R){var O=z(R);if(O>0){O=Math.sqrt(O);var q=R[0]/O,te=R[1]/O,ae=R[2]/O,ge=R[3]/O,_e=R[4],he=R[5],xe=R[6],Te=R[7],Ae=q*_e+te*he+ae*xe+ge*Te;F[0]=q,F[1]=te,F[2]=ae,F[3]=ge,F[4]=(_e-q*Ae)/O,F[5]=(he-te*Ae)/O,F[6]=(xe-ae*Ae)/O,F[7]=(Te-ge*Ae)/O}return F},_n.str=function(F){return"quat2("+F[0]+", "+F[1]+", "+F[2]+", "+F[3]+", "+F[4]+", "+F[5]+", "+F[6]+", "+F[7]+")"},_n.exactEquals=function(F,R){return F[0]===R[0]&&F[1]===R[1]&&F[2]===R[2]&&F[3]===R[3]&&F[4]===R[4]&&F[5]===R[5]&&F[6]===R[6]&&F[7]===R[7]},_n.equals=function(F,R){var O=F[0],q=F[1],te=F[2],ae=F[3],ge=F[4],_e=F[5],he=F[6],xe=F[7],Te=R[0],Ae=R[1],tt=R[2],Ke=R[3],Ye=R[4],Ct=R[5],ct=R[6],It=R[7];return Math.abs(O-Te)<=n.EPSILON*Math.max(1,Math.abs(O),Math.abs(Te))&&Math.abs(q-Ae)<=n.EPSILON*Math.max(1,Math.abs(q),Math.abs(Ae))&&Math.abs(te-tt)<=n.EPSILON*Math.max(1,Math.abs(te),Math.abs(tt))&&Math.abs(ae-Ke)<=n.EPSILON*Math.max(1,Math.abs(ae),Math.abs(Ke))&&Math.abs(ge-Ye)<=n.EPSILON*Math.max(1,Math.abs(ge),Math.abs(Ye))&&Math.abs(_e-Ct)<=n.EPSILON*Math.max(1,Math.abs(_e),Math.abs(Ct))&&Math.abs(he-ct)<=n.EPSILON*Math.max(1,Math.abs(he),Math.abs(ct))&&Math.abs(xe-It)<=n.EPSILON*Math.max(1,Math.abs(xe),Math.abs(It))},_n.sqrLen=_n.squaredLength=_n.len=_n.length=_n.dot=_n.mul=_n.setReal=_n.getReal=void 0;var n=f(J()),a=f(ri()),h=f(qe());function v(F){if(typeof WeakMap!="function")return null;var R=new WeakMap,O=new WeakMap;return(v=function(q){return q?O:R})(F)}function f(F,R){if(F&&F.__esModule)return F;if(F===null||c(F)!=="object"&&typeof F!="function")return{default:F};var O=v(R);if(O&&O.has(F))return O.get(F);var q={},te=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ae in F)if(ae!=="default"&&Object.prototype.hasOwnProperty.call(F,ae)){var ge=te?Object.getOwnPropertyDescriptor(F,ae):null;ge&&(ge.get||ge.set)?Object.defineProperty(q,ae,ge):q[ae]=F[ae]}return q.default=F,O&&O.set(F,q),q}function x(F,R,O){var q=.5*O[0],te=.5*O[1],ae=.5*O[2],ge=R[0],_e=R[1],he=R[2],xe=R[3];return F[0]=ge,F[1]=_e,F[2]=he,F[3]=xe,F[4]=q*xe+te*he-ae*_e,F[5]=te*xe+ae*ge-q*he,F[6]=ae*xe+q*_e-te*ge,F[7]=-q*ge-te*_e-ae*he,F}function P(F,R){return F[0]=R[0],F[1]=R[1],F[2]=R[2],F[3]=R[3],F[4]=R[4],F[5]=R[5],F[6]=R[6],F[7]=R[7],F}function L(F,R,O){var q=R[0],te=R[1],ae=R[2],ge=R[3],_e=O[4],he=O[5],xe=O[6],Te=O[7],Ae=R[4],tt=R[5],Ke=R[6],Ye=R[7],Ct=O[0],ct=O[1],It=O[2],Rt=O[3];return F[0]=q*Rt+ge*Ct+te*It-ae*ct,F[1]=te*Rt+ge*ct+ae*Ct-q*It,F[2]=ae*Rt+ge*It+q*ct-te*Ct,F[3]=ge*Rt-q*Ct-te*ct-ae*It,F[4]=q*Te+ge*_e+te*xe-ae*he+Ae*Rt+Ye*Ct+tt*It-Ke*ct,F[5]=te*Te+ge*he+ae*_e-q*xe+tt*Rt+Ye*ct+Ke*Ct-Ae*It,F[6]=ae*Te+ge*xe+q*he-te*_e+Ke*Rt+Ye*It+Ae*ct-tt*Ct,F[7]=ge*Te-q*_e-te*he-ae*xe+Ye*Rt-Ae*Ct-tt*ct-Ke*It,F}_n.getReal=a.copy,_n.setReal=a.copy,_n.mul=L;var N=a.dot;_n.dot=N;var I=a.length;_n.length=I,_n.len=I;var z=a.squaredLength;return _n.squaredLength=z,_n.sqrLen=z,_n}var mn,Nn,Pn={};function Ci(){if(mn)return Pn;function c(R){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(O){return typeof O}:function(O){return O&&typeof Symbol=="function"&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O},c(R)}mn=1,Object.defineProperty(Pn,"__esModule",{value:!0}),Pn.create=h,Pn.clone=function(R){var O=new n.ARRAY_TYPE(2);return O[0]=R[0],O[1]=R[1],O},Pn.fromValues=function(R,O){var q=new n.ARRAY_TYPE(2);return q[0]=R,q[1]=O,q},Pn.copy=function(R,O){return R[0]=O[0],R[1]=O[1],R},Pn.set=function(R,O,q){return R[0]=O,R[1]=q,R},Pn.add=function(R,O,q){return R[0]=O[0]+q[0],R[1]=O[1]+q[1],R},Pn.subtract=v,Pn.multiply=f,Pn.divide=x,Pn.ceil=function(R,O){return R[0]=Math.ceil(O[0]),R[1]=Math.ceil(O[1]),R},Pn.floor=function(R,O){return R[0]=Math.floor(O[0]),R[1]=Math.floor(O[1]),R},Pn.min=function(R,O,q){return R[0]=Math.min(O[0],q[0]),R[1]=Math.min(O[1],q[1]),R},Pn.max=function(R,O,q){return R[0]=Math.max(O[0],q[0]),R[1]=Math.max(O[1],q[1]),R},Pn.round=function(R,O){return R[0]=Math.round(O[0]),R[1]=Math.round(O[1]),R},Pn.scale=function(R,O,q){return R[0]=O[0]*q,R[1]=O[1]*q,R},Pn.scaleAndAdd=function(R,O,q,te){return R[0]=O[0]+q[0]*te,R[1]=O[1]+q[1]*te,R},Pn.distance=P,Pn.squaredDistance=L,Pn.length=N,Pn.squaredLength=I,Pn.negate=function(R,O){return R[0]=-O[0],R[1]=-O[1],R},Pn.inverse=function(R,O){return R[0]=1/O[0],R[1]=1/O[1],R},Pn.normalize=function(R,O){var q=O[0],te=O[1],ae=q*q+te*te;return ae>0&&(ae=1/Math.sqrt(ae)),R[0]=O[0]*ae,R[1]=O[1]*ae,R},Pn.dot=function(R,O){return R[0]*O[0]+R[1]*O[1]},Pn.cross=function(R,O,q){var te=O[0]*q[1]-O[1]*q[0];return R[0]=R[1]=0,R[2]=te,R},Pn.lerp=function(R,O,q,te){var ae=O[0],ge=O[1];return R[0]=ae+te*(q[0]-ae),R[1]=ge+te*(q[1]-ge),R},Pn.random=function(R,O){O=O||1;var q=2*n.RANDOM()*Math.PI;return R[0]=Math.cos(q)*O,R[1]=Math.sin(q)*O,R},Pn.transformMat2=function(R,O,q){var te=O[0],ae=O[1];return R[0]=q[0]*te+q[2]*ae,R[1]=q[1]*te+q[3]*ae,R},Pn.transformMat2d=function(R,O,q){var te=O[0],ae=O[1];return R[0]=q[0]*te+q[2]*ae+q[4],R[1]=q[1]*te+q[3]*ae+q[5],R},Pn.transformMat3=function(R,O,q){var te=O[0],ae=O[1];return R[0]=q[0]*te+q[3]*ae+q[6],R[1]=q[1]*te+q[4]*ae+q[7],R},Pn.transformMat4=function(R,O,q){var te=O[0],ae=O[1];return R[0]=q[0]*te+q[4]*ae+q[12],R[1]=q[1]*te+q[5]*ae+q[13],R},Pn.rotate=function(R,O,q,te){var ae=O[0]-q[0],ge=O[1]-q[1],_e=Math.sin(te),he=Math.cos(te);return R[0]=ae*he-ge*_e+q[0],R[1]=ae*_e+ge*he+q[1],R},Pn.angle=function(R,O){var q=R[0],te=R[1],ae=O[0],ge=O[1],_e=Math.sqrt(q*q+te*te)*Math.sqrt(ae*ae+ge*ge);return Math.acos(Math.min(Math.max(_e&&(q*ae+te*ge)/_e,-1),1))},Pn.zero=function(R){return R[0]=0,R[1]=0,R},Pn.str=function(R){return"vec2("+R[0]+", "+R[1]+")"},Pn.exactEquals=function(R,O){return R[0]===O[0]&&R[1]===O[1]},Pn.equals=function(R,O){var q=R[0],te=R[1],ae=O[0],ge=O[1];return Math.abs(q-ae)<=n.EPSILON*Math.max(1,Math.abs(q),Math.abs(ae))&&Math.abs(te-ge)<=n.EPSILON*Math.max(1,Math.abs(te),Math.abs(ge))},Pn.forEach=Pn.sqrLen=Pn.sqrDist=Pn.dist=Pn.div=Pn.mul=Pn.sub=Pn.len=void 0;var n=function(R,O){if(R&&R.__esModule)return R;if(R===null||c(R)!=="object"&&typeof R!="function")return{default:R};var q=a(void 0);if(q&&q.has(R))return q.get(R);var te={},ae=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ge in R)if(ge!=="default"&&Object.prototype.hasOwnProperty.call(R,ge)){var _e=ae?Object.getOwnPropertyDescriptor(R,ge):null;_e&&(_e.get||_e.set)?Object.defineProperty(te,ge,_e):te[ge]=R[ge]}return te.default=R,q&&q.set(R,te),te}(J());function a(R){if(typeof WeakMap!="function")return null;var O=new WeakMap,q=new WeakMap;return(a=function(te){return te?q:O})(R)}function h(){var R=new n.ARRAY_TYPE(2);return n.ARRAY_TYPE!=Float32Array&&(R[0]=0,R[1]=0),R}function v(R,O,q){return R[0]=O[0]-q[0],R[1]=O[1]-q[1],R}function f(R,O,q){return R[0]=O[0]*q[0],R[1]=O[1]*q[1],R}function x(R,O,q){return R[0]=O[0]/q[0],R[1]=O[1]/q[1],R}function P(R,O){return Math.hypot(O[0]-R[0],O[1]-R[1])}function L(R,O){var q=O[0]-R[0],te=O[1]-R[1];return q*q+te*te}function N(R){return Math.hypot(R[0],R[1])}function I(R){var O=R[0],q=R[1];return O*O+q*q}Pn.len=N,Pn.sub=v,Pn.mul=f,Pn.div=x,Pn.dist=P,Pn.sqrDist=L,Pn.sqrLen=I;var z,F=(z=h(),function(R,O,q,te,ae,ge){var _e,he;for(O||(O=2),q||(q=0),he=te?Math.min(te*O+q,R.length):R.length,_e=q;_e<he;_e+=O)z[0]=R[_e],z[1]=R[_e+1],ae(z,z,ge),R[_e]=z[0],R[_e+1]=z[1];return R});return Pn.forEach=F,Pn}function Fi(){if(Nn)return Y;function c(R){return c=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(O){return typeof O}:function(O){return O&&typeof Symbol=="function"&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":typeof O},c(R)}Nn=1,Object.defineProperty(Y,"__esModule",{value:!0}),Y.vec4=Y.vec3=Y.vec2=Y.quat2=Y.quat=Y.mat4=Y.mat3=Y.mat2d=Y.mat2=Y.glMatrix=void 0;var n=F(J());Y.glMatrix=n;var a=F(ie());Y.mat2=a;var h=F(Ie());Y.mat2d=h;var v=F(Oe());Y.mat3=v;var f=F(qe());Y.mat4=f;var x=F(ri());Y.quat=x;var P=F(Bn());Y.quat2=P;var L=F(Ci());Y.vec2=L;var N=F(ft());Y.vec3=N;var I=F(pn());function z(R){if(typeof WeakMap!="function")return null;var O=new WeakMap,q=new WeakMap;return(z=function(te){return te?q:O})(R)}function F(R,O){if(R&&R.__esModule)return R;if(R===null||c(R)!=="object"&&typeof R!="function")return{default:R};var q=z(O);if(q&&q.has(R))return q.get(R);var te={},ae=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ge in R)if(ge!=="default"&&Object.prototype.hasOwnProperty.call(R,ge)){var _e=ae?Object.getOwnPropertyDescriptor(R,ge):null;_e&&(_e.get||_e.set)?Object.defineProperty(te,ge,_e):te[ge]=R[ge]}return te.default=R,q&&q.set(R,te),te}return Y.vec4=I,Y}var Ln,sn,qn,pi,ht=Fi(),Zn=function(){if(sn)return Ln;function c(n,a,h,v){this.cx=3*n,this.bx=3*(h-n)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(v-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=n,this.p1y=a,this.p2x=h,this.p2y=v}return sn=1,Ln=c,c.prototype={sampleCurveX:function(n){return((this.ax*n+this.bx)*n+this.cx)*n},sampleCurveY:function(n){return((this.ay*n+this.by)*n+this.cy)*n},sampleCurveDerivativeX:function(n){return(3*this.ax*n+2*this.bx)*n+this.cx},solveCurveX:function(n,a){if(a===void 0&&(a=1e-6),n<0)return 0;if(n>1)return 1;for(var h=n,v=0;v<8;v++){var f=this.sampleCurveX(h)-n;if(Math.abs(f)<a)return h;var x=this.sampleCurveDerivativeX(h);if(Math.abs(x)<1e-6)break;h-=f/x}var P=0,L=1;for(h=n,v=0;v<20&&(f=this.sampleCurveX(h),!(Math.abs(f-n)<a));v++)n>f?P=h:L=h,h=.5*(L-P)+P;return h},solve:function(n,a){return this.sampleCurveY(this.solveCurveX(n,a))}},Ln}(),St=G(Zn);function mt(){if(pi)return qn;function c(n,a){this.x=n,this.y=a}return pi=1,qn=c,c.prototype={clone:function(){return new c(this.x,this.y)},add:function(n){return this.clone()._add(n)},sub:function(n){return this.clone()._sub(n)},multByPoint:function(n){return this.clone()._multByPoint(n)},divByPoint:function(n){return this.clone()._divByPoint(n)},mult:function(n){return this.clone()._mult(n)},div:function(n){return this.clone()._div(n)},rotate:function(n){return this.clone()._rotate(n)},rotateAround:function(n,a){return this.clone()._rotateAround(n,a)},matMult:function(n){return this.clone()._matMult(n)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(n){return this.x===n.x&&this.y===n.y},dist:function(n){return Math.sqrt(this.distSqr(n))},distSqr:function(n){var a=n.x-this.x,h=n.y-this.y;return a*a+h*h},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(n){return Math.atan2(this.y-n.y,this.x-n.x)},angleWith:function(n){return this.angleWithSep(n.x,n.y)},angleWithSep:function(n,a){return Math.atan2(this.x*a-this.y*n,this.x*n+this.y*a)},_matMult:function(n){var a=n[2]*this.x+n[3]*this.y;return this.x=n[0]*this.x+n[1]*this.y,this.y=a,this},_add:function(n){return this.x+=n.x,this.y+=n.y,this},_sub:function(n){return this.x-=n.x,this.y-=n.y,this},_mult:function(n){return this.x*=n,this.y*=n,this},_div:function(n){return this.x/=n,this.y/=n,this},_multByPoint:function(n){return this.x*=n.x,this.y*=n.y,this},_divByPoint:function(n){return this.x/=n.x,this.y/=n.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var n=this.y;return this.y=this.x,this.x=-n,this},_rotate:function(n){var a=Math.cos(n),h=Math.sin(n),v=h*this.x+a*this.y;return this.x=a*this.x-h*this.y,this.y=v,this},_rotateAround:function(n,a){var h=Math.cos(n),v=Math.sin(n),f=a.y+v*(this.x-a.x)+h*(this.y-a.y);return this.x=a.x+h*(this.x-a.x)-v*(this.y-a.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},c.convert=function(n){return n instanceof c?n:Array.isArray(n)?new c(n[0],n[1]):n},qn}var at=G(mt());function Tn(c,n){if(Array.isArray(c)){if(!Array.isArray(n)||c.length!==n.length)return!1;for(let a=0;a<c.length;a++)if(!Tn(c[a],n[a]))return!1;return!0}if(typeof c=="object"&&c!==null&&n!==null){if(typeof n!="object"||Object.keys(c).length!==Object.keys(n).length)return!1;for(const a in c)if(!Tn(c[a],n[a]))return!1;return!0}return c===n}const bn=Math.PI/180,Cn=180/Math.PI;function zn(c){return c*bn}function vi(c){return c*Cn}const ii=[[0,0],[1,0],[1,1],[0,1]];function wi(c){if(c<=0)return 0;if(c>=1)return 1;const n=c*c,a=n*c;return 4*(c<.5?a:3*(c-n)+a-.75)}function Ki(c,n,a,h){const v=new St(c,n,a,h);return function(f){return v.solve(f)}}const Vi=Ki(.25,.1,.25,1);function ui(c,n,a){return Math.min(a,Math.max(n,c))}function pr(c,n,a){return(a=ui((a-c)/(n-c),0,1))*a*(3-2*a)}function Er(c,n,a){const h=a-n,v=((c-n)%h+h)%h+n;return v===n?a:v}function sa(c,n,a){if(!c.length)return a(null,[]);let h=c.length;const v=new Array(c.length);let f=null;c.forEach((x,P)=>{n(x,(L,N)=>{L&&(f=L),v[P]=N,--h==0&&a(f,v)})})}function Ar(c,...n){for(const a of n)for(const h in a)c[h]=a[h];return c}let Ta=1;function Qa(){return Ta++}function Os(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))}function As(c,n){c.forEach(a=>{n[a]&&(n[a]=n[a].bind(n))})}function to(c,n){return c.indexOf(n,c.length-n.length)!==-1}function ko(c,n,a){const h={};for(const v in c)h[v]=n.call(this,c[v],v,c);return h}function bt(c,n,a){const h={};for(const v in c)n.call(this,c[v],v,c)&&(h[v]=c[v]);return h}function Qe(c){return Array.isArray(c)?c.map(Qe):typeof c=="object"&&c?ko(c,Qe):c}const dt={};function it(c){dt[c]||(typeof console<"u"&&console.warn(c),dt[c]=!0)}function Ut(c,n,a){return(a.y-c.y)*(n.x-c.x)>(n.y-c.y)*(a.x-c.x)}function on(c){let n=0;for(let a,h,v=0,f=c.length,x=f-1;v<f;x=v++)a=c[v],h=c[x],n+=(h.x-a.x)*(a.y+h.y);return n}function un([c,n,a]){const h=zn(n+90),v=zn(a);return{x:c*Math.cos(h)*Math.sin(v),y:c*Math.sin(h)*Math.sin(v),z:c*Math.cos(v),azimuthal:n,polar:a}}function kn(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function fn(c){const n={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,h,v,f)=>{const x=v||f;return n[h]=!x||x.toLowerCase(),""}),n["max-age"]){const a=parseInt(n["max-age"],10);isNaN(a)?delete n["max-age"]:n["max-age"]=a}return n}let Wn=null;function Gn(c,n){return[c[4*n],c[4*n+1],c[4*n+2],c[4*n+3]]}function Sn(c,n,a,h){for(;n<a;){const v=n+a>>1;c[v]<h?n=v+1:a=v}return n}function et(c,n,a,h){for(;n<a;){const v=n+a>>1;c[v]<=h?n=v+1:a=v}return n}function we(c){return c>0?1/(1.001-c):1+c}function Pe(c){return c>0?1-1/(1.001-c):-c}const Ze={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Ze.API_URL)return null;try{const c=new URL(Ze.API_URL);return c.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":c.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function yt(c){return Ze.API_URL_REGEX.test(c)}function We(c){return Ze.API_SPRITE_REGEX.test(c)}let pt,kt,Dt,Jt,Xt,Gt;function On(){return pt==null&&(pt=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),pt}const _i={now:()=>Jt!==void 0?Jt:performance.now(),setNow(c){Jt=c},restoreNow(){Jt=void 0},frame(c){const n=requestAnimationFrame(c);return{cancel:()=>cancelAnimationFrame(n)}},getImageData(c,n=0){const{width:a,height:h}=c;Xt||(Xt=document.createElement("canvas"));const v=Xt.getContext("2d",{willReadFrequently:!0});if(!v)throw new Error("failed to create canvas 2d context");return(a>Xt.width||h>Xt.height)&&(Xt.width=a,Xt.height=h),v.clearRect(-n,-n,a+2*n,h+2*n),v.drawImage(c,0,0,a,h),v.getImageData(-n,-n,a+2*n,h+2*n)},resolveURL:c=>(kt||(kt=document.createElement("a")),kt.href=c,kt.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Dt==null&&(Dt=window.matchMedia("(prefers-reduced-motion: reduce)")),Dt.matches)},hasCanvasFingerprintNoise(){if(Gt!==void 0)return Gt;if(!On())return Gt=!1,!1;const c=new OffscreenCanvas(85,1),n=c.getContext("2d",{willReadFrequently:!0});let a=0;for(let v=0;v<c.width;++v)n.fillStyle=`rgba(${a++},${a++},${a++}, 255)`,n.fillRect(v,0,1,1);const h=n.getImageData(0,0,c.width,c.height);a=0;for(let v=0;v<h.data.length;++v)if(v%4!=3&&a++!==h.data[v])return Gt=!0,!0;return Gt=!1,!1}};function li(c,n){const a=c.indexOf("?");if(a<0)return`${c}?${new URLSearchParams(n).toString()}`;const h=new URLSearchParams(c.slice(a));for(const v in n)h.set(v,n[v]);return`${c.slice(0,a)}?${h.toString()}`}function Ui(c,n={persistentParams:[]}){const a=c.indexOf("?");if(a<0)return c;const h=new URLSearchParams,v=new URLSearchParams(c.slice(a));for(const x of n.persistentParams){const P=v.get(x);P&&h.set(x,P)}const f=h.toString();return`${c.slice(0,a)}${f.length>0?`?${f}`:""}`}const qi="mapbox-tiles";let Qi=500,Ni=50;const Jr=["language","worldview","jobid"];let Nr,kr;function Zr(){try{return caches}catch{}}function Xr(){const c=Zr();c&&Nr==null&&(Nr=c.open(qi))}let xs=1/0;const go={supported:!1,testSupport:function(c){!Ou&&bs&&(Lc?Gf(c):Fs=c)}};let Fs,bs,Ou=!1,Lc=!1;const Xp=typeof self<"u"?self:{};function Gf(c){const n=c.createTexture();c.bindTexture(c.TEXTURE_2D,n);try{if(c.texImage2D(c.TEXTURE_2D,0,c.RGBA,c.RGBA,c.UNSIGNED_BYTE,bs),c.isContextLost())return;go.supported=!0}catch{}c.deleteTexture(n),Ou=!0}Xp.document&&(bs=Xp.document.createElement("img"),bs.onload=function(){Fs&&Gf(Fs),Fs=null,Lc=!0},bs.onerror=function(){Ou=!0,Fs=null},bs.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Fu={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Fu);class Yh extends Error{constructor(n,a,h){a===401&&yt(h)&&(n+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(n),this.status=a,this.url=h}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Zl=kn()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,dc=function(c,n){if(!(/^file:/.test(a=c.url)||/^file:/.test(Zl())&&!/^\w+:/.test(a))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(h,v){const f=new AbortController,x=new Request(h.url,{method:h.method||"GET",body:h.body,credentials:h.credentials,headers:h.headers,referrer:Zl(),referrerPolicy:h.referrerPolicy,signal:f.signal});let P=!1,L=!1;const N=(I=x.url).indexOf("sku=")>0&&yt(I);var I;h.type==="json"&&x.headers.set("Accept","application/json");const z=(R,O,q)=>{if(L)return;if(R&&R.message!=="SecurityError"&&it(R.toString()),O&&q)return F(O);const te=Date.now();fetch(x).then(ae=>{if(ae.ok){const ge=N?ae.clone():null;return F(ae,ge,te)}return v(new Yh(ae.statusText,ae.status,h.url))}).catch(ae=>{ae.name!=="AbortError"&&v(new Error(`${ae.message} ${h.url}`))})},F=(R,O,q)=>{(h.type==="arrayBuffer"?R.arrayBuffer():h.type==="json"?R.json():R.text()).then(te=>{L||(O&&q&&function(ae,ge,_e){if(Xr(),Nr==null)return;const he=fn(ge.headers.get("Cache-Control")||"");if(he["no-store"])return;const xe={status:ge.status,statusText:ge.statusText,headers:new Headers};ge.headers.forEach((tt,Ke)=>xe.headers.set(Ke,tt)),he["max-age"]&&xe.headers.set("Expires",new Date(_e+1e3*he["max-age"]).toUTCString());const Te=xe.headers.get("Expires");if(!Te||new Date(Te).getTime()-_e<42e4)return;let Ae=Ui(ae.url,{persistentParams:Jr});if(ge.status===206){const tt=ae.headers.get("Range");if(!tt)return;xe.status=200,Ae=li(Ae,{range:tt})}(function(tt,Ke){if(kr===void 0)try{new Response(new ReadableStream),kr=!0}catch{kr=!1}kr?Ke(tt.body):tt.blob().then(Ke)})(ge,tt=>{const Ke=new Response((Ye=ge.status)!==200&&Ye!==404&&[101,103,204,205,304].includes(Ye)?null:tt,xe);var Ye;Xr(),Nr!=null&&Nr.then(Ct=>Ct.put(Ae,Ke)).catch(Ct=>it(Ct.message))})}(x,O,q),P=!0,v(null,te,R.headers.get("Cache-Control"),R.headers.get("Expires")))}).catch(te=>{L||v(new Error(te.message))})};return N?function(R,O){if(Xr(),Nr==null)return O(null);Nr.then(q=>{let te=Ui(R.url,{persistentParams:Jr});const ae=R.headers.get("Range");ae&&(te=li(te,{range:ae})),q.match(te).then(ge=>{const _e=function(he){if(!he)return!1;const xe=new Date(he.headers.get("Expires")||0),Te=fn(he.headers.get("Cache-Control")||"");return xe>Date.now()&&!Te["no-cache"]}(ge);q.delete(te),_e&&q.put(te,ge.clone()),O(null,ge,_e)}).catch(O)}).catch(O)}(x,z):z(null,null),{cancel:()=>{L=!0,P||f.abort()}}}(c,n);if(kn()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",c,n,void 0,!0)}var a;return function(h,v){const f=new XMLHttpRequest;f.open(h.method||"GET",h.url,!0),h.type==="arrayBuffer"&&(f.responseType="arraybuffer");for(const x in h.headers)f.setRequestHeader(x,h.headers[x]);return h.type==="json"&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials=h.credentials==="include",f.onerror=()=>{v(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||f.status===0)&&f.response!==null){let x=f.response;if(h.type==="json")try{x=JSON.parse(f.response)}catch(P){return v(P)}v(null,x,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else v(new Yh(f.statusText,f.status,h.url))},f.send(h.body),{cancel:()=>f.abort()}}(c,n)},Bu=function(c,n){return dc(Ar(c,{type:"arrayBuffer"}),n)};function ru(c){const n=document.createElement("a");return n.href=c,n.protocol===location.protocol&&n.host===location.host}const qf="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let _h,Kh;_h=[],Kh=0;const zc=function(c,n){if(go.supported&&(c.headers||(c.headers={}),c.headers.accept="image/webp,*/*"),Kh>=Ze.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:c,callback:n,cancelled:!1,cancel(){this.cancelled=!0}};return _h.push(f),f}Kh++;let a=!1;const h=()=>{if(!a)for(a=!0,Kh--;_h.length&&Kh<Ze.MAX_PARALLEL_IMAGE_REQUESTS;){const f=_h.shift(),{requestParameters:x,callback:P,cancelled:L}=f;L||(f.cancel=zc(x,P).cancel)}},v=Bu(c,(f,x,P,L)=>{h(),f?n(f):x&&(self.createImageBitmap?function(N,I){const z=new Blob([new Uint8Array(N)],{type:"image/png"});createImageBitmap(z).then(F=>{I(null,F)}).catch(F=>{I(new Error(`Could not load image because of ${F.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(x,(N,I)=>n(N,I,P,L)):function(N,I){const z=new Image;z.onload=()=>{I(null,z),URL.revokeObjectURL(z.src),z.onload=null,requestAnimationFrame(()=>{z.src=qf})},z.onerror=()=>I(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const F=new Blob([new Uint8Array(N)],{type:"image/png"});z.src=N.byteLength?URL.createObjectURL(F):qf}(x,(N,I)=>n(N,I,P,L)))});return{cancel:()=>{v.cancel(),h()}}};var Gd,ks,zr,Bs={exports:{}},Br={exports:{}},Wl={exports:{}},qd=function(){if(zr)return Bs.exports;zr=1;var c=(Gd||(Gd=1,Br.exports=function(a,h){var v,f,x,P,L,N,I,z;for(f=a.length-(v=3&a.length),x=h,L=3432918353,N=461845907,z=0;z<f;)I=255&a.charCodeAt(z)|(255&a.charCodeAt(++z))<<8|(255&a.charCodeAt(++z))<<16|(255&a.charCodeAt(++z))<<24,++z,x=27492+(65535&(P=5*(65535&(x=(x^=I=(65535&(I=(I=(65535&I)*L+(((I>>>16)*L&65535)<<16)&4294967295)<<15|I>>>17))*N+(((I>>>16)*N&65535)<<16)&4294967295)<<13|x>>>19))+((5*(x>>>16)&65535)<<16)&4294967295))+((58964+(P>>>16)&65535)<<16);switch(I=0,v){case 3:I^=(255&a.charCodeAt(z+2))<<16;case 2:I^=(255&a.charCodeAt(z+1))<<8;case 1:x^=I=(65535&(I=(I=(65535&(I^=255&a.charCodeAt(z)))*L+(((I>>>16)*L&65535)<<16)&4294967295)<<15|I>>>17))*N+(((I>>>16)*N&65535)<<16)&4294967295}return x^=a.length,x=2246822507*(65535&(x^=x>>>16))+((2246822507*(x>>>16)&65535)<<16)&4294967295,x=3266489909*(65535&(x^=x>>>13))+((3266489909*(x>>>16)&65535)<<16)&4294967295,(x^=x>>>16)>>>0}),Br.exports),n=(ks||(ks=1,Wl.exports=function(a,h){for(var v,f=a.length,x=h^f,P=0;f>=4;)v=1540483477*(65535&(v=255&a.charCodeAt(P)|(255&a.charCodeAt(++P))<<8|(255&a.charCodeAt(++P))<<16|(255&a.charCodeAt(++P))<<24))+((1540483477*(v>>>16)&65535)<<16),x=1540483477*(65535&x)+((1540483477*(x>>>16)&65535)<<16)^(v=1540483477*(65535&(v^=v>>>24))+((1540483477*(v>>>16)&65535)<<16)),f-=4,++P;switch(f){case 3:x^=(255&a.charCodeAt(P+2))<<16;case 2:x^=(255&a.charCodeAt(P+1))<<8;case 1:x=1540483477*(65535&(x^=255&a.charCodeAt(P)))+((1540483477*(x>>>16)&65535)<<16)}return x=1540483477*(65535&(x^=x>>>13))+((1540483477*(x>>>16)&65535)<<16),(x^=x>>>15)>>>0}),Wl.exports);return Bs.exports=c,Bs.exports.murmur3=c,Bs.exports.murmur2=n,Bs.exports}(),au=G(qd);class $a{constructor(n,...a){Ar(this,a[0]||{}),this.type=n}}class ss extends $a{constructor(n,a={}){super("error",Ar({error:n},a))}}function es(c,n,a){a[c]&&a[c].indexOf(n)!==-1||(a[c]=a[c]||[],a[c].push(n))}function Hd(c,n,a){if(a&&a[c]){const h=a[c].indexOf(n);h!==-1&&a[c].splice(h,1)}}class Vs{on(n,a){return this._listeners=this._listeners||{},es(n,a,this._listeners),this}off(n,a){return Hd(n,a,this._listeners),Hd(n,a,this._oneTimeListeners),this}once(n,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},es(n,a,this._oneTimeListeners),this):new Promise(h=>this.once(n,h))}fire(n,a){const h=typeof n=="string"?new $a(n,a):n,v=h.type;if(this.listens(v)){h.target=this;const f=this._listeners&&this._listeners[v]?this._listeners[v].slice():[];for(const L of f)L.call(this,h);const x=this._oneTimeListeners&&this._oneTimeListeners[v]?this._oneTimeListeners[v].slice():[];for(const L of x)Hd(v,L,this._oneTimeListeners),L.call(this,h);const P=this._eventedParent;P&&(Ar(h,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),P.fire(h))}else h instanceof ss&&console.error(h.error);return this}listens(n){return!!(this._listeners&&this._listeners[n]&&this._listeners[n].length>0||this._oneTimeListeners&&this._oneTimeListeners[n]&&this._oneTimeListeners[n].length>0||this._eventedParent&&this._eventedParent.listens(n))}setEventedParent(n,a){return this._eventedParent=n,this._eventedParentData=a,this}}var ts,no={},Jh=function(){if(ts)return no;ts=1;var c={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function n(f){return(f=Math.round(f))<0?0:f>255?255:f}function a(f){return n(f[f.length-1]==="%"?parseFloat(f)/100*255:parseInt(f))}function h(f){return(x=f[f.length-1]==="%"?parseFloat(f)/100:parseFloat(f))<0?0:x>1?1:x;var x}function v(f,x,P){return P<0?P+=1:P>1&&(P-=1),6*P<1?f+(x-f)*P*6:2*P<1?x:3*P<2?f+(x-f)*(2/3-P)*6:f}try{no.parseCSSColor=function(f){var x,P=f.replace(/ /g,"").toLowerCase();if(P in c)return c[P].slice();if(P[0]==="#")return P.length===4?(x=parseInt(P.substr(1),16))>=0&&x<=4095?[(3840&x)>>4|(3840&x)>>8,240&x|(240&x)>>4,15&x|(15&x)<<4,1]:null:P.length===7&&(x=parseInt(P.substr(1),16))>=0&&x<=16777215?[(16711680&x)>>16,(65280&x)>>8,255&x,1]:null;var L=P.indexOf("("),N=P.indexOf(")");if(L!==-1&&N+1===P.length){var I=P.substr(0,L),z=P.substr(L+1,N-(L+1)).split(","),F=1;switch(I){case"rgba":if(z.length!==4)return null;F=h(z.pop());case"rgb":return z.length!==3?null:[a(z[0]),a(z[1]),a(z[2]),F];case"hsla":if(z.length!==4)return null;F=h(z.pop());case"hsl":if(z.length!==3)return null;var R=(parseFloat(z[0])%360+360)%360/360,O=h(z[1]),q=h(z[2]),te=q<=.5?q*(O+1):q+O-q*O,ae=2*q-te;return[n(255*v(ae,te,R+1/3)),n(255*v(ae,te,R)),n(255*v(ae,te,R-1/3)),F];default:return null}}return null}}catch{}return no}();class Or{constructor(n,a,h,v=1){this.r=n,this.g=a,this.b=h,this.a=v}static parse(n){if(!n)return;if(n instanceof Or)return n;if(typeof n!="string")return;const a=Jh.parseCSSColor(n);return a?new Or(a[0]/255*a[3],a[1]/255*a[3],a[2]/255*a[3],a[3]):void 0}toStringPremultipliedAlpha(){const[n,a,h,v]=this.a===0?[0,0,0,0]:[255*this.r/this.a,255*this.g/this.a,255*this.b/this.a,this.a];return`rgba(${Math.round(n)},${Math.round(a)},${Math.round(h)},${v})`}toString(){const[n,a,h,v]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*n)},${Math.round(255*a)},${Math.round(255*h)},${v})`}toRenderColor(n){const{r:a,g:h,b:v,a:f}=this;return new os(n,a,h,v,f)}clone(){return new Or(this.r,this.g,this.b,this.a)}}class os{constructor(n,a,h,v,f){if(n){const x=n.image.height,P=x*x;a=f===0?0:a/f*(x-1),h=f===0?0:h/f*(x-1),v=f===0?0:v/f*(x-1);const L=Math.floor(a),N=Math.floor(h),I=Math.floor(v),z=Math.ceil(a),F=Math.ceil(h),R=Math.ceil(v),O=a-L,q=h-N,te=v-I,ae=n.image.data,ge=4*(L+N*P+I*x),_e=4*(L+N*P+R*x),he=4*(L+F*P+I*x),xe=4*(L+F*P+R*x),Te=4*(z+N*P+I*x),Ae=4*(z+N*P+R*x),tt=4*(z+F*P+I*x),Ke=4*(z+F*P+R*x);if(ge<0||Ke>=ae.length)throw new Error("out of range");this.r=ir(ir(ir(ae[ge],ae[_e],te),ir(ae[he],ae[xe],te),q),ir(ir(ae[Te],ae[Ae],te),ir(ae[tt],ae[Ke],te),q),O)/255*f,this.g=ir(ir(ir(ae[ge+1],ae[_e+1],te),ir(ae[he+1],ae[xe+1],te),q),ir(ir(ae[Te+1],ae[Ae+1],te),ir(ae[tt+1],ae[Ke+1],te),q),O)/255*f,this.b=ir(ir(ir(ae[ge+2],ae[_e+2],te),ir(ae[he+2],ae[xe+2],te),q),ir(ir(ae[Te+2],ae[Ae+2],te),ir(ae[tt+2],ae[Ke+2],te),q),O)/255*f,this.a=f}else this.r=a,this.g=h,this.b=v,this.a=f}toArray(){const{r:n,g:a,b:h,a:v}=this;return v===0?[0,0,0,0]:[255*n/v,255*a/v,255*h/v,v]}toHslaArray(){if(this.a===0)return[0,0,0,0];const{r:n,g:a,b:h,a:v}=this,f=Math.min(Math.max(n/v,0),1),x=Math.min(Math.max(a/v,0),1),P=Math.min(Math.max(h/v,0),1),L=Math.min(f,x,P),N=Math.max(f,x,P),I=(L+N)/2;if(L===N)return[0,0,100*I,v];const z=N-L,F=I>.5?z/(2-N-L):z/(N+L);let R=0;return N===f?R=(x-P)/z+(x<P?6:0):N===x?R=(P-f)/z+2:N===P&&(R=(f-x)/z+4),R*=60,[Math.min(Math.max(R,0),360),Math.min(Math.max(100*F,0),100),Math.min(Math.max(100*I,0),100),v]}toArray01(){const{r:n,g:a,b:h,a:v}=this;return v===0?[0,0,0,0]:[n/v,a/v,h/v,v]}toArray01Scaled(n){const{r:a,g:h,b:v,a:f}=this;return f===0?[0,0,0]:[a/f*n,h/f*n,v/f*n]}toArray01PremultipliedAlpha(){const{r:n,g:a,b:h,a:v}=this;return[n,a,h,v]}toArray01Linear(){const{r:n,g:a,b:h,a:v}=this;return v===0?[0,0,0,0]:[Math.pow(n/v,2.2),Math.pow(a/v,2.2),Math.pow(h/v,2.2),v]}}function ir(c,n,a){return c*(1-a)+n*a}function Xl(c,n,a){return c.map((h,v)=>ir(h,n[v],a))}Or.black=new Or(0,0,0,1),Or.white=new Or(1,1,1,1),Or.transparent=new Or(0,0,0,0),Or.red=new Or(1,0,0,1),Or.blue=new Or(0,0,1,1);var Dr=Object.freeze({__proto__:null,array:Xl,color:function(c,n,a){return new Or(ir(c.r,n.r,a),ir(c.g,n.g,a),ir(c.b,n.b,a),ir(c.a,n.a,a))},number:ir});function Qo(c,...n){for(const a of n)for(const h in a)c[h]=a[h];return c}class fl extends Error{constructor(n,a){super(a),this.message=a,this.key=n}}class fc{constructor(n,a=[]){this.parent=n,this.bindings={};for(const[h,v]of a)this.bindings[h]=v}concat(n){return new fc(this,n)}get(n){if(this.bindings[n])return this.bindings[n];if(this.parent)return this.parent.get(n);throw new Error(`${n} not found in scope.`)}has(n){return!!this.bindings[n]||!!this.parent&&this.parent.has(n)}}const su={kind:"null"},hi={kind:"number"},jr={kind:"string"},Wi={kind:"boolean"},Sr={kind:"color"},pc={kind:"object"},Hi={kind:"value"},ou={kind:"collator"},io={kind:"formatted"},mc={kind:"resolvedImage"};function Ns(c,n){return{kind:"array",itemType:c,N:n}}function ca(c){if(c.kind==="array"){const n=ca(c.itemType);return typeof c.N=="number"?`array<${n}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${n}>`}return c.kind}const Vu=[su,hi,jr,Wi,Sr,io,pc,Ns(Hi),mc];function Qh(c,n){if(n.kind==="error")return null;if(c.kind==="array"){if(n.kind==="array"&&(n.N===0&&n.itemType.kind==="value"||!Qh(c.itemType,n.itemType))&&(typeof c.N!="number"||c.N===n.N))return null}else{if(c.kind===n.kind)return null;if(c.kind==="value"){for(const a of Vu)if(!Qh(a,n))return null}}return`Expected ${ca(c)} but found ${ca(n)} instead.`}function ed(c,n){return n.some(a=>a.kind===c.kind)}function Nu(c,n){return n.some(a=>a==="null"?c===null:a==="array"?Array.isArray(c):a==="object"?c&&!Array.isArray(c)&&typeof c=="object":a===typeof c)}class Zd{constructor(n,a,h){this.sensitivity=n?a?"variant":"case":a?"accent":"base",this.locale=h,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(n,a){return this.collator.compare(n,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class lu{constructor(n,a,h,v,f){this.text=n.normalize?n.normalize():n,this.image=a,this.scale=h,this.fontStack=v,this.textColor=f}}class Yr{constructor(n){this.sections=n}static fromString(n){return new Yr([new lu(n,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(n=>n.text.length!==0||n.image&&n.image.namePrimary)}static factory(n){return n instanceof Yr?n:Yr.fromString(n)}toString(){return this.sections.length===0?"":this.sections.map(n=>n.text).join("")}serialize(){const n=["format"];for(const a of this.sections){if(a.image){n.push(["image",a.image.namePrimary]);continue}n.push(a.text);const h={};a.fontStack&&(h["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(h["font-scale"]=a.scale),a.textColor&&(h["text-color"]=["rgba"].concat(a.textColor.toRenderColor(null).toArray())),n.push(h)}return n}}class el{constructor(n,a){if(this.id=n,this.options=a||{params:{}},this.options.transform){const{a:h,b:v,c:f,d:x,e:P,f:L}=this.options.transform;this.options.transform=new DOMMatrix([h,v,f,x,P,L])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}static deserializeId(n){return JSON.parse(n).id}static deserializeFromString(n){const a=JSON.parse(n),{a:h,b:v,c:f,d:x,e:P,f:L}=a.options.transform;return new DOMMatrix([h,v,f,x,P,L]),new el(a.id,a.options)}scaleSelf(n){return this.options.transform=this.options.transform.scale(n),this}serialize(){const n={id:this.id};this.options&&(n.options=this.options);const{a,b:h,c:v,d:f,e:x,f:P}=this.options.transform;return n.options.transform={a,b:h,c:v,d:f,e:x,f:P},JSON.stringify(n)}}class Oa{constructor(n){this.namePrimary=n.namePrimary,n.nameSecondary&&(this.nameSecondary=n.nameSecondary),n.optionsPrimary&&(this.optionsPrimary=n.optionsPrimary),n.optionsSecondary&&(this.optionsSecondary=n.optionsSecondary),this.available=n.available}toString(){return this.namePrimary&&this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}getPrimary(){return new el(this.namePrimary,{params:this.optionsPrimary&&this.optionsPrimary.params||{}})}getSerializedPrimary(){return this.getPrimary().serialize()}getSecondary(){return this.nameSecondary?new el(this.nameSecondary,{params:this.optionsSecondary&&this.optionsSecondary.params||{}}):null}static from(n){return typeof n=="string"?Oa.build(n):n}static build(n,a,h,v){return n?new Oa({namePrimary:n,nameSecondary:a,optionsPrimary:h,optionsSecondary:v,available:!1}):null}}function Ml(c,n,a,h){return typeof c=="number"&&c>=0&&c<=255&&typeof n=="number"&&n>=0&&n<=255&&typeof a=="number"&&a>=0&&a<=255?h===void 0||typeof h=="number"&&h>=0&&h<=1?null:`Invalid rgba value [${[c,n,a,h].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof h=="number"?[c,n,a,h]:[c,n,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function fs(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof Or||c instanceof Zd||c instanceof Yr||c instanceof Oa)return!0;if(Array.isArray(c)){for(const n of c)if(!fs(n))return!1;return!0}if(typeof c=="object"){for(const n in c)if(!fs(c[n]))return!1;return!0}return!1}function Ca(c){if(c===null)return su;if(typeof c=="string")return jr;if(typeof c=="boolean")return Wi;if(typeof c=="number")return hi;if(c instanceof Or)return Sr;if(c instanceof Zd)return ou;if(c instanceof Yr)return io;if(c instanceof Oa)return mc;if(Array.isArray(c)){const n=c.length;let a;for(const h of c){const v=Ca(h);if(a){if(a===v)continue;a=Hi;break}a=v}return Ns(a||Hi,n)}return pc}function _o(c){const n=typeof c;return c===null?"":n==="string"||n==="number"||n==="boolean"?String(c):c instanceof Or?c.toStringPremultipliedAlpha():c instanceof Yr||c instanceof Oa?c.toString():JSON.stringify(c)}class Il{constructor(n,a){this.type=n,this.value=a}static parse(n,a){if(n.length!==2)return a.error(`'literal' expression requires exactly one argument, but found ${n.length-1} instead.`);if(!fs(n[1]))return a.error("invalid value");const h=n[1];let v=Ca(h);const f=a.expectedType;return v.kind!=="array"||v.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(v=f),new Il(v,h)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Or?["rgba"].concat(this.value.toRenderColor(null).toArray()):this.value instanceof Yr?this.value.serialize():this.value}}class ws{constructor(n){this.name="ExpressionEvaluationError",this.message=n}toJSON(){return this.message}}const ju={string:jr,number:hi,boolean:Wi,object:pc};class pl{constructor(n,a){this.type=n,this.args=a}static parse(n,a){if(n.length<2)return a.error("Expected at least one argument.");let h,v=1;const f=n[0];if(f==="array"){let P,L;if(n.length>2){const N=n[1];if(typeof N!="string"||!(N in ju)||N==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);P=ju[N],v++}else P=Hi;if(n.length>3){if(n[2]!==null&&(typeof n[2]!="number"||n[2]<0||n[2]!==Math.floor(n[2])))return a.error('The length argument to "array" must be a positive integer literal',2);L=n[2],v++}h=Ns(P,L)}else h=ju[f];const x=[];for(;v<n.length;v++){const P=a.parse(n[v],v,Hi);if(!P)return null;x.push(P)}return new pl(h,x)}evaluate(n){for(let a=0;a<this.args.length;a++){const h=this.args[a].evaluate(n);if(!Qh(this.type,Ca(h)))return h;if(a===this.args.length-1)throw new ws(`The expression ${JSON.stringify(this.args[a].serialize())} evaluated to ${ca(Ca(h))} but was expected to be of type ${ca(this.type)}.`)}return null}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=this.type,a=[n.kind];if(n.kind==="array"){const h=n.itemType;if(h.kind==="string"||h.kind==="number"||h.kind==="boolean"){a.push(h.kind);const v=n.N;(typeof v=="number"||this.args.length>1)&&a.push(v)}}return a.concat(this.args.map(h=>h.serialize()))}}class cu{constructor(n){this.type=io,this.sections=n}static parse(n,a){if(n.length<2)return a.error("Expected at least one argument.");const h=n[1];if(!Array.isArray(h)&&typeof h=="object")return a.error("First argument must be an image or text section.");const v=[];let f=!1;for(let x=1;x<=n.length-1;++x){const P=n[x];if(f&&typeof P=="object"&&!Array.isArray(P)){f=!1;let L=null;if(P["font-scale"]&&(L=a.parseObjectValue(P["font-scale"],x,"font-scale",hi),!L))return null;let N=null;if(P["text-font"]&&(N=a.parseObjectValue(P["text-font"],x,"text-font",Ns(jr)),!N))return null;let I=null;if(P["text-color"]&&(I=a.parseObjectValue(P["text-color"],x,"text-color",Sr),!I))return null;const z=v[v.length-1];z.scale=L,z.font=N,z.textColor=I}else{const L=a.parse(n[x],x,Hi);if(!L)return null;const N=L.type.kind;if(N!=="string"&&N!=="value"&&N!=="null"&&N!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,v.push({content:L,scale:null,font:null,textColor:null})}}return new cu(v)}evaluate(n){return new Yr(this.sections.map(a=>{const h=a.content.evaluate(n);return Ca(h)===mc?new lu("",h,null,null,null):new lu(_o(h),null,a.scale?a.scale.evaluate(n):null,a.font?a.font.evaluate(n).join(","):null,a.textColor?a.textColor.evaluate(n):null)}))}eachChild(n){for(const a of this.sections)n(a.content),a.scale&&n(a.scale),a.font&&n(a.font),a.textColor&&n(a.textColor)}outputDefined(){return!1}serialize(){const n=["format"];for(const a of this.sections){n.push(a.content.serialize());const h={};a.scale&&(h["font-scale"]=a.scale.serialize()),a.font&&(h["text-font"]=a.font.serialize()),a.textColor&&(h["text-color"]=a.textColor.serialize()),n.push(h)}return n}}class uu{constructor(n,a,h,v){this._imageWarnHistory={},this.type=mc,this.inputPrimary=n,this.inputSecondary=a,this.inputPrimaryParams=h,this.inputSecondaryParams=v}static parse(n,a){if(n.length<2)return a.error("Expected two or more arguments.");let h=1;const v=[];function f(){if(h<n.length){const P=a.parse(n[h],h++,jr);return P?(v.push({image:P,options:void 0}),!0):(a.error(v.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function x(){if(h<n.length){if((P=n[h])===null||typeof P!="object"||Array.isArray(P))return!0;const L=n[h].params,N=a.concat(h);if(!L)return h++,!0;if(typeof L!="object"||L.constructor!==Object)return N.error('Image options "params" should be an object'),!1;const I={},z=N.concat(void 0,"params");for(const F in L){if(!F)return z.error("Image parameter name should be non-empty"),!1;const R=z.concat(void 0,F).parse(L[F],void 0,Sr,void 0,{typeAnnotation:"coerce"});if(!R)return!1;I[F]=R}return v[v.length-1].options=I,h++,!0}var P;return!0}for(let P=0;P<2;P++)if(!f()||!x())return;return new uu(v[0].image,v[1]?v[1].image:void 0,v[0].options,v[1]?v[1].options:void 0)}evaluateParams(n,a){const h={};if(a){for(const v in a)if(a[v])try{const f=a[v].evaluate(n),x=`Ignoring image parameter "${v}" with semi-transparent color ${f.toString()}`;if(f.a!==1){this._imageWarnHistory[x]||(console.warn(x),this._imageWarnHistory[x]=!0);continue}h[v]=f}catch{continue}if(Object.keys(h).length!==0)return{params:h}}}evaluate(n){const a=Oa.build(this.inputPrimary.evaluate(n),this.inputSecondary?this.inputSecondary.evaluate(n):void 0,this.inputPrimaryParams?this.evaluateParams(n,this.inputPrimaryParams):void 0,this.inputSecondaryParams?this.evaluateParams(n,this.inputSecondaryParams):void 0);return a&&n.availableImages&&(a.available=n.availableImages.indexOf(a.namePrimary)>-1,a.nameSecondary&&a.available&&n.availableImages&&(a.available=n.availableImages.indexOf(a.nameSecondary)>-1)),a}eachChild(n){if(n(this.inputPrimary),this.inputPrimaryParams)for(const a in this.inputPrimaryParams)this.inputPrimaryParams[a]&&n(this.inputPrimaryParams[a]);if(this.inputSecondary&&(n(this.inputSecondary),this.inputSecondaryParams))for(const a in this.inputSecondaryParams)this.inputSecondaryParams[a]&&n(this.inputSecondaryParams[a])}outputDefined(){return!1}serializeParams(n){const a={};if(n){for(const h in n)n[h]&&(a[h]=n[h].serialize());return{params:a}}}serialize(){const n=["image",this.inputPrimary.serialize()];return this.inputPrimaryParams&&n.push(this.serializeParams(this.inputPrimaryParams)),this.inputSecondary&&(n.push(this.inputSecondary.serialize()),this.inputSecondaryParams&&n.push(this.serializeParams(this.inputSecondaryParams))),n}}function Pl(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}const Al={"to-boolean":Wi,"to-color":Sr,"to-number":hi,"to-string":jr};class kl{constructor(n,a){this.type=n,this.args=a}static parse(n,a){if(n.length<2)return a.error("Expected at least one argument.");const h=n[0],v=[];let f=su;if(h==="to-array"){if(!Array.isArray(n[1]))return null;const x=n[1].length;if(a.expectedType){if(a.expectedType.kind!=="array")return a.error(`Expected ${a.expectedType.kind} but found array.`);f=Ns(a.expectedType.itemType,x)}else{if(!(x>0&&fs(n[1][0])))return null;f=Ns(Ca(n[1][0]),x)}for(let P=0;P<x;P++){const L=n[1][P];let N;if(Pl(L)==="array")N=a.parse(L,void 0,f.itemType);else{const I=Pl(L);if(I!==f.itemType.kind)return a.error(`Expected ${f.itemType.kind} but found ${I}.`);N=a.registry.literal.parse(["literal",L===void 0?null:L],a)}if(!N)return null;v.push(N)}}else{if((h==="to-boolean"||h==="to-string")&&n.length!==2)return a.error("Expected one argument.");f=Al[h];for(let x=1;x<n.length;x++){const P=a.parse(n[x],x,Hi);if(!P)return null;v.push(P)}}return new kl(f,v)}evaluate(n){if(this.type.kind==="boolean")return!!this.args[0].evaluate(n);if(this.type.kind==="color"){let a,h;for(const v of this.args){if(a=v.evaluate(n),h=null,a instanceof Or)return a;if(typeof a=="string"){const f=n.parseColor(a);if(f)return f}else if(Array.isArray(a)&&(h=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:Ml(a[0],a[1],a[2],a[3]),!h))return new Or(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new ws(h||`Could not parse color from value '${typeof a=="string"?a:String(JSON.stringify(a))}'`)}if(this.type.kind==="number"){let a=null;for(const h of this.args){if(a=h.evaluate(n),a===null)return 0;const v=Number(a);if(!isNaN(v))return v}throw new ws(`Could not convert ${JSON.stringify(a)} to number.`)}return this.type.kind==="formatted"?Yr.fromString(_o(this.args[0].evaluate(n))):this.type.kind==="resolvedImage"?Oa.build(_o(this.args[0].evaluate(n))):this.type.kind==="array"?this.args.map(a=>a.evaluate(n)):_o(this.args[0].evaluate(n))}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){if(this.type.kind==="formatted")return new cu([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new uu(this.args[0]).serialize();const n=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(a=>{n.push(a.serialize())}),n}}const yh=["Unknown","Point","LineString","Polygon"];class td{constructor(n,a){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=n,this.options=a}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?yh[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(n){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const n=this.featureDistanceData.center,a=this.featureDistanceData.scale,{x:h,y:v}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(h*a-n[0])+this.featureDistanceData.bearing[1]*(v*a-n[1])}return 0}parseColor(n){let a=this._parseColorCache[n];return a||(a=this._parseColorCache[n]=Or.parse(n)),a}getConfig(n){return this.options?this.options.get(n):null}}class ps{constructor(n,a,h,v,f){this.name=n,this.type=a,this._evaluate=h,this.args=v,this._overloadIndex=f}evaluate(n){if(!this._evaluate){const a=ps.definitions[this.name];this._evaluate=Array.isArray(a)?a[2]:a.overloads[this._overloadIndex][1]}return this._evaluate(n,this.args)}eachChild(n){this.args.forEach(n)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(n=>n.serialize()))}static parse(n,a){const h=n[0],v=ps.definitions[h];if(!v)return a.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(v)?v[0]:v.type,x=Array.isArray(v)?[[v[1],v[2]]]:v.overloads,P=[];let L=null,N=-1;for(const[I,z]of x){if(Array.isArray(I)&&I.length!==n.length-1)continue;P.push(I),N++,L=new Qf(a.registry,a.path,null,a.scope,void 0,a._scope,a.options);const F=[];let R=!1;for(let O=1;O<n.length;O++){const q=n[O],te=Array.isArray(I)?I[O-1]:I.type,ae=L.parse(q,1+F.length,te);if(!ae){R=!0;break}F.push(ae)}if(!R)if(Array.isArray(I)&&I.length!==F.length)L.error(`Expected ${I.length} arguments, but found ${F.length} instead.`);else{for(let O=0;O<F.length;O++){const q=Array.isArray(I)?I[O]:I.type,te=F[O];L.concat(O+1).checkSubtype(q,te.type)}if(L.errors.length===0)return new ps(h,f,z,F,N)}}if(P.length===1)a.errors.push(...L.errors);else{const I=(P.length?P:x.map(([F])=>F)).map(Hf).join(" | "),z=[];for(let F=1;F<n.length;F++){const R=a.parse(n[F],1+z.length);if(!R)return null;z.push(ca(R.type))}a.error(`Expected arguments of type ${I}, but found (${z.join(", ")}) instead.`)}return null}static register(n,a){ps.definitions=a;for(const h in a)n[h]=ps}}function Hf(c){return Array.isArray(c)?`(${c.map(ca).join(", ")})`:`(${ca(c.type)}...)`}class nd{constructor(n,a,h){this.type=ou,this.locale=h,this.caseSensitive=n,this.diacriticSensitive=a}static parse(n,a){if(n.length!==2)return a.error("Expected one argument.");const h=n[1];if(typeof h!="object"||Array.isArray(h))return a.error("Collator options argument must be an object.");const v=h["case-sensitive"]===void 0?a.parse(!1,1,Wi):a.parseObjectValue(h["case-sensitive"],1,"case-sensitive",Wi);if(!v)return null;const f=h["diacritic-sensitive"]===void 0?a.parse(!1,1,Wi):a.parseObjectValue(h["diacritic-sensitive"],1,"diacritic-sensitive",Wi);if(!f)return null;let x=null;return h.locale&&(x=a.parseObjectValue(h.locale,1,"locale",jr),!x)?null:new nd(v,f,x)}evaluate(n){return new Zd(this.caseSensitive.evaluate(n),this.diacriticSensitive.evaluate(n),this.locale?this.locale.evaluate(n):null)}eachChild(n){n(this.caseSensitive),n(this.diacriticSensitive),this.locale&&n(this.locale)}outputDefined(){return!1}serialize(){const n={};return n["case-sensitive"]=this.caseSensitive.serialize(),n["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(n.locale=this.locale.serialize()),["collator",n]}}function id(c,n,a=0,h=c.length-1,v=Zf){for(;h>a;){if(h-a>600){const L=h-a+1,N=n-a+1,I=Math.log(L),z=.5*Math.exp(2*I/3),F=.5*Math.sqrt(I*z*(L-z)/L)*(N-L/2<0?-1:1);id(c,n,Math.max(a,Math.floor(n-N*z/L+F)),Math.min(h,Math.floor(n+(L-N)*z/L+F)),v)}const f=c[n];let x=a,P=h;for(hu(c,a,n),v(c[h],f)>0&&hu(c,a,h);x<P;){for(hu(c,x,P),x++,P--;v(c[x],f)<0;)x++;for(;v(c[P],f)>0;)P--}v(c[a],f)===0?hu(c,a,P):(P++,hu(c,P,h)),P<=n&&(a=P+1),n<=P&&(h=P-1)}}function hu(c,n,a){const h=c[n];c[n]=c[a],c[a]=h}function Zf(c,n){return c<n?-1:c>n?1:0}function Wf(c){let n=0;for(let a,h,v=0,f=c.length,x=f-1;v<f;x=v++)a=c[v],h=c[x],n+=(h.x-a.x)*(a.y+h.y);return n}function rd(c,n){c[0]=Math.min(c[0],n[0]),c[1]=Math.min(c[1],n[1]),c[2]=Math.max(c[2],n[0]),c[3]=Math.max(c[3],n[1])}function gc(c,n){return!(c[0]<=n[0]||c[2]>=n[2]||c[1]<=n[1]||c[3]>=n[3])}function Bm(c,n,a){const h=c[0]-n[0],v=c[1]-n[1],f=c[0]-a[0],x=c[1]-a[1];return h*x-f*v==0&&h*f<=0&&v*x<=0}function Dl(c,n,a=!1){let h=!1;for(let P=0,L=n.length;P<L;P++){const N=n[P];for(let I=0,z=N.length,F=z-1;I<z;F=I++){const R=N[F],O=N[I];if(Bm(c,R,O))return a;(f=R)[1]>(v=c)[1]!=(x=O)[1]>v[1]&&v[0]<(x[0]-f[0])*(v[1]-f[1])/(x[1]-f[1])+f[0]&&(h=!h)}}var v,f,x;return h}function Vm(c,n,a,h){const v=h[0]-a[0],f=h[1]-a[1],x=(c[0]-a[0])*f-v*(c[1]-a[1]),P=(n[0]-a[0])*f-v*(n[1]-a[1]);return x>0&&P<0||x<0&&P>0}function Wd(c,n,a,h){return(v=[h[0]-a[0],h[1]-a[1]])[0]*(f=[n[0]-c[0],n[1]-c[1]])[1]-v[1]*f[0]!=0&&!(!Vm(c,n,a,h)||!Vm(a,h,c,n));var v,f}const Yl=8192;function Nm(c,n){const a=(180+c[0])/360,h=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,v=Math.pow(2,n.z);return[Math.round(a*v*Yl),Math.round(h*v*Yl)]}function jm(c,n){for(let a=0;a<n.length;a++)if(Dl(c,n[a]))return!0;return!1}function Yp(c,n,a){for(const h of a)for(let v=0,f=h.length,x=f-1;v<f;x=v++)if(Wd(c,n,h[x],h[v]))return!0;return!1}function Xf(c,n){for(let a=0;a<c.length;++a)if(!Dl(c[a],n))return!1;for(let a=0;a<c.length-1;++a)if(Yp(c[a],c[a+1],n))return!1;return!0}function Rl(c,n){for(let a=0;a<n.length;a++)if(Xf(c,n[a]))return!0;return!1}function Tr(c,n,a){const h=[];for(let v=0;v<c.length;v++){const f=[];for(let x=0;x<c[v].length;x++){const P=Nm(c[v][x],a);rd(n,P),f.push(P)}h.push(f)}return h}function Zi(c,n,a){const h=[];for(let v=0;v<c.length;v++){const f=Tr(c[v],n,a);h.push(f)}return h}function Uu(c,n,a,h){if(c[0]<a[0]||c[0]>a[2]){const v=.5*h;let f=c[0]-a[0]>v?-h:a[0]-c[0]>v?h:0;f===0&&(f=c[0]-a[2]>v?-h:a[2]-c[0]>v?h:0),c[0]+=f}rd(n,c)}function lr(c,n,a,h){const v=Math.pow(2,h.z)*Yl,f=[h.x*Yl,h.y*Yl],x=[];if(!c)return x;for(const P of c)for(const L of P){const N=[L.x+f[0],L.y+f[1]];Uu(N,n,a,v),x.push(N)}return x}function vh(c,n,a,h){const v=Math.pow(2,h.z)*Yl,f=[h.x*Yl,h.y*Yl],x=[];if(!c)return x;for(const L of c){const N=[];for(const I of L){const z=[I.x+f[0],I.y+f[1]];rd(n,z),N.push(z)}x.push(N)}if(n[2]-n[0]<=v/2){(P=n)[0]=P[1]=1/0,P[2]=P[3]=-1/0;for(const L of x)for(const N of L)Uu(N,n,a,v)}var P;return x}class du{constructor(n,a){this.type=Wi,this.geojson=n,this.geometries=a}static parse(n,a){if(n.length!==2)return a.error(`'within' expression requires exactly one argument, but found ${n.length-1} instead.`);if(fs(n[1])){const h=n[1];if(h.type==="FeatureCollection")for(let v=0;v<h.features.length;++v){const f=h.features[v].geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new du(h,h.features[v].geometry)}else if(h.type==="Feature"){const v=h.geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new du(h,h.geometry)}else if(h.type==="Polygon"||h.type==="MultiPolygon")return new du(h,h)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(n){if(n.geometry()!=null&&n.canonicalID()!=null){if(n.geometryType()==="Point")return function(a,h){const v=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],x=a.canonicalID();if(!x)return!1;if(h.type==="Polygon"){const P=Tr(h.coordinates,f,x),L=lr(a.geometry(),v,f,x);if(!gc(v,f))return!1;for(const N of L)if(!Dl(N,P))return!1}if(h.type==="MultiPolygon"){const P=Zi(h.coordinates,f,x),L=lr(a.geometry(),v,f,x);if(!gc(v,f))return!1;for(const N of L)if(!jm(N,P))return!1}return!0}(n,this.geometries);if(n.geometryType()==="LineString")return function(a,h){const v=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],x=a.canonicalID();if(!x)return!1;if(h.type==="Polygon"){const P=Tr(h.coordinates,f,x),L=vh(a.geometry(),v,f,x);if(!gc(v,f))return!1;for(const N of L)if(!Xf(N,P))return!1}if(h.type==="MultiPolygon"){const P=Zi(h.coordinates,f,x),L=vh(a.geometry(),v,f,x);if(!gc(v,f))return!1;for(const N of L)if(!Rl(N,P))return!1}return!0}(n,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const or={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Xd=1/298.257223563,ad=Xd*(2-Xd),xh=Math.PI/180;class $u{static fromTile(n,a,h){const v=Math.PI*(1-2*(n+.5)/Math.pow(2,a)),f=Math.atan(.5*(Math.exp(v)-Math.exp(-v)))/xh;return new $u(f,h)}static get units(){return or}constructor(n,a){if(n===void 0)throw new Error("No latitude given.");if(a&&!or[a])throw new Error(`Unknown unit ${a}. Use one of: ${Object.keys(or).join(", ")}`);const h=6378.137*xh*(a?or[a]:1),v=Math.cos(n*xh),f=1/(1-ad*(1-v*v)),x=Math.sqrt(f);this.kx=h*x*v,this.ky=h*x*f*(1-ad)}distance(n,a){const h=Rs(n[0]-a[0])*this.kx,v=(n[1]-a[1])*this.ky;return Math.sqrt(h*h+v*v)}bearing(n,a){const h=Rs(a[0]-n[0])*this.kx;return Math.atan2(h,(a[1]-n[1])*this.ky)/xh}destination(n,a,h){const v=h*xh;return this.offset(n,Math.sin(v)*a,Math.cos(v)*a)}offset(n,a,h){return[n[0]+a/this.kx,n[1]+h/this.ky]}lineDistance(n){let a=0;for(let h=0;h<n.length-1;h++)a+=this.distance(n[h],n[h+1]);return a}area(n){let a=0;for(let h=0;h<n.length;h++){const v=n[h];for(let f=0,x=v.length,P=x-1;f<x;P=f++)a+=Rs(v[f][0]-v[P][0])*(v[f][1]+v[P][1])*(h?-1:1)}return Math.abs(a)/2*this.kx*this.ky}along(n,a){let h=0;if(a<=0)return n[0];for(let v=0;v<n.length-1;v++){const f=n[v],x=n[v+1],P=this.distance(f,x);if(h+=P,h>a)return Ds(f,x,(a-(h-P))/P)}return n[n.length-1]}pointToSegmentDistance(n,a,h){let[v,f]=a,x=Rs(h[0]-v)*this.kx,P=(h[1]-f)*this.ky;if(x!==0||P!==0){const L=(Rs(n[0]-v)*this.kx*x+(n[1]-f)*this.ky*P)/(x*x+P*P);L>1?(v=h[0],f=h[1]):L>0&&(v+=x/this.kx*L,f+=P/this.ky*L)}return x=Rs(n[0]-v)*this.kx,P=(n[1]-f)*this.ky,Math.sqrt(x*x+P*P)}pointOnLine(n,a){let h=1/0,v=n[0][0],f=n[0][1],x=0,P=0;for(let L=0;L<n.length-1;L++){let N=n[L][0],I=n[L][1],z=Rs(n[L+1][0]-N)*this.kx,F=(n[L+1][1]-I)*this.ky,R=0;z===0&&F===0||(R=(Rs(a[0]-N)*this.kx*z+(a[1]-I)*this.ky*F)/(z*z+F*F),R>1?(N=n[L+1][0],I=n[L+1][1]):R>0&&(N+=z/this.kx*R,I+=F/this.ky*R)),z=Rs(a[0]-N)*this.kx,F=(a[1]-I)*this.ky;const O=z*z+F*F;O<h&&(h=O,v=N,f=I,x=L,P=R)}return{point:[v,f],index:x,t:Math.max(0,Math.min(1,P))}}lineSlice(n,a,h){let v=this.pointOnLine(h,n),f=this.pointOnLine(h,a);if(v.index>f.index||v.index===f.index&&v.t>f.t){const N=v;v=f,f=N}const x=[v.point],P=v.index+1,L=f.index;!bh(h[P],x[0])&&P<=L&&x.push(h[P]);for(let N=P+1;N<=L;N++)x.push(h[N]);return bh(h[L],f.point)||x.push(f.point),x}lineSliceAlong(n,a,h){let v=0;const f=[];for(let x=0;x<h.length-1;x++){const P=h[x],L=h[x+1],N=this.distance(P,L);if(v+=N,v>n&&f.length===0&&f.push(Ds(P,L,(n-(v-N))/N)),v>=a)return f.push(Ds(P,L,(a-(v-N))/N)),f;v>n&&f.push(L)}return f}bufferPoint(n,a){const h=a/this.ky,v=a/this.kx;return[n[0]-v,n[1]-h,n[0]+v,n[1]+h]}bufferBBox(n,a){const h=a/this.ky,v=a/this.kx;return[n[0]-v,n[1]-h,n[2]+v,n[3]+h]}insideBBox(n,a){return Rs(n[0]-a[0])>=0&&Rs(n[0]-a[2])<=0&&n[1]>=a[1]&&n[1]<=a[3]}}function bh(c,n){return c[0]===n[0]&&c[1]===n[1]}function Ds(c,n,a){const h=Rs(n[0]-c[0]);return[c[0]+h*a,c[1]+(n[1]-c[1])*a]}function Rs(c){for(;c<-180;)c+=360;for(;c>180;)c-=360;return c}class sd{constructor(n=[],a=(h,v)=>h<v?-1:h>v?1:0){if(this.data=n,this.length=this.data.length,this.compare=a,this.length>0)for(let h=(this.length>>1)-1;h>=0;h--)this._down(h)}push(n){this.data.push(n),this._up(this.length++)}pop(){if(this.length===0)return;const n=this.data[0],a=this.data.pop();return--this.length>0&&(this.data[0]=a,this._down(0)),n}peek(){return this.data[0]}_up(n){const{data:a,compare:h}=this,v=a[n];for(;n>0;){const f=n-1>>1,x=a[f];if(h(v,x)>=0)break;a[n]=x,n=f}a[n]=v}_down(n){const{data:a,compare:h}=this,v=this.length>>1,f=a[n];for(;n<v;){let x=1+(n<<1);const P=x+1;if(P<this.length&&h(a[P],a[x])<0&&(x=P),h(a[x],f)>=0)break;a[n]=a[x],n=x}a[n]=f}}var mi=8192;function wh(c,n){return n.dist-c.dist}const Oc=100,Zs=50;function Gu(c){const n=[1/0,1/0,-1/0,-1/0];if(n.length!==c.length)return!1;for(let a=0;a<n.length;a++)if(n[a]!==c[a])return!1;return!0}function od(c){return c[1]-c[0]+1}function oa(c,n){const a=c[1]>=c[0]&&c[1]<n;return a||console.warn("Distance Expression: Index is out of range"),a}function ld(c,n){if(c[0]>c[1])return[null,null];const a=od(c);if(n){if(a===2)return[c,null];const h=Math.floor(a/2);return[[c[0],c[0]+h],[c[0]+h,c[1]]]}{if(a===1)return[c,null];const h=Math.floor(a/2)-1;return[[c[0],c[0]+h],[c[0]+h+1,c[1]]]}}function qu(c,n){const a=[1/0,1/0,-1/0,-1/0];if(!oa(n,c.length))return a;for(let h=n[0];h<=n[1];++h)rd(a,c[h]);return a}function cd(c){const n=[1/0,1/0,-1/0,-1/0];for(let a=0;a<c.length;++a)for(let h=0;h<c[a].length;++h)rd(n,c[a][h]);return n}function Sh(c,n,a){if(Gu(c)||Gu(n))return NaN;let h=0,v=0;return c[2]<n[0]&&(h=n[0]-c[2]),c[0]>n[2]&&(h=c[0]-n[2]),c[1]>n[3]&&(v=c[1]-n[3]),c[3]<n[1]&&(v=n[1]-c[3]),a.distance([0,0],[h,v])}function Ng(c){return 360*c-180}function Um(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function ud(c,n){const a=Math.pow(2,n.z),h=(c.y/mi+n.y)/a;return[Ng((c.x/mi+n.x)/a),Um(h)]}function Yd(c,n){const a=[];for(let h=0;h<c.length;++h)a.push(ud(c[h],n));return a}function Kd(c,n,a){const h=a.pointOnLine(n,c).point;return a.distance(c,h)}function Yf(c,n,a,h,v){const f=a.slice(h[0],h[1]+1);let x=1/0;for(let P=n[0];P<=n[1];++P)if((x=Math.min(x,Kd(c[P],f,v)))===0)return 0;return x}function Fc(c,n,a,h,v){const f=Math.min(v.pointToSegmentDistance(c,a,h),v.pointToSegmentDistance(n,a,h)),x=Math.min(v.pointToSegmentDistance(a,c,n),v.pointToSegmentDistance(h,c,n));return Math.min(f,x)}function Kl(c,n,a,h,v){if(!oa(n,c.length)||!oa(h,a.length))return NaN;let f=1/0;for(let x=n[0];x<n[1];++x)for(let P=h[0];P<h[1];++P){if(Wd(c[x],c[x+1],a[P],a[P+1]))return 0;f=Math.min(f,Fc(c[x],c[x+1],a[P],a[P+1],v))}return f}function Jl(c,n,a,h,v){if(!oa(n,c.length)||!oa(h,a.length))return NaN;let f=1/0;for(let x=n[0];x<=n[1];++x)for(let P=h[0];P<=h[1];++P)if((f=Math.min(f,v.distance(c[x],a[P])))===0)return f;return f}function $m(c,n,a){if(Dl(c,n,!0))return 0;let h=1/0;for(const v of n){const f=v.length;if(f<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(v[0]!==v[f-1]&&(h=Math.min(h,a.pointToSegmentDistance(c,v[f-1],v[0])))===0||(h=Math.min(h,Kd(c,v,a)))===0)return h}return h}function Kf(c,n,a,h){if(!oa(n,c.length))return NaN;for(let f=n[0];f<=n[1];++f)if(Dl(c[f],a,!0))return 0;let v=1/0;for(let f=n[0];f<n[1];++f)for(const x of a)for(let P=0,L=x.length,N=L-1;P<L;N=P++){if(Wd(c[f],c[f+1],x[N],x[P]))return 0;v=Math.min(v,Fc(c[f],c[f+1],x[N],x[P],h))}return v}function Jd(c,n){for(const a of c)for(let h=0;h<=a.length-1;++h)if(Dl(a[h],n,!0))return!0;return!1}function Hu(c,n,a,h=1/0){const v=cd(c),f=cd(n);if(h!==1/0&&Sh(v,f,a)>=h)return h;if(gc(v,f)){if(Jd(c,n))return 0}else if(Jd(n,c))return 0;let x=h;for(const P of c)for(let L=0,N=P.length,I=N-1;L<N;I=L++)for(const z of n)for(let F=0,R=z.length,O=R-1;F<R;O=F++){if(Wd(P[I],P[L],z[O],z[F]))return 0;x=Math.min(x,Fc(P[I],P[L],z[O],z[F],a))}return x}function Do(c,n,a,h,v,f,x){if(f===null||x===null)return;const P=Sh(qu(h,f),qu(v,x),a);P<n&&c.push({dist:P,range1:f,range2:x})}function Qd(c,n,a,h,v=1/0){let f=Math.min(h.distance(c[0],a[0][0]),v);if(f===0)return f;const x=new sd([{dist:0,range1:[0,c.length-1],range2:[0,0]}],wh),P=n?Zs:Oc,L=cd(a);for(;x.length;){const N=x.pop();if(N.dist>=f)continue;const I=N.range1;if(od(I)<=P){if(!oa(I,c.length))return NaN;if(n){const z=Kf(c,I,a,h);if((f=Math.min(f,z))===0)return f}else for(let z=I[0];z<=I[1];++z){const F=$m(c[z],a,h);if((f=Math.min(f,F))===0)return f}}else{const z=ld(I,n);if(z[0]!==null){const F=Sh(qu(c,z[0]),L,h);F<f&&x.push({dist:F,range1:z[0],range2:[0,0]})}if(z[1]!==null){const F=Sh(qu(c,z[1]),L,h);F<f&&x.push({dist:F,range1:z[1],range2:[0,0]})}}}return f}function Th(c,n,a,h,v,f=1/0){let x=Math.min(f,v.distance(c[0],a[0]));if(x===0)return x;const P=new sd([{dist:0,range1:[0,c.length-1],range2:[0,a.length-1]}],wh),L=n?Zs:Oc,N=h?Zs:Oc;for(;P.length;){const I=P.pop();if(I.dist>=x)continue;const z=I.range1,F=I.range2;if(od(z)<=L&&od(F)<=N){if(!oa(z,c.length)||!oa(F,a.length))return NaN;if(n&&h?x=Math.min(x,Kl(c,z,a,F,v)):n||h?n&&!h?x=Math.min(x,Yf(a,F,c,z,v)):!n&&h&&(x=Math.min(x,Yf(c,z,a,F,v))):x=Math.min(x,Jl(c,z,a,F,v)),x===0)return x}else{const R=ld(z,n),O=ld(F,h);Do(P,x,v,c,a,R[0],O[0]),Do(P,x,v,c,a,R[0],O[1]),Do(P,x,v,c,a,R[1],O[0]),Do(P,x,v,c,a,R[1],O[1])}}return x}function Ch(c,n,a,h,v=1/0){let f=v;const x=qu(c,[0,c.length-1]);for(const P of a)if(!(f!==1/0&&Sh(x,qu(P,[0,P.length-1]),h)>=f)&&(f=Math.min(f,Th(c,n,P,!0,h,f)),f===0))return f;return f}function hd(c,n,a,h,v=1/0){let f=v;const x=qu(c,[0,c.length-1]);for(const P of a){if(f!==1/0&&Sh(x,cd(P),h)>=f)continue;const L=Qd(c,n,P,h,f);if(isNaN(L))return L;if((f=Math.min(f,L))===0)return f}return f}function fu(c){return c==="Point"||c==="MultiPoint"||c==="LineString"||c==="MultiLineString"||c==="Polygon"||c==="MultiPolygon"}class Ll{constructor(n,a){this.type=hi,this.geojson=n,this.geometries=a}static parse(n,a){if(n.length!==2)return a.error(`'distance' expression requires either one argument, but found ' ${n.length-1} instead.`);if(fs(n[1])){const h=n[1];if(h.type==="FeatureCollection"){for(let v=0;v<h.features.length;++v)if(fu(h.features[v].geometry.type))return new Ll(h,h.features[v].geometry)}else if(h.type==="Feature"){if(fu(h.geometry.type))return new Ll(h,h.geometry)}else if(fu(h.type))return new Ll(h,h)}return a.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(n){const a=n.geometry(),h=n.canonicalID();if(a!=null&&h!=null){if(n.geometryType()==="Point")return function(v,f,x){const P=[];for(const N of v)for(const I of N)P.push(ud(I,f));const L=new $u(P[0][1],"meters");return x.type==="Point"||x.type==="MultiPoint"||x.type==="LineString"?Th(P,!1,x.type==="Point"?[x.coordinates]:x.coordinates,x.type==="LineString",L):x.type==="MultiLineString"?Ch(P,!1,x.coordinates,L):x.type==="Polygon"||x.type==="MultiPolygon"?hd(P,!1,x.type==="Polygon"?[x.coordinates]:x.coordinates,L):null}(a,h,this.geometries);if(n.geometryType()==="LineString")return function(v,f,x){const P=[];for(const N of v){const I=[];for(const z of N)I.push(ud(z,f));P.push(I)}const L=new $u(P[0][0][1],"meters");if(x.type==="Point"||x.type==="MultiPoint"||x.type==="LineString")return Ch(x.type==="Point"?[x.coordinates]:x.coordinates,x.type==="LineString",P,L);if(x.type==="MultiLineString"){let N=1/0;for(let I=0;I<x.coordinates.length;I++){const z=Ch(x.coordinates[I],!0,P,L,N);if(isNaN(z))return z;if((N=Math.min(N,z))===0)return N}return N}if(x.type==="Polygon"||x.type==="MultiPolygon"){let N=1/0;for(let I=0;I<P.length;I++){const z=hd(P[I],!0,x.type==="Polygon"?[x.coordinates]:x.coordinates,L,N);if(isNaN(z))return z;if((N=Math.min(N,z))===0)return N}return N}return null}(a,h,this.geometries);if(n.geometryType()==="Polygon")return function(v,f,x){const P=[];for(const N of function(I,z){const F=I.length;if(F<=1)return[I];const R=[];let O,q;for(let te=0;te<F;te++){const ae=Wf(I[te]);ae!==0&&(I[te].area=Math.abs(ae),q===void 0&&(q=ae<0),q===ae<0?(O&&R.push(O),O=[I[te]]):O.push(I[te]))}return O&&R.push(O),R}(v)){const I=[];for(let z=0;z<N.length;++z)I.push(Yd(N[z],f));P.push(I)}const L=new $u(P[0][0][0][1],"meters");if(x.type==="Point"||x.type==="MultiPoint"||x.type==="LineString")return hd(x.type==="Point"?[x.coordinates]:x.coordinates,x.type==="LineString",P,L);if(x.type==="MultiLineString"){let N=1/0;for(let I=0;I<x.coordinates.length;I++){const z=hd(x.coordinates[I],!0,P,L,N);if(isNaN(z))return z;if((N=Math.min(N,z))===0)return N}return N}return x.type==="Polygon"||x.type==="MultiPolygon"?function(N,I,z){let F=1/0;for(const R of N)for(const O of I){const q=Hu(R,O,z,F);if(isNaN(q))return q;if((F=Math.min(F,q))===0)return F}return F}(x.type==="Polygon"?[x.coordinates]:x.coordinates,P,L):null}(a,h,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function ef(c,n){switch(c){case"string":return _o(n);case"number":return+n;case"boolean":return!!n;case"color":return Or.parse(n);case"formatted":return Yr.fromString(_o(n));case"resolvedImage":return Oa.build(_o(n))}return n}function tf(c,n,a,h){return h!==void 0&&(c=h*Math.round(c/h)),n!==void 0&&c<n&&(c=n),a!==void 0&&c>a&&(c=a),c}class aa{constructor(n,a,h){this.type=n,this.key=a,this.scope=h}static parse(n,a){let h=a.expectedType;if(h==null&&(h=Hi),n.length<2||n.length>3)return a.error("Invalid number of arguments for 'config' expression.");const v=a.parse(n[1],1);if(!(v instanceof Il))return a.error("Key name of 'config' expression must be a string literal.");if(n.length>=3){const f=a.parse(n[2],2);return f instanceof Il?new aa(h,_o(v.value),_o(f.value)):a.error("Scope of 'config' expression must be a string literal.")}return new aa(h,_o(v.value))}evaluate(n){const a=[this.key,this.scope,n.scope].filter(Boolean).join(""),h=n.getConfig(a);if(!h)return null;const{type:v,value:f,values:x,minValue:P,maxValue:L,stepValue:N}=h,I=h.default.evaluate(n);let z=I;if(f){const F=n.scope;n.scope=(F||"").split("").slice(1).join(""),z=f.evaluate(n),n.scope=F}return v&&(z=ef(v,z)),z===void 0||P===void 0&&L===void 0&&N===void 0||(typeof z=="number"?z=tf(z,P,L,N):Array.isArray(z)&&(z=z.map(F=>typeof F=="number"?tf(F,P,L,N):F))),f!==void 0&&z!==void 0&&x&&!x.includes(z)&&(z=I,v&&(z=ef(v,z))),(v&&v!==this.type||z!==void 0&&Ca(z)!==this.type)&&(z=ef(this.type.kind,z)),z}eachChild(){}outputDefined(){return!1}serialize(){const n=["config",this.key];return this.scope&&n.concat(this.key),n}}function pu(c){if(c instanceof ps&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof du||c instanceof Ll)return!1;let n=!0;return c.eachChild(a=>{n&&!pu(a)&&(n=!1)}),n}function nf(c){if(c instanceof ps&&c.name==="feature-state")return!1;let n=!0;return c.eachChild(a=>{n&&!nf(a)&&(n=!1)}),n}function Zu(c){if(c instanceof aa)return new Set([c.key]);let n=new Set;return c.eachChild(a=>{n=new Set([...n,...Zu(a)])}),n}function zl(c,n){if(c instanceof ps&&n.indexOf(c.name)>=0)return!1;let a=!0;return c.eachChild(h=>{a&&!zl(h,n)&&(a=!1)}),a}class mu{constructor(n,a){this.type=a.type,this.name=n,this.boundExpression=a}static parse(n,a){if(n.length!==2||typeof n[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");const h=n[1];return a.scope.has(h)?new mu(h,a.scope.get(h)):a.error(`Unknown variable "${h}". Make sure "${h}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(n){return this.boundExpression.evaluate(n)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Jf{constructor(n,a=[],h,v=new fc,f=[],x,P){this.registry=n,this.path=a,this.key=a.map(L=>typeof L=="string"?`['${L}']`:`[${L}]`).join(""),this.scope=v,this.errors=f,this.expectedType=h,this._scope=x,this.options=P}parse(n,a,h,v,f={}){return a||h?this.concat(a,null,h,v)._parse(n,f):this._parse(n,f)}parseObjectValue(n,a,h,v,f,x={}){return this.concat(a,h,v,f)._parse(n,x)}_parse(n,a){function h(v,f,x){return x==="assert"?new pl(f,[v]):x==="coerce"?new kl(f,[v]):v}if(n!==null&&typeof n!="string"&&typeof n!="boolean"&&typeof n!="number"||(n=["literal",n]),Array.isArray(n)){if(n.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const v=typeof n[0]=="string"?this.registry[n[0]]:void 0;if(v){let f=v.parse(n,this);if(!f)return null;if(this.expectedType){const x=this.expectedType,P=f.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||P.kind!=="value")if(x.kind!=="color"&&x.kind!=="formatted"&&x.kind!=="resolvedImage"||P.kind!=="value"&&P.kind!=="string"){if(this.checkSubtype(x,P))return null}else f=h(f,x,a.typeAnnotation||"coerce");else f=h(f,x,a.typeAnnotation||"assert")}if(!(f instanceof Il)&&f.type.kind!=="resolvedImage"&&ep(f)){const x=new td(this._scope,this.options);try{f=new Il(f.type,f.evaluate(x))}catch(P){return this.error(P.message),null}}return f}return kl.parse(["to-array",n],this)}return this.error(n===void 0?"'undefined' value invalid. Use null instead.":typeof n=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof n} instead.`)}concat(n,a,h,v){let f=typeof n=="number"?this.path.concat(n):this.path;f=typeof a=="string"?f.concat(a):f;const x=v?this.scope.concat(v):this.scope;return new Jf(this.registry,f,h||null,x,this.errors,this._scope,this.options)}error(n,...a){const h=`${this.key}${a.map(v=>`[${v}]`).join("")}`;this.errors.push(new fl(h,n))}checkSubtype(n,a){const h=Qh(n,a);return h&&this.error(h),h}}var Qf=Jf;function ep(c){if(c instanceof mu)return ep(c.boundExpression);if(c instanceof ps&&c.name==="error"||c instanceof nd||c instanceof du||c instanceof Ll||c instanceof aa)return!1;const n=c instanceof kl||c instanceof pl;let a=!0;return c.eachChild(h=>{a=n?a&&ep(h):a&&h instanceof Il}),!!a&&pu(c)&&zl(c,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Ql(c,n){const a=c.length-1;let h,v,f=0,x=a,P=0;for(;f<=x;)if(P=Math.floor((f+x)/2),h=c[P],v=c[P+1],h<=n){if(P===a||n<v)return P;f=P+1}else{if(!(h>n))throw new ws("Input is not a number.");x=P-1}return 0}class Rr{constructor(n,a,h){this.type=n,this.input=a,this.labels=[],this.outputs=[];for(const[v,f]of h)this.labels.push(v),this.outputs.push(f)}static parse(n,a){if(n.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if((n.length-1)%2!=0)return a.error("Expected an even number of arguments.");const h=a.parse(n[1],1,hi);if(!h)return null;const v=[];let f=null;a.expectedType&&a.expectedType.kind!=="value"&&(f=a.expectedType);for(let x=1;x<n.length;x+=2){const P=x===1?-1/0:n[x],L=n[x+1],N=x,I=x+1;if(typeof P!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',N);if(v.length&&v[v.length-1][0]>=P)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',N);const z=a.parse(L,I,f);if(!z)return null;f=f||z.type,v.push([P,z])}return new Rr(f,h,v)}evaluate(n){const a=this.labels,h=this.outputs;if(a.length===1)return h[0].evaluate(n);const v=this.input.evaluate(n);if(v<=a[0])return h[0].evaluate(n);const f=a.length;return v>=a[f-1]?h[f-1].evaluate(n):h[Ql(a,v)].evaluate(n)}eachChild(n){n(this.input);for(const a of this.outputs)n(a)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){const n=["step",this.input.serialize()];for(let a=0;a<this.labels.length;a++)a>0&&n.push(this.labels[a]),n.push(this.outputs[a].serialize());return n}}const rf=.95047,Eh=1.08883,af=4/29,Wu=6/29,sf=3*Wu*Wu,ga=Wu*Wu*Wu,Kp=Math.PI/180,jg=180/Math.PI;function dd(c){return c>ga?Math.pow(c,1/3):c/sf+af}function tp(c){return c>Wu?c*c*c:sf*(c-af)}function np(c){return 255*(c<=.0031308?12.92*c:1.055*Math.pow(c,1/2.4)-.055)}function fd(c){return(c/=255)<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function of(c){const n=fd(c.r),a=fd(c.g),h=fd(c.b),v=dd((.4124564*n+.3575761*a+.1804375*h)/rf),f=dd((.2126729*n+.7151522*a+.072175*h)/1);return{l:116*f-16,a:500*(v-f),b:200*(f-dd((.0193339*n+.119192*a+.9503041*h)/Eh)),alpha:c.a}}function ip(c){let n=(c.l+16)/116,a=isNaN(c.a)?n:n+c.a/500,h=isNaN(c.b)?n:n-c.b/200;return n=1*tp(n),a=rf*tp(a),h=Eh*tp(h),new Or(np(3.2404542*a-1.5371385*n-.4985314*h),np(-.969266*a+1.8760108*n+.041556*h),np(.0556434*a-.2040259*n+1.0572252*h),c.alpha)}function Jp(c,n,a){const h=n-c;return c+a*(h>180||h<-180?h-360*Math.round(h/360):h)}const gu={forward:of,reverse:ip,interpolate:function(c,n,a){return{l:ir(c.l,n.l,a),a:ir(c.a,n.a,a),b:ir(c.b,n.b,a),alpha:ir(c.alpha,n.alpha,a)}}},_u={forward:function(c){const{l:n,a,b:h}=of(c),v=Math.atan2(h,a)*jg;return{h:v<0?v+360:v,c:Math.sqrt(a*a+h*h),l:n,alpha:c.a}},reverse:function(c){const n=c.h*Kp,a=c.c;return ip({l:c.l,a:Math.cos(n)*a,b:Math.sin(n)*a,alpha:c.alpha})},interpolate:function(c,n,a){return{h:Jp(c.h,n.h,a),c:ir(c.c,n.c,a),l:ir(c.l,n.l,a),alpha:ir(c.alpha,n.alpha,a)}}};var rp=Object.freeze({__proto__:null,hcl:_u,lab:gu});class Ro{constructor(n,a,h,v,f,x){this.type=n,this.operator=a,this.interpolation=h,this.input=v,this.dynamicStops=f,this.labels=[],this.outputs=[];for(const[P,L]of x)this.labels.push(P),this.outputs.push(L)}static interpolationFactor(n,a,h,v){let f=0;if(n.name==="exponential")f=ns(a,n.base,h,v);else if(n.name==="linear")f=ns(a,1,h,v);else if(n.name==="cubic-bezier"){const x=n.controlPoints;f=new St(x[0],x[1],x[2],x[3]).solve(ns(a,1,h,v))}return f}static parse(n,a){let[h,v,f,...x]=n;if(!Array.isArray(v)||v.length===0)return a.error("Expected an interpolation type expression.",1);if(v[0]==="linear")v={name:"linear"};else if(v[0]==="exponential"){const N=v[1];if(typeof N!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);v={name:"exponential",base:N}}else{if(v[0]!=="cubic-bezier")return a.error(`Unknown interpolation type ${String(v[0])}`,1,0);{const N=v.slice(1);if(N.length!==4||N.some(I=>typeof I!="number"||I<0||I>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);v={name:"cubic-bezier",controlPoints:N}}}if(n.length-1<3)return a.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length-1>3&&(n.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(f=a.parse(f,2,hi),!f)return null;const P=[];let L=null;if(h==="interpolate-hcl"||h==="interpolate-lab"?L=Sr:a.expectedType&&a.expectedType.kind!=="value"&&(L=a.expectedType),n.length-1==3){const N=a.parse(x[0],3,Hi);return N?new Ro(L,h,v,f,N,P):null}for(let N=0;N<x.length;N+=2){const I=x[N],z=x[N+1],F=N+3,R=N+4;if(typeof I!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(P.length&&P[P.length-1][0]>=I)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',F);const O=a.parse(z,R,L);if(!O)return null;L=L||O.type,P.push([I,O])}return L.kind==="number"||L.kind==="color"||L.kind==="array"&&L.itemType.kind==="number"&&typeof L.N=="number"?new Ro(L,h,v,f,null,P):a.error(`Type ${ca(L)} is not interpolatable.`)}evaluate(n){let a=this.labels,h=this.outputs;if(this.dynamicStops){const I=this.dynamicStops.evaluate(n);if(I.length%2!=0)throw new ws("Expected an even number of arguments.");a=[],h=[];for(let z=0;z<I.length;z+=2){const F=I[z],R=new Il(hi,I[z+1]);if(typeof F!="number")throw new ws('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.');if(a.length&&a[a.length-1]>=F)throw new ws('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.');a.push(F),h.push(R)}if(a.length===0)throw new ws("Expected at least one input/output pair.")}if(a.length===1)return h[0].evaluate(n);const v=this.input.evaluate(n);if(v<=a[0])return h[0].evaluate(n);const f=a.length;if(v>=a[f-1])return h[f-1].evaluate(n);const x=Ql(a,v),P=Ro.interpolationFactor(this.interpolation,v,a[x],a[x+1]),L=h[x].evaluate(n),N=h[x+1].evaluate(n);return this.operator==="interpolate"?Dr[this.type.kind.toLowerCase()](L,N,P):this.operator==="interpolate-hcl"?_u.reverse(_u.interpolate(_u.forward(L),_u.forward(N),P)):gu.reverse(gu.interpolate(gu.forward(L),gu.forward(N),P))}eachChild(n){n(this.input);for(const a of this.outputs)n(a)}outputDefined(){return this.outputs.every(n=>n.outputDefined())}serialize(){let n;n=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const a=[this.operator,n,this.input.serialize()];if(this.dynamicStops)a.push(this.dynamicStops.serialize());else for(let h=0;h<this.labels.length;h++)a.push(this.labels[h],this.outputs[h].serialize());return a}}function ns(c,n,a,h){const v=h-a,f=c-a;return v===0?0:n===1?f/v:(Math.pow(n,f)-1)/(Math.pow(n,v)-1)}class Bc{constructor(n,a){this.type=n,this.args=a}static parse(n,a){if(n.length<2)return a.error("Expectected at least one argument.");let h=null;const v=a.expectedType;v&&v.kind!=="value"&&(h=v);const f=[];for(const P of n.slice(1)){const L=a.parse(P,1+f.length,h,void 0,{typeAnnotation:"omit"});if(!L)return null;h=h||L.type,f.push(L)}const x=v&&f.some(P=>Qh(v,P.type));return new Bc(x?Hi:h,f)}evaluate(n){let a,h=null,v=0;for(const f of this.args){if(v++,h=f.evaluate(n),h&&h instanceof Oa&&!h.available&&(a||(a=h),h=null,v===this.args.length))return a;if(h!==null)break}return h}eachChild(n){this.args.forEach(n)}outputDefined(){return this.args.every(n=>n.outputDefined())}serialize(){const n=["coalesce"];return this.eachChild(a=>{n.push(a.serialize())}),n}}class tl{constructor(n,a){this.type=a.type,this.bindings=[].concat(n),this.result=a}evaluate(n){return this.result.evaluate(n)}eachChild(n){for(const a of this.bindings)n(a[1]);n(this.result)}static parse(n,a){if(n.length<4)return a.error(`Expected at least 3 arguments, but found ${n.length-1} instead.`);const h=[];for(let f=1;f<n.length-1;f+=2){const x=n[f];if(typeof x!="string")return a.error(`Expected string, but found ${typeof x} instead.`,f);if(/[^a-zA-Z0-9_]/.test(x))return a.error("Variable names must contain only alphanumeric characters or '_'.",f);const P=a.parse(n[f+1],f+1);if(!P)return null;h.push([x,P])}const v=a.parse(n[n.length-1],n.length-1,a.expectedType,h);return v?new tl(h,v):null}outputDefined(){return this.result.outputDefined()}serialize(){const n=["let"];for(const[a,h]of this.bindings)n.push(a,h.serialize());return n.push(this.result.serialize()),n}}class lf{constructor(n,a,h){this.type=n,this.index=a,this.input=h}static parse(n,a){if(n.length!==3)return a.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const h=a.parse(n[1],1,hi),v=a.parse(n[2],2,Ns(a.expectedType||Hi));return h&&v?new lf(v.type.itemType,h,v):null}evaluate(n){const a=this.index.evaluate(n),h=this.input.evaluate(n);if(a<0)throw new ws(`Array index out of bounds: ${a} < 0.`);if(a>h.length-1)throw new ws(`Array index out of bounds: ${a} > ${h.length-1}.`);if(a===Math.floor(a))return h[a];const v=Math.floor(a),f=Math.ceil(a),x=h[v],P=h[f];if(typeof x!="number"||typeof P!="number")throw new ws(`Cannot interpolate between non-number values at index ${a}.`);const L=a-v;return x*(1-L)+P*L}eachChild(n){n(this.index),n(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class cf{constructor(n,a){this.type=Wi,this.needle=n,this.haystack=a}static parse(n,a){if(n.length!==3)return a.error(`Expected 2 arguments, but found ${n.length-1} instead.`);const h=a.parse(n[1],1,Hi),v=a.parse(n[2],2,Hi);return h&&v?ed(h.type,[Wi,jr,hi,su,Hi])?new cf(h,v):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${ca(h.type)} instead`):null}evaluate(n){const a=this.needle.evaluate(n),h=this.haystack.evaluate(n);if(h==null)return!1;if(!Nu(a,["boolean","string","number","null"]))throw new ws(`Expected first argument to be of type boolean, string, number or null, but found ${ca(Ca(a))} instead.`);if(!Nu(h,["string","array"]))throw new ws(`Expected second argument to be of type array or string, but found ${ca(Ca(h))} instead.`);return h.indexOf(a)>=0}eachChild(n){n(this.needle),n(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class uf{constructor(n,a,h){this.type=hi,this.needle=n,this.haystack=a,this.fromIndex=h}static parse(n,a){if(n.length<=2||n.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const h=a.parse(n[1],1,Hi),v=a.parse(n[2],2,Hi);if(!h||!v)return null;if(!ed(h.type,[Wi,jr,hi,su,Hi]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${ca(h.type)} instead`);if(n.length===4){const f=a.parse(n[3],3,hi);return f?new uf(h,v,f):null}return new uf(h,v)}evaluate(n){const a=this.needle.evaluate(n),h=this.haystack.evaluate(n);if(!Nu(a,["boolean","string","number","null"]))throw new ws(`Expected first argument to be of type boolean, string, number or null, but found ${ca(Ca(a))} instead.`);if(!Nu(h,["string","array"]))throw new ws(`Expected second argument to be of type array or string, but found ${ca(Ca(h))} instead.`);if(this.fromIndex){const v=this.fromIndex.evaluate(n);return h.indexOf(a,v)}return h.indexOf(a)}eachChild(n){n(this.needle),n(this.haystack),this.fromIndex&&n(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const n=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),n]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Xu{constructor(n,a,h,v,f,x){this.inputType=n,this.type=a,this.input=h,this.cases=v,this.outputs=f,this.otherwise=x}static parse(n,a){if(n.length<5)return a.error(`Expected at least 4 arguments, but found only ${n.length-1}.`);if(n.length%2!=1)return a.error("Expected an even number of arguments.");let h,v;a.expectedType&&a.expectedType.kind!=="value"&&(v=a.expectedType);const f={},x=[];for(let N=2;N<n.length-1;N+=2){let I=n[N];const z=n[N+1];Array.isArray(I)||(I=[I]);const F=a.concat(N);if(I.length===0)return F.error("Expected at least one branch label.");for(const O of I){if(typeof O!="number"&&typeof O!="string")return F.error("Branch labels must be numbers or strings.");if(typeof O=="number"&&Math.abs(O)>Number.MAX_SAFE_INTEGER)return F.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof O=="number"&&Math.floor(O)!==O)return F.error("Numeric branch labels must be integer values.");if(h){if(F.checkSubtype(h,Ca(O)))return null}else h=Ca(O);if(f[String(O)]!==void 0)return F.error("Branch labels must be unique.");f[String(O)]=x.length}const R=a.parse(z,N,v);if(!R)return null;v=v||R.type,x.push(R)}const P=a.parse(n[1],1,Hi);if(!P)return null;const L=a.parse(n[n.length-1],n.length-1,v);return L?P.type.kind!=="value"&&a.concat(1).checkSubtype(h,P.type)?null:new Xu(h,v,P,f,x,L):null}evaluate(n){const a=this.input.evaluate(n);return(Ca(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(n)}eachChild(n){n(this.input),this.outputs.forEach(n),n(this.otherwise)}outputDefined(){return this.outputs.every(n=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["match",this.input.serialize()],a=Object.keys(this.cases).sort(),h=[],v={};for(const x of a){const P=v[this.cases[x]];P===void 0?(v[this.cases[x]]=h.length,h.push([this.cases[x],[x]])):h[P][1].push(x)}const f=x=>this.inputType.kind==="number"?Number(x):x;for(const[x,P]of h)n.push(P.length===1?f(P[0]):P.map(f)),n.push(this.outputs[x].serialize());return n.push(this.otherwise.serialize()),n}}class Yu{constructor(n,a,h){this.type=n,this.branches=a,this.otherwise=h}static parse(n,a){if(n.length<4)return a.error(`Expected at least 3 arguments, but found only ${n.length-1}.`);if(n.length%2!=0)return a.error("Expected an odd number of arguments.");let h;a.expectedType&&a.expectedType.kind!=="value"&&(h=a.expectedType);const v=[];for(let x=1;x<n.length-1;x+=2){const P=a.parse(n[x],x,Wi);if(!P)return null;const L=a.parse(n[x+1],x+1,h);if(!L)return null;v.push([P,L]),h=h||L.type}const f=a.parse(n[n.length-1],n.length-1,h);return f?new Yu(h,v,f):null}evaluate(n){for(const[a,h]of this.branches)if(a.evaluate(n))return h.evaluate(n);return this.otherwise.evaluate(n)}eachChild(n){for(const[a,h]of this.branches)n(a),n(h);n(this.otherwise)}outputDefined(){return this.branches.every(([n,a])=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){const n=["case"];return this.eachChild(a=>{n.push(a.serialize())}),n}}class Mh{constructor(n,a,h,v){this.type=n,this.input=a,this.beginIndex=h,this.endIndex=v}static parse(n,a){if(n.length<=2||n.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${n.length-1} instead.`);const h=a.parse(n[1],1,Hi),v=a.parse(n[2],2,hi);if(!h||!v)return null;if(!ed(h.type,[Ns(Hi),jr,Hi]))return a.error(`Expected first argument to be of type array or string, but found ${ca(h.type)} instead`);if(n.length===4){const f=a.parse(n[3],3,hi);return f?new Mh(h.type,h,v,f):null}return new Mh(h.type,h,v)}evaluate(n){const a=this.input.evaluate(n),h=this.beginIndex.evaluate(n);if(!Nu(a,["string","array"]))throw new ws(`Expected first argument to be of type array or string, but found ${ca(Ca(a))} instead.`);if(this.endIndex){const v=this.endIndex.evaluate(n);return a.slice(h,v)}return a.slice(h)}eachChild(n){n(this.input),n(this.beginIndex),this.endIndex&&n(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const n=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),n]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function pd(c,n){return c==="=="||c==="!="?n.kind==="boolean"||n.kind==="string"||n.kind==="number"||n.kind==="null"||n.kind==="value":n.kind==="string"||n.kind==="number"||n.kind==="value"}function Qp(c,n,a,h){return h.compare(n,a)===0}function Ku(c,n,a){const h=c!=="=="&&c!=="!=";return class _R{constructor(f,x,P){this.type=Wi,this.lhs=f,this.rhs=x,this.collator=P,this.hasUntypedArgument=f.type.kind==="value"||x.type.kind==="value"}static parse(f,x){if(f.length!==3&&f.length!==4)return x.error("Expected two or three arguments.");const P=f[0];let L=x.parse(f[1],1,Hi);if(!L)return null;if(!pd(P,L.type))return x.concat(1).error(`"${P}" comparisons are not supported for type '${ca(L.type)}'.`);let N=x.parse(f[2],2,Hi);if(!N)return null;if(!pd(P,N.type))return x.concat(2).error(`"${P}" comparisons are not supported for type '${ca(N.type)}'.`);if(L.type.kind!==N.type.kind&&L.type.kind!=="value"&&N.type.kind!=="value")return x.error(`Cannot compare types '${ca(L.type)}' and '${ca(N.type)}'.`);h&&(L.type.kind==="value"&&N.type.kind!=="value"?L=new pl(N.type,[L]):L.type.kind!=="value"&&N.type.kind==="value"&&(N=new pl(L.type,[N])));let I=null;if(f.length===4){if(L.type.kind!=="string"&&N.type.kind!=="string"&&L.type.kind!=="value"&&N.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(I=x.parse(f[3],3,ou),!I)return null}return new _R(L,N,I)}evaluate(f){const x=this.lhs.evaluate(f),P=this.rhs.evaluate(f);if(h&&this.hasUntypedArgument){const L=Ca(x),N=Ca(P);if(L.kind!==N.kind||L.kind!=="string"&&L.kind!=="number")throw new ws(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${L.kind}, ${N.kind}) instead.`)}if(this.collator&&!h&&this.hasUntypedArgument){const L=Ca(x),N=Ca(P);if(L.kind!=="string"||N.kind!=="string")return n(f,x,P)}return this.collator?a(f,x,P,this.collator.evaluate(f)):n(f,x,P)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[c];return this.eachChild(x=>{f.push(x.serialize())}),f}}}const em=Ku("==",function(c,n,a){return n===a},Qp),Gm=Ku("!=",function(c,n,a){return n!==a},function(c,n,a,h){return!Qp(0,n,a,h)}),Ju=Ku("<",function(c,n,a){return n<a},function(c,n,a,h){return h.compare(n,a)<0}),tm=Ku(">",function(c,n,a){return n>a},function(c,n,a,h){return h.compare(n,a)>0}),md=Ku("<=",function(c,n,a){return n<=a},function(c,n,a,h){return h.compare(n,a)<=0}),qm=Ku(">=",function(c,n,a){return n>=a},function(c,n,a,h){return h.compare(n,a)>=0});class gd{constructor(n,a,h,v,f,x){this.type=jr,this.number=n,this.locale=a,this.currency=h,this.unit=v,this.minFractionDigits=f,this.maxFractionDigits=x}static parse(n,a){if(n.length!==3)return a.error("Expected two arguments.");const h=a.parse(n[1],1,hi);if(!h)return null;const v=n[2];if(typeof v!="object"||Array.isArray(v))return a.error("NumberFormat options argument must be an object.");let f=null;if(v.locale&&(f=a.parseObjectValue(v.locale,2,"locale",jr),!f))return null;let x=null;if(v.currency&&(x=a.parseObjectValue(v.currency,2,"currency",jr),!x))return null;let P=null;if(v.unit&&(P=a.parseObjectValue(v.unit,2,"unit",jr),!P))return null;let L=null;if(v["min-fraction-digits"]&&(L=a.parseObjectValue(v["min-fraction-digits"],2,"min-fraction-digits",hi),!L))return null;let N=null;return v["max-fraction-digits"]&&(N=a.parseObjectValue(v["max-fraction-digits"],2,"max-fraction-digits",hi),!N)?null:new gd(h,f,x,P,L,N)}evaluate(n){return new Intl.NumberFormat(this.locale?this.locale.evaluate(n):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(n):void 0,unit:this.unit?this.unit.evaluate(n):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(n):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(n):void 0}).format(this.number.evaluate(n))}eachChild(n){n(this.number),this.locale&&n(this.locale),this.currency&&n(this.currency),this.unit&&n(this.unit),this.minFractionDigits&&n(this.minFractionDigits),this.maxFractionDigits&&n(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const n={};return this.locale&&(n.locale=this.locale.serialize()),this.currency&&(n.currency=this.currency.serialize()),this.unit&&(n.unit=this.unit.serialize()),this.minFractionDigits&&(n["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(n["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),n]}}class ap{constructor(n){this.type=hi,this.input=n}static parse(n,a){if(n.length!==2)return a.error(`Expected 1 argument, but found ${n.length-1} instead.`);const h=a.parse(n[1],1);return h?h.type.kind!=="array"&&h.type.kind!=="string"&&h.type.kind!=="value"?a.error(`Expected argument of type string or array, but found ${ca(h.type)} instead.`):new ap(h):null}evaluate(n){const a=this.input.evaluate(n);if(typeof a=="string"||Array.isArray(a))return a.length;throw new ws(`Expected value to be of type string or array, but found ${ca(Ca(a))} instead.`)}eachChild(n){n(this.input)}outputDefined(){return!1}serialize(){const n=["length"];return this.eachChild(a=>{n.push(a.serialize())}),n}}function sp(c){return function(){c=1831565813+(c|=0)|0;let n=Math.imul(c^c>>>15,1|c);return n=n+Math.imul(n^n>>>7,61|n)^n,((n^n>>>14)>>>0)/4294967296}}const Ih={"==":em,"!=":Gm,">":tm,"<":Ju,">=":qm,"<=":md,array:pl,at:lf,boolean:pl,case:Yu,coalesce:Bc,collator:nd,format:cu,image:uu,in:cf,"index-of":uf,interpolate:Ro,"interpolate-hcl":Ro,"interpolate-lab":Ro,length:ap,let:tl,literal:Il,match:Xu,number:pl,"number-format":gd,object:pl,slice:Mh,step:Rr,string:pl,"to-boolean":kl,"to-color":kl,"to-number":kl,"to-string":kl,var:mu,within:du,distance:Ll,config:aa};function _d(c,[n,a,h,v]){n=n.evaluate(c),a=a.evaluate(c),h=h.evaluate(c);const f=v?v.evaluate(c):1,x=Ml(n,a,h,f);if(x)throw new ws(x);return new Or(n/255*f,a/255*f,h/255*f,f)}function Ph(c,[n,a,h,v]){n=n.evaluate(c),a=a.evaluate(c),h=h.evaluate(c);const f=v?v.evaluate(c):1,x=function(N,I,z,F){return typeof N=="number"&&N>=0&&N<=360?typeof I=="number"&&I>=0&&I<=100&&typeof z=="number"&&z>=0&&z<=100?F===void 0||typeof F=="number"&&F>=0&&F<=1?null:`Invalid hsla value [${[N,I,z,F].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof F=="number"?[N,I,z,F]:[N,I,z]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof F=="number"?[N,I,z,F]:[N,I,z]).join(", ")}]: 'h' must be between 0 and 360.`}(n,a,h,f);if(x)throw new ws(x);const P=`hsla(${n}, ${a}%, ${h}%, ${f})`,L=Or.parse(P);if(!L)throw new ws(`Failed to parse HSLA color: ${P}`);return L}function Lo(c,n){return c in n}function ms(c,n){const a=n[c];return a===void 0?null:a}function zo(c){return{type:c}}function Ol(c){return{result:"success",value:c}}function ml(c){return{result:"error",value:c}}function nm(c,n){return!!c&&!!c.parameters&&c.parameters.indexOf(n)>-1}function Vc(c){return c["property-type"]==="data-driven"}function hf(c){return nm(c.expression,"measure-light")}function op(c){return nm(c.expression,"zoom")}function lp(c){return!!c.expression&&c.expression.interpolated}function Nc(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function jc(c){return c}function Yi(c,n){const a=n.type==="color",h=c.stops&&typeof c.stops[0][0]=="object",v=h||!(h||c.property!==void 0),f=c.type||(lp(n)?"exponential":"interval");if(a&&((c=Qo({},c)).stops&&(c.stops=c.stops.map(N=>[N[0],Or.parse(N[1])])),c.default=Or.parse(c.default?c.default:n.default)),c.colorSpace&&c.colorSpace!=="rgb"&&!rp[c.colorSpace])throw new Error(`Unknown color space: ${c.colorSpace}`);let x,P,L;if(f==="exponential")x=kh;else if(f==="interval")x=im;else if(f==="categorical"){x=Ah,P=Object.create(null);for(const N of c.stops)P[N[0]]=N[1];L=typeof c.stops[0][0]}else{if(f!=="identity")throw new Error(`Unknown function type "${f}"`);x=_c}if(h){const N={},I=[];for(let R=0;R<c.stops.length;R++){const O=c.stops[R],q=O[0].zoom;N[q]===void 0&&(N[q]={zoom:q,type:c.type,property:c.property,default:c.default,stops:[]},I.push(q)),N[q].stops.push([O[0].value,O[1]])}const z=[];for(const R of I)z.push([N[R].zoom,Yi(N[R],n)]);const F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:Ro.interpolationFactor.bind(void 0,F),zoomStops:z.map(R=>R[0]),evaluate:({zoom:R},O)=>kh({stops:z,base:c.base},n,R).evaluate(R,O)}}if(v){const N=f==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:N,interpolationFactor:Ro.interpolationFactor.bind(void 0,N),zoomStops:c.stops.map(I=>I[0]),evaluate:({zoom:I})=>x(c,n,I,P,L)}}return{kind:"source",evaluate(N,I){const z=I&&I.properties?I.properties[c.property]:void 0;return z===void 0?yd(c.default,n.default):x(c,n,z,P,L)}}}function yd(c,n,a){return c!==void 0?c:n!==void 0?n:a!==void 0?a:void 0}function Ah(c,n,a,h,v){return yd(typeof a===v?h[a]:void 0,c.default,n.default)}function im(c,n,a){if(Pl(a)!=="number")return yd(c.default,n.default);const h=c.stops.length;if(h===1||a<=c.stops[0][0])return c.stops[0][1];if(a>=c.stops[h-1][0])return c.stops[h-1][1];const v=Ql(c.stops.map(f=>f[0]),a);return c.stops[v][1]}function kh(c,n,a){const h=c.base!==void 0?c.base:1;if(Pl(a)!=="number")return yd(c.default,n.default);const v=c.stops.length;if(v===1||a<=c.stops[0][0])return c.stops[0][1];if(a>=c.stops[v-1][0])return c.stops[v-1][1];const f=Ql(c.stops.map(I=>I[0]),a),x=function(I,z,F,R){const O=R-F,q=I-F;return O===0?0:z===1?q/O:(Math.pow(z,q)-1)/(Math.pow(z,O)-1)}(a,h,c.stops[f][0],c.stops[f+1][0]),P=c.stops[f][1],L=c.stops[f+1][1];let N=Dr[n.type]||jc;if(c.colorSpace&&c.colorSpace!=="rgb"){const I=rp[c.colorSpace];N=(z,F)=>I.reverse(I.interpolate(I.forward(z),I.forward(F),x))}return typeof P.evaluate=="function"?{evaluate(...I){const z=P.evaluate.apply(void 0,I),F=L.evaluate.apply(void 0,I);if(z!==void 0&&F!==void 0)return N(z,F,x)}}:N(P,L,x)}function _c(c,n,a){return n.type==="color"?a=Or.parse(a):n.type==="formatted"?a=Yr.fromString(a.toString()):n.type==="resolvedImage"?a=Oa.build(a.toString()):Pl(a)===n.type||n.type==="enum"&&n.values[a]||(a=void 0),yd(a,c.default,n.default)}ps.register(Ih,{error:[{kind:"error"},[jr],(c,[n])=>{throw new ws(n.evaluate(c))}],typeof:[jr,[Hi],(c,[n])=>ca(Ca(n.evaluate(c)))],"to-rgba":[Ns(hi,4),[Sr],(c,[n])=>n.evaluate(c).toRenderColor(null).toArray()],"to-hsla":[Ns(hi,4),[Sr],(c,[n])=>n.evaluate(c).toRenderColor(null).toHslaArray()],rgb:[Sr,[hi,hi,hi],_d],rgba:[Sr,[hi,hi,hi,hi],_d],hsl:[Sr,[hi,hi,hi],Ph],hsla:[Sr,[hi,hi,hi,hi],Ph],has:{type:Wi,overloads:[[[jr],(c,[n])=>Lo(n.evaluate(c),c.properties())],[[jr,pc],(c,[n,a])=>Lo(n.evaluate(c),a.evaluate(c))]]},get:{type:Hi,overloads:[[[jr],(c,[n])=>ms(n.evaluate(c),c.properties())],[[jr,pc],(c,[n,a])=>ms(n.evaluate(c),a.evaluate(c))]]},"feature-state":[Hi,[jr],(c,[n])=>ms(n.evaluate(c),c.featureState||{})],properties:[pc,[],c=>c.properties()],"geometry-type":[jr,[],c=>c.geometryType()],id:[Hi,[],c=>c.id()],zoom:[hi,[],c=>c.globals.zoom],pitch:[hi,[],c=>c.globals.pitch||0],"distance-from-center":[hi,[],c=>c.distanceFromCenter()],"measure-light":[hi,[jr],(c,[n])=>c.measureLight(n.evaluate(c))],"heatmap-density":[hi,[],c=>c.globals.heatmapDensity||0],"line-progress":[hi,[],c=>c.globals.lineProgress||0],"raster-value":[hi,[],c=>c.globals.rasterValue||0],"raster-particle-speed":[hi,[],c=>c.globals.rasterParticleSpeed||0],"sky-radial-progress":[hi,[],c=>c.globals.skyRadialProgress||0],accumulated:[Hi,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[hi,zo(hi),(c,n)=>{let a=0;for(const h of n)a+=h.evaluate(c);return a}],"*":[hi,zo(hi),(c,n)=>{let a=1;for(const h of n)a*=h.evaluate(c);return a}],"-":{type:hi,overloads:[[[hi,hi],(c,[n,a])=>n.evaluate(c)-a.evaluate(c)],[[hi],(c,[n])=>-n.evaluate(c)]]},"/":[hi,[hi,hi],(c,[n,a])=>n.evaluate(c)/a.evaluate(c)],"%":[hi,[hi,hi],(c,[n,a])=>n.evaluate(c)%a.evaluate(c)],ln2:[hi,[],()=>Math.LN2],pi:[hi,[],()=>Math.PI],e:[hi,[],()=>Math.E],"^":[hi,[hi,hi],(c,[n,a])=>Math.pow(n.evaluate(c),a.evaluate(c))],sqrt:[hi,[hi],(c,[n])=>Math.sqrt(n.evaluate(c))],log10:[hi,[hi],(c,[n])=>Math.log(n.evaluate(c))/Math.LN10],ln:[hi,[hi],(c,[n])=>Math.log(n.evaluate(c))],log2:[hi,[hi],(c,[n])=>Math.log(n.evaluate(c))/Math.LN2],sin:[hi,[hi],(c,[n])=>Math.sin(n.evaluate(c))],cos:[hi,[hi],(c,[n])=>Math.cos(n.evaluate(c))],tan:[hi,[hi],(c,[n])=>Math.tan(n.evaluate(c))],asin:[hi,[hi],(c,[n])=>Math.asin(n.evaluate(c))],acos:[hi,[hi],(c,[n])=>Math.acos(n.evaluate(c))],atan:[hi,[hi],(c,[n])=>Math.atan(n.evaluate(c))],min:[hi,zo(hi),(c,n)=>Math.min(...n.map(a=>a.evaluate(c)))],max:[hi,zo(hi),(c,n)=>Math.max(...n.map(a=>a.evaluate(c)))],abs:[hi,[hi],(c,[n])=>Math.abs(n.evaluate(c))],round:[hi,[hi],(c,[n])=>{const a=n.evaluate(c);return a<0?-Math.round(-a):Math.round(a)}],floor:[hi,[hi],(c,[n])=>Math.floor(n.evaluate(c))],ceil:[hi,[hi],(c,[n])=>Math.ceil(n.evaluate(c))],"filter-==":[Wi,[jr,Hi],(c,[n,a])=>c.properties()[n.value]===a.value],"filter-id-==":[Wi,[Hi],(c,[n])=>c.id()===n.value],"filter-type-==":[Wi,[jr],(c,[n])=>c.geometryType()===n.value],"filter-<":[Wi,[jr,Hi],(c,[n,a])=>{const h=c.properties()[n.value],v=a.value;return typeof h==typeof v&&h<v}],"filter-id-<":[Wi,[Hi],(c,[n])=>{const a=c.id(),h=n.value;return typeof a==typeof h&&a<h}],"filter->":[Wi,[jr,Hi],(c,[n,a])=>{const h=c.properties()[n.value],v=a.value;return typeof h==typeof v&&h>v}],"filter-id->":[Wi,[Hi],(c,[n])=>{const a=c.id(),h=n.value;return typeof a==typeof h&&a>h}],"filter-<=":[Wi,[jr,Hi],(c,[n,a])=>{const h=c.properties()[n.value],v=a.value;return typeof h==typeof v&&h<=v}],"filter-id-<=":[Wi,[Hi],(c,[n])=>{const a=c.id(),h=n.value;return typeof a==typeof h&&a<=h}],"filter->=":[Wi,[jr,Hi],(c,[n,a])=>{const h=c.properties()[n.value],v=a.value;return typeof h==typeof v&&h>=v}],"filter-id->=":[Wi,[Hi],(c,[n])=>{const a=c.id(),h=n.value;return typeof a==typeof h&&a>=h}],"filter-has":[Wi,[Hi],(c,[n])=>n.value in c.properties()],"filter-has-id":[Wi,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[Wi,[Ns(jr)],(c,[n])=>n.value.indexOf(c.geometryType())>=0],"filter-id-in":[Wi,[Ns(Hi)],(c,[n])=>n.value.indexOf(c.id())>=0],"filter-in-small":[Wi,[jr,Ns(Hi)],(c,[n,a])=>a.value.indexOf(c.properties()[n.value])>=0],"filter-in-large":[Wi,[jr,Ns(Hi)],(c,[n,a])=>function(h,v,f,x){for(;f<=x;){const P=f+x>>1;if(v[P]===h)return!0;v[P]>h?x=P-1:f=P+1}return!1}(c.properties()[n.value],a.value,0,a.value.length-1)],all:{type:Wi,overloads:[[[Wi,Wi],(c,[n,a])=>n.evaluate(c)&&a.evaluate(c)],[zo(Wi),(c,n)=>{for(const a of n)if(!a.evaluate(c))return!1;return!0}]]},any:{type:Wi,overloads:[[[Wi,Wi],(c,[n,a])=>n.evaluate(c)||a.evaluate(c)],[zo(Wi),(c,n)=>{for(const a of n)if(a.evaluate(c))return!0;return!1}]]},"!":[Wi,[Wi],(c,[n])=>!n.evaluate(c)],"is-supported-script":[Wi,[jr],(c,[n])=>{const a=c.globals&&c.globals.isSupportedScript;return!a||a(n.evaluate(c))}],upcase:[jr,[jr],(c,[n])=>n.evaluate(c).toUpperCase()],downcase:[jr,[jr],(c,[n])=>n.evaluate(c).toLowerCase()],concat:[jr,zo(Hi),(c,n)=>n.map(a=>_o(a.evaluate(c))).join("")],"resolved-locale":[jr,[ou],(c,[n])=>n.evaluate(c).resolvedLocale()],random:[hi,[hi,hi,Hi],(c,n)=>{const[a,h,v]=n.map(x=>x.evaluate(c));if(a>h||a===h)return a;let f;if(typeof v=="string")f=function(x){let P=0;if(x.length===0)return P;for(let L=0;L<x.length;L++)P=(P<<5)-P+x.charCodeAt(L),P|=0;return P}(v);else{if(typeof v!="number")throw new ws(`Invalid seed input: ${v}`);f=v}return a+sp(f)()*(h-a)}]});class cp{constructor(n,a,h,v){this.expression=n,this._warningHistory={},this._evaluator=new td(h,v),this._defaultValue=a?function(f){return f.type==="color"&&(Nc(f.default)||Array.isArray(f.default))?new Or(0,0,0,0):f.type==="color"?Or.parse(f.default)||null:f.default===void 0?null:f.default}(a):null,this._enumValues=a&&a.type==="enum"?a.values:null,this.configDependencies=Zu(n)}evaluateWithoutErrorHandling(n,a,h,v,f,x,P,L){return this._evaluator.globals=n,this._evaluator.feature=a,this._evaluator.featureState=h,this._evaluator.canonical=v||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=x,this._evaluator.featureTileCoord=P||null,this._evaluator.featureDistanceData=L||null,this.expression.evaluate(this._evaluator)}evaluate(n,a,h,v,f,x,P,L){this._evaluator.globals=n,this._evaluator.feature=a||null,this._evaluator.featureState=h||null,this._evaluator.canonical=v||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=x||null,this._evaluator.featureTileCoord=P||null,this._evaluator.featureDistanceData=L||null;try{const N=this.expression.evaluate(this._evaluator);if(N==null||typeof N=="number"&&N!=N)return this._defaultValue;if(this._enumValues&&!(N in this._enumValues))throw new ws(`Expected value to be one of ${Object.keys(this._enumValues).map(I=>JSON.stringify(I)).join(", ")}, but found ${JSON.stringify(N)} instead.`);return N}catch(N){return this._warningHistory[N.message]||(this._warningHistory[N.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${N.message}`)),this._defaultValue}}}function Qr(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in Ih}function Uc(c,n,a,h){const v=new Qf(Ih,[],n?function(x){const P={color:Sr,string:jr,number:hi,enum:jr,boolean:Wi,formatted:io,resolvedImage:mc};return x.type==="array"?Ns(P[x.value]||Hi,x.length):P[x.type]}(n):void 0,void 0,void 0,a,h),f=v.parse(c,void 0,void 0,void 0,n&&n.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?Ol(new cp(f,n,a,h)):ml(v.errors)}class up{constructor(n,a,h,v){this.kind=n,this._styleExpression=a,this.isLightConstant=h,this.isLineProgressConstant=v,this.isStateDependent=n!=="constant"&&!nf(a.expression),this.configDependencies=Zu(a.expression)}evaluateWithoutErrorHandling(n,a,h,v,f,x){return this._styleExpression.evaluateWithoutErrorHandling(n,a,h,v,f,x)}evaluate(n,a,h,v,f,x){return this._styleExpression.evaluate(n,a,h,v,f,x)}}class yu{constructor(n,a,h,v,f,x){this.kind=n,this.zoomStops=h,this._styleExpression=a,this.isStateDependent=n!=="camera"&&!nf(a.expression),this.isLightConstant=f,this.isLineProgressConstant=x,this.configDependencies=Zu(a.expression),this.interpolationType=v}evaluateWithoutErrorHandling(n,a,h,v,f,x){return this._styleExpression.evaluateWithoutErrorHandling(n,a,h,v,f,x)}evaluate(n,a,h,v,f,x){return this._styleExpression.evaluate(n,a,h,v,f,x)}interpolationFactor(n,a,h){return this.interpolationType?Ro.interpolationFactor(this.interpolationType,n,a,h):0}}function hp(c,n,a,h){if((c=Uc(c,n,a,h)).result==="error")return c;const v=c.value.expression,f=pu(v);if(!f&&!Vc(n))return ml([new fl("","data expressions not supported")]);const x=zl(v,["zoom","pitch","distance-from-center"]);if(!x&&!op(n))return ml([new fl("","zoom expressions not supported")]);const P=zl(v,["measure-light"]);if(!P&&!hf(n))return ml([new fl("","measure-light expression not supported")]);const L=zl(v,["line-progress"]);if(!L&&!function(z){return nm(z.expression,"line-progress")}(n))return ml([new fl("","line-progress expression not supported")]);const N=n.expression&&n.expression.relaxZoomRestriction,I=Dh(v);return I||x||N?I instanceof fl?ml([I]):I instanceof Ro&&!lp(n)?ml([new fl("",'"interpolate" expressions cannot be used with this property')]):Ol(I?new yu(f&&L?"camera":"composite",c.value,I.labels,I instanceof Ro?I.interpolation:void 0,P,L):new up(f&&L?"constant":"source",c.value,P,L)):ml([new fl("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class df{constructor(n,a){this._parameters=n,this._specification=a,Qo(this,Yi(this._parameters,this._specification))}static deserialize(n){return new df(n._parameters,n._specification)}static serialize(n){return{_parameters:n._parameters,_specification:n._specification}}}function Dh(c){let n=null;if(c instanceof tl)n=Dh(c.result);else if(c instanceof Bc){for(const a of c.args)if(n=Dh(a),n)break}else(c instanceof Rr||c instanceof Ro)&&c.input instanceof ps&&c.input.name==="zoom"&&(n=c);return n instanceof fl||c.eachChild(a=>{const h=Dh(a);h instanceof fl?n=h:n&&h&&n!==h&&(n=new fl("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),n}var vd,dp,Hm=function(){if(dp)return vd;dp=1,vd=n;var c=3;function n(a,h,v){var f=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var x=new Int32Array(this.arrayBuffer);a=x[0],this.d=(h=x[1])+2*(v=x[2]);for(var P=0;P<this.d*this.d;P++){var L=x[c+P],N=x[c+P+1];f.push(L===N?null:x.subarray(L,N))}var I=x[c+f.length+1];this.keys=x.subarray(x[c+f.length],I),this.bboxes=x.subarray(I),this.insert=this._insertReadonly}else{this.d=h+2*v;for(var z=0;z<this.d*this.d;z++)f.push([]);this.keys=[],this.bboxes=[]}this.n=h,this.extent=a,this.padding=v,this.scale=h/a,this.uid=0;var F=v/h*a;this.min=-F,this.max=a+F}return n.prototype.insert=function(a,h,v,f,x){this._forEachCell(h,v,f,x,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(h),this.bboxes.push(v),this.bboxes.push(f),this.bboxes.push(x)},n.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},n.prototype._insertCell=function(a,h,v,f,x,P){this.cells[x].push(P)},n.prototype.query=function(a,h,v,f,x){var P=this.min,L=this.max;if(a<=P&&h<=P&&L<=v&&L<=f&&!x)return Array.prototype.slice.call(this.keys);var N=[];return this._forEachCell(a,h,v,f,this._queryCell,N,{},x),N},n.prototype._queryCell=function(a,h,v,f,x,P,L,N){var I=this.cells[x];if(I!==null)for(var z=this.keys,F=this.bboxes,R=0;R<I.length;R++){var O=I[R];if(L[O]===void 0){var q=4*O;(N?N(F[q+0],F[q+1],F[q+2],F[q+3]):a<=F[q+2]&&h<=F[q+3]&&v>=F[q+0]&&f>=F[q+1])?(L[O]=!0,P.push(z[O])):L[O]=!1}}},n.prototype._forEachCell=function(a,h,v,f,x,P,L,N){for(var I=this._convertToCellCoord(a),z=this._convertToCellCoord(h),F=this._convertToCellCoord(v),R=this._convertToCellCoord(f),O=I;O<=F;O++)for(var q=z;q<=R;q++){var te=this.d*q+O;if((!N||N(this._convertFromCellCoord(O),this._convertFromCellCoord(q),this._convertFromCellCoord(O+1),this._convertFromCellCoord(q+1)))&&x.call(this,a,h,v,f,te,P,L,N))return}},n.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},n.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},n.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,h=c+this.cells.length+1+1,v=0,f=0;f<this.cells.length;f++)v+=this.cells[f].length;var x=new Int32Array(h+v+this.keys.length+this.bboxes.length);x[0]=this.extent,x[1]=this.n,x[2]=this.padding;for(var P=h,L=0;L<a.length;L++){var N=a[L];x[c+L]=P,x.set(N,P),P+=N.length}return x[c+a.length]=P,x.set(this.keys,P),x[c+a.length+1]=P+=this.keys.length,x.set(this.bboxes,P),P+=this.bboxes.length,x.buffer},vd}(),Rh=G(Hm);const xd={};function ki(c,n,a={}){Object.defineProperty(c,"_classRegistryKey",{value:n,writable:!1}),xd[n]={klass:c,omit:a.omit||[]}}ki(Object,"Object"),Rh.serialize=function(c,n){const a=c.toArrayBuffer();return n&&n.add(a),{buffer:a}},Rh.deserialize=function(c){return new Rh(c.buffer)},Object.defineProperty(Rh,"name",{value:"Grid"}),ki(Rh,"Grid"),typeof DOMMatrix<"u"&&ki(DOMMatrix,"DOMMatrix"),ki(Or,"Color"),ki(Error,"Error"),ki(Yr,"Formatted"),ki(lu,"FormattedSection"),ki(Yh,"AJAXError"),ki(Oa,"ResolvedImage"),ki(df,"StylePropertyFunction"),ki(cp,"StyleExpression",{omit:["_evaluator"]}),ki(el,"ImageIdWithOptions"),ki(yu,"ZoomDependentExpression"),ki(up,"ZoomConstantExpression"),ki(ps,"CompoundExpression",{omit:["_evaluate"]});for(const c in Ih)xd[Ih[c]._classRegistryKey]||ki(Ih[c],`Expression${c}`);function yc(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function ls(c){return self.ImageBitmap&&c instanceof ImageBitmap}function nl(c,n){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp)return c;if(yc(c)||ls(c))return n&&n.add(c),c;if(ArrayBuffer.isView(c))return n&&n.add(c.buffer),c;if(c instanceof ImageData)return n&&n.add(c.data.buffer),c;if(Array.isArray(c)){const a=[];for(const h of c)a.push(nl(h,n));return a}if(c instanceof Map){const a={$name:"Map"};for(const[h,v]of c.entries())a[h]=nl(v);return a}if(c instanceof Set){const a={$name:"Set"};let h=0;for(const v of c.values())a[++h]=nl(v);return a}if(typeof c=="object"){const a=c.constructor,h=a._classRegistryKey;if(!h)throw new Error(`Can't serialize object of unregistered class "${h}".`);const v=a.serialize?a.serialize(c,n):{};if(!a.serialize){for(const f in c)c.hasOwnProperty(f)&&(xd[h].omit.indexOf(f)>=0||(v[f]=nl(c[f],n)));c instanceof Error&&(v.message=c.message)}if(v.$name)throw new Error("$name property is reserved for worker serialization logic.");return h!=="Object"&&(v.$name=h),v}throw new Error("can't serialize object of type "+typeof c)}function $c(c){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||yc(c)||ls(c)||ArrayBuffer.isView(c)||c instanceof ImageData)return c;if(Array.isArray(c))return c.map($c);if(typeof c=="object"){const n=c.$name||"Object";if(n==="Map"){const v=new Map;for(const f of Object.keys(c))f!=="$name"&&v.set(f,$c(c[f]));return v}if(n==="Set"){const v=new Set;for(const f of Object.keys(c))f!=="$name"&&v.add($c(c[f]));return v}const{klass:a}=xd[n];if(!a)throw new Error(`Can't deserialize unregistered class "${n}".`);if(a.deserialize)return a.deserialize(c);const h=Object.create(a.prototype);for(const v of Object.keys(c))v!=="$name"&&(h[v]=$c(c[v]));return h}throw new Error("can't deserialize object of type "+typeof c)}const $i={"Latin-1 Supplement":c=>c>=128&&c<=255,Arabic:c=>c>=1536&&c<=1791,"Arabic Supplement":c=>c>=1872&&c<=1919,"Arabic Extended-A":c=>c>=2208&&c<=2303,"Hangul Jamo":c=>c>=4352&&c<=4607,"Unified Canadian Aboriginal Syllabics":c=>c>=5120&&c<=5759,Khmer:c=>c>=6016&&c<=6143,"Unified Canadian Aboriginal Syllabics Extended":c=>c>=6320&&c<=6399,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"CJK Radicals Supplement":c=>c>=11904&&c<=12031,"Kangxi Radicals":c=>c>=12032&&c<=12255,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Hiragana:c=>c>=12352&&c<=12447,Katakana:c=>c>=12448&&c<=12543,Bopomofo:c=>c>=12544&&c<=12591,"Hangul Compatibility Jamo":c=>c>=12592&&c<=12687,Kanbun:c=>c>=12688&&c<=12703,"Bopomofo Extended":c=>c>=12704&&c<=12735,"CJK Strokes":c=>c>=12736&&c<=12783,"Katakana Phonetic Extensions":c=>c>=12784&&c<=12799,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"CJK Unified Ideographs Extension A":c=>c>=13312&&c<=19903,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"CJK Unified Ideographs":c=>c>=19968&&c<=40959,"Yi Syllables":c=>c>=40960&&c<=42127,"Yi Radicals":c=>c>=42128&&c<=42191,"Hangul Jamo Extended-A":c=>c>=43360&&c<=43391,"Hangul Syllables":c=>c>=44032&&c<=55215,"Hangul Jamo Extended-B":c=>c>=55216&&c<=55295,"Private Use Area":c=>c>=57344&&c<=63743,"CJK Compatibility Ideographs":c=>c>=63744&&c<=64255,"Arabic Presentation Forms-A":c=>c>=64336&&c<=65023,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Arabic Presentation Forms-B":c=>c>=65136&&c<=65279,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519,Osage:c=>c>=66736&&c<=66815,"CJK Unified Ideographs Extension B":c=>c>=131072&&c<=173791};function ff(c){for(const n of c)if(Fl(n.charCodeAt(0)))return!0;return!1}function fp(c){for(const n of c)if(!pf(n.charCodeAt(0)))return!1;return!0}function pf(c){return!($i.Arabic(c)||$i["Arabic Supplement"](c)||$i["Arabic Extended-A"](c)||$i["Arabic Presentation Forms-A"](c)||$i["Arabic Presentation Forms-B"](c))}function Fl(c){return!(c!==746&&c!==747&&(c<4352||!($i["Bopomofo Extended"](c)||$i.Bopomofo(c)||$i["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||$i["CJK Compatibility Ideographs"](c)||$i["CJK Compatibility"](c)||$i["CJK Radicals Supplement"](c)||$i["CJK Strokes"](c)||!(!$i["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||$i["CJK Unified Ideographs Extension A"](c)||$i["CJK Unified Ideographs"](c)||$i["Enclosed CJK Letters and Months"](c)||$i["Hangul Compatibility Jamo"](c)||$i["Hangul Jamo Extended-A"](c)||$i["Hangul Jamo Extended-B"](c)||$i["Hangul Jamo"](c)||$i["Hangul Syllables"](c)||$i.Hiragana(c)||$i["Ideographic Description Characters"](c)||$i.Kanbun(c)||$i["Kangxi Radicals"](c)||$i["Katakana Phonetic Extensions"](c)||$i.Katakana(c)&&c!==12540||!(!$i["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!$i["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||$i["Unified Canadian Aboriginal Syllabics"](c)||$i["Unified Canadian Aboriginal Syllabics Extended"](c)||$i["Vertical Forms"](c)||$i["Yijing Hexagram Symbols"](c)||$i["Yi Syllables"](c)||$i["Yi Radicals"](c))))}function Qu(c){return!(Fl(c)||function(n){return!!($i["Latin-1 Supplement"](n)&&(n===167||n===169||n===174||n===177||n===188||n===189||n===190||n===215||n===247)||$i["General Punctuation"](n)&&(n===8214||n===8224||n===8225||n===8240||n===8241||n===8251||n===8252||n===8258||n===8263||n===8264||n===8265||n===8273)||$i["Letterlike Symbols"](n)||$i["Number Forms"](n)||$i["Miscellaneous Technical"](n)&&(n>=8960&&n<=8967||n>=8972&&n<=8991||n>=8996&&n<=9e3||n===9003||n>=9085&&n<=9114||n>=9150&&n<=9165||n===9167||n>=9169&&n<=9179||n>=9186&&n<=9215)||$i["Control Pictures"](n)&&n!==9251||$i["Optical Character Recognition"](n)||$i["Enclosed Alphanumerics"](n)||$i["Geometric Shapes"](n)||$i["Miscellaneous Symbols"](n)&&!(n>=9754&&n<=9759)||$i["Miscellaneous Symbols and Arrows"](n)&&(n>=11026&&n<=11055||n>=11088&&n<=11097||n>=11192&&n<=11243)||$i["CJK Symbols and Punctuation"](n)||$i.Katakana(n)||$i["Private Use Area"](n)||$i["CJK Compatibility Forms"](n)||$i["Small Form Variants"](n)||$i["Halfwidth and Fullwidth Forms"](n)||n===8734||n===8756||n===8757||n>=9984&&n<=10087||n>=10102&&n<=10131||n===65532||n===65533)}(c))}function cr(c){return c>=1424&&c<=2303||$i["Arabic Presentation Forms-A"](c)||$i["Arabic Presentation Forms-B"](c)}function xr(c,n){return!(!n&&cr(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||$i.Khmer(c))}function bd(c){for(const n of c)if(cr(n.charCodeAt(0)))return!0;return!1}const wd="deferred",Bl="loading",$o="loaded";let pp=null,Ss="unavailable",eh=null;const vu=function(c){c&&typeof c=="string"&&c.indexOf("NetworkError")>-1&&(Ss="error"),pp&&pp(c)};function Ra(){cs.fire(new $a("pluginStateChange",{pluginStatus:Ss,pluginURL:eh}))}const cs=new Vs,mf=function(){return Ss},Sd=function(){if(Ss!==wd||!eh)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ss=Bl,Ra(),eh&&Bu({url:eh},c=>{c?vu(c):(Ss=$o,Ra())})},Go={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ss===$o||Go.applyArabicShaping!=null,isLoading:()=>Ss===Bl,setState(c){Ss=c.pluginStatus,eh=c.pluginURL},isParsed:()=>Go.applyArabicShaping!=null&&Go.processBidirectionalText!=null&&Go.processStyledBidirectionalText!=null,getPluginURL:()=>eh};class ba{constructor(n,a){this.zoom=n,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.transition=a.transition,this.pitch=a.pitch,this.brightness=a.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(n){return function(a,h){for(const v of a)if(!xr(v.charCodeAt(0),h))return!1;return!0}(n,Go.isLoaded())}}class th{constructor(n,a,h,v){this.property=n,this.value=a,this.expression=function(f,x,P,L){if(Nc(f))return new df(f,x);if(Qr(f)||Array.isArray(f)&&f.length>0){const N=hp(f,x,P,L);if(N.result==="error")throw new Error(N.value.map(I=>`${I.key}: ${I.message}`).join(", "));return N.value}{let N=f;return typeof f=="string"&&x.type==="color"&&(N=Or.parse(f)),{kind:"constant",configDependencies:new Set,evaluate:()=>N}}}(a===void 0?n.specification.default:a,n.specification,h,v)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(n,a,h){return this.property.possiblyEvaluate(this,n,a,h)}}class ec{constructor(n,a,h){this.property=n,this.value=new th(n,void 0,a,h)}transitioned(n,a){return new vc(this.property,this.value,a,Ar({},n.transition,this.transition),n.now)}untransitioned(){return new vc(this.property,this.value,null,{},0)}}class Gc{constructor(n,a,h){this._properties=n,this._values=Object.create(n.defaultTransitionablePropertyValues),this._scope=a,this._options=h,this.configDependencies=new Set}getValue(n){return Qe(this._values[n].value.value)}setValue(n,a){this._values.hasOwnProperty(n)||(this._values[n]=new ec(this._values[n].property,this._scope,this._options)),this._values[n].value=new th(this._values[n].property,a===null?void 0:Qe(a),this._scope,this._options),this._values[n].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[n].value.expression.configDependencies]))}setTransitionOrValue(n,a){a&&(this._options=a);const h=this._properties.properties;if(n)for(const v in n){const f=n[v];if(to(v,"-transition")){const x=v.slice(0,-11);h[x]&&this.setTransition(x,f)}else h.hasOwnProperty(v)&&this.setValue(v,f)}}getTransition(n){return Qe(this._values[n].transition)}setTransition(n,a){this._values.hasOwnProperty(n)||(this._values[n]=new ec(this._values[n].property)),this._values[n].transition=Qe(a)||void 0}serialize(){const n={};for(const a of Object.keys(this._values)){const h=this.getValue(a);h!==void 0&&(n[a]=h);const v=this.getTransition(a);v!==void 0&&(n[`${a}-transition`]=v)}return n}transitioned(n,a){const h=new gf(this._properties);for(const v of Object.keys(this._values))h._values[v]=this._values[v].transitioned(n,a._values[v]);return h}untransitioned(){const n=new gf(this._properties);for(const a of Object.keys(this._values))n._values[a]=this._values[a].untransitioned();return n}}class vc{constructor(n,a,h,v,f){const x=v.delay||0,P=v.duration||0;f=f||0,this.property=n,this.value=a,this.begin=f+x,this.end=this.begin+P,n.specification.transition&&(v.delay||v.duration)&&(this.prior=h)}possiblyEvaluate(n,a,h){const v=n.now||0,f=this.value.possiblyEvaluate(n,a,h),x=this.prior;if(x){if(v>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(v<this.begin)return x.possiblyEvaluate(n,a,h);{const P=(v-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(n,a,h),f,wi(P))}}return f}}class gf{constructor(n){this._properties=n,this._values=Object.create(n.defaultTransitioningPropertyValues)}possiblyEvaluate(n,a,h){const v=new xc(this._properties);for(const f of Object.keys(this._values))v._values[f]=this._values[f].possiblyEvaluate(n,a,h);return v}hasTransition(){for(const n of Object.keys(this._values))if(this._values[n].prior)return!0;return!1}}class _f{constructor(n,a,h){this._properties=n,this._values=Object.create(n.defaultPropertyValues),this._scope=a,this._options=h,this.configDependencies=new Set}getValue(n){return Qe(this._values[n].value)}setValue(n,a){this._values[n]=new th(this._values[n].property,a===null?void 0:Qe(a),this._scope,this._options),this._values[n].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[n].expression.configDependencies]))}serialize(){const n={};for(const a of Object.keys(this._values)){const h=this.getValue(a);h!==void 0&&(n[a]=h)}return n}possiblyEvaluate(n,a,h){const v=new xc(this._properties);for(const f of Object.keys(this._values))v._values[f]=this._values[f].possiblyEvaluate(n,a,h);return v}}class nh{constructor(n,a,h){this.property=n,this.value=a,this.parameters=h}isConstant(){return this.value.kind==="constant"}constantOr(n){return this.value.kind==="constant"?this.value.value:n}evaluate(n,a,h,v){return this.property.evaluate(this.value,this.parameters,n,a,h,v)}}class xc{constructor(n){this._properties=n,this._values=Object.create(n.defaultPossiblyEvaluatedValues)}get(n){return this._values[n]}}class Xn{constructor(n){this.specification=n}possiblyEvaluate(n,a){return n.expression.evaluate(a)}interpolate(n,a,h){const v=Dr[this.specification.type];return v?v(n,a,h):n}}class Ei{constructor(n,a){this.specification=n,this.overrides=a}possiblyEvaluate(n,a,h,v){return new nh(this,n.expression.kind==="constant"||n.expression.kind==="camera"?{kind:"constant",value:n.expression.evaluate(a,null,{},h,v)}:n.expression,a)}interpolate(n,a,h){if(n.value.kind!=="constant"||a.value.kind!=="constant")return n;if(n.value.value===void 0||a.value.value===void 0)return new nh(this,{kind:"constant",value:void 0},n.parameters);const v=Dr[this.specification.type];return v?new nh(this,{kind:"constant",value:v(n.value.value,a.value.value,h)},n.parameters):n}evaluate(n,a,h,v,f,x){return n.kind==="constant"?n.value:n.evaluate(a,h,v,f,x)}}class bc{constructor(n){this.specification=n}possiblyEvaluate(n,a,h,v){return!!n.expression.evaluate(a,null,{},h,v)}interpolate(){return!1}}class _a{constructor(n){this.properties=n,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const a=new ba(0,{});for(const h in n){const v=n[h];v.specification.overridable&&this.overridableProperties.push(h);const f=this.defaultPropertyValues[h]=new th(v,void 0),x=this.defaultTransitionablePropertyValues[h]=new ec(v);this.defaultTransitioningPropertyValues[h]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=f.possiblyEvaluate(a)}}}ki(Ei,"DataDrivenProperty"),ki(Xn,"DataConstantProperty"),ki(bc,"ColorRampProperty");var tn=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow","experimental":true},"rain":{"type":"rain","experimental":true},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor","experimental":true},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"experimental":true,"type":"featuresets"}},"featuresets":{"experimental":true,"*":{"type":"featureset"}},"featureset":{"experimental":true,"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"experimental":true,"layer":{"type":"string","required":true},"properties":{"type":"selectorProperty","required":false},"featureNamespace":{"type":"string","required":false}},"selectorProperty":{"experimental":true,"*":{"type":"*"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","property-type":"data-constant","expression":{},"required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"property-type":"data-constant"},"shadow-quality":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]},"experimental":true},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"experimental":true,"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"raster-particle":{"experimental":true},"hillshade":{},"model":{"experimental":true},"background":{},"sky":{},"slot":{},"clip":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{},"property-type":"data-constant"},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{},"property-type":"data-constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","experimental":true,"private":true,"expression":{},"property-type":"data-constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","experimental":true,"default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","experimental":true,"expression":{},"property-type":"data-constant"},"line-cross-slope":{"type":"number","experimental":true,"expression":{},"property-type":"constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","experimental":true,"private":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","experimental":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"experimental":true,"private":true,"expression":{},"property-type":"data-constant"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":"#ffffff","experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.4,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","property-type":"data-constant","default":0.71,"minimum":0,"maximum":5,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"opacity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"center-thinning":{"type":"number","property-type":"data-constant","default":0.57,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","property-type":"data-constant","transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","property-type":"data-constant","default":0.7,"minimum":0,"maximum":1,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"colorTheme":{"data":{"type":"string","property-type":"data-constant","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}},"buildingFeaturesetId":{"type":"string","experimental":true,"property-type":"data-constant","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"flat","property-type":"data-constant"},"fill-extrusion-base-alignment":{"type":"enum","experimental":true,"values":{"terrain":1,"flat":1},"default":"terrain","property-type":"data-constant"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","experimental":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","experimental":true,"default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","experimental":true,"default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","experimental":true,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","experimental":true,"default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","experimental":true,"default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"experimental":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-trim-fade-range":{"type":"array","value":"number","experimental":true,"length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-trim-color":{"type":"color","experimental":true,"default":"transparent","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"property-type":"data-constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"experimental":true,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"experimental":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-particle-count":{"type":"number","default":512,"minimum":1,"property-type":"data-constant"},"raster-particle-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-particle-speed"]},"property-type":"color-ramp"},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1,"property-type":"data-constant"},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1,"property-type":"data-constant"},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]},"experimental":true,"property-type":"data-constant"},"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"model-front-cutoff":{"type":"array","private":true,"value":"number","property-type":"data-constant","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function mp(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function ih(c){if(Array.isArray(c))return c.map(ih);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const n={};for(const a in c)n[a]=ih(c[a]);return n}return mp(c)}function yf(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const n of c.slice(1))if(!yf(n)&&typeof n!="boolean")return!1;return!0;default:return!0}}function B(c,n="",a=null,h="fill"){if(c==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};yf(c)||(c=re(c));const v=c;let f=!0;try{f=function(I){if(!C(I))return I;let z=ih(I);return p(z),z=r(z),z}(v)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(v,null,2)}
        `)}let x=null,P=null;if(h!=="background"&&h!=="sky"&&h!=="slot"){P=tn[`filter_${h}`];const I=Uc(f,P,n,a);if(I.result==="error")throw new Error(I.value.map(z=>`${z.key}: ${z.message}`).join(", "));x=(z,F,R)=>I.value.evaluate(z,F,{},R)}let L=null,N=null;if(f!==v){const I=Uc(v,P,n,a);if(I.result==="error")throw new Error(I.value.map(z=>`${z.key}: ${z.message}`).join(", "));L=(z,F,R,O,q)=>I.value.evaluate(z,F,{},R,void 0,void 0,O,q),N=!pu(I.value.expression)}return{filter:x,dynamicFilter:L||void 0,needGeometry:Z(f),needFeature:!!N}}function r(c){if(!Array.isArray(c))return c;const n=function(a){if(k.has(a[0])){for(let h=1;h<a.length;h++)if(C(a[h]))return!0}return a}(c);return n===!0?n:n.map(a=>r(a))}function p(c){let n=!1;const a=[];if(c[0]==="case"){for(let h=1;h<c.length-1;h+=2)n=n||C(c[h]),a.push(c[h+1]);a.push(c[c.length-1])}else if(c[0]==="match"){n=n||C(c[1]);for(let h=2;h<c.length-1;h+=2)a.push(c[h+1]);a.push(c[c.length-1])}else if(c[0]==="step"){n=n||C(c[1]);for(let h=1;h<c.length-1;h+=2)a.push(c[h+1])}n&&(c.length=0,c.push("any",...a));for(let h=1;h<c.length;h++)p(c[h])}function C(c){if(!Array.isArray(c))return!1;if((n=c[0])==="pitch"||n==="distance-from-center")return!0;var n;for(let a=1;a<c.length;a++)if(C(c[a]))return!0;return!1}const k=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function j(c,n){return c<n?-1:c>n?1:0}function Z(c){if(!Array.isArray(c))return!1;if(c[0]==="within"||c[0]==="distance")return!0;for(let n=1;n<c.length;n++)if(Z(c[n]))return!0;return!1}function re(c){if(!c)return!0;const n=c[0];return c.length<=1?n!=="any":n==="=="?ue(c[1],c[2],"=="):n==="!="?Re(ue(c[1],c[2],"==")):n==="<"||n===">"||n==="<="||n===">="?ue(c[1],c[2],n):n==="any"?(a=c.slice(1),["any"].concat(a.map(re))):n==="all"?["all"].concat(c.slice(1).map(re)):n==="none"?["all"].concat(c.slice(1).map(re).map(Re)):n==="in"?ye(c[1],c.slice(2)):n==="!in"?Re(ye(c[1],c.slice(2))):n==="has"?Me(c[1]):n!=="!has"||Re(Me(c[1]));var a}function ue(c,n,a){switch(c){case"$type":return[`filter-type-${a}`,n];case"$id":return[`filter-id-${a}`,n];default:return[`filter-${a}`,c,n]}}function ye(c,n){if(n.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",n]];case"$id":return["filter-id-in",["literal",n]];default:return n.length>200&&!n.some(a=>typeof a!=typeof n[0])?["filter-in-large",c,["literal",n.sort(j)]]:["filter-in-small",c,["literal",n]]}}function Me(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function Re(c){return["!",c]}const ze="";function Je(c,n){return n?`${c}${ze}${n}`:c}const ot="-transition",Pt=new Set(["fill","line","background","hillshade","raster"]);class Et extends Vs{constructor(n,a,h,v,f){if(super(),this.id=n.id,this.fqid=Je(this.id,h),this.type=n.type,this.scope=h,this.lut=v,this.options=f,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,n.type!=="custom"){if(this.metadata=n.metadata,this.minzoom=n.minzoom,this.maxzoom=n.maxzoom,n.type&&n.type!=="background"&&n.type!=="sky"&&n.type!=="slot"){this.source=n.source,this.sourceLayer=n["source-layer"],this.filter=n.filter;const x=Uc(this.filter,tn[`filter_${n.type}`]);x.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...x.value.configDependencies]))}if(n.slot&&(this.slot=n.slot),a.layout&&(this._unevaluatedLayout=new _f(a.layout,this.scope,f),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),a.paint){this._transitionablePaint=new Gc(a.paint,this.scope,f);for(const x in n.paint)this.setPaintProperty(x,n.paint[x]);for(const x in n.layout)this.setLayoutProperty(x,n.layout[x]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new xc(a.paint)}}}onAdd(n){}onRemove(n){}isDraped(n){return!this.is3D()&&Pt.has(this.type)}getLayoutProperty(n){return n==="visibility"?this.visibility:this._unevaluatedLayout.getValue(n)}setLayoutProperty(n,a){if(this.type==="custom"&&n==="visibility")return void(this.visibility=a);const h=this._unevaluatedLayout;h._properties.properties[n]&&(h.setValue(n,a),this.configDependencies=new Set([...this.configDependencies,...h.configDependencies]),n==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(n){return to(n,ot)?this._transitionablePaint.getTransition(n.slice(0,-11)):this._transitionablePaint.getValue(n)}setPaintProperty(n,a){const h=this._transitionablePaint,v=h._properties.properties;if(to(n,ot)){const z=n.slice(0,-11);return v[z]&&h.setTransition(z,a||void 0),!1}if(!v[n])return!1;const f=h._values[n],x=f.value.isDataDriven(),P=f.value;h.setValue(n,a),this.configDependencies=new Set([...this.configDependencies,...h.configDependencies]),this._handleSpecialPaintPropertyUpdate(n);const L=h._values[n].value,N=L.isDataDriven(),I=to(n,"pattern")||n==="line-dasharray";return N||x||I||this._handleOverridablePaintPropertyUpdate(n,P,L)}_handleSpecialPaintPropertyUpdate(n){}getProgramIds(){return null}getDefaultProgramParams(n,a,h){return null}_handleOverridablePaintPropertyUpdate(n,a,h){return!1}isHidden(n){return!!(this.minzoom&&n<this.minzoom)||!!(this.maxzoom&&n>=this.maxzoom)||this.visibility==="none"}updateTransitions(n){this._transitioningPaint=this._transitionablePaint.transitioned(n,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(n,a){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(n,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(n,void 0,a)}serialize(){return bt({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(n,a)=>!(n===void 0||a==="layout"&&!Object.keys(n).length||a==="paint"&&!Object.keys(n).length))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const n in this.paint._values){const a=this.paint.get(n);if(a instanceof nh&&Vc(a.property.specification)&&(a.value.kind==="source"||a.value.kind==="composite")&&a.value.isStateDependent)return!0}return!1}compileFilter(n){this._filterCompiled||(this._featureFilter=B(this.filter,this.scope,n),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(n){this._stats&&(n.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(n){}queryIntersectsFeature(n,a,h,v,f,x,P,L,N){}}const Lt={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class jt{constructor(n,a){this._structArray=n,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Nt{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(n,a){return n._trim(),a&&(n.isTransferred=!0,a.add(n.arrayBuffer)),{length:n.length,arrayBuffer:n.arrayBuffer}}static deserialize(n){const a=Object.create(this.prototype);return a.arrayBuffer=n.arrayBuffer,a.length=n.length,a.capacity=n.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(n){this.reserve(n),this.length=n}reserve(n){if(n>this.capacity){this.capacity=Math.max(n,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...n){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...n){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Bt(c,n=1){let a=0,h=0;return{members:c.map(v=>{const f=Lt[v.type].BYTES_PER_ELEMENT,x=a=nn(a,Math.max(n,f)),P=v.components||1;return h=Math.max(h,f),a+=f*P,{name:v.name,type:v.type,components:P,offset:x}}),size:nn(a,Math.max(h,n)),alignment:n}}function nn(c,n){return Math.ceil(c/n)*n}class rn extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a){const h=this.length;return this.resize(h+1),this.emplace(h,n,a)}emplace(n,a,h){const v=2*n;return this.int16[v+0]=a,this.int16[v+1]=h,n}}rn.prototype.bytesPerElement=4,ki(rn,"StructArrayLayout2i4");class an extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,h){const v=this.length;return this.resize(v+1),this.emplace(v,n,a,h)}emplace(n,a,h,v){const f=3*n;return this.int16[f+0]=a,this.int16[f+1]=h,this.int16[f+2]=v,n}}an.prototype.bytesPerElement=6,ki(an,"StructArrayLayout3i6");class Mn extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,h,v){const f=this.length;return this.resize(f+1),this.emplace(f,n,a,h,v)}emplace(n,a,h,v,f){const x=4*n;return this.int16[x+0]=a,this.int16[x+1]=h,this.int16[x+2]=v,this.int16[x+3]=f,n}}Mn.prototype.bytesPerElement=8,ki(Mn,"StructArrayLayout4i8");class Rn extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,h,v,f){const x=this.length;return this.resize(x+1),this.emplace(x,n,a,h,v,f)}emplace(n,a,h,v,f,x){const P=5*n;return this.int16[P+0]=a,this.int16[P+1]=h,this.int16[P+2]=v,this.int16[P+3]=f,this.int16[P+4]=x,n}}Rn.prototype.bytesPerElement=10,ki(Rn,"StructArrayLayout5i10");class Hn extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,h,v,f,x,P){const L=this.length;return this.resize(L+1),this.emplace(L,n,a,h,v,f,x,P)}emplace(n,a,h,v,f,x,P,L){const N=6*n,I=12*n,z=3*n;return this.int16[N+0]=a,this.int16[N+1]=h,this.uint8[I+4]=v,this.uint8[I+5]=f,this.uint8[I+6]=x,this.uint8[I+7]=P,this.float32[z+2]=L,n}}Hn.prototype.bytesPerElement=12,ki(Hn,"StructArrayLayout2i4ub1f12");class ei extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,h,v){const f=this.length;return this.resize(f+1),this.emplace(f,n,a,h,v)}emplace(n,a,h,v,f){const x=4*n;return this.float32[x+0]=a,this.float32[x+1]=h,this.float32[x+2]=v,this.float32[x+3]=f,n}}ei.prototype.bytesPerElement=16,ki(ei,"StructArrayLayout4f16");class jn extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,h){const v=this.length;return this.resize(v+1),this.emplace(v,n,a,h)}emplace(n,a,h,v){const f=3*n;return this.float32[f+0]=a,this.float32[f+1]=h,this.float32[f+2]=v,n}}jn.prototype.bytesPerElement=12,ki(jn,"StructArrayLayout3f12");class Ri extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,h,v,f){const x=this.length;return this.resize(x+1),this.emplace(x,n,a,h,v,f)}emplace(n,a,h,v,f,x){const P=6*n,L=3*n;return this.uint16[P+0]=a,this.uint16[P+1]=h,this.uint16[P+2]=v,this.uint16[P+3]=f,this.float32[L+2]=x,n}}Ri.prototype.bytesPerElement=12,ki(Ri,"StructArrayLayout4ui1f12");class zi extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,h,v){const f=this.length;return this.resize(f+1),this.emplace(f,n,a,h,v)}emplace(n,a,h,v,f){const x=4*n;return this.uint16[x+0]=a,this.uint16[x+1]=h,this.uint16[x+2]=v,this.uint16[x+3]=f,n}}zi.prototype.bytesPerElement=8,ki(zi,"StructArrayLayout4ui8");class xi extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,h,v,f,x){const P=this.length;return this.resize(P+1),this.emplace(P,n,a,h,v,f,x)}emplace(n,a,h,v,f,x,P){const L=6*n;return this.int16[L+0]=a,this.int16[L+1]=h,this.int16[L+2]=v,this.int16[L+3]=f,this.int16[L+4]=x,this.int16[L+5]=P,n}}xi.prototype.bytesPerElement=12,ki(xi,"StructArrayLayout6i12");class Gi extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,h,v,f,x,P,L,N,I,z,F){const R=this.length;return this.resize(R+1),this.emplace(R,n,a,h,v,f,x,P,L,N,I,z,F)}emplace(n,a,h,v,f,x,P,L,N,I,z,F,R){const O=12*n;return this.int16[O+0]=a,this.int16[O+1]=h,this.int16[O+2]=v,this.int16[O+3]=f,this.uint16[O+4]=x,this.uint16[O+5]=P,this.uint16[O+6]=L,this.uint16[O+7]=N,this.int16[O+8]=I,this.int16[O+9]=z,this.int16[O+10]=F,this.int16[O+11]=R,n}}Gi.prototype.bytesPerElement=24,ki(Gi,"StructArrayLayout4i4ui4i24");class Hr extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,h,v,f,x){const P=this.length;return this.resize(P+1),this.emplace(P,n,a,h,v,f,x)}emplace(n,a,h,v,f,x,P){const L=10*n,N=5*n;return this.int16[L+0]=a,this.int16[L+1]=h,this.int16[L+2]=v,this.float32[N+2]=f,this.float32[N+3]=x,this.float32[N+4]=P,n}}Hr.prototype.bytesPerElement=20,ki(Hr,"StructArrayLayout3i3f20");class ua extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n){const a=this.length;return this.resize(a+1),this.emplace(a,n)}emplace(n,a){return this.uint32[1*n+0]=a,n}}ua.prototype.bytesPerElement=4,ki(ua,"StructArrayLayout1ul4");class Ma extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a){const h=this.length;return this.resize(h+1),this.emplace(h,n,a)}emplace(n,a,h){const v=2*n;return this.uint16[v+0]=a,this.uint16[v+1]=h,n}}Ma.prototype.bytesPerElement=4,ki(Ma,"StructArrayLayout2ui4");class La extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,h,v,f,x,P,L,N,I,z,F,R){const O=this.length;return this.resize(O+1),this.emplace(O,n,a,h,v,f,x,P,L,N,I,z,F,R)}emplace(n,a,h,v,f,x,P,L,N,I,z,F,R,O){const q=20*n,te=10*n;return this.int16[q+0]=a,this.int16[q+1]=h,this.int16[q+2]=v,this.int16[q+3]=f,this.int16[q+4]=x,this.float32[te+3]=P,this.float32[te+4]=L,this.float32[te+5]=N,this.float32[te+6]=I,this.int16[q+14]=z,this.uint32[te+8]=F,this.uint16[q+18]=R,this.uint16[q+19]=O,n}}La.prototype.bytesPerElement=40,ki(La,"StructArrayLayout5i4f1i1ul2ui40");class Ha extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,h,v,f,x,P){const L=this.length;return this.resize(L+1),this.emplace(L,n,a,h,v,f,x,P)}emplace(n,a,h,v,f,x,P,L){const N=8*n;return this.int16[N+0]=a,this.int16[N+1]=h,this.int16[N+2]=v,this.int16[N+4]=f,this.int16[N+5]=x,this.int16[N+6]=P,this.int16[N+7]=L,n}}Ha.prototype.bytesPerElement=16,ki(Ha,"StructArrayLayout3i2i2i16");class Ia extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n,a,h,v,f){const x=this.length;return this.resize(x+1),this.emplace(x,n,a,h,v,f)}emplace(n,a,h,v,f,x){const P=4*n,L=8*n;return this.float32[P+0]=a,this.float32[P+1]=h,this.float32[P+2]=v,this.int16[L+6]=f,this.int16[L+7]=x,n}}Ia.prototype.bytesPerElement=16,ki(Ia,"StructArrayLayout2f1f2i16");class Pa extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,h,v,f,x){const P=this.length;return this.resize(P+1),this.emplace(P,n,a,h,v,f,x)}emplace(n,a,h,v,f,x,P){const L=20*n,N=5*n;return this.uint8[L+0]=a,this.uint8[L+1]=h,this.float32[N+1]=v,this.float32[N+2]=f,this.float32[N+3]=x,this.float32[N+4]=P,n}}Pa.prototype.bytesPerElement=20,ki(Pa,"StructArrayLayout2ub4f20");class Wr extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,h){const v=this.length;return this.resize(v+1),this.emplace(v,n,a,h)}emplace(n,a,h,v){const f=3*n;return this.uint16[f+0]=a,this.uint16[f+1]=h,this.uint16[f+2]=v,n}}Wr.prototype.bytesPerElement=6,ki(Wr,"StructArrayLayout3ui6");class ro extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,a,h,v,f,x,P,L,N,I,z,F,R,O,q,te,ae,ge,_e,he,xe){const Te=this.length;return this.resize(Te+1),this.emplace(Te,n,a,h,v,f,x,P,L,N,I,z,F,R,O,q,te,ae,ge,_e,he,xe)}emplace(n,a,h,v,f,x,P,L,N,I,z,F,R,O,q,te,ae,ge,_e,he,xe,Te){const Ae=30*n,tt=15*n,Ke=60*n;return this.int16[Ae+0]=a,this.int16[Ae+1]=h,this.int16[Ae+2]=v,this.float32[tt+2]=f,this.float32[tt+3]=x,this.uint16[Ae+8]=P,this.uint16[Ae+9]=L,this.uint32[tt+5]=N,this.uint32[tt+6]=I,this.uint32[tt+7]=z,this.uint16[Ae+16]=F,this.uint16[Ae+17]=R,this.uint16[Ae+18]=O,this.float32[tt+10]=q,this.float32[tt+11]=te,this.uint8[Ke+48]=ae,this.uint8[Ke+49]=ge,this.uint8[Ke+50]=_e,this.uint32[tt+13]=he,this.int16[Ae+28]=xe,this.uint8[Ke+58]=Te,n}}ro.prototype.bytesPerElement=60,ki(ro,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Is extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(n,a,h,v,f,x,P,L,N,I,z,F,R,O,q,te,ae,ge,_e,he,xe,Te,Ae,tt,Ke,Ye,Ct,ct,It,Rt,At,Vt){const Wt=this.length;return this.resize(Wt+1),this.emplace(Wt,n,a,h,v,f,x,P,L,N,I,z,F,R,O,q,te,ae,ge,_e,he,xe,Te,Ae,tt,Ke,Ye,Ct,ct,It,Rt,At,Vt)}emplace(n,a,h,v,f,x,P,L,N,I,z,F,R,O,q,te,ae,ge,_e,he,xe,Te,Ae,tt,Ke,Ye,Ct,ct,It,Rt,At,Vt,Wt){const Kt=20*n,qt=40*n,yn=80*n;return this.float32[Kt+0]=a,this.float32[Kt+1]=h,this.int16[qt+4]=v,this.int16[qt+5]=f,this.int16[qt+6]=x,this.int16[qt+7]=P,this.int16[qt+8]=L,this.int16[qt+9]=N,this.int16[qt+10]=I,this.int16[qt+11]=z,this.int16[qt+12]=F,this.uint16[qt+13]=R,this.uint16[qt+14]=O,this.uint16[qt+15]=q,this.uint16[qt+16]=te,this.uint16[qt+17]=ae,this.uint16[qt+18]=ge,this.uint16[qt+19]=_e,this.uint16[qt+20]=he,this.uint16[qt+21]=xe,this.uint16[qt+22]=Te,this.uint16[qt+23]=Ae,this.uint16[qt+24]=tt,this.uint16[qt+25]=Ke,this.uint16[qt+26]=Ye,this.uint16[qt+27]=Ct,this.uint32[Kt+14]=ct,this.float32[Kt+15]=It,this.float32[Kt+16]=Rt,this.float32[Kt+17]=At,this.float32[Kt+18]=Vt,this.uint8[yn+76]=Wt,n}}Is.prototype.bytesPerElement=80,ki(Is,"StructArrayLayout2f9i15ui1ul4f1ub80");class gs extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n){const a=this.length;return this.resize(a+1),this.emplace(a,n)}emplace(n,a){return this.float32[1*n+0]=a,n}}gs.prototype.bytesPerElement=4,ki(gs,"StructArrayLayout1f4");class Za extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,h,v,f){const x=this.length;return this.resize(x+1),this.emplace(x,n,a,h,v,f)}emplace(n,a,h,v,f,x){const P=5*n;return this.float32[P+0]=a,this.float32[P+1]=h,this.float32[P+2]=v,this.float32[P+3]=f,this.float32[P+4]=x,n}}Za.prototype.bytesPerElement=20,ki(Za,"StructArrayLayout5f20");class tc extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,h,v,f,x,P){const L=this.length;return this.resize(L+1),this.emplace(L,n,a,h,v,f,x,P)}emplace(n,a,h,v,f,x,P,L){const N=7*n;return this.float32[N+0]=a,this.float32[N+1]=h,this.float32[N+2]=v,this.float32[N+3]=f,this.float32[N+4]=x,this.float32[N+5]=P,this.float32[N+6]=L,n}}tc.prototype.bytesPerElement=28,ki(tc,"StructArrayLayout7f28");class nc extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,h,v,f,x,P,L,N,I,z){const F=this.length;return this.resize(F+1),this.emplace(F,n,a,h,v,f,x,P,L,N,I,z)}emplace(n,a,h,v,f,x,P,L,N,I,z,F){const R=11*n;return this.float32[R+0]=a,this.float32[R+1]=h,this.float32[R+2]=v,this.float32[R+3]=f,this.float32[R+4]=x,this.float32[R+5]=P,this.float32[R+6]=L,this.float32[R+7]=N,this.float32[R+8]=I,this.float32[R+9]=z,this.float32[R+10]=F,n}}nc.prototype.bytesPerElement=44,ki(nc,"StructArrayLayout11f44");class il extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,h,v,f,x,P,L,N){const I=this.length;return this.resize(I+1),this.emplace(I,n,a,h,v,f,x,P,L,N)}emplace(n,a,h,v,f,x,P,L,N,I){const z=9*n;return this.float32[z+0]=a,this.float32[z+1]=h,this.float32[z+2]=v,this.float32[z+3]=f,this.float32[z+4]=x,this.float32[z+5]=P,this.float32[z+6]=L,this.float32[z+7]=N,this.float32[z+8]=I,n}}il.prototype.bytesPerElement=36,ki(il,"StructArrayLayout9f36");class rl extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a){const h=this.length;return this.resize(h+1),this.emplace(h,n,a)}emplace(n,a,h){const v=2*n;return this.float32[v+0]=a,this.float32[v+1]=h,n}}rl.prototype.bytesPerElement=8,ki(rl,"StructArrayLayout2f8");class xu extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n,a,h,v){const f=this.length;return this.resize(f+1),this.emplace(f,n,a,h,v)}emplace(n,a,h,v,f){const x=6*n;return this.uint32[3*n+0]=a,this.uint16[x+2]=h,this.uint16[x+3]=v,this.uint16[x+4]=f,n}}xu.prototype.bytesPerElement=12,ki(xu,"StructArrayLayout1ul3ui12");class rh extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(n){const a=this.length;return this.resize(a+1),this.emplace(a,n)}emplace(n,a){return this.uint16[1*n+0]=a,n}}rh.prototype.bytesPerElement=2,ki(rh,"StructArrayLayout1ui2");class ah extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,h,v,f,x,P,L,N,I,z,F,R,O,q,te){const ae=this.length;return this.resize(ae+1),this.emplace(ae,n,a,h,v,f,x,P,L,N,I,z,F,R,O,q,te)}emplace(n,a,h,v,f,x,P,L,N,I,z,F,R,O,q,te,ae){const ge=16*n;return this.float32[ge+0]=a,this.float32[ge+1]=h,this.float32[ge+2]=v,this.float32[ge+3]=f,this.float32[ge+4]=x,this.float32[ge+5]=P,this.float32[ge+6]=L,this.float32[ge+7]=N,this.float32[ge+8]=I,this.float32[ge+9]=z,this.float32[ge+10]=F,this.float32[ge+11]=R,this.float32[ge+12]=O,this.float32[ge+13]=q,this.float32[ge+14]=te,this.float32[ge+15]=ae,n}}ah.prototype.bytesPerElement=64,ki(ah,"StructArrayLayout16f64");class yo extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(n,a,h,v,f,x,P){const L=this.length;return this.resize(L+1),this.emplace(L,n,a,h,v,f,x,P)}emplace(n,a,h,v,f,x,P,L){const N=10*n,I=5*n;return this.uint16[N+0]=a,this.uint16[N+1]=h,this.uint16[N+2]=v,this.uint16[N+3]=f,this.float32[I+2]=x,this.float32[I+3]=P,this.float32[I+4]=L,n}}yo.prototype.bytesPerElement=20,ki(yo,"StructArrayLayout4ui3f20");class gl extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(n){const a=this.length;return this.resize(a+1),this.emplace(a,n)}emplace(n,a){return this.int16[1*n+0]=a,n}}gl.prototype.bytesPerElement=2,ki(gl,"StructArrayLayout1i2");class al extends Nt{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(n){const a=this.length;return this.resize(a+1),this.emplace(a,n)}emplace(n,a){return this.uint8[1*n+0]=a,n}}al.prototype.bytesPerElement=1,ki(al,"StructArrayLayout1ub1");class Oo extends jt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Oo.prototype.size=40;class Fa extends La{get(n){return new Oo(this,n)}}ki(Fa,"CollisionBoxArray");class us extends jt{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(n){this._structArray.uint8[this._pos1+49]=n}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(n){this._structArray.uint8[this._pos1+50]=n}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(n){this._structArray.uint32[this._pos4+13]=n}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(n){this._structArray.uint8[this._pos1+58]=n}}us.prototype.size=60;class _l extends ro{get(n){return new us(this,n)}}ki(_l,"PlacedSymbolArray");class _s extends jt{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(n){this._structArray.uint32[this._pos4+14]=n}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(n){this._structArray.float32[this._pos4+18]=n}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}_s.prototype.size=80;class Zm extends Is{get(n){return new _s(this,n)}}ki(Zm,"SymbolInstanceArray");class Td extends gs{getoffsetX(n){return this.float32[1*n+0]}}ki(Td,"GlyphOffsetArray");class Lh extends rn{getx(n){return this.int16[2*n+0]}gety(n){return this.int16[2*n+1]}}ki(Lh,"SymbolLineVertexArray");class sl extends jt{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}sl.prototype.size=12;class wc extends xu{get(n){return new sl(this,n)}}ki(wc,"FeatureIndexArray");class sh extends Ma{geta_centroid_pos0(n){return this.uint16[2*n+0]}geta_centroid_pos1(n){return this.uint16[2*n+1]}}ki(sh,"FillExtrusionCentroidArray");class bu extends jt{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}bu.prototype.size=6;class rm extends an{get(n){return new bu(this,n)}}ki(rm,"FillExtrusionWallArray");const gp=Bt([{name:"a_pos",components:2,type:"Int16"}],4),vf=Bt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Wa{constructor(n=[]){this.segments=n}_prepareSegment(n,a,h,v){let f=this.segments[this.segments.length-1];return n>Wa.MAX_VERTEX_ARRAY_LENGTH&&it(`Max vertices per segment is ${Wa.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${n}`),(!f||f.vertexLength+n>Wa.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==v)&&(f={vertexOffset:a,primitiveOffset:h,vertexLength:0,primitiveLength:0},v!==void 0&&(f.sortKey=v),this.segments.push(f)),f}prepareSegment(n,a,h,v){return this._prepareSegment(n,a.length,h.length,v)}get(){return this.segments}destroy(){for(const n of this.segments)for(const a in n.vaos)n.vaos[a].destroy()}static simpleSegment(n,a,h,v){return new Wa([{vertexOffset:n,primitiveOffset:a,vertexLength:h,primitiveLength:v,vaos:{},sortKey:0}])}}function Cd(c,n){return 256*(c=ui(Math.floor(c),0,255))+ui(Math.floor(n),0,255)}Wa.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ki(Wa,"SegmentVector");const am=Bt([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Ug=Bt([{name:"a_dash",components:4,type:"Uint16"}]);class xf{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(n,a,h,v){this.ids.push(Wm(n)),this.positions.push(a,h,v)}eachPosition(n,a){const h=Wm(n);let v=0,f=this.ids.length-1;for(;v<f;){const x=v+f>>1;this.ids[x]>=h?f=x:v=x+1}for(;this.ids[v]===h;)a(this.positions[3*v],this.positions[3*v+1],this.positions[3*v+2]),v++}static serialize(n,a){const h=new Float64Array(n.ids),v=new Uint32Array(n.positions);return sm(h,v,0,h.length-1),a&&(a.add(h.buffer),a.add(v.buffer)),{ids:h,positions:v}}static deserialize(n){const a=new xf;let h;a.ids=n.ids,a.positions=n.positions;for(const v of a.ids)v!==h&&a.uniqueIds.push(v),h=v;return a.indexed=!0,a}}function Wm(c){const n=+c;return!isNaN(n)&&Number.MIN_SAFE_INTEGER<=n&&n<=Number.MAX_SAFE_INTEGER?n:au(String(c))}function sm(c,n,a,h){for(;a<h;){const v=c[a+h>>1];let f=a-1,x=h+1;for(;;){do f++;while(c[f]<v);do x--;while(c[x]>v);if(f>=x)break;_p(c,f,x),_p(n,3*f,3*x),_p(n,3*f+1,3*x+1),_p(n,3*f+2,3*x+2)}x-a<h-x?(sm(c,n,a,x),a=x+1):(sm(c,n,x+1,h),h=x)}}function _p(c,n,a){const h=c[n];c[n]=c[a],c[a]=h}ki(xf,"FeaturePositionMap");class ic{constructor(n){this.gl=n.gl,this.initialized=!1}fetchUniformLocation(n,a){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(n,a),this.initialized=!0),!!this.location}set(n,a,h){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class yp extends ic{constructor(n){super(n),this.current=0}set(n,a,h){this.fetchUniformLocation(n,a)&&this.current!==h&&(this.current=h,this.gl.uniform1i(this.location,h))}}class Ba extends ic{constructor(n){super(n),this.current=0}set(n,a,h){this.fetchUniformLocation(n,a)&&this.current!==h&&(this.current=h,this.gl.uniform1f(this.location,h))}}class rc extends ic{constructor(n){super(n),this.current=[0,0]}set(n,a,h){this.fetchUniformLocation(n,a)&&(h[0]===this.current[0]&&h[1]===this.current[1]||(this.current=h,this.gl.uniform2f(this.location,h[0],h[1])))}}class vp extends ic{constructor(n){super(n),this.current=[0,0,0]}set(n,a,h){this.fetchUniformLocation(n,a)&&(h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]||(this.current=h,this.gl.uniform3f(this.location,h[0],h[1],h[2])))}}class xp extends ic{constructor(n){super(n),this.current=[0,0,0,0]}set(n,a,h){this.fetchUniformLocation(n,a)&&(h[0]===this.current[0]&&h[1]===this.current[1]&&h[2]===this.current[2]&&h[3]===this.current[3]||(this.current=h,this.gl.uniform4f(this.location,h[0],h[1],h[2],h[3])))}}class $g extends ic{constructor(n){super(n),this.current=Or.transparent.toRenderColor(null)}set(n,a,h){this.fetchUniformLocation(n,a)&&(h.r===this.current.r&&h.g===this.current.g&&h.b===this.current.b&&h.a===this.current.a||(this.current=h,this.gl.uniform4f(this.location,h.r,h.g,h.b,h.a)))}}const Gg=new Float32Array(16);class om extends ic{constructor(n){super(n),this.current=Gg}set(n,a,h){if(this.fetchUniformLocation(n,a)){if(h[12]!==this.current[12]||h[0]!==this.current[0])return this.current=h,void this.gl.uniformMatrix4fv(this.location,!1,h);for(let v=1;v<16;v++)if(h[v]!==this.current[v]){this.current=h,this.gl.uniformMatrix4fv(this.location,!1,h);break}}}}const sy=new Float32Array(9),oy=new Float32Array(4);class Xm extends ic{constructor(n){super(n),this.current=oy}set(n,a,h){if(this.fetchUniformLocation(n,a)){for(let v=0;v<4;v++)if(h[v]!==this.current[v]){this.current=h,this.gl.uniformMatrix2fv(this.location,!1,h);break}}}}function Ym(c){return[Cd(255*c.r,255*c.g),Cd(255*c.b,255*c.a)]}class Ed{constructor(n,a,h,v){this.value=n,this.uniformNames=a.map(f=>`u_${f}`),this.type=h,this.context=v}setUniform(n,a,h,v,f){const x=v.constantOr(this.value);a.set(n,f,x instanceof Or?x.toRenderColor(this.ignoreLut?null:this.context.lut):x)}getBinding(n,a){return this.type==="color"?new $g(n):new Ba(n)}}class bf{constructor(n,a){this.uniformNames=a.map(h=>`u_${h}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(n){this.pixelRatio=n.pixelRatio||1,this.pattern=n.tl.concat(n.br)}setUniform(n,a,h,v,f){const x=f==="u_pattern"||f==="u_dash"?this.pattern:f==="u_pixel_ratio"?this.pixelRatio:null;x&&a.set(n,f,x)}getBinding(n,a){return a==="u_pattern"||a==="u_dash"?new xp(n):new Ba(n)}}class wu{constructor(n,a,h,v){this.expression=n,this.type=h,this.maxValue=0,this.paintVertexAttributes=a.map(f=>({name:`a_${f}`,type:"Float32",components:h==="color"?2:1,offset:0})),this.paintVertexArray=new v}populatePaintArray(n,a,h,v,f,x,P){const L=this.paintVertexArray.length,N=this.expression.evaluate(new ba(0,{brightness:x}),a,{},f,v,P);this.paintVertexArray.resize(n),this._setPaintValue(L,n,N,this.context)}updatePaintArray(n,a,h,v,f,x,P){const L=this.expression.evaluate({zoom:0,brightness:P},h,v,void 0,f);this._setPaintValue(n,a,L,this.context)}_setPaintValue(n,a,h,v){if(this.type==="color"){const f=Ym(h.toRenderColor(this.ignoreLut?null:v.lut));for(let x=n;x<a;x++)this.paintVertexArray.emplace(x,f[0],f[1])}else{for(let f=n;f<a;f++)this.paintVertexArray.emplace(f,h);this.maxValue=Math.max(this.maxValue,Math.abs(h))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Vl{constructor(n,a,h,v,f,x){this.expression=n,this.uniformNames=a.map(P=>`u_${P}_t`),this.type=h,this.useIntegerZoom=v,this.context=f,this.maxValue=0,this.paintVertexAttributes=a.map(P=>({name:`a_${P}`,type:"Float32",components:h==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(n,a,h,v,f,x,P){const L=this.expression.evaluate(new ba(this.context.zoom,{brightness:x}),a,{},f,v,P),N=this.expression.evaluate(new ba(this.context.zoom+1,{brightness:x}),a,{},f,v,P),I=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValue(I,n,L,N,this.context)}updatePaintArray(n,a,h,v,f,x,P){const L=this.expression.evaluate({zoom:this.context.zoom,brightness:P},h,v,void 0,f),N=this.expression.evaluate({zoom:this.context.zoom+1,brightness:P},h,v,void 0,f);this._setPaintValue(n,a,L,N,this.context)}_setPaintValue(n,a,h,v,f){if(this.type==="color"){const x=Ym(h.toRenderColor(this.ignoreLut?null:f.lut)),P=Ym(h.toRenderColor(this.ignoreLut?null:f.lut));for(let L=n;L<a;L++)this.paintVertexArray.emplace(L,x[0],x[1],P[0],P[1])}else{for(let x=n;x<a;x++)this.paintVertexArray.emplace(x,h,v);this.maxValue=Math.max(this.maxValue,Math.abs(h),Math.abs(v))}}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(n,a,h,v,f){const x=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,P=ui(this.expression.interpolationFactor(x,this.context.zoom,this.context.zoom+1),0,1);a.set(n,f,P)}getBinding(n,a){return new Ba(n)}}class vo{constructor(n,a,h,v,f){this.expression=n,this.layerId=f,this.paintVertexAttributes=(h==="array"?Ug:am).members;for(let x=0;x<a.length;++x);this.paintVertexArray=new v}populatePaintArray(n,a,h,v){const f=this.paintVertexArray.length;this.paintVertexArray.resize(n),this._setPaintValues(f,n,a.patterns&&a.patterns[this.layerId],h)}updatePaintArray(n,a,h,v,f,x,P){this._setPaintValues(n,a,h.patterns&&h.patterns[this.layerId],x)}_setPaintValues(n,a,h,v){if(!v||!h)return;const f=v[h];if(!f)return;const{tl:x,br:P,pixelRatio:L}=f;for(let N=n;N<a;N++)this.paintVertexArray.emplace(N,x[0],x[1],P[0],P[1],L)}upload(n){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=n.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Md{constructor(n,a,h=()=>!0){this.binders={},this._buffers=[],this.context=a;const v=[];for(const f in n.paint._values){const x=n.paint.get(f),P=n.paint.get(`${f}-use-theme`);if(f.endsWith("-use-theme")||!h(f)||!(x instanceof nh&&Vc(x.property.specification)))continue;const L=lm(f,n.type),N=x.value,I=x.property.specification.type,z=!!x.property.useIntegerZoom,F=f==="line-dasharray"||f.endsWith("pattern"),R=f==="line-dasharray"&&n.layout.get("line-cap").value.kind!=="constant";if(N.kind!=="constant"||R)if(N.kind==="source"||R||F){const O=cm(f,I,"source");this.binders[f]=F?new vo(N,L,I,O,n.id):new wu(N,L,I,O),v.push(`/a_${f}`)}else{const O=cm(f,I,"composite");this.binders[f]=new Vl(N,L,I,z,a,O),v.push(`/z_${f}`)}else this.binders[f]=F?new bf(N.value,L):new Ed(N.value,L,I,a),v.push(`/u_${f}`);P&&(this.binders[f].ignoreLut=P.constantOr("default")==="none",this.binders[f].checkUseTheme=!0)}this.cacheKey=v.sort().join("")}getMaxValue(n){const a=this.binders[n];return a instanceof wu||a instanceof Vl?a.maxValue:0}populatePaintArrays(n,a,h,v,f,x,P){for(const L in this.binders){const N=this.binders[L];N.context=this.context,(N instanceof wu||N instanceof Vl||N instanceof vo)&&N.populatePaintArray(n,a,h,v,f,x,P)}}setConstantPatternPositions(n){for(const a in this.binders){const h=this.binders[a];h instanceof bf&&h.setConstantPatternPositions(n)}}updatePaintArrays(n,a,h,v,f,x,P,L,N){let I=!1;const z=Object.keys(n),F=z.length!==0&&!L,R=F?z:a.uniqueIds;this.context.lut=f.lut;for(const O in this.binders){const q=this.binders[O];if(q.context=this.context,(q instanceof wu||q instanceof Vl||q instanceof vo)&&(q.expression.isStateDependent===!0||q.expression.isLightConstant===!1)){const te=f.paint.get(O);q.expression=te.value;for(const ae of R){const ge=n[ae.toString()];a.eachPosition(ae,(_e,he,xe)=>{const Te=v.feature(_e);q.updatePaintArray(he,xe,Te,ge,x,P,N)})}if(!F)for(const ae of h.uniqueIds){const ge=n[ae.toString()];h.eachPosition(ae,(_e,he,xe)=>{const Te=v.feature(_e);q.updatePaintArray(he,xe,Te,ge,x,P,N)})}I=!0}}return I}defines(){const n=[];for(const a in this.binders){const h=this.binders[a];(h instanceof Ed||h instanceof bf)&&n.push(...h.uniformNames.map(v=>`#define HAS_UNIFORM_${v}`))}return n}getBinderAttributes(){const n=[];for(const a in this.binders){const h=this.binders[a];if(h instanceof wu||h instanceof Vl||h instanceof vo)for(let v=0;v<h.paintVertexAttributes.length;v++)n.push(h.paintVertexAttributes[v].name)}return n}getBinderUniforms(){const n=[];for(const a in this.binders){const h=this.binders[a];if(h instanceof Ed||h instanceof bf||h instanceof Vl)for(const v of h.uniformNames)n.push(v)}return n}getPaintVertexBuffers(){return this._buffers}getUniforms(n){const a=[];for(const h in this.binders){const v=this.binders[h];if(v instanceof Ed||v instanceof bf||v instanceof Vl)for(const f of v.uniformNames)a.push({name:f,property:h,binding:v.getBinding(n,f)})}return a}setUniforms(n,a,h,v,f){for(const{name:x,property:P,binding:L}of h){if(this.binders[P].checkUseTheme&&this.binders[P]instanceof Ed){const N=v.get(`${P}-use-theme`);N.isConstant()&&(this.binders[P].ignoreLut=N.constantOr("default")==="none")}this.binders[P].setUniform(n,L,f,v.get(P),x)}}updatePaintBuffers(){this._buffers=[];for(const n in this.binders){const a=this.binders[n];(a instanceof wu||a instanceof Vl||a instanceof vo)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(n){for(const a in this.binders){const h=this.binders[a];(h instanceof wu||h instanceof Vl||h instanceof vo)&&h.upload(n)}this.updatePaintBuffers()}destroy(){for(const n in this.binders){const a=this.binders[n];(a instanceof wu||a instanceof Vl||a instanceof vo)&&a.destroy()}}}class oh{constructor(n,a,h=()=>!0){this.programConfigurations={};for(const v of n)this.programConfigurations[v.id]=new Md(v,a,h);this.needsUpload=!1,this._featureMap=new xf,this._featureMapWithoutIds=new xf,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(n,a,h,v,f,x,P,L){for(const N in this.programConfigurations)this.programConfigurations[N].populatePaintArrays(n,a,v,f,x,P,L);a.id!==void 0?this._featureMap.add(a.id,h,this._bufferOffset,n):(this._featureMapWithoutIds.add(this._idlessCounter,h,this._bufferOffset,n),this._idlessCounter+=1),this._bufferOffset=n,this.needsUpload=!0}updatePaintArrays(n,a,h,v,f,x,P){for(const L of h)this.needsUpload=this.programConfigurations[L.id].updatePaintArrays(n,this._featureMap,this._featureMapWithoutIds,a,L,v,f,x,P||0)||this.needsUpload}get(n){return this.programConfigurations[n]}upload(n){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(n);this.needsUpload=!1}}destroy(){for(const n in this.programConfigurations)this.programConfigurations[n].destroy()}}const Sv={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function lm(c,n){return Sv[c]||[c.replace(`${n}-`,"").replace(/-/g,"_")]}const Tv={"line-pattern":{source:Ri,composite:Ri},"fill-pattern":{source:Ri,composite:Ri},"fill-extrusion-pattern":{source:Ri,composite:Ri},"line-dasharray":{source:zi,composite:zi}},Cv={color:{source:rl,composite:ei},number:{source:gs,composite:rl}};function cm(c,n,a){const h=Tv[c];return h&&h[a]||Cv[n][a]}ki(Ed,"ConstantBinder"),ki(bf,"PatternConstantBinder"),ki(wu,"SourceExpressionBinder"),ki(vo,"PatternCompositeBinder"),ki(Vl,"CompositeExpressionBinder"),ki(Md,"ProgramConfiguration",{omit:["_buffers"]}),ki(oh,"ProgramConfigurationSet");const yl=mi/Math.PI/2,bp=5,Km=6,qg=16383,Sc=64,Id=[Sc,32,16],qc=-yl,Hc=yl;function wp(c,n,a,h=yl){return a=zn(a),[c*Math.sin(a)*h,-n*h,c*Math.cos(a)*h]}function Pd(c,n,a){return wp(Math.cos(zn(c)),Math.sin(zn(c)),n,a)}const Sp=63710088e-1,Hg=2*Math.PI*Sp;class Kr{constructor(n,a){if(isNaN(n)||isNaN(a))throw new Error(`Invalid LngLat object: (${n}, ${a})`);if(this.lng=+n,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Kr(Er(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(n){const a=Math.PI/180,h=this.lat*a,v=n.lat*a,f=Math.sin(h)*Math.sin(v)+Math.cos(h)*Math.cos(v)*Math.cos((n.lng-this.lng)*a);return Sp*Math.acos(Math.min(f,1))}toBounds(n=0){const a=360*n/40075017,h=a/Math.cos(Math.PI/180*this.lat);return new lh({lng:this.lng-h,lat:this.lat-a},{lng:this.lng+h,lat:this.lat+a})}toEcef(n){return Pd(this.lat,this.lng,yl+n*yl/Sp)}static convert(n){if(n instanceof Kr)return n;if(Array.isArray(n)&&(n.length===2||n.length===3))return new Kr(Number(n[0]),Number(n[1]));if(!Array.isArray(n)&&typeof n=="object"&&n!==null)return new Kr(Number("lng"in n?n.lng:n.lon),Number(n.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class lh{constructor(n,a){if(n)if(a)this.setSouthWest(n).setNorthEast(a);else if(n.length===4){const h=n;this.setSouthWest([h[0],h[1]]).setNorthEast([h[2],h[3]])}else{const h=n;this.setSouthWest(h[0]).setNorthEast(h[1])}}setNorthEast(n){return this._ne=n instanceof Kr?new Kr(n.lng,n.lat):Kr.convert(n),this}setSouthWest(n){return this._sw=n instanceof Kr?new Kr(n.lng,n.lat):Kr.convert(n),this}extend(n){const a=this._sw,h=this._ne;let v,f;if(n instanceof Kr)v=n,f=n;else{if(!(n instanceof lh))return Array.isArray(n)?n.length===4||n.every(Array.isArray)?this.extend(lh.convert(n)):this.extend(Kr.convert(n)):typeof n=="object"&&n!==null&&n.hasOwnProperty("lat")&&(n.hasOwnProperty("lon")||n.hasOwnProperty("lng"))?this.extend(Kr.convert(n)):this;if(v=n._sw,f=n._ne,!v||!f)return this}return a||h?(a.lng=Math.min(v.lng,a.lng),a.lat=Math.min(v.lat,a.lat),h.lng=Math.max(f.lng,h.lng),h.lat=Math.max(f.lat,h.lat)):(this._sw=new Kr(v.lng,v.lat),this._ne=new Kr(f.lng,f.lat)),this}getCenter(){return new Kr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Kr(this.getWest(),this.getNorth())}getSouthEast(){return new Kr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(n){const{lng:a,lat:h}=Kr.convert(n);let v=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(v=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=h&&h<=this._ne.lat&&v}static convert(n){if(n)return n instanceof lh?n:new lh(n)}}const Ev=0,Zg=25.5;function zh(c){return Hg*Math.cos(c*Math.PI/180)}function ch(c){return(180+c)/360}function Ga(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function ao(c,n){return c/zh(n)}function Nl(c){return 360*c-180}function Ws(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}function um(c,n){return c*zh(Ws(n))}const xo=85.051129;function ly(c){return Math.cos(zn(ui(c,-85.051129,xo)))}function _(c,n){const a=ui(n,Ev,Zg),h=Math.pow(2,a);return ly(c)*Hg/(512*h)}function i(c){return 1/Math.cos(c*Math.PI/180)}function l(c,n=0){const a=Math.exp(Math.PI*(1-(c.y+n/mi)/(1<<c.z)*2));return 80150034*a/(a*a+1)/mi/(1<<c.z)}class y{constructor(n,a,h=0){this.x=+n,this.y=+a,this.z=+h}static fromLngLat(n,a=0){const h=Kr.convert(n);return new y(ch(h.lng),Ga(h.lat),ao(a,h.lat))}toLngLat(){return new Kr(Nl(this.x),Ws(this.y))}toAltitude(){return um(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Hg*i(Ws(this.y))}}function w(c,n,a,h,v,f,x,P,L){const N=(n+h)/2,I=(a+v)/2,z=new at(N,I);P(z),function(F,R,O,q,te,ae){const ge=O-te,_e=q-ae;return Math.abs((q-R)*ge-(O-F)*_e)/Math.hypot(ge,_e)}(z.x,z.y,f.x,f.y,x.x,x.y)>=L?(w(c,n,a,N,I,f,z,P,L),w(c,N,I,h,v,z,x,P,L)):c.push(x)}function M(c,n,a){let h=c[0],v=h.x,f=h.y;n(h);const x=[h];for(let P=1;P<c.length;P++){const L=c[P],{x:N,y:I}=L;n(L),w(x,v,f,N,I,h,L,n,a),v=N,f=I,h=L}return x}function A(c,n,a,h){if(h(n,a)){const v=n.add(a)._mult(.5);A(c,n,v,h),A(c,v,a,h)}else c.push(a)}function V(c,n){let a=c[0];const h=[a];for(let v=1;v<c.length;v++){const f=c[v];A(h,a,f,n),a=f}return h}const H=Math.pow(2,14)-1,K=-H-1;function ee(c,n){const a=Math.round(c.x*n),h=Math.round(c.y*n);return c.x=ui(a,K,H),c.y=ui(h,K,H),(a<c.x||a>c.x+1||h<c.y||h>c.y+1)&&it("Geometry exceeds allowed extent, reduce your vector tile buffer size"),c}function se(c,n,a){const h=c.loadGeometry(),v=c.extent,f=mi/v;if(n&&a&&a.projection.isReprojectedInTileSpace){const x=1<<n.z,{scale:P,x:L,y:N,projection:I}=a,z=F=>{const R=Nl((n.x+F.x/v)/x),O=Ws((n.y+F.y/v)/x),q=I.project(R,O);F.x=(q.x*P-L)*v,F.y=(q.y*P-N)*v};for(let F=0;F<h.length;F++)if(c.type!==1)h[F]=M(h[F],z,1);else{const R=[];for(const O of h[F])O.x<0||O.x>=v||O.y<0||O.y>=v||(z(O),R.push(O));h[F]=R}}for(const x of h)for(const P of x)ee(P,f);return h}function le(c,n){return{type:c.type,id:c.id,properties:c.properties,geometry:n?se(c):[]}}function me(c,n,a,h,v){c.emplaceBack(2*n+(h+1)/2,2*a+(v+1)/2)}function Ee(c,n,a){c.emplaceBack(n.x,n.y,n.z,a[0]*16384,a[1]*16384,a[2]*16384)}class Se{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=n.index,this.hasPattern=!1,this.projection=n.projection,this.layoutVertexArray=new rn,this.indexArray=new Wr,this.segments=new Wa,this.programConfigurations=new oh(n.layers,{zoom:n.zoom,lut:n.lut}),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}updateFootprints(n,a){}populate(n,a,h,v){const f=this.layers[0],x=[];let P=null;f.type==="circle"&&(P=f.layout.get("circle-sort-key"));for(const{feature:N,id:I,index:z,sourceLayerIndex:F}of n){const R=this.layers[0]._featureFilter.needGeometry,O=le(N,R);if(!this.layers[0]._featureFilter.filter(new ba(this.zoom),O,h))continue;const q=P?P.evaluate(O,{},h):void 0,te={id:I,properties:N.properties,type:N.type,sourceLayerIndex:F,index:z,geometry:R?O.geometry:se(N,h,v),patterns:{},sortKey:q};x.push(te)}P&&x.sort((N,I)=>N.sortKey-I.sortKey);let L=null;v.projection.name==="globe"&&(this.globeExtVertexArray=new xi,L=v.projection);for(const N of x){const{geometry:I,index:z,sourceLayerIndex:F}=N,R=n[z].feature;this.addFeature(N,I,z,a.availableImages,h,L,a.brightness),a.featureIndex.insert(R,I,z,F,this.index)}}update(n,a,h,v,f,x,P){this.programConfigurations.updatePaintArrays(n,a,f,h,v,x,P)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,gp.members),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,vf.members))),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(n,a,h,v,f,x,P){for(const L of a)for(const N of L){const I=N.x,z=N.y;if(I<0||I>=mi||z<0||z>=mi)continue;if(x){const O=x.projectTilePoint(I,z,f),q=x.upVector(f,I,z),te=this.globeExtVertexArray;Ee(te,O,q),Ee(te,O,q),Ee(te,O,q),Ee(te,O,q)}const F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,n.sortKey),R=F.vertexLength;me(this.layoutVertexArray,I,z,-1,-1),me(this.layoutVertexArray,I,z,1,-1),me(this.layoutVertexArray,I,z,1,1),me(this.layoutVertexArray,I,z,-1,1),this.indexArray.emplaceBack(R,R+1,R+2),this.indexArray.emplaceBack(R,R+2,R+3),F.vertexLength+=4,F.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,h,{},v,f,P)}}function ke(c,n){for(let a=0;a<c.length;a++)if(Mt(n,c[a]))return!0;for(let a=0;a<n.length;a++)if(Mt(c,n[a]))return!0;return!!st(c,n)}function De(c,n,a){return!!Mt(c,n)||!!gt(n,c,a)}function Xe(c,n){if(c.length===1)return _t(n,c[0]);for(let a=0;a<n.length;a++){const h=n[a];for(let v=0;v<h.length;v++)if(Mt(c,h[v]))return!0}for(let a=0;a<c.length;a++)if(_t(n,c[a]))return!0;for(let a=0;a<n.length;a++)if(st(c,n[a]))return!0;return!1}function ut(c,n,a){if(c.length>1){if(st(c,n))return!0;for(let h=0;h<n.length;h++)if(gt(n[h],c,a))return!0}for(let h=0;h<c.length;h++)if(gt(c[h],n,a))return!0;return!1}function st(c,n){if(c.length===0||n.length===0)return!1;for(let a=0;a<c.length-1;a++){const h=c[a],v=c[a+1];for(let f=0;f<n.length-1;f++)if(wt(h,v,n[f],n[f+1]))return!0}return!1}function wt(c,n,a,h){return Ut(c,a,h)!==Ut(n,a,h)&&Ut(c,n,a)!==Ut(c,n,h)}function gt(c,n,a){const h=a*a;if(n.length===1)return c.distSqr(n[0])<h;for(let v=1;v<n.length;v++)if(vt(c,n[v-1],n[v])<h)return!0;return!1}function vt(c,n,a){const h=n.distSqr(a);if(h===0)return c.distSqr(n);const v=((c.x-n.x)*(a.x-n.x)+(c.y-n.y)*(a.y-n.y))/h;return c.distSqr(v<0?n:v>1?a:a.sub(n)._mult(v)._add(n))}function _t(c,n){let a,h,v,f=!1;for(let x=0;x<c.length;x++){a=c[x];for(let P=0,L=a.length-1;P<a.length;L=P++)h=a[P],v=a[L],h.y>n.y!=v.y>n.y&&n.x<(v.x-h.x)*(n.y-h.y)/(v.y-h.y)+h.x&&(f=!f)}return f}function Mt(c,n){let a=!1;for(let h=0,v=c.length-1;h<c.length;v=h++){const f=c[h],x=c[v];f.y>n.y!=x.y>n.y&&n.x<(x.x-f.x)*(n.y-f.y)/(x.y-f.y)+f.x&&(a=!a)}return a}function Ft(c,n,a,h,v){for(const x of c)if(n<=x.x&&a<=x.y&&h>=x.x&&v>=x.y)return!0;const f=[new at(n,a),new at(n,v),new at(h,v),new at(h,a)];if(c.length>2){for(const x of f)if(Mt(c,x))return!0}for(let x=0;x<c.length-1;x++)if(cn(c[x],c[x+1],f))return!0;return!1}function cn(c,n,a){const h=a[0],v=a[2];if(c.x<h.x&&n.x<h.x||c.x>v.x&&n.x>v.x||c.y<h.y&&n.y<h.y||c.y>v.y&&n.y>v.y)return!1;const f=Ut(c,n,a[0]);return f!==Ut(c,n,a[1])||f!==Ut(c,n,a[2])||f!==Ut(c,n,a[3])}function en(c,n,a,h,v,f){let x=n.y-c.y,P=c.x-n.x;if(f=f||0){const L=x*x+P*P;if(L===0)return!0;const N=Math.sqrt(L);x/=N,P/=N}return!((a.x-c.x)*x+(a.y-c.y)*P-f<0||(h.x-c.x)*x+(h.y-c.y)*P-f<0||(v.x-c.x)*x+(v.y-c.y)*P-f<0)}function zt(c,n,a,h,v,f,x){return!(en(c,n,h,v,f,x)||en(n,a,h,v,f,x)||en(a,c,h,v,f,x)||en(h,v,c,n,a,x)||en(v,f,c,n,a,x)||en(f,h,c,n,a,x))}function Ht(c,n,a){const h=n.paint.get(c).value;return h.kind==="constant"?h.value:a.programConfigurations.get(n.id).getMaxValue(c)}function En(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function Vn(c,n,a,h,v){if(!n[0]&&!n[1])return c;const f=at.convert(n)._mult(v);a==="viewport"&&f._rotate(-h);const x=[];for(let P=0;P<c.length;P++)x.push(c[P].sub(f));return x}function ti(c,n,a,h){const v=at.convert(c)._mult(h);return n==="viewport"&&v._rotate(-a),v}let Qt,An;ki(Se,"CircleBucket",{omit:["layers"]});var dn,Jn={exports:{}},Fn=(dn||(dn=1,function(c,n){(function(a){function h(f,x,P){var L=v(256*f,256*(x=Math.pow(2,P)-x-1),P),N=v(256*(f+1),256*(x+1),P);return L[0]+","+L[1]+","+N[0]+","+N[1]}function v(f,x,P){var L=2*Math.PI*6378137/256/Math.pow(2,P);return[f*L-2*Math.PI*6378137/2,x*L-2*Math.PI*6378137/2]}a.getURL=function(f,x,P,L,N,I){return I=I||{},f+"?"+["bbox="+h(P,L,N),"format="+(I.format||"image/png"),"service="+(I.service||"WMS"),"version="+(I.version||"1.1.1"),"request="+(I.request||"GetMap"),"srs="+(I.srs||"EPSG:3857"),"width="+(I.width||256),"height="+(I.height||256),"layers="+x].join("&")},a.getTileBBox=h,a.getMercCoords=v,Object.defineProperty(a,"__esModule",{value:!0})})(n)}(0,Jn.exports)),Jn.exports);class wn{constructor(n,a,h){this.z=n,this.x=a,this.y=h,this.key=Ii(0,n,n,a,h)}equals(n){return this.z===n.z&&this.x===n.x&&this.y===n.y}url(n,a){const h=Fn.getTileBBox(this.x,this.y,this.z),v=function(f,x,P){let L,N="";for(let I=f;I>0;I--)L=1<<I-1,N+=(x&L?1:0)+(P&L?2:0);return N}(this.z,this.x,this.y);return n[(this.x+this.y)%n.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",v).replace("{bbox-epsg-3857}",h)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Mi{constructor(n,a){this.wrap=n,this.canonical=a,this.key=Ii(n,a.z,a.z,a.x,a.y)}}class si{constructor(n,a,h,v,f){this.overscaledZ=n,this.wrap=a,this.canonical=new wn(h,+v,+f),this.key=a===0&&n===h?this.canonical.key:Ii(a,n,h,v,f)}equals(n){return this.overscaledZ===n.overscaledZ&&this.wrap===n.wrap&&this.canonical.equals(n.canonical)}scaledTo(n){const a=this.canonical.z-n;return n>this.canonical.z?new si(n,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new si(n,this.wrap,n,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(n,a=!0){if(this.overscaledZ===n&&a)return this.key;if(n>this.canonical.z)return Ii(this.wrap*+a,n,this.canonical.z,this.canonical.x,this.canonical.y);{const h=this.canonical.z-n;return Ii(this.wrap*+a,n,n,this.canonical.x>>h,this.canonical.y>>h)}}isChildOf(n){if(n.wrap!==this.wrap)return!1;const a=this.canonical.z-n.canonical.z;return n.overscaledZ===0||n.overscaledZ<this.overscaledZ&&n.canonical.z<this.canonical.z&&n.canonical.x===this.canonical.x>>a&&n.canonical.y===this.canonical.y>>a}children(n){if(this.overscaledZ>=n)return[new si(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,h=2*this.canonical.x,v=2*this.canonical.y;return[new si(a,this.wrap,a,h,v),new si(a,this.wrap,a,h+1,v),new si(a,this.wrap,a,h,v+1),new si(a,this.wrap,a,h+1,v+1)]}isLessThan(n){return this.wrap<n.wrap||!(this.wrap>n.wrap)&&(this.overscaledZ<n.overscaledZ||!(this.overscaledZ>n.overscaledZ)&&(this.canonical.x<n.canonical.x||!(this.canonical.x>n.canonical.x)&&this.canonical.y<n.canonical.y))}wrapped(){return new si(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(n){return new si(this.overscaledZ,n,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Mi(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Ii(c,n,a,h,v){const f=1<<Math.min(a,22);let x=f*(v%f)+h%f;return c&&a<22&&(x+=f*f*((c<0?-2*c-1:2*c)%(1<<2*(22-a)))),16*(32*x+a)+(n-a)}const Ai=[c=>{let n=c.canonical.x-1,a=c.wrap;return n<0&&(n=(1<<c.canonical.z)-1,a--),new si(c.overscaledZ,a,c.canonical.z,n,c.canonical.y)},c=>{let n=c.canonical.x+1,a=c.wrap;return n===1<<c.canonical.z&&(n=0,a++),new si(c.overscaledZ,a,c.canonical.z,n,c.canonical.y)},c=>new si(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,(c.canonical.y===0?1<<c.canonical.z:c.canonical.y)-1),c=>new si(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,c.canonical.y===(1<<c.canonical.z)-1?0:c.canonical.y+1)];ki(wn,"CanonicalTileID"),ki(si,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const ur=Bt([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Xi}=ur,er=Bt([{name:"a_pos_3",components:3,type:"Int16"}]);var dr=Bt([{name:"a_pos",type:"Int16",components:2}]);class Ur{constructor(n,a){this.pos=n,this.dir=a}intersectsPlane(n,a,h){const v=ht.vec3.dot(a,this.dir);if(Math.abs(v)<1e-6)return!1;const f=((n[0]-this.pos[0])*a[0]+(n[1]-this.pos[1])*a[1]+(n[2]-this.pos[2])*a[2])/v;return h[0]=this.pos[0]+this.dir[0]*f,h[1]=this.pos[1]+this.dir[1]*f,h[2]=this.pos[2]+this.dir[2]*f,!0}closestPointOnSphere(n,a,h){if(ht.vec3.equals(this.pos,n)||a===0)return h[0]=h[1]=h[2]=0,!1;const[v,f,x]=this.dir,P=this.pos[0]-n[0],L=this.pos[1]-n[1],N=this.pos[2]-n[2],I=v*v+f*f+x*x,z=2*(P*v+L*f+N*x),F=z*z-4*I*(P*P+L*L+N*N-a*a);if(F<0){const R=Math.max(-z/2,0),O=P+v*R,q=L+f*R,te=N+x*R,ae=Math.hypot(O,q,te);return h[0]=O*a/ae,h[1]=q*a/ae,h[2]=te*a/ae,!1}{const R=(-z-Math.sqrt(F))/(2*I);if(R<0){const O=Math.hypot(P,L,N);return h[0]=P*a/O,h[1]=L*a/O,h[2]=N*a/O,!1}return h[0]=P+v*R,h[1]=L+f*R,h[2]=N+x*R,!0}}}class Mr{constructor(n,a,h,v,f){this.TL=n,this.TR=a,this.BR=h,this.BL=v,this.horizon=f}static fromInvProjectionMatrix(n,a,h){const v=[-1,1,1],f=[1,1,1],x=[1,-1,1],P=[-1,-1,1],L=ht.vec3.transformMat4(v,v,n),N=ht.vec3.transformMat4(f,f,n),I=ht.vec3.transformMat4(x,x,n),z=ht.vec3.transformMat4(P,P,n);return new Mr(L,N,I,z,a/h)}}function Ea(c,n,a){let h=1/0,v=-1/0;const f=[];for(const x of c){ht.vec3.sub(f,x,n);const P=ht.vec3.dot(f,a);h=Math.min(h,P),v=Math.max(v,P)}return[h,v]}function za(c,n){let a=!0;for(let h=0;h<c.planes.length;h++){const v=c.planes[h];let f=0;for(let x=0;x<n.length;x++)f+=ht.vec3.dot(v,n[x])+v[3]>=0;if(f===0)return 0;f!==n.length&&(a=!1)}return a?2:1}function ra(c,n){for(const a of c.projections){const h=Ea(n,c.points[0],a.axis);if(a.projection[1]<h[0]||a.projection[0]>h[1])return 0}return 1}function ha(c,n){let a=0;const h=[0,0,0,0];for(let v=0;v<c.length;v++)h[0]=c[v][0],h[1]=c[v][1],h[2]=c[v][2],h[3]=1,ht.vec4.dot(h,n)>=0&&a++;return a}class br{constructor(n,a){this.points=n||new Array(8).fill([0,0,0]),this.planes=a||new Array(6).fill([0,0,0,0]),this.bounds=nr.fromPoints(this.points),this.projections=[],this.frustumEdges=[ht.vec3.sub([],this.points[2],this.points[3]),ht.vec3.sub([],this.points[0],this.points[3]),ht.vec3.sub([],this.points[4],this.points[0]),ht.vec3.sub([],this.points[5],this.points[1]),ht.vec3.sub([],this.points[6],this.points[2]),ht.vec3.sub([],this.points[7],this.points[3])];for(const h of this.frustumEdges){const v=[0,-h[2],h[1]],f=[h[2],0,-h[0]];this.projections.push({axis:v,projection:Ea(this.points,this.points[0],v)}),this.projections.push({axis:f,projection:Ea(this.points,this.points[0],f)})}}static fromInvProjectionMatrix(n,a,h,v){const f=Math.pow(2,h),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(N=>{const I=ht.vec4.transformMat4([],N,n),z=1/I[3]/a*f;return ht.vec4.mul(I,I,[z,z,v?1/I[3]:z,z])}),P=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(N=>{const I=ht.vec3.sub([],x[N[0]],x[N[1]]),z=ht.vec3.sub([],x[N[2]],x[N[1]]),F=ht.vec3.normalize([],ht.vec3.cross([],I,z)),R=-ht.vec3.dot(F,x[N[1]]);return F.concat(R)}),L=[];for(let N=0;N<x.length;N++)L.push([x[N][0],x[N][1],x[N][2]]);return new br(L,P)}intersectsPrecise(n,a,h){for(let v=0;v<a.length;v++)if(!ha(n,a[v]))return 0;for(let v=0;v<this.planes.length;v++)if(!ha(n,this.planes[v]))return 0;for(const v of h)for(const f of this.frustumEdges){const x=ht.vec3.cross([],v,f),P=ht.vec3.length(x);if(P===0)continue;ht.vec3.scale(x,x,1/P);const L=Ea(this.points,this.points[0],x),N=Ea(n,this.points[0],x);if(L[0]>N[1]||N[0]>L[1])return 0}return 1}containsPoint(n){for(const a of this.planes){const h=a[3];if(ht.vec3.dot([a[0],a[1],a[2]],n)+h<0)return!1}return!0}}class nr{static fromPoints(n){const a=[1/0,1/0,1/0],h=[-1/0,-1/0,-1/0];for(const v of n)ht.vec3.min(a,a,v),ht.vec3.max(h,h,v);return new nr(a,h)}static fromTileIdAndHeight(n,a,h){const v=1<<n.canonical.z,f=n.canonical.x,x=n.canonical.y;return new nr([f/v,x/v,a],[(f+1)/v,(x+1)/v,h])}static applyTransform(n,a){const h=n.getCorners();for(let v=0;v<h.length;++v)ht.vec3.transformMat4(h[v],h[v],a);return nr.fromPoints(h)}static applyTransformFast(n,a){const h=[a[12],a[13],a[14]],v=[...h];for(let f=0;f<3;f++)for(let x=0;x<3;x++){const P=a[4*x+f],L=P*n.min[x],N=P*n.max[x];h[f]+=Math.min(L,N),v[f]+=Math.max(L,N)}return new nr(h,v)}static projectAabbCorners(n,a){const h=n.getCorners();for(let v=0;v<h.length;++v)ht.vec3.transformMat4(h[v],h[v],a);return h}constructor(n,a){this.min=n,this.max=a,this.center=ht.vec3.scale([],ht.vec3.add([],this.min,this.max),.5)}quadrant(n){const a=[n%2==0,n<2],h=ht.vec3.clone(this.min),v=ht.vec3.clone(this.max);for(let f=0;f<a.length;f++)h[f]=a[f]?this.min[f]:this.center[f],v[f]=a[f]?this.center[f]:this.max[f];return v[2]=this.max[2],new nr(h,v)}distanceX(n){return Math.max(Math.min(this.max[0],n[0]),this.min[0])-n[0]}distanceY(n){return Math.max(Math.min(this.max[1],n[1]),this.min[1])-n[1]}distanceZ(n){return Math.max(Math.min(this.max[2],n[2]),this.min[2])-n[2]}getCorners(){const n=this.min,a=this.max;return[[n[0],n[1],n[2]],[a[0],n[1],n[2]],[a[0],a[1],n[2]],[n[0],a[1],n[2]],[n[0],n[1],a[2]],[a[0],n[1],a[2]],[a[0],a[1],a[2]],[n[0],a[1],a[2]]]}intersects(n){return this.intersectsAabb(n.bounds)?za(n,this.getCorners()):0}intersectsFlat(n){return this.intersectsAabb(n.bounds)?za(n,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(n,a){return a||this.intersects(n)?ra(n,this.getCorners()):0}intersectsPreciseFlat(n,a){return a||this.intersectsFlat(n)?ra(n,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(n){for(let a=0;a<3;++a)if(this.min[a]>n.max[a]||n.min[a]>this.max[a])return!1;return!0}intersectsAabbXY(n){return!(this.min[0]>n.max[0]||n.min[0]>this.max[0]||this.min[1]>n.max[1]||n.min[1]>this.max[1])}encapsulate(n){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],n.min[a]),this.max[a]=Math.max(this.max[a],n.max[a])}encapsulatePoint(n){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],n[a]),this.max[a]=Math.max(this.max[a],n[a])}closestPoint(n){return[Math.max(Math.min(this.max[0],n[0]),this.min[0]),Math.max(Math.min(this.max[1],n[1]),this.min[1]),Math.max(Math.min(this.max[2],n[2]),this.min[2])]}}function ea(c){return c*yl/Sp}ki(nr,"Aabb");const ta=[new nr([qc,qc,qc],[Hc,Hc,Hc]),new nr([qc,qc,qc],[0,0,Hc]),new nr([0,qc,qc],[Hc,0,Hc]),new nr([qc,0,qc],[0,Hc,Hc]),new nr([0,0,qc],[Hc,Hc,Hc])];function Xa(c,n,a,h=!0){const v=ht.vec3.scale([],c._camera.position,c.worldSize),f=[n,a,1,1];ht.vec4.transformMat4(f,f,c.pixelMatrixInverse),ht.vec4.scale(f,f,1/f[3]);const x=ht.vec3.sub([],f,v),P=ht.vec3.normalize([],x),L=c.globeMatrix,N=[L[12],L[13],L[14]],I=ht.vec3.sub([],N,v),z=ht.vec3.length(I),F=ht.vec3.normalize([],I),R=c.worldSize/(2*Math.PI),O=ht.vec3.dot(F,P),q=Math.asin(R/z);if(q<Math.acos(O)){if(!h)return null;const Ct=[],ct=[];ht.vec3.scale(Ct,P,z/O),ht.vec3.normalize(ct,ht.vec3.sub(ct,Ct,I)),ht.vec3.normalize(P,ht.vec3.add(P,I,ht.vec3.scale(P,ct,Math.tan(q)*z)))}const te=[];new Ur(v,P).closestPointOnSphere(N,R,te);const ae=ht.vec3.normalize([],Gn(L,0)),ge=ht.vec3.normalize([],Gn(L,1)),_e=ht.vec3.normalize([],Gn(L,2)),he=ht.vec3.dot(ae,te),xe=ht.vec3.dot(ge,te),Te=ht.vec3.dot(_e,te),Ae=vi(Math.asin(-xe/R));let tt=vi(Math.atan2(he,Te));tt=c.center.lng+function(Ct,ct){const It=(ct-Ct+180)%360-180;return It<-180?It+360:It}(c.center.lng,tt);const Ke=ch(tt),Ye=ui(Ga(Ae),0,1);return new y(Ke,Ye)}class bo{constructor(n,a,h){this.a=ht.vec3.sub([],n,h),this.b=ht.vec3.sub([],a,h),this.center=h;const v=ht.vec3.normalize([],this.a),f=ht.vec3.normalize([],this.b);this.angle=Math.acos(ht.vec3.dot(v,f))}}function vl(c,n){if(c.angle===0)return null;let a;return a=c.a[n]===0?1/c.angle*.5*Math.PI:1/c.angle*Math.atan(c.b[n]/c.a[n]/Math.sin(c.angle)-1/Math.tan(c.angle)),a<0||a>1?null:function(h,v,f,x){const P=Math.sin(f);return h*(Math.sin((1-x)*f)/P)+v*(Math.sin(x*f)/P)}(c.a[n],c.b[n],c.angle,ui(a,0,1))+c.center[n]}function Ls(c){if(c.z<=1)return ta[c.z+2*c.y+c.x];const n=fa(wa(c));return nr.fromPoints(n)}function wo(c,n,a){return ht.vec3.scale(c,c,1-a),ht.vec3.scaleAndAdd(c,c,n,a)}function qo(c,n,a){for(const h of c)ht.vec3.transformMat4(h,h,n),ht.vec3.scale(h,h,a)}function ys(c,n,a,h){const v=n/c.worldSize,f=c.globeMatrix;if(a.z<=1){const Ke=Ls(a).getCorners();return qo(Ke,f,v),nr.fromPoints(Ke)}const x=wa(a,h),P=fa(x,yl+ea(c._tileCoverLift));qo(P,f,v);const L=Number.MAX_VALUE,N=[-L,-L,-L],I=[L,L,L];if(x.contains(c.center)){for(const Ct of P)ht.vec3.min(I,I,Ct),ht.vec3.max(N,N,Ct);N[2]=0;const Ke=c.point,Ye=[Ke.x*v,Ke.y*v,0];return ht.vec3.min(I,I,Ye),ht.vec3.max(N,N,Ye),new nr(I,N)}if(c._tileCoverLift>0){for(const Ke of P)ht.vec3.min(I,I,Ke),ht.vec3.max(N,N,Ke);return new nr(I,N)}const z=[f[12]*v,f[13]*v,f[14]*v],F=x.getCenter(),R=ui(c.center.lat,-85.051129,xo),O=ui(F.lat,-85.051129,xo),q=ch(c.center.lng),te=Ga(R);let ae=q-ch(F.lng);const ge=te-Ga(O);ae>.5?ae-=1:ae<-.5&&(ae+=1);let _e=0;if(Math.abs(ae)>Math.abs(ge))_e=ae>=0?1:3;else{_e=ge>=0?0:2;const Ke=[f[4]*v,f[5]*v,f[6]*v],Ye=-Math.sin(zn(ge>=0?x.getSouth():x.getNorth()))*yl;ht.vec3.scaleAndAdd(z,z,Ke,Ye)}const he=P[_e],xe=P[(_e+1)%4],Te=new bo(he,xe,z),Ae=[vl(Te,0)||he[0],vl(Te,1)||he[1],vl(Te,2)||he[2]],tt=Ho(c.zoom);if(tt>0){const Ke=function({x:Ct,y:ct,z:It},Rt,At,Vt,Wt){const Kt=1/(1<<It);let qt=Ct*Kt,yn=qt+Kt,Yn=ct*Kt,xn=Yn+Kt,di=0;const ci=(qt+yn)/2-Vt;return ci>.5?di=-1:ci<-.5&&(di=1),qt=((qt+di)*Rt-(Vt*=Rt))*At+Vt,yn=((yn+di)*Rt-Vt)*At+Vt,Yn=(Yn*Rt-(Wt*=Rt))*At+Wt,xn=(xn*Rt-Wt)*At+Wt,[[qt,xn,0],[yn,xn,0],[yn,Yn,0],[qt,Yn,0]]}(a,n,c._pixelsPerMercatorPixel,q,te);for(let Ct=0;Ct<P.length;Ct++)wo(P[Ct],Ke[Ct],tt);const Ye=ht.vec3.add([],Ke[_e],Ke[(_e+1)%4]);ht.vec3.scale(Ye,Ye,.5),wo(Ae,Ye,tt)}for(const Ke of P)ht.vec3.min(I,I,Ke),ht.vec3.max(N,N,Ke);return I[2]=Math.min(he[2],xe[2]),ht.vec3.min(I,I,Ae),ht.vec3.max(N,N,Ae),new nr(I,N)}function wa({x:c,y:n,z:a},h=!1){const v=1/(1<<a),f=new Kr(Nl(c*v),n===(1<<a)-1&&h?-90:Ws((n+1)*v)),x=new Kr(Nl((c+1)*v),n===0&&h?90:Ws(n*v));return new lh(f,x)}function fa(c,n=yl){const a=zn(c.getNorth()),h=zn(c.getSouth()),v=Math.cos(a),f=Math.cos(h),x=Math.sin(a),P=Math.sin(h),L=c.getWest(),N=c.getEast();return[wp(f,P,L,n),wp(f,P,N,n),wp(v,x,N,n),wp(v,x,L,n)]}function $r(c,n,a,h){const v=1<<a.z,f=(c/mi+a.x)/v;return Pd(Ws((n/mi+a.y)/v),Nl(f),h)}function is({min:c,max:n}){return qg/Math.max(n[0]-c[0],n[1]-c[1],n[2]-c[2])}const So=new Float64Array(16);function Lr(c){const n=is(c),a=ht.mat4.fromScaling(So,[n,n,n]);return ht.mat4.translate(a,a,ht.vec3.negate([],c.min))}function Fo(c){const n=ht.mat4.fromTranslation(So,c.min),a=1/is(c);return ht.mat4.scale(n,n,[a,a,a])}function Tc(c){const n=mi/(2*Math.PI);return c/(2*Math.PI)/n}function jl(c,n){return mi/(512*Math.pow(2,c))*is(Ls(n))}function Su(c,n,a,h,v){const f=Tc(a),x=[c,n,-a/(2*Math.PI)],P=ht.mat4.identity(new Float64Array(16));return ht.mat4.translate(P,P,x),ht.mat4.scale(P,P,[f,f,f]),ht.mat4.rotateX(P,P,zn(-v)),ht.mat4.rotateY(P,P,zn(-h)),P}function Ho(c){return pr(bp,Km,c)}function Tu(c,n){const a=Pd(n.lat,n.lng),h=function(f){const x=Pd(f._center.lat,f._center.lng),P=ht.vec3.fromValues(0,1,0);let L=ht.vec3.cross([],P,x);const N=ht.mat4.fromRotation([],-f.angle,x);L=ht.vec3.transformMat4(L,L,N),ht.mat4.fromRotation(N,-f._pitch,L);const I=ht.vec3.normalize([],x);return ht.vec3.scale(I,I,ea(f.cameraToCenterDistance/f.pixelsPerMeter)),ht.vec3.transformMat4(I,I,N),ht.vec3.add([],x,I)}(c),v=ht.vec3.subtract([],h,a);return ht.vec3.angle(v,a)}function ac(c,n){return Tu(c,n)>Math.PI/2*1.01}const Ad=zn(85),uh=Math.cos(Ad),kd=Math.sin(Ad),Bo=ht.mat4.create(),Tp=c=>{const n=[];return c.paint.get("circle-pitch-alignment")==="map"&&n.push("PITCH_WITH_MAP"),c.paint.get("circle-pitch-scale")==="map"&&n.push("SCALE_WITH_MAP"),n};function hm(c,n,a,h,v,f,x,P,L){if(f&&c.queryGeometry.isAboveHorizon)return!1;f&&(L*=c.pixelToTileUnitsFactor);const N=c.tileID.canonical,I=a.projection.upVectorScale(N,a.center.lat,a.worldSize).metersToTile;for(const z of n)for(const F of z){const R=F.add(P),O=v&&a.elevation?a.elevation.exaggeration()*v.getElevationAt(R.x,R.y,!0):0,q=a.projection.projectTilePoint(R.x,R.y,N);if(O>0){const _e=a.projection.upVector(N,R.x,R.y);q.x+=_e[0]*I*O,q.y+=_e[1]*I*O,q.z+=_e[2]*I*O}const te=f?R:Cp(q.x,q.y,q.z,h),ae=f?c.tilespaceRays.map(_e=>Jm(_e,O)):c.queryGeometry.screenGeometry,ge=ht.vec4.transformMat4([],[q.x,q.y,q.z,1],h);if(!x&&f?L*=ge[3]/a.cameraToCenterDistance:x&&!f&&(L*=a.cameraToCenterDistance/ge[3]),f){const _e=Ws((F.y/mi+N.y)/(1<<N.z));L/=a.projection.pixelsPerMeter(_e,1)/ao(1,_e)}if(De(ae,te,L))return!0}return!1}function Cp(c,n,a,h){const v=ht.vec4.transformMat4([],[c,n,a,1],h);return new at(v[0]/v[3],v[1]/v[3])}const Wg=ht.vec3.fromValues(0,0,0),Xg=ht.vec3.fromValues(0,0,1);function Jm(c,n){const a=ht.vec3.create();return Wg[2]=n,c.intersectsPlane(Wg,Xg,a),new at(a[0],a[1])}class Yg extends Se{}let Kg,Ab,kb,Mv;function Iv(c,{width:n,height:a},h,v){if(v){if(v instanceof Uint8ClampedArray)v=new Uint8Array(v.buffer);else if(v.length!==n*a*h)throw new RangeError("mismatched image size")}else v=new Uint8Array(n*a*h);return c.width=n,c.height=a,c.data=v,c}function Db(c,n,a){const{width:h,height:v}=n;h===c.width&&v===c.height||(cy(c,n,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,h),height:Math.min(c.height,v)},a,null),c.width=h,c.height=v,c.data=n.data)}function cy(c,n,a,h,v,f,x,P){if(v.width===0||v.height===0)return n;if(v.width>c.width||v.height>c.height||a.x>c.width-v.width||a.y>c.height-v.height)throw new RangeError("out of range source coordinates for image copy");if(v.width>n.width||v.height>n.height||h.x>n.width-v.width||h.y>n.height-v.height)throw new RangeError("out of range destination coordinates for image copy");const L=c.data,N=n.data,I=f===4&&P;for(let z=0;z<v.height;z++){const F=((a.y+z)*c.width+a.x)*f,R=((h.y+z)*n.width+h.x)*f;if(I)for(let O=0;O<v.width;O++){const q=F+O*f+3,te=R+O*f;N[te+0]=255,N[te+1]=255,N[te+2]=255,N[te+3]=L[q]}else if(x)for(let O=0;O<v.width;O++){const q=F+O*f,te=R+O*f,ae=L[q+3],ge=new Or(L[q+0]/255*ae,L[q+1]/255*ae,L[q+2]/255*ae,ae).toRenderColor(x).toArray();N[te+0]=ge[0],N[te+1]=ge[1],N[te+2]=ge[2],N[te+3]=ge[3]}else for(let O=0;O<v.width*f;O++)N[R+O]=L[F+O]}return n}ki(Yg,"HeatmapBucket",{omit:["layers"]});class wf{constructor(n,a){Iv(this,n,1,a)}resize(n){Db(this,new wf(n),1)}clone(){return new wf({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,a,h,v,f){cy(n,a,h,v,f,1,null)}}class Zo{constructor(n,a){Iv(this,n,4,a)}resize(n){Db(this,new Zo(n),4)}replace(n,a){a?this.data.set(n):this.data=n instanceof Uint8ClampedArray?new Uint8Array(n.buffer):n}clone(){return new Zo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(n,a,h,v,f,x,P){cy(n,a,h,v,f,4,x,P)}}class uy{constructor(n,a){this.width=n.width,this.height=n.height,this.data=a instanceof Uint8Array?new Float32Array(a.buffer):a}}function Jg(c){const n={},a=c.resolution||256,h=c.clips?c.clips.length:1,v=c.image||new Zo({width:a,height:h}),f=(x,P,L)=>{n[c.evaluationKey]=L;const N=c.expression.evaluate(n);N&&(v.data[x+P+0]=Math.floor(255*N.r/N.a),v.data[x+P+1]=Math.floor(255*N.g/N.a),v.data[x+P+2]=Math.floor(255*N.b/N.a),v.data[x+P+3]=Math.floor(255*N.a))};if(c.clips)for(let x=0,P=0;x<h;++x,P+=4*a)for(let L=0,N=0;L<a;L++,N+=4){const I=L/(a-1),{start:z,end:F}=c.clips[x];f(P,N,z*(1-I)+F*I)}else for(let x=0,P=0;x<a;x++,P+=4)f(0,P,x/(a-1));return v}ki(wf,"AlphaImage"),ki(Zo,"RGBAImage");const Rb=Bt([{name:"a_pos",components:2,type:"Int16"}],4),{members:zw}=Rb;function Qg(c,n,a=2){const h=n&&n.length,v=h?n[0]*a:c.length;let f=Lb(c,0,v,a,!0);const x=[];if(!f||f.next===f.prev)return x;let P,L,N;if(h&&(f=function(I,z,F,R){const O=[];for(let q=0,te=z.length;q<te;q++){const ae=Lb(I,z[q]*R,q<te-1?z[q+1]*R:I.length,R,!1);ae===ae.next&&(ae.steiner=!0),O.push(Ow(ae))}O.sort(Ep);for(let q=0;q<O.length;q++)F=Fb(O[q],F);return F}(c,n,f,a)),c.length>80*a){P=1/0,L=1/0;let I=-1/0,z=-1/0;for(let F=a;F<v;F+=a){const R=c[F],O=c[F+1];R<P&&(P=R),O<L&&(L=O),R>I&&(I=R),O>z&&(z=O)}N=Math.max(I-P,z-L),N=N!==0?32767/N:0}return e_(f,x,a,P,L,N,0),x}function Lb(c,n,a,h,v){let f;if(v===function(x,P,L,N){let I=0;for(let z=P,F=L-N;z<L;z+=N)I+=(x[F]-x[z])*(x[z+1]+x[F+1]),F=z;return I}(c,n,a,h)>0)for(let x=n;x<a;x+=h)f=Dv(x/h|0,c[x],c[x+1],f);else for(let x=a-h;x>=n;x-=h)f=Dv(x/h|0,c[x],c[x+1],f);return f&&Qm(f,f.next)&&(Mp(f),f=f.next),f}function dm(c,n){if(!c)return c;n||(n=c);let a,h=c;do if(a=!1,h.steiner||!Qm(h,h.next)&&so(h.prev,h,h.next)!==0)h=h.next;else{if(Mp(h),h=n=h.prev,h===h.next)break;a=!0}while(a||h!==n);return n}function e_(c,n,a,h,v,f,x){if(!c)return;!x&&f&&function(L,N,I,z){let F=L;do F.z===0&&(F.z=Av(F.x,F.y,N,I,z)),F.prevZ=F.prev,F.nextZ=F.next,F=F.next;while(F!==L);F.prevZ.nextZ=null,F.prevZ=null,function(R){let O,q=1;do{let te,ae=R;R=null;let ge=null;for(O=0;ae;){O++;let _e=ae,he=0;for(let Te=0;Te<q&&(he++,_e=_e.nextZ,_e);Te++);let xe=q;for(;he>0||xe>0&&_e;)he!==0&&(xe===0||!_e||ae.z<=_e.z)?(te=ae,ae=ae.nextZ,he--):(te=_e,_e=_e.nextZ,xe--),ge?ge.nextZ=te:R=te,te.prevZ=ge,ge=te;ae=_e}ge.nextZ=null,q*=2}while(O>1)}(F)}(c,h,v,f);let P=c;for(;c.prev!==c.next;){const L=c.prev,N=c.next;if(f?Ob(c,h,v,f):zb(c))n.push(L.i,c.i,N.i),Mp(c),c=N.next,P=N.next;else if((c=N)===P){x?x===1?e_(c=t_(dm(c),n),n,a,h,v,f,2):x===2&&Dd(c,n,a,h,v,f):e_(dm(c),n,a,h,v,f,1);break}}}function zb(c){const n=c.prev,a=c,h=c.next;if(so(n,a,h)>=0)return!1;const v=n.x,f=a.x,x=h.x,P=n.y,L=a.y,N=h.y,I=v<f?v<x?v:x:f<x?f:x,z=P<L?P<N?P:N:L<N?L:N,F=v>f?v>x?v:x:f>x?f:x,R=P>L?P>N?P:N:L>N?L:N;let O=h.next;for(;O!==n;){if(O.x>=I&&O.x<=F&&O.y>=z&&O.y<=R&&Sf(v,P,f,L,x,N,O.x,O.y)&&so(O.prev,O,O.next)>=0)return!1;O=O.next}return!0}function Ob(c,n,a,h){const v=c.prev,f=c,x=c.next;if(so(v,f,x)>=0)return!1;const P=v.x,L=f.x,N=x.x,I=v.y,z=f.y,F=x.y,R=P<L?P<N?P:N:L<N?L:N,O=I<z?I<F?I:F:z<F?z:F,q=P>L?P>N?P:N:L>N?L:N,te=I>z?I>F?I:F:z>F?z:F,ae=Av(R,O,n,a,h),ge=Av(q,te,n,a,h);let _e=c.prevZ,he=c.nextZ;for(;_e&&_e.z>=ae&&he&&he.z<=ge;){if(_e.x>=R&&_e.x<=q&&_e.y>=O&&_e.y<=te&&_e!==v&&_e!==x&&Sf(P,I,L,z,N,F,_e.x,_e.y)&&so(_e.prev,_e,_e.next)>=0||(_e=_e.prevZ,he.x>=R&&he.x<=q&&he.y>=O&&he.y<=te&&he!==v&&he!==x&&Sf(P,I,L,z,N,F,he.x,he.y)&&so(he.prev,he,he.next)>=0))return!1;he=he.nextZ}for(;_e&&_e.z>=ae;){if(_e.x>=R&&_e.x<=q&&_e.y>=O&&_e.y<=te&&_e!==v&&_e!==x&&Sf(P,I,L,z,N,F,_e.x,_e.y)&&so(_e.prev,_e,_e.next)>=0)return!1;_e=_e.prevZ}for(;he&&he.z<=ge;){if(he.x>=R&&he.x<=q&&he.y>=O&&he.y<=te&&he!==v&&he!==x&&Sf(P,I,L,z,N,F,he.x,he.y)&&so(he.prev,he,he.next)>=0)return!1;he=he.nextZ}return!0}function t_(c,n){let a=c;do{const h=a.prev,v=a.next.next;!Qm(h,v)&&hy(h,a,a.next,v)&&eg(h,v)&&eg(v,h)&&(n.push(h.i,a.i,v.i),Mp(a),Mp(a.next),a=c=v),a=a.next}while(a!==c);return dm(a)}function Dd(c,n,a,h,v,f){let x=c;do{let P=x.next.next;for(;P!==x.prev;){if(x.i!==P.i&&kv(x,P)){let L=dy(x,P);return x=dm(x,x.next),L=dm(L,L.next),e_(x,n,a,h,v,f,0),void e_(L,n,a,h,v,f,0)}P=P.next}x=x.next}while(x!==c)}function Ep(c,n){return c.x-n.x}function Fb(c,n){const a=function(v,f){let x=f;const P=v.x,L=v.y;let N,I=-1/0;do{if(L<=x.y&&L>=x.next.y&&x.next.y!==x.y){const q=x.x+(L-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(q<=P&&q>I&&(I=q,N=x.x<x.next.x?x:x.next,q===P))return N}x=x.next}while(x!==f);if(!N)return null;const z=N,F=N.x,R=N.y;let O=1/0;x=N;do{if(P>=x.x&&x.x>=F&&P!==x.x&&Sf(L<R?P:I,L,F,R,L<R?I:P,L,x.x,x.y)){const q=Math.abs(L-x.y)/(P-x.x);eg(x,v)&&(q<O||q===O&&(x.x>N.x||x.x===N.x&&Pv(N,x)))&&(N=x,O=q)}x=x.next}while(x!==z);return N}(c,n);if(!a)return n;const h=dy(a,c);return dm(h,h.next),dm(a,a.next)}function Pv(c,n){return so(c.prev,c,n.prev)<0&&so(n.next,c,c.next)<0}function Av(c,n,a,h,v){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-a)*v|0)|c<<8))|c<<4))|c<<2))|c<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-h)*v|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function Ow(c){let n=c,a=c;do(n.x<a.x||n.x===a.x&&n.y<a.y)&&(a=n),n=n.next;while(n!==c);return a}function Sf(c,n,a,h,v,f,x,P){return(v-x)*(n-P)>=(c-x)*(f-P)&&(c-x)*(h-P)>=(a-x)*(n-P)&&(a-x)*(f-P)>=(v-x)*(h-P)}function kv(c,n){return c.next.i!==n.i&&c.prev.i!==n.i&&!function(a,h){let v=a;do{if(v.i!==a.i&&v.next.i!==a.i&&v.i!==h.i&&v.next.i!==h.i&&hy(v,v.next,a,h))return!0;v=v.next}while(v!==a);return!1}(c,n)&&(eg(c,n)&&eg(n,c)&&function(a,h){let v=a,f=!1;const x=(a.x+h.x)/2,P=(a.y+h.y)/2;do v.y>P!=v.next.y>P&&v.next.y!==v.y&&x<(v.next.x-v.x)*(P-v.y)/(v.next.y-v.y)+v.x&&(f=!f),v=v.next;while(v!==a);return f}(c,n)&&(so(c.prev,c,n.prev)||so(c,n.prev,n))||Qm(c,n)&&so(c.prev,c,c.next)>0&&so(n.prev,n,n.next)>0)}function so(c,n,a){return(n.y-c.y)*(a.x-n.x)-(n.x-c.x)*(a.y-n.y)}function Qm(c,n){return c.x===n.x&&c.y===n.y}function hy(c,n,a,h){const v=n_(so(c,n,a)),f=n_(so(c,n,h)),x=n_(so(a,h,c)),P=n_(so(a,h,n));return v!==f&&x!==P||!(v!==0||!Tf(c,a,n))||!(f!==0||!Tf(c,h,n))||!(x!==0||!Tf(a,c,h))||!(P!==0||!Tf(a,n,h))}function Tf(c,n,a){return n.x<=Math.max(c.x,a.x)&&n.x>=Math.min(c.x,a.x)&&n.y<=Math.max(c.y,a.y)&&n.y>=Math.min(c.y,a.y)}function n_(c){return c>0?1:c<0?-1:0}function eg(c,n){return so(c.prev,c,c.next)<0?so(c,n,c.next)>=0&&so(c,c.prev,n)>=0:so(c,n,c.prev)<0||so(c,c.next,n)<0}function dy(c,n){const a=fy(c.i,c.x,c.y),h=fy(n.i,n.x,n.y),v=c.next,f=n.prev;return c.next=n,n.prev=c,a.next=v,v.prev=a,h.next=a,a.prev=h,f.next=h,h.prev=f,h}function Dv(c,n,a,h){const v=fy(c,n,a);return h?(v.next=h.next,v.prev=h,h.next.prev=v,h.next=v):(v.prev=v,v.next=v),v}function Mp(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function fy(c,n,a){return{i:c,x:n,y:a,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function py(c,n){const a=c.length;if(a<=1)return[c];const h=[];let v,f;for(let x=0;x<a;x++){const P=on(c[x]);P!==0&&(c[x].area=Math.abs(P),f===void 0&&(f=P<0),f===P<0?(v&&h.push(v),v=[c[x]]):v.push(c[x]))}if(v&&h.push(v),n>1)for(let x=0;x<h.length;x++)h[x].length<=n||(id(h[x],n,1,h[x].length-1,Fw),h[x]=h[x].slice(0,n));return h}function Fw(c,n){return n.area-c.area}function Rv(c,n){if(!c)return null;const a=typeof c=="string"?c:c.getPrimary().id;n[a]||(n[a]=[]);const h=Oa.from(c).getPrimary();return n[a].push(h),h.serialize()}function Lv(c,n,a){const h=a.patternDependencies;let v=!1;for(const f of n){const x=f.paint.get(`${c}-pattern`);x.isConstant()||(v=!0),Rv(x.constantOr(null),h)&&(v=!0)}return v}function zv(c,n,a,h,v){const f=v.patternDependencies;for(const x of n){const P=x.paint.get(`${c}-pattern`).value;if(P.kind!=="constant"){let L=P.evaluate({zoom:h},a,{},v.availableImages);L=L&&L.name?L.name:L;const N=Rv(L,f);N&&(a.patterns[x.id]=N)}}return a}class Ov{constructor(n){this.zoom=n.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=n.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new rn,this.indexArray=new Wr,this.indexArray2=new Ma,this.programConfigurations=new oh(n.layers,{zoom:n.zoom,lut:n.lut}),this.segments=new Wa,this.segments2=new Wa,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.projection=n.projection}updateFootprints(n,a){}populate(n,a,h,v){this.hasPattern=Lv("fill",this.layers,a);const f=this.layers[0].layout.get("fill-sort-key"),x=[];for(const{feature:P,id:L,index:N,sourceLayerIndex:I}of n){const z=this.layers[0]._featureFilter.needGeometry,F=le(P,z);if(!this.layers[0]._featureFilter.filter(new ba(this.zoom),F,h))continue;const R=f?f.evaluate(F,{},h,a.availableImages):void 0,O={id:L,properties:P.properties,type:P.type,sourceLayerIndex:I,index:N,geometry:z?F.geometry:se(P,h,v),patterns:{},sortKey:R};x.push(O)}f&&x.sort((P,L)=>P.sortKey-L.sortKey);for(const P of x){const{geometry:L,index:N,sourceLayerIndex:I}=P;if(this.hasPattern){const z=zv("fill",this.layers,P,this.zoom,a);this.patternFeatures.push(z)}else this.addFeature(P,L,N,h,{},a.availableImages,a.brightness);a.featureIndex.insert(n[N].feature,L,N,I,this.index)}}update(n,a,h,v,f,x,P){this.programConfigurations.updatePaintArrays(n,a,f,h,v,x,P)}addFeatures(n,a,h,v,f,x){for(const P of this.patternFeatures)this.addFeature(P,P.geometry,P.index,a,h,v,x)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,zw),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.indexBuffer2=n.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(n,a,h,v,f,x=[],P){for(const L of py(a,500)){let N=0;for(const q of L)N+=q.length;const I=this.segments.prepareSegment(N,this.layoutVertexArray,this.indexArray),z=I.vertexLength,F=[],R=[];for(const q of L){if(q.length===0)continue;q!==L[0]&&R.push(F.length/2);const te=this.segments2.prepareSegment(q.length,this.layoutVertexArray,this.indexArray2),ae=te.vertexLength;this.layoutVertexArray.emplaceBack(q[0].x,q[0].y),this.indexArray2.emplaceBack(ae+q.length-1,ae),F.push(q[0].x),F.push(q[0].y);for(let ge=1;ge<q.length;ge++)this.layoutVertexArray.emplaceBack(q[ge].x,q[ge].y),this.indexArray2.emplaceBack(ae+ge-1,ae+ge),F.push(q[ge].x),F.push(q[ge].y);te.vertexLength+=q.length,te.primitiveLength+=q.length}const O=Qg(F,R);for(let q=0;q<O.length;q+=3)this.indexArray.emplaceBack(z+O[q],z+O[q+1],z+O[q+2]);I.vertexLength+=N,I.primitiveLength+=O.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,h,f,x,v,P)}}let Bb,my,Cf,Fv;ki(Ov,"FillBucket",{omit:["layers","patternFeatures"]});class gy{constructor(n,a,h,v){if(this.triangleCount=a.length/3,this.min=new at(0,0),this.max=new at(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||n.length===0)return;const[f,x]=[n[0].clone(),n[0].clone()];for(let z=1;z<n.length;++z){const F=n[z];f.x=Math.min(f.x,F.x),f.y=Math.min(f.y,F.y),x.x=Math.max(x.x,F.x),x.y=Math.max(x.y,F.y)}if(v){const z=Math.ceil(Math.max(x.x-f.x,x.y-f.y)/v);h=Math.max(h,z)}if(h===0)return;this.min=f,this.max=x;const P=this.max.sub(this.min);P.x=Math.max(P.x,1),P.y=Math.max(P.y,1);const L=Math.max(P.x,P.y)/h;this.cellsX=Math.max(1,Math.ceil(P.x/L)),this.cellsY=Math.max(1,Math.ceil(P.y/L)),this.xScale=1/L,this.yScale=1/L;const N=[];for(let z=0;z<this.triangleCount;z++){const F=n[a[3*z+0]].sub(this.min),R=n[a[3*z+1]].sub(this.min),O=n[a[3*z+2]].sub(this.min),q=Oh(Math.floor(Math.min(F.x,R.x,O.x)),this.xScale,this.cellsX),te=Oh(Math.floor(Math.max(F.x,R.x,O.x)),this.xScale,this.cellsX),ae=Oh(Math.floor(Math.min(F.y,R.y,O.y)),this.yScale,this.cellsY),ge=Oh(Math.floor(Math.max(F.y,R.y,O.y)),this.yScale,this.cellsY),_e=new at(0,0),he=new at(0,0),xe=new at(0,0),Te=new at(0,0);for(let Ae=ae;Ae<=ge;++Ae){_e.y=he.y=Ae*L,xe.y=Te.y=(Ae+1)*L;for(let tt=q;tt<=te;++tt)_e.x=xe.x=tt*L,he.x=Te.x=(tt+1)*L,(zt(F,R,O,_e,he,Te)||zt(F,R,O,_e,Te,xe))&&N.push({cellIdx:Ae*this.cellsX+tt,triIdx:z})}}if(N.length===0)return;N.sort((z,F)=>z.cellIdx-F.cellIdx||z.triIdx-F.triIdx);let I=0;for(;I<N.length;){const z=N[I].cellIdx,F={start:this.payload.length,len:0};for(;I<N.length&&N[I].cellIdx===z;)++F.len,this.payload.push(N[I++].triIdx);this.cells[z]=F}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(n,a){if(this.triangleCount===0||this.cells.length===0||n.x>this.max.x||this.min.x>n.x||n.y>this.max.y||this.min.y>n.y)return;const h=Oh(n.x-this.min.x,this.xScale,this.cellsX),v=Oh(n.y-this.min.y,this.yScale,this.cellsY),f=this.cells[v*this.cellsX+h];if(f){this._lazyInitLookup();for(let x=0;x<f.len;x++){const P=this.payload[f.start+x],L=Math.floor(P/8),N=1<<P%8;if(!(this.lookup[L]&N)&&(this.lookup[L]|=N,a.push(P),a.length===this.triangleCount))return}}}query(n,a,h){if(this.triangleCount===0||this.cells.length===0||n.x>this.max.x||this.min.x>a.x||n.y>this.max.y||this.min.y>a.y)return;this._lazyInitLookup();const v=Oh(n.x-this.min.x,this.xScale,this.cellsX),f=Oh(a.x-this.min.x,this.xScale,this.cellsX),x=Oh(n.y-this.min.y,this.yScale,this.cellsY),P=Oh(a.y-this.min.y,this.yScale,this.cellsY);for(let L=x;L<=P;L++)for(let N=v;N<=f;N++){const I=this.cells[L*this.cellsX+N];if(I)for(let z=0;z<I.len;z++){const F=this.payload[I.start+z],R=Math.floor(F/8),O=1<<F%8;if(!(this.lookup[R]&O)&&(this.lookup[R]|=O,h.push(F),h.length===this.triangleCount))return}}}}function Oh(c,n,a){return Math.max(0,Math.min(a-1,Math.floor(c*n)))}ki(gy,"TriangleGridIndex");class Bv{constructor(n){this.zoom=n.zoom,this.layers=n.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=n.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.footprints=[]}updateFootprints(n,a){for(const h of this.footprints)a.push({footprint:h,id:n})}populate(n,a,h,v){const f=[];for(const{feature:x,id:P,index:L,sourceLayerIndex:N}of n){const I=this.layers[0]._featureFilter.needGeometry,z=le(x,I);if(!this.layers[0]._featureFilter.filter(new ba(this.zoom),z,h))continue;const F={id:P,properties:x.properties,type:x.type,sourceLayerIndex:N,index:L,geometry:I?z.geometry:se(x,h,v),patterns:{}};f.push(F)}for(const x of f){const{geometry:P,index:L,sourceLayerIndex:N}=x;this.addFeature(x,P,L,h,{},a.availableImages,a.brightness),a.featureIndex.insert(n[L].feature,P,L,N,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(n){}update(n,a,h,v,f,x,P){}destroy(){}addFeature(n,a,h,v,f,x=[],P){for(const L of py(a,2)){const N=[],I=[],z=[],F=new at(1/0,1/0),R=new at(-1/0,-1/0);for(const te of L)if(te.length!==0){te!==L[0]&&z.push(I.length/2);for(let ae=0;ae<te.length;ae++)I.push(te[ae].x),I.push(te[ae].y),N.push(te[ae]),F.x=Math.min(F.x,te[ae].x),F.y=Math.min(F.y,te[ae].y),R.x=Math.max(R.x,te[ae].x),R.y=Math.max(R.y,te[ae].y)}const O=Qg(I,z),q=new gy(N,O,8,256);this.footprints.push({vertices:N,indices:O,grid:q,min:F,max:R})}}}ki(Bv,"ClipBucket",{omit:["layers"]});const Vb=Bt([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Vv=Bt([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Nb=Bt([{name:"a_centroid_pos",components:2,type:"Uint16"}]),i_=Bt([{name:"a_join_normal_inside",components:3,type:"Int16"}]),jb=Bt([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),Nv=Bt([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Ub}=Vb;var Cc,fm,_y,jv,yy,Uv,$v,r_={};function $b(){if(fm)return Cc;fm=1;var c=mt();function n(v,f,x,P,L){this.properties={},this.extent=x,this.type=0,this._pbf=v,this._geometry=-1,this._keys=P,this._values=L,v.readFields(a,this,f)}function a(v,f,x){v==1?f.id=x.readVarint():v==2?function(P,L){for(var N=P.readVarint()+P.pos;P.pos<N;){var I=L._keys[P.readVarint()],z=L._values[P.readVarint()];L.properties[I]=z}}(x,f):v==3?f.type=x.readVarint():v==4&&(f._geometry=x.pos)}function h(v){for(var f,x,P=0,L=0,N=v.length,I=N-1;L<N;I=L++)P+=((x=v[I]).x-(f=v[L]).x)*(f.y+x.y);return P}return Cc=n,n.types=["Unknown","Point","LineString","Polygon"],n.prototype.loadGeometry=function(){var v=this._pbf;v.pos=this._geometry;for(var f,x=v.readVarint()+v.pos,P=1,L=0,N=0,I=0,z=[];v.pos<x;){if(L<=0){var F=v.readVarint();P=7&F,L=F>>3}if(L--,P===1||P===2)N+=v.readSVarint(),I+=v.readSVarint(),P===1&&(f&&z.push(f),f=[]),f.push(new c(N,I));else{if(P!==7)throw new Error("unknown command "+P);f&&f.push(f[0].clone())}}return f&&z.push(f),z},n.prototype.bbox=function(){var v=this._pbf;v.pos=this._geometry;for(var f=v.readVarint()+v.pos,x=1,P=0,L=0,N=0,I=1/0,z=-1/0,F=1/0,R=-1/0;v.pos<f;){if(P<=0){var O=v.readVarint();x=7&O,P=O>>3}if(P--,x===1||x===2)(L+=v.readSVarint())<I&&(I=L),L>z&&(z=L),(N+=v.readSVarint())<F&&(F=N),N>R&&(R=N);else if(x!==7)throw new Error("unknown command "+x)}return[I,F,z,R]},n.prototype.toGeoJSON=function(v,f,x){var P,L,N=this.extent*Math.pow(2,x),I=this.extent*v,z=this.extent*f,F=this.loadGeometry(),R=n.types[this.type];function O(ae){for(var ge=0;ge<ae.length;ge++){var _e=ae[ge];ae[ge]=[360*(_e.x+I)/N-180,360/Math.PI*Math.atan(Math.exp((180-360*(_e.y+z)/N)*Math.PI/180))-90]}}switch(this.type){case 1:var q=[];for(P=0;P<F.length;P++)q[P]=F[P][0];O(F=q);break;case 2:for(P=0;P<F.length;P++)O(F[P]);break;case 3:for(F=function(ae){var ge=ae.length;if(ge<=1)return[ae];for(var _e,he,xe=[],Te=0;Te<ge;Te++){var Ae=h(ae[Te]);Ae!==0&&(he===void 0&&(he=Ae<0),he===Ae<0?(_e&&xe.push(_e),_e=[ae[Te]]):_e.push(ae[Te]))}return _e&&xe.push(_e),xe}(F),P=0;P<F.length;P++)for(L=0;L<F[P].length;L++)O(F[P][L])}F.length===1?F=F[0]:R="Multi"+R;var te={type:"Feature",geometry:{type:R,coordinates:F},properties:this.properties};return"id"in this&&(te.id=this.id),te},Cc}function Gv(){if(jv)return _y;jv=1;var c=$b();function n(h,v){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=h,this._keys=[],this._values=[],this._features=[],h.readFields(a,this,v),this.length=this._features.length}function a(h,v,f){h===15?v.version=f.readVarint():h===1?v.name=f.readString():h===5?v.extent=f.readVarint():h===2?v._features.push(f.pos):h===3?v._keys.push(f.readString()):h===4&&v._values.push(function(x){for(var P=null,L=x.readVarint()+x.pos;x.pos<L;){var N=x.readVarint()>>3;P=N===1?x.readString():N===2?x.readFloat():N===3?x.readDouble():N===4?x.readVarint64():N===5?x.readVarint():N===6?x.readSVarint():N===7?x.readBoolean():null}return P}(f))}return _y=n,n.prototype.feature=function(h){if(h<0||h>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[h];var v=this._pbf.readVarint()+this._pbf.pos;return new c(this._pbf,v,this.extent,this._keys,this._values)},_y}function Ef(){return $v||($v=1,r_.VectorTile=function(){if(Uv)return yy;Uv=1;var c=Gv();function n(a,h,v){if(a===3){var f=new c(v,v.readVarint()+v.pos);f.length&&(h[f.name]=f)}}return yy=function(a,h){this.layers=a.readFields(n,{},h)},yy}(),r_.VectorTileFeature=$b(),r_.VectorTileLayer=Gv()),r_}var pm=Ef();class Ip extends at{constructor(n,a,h){super(n,a),this.z=h}}class qv extends Ip{constructor(n,a,h,v){super(n,a,h),this.w=v}}function a_(c,n,a,h){const v=[],f=h===0?(x,P,L,N,I,z)=>{x.push(new at(z,L+(z-P)/(N-P)*(I-L)))}:(x,P,L,N,I,z)=>{x.push(new at(P+(z-L)/(I-L)*(N-P),z))};for(const x of c){const P=[];for(const L of x){if(L.length<=2)continue;const N=[];for(let F=0;F<L.length-1;F++){const R=L[F].x,O=L[F].y,q=L[F+1].x,te=L[F+1].y,ae=h===0?R:O,ge=h===0?q:te;ae<n?ge>n&&f(N,R,O,q,te,n):ae>a?ge<a&&f(N,R,O,q,te,a):N.push(L[F]),ge<n&&ae>=n&&f(N,R,O,q,te,n),ge>a&&ae<=a&&f(N,R,O,q,te,a)}let I=L[L.length-1];const z=h===0?I.x:I.y;z>=n&&z<=a&&N.push(I),N.length&&(I=N[N.length-1],N[0].x===I.x&&N[0].y===I.y||N.push(N[0]),P.push(N))}P.length&&v.push(P)}return v}function Gb(c,n,a,h){const v=a==="x"?"y":"x",f=(h-c[a])/(n[a]-c[a]);c[v]=c[v]+(n[v]-c[v])*f,c[a]=h,c.hasOwnProperty("z")&&(c.z=ir(c.z,n.z,f)),c.hasOwnProperty("w")&&(c.w=ir(c.w,n.w,f))}function qb(c,n,a,h){const v=a,f=h;for(const x of["x","y"]){let P=c,L=n;P[x]>=L[x]&&(P=n,L=c),P[x]<v&&L[x]>v&&Gb(P,L,x,v),P[x]<f&&L[x]>f&&Gb(L,P,x,f)}}const s_=Number.MAX_SAFE_INTEGER;function tg(c,n,a,h){return c.order<n||c.order===s_||!(c.clipMask&a)||function(v,f){return f.length!==0&&f.find(x=>x===v)===void 0}(h,c.clipScope)}function o_(c,n){return c.x-n.x||c.y-n.y}function l_(c,n){return o_(c.min,n.min)===0&&o_(c.max,n.max)===0}function vy(c,n){return!(c.min.x>n.max.x||c.max.x<n.min.x||c.min.y>n.max.y||c.max.y<n.min.y)}function ng(c,n){if(c.length!==n.length)return!1;for(let a=0;a<c.length;a++)if(c[a].sourceId!==n[a].sourceId||!l_(c[a],n[a])||c[a].order!==n[a].order||c[a].clipMask!==n[a].clipMask||!Tn(c[a].clipScope,n[a].clipScope))return!1;return!0}function c_(c,n,a){const h=1/mi,v=1/(1<<a.canonical.z),f=(n.x*h+a.canonical.x)*v+a.wrap,x=(n.y*h+a.canonical.y)*v;return{min:new at((c.x*h+a.canonical.x)*v+a.wrap,(c.y*h+a.canonical.y)*v),max:new at(f,x)}}function xy(c,n,a){const h=1<<a.canonical.z,v=((n.x-a.wrap)*h-a.canonical.x)*mi,f=(n.y*h-a.canonical.y)*mi;return{min:new at(((c.x-a.wrap)*h-a.canonical.x)*mi,(c.y*h-a.canonical.y)*mi),max:new at(v,f)}}function Hb(c,n,a,h,v,f,x){const P=c.indices,L=c.vertices,N=[];for(let I=h;I<h+v;I+=3){const z=n[a[I+0]+f],F=n[a[I+1]+f],R=n[a[I+2]+f],O=Math.min(z.x,F.x,R.x),q=Math.max(z.x,F.x,R.x),te=Math.min(z.y,F.y,R.y),ae=Math.max(z.y,F.y,R.y);N.length=0,c.grid.query(new at(O,te),new at(q,ae),N);for(let ge=0;ge<N.length;ge++){const _e=N[ge];if(zt(L[P[3*_e+0]],L[P[3*_e+1]],L[P[3*_e+2]],z,F,R,x))return!0}}return!1}function Zb(c,n,a,h){if(!c||!a)return!1;let v=c.vertices;if(!n.canonical.equals(h.canonical)||n.wrap!==h.wrap){if(a.vertices.length<c.vertices.length)return Zb(a,h,c,n);const f=n.canonical,x=h.canonical,P=Math.pow(2,x.z-f.z);v=c.vertices.map(L=>new at((L.x+f.x*mi)*P-x.x*mi,(L.y+f.y*mi)*P-x.y*mi))}return Hb(a,v,c.indices,0,c.indices.length,0,0)}function Wb(c,n,a,h){const v=Math.pow(2,h.z-a.z);return new at((c+a.x*mi)*v-h.x*mi,(n+a.y*mi)*v-h.y*mi)}function mm(c,n){const a=[];n.grid.queryPoint(c,a);const h=n.indices,v=n.vertices;for(let f=0;f<a.length;f++){const x=a[f];if(Mt([v[h[3*x+0]],v[h[3*x+1]],v[h[3*x+2]]],c))return!0}return!1}const Wo=[new at(0,0),new at(mi,0),new at(mi,mi),new at(0,mi)];function Mf(c,n){const a=[];let h=[];if(!n||c.length<2)return[c];if(c.length===2)return cn(c[0],c[1],Wo)?[c]:[];for(let v=0;v<c.length+2;v++){const f=c[v%c.length],x=c[(v+1)%c.length],P=cn(v===0?c[c.length-1]:c[(v-1)%c.length],f,Wo),L=cn(f,x,Wo),N=P||L;N&&h.push(f),N&&L||h.length>0&&(h.length>1&&a.push(h),h=[])}return h.length>1&&a.push(h),a}const u_=pm.VectorTileFeature.types,Xb=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],Yb=["fill-extrusion-flood-light-ground-radius"],Hv=Math.pow(2,13),Bw=Math.pow(2,15)-1,Zv=new at(0,1),If=2147483648;function h_(c,n,a,h,v,f,x,P){c.emplaceBack((n<<1)+x,(a<<1)+f,(Math.floor(h*Hv)<<1)+v,Math.round(P))}function ig(c,n,a){c.emplaceBack(n.x*mi,n.y*mi,a?1:0)}function rg(c,n,a,h,v,f){c.emplaceBack(n.x,n.y,(a.x<<1)+h,(a.y<<1)+v,f)}function gm(c,n,a){c.emplaceBack(n.x,n.y,n.z,a[0]*16384,a[1]*16384,a[2]*16384)}class Wv{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class ag{constructor(){this.centroidXY=new at(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new at(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new at(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new at(this.max.x-this.min.x,this.max.y-this.min.y)}}class by{constructor(){this.acc=new at(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(n,a){n.min.x===Number.MAX_VALUE&&(n.min.x=n.max.x=a.x,n.min.y=n.max.y=a.y)}appendEdge(n,a,h){this.accCount++,this.acc._add(a);let v=!!this.borders;a.x<n.min.x?(n.min.x=a.x,v=!0):a.x>n.max.x&&(n.max.x=a.x,v=!0),a.y<n.min.y?(n.min.y=a.y,v=!0):a.y>n.max.y&&(n.max.y=a.y,v=!0),((a.x===0||a.x===mi)&&a.x===h.x)!=((a.y===0||a.y===mi)&&a.y===h.y)&&this.processBorderOverlap(a,h),v&&this.checkBorderIntersection(a,h)}checkBorderIntersection(n,a){a.x<0!=n.x<0&&this.addBorderIntersection(0,ir(a.y,n.y,(0-a.x)/(n.x-a.x))),a.x>mi!=n.x>mi&&this.addBorderIntersection(1,ir(a.y,n.y,(mi-a.x)/(n.x-a.x))),a.y<0!=n.y<0&&this.addBorderIntersection(2,ir(a.x,n.x,(0-a.y)/(n.y-a.y))),a.y>mi!=n.y>mi&&this.addBorderIntersection(3,ir(a.x,n.x,(mi-a.y)/(n.y-a.y)))}addBorderIntersection(n,a){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const h=this.borders[n];a<h[0]&&(h[0]=a),a>h[1]&&(h[1]=a)}processBorderOverlap(n,a){if(n.x===a.x){if(n.y===a.y)return;const h=n.x===0?0:1;this.addBorderIntersection(h,a.y),this.addBorderIntersection(h,n.y)}else{const h=n.y===0?2:3;this.addBorderIntersection(h,a.x),this.addBorderIntersection(h,n.x)}}centroid(){return this.accCount===0?new at(0,0):new at(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((n,a)=>n+ +(a[0]!==Number.MAX_VALUE),0):0}}function Xv(c,n){const a=c.add(n)._unit(),h=ui(c.x*a.x+c.y*a.y,-1,1);var v,f,x;return x=Math.acos(h),Math.min(4,Math.max(-4,Math.tan(x)))/4*Bw*((v=c).x*(f=n).y-v.y*f.x<0?-1:1)}const Yv=[c=>c.x<0,c=>c.x>mi,c=>c.y<0,c=>c.y>mi];function wy(c,n,a,h){const v=[4];if(h===0)return v;a._mult(h);const f=c.sub(a),x=n.sub(a),P=[c,n,f,x];for(let L=0;L<4;L++)for(const N of P)if(Yv[L](N)){v.push(L);break}return v}class sg{constructor(n){this.vertexArray=new Rn,this.indexArray=new Wr,this.programConfigurations=new oh(n.layers,{zoom:n.zoom,lut:n.lut},a=>Yb.includes(a)),this._segments=new Wa,this.hiddenByLandmarkVertexArray=new al,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Wa}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(n,a,h,v=!1){const f=n.length;if(f>2){let x=Math.max(0,this._segments.get().length-1);const P=this._segments._prepareSegment(4*f,this.vertexArray.length,2*this._segmentToGroundQuads[x].length);let L;x!==this._segments.get().length-1&&(x++,this._segmentToGroundQuads[x]=[],this._segmentToRegionTriCounts[x]=[0,0,0,0,0]);{const N=n[0],I=n[1];L=Xv(N.sub(n[f-1])._perp()._unit(),I.sub(N)._perp()._unit())}for(let N=0;N<f;N++){const I=N===f-1?0:N+1,z=n[N],F=n[I],R=n[I===f-1?0:I+1],O=F.sub(z)._perp()._unit(),q=Xv(O,R.sub(F)._perp()._unit()),te=L,ae=q;if(g(z,F,a)||v&&o(z,a)&&o(F,a)){L=q;continue}const ge=P.vertexLength;rg(this.vertexArray,z,F,1,1,te),rg(this.vertexArray,z,F,1,0,te),rg(this.vertexArray,z,F,0,1,ae),rg(this.vertexArray,z,F,0,0,ae),P.vertexLength+=4;const _e=wy(z,F,O,h);for(const he of _e)this._segmentToGroundQuads[x].push({id:ge,region:he}),this._segmentToRegionTriCounts[x][he]+=2,P.primitiveLength+=2;L=q}}}prepareBorderSegments(){if(!this.hasData())return;const n=this._segments.get(),a=n.length;for(let h=0;h<a;h++)this._segmentToGroundQuads[h].sort((v,f)=>v.region-f.region);for(let h=0;h<a;h++){const v=this._segmentToGroundQuads[h],f=n[h],x=this._segmentToRegionTriCounts[h];x.reduce((L,N)=>L+N,0);let P=0;for(let L=0;L<=4;L++){const N=x[L];if(N!==0){let I=this.regionSegments[L];I||(I=this.regionSegments[L]=new Wa);const z={vertexOffset:f.vertexOffset,primitiveOffset:f.primitiveOffset+P,vertexLength:f.vertexLength,primitiveLength:N};I.get().push(z)}P+=N}for(let L=0;L<v.length;L++){const N=v[L].id;this.indexArray.emplaceBack(N,N+1,N+3),this.indexArray.emplaceBack(N,N+3,N+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(n,a,h,v,f,x){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,n,a,h,v,f,x)}upload(n){this.hasData()&&(this.vertexBuffer=n.createVertexBuffer(this.vertexArray,Vv.members),this.indexBuffer=n.createIndexBuffer(this.indexArray))}uploadPaintProperties(n){this.hasData()&&this.programConfigurations.upload(n)}update(n,a,h,v,f,x,P){this.hasData()&&this.programConfigurations.updatePaintArrays(n,a,h,v,f,x,P)}updateHiddenByLandmark(n){if(!this.hasData())return;const a=n.groundVertexCount+n.groundVertexArrayOffset;if(n.groundVertexCount===0)return;const h=n.flags&If?1:0;for(let v=n.groundVertexArrayOffset;v<a;++v)this.hiddenByLandmarkVertexArray.emplace(v,h);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(n){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=n.createVertexBuffer(this.hiddenByLandmarkVertexArray,jb.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let n=0;n<=4;n++){const a=this.regionSegments[n];a&&a.destroy()}}}}class og{constructor(n){this.zoom=n.zoom,this.canonical=n.canonical,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=n.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=n.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Wr,this.footprintVertices=new rn,this.footprintSegments=[],this.layoutVertexArray=new Mn,this.centroidVertexArray=new sh,this.wallVertexArray=new rm,this.indexArray=new Wr,this.programConfigurations=new oh(n.layers,{zoom:n.zoom,lut:n.lut},a=>Xb.includes(a)),this.segments=new Wa,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.groundEffect=new sg(n),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}updateFootprints(n,a){}populate(n,a,h,v){this.features=[],this.hasPattern=Lv("fill-extrusion",this.layers,a),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=l(h),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:f,id:x,index:P,sourceLayerIndex:L}of n){const N=this.layers[0]._featureFilter.needGeometry,I=le(f,N);if(!this.layers[0]._featureFilter.filter(new ba(this.zoom),I,h))continue;const z={id:x,sourceLayerIndex:L,index:P,geometry:N?I.geometry:se(f,h,v),properties:f.properties,type:f.type,patterns:{}},F=this.layoutVertexArray.length,R=u_[z.type]==="Polygon";if(this.hasPattern)this.features.push(zv("fill-extrusion",this.layers,z,this.zoom,a));else if(this.wallMode)for(const O of z.geometry)for(const q of Mf(O,R))this.addFeature(z,[q],P,h,{},a.availableImages,v,a.brightness);else this.addFeature(z,z.geometry,P,h,{},a.availableImages,v,a.brightness);a.featureIndex.insert(f,z.geometry,P,L,this.index,F)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(n,a,h,v,f,x){for(const P of this.features){const L=u_[P.type]==="Polygon",{geometry:N}=P;if(this.wallMode)for(const I of N)for(const z of Mf(I,L))this.addFeature(P,[z],P.index,a,h,v,f,x);else this.addFeature(P,N,P.index,a,h,v,f,x)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(n,a,h,v,f,x,P){this.programConfigurations.updatePaintArrays(n,a,f,h,v,x,P),this.groundEffect.update(n,a,f,h,v,x,P)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Ub),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.wallVertexBuffer=n.createVertexBuffer(this.wallVertexArray,i_.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=n.createVertexBuffer(this.layoutVertexExtArray,Nv.members,!0)),this.groundEffect.upload(n)),this.groundEffect.uploadPaintProperties(n),this.programConfigurations.upload(n),this.uploaded=!0}uploadCentroid(n){this.groundEffect.uploadHiddenByLandmark(n),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=n.createVertexBuffer(this.centroidVertexArray,Nb.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(n,a,h,v,f,x,P,L){const N=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(n,{})/this.tileToMeter,I=[new at(0,0),new at(mi,mi)],z=P.projection,F=z.name==="globe",R=this.wallMode||u_[n.type]==="Polygon",O=new by;O.centroidDataIndex=this.centroidData.length;const q=new ag,te=this.layers[0].paint.get("fill-extrusion-base").evaluate(n,{},v)<=0,ae=this.layers[0].paint.get("fill-extrusion-height").evaluate(n,{},v);let ge;if(q.height=ae,q.vertexArrayOffset=this.layoutVertexArray.length,q.groundVertexArrayOffset=this.groundEffect.vertexArray.length,F&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new xi),this.wallMode){if(F)return void it("Non zero fill-extrusion-line-width is not yet supported on globe.");if(a.length!==1)return;ge=function(Ye){const Ct=Ye[0].x===Ye[Ye.length-1].x&&Ye[0].y===Ye[Ye.length-1].y;(function(Ti){let In=0;const ji=Ti.length;for(let gi=0;gi<ji;gi++)In+=(Ti[(gi+1)%ji].x-Ti[gi].x)*(Ti[(gi+1)%ji].y+Ti[gi].y);return In>=0})(Ye)||(Ye=Ye.reverse());const It={geometry:[],joinNormals:[],indices:[]},Rt=[],At=[],Vt=[];let Wt=Ye.length;for(;Wt>=2&&Ye[Wt-1].equals(Ye[Wt-2]);)Wt--;if(Wt<(Ct?3:2))return It;let Kt,qt,yn,Yn,xn,di=0;for(;di<Wt-1&&Ye[di].equals(Ye[di+1]);)di++;Ct&&(Kt=Ye[Wt-2],xn=Ye[di].sub(Kt)._unit()._perp());for(let Ti=di;Ti<Wt;Ti++){if(yn=Ti===Wt-1?Ct?Ye[di+1]:void 0:Ye[Ti+1],yn&&Ye[Ti].equals(yn))continue;xn&&(Yn=xn),Kt&&(qt=Kt),Kt=Ye[Ti],xn=yn?yn.sub(Kt)._unit()._perp():Yn,Yn=Yn||xn;let In=Yn.add(xn);In.x===0&&In.y===0||In._unit();const ji=In.x*xn.x+In.y*xn.y,gi=ji!==0?1/ji:1/0,Oi=Yn.x*xn.y-Yn.y*xn.x>0;let rr="miter";const wr=2;rr==="miter"&&gi>wr&&(rr="bevel"),rr==="bevel"&&(gi>100&&(rr="flipbevel"),gi<wr&&(rr="miter"));const Ir=(Fr,Pr,qr,Aa)=>{const ya=new at(Fr.x,Fr.y),fr=new at(Fr.x,Fr.y);ya.x+=Pr.x*Aa,ya.y+=Pr.y*Aa,fr.x-=Pr.x*Math.max(qr,1),fr.y-=Pr.y*Math.max(qr,1),Vt.push(Pr),Rt.push(ya),At.push(fr)};if(rr==="miter")In._mult(gi),Ir(Kt,In,0,0);else if(rr==="flipbevel")In=xn.mult(-1),Ir(Kt,In,0,0),Ir(Kt,In.mult(-1),0,0);else{const Fr=-Math.sqrt(gi*gi-1),Pr=Oi?Fr:0,qr=Oi?0:Fr;qt&&Ir(Kt,Yn,Pr,qr),yn&&Ir(Kt,xn,Pr,qr)}}It.geometry=[...Rt,...At.reverse(),Rt[0]],It.joinNormals=[...Vt,...Vt.reverse(),Vt[Vt.length-1]];const ci=It.geometry.length-1;for(let Ti=0;Ti<ci/2;Ti++)if(Ti+1<ci/2){let In=Ti,ji=Ti+1,gi=ci-1-Ti,Oi=ci-2-Ti;In=In===0?ci-1:In-1,ji=ji===0?ci-1:ji-1,gi=gi===0?ci-1:gi-1,Oi=Oi===0?ci-1:Oi-1,It.indices.push(gi),It.indices.push(ji),It.indices.push(In),It.indices.push(gi),It.indices.push(Oi),It.indices.push(ji)}return It}(a[0]),a=[ge.geometry]}const _e=(Ye,Ct)=>Ye<(Ct.length-1)/2||Ye===Ct.length-1,he=this.wallMode?[a]:py(a,500);for(let Ye=he.length-1;Ye>=0;Ye--){const Ct=he[Ye];(Ct.length===0||(xe=Ct[0]).every(ct=>ct.x<=0)||xe.every(ct=>ct.x>=mi)||xe.every(ct=>ct.y<=0)||xe.every(ct=>ct.y>=mi))&&he.splice(Ye,1)}var xe;let Te;if(F)Te=U(he,I,v);else{Te=[];for(const Ye of he)Te.push({polygon:Ye,bounds:I})}const Ae=R?this.edgeRadius:0,tt=Ae>0&&this.zoom<17,Ke=(Ye,Ct)=>{if(Ye.length===0)return!1;const ct=Ye[Ye.length-1];return Ct.x===ct.x&&Ct.y===ct.y};for(const{polygon:Ye,bounds:Ct}of Te){let ct=0,It=0;for(const Wt of Ye)R&&!Wt[0].equals(Wt[Wt.length-1])&&Wt.push(Wt[0]),It+=R?Wt.length-1:Wt.length;const Rt=this.segments.prepareSegment((R?5:4)*It,this.layoutVertexArray,this.indexArray);q.footprintSegIdx<0&&(q.footprintSegIdx=this.footprintSegments.length),q.polygonSegIdx<0&&(q.polygonSegIdx=this.polygonSegments.length);const At={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Vt=new Wv;if(Vt.vertexOffset=this.footprintVertices.length,Vt.indexOffset=3*this.footprintIndices.length,Vt.ringIndices=[],R){const Wt=[],Kt=[];ct=Rt.vertexLength;for(let yn=0;yn<Ye.length;yn++){const Yn=Ye[yn];Yn.length&&yn!==0&&Kt.push(Wt.length/2);const xn=[];let di,ci;di=Yn[1].sub(Yn[0])._perp()._unit(),Vt.ringIndices.push(Yn.length-1);for(let Ti=1;Ti<Yn.length;Ti++){const In=Yn[Ti],ji=Yn[Ti===Yn.length-1?1:Ti+1],gi=In.clone();if(Ae){ci=ji.sub(In)._perp()._unit();const Oi=di.add(ci)._unit(),rr=Ae*Math.min(4,1/(di.x*Oi.x+di.y*Oi.y));gi.x+=rr*Oi.x,gi.y+=rr*Oi.y,gi.x=Math.round(gi.x),gi.y=Math.round(gi.y),di=ci}if(!te||Ae!==0&&!tt||Ke(xn,gi)||xn.push(gi),h_(this.layoutVertexArray,gi.x,gi.y,0,0,1,1,0),this.wallMode){const Oi=_e(Ti,Yn);ig(this.wallVertexArray,ge.joinNormals[Ti],!Oi)}Rt.vertexLength++,this.footprintVertices.emplaceBack(In.x,In.y),Wt.push(In.x,In.y),F&&gm(this.layoutVertexExtArray,z.projectTilePoint(gi.x,gi.y,v),z.upVector(v,gi.x,gi.y))}te&&(Ae===0||tt)&&(xn.length!==0&&Ke(xn,xn[0])&&xn.pop(),this.groundEffect.addData(xn,Ct,N))}const qt=this.wallMode?ge.indices:Qg(Wt,Kt);for(let yn=0;yn<qt.length;yn+=3)this.footprintIndices.emplaceBack(Vt.vertexOffset+qt[yn+0],Vt.vertexOffset+qt[yn+1],Vt.vertexOffset+qt[yn+2]),this.indexArray.emplaceBack(ct+qt[yn],ct+qt[yn+2],ct+qt[yn+1]),Rt.primitiveLength++;Vt.indexCount+=qt.length,Vt.vertexCount+=this.footprintVertices.length-Vt.vertexOffset}for(let Wt=0;Wt<Ye.length;Wt++){const Kt=Ye[Wt];O.startRing(q,Kt[0]);let qt=Kt.length>4&&m(Kt[Kt.length-2],Kt[0],Kt[1]),yn=Ae?Kv(Kt[Kt.length-2],Kt[0],Kt[1],Ae):0;const Yn=[];let xn,di,ci;di=Kt[1].sub(Kt[0])._perp()._unit();let Ti=!0;for(let In=1,ji=0;In<Kt.length;In++){let gi=Kt[In-1],Oi=Kt[In];const rr=Kt[In===Kt.length-1?1:In+1];if(O.appendEdge(q,Oi,gi),g(Oi,gi,Ct)){Ae&&(di=rr.sub(Oi)._perp()._unit(),Ti=!Ti);continue}const wr=Oi.sub(gi)._perp(),Ir=wr.x/(Math.abs(wr.x)+Math.abs(wr.y)),Fr=wr.y>0?1:0,Pr=gi.dist(Oi);if(ji+Pr>32768&&(ji=0),Ae){ci=rr.sub(Oi)._perp()._unit();let fr=Kb(gi,Oi,rr,Sy(di,ci),Ae);isNaN(fr)&&(fr=0);const va=Oi.sub(gi)._unit();gi=gi.add(va.mult(yn))._round(),Oi=Oi.add(va.mult(-fr))._round(),yn=fr,di=ci,te&&this.zoom>=17&&(Ke(Yn,gi)||Yn.push(gi),Ke(Yn,Oi)||Yn.push(Oi))}const qr=Rt.vertexLength,Aa=Kt.length>4&&m(gi,Oi,rr);let ya=S(ji,qt,Ti);if(h_(this.layoutVertexArray,gi.x,gi.y,Ir,Fr,0,0,ya),h_(this.layoutVertexArray,gi.x,gi.y,Ir,Fr,0,1,ya),this.wallMode){const fr=_e(In-1,Kt),va=ge.joinNormals[In-1];ig(this.wallVertexArray,va,fr),ig(this.wallVertexArray,va,fr)}if(ji+=Pr,ya=S(ji,Aa,!Ti),qt=Aa,h_(this.layoutVertexArray,Oi.x,Oi.y,Ir,Fr,0,0,ya),h_(this.layoutVertexArray,Oi.x,Oi.y,Ir,Fr,0,1,ya),this.wallMode){const fr=_e(In,Kt),va=ge.joinNormals[In];ig(this.wallVertexArray,va,fr),ig(this.wallVertexArray,va,fr)}if(Rt.vertexLength+=4,this.indexArray.emplaceBack(qr+0,qr+1,qr+2),this.indexArray.emplaceBack(qr+1,qr+3,qr+2),Rt.primitiveLength+=2,Ae){const fr=ct+(In===1?Kt.length-2:In-2),va=In===1?ct:fr+1;if(this.indexArray.emplaceBack(qr+1,fr,qr+3),this.indexArray.emplaceBack(fr,va,qr+3),Rt.primitiveLength+=2,xn===void 0&&(xn=qr),!g(rr,Kt[In],Ct)){const ma=In===Kt.length-1?xn:Rt.vertexLength;this.indexArray.emplaceBack(qr+2,qr+3,ma),this.indexArray.emplaceBack(qr+3,ma+1,ma),this.indexArray.emplaceBack(qr+3,va,ma+1),Rt.primitiveLength+=3}Ti=!Ti}if(F){const fr=this.layoutVertexExtArray,va=z.projectTilePoint(gi.x,gi.y,v),ma=z.projectTilePoint(Oi.x,Oi.y,v),ka=z.upVector(v,gi.x,gi.y),uo=z.upVector(v,Oi.x,Oi.y);gm(fr,va,ka),gm(fr,va,ka),gm(fr,ma,uo),gm(fr,ma,uo)}}R&&(ct+=Kt.length-1),te&&Ae&&this.zoom>=17&&(Yn.length!==0&&Ke(Yn,Yn[0])&&Yn.pop(),this.groundEffect.addData(Yn,Ct,N,Ae>0))}this.footprintSegments.push(Vt),At.triangleCount=this.indexArray.length-At.triangleArrayOffset,this.polygonSegments.push(At),++q.footprintSegLen,++q.polygonSegLen}if(q.vertexCount=this.layoutVertexArray.length-q.vertexArrayOffset,q.groundVertexCount=this.groundEffect.vertexArray.length-q.groundVertexArrayOffset,q.vertexCount!==0){if(q.centroidXY=O.borders?Zv:this.encodeCentroid(O,q),this.centroidData.push(q),O.borders){this.featuresOnBorder.push(O);const Ye=this.featuresOnBorder.length-1;for(let Ct=0;Ct<O.borders.length;Ct++)O.borders[Ct][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ct].push(Ye)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,h,f,x,v,L),this.groundEffect.addPaintPropertiesData(n,h,f,x,v,L),this.maxHeight=Math.max(this.maxHeight,ae)}}sortBorders(){for(let n=0;n<this.borderFeatureIndices.length;n++)this.borderFeatureIndices[n].sort((a,h)=>this.featuresOnBorder[a].borders[n][0]-this.featuresOnBorder[h].borders[n][0])}splitToSubtiles(){const n=[];for(let P=0;P<this.centroidData.length;P++){const L=this.centroidData[P],N=+(L.min.y+L.max.y>mi),I=2*N+(+(L.min.x+L.max.x>mi)^N);for(let z=0;z<L.polygonSegLen;z++){const F=L.polygonSegIdx+z;n.push({centroidIdx:P,subtile:I,polygonSegmentIdx:F,triangleSegmentIdx:this.polygonSegments[F].triangleSegIdx})}}const a=new Wr;n.sort((P,L)=>P.triangleSegmentIdx===L.triangleSegmentIdx?P.subtile-L.subtile:P.triangleSegmentIdx-L.triangleSegmentIdx);let h=0,v=0,f=0;for(const P of n){if(P.triangleSegmentIdx!==h)break;f++}const x=n.length;for(;v!==n.length;){h=n[v].triangleSegmentIdx;let P=0,L=v,N=v;for(let I=L;I<f&&n[I].subtile===P;I++)N++;for(;L!==f;){const I=n[L];P=I.subtile;const z=this.centroidData[I.centroidIdx].min.clone(),F=this.centroidData[I.centroidIdx].max.clone(),R={vertexOffset:this.segments.segments[h].vertexOffset,primitiveOffset:a.length,vertexLength:this.segments.segments[h].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let O=L;O<N;O++){const q=n[O],te=this.polygonSegments[q.polygonSegmentIdx],ae=this.centroidData[q.centroidIdx].min,ge=this.centroidData[q.centroidIdx].max,_e=this.indexArray.uint16;for(let he=te.triangleArrayOffset;he<te.triangleArrayOffset+te.triangleCount;he++)a.emplaceBack(_e[3*he],_e[3*he+1],_e[3*he+2]);R.primitiveLength+=te.triangleCount,z.x=Math.min(z.x,ae.x),z.y=Math.min(z.y,ae.y),F.x=Math.max(F.x,ge.x),F.y=Math.max(F.y,ge.y)}R.primitiveLength>0&&this.triangleSubSegments.push({segment:R,min:z,max:F}),L=N;for(let O=L;O<f&&n[O].subtile===n[L].subtile;O++)N++}v=f;for(let I=v;I<x&&n[I].triangleSegmentIdx===n[v].triangleSegmentIdx;I++)f++}a._trim(),this.indexArray=a}getVisibleSegments(n,a,h){const v=new Wa;if(this.wallMode){for(const q of this.triangleSubSegments)v.segments.push(q.segment);return v}let f=0,x=0;const P=1<<n.canonical.z;if(a){const q=a.getMinMaxForTile(n);q&&(f=q.min,x=q.max)}x+=this.maxHeight;const L=n.toUnwrapped();let N;const I=[L.canonical.x/P+L.wrap,L.canonical.y/P],z=[(L.canonical.x+1)/P+L.wrap,(L.canonical.y+1)/P],F=(q,te,ae)=>[q[0]*(1-ae[0])+te[0]*ae[0],q[1]*(1-ae[1])+te[1]*ae[1]],R=[],O=[];for(const q of this.triangleSubSegments){R[0]=q.min.x/mi,R[1]=q.min.y/mi,O[0]=q.max.x/mi,O[1]=q.max.y/mi;const te=F(I,z,R),ae=F(I,z,O);if(new nr([te[0],te[1],f],[ae[0],ae[1],x]).intersectsPrecise(h)===0){N&&(v.segments.push(N),N=void 0);continue}const ge=q.segment;N&&N.vertexOffset!==ge.vertexOffset&&(v.segments.push(N),N=void 0),N?(N.vertexLength+=ge.vertexLength,N.primitiveLength+=ge.primitiveLength):N={vertexOffset:ge.vertexOffset,primitiveLength:ge.primitiveLength,vertexLength:ge.vertexLength,primitiveOffset:ge.primitiveOffset,sortKey:void 0,vaos:{}}}return N&&v.segments.push(N),v}encodeCentroid(n,a){const h=n.centroid(),v=a.span(),f=Math.min(7,Math.round(v.x*this.tileToMeter/10)),x=Math.min(7,Math.round(v.y*this.tileToMeter/10));return new at(ui(h.x,1,mi-1)<<3|f,ui(h.y,1,mi-1)<<3|x)}encodeBorderCentroid(n){if(!n.borders)return new at(0,0);const a=n.borders,h=Number.MAX_VALUE;if(a[0][0]!==h||a[1][0]!==h){const v=a[0][0]!==h?0:1;return new at(6|(a[0][0]!==h?0:65528),(a[v][0]+a[v][1])/2<<3|6)}{const v=a[2][0]!==h?2:3;return new at((a[v][0]+a[v][1])/2<<3|6,6|(a[2][0]!==h?0:65528))}}showCentroid(n){const a=this.centroidData[n.centroidDataIndex];a.flags&=If,a.centroidXY.x=0,a.centroidXY.y=0,this.writeCentroidToBuffer(a)}writeCentroidToBuffer(n){this.groundEffect.updateHiddenByLandmark(n);const a=n.vertexArrayOffset,h=n.vertexCount+n.vertexArrayOffset,v=n.flags&If?Zv:n.centroidXY,f=this.centroidVertexArray.geta_centroid_pos0(a);if(this.centroidVertexArray.geta_centroid_pos1(a)!==v.y||f!==v.x){for(let x=a;x<h;++x)this.centroidVertexArray.emplace(x,v.x,v.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const n of this.centroidData)this.writeCentroidToBuffer(n)}updateReplacement(n,a,h){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const v=a.getReplacementRegionsForTile(n.toUnwrapped());if(ng(this.activeReplacements,v))return;if(this.activeReplacements=v,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const x of this.centroidData)x.flags&=2147483647;const f=[];for(const x of this.activeReplacements){if(x.order<h)continue;const P=Math.max(1,Math.pow(2,x.footprintTileId.canonical.z-n.canonical.z));for(const L of this.centroidData)if(!(L.flags&If||x.min.x>L.max.x||L.min.x>x.max.x||x.min.y>L.max.y||L.min.y>x.max.y))for(let N=0;N<L.footprintSegLen;N++){const I=this.footprintSegments[L.footprintSegIdx+N];if(f.length=0,$(this.footprintVertices,I.vertexOffset,I.vertexCount,x.footprintTileId.canonical,n.canonical,f),Hb(x.footprint,f,this.footprintIndices.uint16,I.indexOffset,I.indexCount,-I.vertexOffset,-P)){L.flags|=If;break}}}for(const x of this.centroidData)this.writeCentroidToBuffer(x);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(n,a,h){let v=!1;for(let f=0;f<h.footprintSegLen;f++){const x=this.footprintSegments[h.footprintSegIdx+f];let P=0;for(const L of x.ringIndices){for(let N=P,I=L+P-1;N<L+P;I=N++){const z=this.footprintVertices.int16[2*(N+x.vertexOffset)+0],F=this.footprintVertices.int16[2*(N+x.vertexOffset)+1],R=this.footprintVertices.int16[2*(I+x.vertexOffset)+1];F>a!=R>a&&n<(this.footprintVertices.int16[2*(I+x.vertexOffset)+0]-z)*(a-F)/(R-F)+z&&(v=!v)}P=L}}return v}getHeightAtTileCoord(n,a){let h=Number.NEGATIVE_INFINITY,v=!0;const f=4*(n+mi)*mi+(a+mi);if(this.partLookup.hasOwnProperty(f)){const x=this.partLookup[f];return x?{height:x.height,hidden:!!(x.flags&If)}:void 0}for(const x of this.centroidData)n>x.max.x||x.min.x>n||a>x.max.y||x.min.y>a||this.footprintContainsPoint(n,a,x)&&x&&x.height>h&&(h=x.height,this.partLookup[f]=x,v=!!(x.flags&If));if(h!==Number.NEGATIVE_INFINITY)return{height:h,hidden:v};this.partLookup[f]=void 0}}function Sy(c,n){const a=c.add(n)._unit();return c.x*a.x+c.y*a.y}function Kv(c,n,a,h){const v=n.sub(c)._perp()._unit(),f=a.sub(n)._perp()._unit();return Kb(c,n,a,Sy(v,f),h)}function Kb(c,n,a,h,v){const f=Math.sqrt(1-h*h);return Math.min(c.dist(n)/3,n.dist(a)/3,v*f/h)}function g(c,n,a){return c.x<a[0].x&&n.x<a[0].x||c.x>a[1].x&&n.x>a[1].x||c.y<a[0].y&&n.y<a[0].y||c.y>a[1].y&&n.y>a[1].y}function o(c,n){return c.x<n[0].x||c.x>n[1].x||c.y<n[0].y||c.y>n[1].y}function m(c,n,a){if(c.x<0||c.x>=mi||n.x<0||n.x>=mi||a.x<0||a.x>=mi)return!1;const h=a.sub(n),v=h.perp(),f=c.sub(n);return(h.x*f.x+h.y*f.y)/Math.sqrt((h.x*h.x+h.y*h.y)*(f.x*f.x+f.y*f.y))>-.866&&v.x*f.x+v.y*f.y<0}function S(c,n,a){const h=n?2|c:-3&c;return a?1|h:-2&h}function D(){const c=Math.PI/32,n=Math.tan(c),a=Sp;return a*Math.sqrt(1+2*n*n)-a}function U(c,n,a){const h=1<<a.z,v=Nl(a.x/h),f=Nl((a.x+1)/h),x=Ws(a.y/h),P=Ws((a.y+1)/h);return function(L,N,I,z,F=0,R){const O=[];if(!L.length||!I||!z)return O;const q=(Te,Ae)=>{for(const tt of Te)O.push({polygon:tt,bounds:Ae})},te=Math.ceil(Math.log2(I)),ae=Math.ceil(Math.log2(z)),ge=te-ae,_e=[];for(let Te=0;Te<Math.abs(ge);Te++)_e.push(ge>0?0:1);for(let Te=0;Te<Math.min(te,ae);Te++)_e.push(0),_e.push(1);let he=L;if(he=a_(he,N[0].y-F,N[1].y+F,1),he=a_(he,N[0].x-F,N[1].x+F,0),!he.length)return O;const xe=[];for(_e.length?xe.push({polygons:he,bounds:N,depth:0}):q(he,N);xe.length;){const Te=xe.pop(),Ae=Te.depth,tt=_e[Ae],Ke=Te.bounds[0],Ye=Te.bounds[1],Ct=tt===0?Ke.x:Ke.y,ct=tt===0?Ye.x:Ye.y,It=R(tt,Ct,ct),Rt=a_(Te.polygons,Ct-F,It+F,tt),At=a_(Te.polygons,It-F,ct+F,tt);if(Rt.length){const Vt=[Ke,new at(tt===0?It:Ye.x,tt===1?It:Ye.y)];_e.length>Ae+1?xe.push({polygons:Rt,bounds:Vt,depth:Ae+1}):q(Rt,Vt)}if(At.length){const Vt=[new at(tt===0?It:Ke.x,tt===1?It:Ke.y),Ye];_e.length>Ae+1?xe.push({polygons:At,bounds:Vt,depth:Ae+1}):q(At,Vt)}}return O}(c,n,Math.ceil((f-v)/11.25),Math.ceil((x-P)/11.25),1,(L,N,I)=>{if(L===0)return .5*(N+I);{const z=Ws((a.y+N/mi)/h);return(Ga(.5*(Ws((a.y+I/mi)/h)+z))*h-a.y)*mi}})}function $(c,n,a,h,v,f){const x=Math.pow(2,h.z-v.z);for(let P=0;P<a;P++){let L=c.int16[2*(P+n)+0],N=c.int16[2*(P+n)+1];L=(L+v.x*mi)*x-h.x*mi,N=(N+v.y*mi)*x-h.y*mi,f.push(new at(L,N))}}let X,oe;function fe(c,n){return c.x*n.x+c.y*n.y}function ve(c,n){if(c.length===1){let a=0;const h=n[a++];let v;for(;!v||h.equals(v);)if(v=n[a++],!v)return 1/0;for(;a<n.length;a++){const f=n[a],x=c[0],P=v.sub(h),L=f.sub(h),N=x.sub(h),I=fe(P,P),z=fe(P,L),F=fe(L,L),R=fe(N,P),O=fe(N,L),q=I*F-z*z,te=(F*R-z*O)/q,ae=(I*O-z*R)/q,ge=h.z*(1-te-ae)+v.z*te+f.z*ae;if(isFinite(ge))return ge}return 1/0}{let a=1/0;for(const h of n)a=Math.min(a,h.z);return a}}function Ce(c,n,a,h,v,f,x,P){const L=x*v.getElevationAt(c,n,!0,!0),N=f[0]!==0,I=N?f[1]===0?x*(f[0]/7-450):x*function(z,F,R){const O=Math.floor(F[0]/8),q=Math.floor(F[1]/8),te=10*(F[0]-8*O),ae=10*(F[1]-8*q),ge=z.getElevationAt(O,q,!0,!0),_e=z.getMeterToDEM(R),he=Math.floor(.5*(te*_e-1)),xe=Math.floor(.5*(ae*_e-1)),Te=z.tileCoordToPixel(O,q),Ae=2*he+1,tt=2*xe+1,Ke=function(At,Vt,Wt,Kt,qt){return[At.getElevationAtPixel(Vt,Wt,!0),At.getElevationAtPixel(Vt+qt,Wt,!0),At.getElevationAtPixel(Vt,Wt+qt,!0),At.getElevationAtPixel(Vt+Kt,Wt+qt,!0)]}(z,Te.x-he,Te.y-xe,Ae,tt),Ye=Math.abs(Ke[0]-Ke[1]),Ct=Math.abs(Ke[2]-Ke[3]),ct=Math.abs(Ke[0]-Ke[2])+Math.abs(Ke[1]-Ke[3]),It=Math.min(.25,.5*_e*(Ye+Ct)/Ae),Rt=Math.min(.25,.5*_e*ct/tt);return ge+Math.max(It*te,Rt*ae)}(v,f,P):L;return{base:L+(a===0?-1:a),top:N?Math.max(I+h,L+a+2):L+h}}ki(og,"FillExtrusionBucket",{omit:["layers","features"]}),ki(ag,"PartData"),ki(Wv,"FootprintSegment"),ki(by,"BorderCentroidData"),ki(sg,"GroundEffect");const Be=Bt([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),je=Bt([{name:"a_z_offset_width",components:2,type:"Float32"}],4),{members:Ge}=Be,lt=Bt([{name:"a_packed",components:4,type:"Float32"}]),{members:Tt}=lt,Ot=Bt([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:ln}=Ot;class Zt{constructor(n,a){this.width=n,this.height=a,this.nextRow=0,this.image=new wf({width:n,height:a}),this.positions={},this.uploaded=!1}getDash(n,a){const h=this.getKey(n,a);return this.positions[h]}trim(){const n=this.width,a=this.height=Os(this.nextRow);this.image.resize({width:n,height:a})}getKey(n,a){return n.join(",")+a}getDashRanges(n,a,h){const v=[];let f=n.length%2==1?-n[n.length-1]*h:0,x=n[0]*h,P=!0;v.push({left:f,right:x,isDash:P,zeroLength:n[0]===0});let L=n[0];for(let N=1;N<n.length;N++){P=!P;const I=n[N];f=L*h,L+=I,x=L*h,v.push({left:f,right:x,isDash:P,zeroLength:I===0})}return v}addRoundDash(n,a,h){const v=a/2;for(let f=-h;f<=h;f++){const x=this.width*(this.nextRow+h+f);let P=0,L=n[P];for(let N=0;N<this.width;N++){N/L.right>1&&(L=n[++P]);const I=Math.abs(N-L.left),z=Math.abs(N-L.right),F=Math.min(I,z);let R;const O=f/h*(v+1);if(L.isDash){const q=v-Math.abs(O);R=Math.sqrt(F*F+q*q)}else R=v-Math.sqrt(F*F+O*O);this.image.data[x+N]=Math.max(0,Math.min(255,R+128))}}}addRegularDash(n,a){for(let L=n.length-1;L>=0;--L){const N=n[L],I=n[L+1];N.zeroLength?n.splice(L,1):I&&I.isDash===N.isDash&&(I.left=N.left,n.splice(L,1))}const h=n[0],v=n[n.length-1];h.isDash===v.isDash&&(h.left=v.left-this.width,v.right=h.right+this.width);const f=this.width*this.nextRow;let x=0,P=n[x];for(let L=0;L<this.width;L++){L/P.right>1&&(P=n[++x]);const N=Math.abs(L-P.left),I=Math.abs(L-P.right),z=Math.min(N,I);this.image.data[f+L]=Math.max(0,Math.min(255,(P.isDash?z:-z)+a+128))}}addDash(n,a){const h=this.getKey(n,a);if(this.positions[h])return this.positions[h];const v=a==="round",f=v?7:0,x=2*f+1;if(this.nextRow+x>this.height)return it("LineAtlas out of space"),null;n.length===0&&n.push(1);let P=0;for(let I=0;I<n.length;I++)n[I]<0&&(it("Negative value is found in line dasharray, replacing values with 0"),n[I]=0),P+=n[I];if(P!==0){const I=this.width/P,z=this.getDashRanges(n,this.width,I);v?this.addRoundDash(z,I,f):this.addRegularDash(z,a==="square"?.5*I:0)}const L=this.nextRow+f;this.nextRow+=x;const N={tl:[L,f],br:[P,0]};return this.positions[h]=N,N}}ki(Zt,"LineAtlas");const Ne=pm.VectorTileFeature.types,xt=Math.cos(Math.PI/180*37.5),Yt=Math.cos(Math.PI/180*5);class Dn{constructor(n){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.zoom=n.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(a=>a.fqid),this.index=n.index,this.projection=n.projection,this.hasPattern=!1,this.hasZOffset=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new Hn,this.layoutVertexArray2=new ei,this.patternVertexArray=new jn,this.indexArray=new Wr,this.programConfigurations=new oh(n.layers,{zoom:n.zoom,lut:n.lut}),this.segments=new Wa,this.maxLineLength=0,this.zOffsetVertexArray=new rl,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.tessellationStep=n.tessellationStep?n.tessellationStep:mi/64}updateFootprints(n,a){}populate(n,a,h,v){this.hasPattern=Lv("line",this.layers,a);const f=this.layers[0].layout.get("line-sort-key");this.tileToMeter=l(h),this.hasZOffset=!this.layers[0].isDraped();const x=this.layers[0].layout.get("line-elevation-reference");this.hasZOffset&&x==="none"&&it(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`);const P=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.hasZOffset&&P!==void 0;const L=[];for(const{feature:F,id:R,index:O,sourceLayerIndex:q}of n){const te=this.layers[0]._featureFilter.needGeometry,ae=le(F,te);if(!this.layers[0]._featureFilter.filter(new ba(this.zoom),ae,h))continue;const ge=f?f.evaluate(ae,{},h):void 0,_e={id:R,properties:F.properties,type:F.type,sourceLayerIndex:q,index:O,geometry:te?ae.geometry:se(F,h,v),patterns:{},sortKey:ge};L.push(_e)}f&&L.sort((F,R)=>F.sortKey-R.sortKey);const{lineAtlas:N,featureIndex:I}=a,z=this.addConstantDashes(N);for(const F of L){const{geometry:R,index:O,sourceLayerIndex:q}=F;if(z&&this.addFeatureDashes(F,N),this.hasPattern){const te=zv("line",this.layers,F,this.zoom,a);this.patternFeatures.push(te)}else this.addFeature(F,R,O,h,N.positions,a.availableImages,a.brightness);I.insert(n[O].feature,R,O,q,this.index)}}addConstantDashes(n){let a=!1;for(const h of this.layers){const v=h.paint.get("line-dasharray").value,f=h.layout.get("line-cap").value;if(v.kind!=="constant"||f.kind!=="constant")a=!0;else{const x=f.value,P=v.value;if(!P)continue;n.addDash(P,x)}}return a}addFeatureDashes(n,a){const h=this.zoom;for(const v of this.layers){const f=v.paint.get("line-dasharray").value,x=v.layout.get("line-cap").value;if(f.kind==="constant"&&x.kind==="constant")continue;let P,L;if(f.kind==="constant"){if(P=f.value,!P)continue}else P=f.evaluate({zoom:h},n);L=x.kind==="constant"?x.value:x.evaluate({zoom:h},n),a.addDash(P,L),n.patterns[v.id]=a.getKey(P,L)}}update(n,a,h,v,f,x,P){this.programConfigurations.updatePaintArrays(n,a,f,h,v,x,P)}addFeatures(n,a,h,v,f,x){for(const P of this.patternFeatures)this.addFeature(P,P.geometry,P.index,a,h,v,x)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(n){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=n.createVertexBuffer(this.layoutVertexArray2,Tt)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=n.createVertexBuffer(this.patternVertexArray,ln)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=n.createVertexBuffer(this.zOffsetVertexArray,je.members,!0)),this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,Ge),this.indexBuffer=n.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(n),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(n){if(n.properties&&n.properties.hasOwnProperty("mapbox_clip_start")&&n.properties.hasOwnProperty("mapbox_clip_end"))return{start:+n.properties.mapbox_clip_start,end:+n.properties.mapbox_clip_end}}addFeature(n,a,h,v,f,x,P){const L=this.layers[0].layout,N=L.get("line-join").evaluate(n,{}),I=L.get("line-cap").evaluate(n,{}),z=L.get("line-miter-limit"),F=L.get("line-round-limit");this.lineClips=this.lineFeatureClips(n),this.lineFeature=n,this.zOffsetValue=L.get("line-z-offset").value;const R=this.layers[0].paint.get("line-width").value;R.kind!=="constant"&&R.isLineProgressConstant===!1&&(this.variableWidthValue=R);for(const O of a)this.addLine(O,n,v,N,I,z,F);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,n,h,f,x,v,P)}addLine(n,a,h,v,f,x,P){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const L=v==="none";if(this.patternJoinNone=this.hasPattern&&L,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[],this.lineClips){this.lineClipsArray.push(this.lineClips);for(let _e=0;_e<n.length-1;_e++)this.totalDistance+=n[_e].dist(n[_e+1]);this.totalFeatureLength=this.totalDistance/(this.lineClips.end-this.lineClips.start),this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const N=Ne[a.type]==="Polygon";let I=n.length;for(;I>=2&&n[I-1].equals(n[I-2]);)I--;let z=0;for(;z<I-1&&n[z].equals(n[z+1]);)z++;if(I<(N?3:2))return;v==="bevel"&&(x=1.05);const F=this.segments.prepareSegment(10*I,this.layoutVertexArray,this.indexArray);let R,O,q,te,ae,ge;this.e1=this.e2=-1,N&&(R=n[I-2],ae=n[z].sub(R)._unit()._perp());for(let _e=z;_e<I;_e++){if(q=_e===I-1?N?n[z+1]:void 0:n[_e+1],q&&n[_e].equals(q))continue;ae&&(te=ae),R&&(O=R),R=n[_e],ge=this.evaluateLineProgressFeatures(O?O.dist(R):0),ae=q?q.sub(R)._unit()._perp():te,te=te||ae;const he=O&&q;let xe=he?v:N||L?"butt":f;const Te=te.x*ae.x+te.y*ae.y;if(L){const Rt=function(At){if(At.patternJoinNone){const Vt=At.segmentPoints.length/2,Wt=At.lineSoFar-At.segmentStart;for(let Kt=0;Kt<Vt;++Kt){const qt=At.segmentPoints[2*Kt+1],yn=Math.round(At.segmentPoints[2*Kt])+.5+.25*qt;At.patternVertexArray.emplaceBack(yn,Wt,At.segmentStart),At.patternVertexArray.emplaceBack(yn,Wt,At.segmentStart)}At.segmentPoints.length=0}At.e1=At.e2=-1};if(he&&Te<Yt){this.updateDistance(O,R),this.addCurrentVertex(R,te,1,1,F,ge),Rt(this),this.addCurrentVertex(R,ae,-1,-1,F,ge);continue}if(O){if(!q){this.updateDistance(O,R),this.addCurrentVertex(R,te,1,1,F,ge),Rt(this);continue}xe="miter"}}let Ae=te.add(ae);Ae.x===0&&Ae.y===0||Ae._unit();const tt=Ae.x*ae.x+Ae.y*ae.y,Ke=tt!==0?1/tt:1/0,Ye=2*Math.sqrt(2-2*tt),Ct=tt<xt&&O&&q,ct=te.x*ae.y-te.y*ae.x>0,It=this.overscaling<=16?15*mi/(512*this.overscaling):0;if(he&&xe==="round"){if(Ke<P)xe="miter";else if(Ke<=2){const Rt=bi(R,-10,mi+10);xe=this.hasZOffset&&(Rt||this.hasCrossSlope)?"miter":"fakeround"}}if(xe==="miter"&&Ke>x&&(xe="bevel"),xe==="bevel"&&(Ke>2&&(xe="flipbevel"),Ke<x&&(xe="miter")),O&&!(xe==="miter"&&Ct)&&this.updateDistance(O,R),xe==="miter")if(Ct){const Rt=R.dist(O);if(Rt>2*It){const Vt=R.sub(R.sub(O)._mult(It/Rt)._round());this.updateDistance(O,Vt),this.addCurrentVertex(Vt,te,0,0,F,ge),O=Vt}this.updateDistance(O,R),Ae._mult(Ke),this.addCurrentVertex(R,Ae,0,0,F,ge);const At=R.dist(q);if(At>2*It){const Vt=R.add(q.sub(R)._mult(It/At)._round());this.updateDistance(R,Vt),this.addCurrentVertex(Vt,ae,0,0,F,ge),R=Vt}}else Ae._mult(Ke),this.addCurrentVertex(R,Ae,0,0,F,ge);else if(xe==="flipbevel"){if(Ke>100)Ae=ae.mult(-1);else{const Rt=Ke*te.add(ae).mag()/te.sub(ae).mag();Ae._perp()._mult(Rt*(ct?-1:1))}this.addCurrentVertex(R,Ae,0,0,F,ge),this.addCurrentVertex(R,Ae.mult(-1),0,0,F,ge)}else if(xe==="bevel"||xe==="fakeround"){ge!=null&&O&&this.addCurrentVertex(R,te,-1,-1,F,ge);const Rt=R.dist(O)<=2*It&&xe!=="bevel",At=Ae.mult(ct?1:-1);At._mult(Ke);const Vt=ae.mult(ct?-1:1),Wt=te.mult(ct?-1:1),Kt=this.evaluateLineProgressFeatures(this.distance);if(ge==null&&(this.addHalfVertex(R,At.x,At.y,!1,!ct,0,F,Kt),Rt||this.addHalfVertex(R,At.x+2*Wt.x,At.y+2*Wt.y,!1,ct,0,F,Kt)),xe==="fakeround"){const qt=Math.round(180*Ye/Math.PI/20);this.addHalfVertex(R,Wt.x,Wt.y,!1,ct,0,F,Kt);for(let yn=0;yn<qt;yn++){let Yn=yn/qt;if(Yn!==.5){const di=Yn-.5;Yn+=Yn*di*(Yn-1)*((1.0904+Te*(Te*(3.55645-1.43519*Te)-3.2452))*di*di+(.848013+Te*(.215638*Te-1.06021)))}const xn=Vt.sub(Wt)._mult(Yn)._add(Wt)._unit();this.addHalfVertex(R,xn.x,xn.y,!1,ct,0,F,Kt)}this.addHalfVertex(R,Vt.x,Vt.y,!1,ct,0,F,Kt)}Rt||ge!=null||this.addHalfVertex(R,At.x+2*Vt.x,At.y+2*Vt.y,!1,ct,0,F,Kt),ge!=null&&q&&this.addCurrentVertex(R,ae,1,1,F,ge)}else xe==="butt"?this.addCurrentVertex(R,Ae,0,0,F,ge):xe==="square"?(O||this.addCurrentVertex(R,Ae,-1,-1,F,ge),this.addCurrentVertex(R,Ae,0,0,F,ge),O&&this.addCurrentVertex(R,Ae,1,1,F,ge)):xe==="round"&&(O&&(this.addCurrentVertex(R,te,0,0,F,ge),this.addCurrentVertex(R,te,1,1,F,ge,!0)),q&&(this.addCurrentVertex(R,ae,-1,-1,F,ge,!0),this.addCurrentVertex(R,ae,0,0,F,ge)))}}addVerticesTo(n,a,h,v,f,x,P,L,N,I){const z=(a.w-n.w)/this.tessellationStep|0;let F=0;const R=this.scaledDistance;if(z>1){this.lineSoFar=n.w;const q=(a.x-n.x)/z,te=(a.y-n.y)/z,ae=(a.z-n.z)/z,ge=(a.w-n.w)/z;for(let _e=1;_e<z;++_e){n.x+=q,n.y+=te,n.z+=ae,this.lineSoFar+=ge,F+=ge;const he=this.evaluateLineProgressFeatures(this.prevDistance+F);this.scaledDistance=(this.prevDistance+F)/this.totalDistance,this.addHalfVertex(n,h,v,I,!1,P,N,he),this.addHalfVertex(n,f,x,I,!0,-L,N,he)}}this.lineSoFar=a.w,this.scaledDistance=R;const O=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(a,h,v,I,!1,P,N,O),this.addHalfVertex(a,f,x,I,!0,-L,N,O)}evaluateLineProgressFeatures(n){if(!this.variableWidthValue&&!this.hasZOffset)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+n)/this.totalFeatureLength):it(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let a=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(a=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.hasZOffset?this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:a}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:a}:{zOffset:0,variableWidth:a}}addCurrentVertex(n,a,h,v,f,x,P=!1){const L=a.x+a.y*h,N=a.y-a.x*h,I=a.y*v-a.x,z=-a.y-a.x*v;if(x!=null){const F=this.hasZOffset,R=-10,O=mi+10,q=x.zOffset,te=new qv(n.x,n.y,q,this.lineSoFar),ae=!!F&&bi(n,R,O),ge=this.lineSoFar,_e=this.distance;if(this.currentVertex)if(ae){const he=this.currentVertexIsOutside,xe=this.currentVertex,Te=new qv(n.x,n.y,q,this.lineSoFar);if(qb(xe,Te,R,O),!bi(Te,R,O)){if(he){this.e1=this.e2=-1,this.distance-=xe.dist(te),this.lineSoFar=xe.w;const Ae=this.evaluateLineProgressFeatures(xe.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(xe,L,N,P,!1,h,f,Ae),this.addHalfVertex(xe,I,z,P,!0,-v,f,Ae),this.prevDistance=this.distance}this.distance=this.prevDistance+xe.dist(Te),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(xe,Te,L,N,I,z,h,v,f,P),this.distance=_e,this.scaledDistance=this.distance/this.totalDistance}}else{const he=this.currentVertex;if(this.currentVertexIsOutside){qb(he,te,R,O),this.e1=this.e2=-1,this.distance-=he.dist(te),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=he.w;const xe=this.evaluateLineProgressFeatures(he.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(he,L,N,P,!1,h,f,xe),this.addHalfVertex(he,I,z,P,!0,-v,f,xe),this.prevDistance=this.distance,this.distance=_e,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(he,te,L,N,I,z,h,v,f,P)}else ae||(this.addHalfVertex(n,L,N,P,!1,h,f,x),this.addHalfVertex(n,I,z,P,!0,-v,f,x));this.currentVertex=te,this.currentVertexIsOutside=ae,this.lineSoFar=ge}else this.addHalfVertex(n,L,N,P,!1,h,f,x),this.addHalfVertex(n,I,z,P,!0,-v,f,x)}addHalfVertex({x:n,y:a},h,v,f,x,P,L,N){this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),x||this.segmentPoints.push(this.lineSoFar-this.segmentStart,P)),this.layoutVertexArray.emplaceBack((n<<1)+(f?1:0),(a<<1)+(x?1:0),Math.round(63*h)+128,Math.round(63*v)+128,1+(P===0?0:P<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const I=L.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,I),L.primitiveLength++),x?this.e2=I:this.e1=I,N!=null&&this.zOffsetVertexArray.emplaceBack(N.zOffset,N.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(n,a){this.prevDistance=this.distance,this.distance+=n.dist(a),this.updateScaledDistance()}}function bi(c,n,a){return c.x<n||c.x>a||c.y<n||c.y>a}let Un,Kn;function Di(c,n,a){return n*(mi/(c.tileSize*Math.pow(2,a-c.tileID.overscaledZ)))}ki(Dn,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const Si=(c,n,a)=>(1-a)*c+a*n;function Li(c,n){return 1/Di(c,1,n.tileZoom)}function ni(c,n,a,h){return c.translatePosMatrix(h||n.tileID.projMatrix,n,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const ar=c=>{const n=[];Cr(c)&&n.push("RENDER_LINE_DASH"),c.paint.get("line-gradient")&&n.push("RENDER_LINE_GRADIENT");const a=c.paint.get("line-trim-offset");a[0]===0&&a[1]===0||n.push("RENDER_LINE_TRIM_OFFSET"),c.paint.get("line-border-width").constantOr(1)!==0&&n.push("RENDER_LINE_BORDER");const h=c.layout.get("line-join").constantOr("miter")==="none",v=!!c.paint.get("line-pattern").constantOr(1);return h&&v&&n.push("LINE_JOIN_NONE"),n};function Cr(c){const n=c.paint.get("line-dasharray").value;return n.value||n.kind!=="constant"}let gr;const hr=()=>gr||(gr={layout:Un||(Un=new _a({"line-cap":new Ei(tn.layout_line["line-cap"]),"line-join":new Ei(tn.layout_line["line-join"]),"line-miter-limit":new Xn(tn.layout_line["line-miter-limit"]),"line-round-limit":new Xn(tn.layout_line["line-round-limit"]),"line-sort-key":new Ei(tn.layout_line["line-sort-key"]),"line-z-offset":new Ei(tn.layout_line["line-z-offset"]),"line-elevation-reference":new Xn(tn.layout_line["line-elevation-reference"]),"line-cross-slope":new Xn(tn.layout_line["line-cross-slope"]),visibility:new Xn(tn.layout_line.visibility),"line-width-unit":new Xn(tn.layout_line["line-width-unit"])})),paint:Kn||(Kn=new _a({"line-opacity":new Ei(tn.paint_line["line-opacity"]),"line-color":new Ei(tn.paint_line["line-color"]),"line-translate":new Xn(tn.paint_line["line-translate"]),"line-translate-anchor":new Xn(tn.paint_line["line-translate-anchor"]),"line-width":new Ei(tn.paint_line["line-width"]),"line-gap-width":new Ei(tn.paint_line["line-gap-width"]),"line-offset":new Ei(tn.paint_line["line-offset"]),"line-blur":new Ei(tn.paint_line["line-blur"]),"line-dasharray":new Ei(tn.paint_line["line-dasharray"]),"line-pattern":new Ei(tn.paint_line["line-pattern"]),"line-gradient":new bc(tn.paint_line["line-gradient"]),"line-trim-offset":new Xn(tn.paint_line["line-trim-offset"]),"line-trim-fade-range":new Xn(tn.paint_line["line-trim-fade-range"]),"line-trim-color":new Xn(tn.paint_line["line-trim-color"]),"line-emissive-strength":new Xn(tn.paint_line["line-emissive-strength"]),"line-border-width":new Ei(tn.paint_line["line-border-width"]),"line-border-color":new Ei(tn.paint_line["line-border-color"]),"line-occlusion-opacity":new Xn(tn.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Ei({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Ei({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Ei({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Ei({type:"string",default:"default","property-type":"data-driven"})}))},gr);class pa extends Ei{possiblyEvaluate(n,a){return a=new ba(Math.floor(a.zoom),{now:a.now,fadeDuration:a.fadeDuration,transition:a.transition}),super.possiblyEvaluate(n,a)}evaluate(n,a,h,v){return a=Ar({},a,{zoom:Math.floor(a.zoom)}),super.evaluate(n,a,h,v)}}let vs;function To(c,n){return n>0?n+2*c:c}const xl=Bt([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Cu=Bt([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Ec=Bt([{name:"a_projected_pos",components:4,type:"Float32"}],4);Bt([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const ol=Bt([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),zs=Bt([{name:"a_texb",components:2,type:"Uint16"}]),Xo=Bt([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),ll=Bt([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Bt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Yo=Bt([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),sc=Bt([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Bt([{name:"triangle",components:3,type:"Uint16"}]),Bt([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Bt([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),Bt([{type:"Float32",name:"offsetX"}]),Bt([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var rs=24;const hs=128;function bl(c,n,a,h,v){if(c.kind==="camera")return c.maxSize;if(c.kind==="composite"){const f=n.possiblyEvaluate(new ba(c.maxZoom),a).evaluate(v,{},a),x=n.possiblyEvaluate(new ba(c.minZoom),a).evaluate(v,{},a);return Math.max(f,x)}return n.possiblyEvaluate(new ba(h)).evaluate(v,{},a)}function oo(c,n){const{expression:a}=n;if(a.kind==="constant")return{kind:"constant",layoutSize:a.evaluate(new ba(c+1))};if(a.kind==="source")return{kind:"source"};{const{zoomStops:h,interpolationType:v}=a;let f=0;for(;f<h.length&&h[f]<=c;)f++;f=Math.max(0,f-1);let x=f;for(;x<h.length&&h[x]<c+1;)x++;x=Math.min(h.length-1,x);const P=h[f],L=h[x];return a.kind==="composite"?{kind:"composite",minZoom:P,maxZoom:L,interpolationType:v}:{kind:"camera",minZoom:P,maxZoom:L,minSize:a.evaluate(new ba(P)),maxSize:a.evaluate(new ba(L)),interpolationType:v}}}function lo(c,{uSize:n,uSizeT:a},{lowerSize:h,upperSize:v}){return c.kind==="source"?h/hs:c.kind==="composite"?ir(h/hs,v/hs,a):n}function js(c,n,a=1){let h=0,v=0;if(c.kind==="constant")v=c.layoutSize*a;else if(c.kind!=="source"){const{interpolationType:f,minZoom:x,maxZoom:P}=c,L=f?ui(Ro.interpolationFactor(f,n,x,P),0,1):0;c.kind==="camera"?v=ir(c.minSize,c.maxSize,L)*a:h=L*a}return{uSizeT:h,uSize:v}}var Co=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:hs,evaluateSizeForFeature:lo,evaluateSizeForZoom:js,getRasterizedIconSize:bl,getSizeData:oo});function Ts(c,n,a){return c.sections.forEach(h=>{h.text=function(v,f,x){const P=f.layout.get("text-transform").evaluate(x,{});return P==="uppercase"?v=v.toLocaleUpperCase():P==="lowercase"&&(v=v.toLocaleLowerCase()),Go.applyArabicShaping&&(v=Go.applyArabicShaping(v)),v}(h.text,n,a)}),c}const Mc={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function lg(c){return c==="︶"||c==="﹈"||c==="︸"||c==="﹄"||c==="﹂"||c==="︾"||c==="︼"||c==="︺"||c==="︘"||c==="﹀"||c==="︐"||c==="︓"||c==="︔"||c==="｀"||c==="￣"||c==="︑"||c==="︒"}function Fh(c){return c==="︵"||c==="﹇"||c==="︷"||c==="﹃"||c==="﹁"||c==="︽"||c==="︻"||c==="︹"||c==="︗"||c==="︿"}var Jb,Pp,Ap,kp={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function cg(){return Jb||(Jb=1,kp.read=function(c,n,a,h,v){var f,x,P=8*v-h-1,L=(1<<P)-1,N=L>>1,I=-7,z=a?v-1:0,F=a?-1:1,R=c[n+z];for(z+=F,f=R&(1<<-I)-1,R>>=-I,I+=P;I>0;f=256*f+c[n+z],z+=F,I-=8);for(x=f&(1<<-I)-1,f>>=-I,I+=h;I>0;x=256*x+c[n+z],z+=F,I-=8);if(f===0)f=1-N;else{if(f===L)return x?NaN:1/0*(R?-1:1);x+=Math.pow(2,h),f-=N}return(R?-1:1)*x*Math.pow(2,f-h)},kp.write=function(c,n,a,h,v,f){var x,P,L,N=8*f-v-1,I=(1<<N)-1,z=I>>1,F=v===23?Math.pow(2,-24)-Math.pow(2,-77):0,R=h?0:f-1,O=h?1:-1,q=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(P=isNaN(n)?1:0,x=I):(x=Math.floor(Math.log(n)/Math.LN2),n*(L=Math.pow(2,-x))<1&&(x--,L*=2),(n+=x+z>=1?F/L:F*Math.pow(2,1-z))*L>=2&&(x++,L/=2),x+z>=I?(P=0,x=I):x+z>=1?(P=(n*L-1)*Math.pow(2,v),x+=z):(P=n*Math.pow(2,z-1)*Math.pow(2,v),x=0));v>=8;c[a+R]=255&P,R+=O,P/=256,v-=8);for(x=x<<v|P,N+=v;N>0;c[a+R]=255&x,R+=O,x/=256,N-=8);c[a+R-O]|=128*q}),kp}function _m(){if(Ap)return Pp;Ap=1,Pp=n;var c=cg();function n(he){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(he)?he:new Uint8Array(he||0),this.pos=0,this.type=0,this.length=this.buf.length}n.Varint=0,n.Fixed64=1,n.Bytes=2,n.Fixed32=5;var a=4294967296,h=1/a,v=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function f(he){return he.type===n.Bytes?he.readVarint()+he.pos:he.pos+1}function x(he,xe,Te){return Te?4294967296*xe+(he>>>0):4294967296*(xe>>>0)+(he>>>0)}function P(he,xe,Te){var Ae=xe<=16383?1:xe<=2097151?2:xe<=268435455?3:Math.floor(Math.log(xe)/(7*Math.LN2));Te.realloc(Ae);for(var tt=Te.pos-1;tt>=he;tt--)Te.buf[tt+Ae]=Te.buf[tt]}function L(he,xe){for(var Te=0;Te<he.length;Te++)xe.writeVarint(he[Te])}function N(he,xe){for(var Te=0;Te<he.length;Te++)xe.writeSVarint(he[Te])}function I(he,xe){for(var Te=0;Te<he.length;Te++)xe.writeFloat(he[Te])}function z(he,xe){for(var Te=0;Te<he.length;Te++)xe.writeDouble(he[Te])}function F(he,xe){for(var Te=0;Te<he.length;Te++)xe.writeBoolean(he[Te])}function R(he,xe){for(var Te=0;Te<he.length;Te++)xe.writeFixed32(he[Te])}function O(he,xe){for(var Te=0;Te<he.length;Te++)xe.writeSFixed32(he[Te])}function q(he,xe){for(var Te=0;Te<he.length;Te++)xe.writeFixed64(he[Te])}function te(he,xe){for(var Te=0;Te<he.length;Te++)xe.writeSFixed64(he[Te])}function ae(he,xe){return(he[xe]|he[xe+1]<<8|he[xe+2]<<16)+16777216*he[xe+3]}function ge(he,xe,Te){he[Te]=xe,he[Te+1]=xe>>>8,he[Te+2]=xe>>>16,he[Te+3]=xe>>>24}function _e(he,xe){return(he[xe]|he[xe+1]<<8|he[xe+2]<<16)+(he[xe+3]<<24)}return n.prototype={destroy:function(){this.buf=null},readFields:function(he,xe,Te){for(Te=Te||this.length;this.pos<Te;){var Ae=this.readVarint(),tt=Ae>>3,Ke=this.pos;this.type=7&Ae,he(tt,xe,this),this.pos===Ke&&this.skip(Ae)}return xe},readMessage:function(he,xe){return this.readFields(he,xe,this.readVarint()+this.pos)},readFixed32:function(){var he=ae(this.buf,this.pos);return this.pos+=4,he},readSFixed32:function(){var he=_e(this.buf,this.pos);return this.pos+=4,he},readFixed64:function(){var he=ae(this.buf,this.pos)+ae(this.buf,this.pos+4)*a;return this.pos+=8,he},readSFixed64:function(){var he=ae(this.buf,this.pos)+_e(this.buf,this.pos+4)*a;return this.pos+=8,he},readFloat:function(){var he=c.read(this.buf,this.pos,!0,23,4);return this.pos+=4,he},readDouble:function(){var he=c.read(this.buf,this.pos,!0,52,8);return this.pos+=8,he},readVarint:function(he){var xe,Te,Ae=this.buf;return xe=127&(Te=Ae[this.pos++]),Te<128?xe:(xe|=(127&(Te=Ae[this.pos++]))<<7,Te<128?xe:(xe|=(127&(Te=Ae[this.pos++]))<<14,Te<128?xe:(xe|=(127&(Te=Ae[this.pos++]))<<21,Te<128?xe:function(tt,Ke,Ye){var Ct,ct,It=Ye.buf;if(Ct=(112&(ct=It[Ye.pos++]))>>4,ct<128||(Ct|=(127&(ct=It[Ye.pos++]))<<3,ct<128)||(Ct|=(127&(ct=It[Ye.pos++]))<<10,ct<128)||(Ct|=(127&(ct=It[Ye.pos++]))<<17,ct<128)||(Ct|=(127&(ct=It[Ye.pos++]))<<24,ct<128)||(Ct|=(1&(ct=It[Ye.pos++]))<<31,ct<128))return x(tt,Ct,Ke);throw new Error("Expected varint not more than 10 bytes")}(xe|=(15&(Te=Ae[this.pos]))<<28,he,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var he=this.readVarint();return he%2==1?(he+1)/-2:he/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var he=this.readVarint()+this.pos,xe=this.pos;return this.pos=he,he-xe>=12&&v?function(Te,Ae,tt){return v.decode(Te.subarray(Ae,tt))}(this.buf,xe,he):function(Te,Ae,tt){for(var Ke="",Ye=Ae;Ye<tt;){var Ct,ct,It,Rt=Te[Ye],At=null,Vt=Rt>239?4:Rt>223?3:Rt>191?2:1;if(Ye+Vt>tt)break;Vt===1?Rt<128&&(At=Rt):Vt===2?(192&(Ct=Te[Ye+1]))==128&&(At=(31&Rt)<<6|63&Ct)<=127&&(At=null):Vt===3?(ct=Te[Ye+2],(192&(Ct=Te[Ye+1]))==128&&(192&ct)==128&&((At=(15&Rt)<<12|(63&Ct)<<6|63&ct)<=2047||At>=55296&&At<=57343)&&(At=null)):Vt===4&&(ct=Te[Ye+2],It=Te[Ye+3],(192&(Ct=Te[Ye+1]))==128&&(192&ct)==128&&(192&It)==128&&((At=(15&Rt)<<18|(63&Ct)<<12|(63&ct)<<6|63&It)<=65535||At>=1114112)&&(At=null)),At===null?(At=65533,Vt=1):At>65535&&(At-=65536,Ke+=String.fromCharCode(At>>>10&1023|55296),At=56320|1023&At),Ke+=String.fromCharCode(At),Ye+=Vt}return Ke}(this.buf,xe,he)},readBytes:function(){var he=this.readVarint()+this.pos,xe=this.buf.subarray(this.pos,he);return this.pos=he,xe},readPackedVarint:function(he,xe){if(this.type!==n.Bytes)return he.push(this.readVarint(xe));var Te=f(this);for(he=he||[];this.pos<Te;)he.push(this.readVarint(xe));return he},readPackedSVarint:function(he){if(this.type!==n.Bytes)return he.push(this.readSVarint());var xe=f(this);for(he=he||[];this.pos<xe;)he.push(this.readSVarint());return he},readPackedBoolean:function(he){if(this.type!==n.Bytes)return he.push(this.readBoolean());var xe=f(this);for(he=he||[];this.pos<xe;)he.push(this.readBoolean());return he},readPackedFloat:function(he){if(this.type!==n.Bytes)return he.push(this.readFloat());var xe=f(this);for(he=he||[];this.pos<xe;)he.push(this.readFloat());return he},readPackedDouble:function(he){if(this.type!==n.Bytes)return he.push(this.readDouble());var xe=f(this);for(he=he||[];this.pos<xe;)he.push(this.readDouble());return he},readPackedFixed32:function(he){if(this.type!==n.Bytes)return he.push(this.readFixed32());var xe=f(this);for(he=he||[];this.pos<xe;)he.push(this.readFixed32());return he},readPackedSFixed32:function(he){if(this.type!==n.Bytes)return he.push(this.readSFixed32());var xe=f(this);for(he=he||[];this.pos<xe;)he.push(this.readSFixed32());return he},readPackedFixed64:function(he){if(this.type!==n.Bytes)return he.push(this.readFixed64());var xe=f(this);for(he=he||[];this.pos<xe;)he.push(this.readFixed64());return he},readPackedSFixed64:function(he){if(this.type!==n.Bytes)return he.push(this.readSFixed64());var xe=f(this);for(he=he||[];this.pos<xe;)he.push(this.readSFixed64());return he},skip:function(he){var xe=7&he;if(xe===n.Varint)for(;this.buf[this.pos++]>127;);else if(xe===n.Bytes)this.pos=this.readVarint()+this.pos;else if(xe===n.Fixed32)this.pos+=4;else{if(xe!==n.Fixed64)throw new Error("Unimplemented type: "+xe);this.pos+=8}},writeTag:function(he,xe){this.writeVarint(he<<3|xe)},realloc:function(he){for(var xe=this.length||16;xe<this.pos+he;)xe*=2;if(xe!==this.length){var Te=new Uint8Array(xe);Te.set(this.buf),this.buf=Te,this.length=xe}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(he){this.realloc(4),ge(this.buf,he,this.pos),this.pos+=4},writeSFixed32:function(he){this.realloc(4),ge(this.buf,he,this.pos),this.pos+=4},writeFixed64:function(he){this.realloc(8),ge(this.buf,-1&he,this.pos),ge(this.buf,Math.floor(he*h),this.pos+4),this.pos+=8},writeSFixed64:function(he){this.realloc(8),ge(this.buf,-1&he,this.pos),ge(this.buf,Math.floor(he*h),this.pos+4),this.pos+=8},writeVarint:function(he){(he=+he||0)>268435455||he<0?function(xe,Te){var Ae,tt;if(xe>=0?(Ae=xe%4294967296|0,tt=xe/4294967296|0):(tt=~(-xe/4294967296),4294967295^(Ae=~(-xe%4294967296))?Ae=Ae+1|0:(Ae=0,tt=tt+1|0)),xe>=18446744073709552e3||xe<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");Te.realloc(10),function(Ke,Ye,Ct){Ct.buf[Ct.pos++]=127&Ke|128,Ke>>>=7,Ct.buf[Ct.pos++]=127&Ke|128,Ke>>>=7,Ct.buf[Ct.pos++]=127&Ke|128,Ke>>>=7,Ct.buf[Ct.pos++]=127&Ke|128,Ct.buf[Ct.pos]=127&(Ke>>>=7)}(Ae,0,Te),function(Ke,Ye){var Ct=(7&Ke)<<4;Ye.buf[Ye.pos++]|=Ct|((Ke>>>=3)?128:0),Ke&&(Ye.buf[Ye.pos++]=127&Ke|((Ke>>>=7)?128:0),Ke&&(Ye.buf[Ye.pos++]=127&Ke|((Ke>>>=7)?128:0),Ke&&(Ye.buf[Ye.pos++]=127&Ke|((Ke>>>=7)?128:0),Ke&&(Ye.buf[Ye.pos++]=127&Ke|((Ke>>>=7)?128:0),Ke&&(Ye.buf[Ye.pos++]=127&Ke)))))}(tt,Te)}(he,this):(this.realloc(4),this.buf[this.pos++]=127&he|(he>127?128:0),he<=127||(this.buf[this.pos++]=127&(he>>>=7)|(he>127?128:0),he<=127||(this.buf[this.pos++]=127&(he>>>=7)|(he>127?128:0),he<=127||(this.buf[this.pos++]=he>>>7&127))))},writeSVarint:function(he){this.writeVarint(he<0?2*-he-1:2*he)},writeBoolean:function(he){this.writeVarint(!!he)},writeString:function(he){he=String(he),this.realloc(4*he.length),this.pos++;var xe=this.pos;this.pos=function(Ae,tt,Ke){for(var Ye,Ct,ct=0;ct<tt.length;ct++){if((Ye=tt.charCodeAt(ct))>55295&&Ye<57344){if(!Ct){Ye>56319||ct+1===tt.length?(Ae[Ke++]=239,Ae[Ke++]=191,Ae[Ke++]=189):Ct=Ye;continue}if(Ye<56320){Ae[Ke++]=239,Ae[Ke++]=191,Ae[Ke++]=189,Ct=Ye;continue}Ye=Ct-55296<<10|Ye-56320|65536,Ct=null}else Ct&&(Ae[Ke++]=239,Ae[Ke++]=191,Ae[Ke++]=189,Ct=null);Ye<128?Ae[Ke++]=Ye:(Ye<2048?Ae[Ke++]=Ye>>6|192:(Ye<65536?Ae[Ke++]=Ye>>12|224:(Ae[Ke++]=Ye>>18|240,Ae[Ke++]=Ye>>12&63|128),Ae[Ke++]=Ye>>6&63|128),Ae[Ke++]=63&Ye|128)}return Ke}(this.buf,he,this.pos);var Te=this.pos-xe;Te>=128&&P(xe,Te,this),this.pos=xe-1,this.writeVarint(Te),this.pos+=Te},writeFloat:function(he){this.realloc(4),c.write(this.buf,he,this.pos,!0,23,4),this.pos+=4},writeDouble:function(he){this.realloc(8),c.write(this.buf,he,this.pos,!0,52,8),this.pos+=8},writeBytes:function(he){var xe=he.length;this.writeVarint(xe),this.realloc(xe);for(var Te=0;Te<xe;Te++)this.buf[this.pos++]=he[Te]},writeRawMessage:function(he,xe){this.pos++;var Te=this.pos;he(xe,this);var Ae=this.pos-Te;Ae>=128&&P(Te,Ae,this),this.pos=Te-1,this.writeVarint(Ae),this.pos+=Ae},writeMessage:function(he,xe,Te){this.writeTag(he,n.Bytes),this.writeRawMessage(xe,Te)},writePackedVarint:function(he,xe){xe.length&&this.writeMessage(he,L,xe)},writePackedSVarint:function(he,xe){xe.length&&this.writeMessage(he,N,xe)},writePackedBoolean:function(he,xe){xe.length&&this.writeMessage(he,F,xe)},writePackedFloat:function(he,xe){xe.length&&this.writeMessage(he,I,xe)},writePackedDouble:function(he,xe){xe.length&&this.writeMessage(he,z,xe)},writePackedFixed32:function(he,xe){xe.length&&this.writeMessage(he,R,xe)},writePackedSFixed32:function(he,xe){xe.length&&this.writeMessage(he,O,xe)},writePackedFixed64:function(he,xe){xe.length&&this.writeMessage(he,q,xe)},writePackedSFixed64:function(he,xe){xe.length&&this.writeMessage(he,te,xe)},writeBytesField:function(he,xe){this.writeTag(he,n.Bytes),this.writeBytes(xe)},writeFixed32Field:function(he,xe){this.writeTag(he,n.Fixed32),this.writeFixed32(xe)},writeSFixed32Field:function(he,xe){this.writeTag(he,n.Fixed32),this.writeSFixed32(xe)},writeFixed64Field:function(he,xe){this.writeTag(he,n.Fixed64),this.writeFixed64(xe)},writeSFixed64Field:function(he,xe){this.writeTag(he,n.Fixed64),this.writeSFixed64(xe)},writeVarintField:function(he,xe){this.writeTag(he,n.Varint),this.writeVarint(xe)},writeSVarintField:function(he,xe){this.writeTag(he,n.Varint),this.writeSVarint(xe)},writeStringField:function(he,xe){this.writeTag(he,n.Bytes),this.writeString(xe)},writeFloatField:function(he,xe){this.writeTag(he,n.Fixed32),this.writeFloat(xe)},writeDoubleField:function(he,xe){this.writeTag(he,n.Fixed64),this.writeDouble(xe)},writeBooleanField:function(he,xe){this.writeVarintField(he,!!xe)}},Pp}var d_=G(_m());const Ty=3;function Qb(c,n,a){n.glyphs=[],c===1&&a.readMessage(e0,n)}function e0(c,n,a){if(c===3){const{id:h,bitmap:v,width:f,height:x,left:P,top:L,advance:N}=a.readMessage(Jv,{});n.glyphs.push({id:h,bitmap:new wf({width:f+2*Ty,height:x+2*Ty},v),metrics:{width:f,height:x,left:P,top:L,advance:N}})}else c===4?n.ascender=a.readSVarint():c===5&&(n.descender=a.readSVarint())}function Jv(c,n,a){c===1?n.id=a.readVarint():c===2?n.bitmap=a.readBytes():c===3?n.width=a.readVarint():c===4?n.height=a.readVarint():c===5?n.left=a.readSVarint():c===6?n.top=a.readSVarint():c===7&&(n.advance=a.readVarint())}const Qv=Ty,Vo={horizontal:1,vertical:2,horizontalOnly:3};class ug{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(n,a){const h=new ug;return h.scale=n||1,h.fontStack=a,h}static forImage(n){const a=new ug;return a.image=n,a}}class ym{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(n,a){const h=new ym;for(let v=0;v<n.sections.length;v++){const f=n.sections[v];f.image?h.addImageSection(f):h.addTextSection(f,a)}return h}length(){return this.text.length}getSection(n){return this.sections[this.sectionIndex[n]]}getSections(){return this.sections}getSectionIndex(n){return this.sectionIndex[n]}getCodePoint(n){return this.text.codePointAt(n)}verticalizePunctuation(n){this.text=function(a,h){let v="";for(let f=0;f<a.length;f++){const x=a.charCodeAt(f+1)||null,P=a.charCodeAt(f-1)||null;v+=!h&&(x&&Qu(x)&&!Mc[a[f+1]]||P&&Qu(P)&&!Mc[a[f-1]])||!Mc[a[f]]?a[f]:Mc[a[f]]}return v}(this.text,n)}trim(){let n=0;for(let h=0;h<this.text.length&&Cy[this.text.charCodeAt(h)];h++)n++;let a=this.text.length;for(let h=this.text.length-1;h>=0&&h>=n&&Cy[this.text.charCodeAt(h)];h--)a--;this.text=this.text.substring(n,a),this.sectionIndex=this.sectionIndex.slice(n,a)}substring(n,a){const h=new ym;return h.text=this.text.substring(n,a),h.sectionIndex=this.sectionIndex.slice(n,a),h.sections=this.sections,h}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((n,a)=>Math.max(n,this.sections[a].scale),0)}addTextSection(n,a){this.text+=n.text,this.sections.push(ug.forText(n.scale,n.fontStack||a));const h=this.sections.length-1;for(let v=0;v<n.text.length;++v)this.sectionIndex.push(h)}addImageSection(n){const a=n.image&&n.image.namePrimary?n.image.getPrimary():null;if(!a)return void it("Can't add FormattedSection with an empty image.");const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCodePoint(h),this.sections.push(ug.forImage(a)),this.sectionIndex.push(this.sections.length-1)):it("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ex(c,n,a,h,v,f,x,P,L,N,I,z,F,R,O){const q=ym.fromFeature(c,v);z===Vo.vertical&&q.verticalizePunctuation(F);let te=[];const ae=function(Te,Ae,tt,Ke,Ye,Ct){if(!Te)return[];const ct=[],It=function(Wt,Kt,qt,yn,Yn,xn){let di=0;for(let ci=0;ci<Wt.length();ci++){const Ti=Wt.getSection(ci);di+=t0(Wt.getCodePoint(ci),Ti,yn,Yn,Kt,xn)}return di/Math.max(1,Math.ceil(di/qt))}(Te,Ae,tt,Ke,Ye,Ct),Rt=Te.text.indexOf("​")>=0;let At=0;for(let Wt=0;Wt<Te.length();Wt++){const Kt=Te.getSection(Wt),qt=Te.getCodePoint(Wt);if(Cy[qt]||(At+=t0(qt,Kt,Ke,Ye,Ae,Ct)),Wt<Te.length()-1){const yn=!((Vt=qt)<11904||!($i["Bopomofo Extended"](Vt)||$i.Bopomofo(Vt)||$i["CJK Compatibility Forms"](Vt)||$i["CJK Compatibility Ideographs"](Vt)||$i["CJK Compatibility"](Vt)||$i["CJK Radicals Supplement"](Vt)||$i["CJK Strokes"](Vt)||$i["CJK Symbols and Punctuation"](Vt)||$i["CJK Unified Ideographs Extension A"](Vt)||$i["CJK Unified Ideographs"](Vt)||$i["Enclosed CJK Letters and Months"](Vt)||$i["Halfwidth and Fullwidth Forms"](Vt)||$i.Hiragana(Vt)||$i["Ideographic Description Characters"](Vt)||$i["Kangxi Radicals"](Vt)||$i["Katakana Phonetic Extensions"](Vt)||$i.Katakana(Vt)||$i["Vertical Forms"](Vt)||$i["Yi Radicals"](Vt)||$i["Yi Syllables"](Vt)));(Vw[qt]||yn||Kt.image)&&ct.push(i0(Wt+1,At,It,ct,Nw(qt,Te.getCodePoint(Wt+1),yn&&Rt),!1))}}var Vt;return r0(i0(Te.length(),At,It,ct,0,!0))}(q,N,f,n,h,R),{processBidirectionalText:ge,processStyledBidirectionalText:_e}=Go;if(ge&&q.sections.length===1){const Te=ge(q.toString(),ae);for(const Ae of Te){const tt=new ym;tt.text=Ae,tt.sections=q.sections;for(let Ke=0;Ke<Ae.length;Ke++)tt.sectionIndex.push(0);te.push(tt)}}else if(_e){const Te=_e(q.text,q.sectionIndex,ae);for(const Ae of Te){const tt=new ym;tt.text=Ae[0],tt.sectionIndex=Ae[1],tt.sections=q.sections,te.push(tt)}}else te=function(Te,Ae){const tt=[],Ke=Te.text;let Ye=0;for(const Ct of Ae)tt.push(Te.substring(Ye,Ct)),Ye=Ct;return Ye<Ke.length&&tt.push(Te.substring(Ye,Ke.length)),tt}(q,ae);const he=[],xe={positionedLines:he,text:q.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:z,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Te,Ae,tt,Ke,Ye,Ct,ct,It,Rt,At,Vt,Wt){let Kt=0,qt=0,yn=0;const Yn=It==="right"?1:It==="left"?0:.5;let xn=!1;for(const gi of Ye){const Oi=gi.getSections();for(const rr of Oi){if(rr.image)continue;const wr=Ae[rr.fontStack];if(wr&&(xn=wr.ascender!==void 0&&wr.descender!==void 0,!xn))break}if(!xn)break}let di=0;for(const gi of Ye){gi.trim();const Oi=gi.getMaxScale(),rr=(Oi-1)*rs,wr={positionedGlyphs:[],lineOffset:0};Te.positionedLines[di]=wr;const Ir=wr.positionedGlyphs;let Fr=0;if(!gi.length()){qt+=Ct,++di;continue}let Pr=0,qr=0;for(let ya=0;ya<gi.length();ya++){const fr=gi.getSection(ya),va=gi.getSectionIndex(ya),ma=gi.getCodePoint(ya);let ka=fr.scale,uo=null,ho=null,Us=null,Wc=rs,as=0;const ds=!(Rt===Vo.horizontal||!Vt&&!Fl(ma)||Vt&&(Cy[ma]||(ci=ma,$i.Arabic(ci)||$i["Arabic Supplement"](ci)||$i["Arabic Extended-A"](ci)||$i["Arabic Presentation Forms-A"](ci)||$i["Arabic Presentation Forms-B"](ci))));if(fr.image){const Ic=Ke[fr.image.serialize()];if(!Ic)continue;Us=fr.image.id,Te.iconsInText=Te.iconsInText||!0,ho=Ic.paddedRect;const fo=Ic.displaySize;ka=ka*rs/Wt,uo={width:fo[0],height:fo[1],left:0,top:-3,advance:ds?fo[1]:fo[0],localGlyph:!1},as=xn?-uo.height*ka:Oi*rs-17-fo[1]*ka,Wc=uo.advance;const Mu=(ds?fo[0]:fo[1])*ka-rs*Oi;Mu>0&&Mu>Fr&&(Fr=Mu)}else{const Ic=tt[fr.fontStack];if(!Ic)continue;Ic[ma]&&(ho=Ic[ma]);const fo=Ae[fr.fontStack];if(!fo)continue;const Mu=fo.glyphs[ma];if(!Mu)continue;if(uo=Mu.metrics,Wc=ma!==8203?rs:0,xn){const No=fo.ascender!==void 0?Math.abs(fo.ascender):0,Rp=fo.descender!==void 0?Math.abs(fo.descender):0,mg=(No+Rp)*ka;Pr<mg&&(Pr=mg,qr=(No-Rp)/2*ka),as=-No*ka}else as=(Oi-ka)*rs-17}ds?(Te.verticalizable=!0,Ir.push({glyph:ma,imageName:Us,x:Kt,y:qt+as,vertical:ds,scale:ka,localGlyph:uo.localGlyph,fontStack:fr.fontStack,sectionIndex:va,metrics:uo,rect:ho}),Kt+=Wc*ka+At):(Ir.push({glyph:ma,imageName:Us,x:Kt,y:qt+as,vertical:ds,scale:ka,localGlyph:uo.localGlyph,fontStack:fr.fontStack,sectionIndex:va,metrics:uo,rect:ho}),Kt+=uo.advance*ka+At)}Ir.length!==0&&(yn=Math.max(Kt-At,yn),xn?f_(Ir,Yn,Fr,qr,Ct*Oi/2):f_(Ir,Yn,Fr,0,Ct/2)),Kt=0;const Aa=Ct*Oi+Fr;wr.lineOffset=Math.max(Fr,rr),qt+=Aa,++di}var ci;const Ti=qt,{horizontalAlign:In,verticalAlign:ji}=Eu(ct);(function(gi,Oi,rr,wr,Ir,Fr){const Pr=(Oi-rr)*Ir,qr=-Fr*wr;for(const Aa of gi)for(const ya of Aa.positionedGlyphs)ya.x+=Pr,ya.y+=qr})(Te.positionedLines,Yn,In,ji,yn,Ti),Te.top+=-ji*Ti,Te.bottom=Te.top+Ti,Te.left+=-In*yn,Te.right=Te.left+yn,Te.hasBaseline=xn}(xe,n,a,h,te,x,P,L,z,N,F,O),!function(Te){for(const Ae of Te)if(Ae.positionedGlyphs.length!==0)return!1;return!0}(he)&&xe}const Cy={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Vw={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function t0(c,n,a,h,v,f){if(n.image){const x=h[n.image.serialize()];return x?x.displaySize[0]*n.scale*rs/f+v:0}{const x=a[n.fontStack],P=x&&x.glyphs[c];return P?P.metrics.advance*n.scale+v:0}}function n0(c,n,a,h){const v=Math.pow(c-n,2);return h?c<n?v/2:2*v:v+Math.abs(a)*a}function Nw(c,n,a){let h=0;return c===10&&(h-=1e4),a&&(h+=150),c!==40&&c!==65288||(h+=50),n!==41&&n!==65289||(h+=50),h}function i0(c,n,a,h,v,f){let x=null,P=n0(n,a,v,f);for(const L of h){const N=n0(n-L.x,a,v,f)+L.badness;N<=P&&(x=L,P=N)}return{index:c,x:n,priorBreak:x,badness:P}}function r0(c){return c?r0(c.priorBreak).concat(c.index):[]}function Eu(c){let n=.5,a=.5;switch(c){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:n,verticalAlign:a}}function f_(c,n,a,h,v){if(!(n||a||h||v))return;const f=c.length-1,x=c[f],P=(x.x+x.metrics.advance*x.scale)*n;for(let L=0;L<=f;L++)c[L].x-=P,c[L].y+=a+h+v}function a0(c,n,a,h){const{horizontalAlign:v,verticalAlign:f}=Eu(h),x=a[0]-c.displaySize[0]*v,P=a[1]-c.displaySize[1]*f;return{imagePrimary:c,imageSecondary:n,top:P,bottom:P+c.displaySize[1],left:x,right:x+c.displaySize[0]}}function s0(c,n,a,h,v,f){const x=c.imagePrimary;let P;if(x.content){const te=x.content,ae=x.pixelRatio||1;P=[te[0]/ae,te[1]/ae,x.displaySize[0]-te[2]/ae,x.displaySize[1]-te[3]/ae]}const L=n.left*f,N=n.right*f;let I,z,F,R;a==="width"||a==="both"?(R=v[0]+L-h[3],z=v[0]+N+h[1]):(R=v[0]+(L+N-x.displaySize[0])/2,z=R+x.displaySize[0]);const O=n.top*f,q=n.bottom*f;return a==="height"||a==="both"?(I=v[1]+O-h[0],F=v[1]+q+h[2]):(I=v[1]+(O+q-x.displaySize[1])/2,F=I+x.displaySize[1]),{imagePrimary:x,imageSecondary:void 0,top:I,right:z,bottom:F,left:R,collisionPadding:P}}class Pf extends at{constructor(n,a,h,v,f){super(n,a),this.angle=v,this.z=h,f!==void 0&&(this.segment=f)}clone(){return new Pf(this.x,this.y,this.z,this.angle,this.segment)}}function o0(c,n,a,h,v){if(n.segment===void 0)return!0;let f=n,x=n.segment+1,P=0;for(;P>-a/2;){if(x--,x<0)return!1;P-=c[x].dist(f),f=c[x]}P+=c[x].dist(c[x+1]),x++;const L=[];let N=0;for(;P<a/2;){const I=c[x],z=c[x+1];if(!z)return!1;let F=c[x-1].angleTo(I)-I.angleTo(z);for(F=Math.abs((F+3*Math.PI)%(2*Math.PI)-Math.PI),L.push({distance:P,angleDelta:F}),N+=F;P-L[0].distance>h;)N-=L.shift().angleDelta;if(N>v)return!1;x++,P+=I.dist(z)}return!0}function wl(c){let n=0;for(let a=0;a<c.length-1;a++)n+=c[a].dist(c[a+1]);return n}function Zc(c,n,a){return c?.6*n*a:0}function Dp(c,n){return Math.max(c?c.right-c.left:0,n?n.right-n.left:0)}function Bh(c,n,a,h,v,f){const x=Zc(a,v,f),P=Dp(a,h)*f;let L=0;const N=wl(c)/2;for(let I=0;I<c.length-1;I++){const z=c[I],F=c[I+1],R=z.dist(F);if(L+R>N){const O=(N-L)/R,q=ir(z.x,F.x,O),te=ir(z.y,F.y,O),ae=new Pf(q,te,0,F.angleTo(z),I);return!x||o0(c,ae,P,x,n)?ae:void 0}L+=R}}function vm(c,n,a,h,v,f,x,P,L){const N=Zc(h,f,x),I=Dp(h,v),z=I*x,F=c[0].x===0||c[0].x===L||c[0].y===0||c[0].y===L;return n-z<n/4&&(n=z+n/4),Vh(c,F?n/2*P%n:(I/2+2*f)*x*P%n,n,N,a,z,F,!1,L)}function Vh(c,n,a,h,v,f,x,P,L){const N=f/2,I=wl(c);let z=0,F=n-a,R=[];for(let O=0;O<c.length-1;O++){const q=c[O],te=c[O+1],ae=q.dist(te),ge=te.angleTo(q);for(;F+a<z+ae;){F+=a;const _e=(F-z)/ae,he=ir(q.x,te.x,_e),xe=ir(q.y,te.y,_e);if(he>=0&&he<L&&xe>=0&&xe<L&&F-N>=0&&F+N<=I){const Te=new Pf(he,xe,0,ge,O);h&&!o0(c,Te,f,h,v)||R.push(Te)}}z+=ae}return P||R.length||x||(R=Vh(c,z/2,a,h,v,f,x,!0,L)),R}function wE(c,n,a,h,v){const f=[];for(let x=0;x<c.length;x++){const P=c[x];let L;for(let N=0;N<P.length-1;N++){let I=P[N],z=P[N+1];I.x<n&&z.x<n||(I.x<n?I=new at(n,I.y+(n-I.x)/(z.x-I.x)*(z.y-I.y))._round():z.x<n&&(z=new at(n,I.y+(n-I.x)/(z.x-I.x)*(z.y-I.y))._round()),I.y<a&&z.y<a||(I.y<a?I=new at(I.x+(a-I.y)/(z.y-I.y)*(z.x-I.x),a)._round():z.y<a&&(z=new at(I.x+(a-I.y)/(z.y-I.y)*(z.x-I.x),a)._round()),I.x>=h&&z.x>=h||(I.x>=h?I=new at(h,I.y+(h-I.x)/(z.x-I.x)*(z.y-I.y))._round():z.x>=h&&(z=new at(h,I.y+(h-I.x)/(z.x-I.x)*(z.y-I.y))._round()),I.y>=v&&z.y>=v||(I.y>=v?I=new at(I.x+(v-I.y)/(z.y-I.y)*(z.x-I.x),v)._round():z.y>=v&&(z=new at(I.x+(v-I.y)/(z.y-I.y)*(z.x-I.x),v)._round()),L&&I.equals(L[L.length-1])||(L=[I],f.push(L)),L.push(z)))))}}return f}function SE(c){let n=0,a=0;for(const x of c)n+=x.w*x.h,a=Math.max(a,x.w);c.sort((x,P)=>P.h-x.h);const h=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),a),h:1/0}];let v=0,f=0;for(const x of c)for(let P=h.length-1;P>=0;P--){const L=h[P];if(!(x.w>L.w||x.h>L.h)){if(x.x=L.x,x.y=L.y,f=Math.max(f,x.y+x.h),v=Math.max(v,x.x+x.w),x.w===L.w&&x.h===L.h){const N=h.pop();P<h.length&&(h[P]=N)}else x.h===L.h?(L.x+=x.w,L.w-=x.w):x.w===L.w?(L.y+=x.h,L.h-=x.h):(h.push({x:L.x+x.w,y:L.y,w:L.w-x.w,h:x.h}),L.y+=x.h,L.h-=x.h);break}}return{w:v,h:f,fill:n/(v*f)||0}}ki(Pf,"Anchor");const tx=1;class jw{constructor(n,{pixelRatio:a,version:h,stretchX:v,stretchY:f,content:x},P){this.paddedRect=n,this.pixelRatio=a,this.stretchX=v,this.stretchY=f,this.content=x,this.version=h,this.padding=P}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.pixelRatio,(this.paddedRect.h-2*this.padding)/this.pixelRatio]}}class TE{constructor(n,a,h){const v={},f={};this.haveRenderCallbacks=[];const x=[];this.addImages(n,v,tx,x),this.addImages(a,f,2,x);const{w:P,h:L}=SE(x),N=new Zo({width:P||1,height:L||1});for(const I in n){const z=n[I],F=v[I].paddedRect;Zo.copy(z.data,N,{x:0,y:0},{x:F.x+tx,y:F.y+tx},z.data,h,z.sdf)}for(const I in a){const z=a[I],F=f[I].paddedRect;let R=f[I].padding;const O=F.x+R,q=F.y+R,te=z.data.width,ae=z.data.height;R=R>1?R-1:R,Zo.copy(z.data,N,{x:0,y:0},{x:O,y:q},z.data,h),Zo.copy(z.data,N,{x:0,y:ae-R},{x:O,y:q-R},{width:te,height:R},h),Zo.copy(z.data,N,{x:0,y:0},{x:O,y:q+ae},{width:te,height:R},h),Zo.copy(z.data,N,{x:te-R,y:0},{x:O-R,y:q},{width:R,height:ae},h),Zo.copy(z.data,N,{x:0,y:0},{x:O+te,y:q},{width:R,height:ae},h),Zo.copy(z.data,N,{x:te-R,y:ae-R},{x:O-R,y:q-R},{width:R,height:R},h),Zo.copy(z.data,N,{x:0,y:ae-R},{x:O+te,y:q-R},{width:R,height:R},h),Zo.copy(z.data,N,{x:0,y:0},{x:O+te,y:q+ae},{width:R,height:R},h),Zo.copy(z.data,N,{x:te-R,y:0},{x:O-R,y:q+ae},{width:R,height:R},h)}this.image=N,this.iconPositions=v,this.patternPositions=f}addImages(n,a,h,v){for(const f in n){const x=n[f],P={x:0,y:0,w:x.data.width+2*h,h:x.data.height+2*h};v.push(P),a[f]=new jw(P,x,h),x.hasRenderCallback&&this.haveRenderCallbacks.push(el.deserializeId(f))}}patchUpdatedImages(n,a,h){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(v=>n.hasImage(v,h)),n.dispatchRenderCallbacks(this.haveRenderCallbacks,h);for(const v in n.getUpdatedImages(h)){for(const f of Object.keys(this.iconPositions))el.deserializeId(f)===v&&this.patchUpdatedImage(this.iconPositions[f],n.getImage(v,h),a);for(const f of Object.keys(this.patternPositions))el.deserializeId(f)===v&&this.patchUpdatedImage(this.patternPositions[f],n.getImage(v,h),a)}}patchUpdatedImage(n,a,h){if(!n||!a||n.version===a.version)return;n.version=a.version;const[v,f]=n.tl;h.update(a.data,{position:{x:v,y:f}})}}ki(jw,"ImagePosition"),ki(TE,"ImageAtlas");const l0=1e20;function CE(c,n,a,h,v,f,x,P,L){for(let N=n;N<n+h;N++)EE(c,a*f+N,f,v,x,P,L);for(let N=a;N<a+v;N++)EE(c,N*f+n,1,h,x,P,L)}function EE(c,n,a,h,v,f,x){f[0]=0,x[0]=-1e20,x[1]=l0,v[0]=c[n];for(let P=1,L=0,N=0;P<h;P++){v[P]=c[n+P*a];const I=P*P;do{const z=f[L];N=(v[P]-v[z]+I-z*z)/(P-z)/2}while(N<=x[L]&&--L>-1);L++,f[L]=P,x[L]=N,x[L+1]=l0}for(let P=0,L=0;P<h;P++){for(;x[L+1]<P;)L++;const N=f[L],I=P-N;c[n+P*a]=v[N]+I*I}}const Af=2,Uw={none:0,ideographs:1,all:2};class Ey{constructor(n,a,h){this.requestManager=n,this.localGlyphMode=a,this.localFontFamily=h,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(n,a){this.urls[a]=n}getGlyphs(n,a,h){const v=[],f=this.urls[a]||Ze.GLYPHS_URL;for(const x in n)for(const P of n[x])v.push({stack:x,id:P});sa(v,({stack:x,id:P},L)=>{let N=this.entries[x];N||(N=this.entries[x]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let I=N.glyphs[P];if(I!==void 0)return void L(null,{stack:x,id:P,glyph:I});if(I=this._tinySDF(N,x,P),I)return N.glyphs[P]=I,void L(null,{stack:x,id:P,glyph:I});const z=Math.floor(P/256);if(256*z>65535)return it("glyphs > 65535 not supported"),void L(null,{stack:x,id:P,glyph:I});if(N.ranges[z])return void L(null,{stack:x,id:P,glyph:I});let F=N.requests[z];F||(F=N.requests[z]=[],Ey.loadGlyphRange(x,z,f,this.requestManager,(R,O)=>{if(O){N.ascender=O.ascender,N.descender=O.descender;for(const q in O.glyphs)this._doesCharSupportLocalGlyph(+q)||(N.glyphs[+q]=O.glyphs[+q]);N.ranges[z]=!0}for(const q of F)q(R,O);delete N.requests[z]})),F.push((R,O)=>{R?L(R):O&&L(null,{stack:x,id:P,glyph:O.glyphs[P]||null})})},(x,P)=>{if(x)h(x);else if(P){const L={};for(const{stack:N,id:I,glyph:z}of P)L[N]===void 0&&(L[N]={}),L[N].glyphs===void 0&&(L[N].glyphs={}),L[N].glyphs[I]=z&&{id:z.id,bitmap:z.bitmap.clone(),metrics:z.metrics},L[N].ascender=this.entries[N].ascender,L[N].descender=this.entries[N].descender;h(null,L)}})}_doesCharSupportLocalGlyph(n){return this.localGlyphMode!==Uw.none&&(this.localGlyphMode===Uw.all?!!this.localFontFamily:!!this.localFontFamily&&($i["CJK Unified Ideographs"](n)||$i["Hangul Syllables"](n)||$i.Hiragana(n)||$i.Katakana(n)||$i["CJK Symbols and Punctuation"](n)||$i["CJK Unified Ideographs Extension A"](n)||$i["CJK Unified Ideographs Extension B"](n)||$i.Osage(n)))}_tinySDF(n,a,h){const v=this.localFontFamily;if(!v||!this._doesCharSupportLocalGlyph(h))return;let f=n.tinySDF;if(!f){let q="400";/bold/i.test(a)?q="900":/medium/i.test(a)?q="500":/light/i.test(a)&&(q="200"),f=n.tinySDF=new Ey.TinySDF({fontFamily:v,fontWeight:q,fontSize:24*Af,buffer:3*Af,radius:8*Af}),f.fontWeight=q}if(this.localGlyphs[f.fontWeight][h])return this.localGlyphs[f.fontWeight][h];const x=String.fromCodePoint(h),{data:P,width:L,height:N,glyphWidth:I,glyphHeight:z,glyphLeft:F,glyphTop:R,glyphAdvance:O}=f.draw(x);return this.localGlyphs[f.fontWeight][h]={id:h,bitmap:new wf({width:L,height:N},P),metrics:{width:I/Af,height:z/Af,left:F/Af,top:R/Af-27,advance:O/Af,localGlyph:!0}}}}Ey.loadGlyphRange=function(c,n,a,h,v){const f=256*n,x=f+255,P=h.transformRequest(h.normalizeGlyphsURL(a).replace("{fontstack}",c).replace("{range}",`${f}-${x}`),Fu.Glyphs);Bu(P,(L,N)=>{if(L)v(L);else if(N){const I={},z=function(F){return new d_(F).readFields(Qb,{})}(N);for(const F of z.glyphs)I[F.id]=F;v(null,{glyphs:I,ascender:z.ascender,descender:z.descender})}})},Ey.TinySDF=class{constructor({fontSize:c=24,buffer:n=3,radius:a=8,cutoff:h=.25,fontFamily:v="sans-serif",fontWeight:f="normal",fontStyle:x="normal"}={}){this.buffer=n,this.cutoff=h,this.radius=a;const P=this.size=c+4*n,L=this._createCanvas(P),N=this.ctx=L.getContext("2d",{willReadFrequently:!0});N.font=`${x} ${f} ${c}px ${v}`,N.textBaseline="alphabetic",N.textAlign="left",N.fillStyle="black",this.gridOuter=new Float64Array(P*P),this.gridInner=new Float64Array(P*P),this.f=new Float64Array(P),this.z=new Float64Array(P+1),this.v=new Uint16Array(P)}_createCanvas(c){const n=document.createElement("canvas");return n.width=n.height=c,n}draw(c){const{width:n,actualBoundingBoxAscent:a,actualBoundingBoxDescent:h,actualBoundingBoxLeft:v,actualBoundingBoxRight:f}=this.ctx.measureText(c),x=Math.ceil(a),P=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-v))),L=Math.min(this.size-this.buffer,x+Math.ceil(h)),N=P+2*this.buffer,I=L+2*this.buffer,z=Math.max(N*I,0),F=new Uint8ClampedArray(z),R={data:F,width:N,height:I,glyphWidth:P,glyphHeight:L,glyphTop:x,glyphLeft:0,glyphAdvance:n};if(P===0||L===0)return R;const{ctx:O,buffer:q,gridInner:te,gridOuter:ae}=this;O.clearRect(q,q,P,L),O.fillText(c,q,q+x);const ge=O.getImageData(q,q,P,L);ae.fill(l0,0,z),te.fill(0,0,z);for(let _e=0;_e<L;_e++)for(let he=0;he<P;he++){const xe=ge.data[4*(_e*P+he)+3]/255;if(xe===0)continue;const Te=(_e+q)*N+he+q;if(xe===1)ae[Te]=0,te[Te]=l0;else{const Ae=.5-xe;ae[Te]=Ae>0?Ae*Ae:0,te[Te]=Ae<0?Ae*Ae:0}}CE(ae,0,0,N,I,N,this.f,this.v,this.z),CE(te,q,q,P,L,N,this.f,this.v,this.z);for(let _e=0;_e<z;_e++){const he=Math.sqrt(ae[_e])-Math.sqrt(te[_e]);F[_e]=Math.round(255-255*(he/this.radius+this.cutoff))}return R}};const p_=tx;function ME(c,n){return c+n[1]-n[0]}function IE(c,n,a,h,v=1){const f=[],x=c.imagePrimary,P=x.pixelRatio,L=x.paddedRect.w-2*p_,N=x.paddedRect.h-2*p_,I=(c.right-c.left)*v,z=(c.bottom-c.top)*v,F=x.stretchX||[[0,L]],R=x.stretchY||[[0,N]],O=F.reduce(ME,0),q=R.reduce(ME,0),te=L-O,ae=N-q;let ge=0,_e=O,he=0,xe=q,Te=0,Ae=te,tt=0,Ke=ae;if(x.content&&h){const Ct=x.content;ge=c0(F,0,Ct[0]),he=c0(R,0,Ct[1]),_e=c0(F,Ct[0],Ct[2]),xe=c0(R,Ct[1],Ct[3]),Te=Ct[0]-ge,tt=Ct[1]-he,Ae=Ct[2]-Ct[0]-_e,Ke=Ct[3]-Ct[1]-xe}const Ye=(Ct,ct,It,Rt)=>{const At=u0(Ct.stretch-ge,_e,I,c.left*v),Vt=h0(Ct.fixed-Te,Ae,Ct.stretch,O),Wt=u0(ct.stretch-he,xe,z,c.top*v),Kt=h0(ct.fixed-tt,Ke,ct.stretch,q),qt=u0(It.stretch-ge,_e,I,c.left*v),yn=h0(It.fixed-Te,Ae,It.stretch,O),Yn=u0(Rt.stretch-he,xe,z,c.top*v),xn=h0(Rt.fixed-tt,Ke,Rt.stretch,q),di=new at(At,Wt),ci=new at(qt,Wt),Ti=new at(qt,Yn),In=new at(At,Yn),ji=new at(Vt/P,Kt/P),gi=new at(yn/P,xn/P),Oi=n*Math.PI/180;if(Oi){const qr=Math.sin(Oi),Aa=Math.cos(Oi),ya=[Aa,-qr,qr,Aa];di._matMult(ya),ci._matMult(ya),In._matMult(ya),Ti._matMult(ya)}const rr=Ct.stretch+Ct.fixed,wr=It.stretch+It.fixed,Ir=ct.stretch+ct.fixed,Fr=Rt.stretch+Rt.fixed,Pr=c.imageSecondary;return{tl:di,tr:ci,bl:In,br:Ti,texPrimary:{x:x.paddedRect.x+p_+rr,y:x.paddedRect.y+p_+Ir,w:wr-rr,h:Fr-Ir},texSecondary:Pr?{x:Pr.paddedRect.x+p_+rr,y:Pr.paddedRect.y+p_+Ir,w:wr-rr,h:Fr-Ir}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ji,pixelOffsetBR:gi,minFontScaleX:Ae/P/I,minFontScaleY:Ke/P/z,isSDF:a}};if(h&&(x.stretchX||x.stretchY)){const Ct=PE(F,te,O),ct=PE(R,ae,q);for(let It=0;It<Ct.length-1;It++){const Rt=Ct[It],At=Ct[It+1];for(let Vt=0;Vt<ct.length-1;Vt++)f.push(Ye(Rt,ct[Vt],At,ct[Vt+1]))}}else f.push(Ye({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:L+1},{fixed:0,stretch:N+1}));return f}function c0(c,n,a){let h=0;for(const v of c)h+=Math.max(n,Math.min(a,v[1]))-Math.max(n,Math.min(a,v[0]));return h}function PE(c,n,a){const h=[{fixed:-1,stretch:0}];for(const[v,f]of c){const x=h[h.length-1];h.push({fixed:v-x.stretch,stretch:x.stretch}),h.push({fixed:v-x.stretch,stretch:x.stretch+(f-v)})}return h.push({fixed:n+p_,stretch:a}),h}function u0(c,n,a,h){return c/n*a+h}function h0(c,n,a,h){return c-n*a/h}function vO(c,n,a,h){const v=n+c.positionedLines[h].lineOffset;return h===0?a+v/2:a+(v+(n+c.positionedLines[h-1].lineOffset))/2}function xO(c,n=1,a=!1){let h=1/0,v=1/0,f=-1/0,x=-1/0;const P=c[0];for(let R=0;R<P.length;R++){const O=P[R];(!R||O.x<h)&&(h=O.x),(!R||O.y<v)&&(v=O.y),(!R||O.x>f)&&(f=O.x),(!R||O.y>x)&&(x=O.y)}const L=Math.min(f-h,x-v);let N=L/2;const I=new sd([],bO);if(L===0)return new at(h,v);for(let R=h;R<f;R+=L)for(let O=v;O<x;O+=L)I.push(new My(R+N,O+N,N,c));let z=function(R){let O=0,q=0,te=0;const ae=R[0];for(let ge=0,_e=ae.length,he=_e-1;ge<_e;he=ge++){const xe=ae[ge],Te=ae[he],Ae=xe.x*Te.y-Te.x*xe.y;q+=(xe.x+Te.x)*Ae,te+=(xe.y+Te.y)*Ae,O+=3*Ae}return new My(q/O,te/O,0,R)}(c),F=I.length;for(;I.length;){const R=I.pop();(R.d>z.d||!z.d)&&(z=R,a&&console.log("found best %d after %d probes",Math.round(1e4*R.d)/1e4,F)),R.max-z.d<=n||(N=R.h/2,I.push(new My(R.p.x-N,R.p.y-N,N,c)),I.push(new My(R.p.x+N,R.p.y-N,N,c)),I.push(new My(R.p.x-N,R.p.y+N,N,c)),I.push(new My(R.p.x+N,R.p.y+N,N,c)),F+=4)}return a&&(console.log(`num probes: ${F}`),console.log(`best distance: ${z.d}`)),z.p}function bO(c,n){return n.max-c.max}class My{constructor(n,a,h,v){this.p=new at(n,a),this.h=h,this.d=function(f,x){let P=!1,L=1/0;for(let N=0;N<x.length;N++){const I=x[N];for(let z=0,F=I.length,R=F-1;z<F;R=z++){const O=I[z],q=I[R];O.y>f.y!=q.y>f.y&&f.x<(q.x-O.x)*(f.y-O.y)/(q.y-O.y)+O.x&&(P=!P),L=Math.min(L,vt(f,O,q))}}return(P?1:-1)*Math.sqrt(L)}(this.p,v),this.max=this.d+this.h*Math.SQRT2}}const $w=Number.POSITIVE_INFINITY,wO=Math.sqrt(2);function AE(c,[n,a]){let h=0,v=0;if(a===$w){n<0&&(n=0);const f=n/wO;switch(c){case"top-right":case"top-left":v=f-7;break;case"bottom-right":case"bottom-left":v=7-f;break;case"bottom":v=7-n;break;case"top":v=n-7}switch(c){case"top-right":case"bottom-right":h=-f;break;case"top-left":case"bottom-left":h=f;break;case"left":h=n;break;case"right":h=-n}}else{switch(n=Math.abs(n),a=Math.abs(a),c){case"top-right":case"top-left":case"top":v=a-7;break;case"bottom-right":case"bottom-left":case"bottom":v=7-a}switch(c){case"top-right":case"bottom-right":case"right":h=-n;break;case"top-left":case"bottom-left":case"left":h=n}}return[h,v]}function Gw(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function SO(c,n,a,h,v,f,x,P,L,N,I,z,F,R,O,q){let te=f.textMaxSize.evaluate(n,{},F);te===void 0?te=x*f.textScaleFactor:te*=f.textScaleFactor;const ae=c.layers[0].layout,ge=ae.get("icon-offset").evaluate(n,{},F),_e=DE(a.horizontal)||a.vertical,he=R.name==="globe",xe=rs,Te=x*f.textScaleFactor/xe,Ae=c.tilePixelRatio*te/xe,tt=(Vt=c.overscaling,c.zoom>18&&Vt>2&&(Vt>>=1),Math.max(mi/(512*Vt),1)*ae.get("symbol-spacing")),Ke=ae.get("text-padding")*c.tilePixelRatio,Ye=ae.get("icon-padding")*c.tilePixelRatio,Ct=zn(ae.get("text-max-angle")),ct=ae.get("text-rotation-alignment")==="map"&&ae.get("symbol-placement")!=="point",It=ae.get("icon-rotation-alignment")==="map"&&ae.get("symbol-placement")!=="point",Rt=ae.get("symbol-placement"),At=tt/2;var Vt;const Wt=ae.get("icon-text-fit").evaluate(n,{},F),Kt=ae.get("icon-text-fit-padding").evaluate(n,{},F),qt=Wt!=="none";let yn;c.hasAnyIconTextFit===!1&&qt&&(c.hasAnyIconTextFit=!0),h&&qt&&(c.allowVerticalPlacement&&a.vertical&&(yn=s0(h,a.vertical,Wt,Kt,ge,Te)),_e&&(h=s0(h,_e,Wt,Kt,ge,Te)));const Yn=(xn,di,ci)=>{if(di.x<0||di.x>=mi||di.y<0||di.y>=mi)return;let Ti=null;if(he){const{x:In,y:ji,z:gi}=R.projectTilePoint(di.x,di.y,ci);Ti={anchor:new Pf(In,ji,gi,0,void 0),up:R.upVector(ci,di.x,di.y)}}(function(In,ji,gi,Oi,rr,wr,Ir,Fr,Pr,qr,Aa,ya,fr,va,ma,ka,uo,ho,Us,Wc,as,ds,Ic,fo,Mu,No,Rp,mg){const gg=In.addToLineVertexArray(ji,Oi);let xm,_g,yg,B0,uI,hI,dI,fI=0,pI=0,mI=0,gI=0,CS=-1,ES=-1;const Lp={};let _I=au("");const v_=gi?gi.anchor:ji,MS=Pr.layout.get("icon-text-fit").evaluate(as,{},No)!=="none";let IS=0,PS=0;if(Pr._unevaluatedLayout.getValue("text-radial-offset")===void 0?[IS,PS]=Pr.layout.get("text-offset").evaluate(as,{},No).map(jh=>jh*rs):(IS=Pr.layout.get("text-radial-offset").evaluate(as,{},No)*rs,PS=$w),In.allowVerticalPlacement&&rr.vertical){const jh=rr.vertical;if(ma)hI=qw(jh),Fr&&(dI=qw(Fr));else{const hh=Pr.layout.get("text-rotate").evaluate(as,{},No)+90;yg=d0(qr,v_,ji,Aa,ya,fr,jh,va,hh,ka),Fr&&(B0=d0(qr,v_,ji,Aa,ya,fr,Fr,ho,hh))}}if(wr){const jh=In.iconSizeData,hh=fo?bl(In.iconSizeData,In.layers[0]._unevaluatedLayout._values["icon-size"],No,In.zoom,as):1,By=Pr.layout.get("icon-rotate").evaluate(as,{},No),yI=IE(wr,By,Ic,MS,fo?1/hh:ds.iconScaleFactor),kS=Fr?IE(Fr,By,Ic,MS,ds.iconScaleFactor):void 0;_g=d0(qr,v_,ji,Aa,ya,fr,wr,ho,By,null,fo?ds.iconScaleFactor*hh:1),fI=4*yI.length;let x_=null;jh.kind==="source"?(x_=[hs*Pr.layout.get("icon-size").evaluate(as,{},No)*ds.iconScaleFactor],x_[0]>hg&&it(`${In.layerIds[0]}: Value for "icon-size" is >= ${nx}. Reduce your "icon-size".`)):jh.kind==="composite"&&(x_=[hs*ds.compositeIconSizes[0].evaluate(as,{},No)*ds.iconScaleFactor,hs*ds.compositeIconSizes[1].evaluate(as,{},No)*ds.iconScaleFactor],(x_[0]>hg||x_[1]>hg)&&it(`${In.layerIds[0]}: Value for "icon-size" is >= ${nx}. Reduce your "icon-size".`)),In.addSymbols(In.icon,yI,x_,Wc,Us,as,!1,gi,ji,gg.lineStartIndex,gg.lineLength,-1,Mu,No,Rp,mg),CS=In.icon.placedSymbolArray.length-1,kS&&(pI=4*kS.length,In.addSymbols(In.icon,kS,x_,Wc,Us,as,Vo.vertical,gi,ji,gg.lineStartIndex,gg.lineLength,-1,Mu,No,Rp,mg),ES=In.icon.placedSymbolArray.length-1)}for(const jh in rr.horizontal){const hh=rr.horizontal[jh];xm||(_I=au(hh.text),ma?uI=qw(hh):xm=d0(qr,v_,ji,Aa,ya,fr,hh,va,Pr.layout.get("text-rotate").evaluate(as,{},No),ka));const By=hh.positionedLines.length===1;if(mI+=kE(In,gi,ji,hh,Ir,Pr,ma,as,ka,gg,rr.vertical?Vo.horizontal:Vo.horizontalOnly,By?Object.keys(rr.horizontal):[jh],Lp,CS,ds,Mu,No,Rp),By)break}rr.vertical&&(gI+=kE(In,gi,ji,rr.vertical,Ir,Pr,ma,as,ka,gg,Vo.vertical,["vertical"],Lp,ES,ds,Mu,No,Rp));let vg=-1;const AS=(jh,hh)=>jh?Math.max(jh,hh):hh;vg=AS(uI,vg),vg=AS(hI,vg),vg=AS(dI,vg);const nB=vg>-1?1:0;In.glyphOffsetArray.length>=65535&&it("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),as.sortKey!==void 0&&In.addToSortKeyRanges(In.symbolInstances.length,as.sortKey),In.symbolInstances.emplaceBack(ji.x,ji.y,v_.x,v_.y,v_.z,Lp.right>=0?Lp.right:-1,Lp.center>=0?Lp.center:-1,Lp.left>=0?Lp.left:-1,Lp.vertical>=0?Lp.vertical:-1,CS,ES,_I,xm!==void 0?xm:In.collisionBoxArray.length,xm!==void 0?xm+1:In.collisionBoxArray.length,yg!==void 0?yg:In.collisionBoxArray.length,yg!==void 0?yg+1:In.collisionBoxArray.length,_g!==void 0?_g:In.collisionBoxArray.length,_g!==void 0?_g+1:In.collisionBoxArray.length,B0||In.collisionBoxArray.length,B0?B0+1:In.collisionBoxArray.length,Aa,mI,gI,fI,pI,nB,0,IS,PS,vg,0,MS?1:0)})(c,di,Ti,xn,a,h,v,yn,c.layers[0],c.collisionBoxArray,n.index,n.sourceLayerIndex,c.index,Ke,ct,L,0,Ye,It,ge,n,f,N,I,z,F,O,q)};if(Rt==="line")for(const xn of wE(n.geometry,0,0,mi,mi)){const di=vm(xn,tt,Ct,a.vertical||_e,h,xe,Ae,c.overscaling,mi);for(const ci of di)_e&&TO(c,_e.text,At,ci)||Yn(xn,ci,F)}else if(Rt==="line-center"){for(const xn of n.geometry)if(xn.length>1){const di=Bh(xn,Ct,a.vertical||_e,h,xe,Ae);di&&Yn(xn,di,F)}}else if(n.type==="Polygon")for(const xn of py(n.geometry,0)){const di=xO(xn,16);Yn(xn[0],new Pf(di.x,di.y,0,0,void 0),F)}else if(n.type==="LineString")for(const xn of n.geometry)Yn(xn,new Pf(xn[0].x,xn[0].y,0,0,void 0),F);else if(n.type==="Point")for(const xn of n.geometry)for(const di of xn)Yn([di],new Pf(di.x,di.y,0,0,void 0),F)}const nx=255,hg=nx*hs;function kE(c,n,a,h,v,f,x,P,L,N,I,z,F,R,O,q,te,ae){const ge=function(xe,Te,Ae,tt,Ke,Ye,Ct,ct){const It=[];if(Te.positionedLines.length===0)return It;const Rt=tt.layout.get("text-rotate").evaluate(Ye,{})*Math.PI/180,At=function(yn){const Yn=yn[0],xn=yn[1],di=Yn*xn;return di>0?[Yn,-xn]:di<0?[-Yn,xn]:Yn===0?[xn,Yn]:[xn,-Yn]}(Ae);let Vt=Math.abs(Te.top-Te.bottom);for(const yn of Te.positionedLines)Vt-=yn.lineOffset;const Wt=Te.positionedLines.length,Kt=Vt/Wt;let qt=Te.top-Ae[1];for(let yn=0;yn<Wt;++yn){const Yn=Te.positionedLines[yn];qt=vO(Te,Kt,qt,yn);for(const xn of Yn.positionedGlyphs){if(!xn.rect)continue;const di=xn.rect||{};let ci=Qv+1,Ti=!0,In=1,ji=0;if(xn.imageName){const Us=Ct[Oa.build(xn.imageName).getSerializedPrimary()];if(!Us)continue;if(Us.sdf){it("SDF images are not supported in formatted text and will be ignored.");continue}Ti=!1,In=Us.pixelRatio,ci=tx/In}const gi=(Ke||ct)&&xn.vertical,Oi=xn.metrics.advance*xn.scale/2,rr=xn.metrics,wr=xn.rect;if(wr===null)continue;ct&&Te.verticalizable&&(ji=xn.imageName?Oi-xn.metrics.width*xn.scale/2:0);const Ir=Ke?[xn.x+Oi,xn.y]:[0,0];let Fr=[0,0],Pr=[0,0],qr=!1;Ke||(gi?(Pr=[xn.x+Oi+At[0],xn.y+At[1]-ji],qr=!0):Fr=[xn.x+Oi+Ae[0],xn.y+Ae[1]-ji]);const Aa=wr.w*xn.scale/(In*(xn.localGlyph?Af:1)),ya=wr.h*xn.scale/(In*(xn.localGlyph?Af:1));let fr,va,ma,ka;if(gi){const Us=xn.y-qt,Wc=new at(-Oi,Oi-Us),as=-Math.PI/2,ds=new at(...Pr);fr=new at(-Oi+Fr[0],Fr[1]),fr._rotateAround(as,Wc)._add(ds),fr.x+=-Us+Oi,fr.y-=(rr.left-ci)*xn.scale;const Ic=xn.imageName?rr.advance*xn.scale:rs*xn.scale,fo=String.fromCodePoint(xn.glyph);lg(fo)?fr.x+=(1-ci)*xn.scale:Fh(fo)?fr.x+=Ic-rr.height*xn.scale+(-ci-1)*xn.scale:fr.x+=xn.imageName||rr.width+2*ci===wr.w&&rr.height+2*ci===wr.h?(Ic-ya)/2:(Ic-(rr.height+2*ci)*xn.scale)/2,va=new at(fr.x,fr.y-Aa),ma=new at(fr.x+ya,fr.y),ka=new at(fr.x+ya,fr.y-Aa)}else{const Us=(rr.left-ci)*xn.scale-Oi+Fr[0],Wc=(-rr.top-ci)*xn.scale+Fr[1],as=Us+Aa,ds=Wc+ya;fr=new at(Us,Wc),va=new at(as,Wc),ma=new at(Us,ds),ka=new at(as,ds)}if(Rt){let Us;Us=Ke?new at(0,0):qr?new at(At[0],At[1]):new at(Ae[0],Ae[1]),fr._rotateAround(Rt,Us),va._rotateAround(Rt,Us),ma._rotateAround(Rt,Us),ka._rotateAround(Rt,Us)}const uo=new at(0,0),ho=new at(0,0);It.push({tl:fr,tr:va,bl:ma,br:ka,texPrimary:di,texSecondary:void 0,writingMode:Te.writingMode,glyphOffset:Ir,sectionIndex:xn.sectionIndex,isSDF:Ti,pixelOffsetTL:uo,pixelOffsetBR:ho,minFontScaleX:0,minFontScaleY:0})}}return It}(0,h,L,f,x,P,v,c.allowVerticalPlacement),_e=c.textSizeData;let he=null;_e.kind==="source"?(he=[hs*f.layout.get("text-size").evaluate(P,{},te)*O.textScaleFactor],he[0]>hg&&it(`${c.layerIds[0]}: Value for "text-size" is >= ${nx}. Reduce your "text-size".`)):_e.kind==="composite"&&(he=[hs*O.compositeTextSizes[0].evaluate(P,{},te)*O.textScaleFactor,hs*O.compositeTextSizes[1].evaluate(P,{},te)*O.textScaleFactor],(he[0]>hg||he[1]>hg)&&it(`${c.layerIds[0]}: Value for "text-size" is >= ${nx}. Reduce your "text-size".`)),c.addSymbols(c.text,ge,he,L,x,P,I,n,a,N.lineStartIndex,N.lineLength,R,q,te,ae,!1);for(const xe of z)F[xe]=c.text.placedSymbolArray.length-1;return 4*ge.length}function DE(c){for(const n in c)return c[n];return null}function d0(c,n,a,h,v,f,x,P,L,N,I=1){let z=x.top/I,F=x.bottom/I,R=x.left/I,O=x.right/I;const q=x.collisionPadding;if(q&&(R-=q[0],z-=q[1],O+=q[2],F+=q[3]),L){const te=new at(R,z),ae=new at(O,z),ge=new at(R,F),_e=new at(O,F),he=zn(L);let xe=new at(0,0);N&&(xe=new at(N[0],N[1])),te._rotateAround(he,xe),ae._rotateAround(he,xe),ge._rotateAround(he,xe),_e._rotateAround(he,xe),R=Math.min(te.x,ae.x,ge.x,_e.x),O=Math.max(te.x,ae.x,ge.x,_e.x),z=Math.min(te.y,ae.y,ge.y,_e.y),F=Math.max(te.y,ae.y,ge.y,_e.y)}return c.emplaceBack(n.x,n.y,n.z,a.x,a.y,R,z,O,F,P,h,v,f),c.length-1}function qw(c){c.collisionPadding&&(c.top-=c.collisionPadding[1],c.bottom+=c.collisionPadding[3]);const n=c.bottom-c.top;return n>0?Math.max(10,n):null}function TO(c,n,a,h){const v=c.compareText;if(n in v){const f=v[n];for(let x=f.length-1;x>=0;x--)if(h.dist(f[x])<a)return!0}else v[n]=[];return v[n].push(h),!1}function RE(c,n){const a=c.fovAboveCenter,h=c.elevation?c.elevation.getMinElevationBelowMSL()*n:0,v=(c._camera.position[2]*c.worldSize-h)/Math.cos(c._pitch),f=Math.sin(a)*v/Math.sin(Math.max(Math.PI/2-c._pitch-a,.01));let x=Math.sin(c._pitch)*f+v;const P=v*(1/c._horizonShift);return c.elevation&&c.elevation.exaggeration()!==0||(x*=1+Math.max(c.zoom-17,0)),Math.min(1.01*x,P)}function ix(c,n){if(!n.isReprojectedInTileSpace)return{scale:1<<c.z,x:c.x,y:c.y,x2:c.x+1,y2:c.y+1,projection:n};const a=Math.pow(2,-c.z),h=c.x*a,v=(c.x+1)*a,f=c.y*a,x=(c.y+1)*a,P=Nl(h),L=Nl(v),N=Ws(f),I=Ws(x),z=n.project(P,N),F=n.project(L,N),R=n.project(L,I),O=n.project(P,I);let q=Math.min(z.x,F.x,R.x,O.x),te=Math.min(z.y,F.y,R.y,O.y),ae=Math.max(z.x,F.x,R.x,O.x),ge=Math.max(z.y,F.y,R.y,O.y);const _e=a/16;function he(Te,Ae,tt,Ke,Ye,Ct){const ct=(tt+Ye)/2,It=(Ke+Ct)/2,Rt=n.project(Nl(ct),Ws(It)),At=Math.max(0,q-Rt.x,te-Rt.y,Rt.x-ae,Rt.y-ge);q=Math.min(q,Rt.x),ae=Math.max(ae,Rt.x),te=Math.min(te,Rt.y),ge=Math.max(ge,Rt.y),At>_e&&(he(Te,Rt,tt,Ke,ct,It),he(Rt,Ae,ct,It,Ye,Ct))}he(z,F,h,f,v,f),he(F,R,v,f,v,x),he(R,O,v,x,h,x),he(O,z,h,x,h,f),q-=_e,te-=_e,ae+=_e,ge+=_e;const xe=1/Math.max(ae-q,ge-te);return{scale:xe,x:q*xe,y:te*xe,x2:ae*xe,y2:ge*xe,projection:n}}function LE(c,{x:n,y:a},h=0){return new at(((n-h)*c.scale-c.x)*mi,(a*c.scale-c.y)*mi)}const CO=ht.mat4.identity(new Float32Array(16));class dg{constructor(n){this.spec=n,this.name=n.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(n,a){return{x:0,y:0,z:0}}unproject(n,a){return new Kr(0,0)}projectTilePoint(n,a,h){return{x:n,y:a,z:0}}locationPoint(n,a,h=!0){return n._coordinatePoint(n.locationCoordinate(a),h)}pixelsPerMeter(n,a){return ao(1,n)*a}pixelSpaceConversion(n,a,h){return 1}farthestPixelDistance(n){return RE(n,n.pixelsPerMeter)}pointCoordinate(n,a,h,v){const f=n.horizonLineFromTop(!1),x=new at(a,Math.max(f,h));return n.rayIntersectionCoordinate(n.pointRayIntersection(x,v))}pointCoordinate3D(n,a,h){const v=new at(a,h);if(n.elevation)return n.elevation.pointCoordinate(v);{const f=this.pointCoordinate(n,v.x,v.y,0);return[f.x,f.y,f.z]}}isPointAboveHorizon(n,a){if(n.elevation&&n.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(n,a.x,a.y);const h=n.horizonLineFromTop();return a.y<h}createInversionMatrix(n,a){return CO}createTileMatrix(n,a,h){let v,f,x;const P=h.canonical,L=ht.mat4.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const N=ix(P,this);v=1,f=N.x+h.wrap*N.scale,x=N.y,ht.mat4.scale(L,L,[v/N.scale,v/N.scale,n.pixelsPerMeter/a])}else v=a/n.zoomScale(P.z),f=(P.x+Math.pow(2,P.z)*h.wrap)*v,x=P.y*v;return ht.mat4.translate(L,L,[f,x,0]),ht.mat4.scale(L,L,[v/mi,v/mi,1]),L}upVector(n,a,h){return[0,0,1]}upVectorScale(n,a,h){return{metersToTile:1}}}class EO extends dg{constructor(n){super(n),this.range=[4,7],this.center=n.center||[-96,37.5];const[a,h]=this.parallels=n.parallels||[29.5,45.5],v=Math.sin(zn(a));this.n=(v+Math.sin(zn(h)))/2,this.c=1+v*(2*this.n-v),this.r0=Math.sqrt(this.c)/this.n}project(n,a){const{n:h,c:v,r0:f}=this,x=zn(n-this.center[0]),P=zn(a),L=Math.sqrt(v-2*h*Math.sin(P))/h;return{x:L*Math.sin(x*h),y:L*Math.cos(x*h)-f,z:0}}unproject(n,a){const{n:h,c:v,r0:f}=this,x=f+a;let P=Math.atan2(n,Math.abs(x))*Math.sign(x);x*h<0&&(P-=Math.PI*Math.sign(n)*Math.sign(x));const L=zn(this.center[0])*h;P=Er(P,-Math.PI-L,Math.PI-L);const N=ui(vi(P/h)+this.center[0],-180,180),I=Math.asin(ui((v-(n*n+x*x)*h*h)/(2*h),-1,1)),z=ui(vi(I),-85.051129,xo);return new Kr(N,z)}}const rx=1.340264,ax=-.081106,sx=893e-6,ox=.003796,f0=Math.sqrt(3)/2;class MO extends dg{project(n,a){a=a/180*Math.PI,n=n/180*Math.PI;const h=Math.asin(f0*Math.sin(a)),v=h*h,f=v*v*v;return{x:.5*(n*Math.cos(h)/(f0*(rx+3*ax*v+f*(7*sx+9*ox*v)))/Math.PI+.5),y:1-.5*(h*(rx+ax*v+f*(sx+ox*v))/Math.PI+1),z:0}}unproject(n,a){n=(2*n-.5)*Math.PI;let h=a=(2*(1-a)-1)*Math.PI,v=h*h,f=v*v*v;for(let I,z,F,R=0;R<12&&(z=h*(rx+ax*v+f*(sx+ox*v))-a,F=rx+3*ax*v+f*(7*sx+9*ox*v),I=z/F,h=ui(h-I,-Math.PI/3,Math.PI/3),v=h*h,f=v*v*v,!(Math.abs(I)<1e-12));++R);const x=f0*n*(rx+3*ax*v+f*(7*sx+9*ox*v))/Math.cos(h),P=Math.asin(Math.sin(h)/f0),L=ui(180*x/Math.PI,-180,180),N=ui(180*P/Math.PI,-85.051129,xo);return new Kr(L,N)}}class IO extends dg{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0}project(n,a){return{x:.5+n/360,y:.5-a/360,z:0}}unproject(n,a){const h=360*(n-.5),v=ui(360*(.5-a),-85.051129,xo);return new Kr(h,v)}}const Iy=Math.PI/2;function p0(c){return Math.tan((Iy+c)/2)}class PO extends dg{constructor(n){super(n),this.center=n.center||[0,30];const[a,h]=this.parallels=n.parallels||[30,30];let v=zn(a),f=zn(h);this.southernCenter=v+f<0,this.southernCenter&&(v=-v,f=-f);const x=Math.cos(v),P=p0(v);this.n=v===f?Math.sin(v):Math.log(x/Math.cos(f))/Math.log(p0(f)/P),this.f=x*Math.pow(p0(v),this.n)/this.n}project(n,a){a=zn(a),this.southernCenter&&(a=-a),n=zn(n-this.center[0]);const h=1e-6,{n:v,f}=this;f>0?a<-Iy+h&&(a=-Iy+h):a>Iy-h&&(a=Iy-h);const x=f/Math.pow(p0(a),v);let P=x*Math.sin(v*n),L=f-x*Math.cos(v*n);return P=.5*(P/Math.PI+.5),L=.5*(L/Math.PI+.5),{x:P,y:this.southernCenter?L:1-L,z:0}}unproject(n,a){n=(2*n-.5)*Math.PI,this.southernCenter&&(a=1-a),a=(2*(1-a)-.5)*Math.PI;const{n:h,f:v}=this,f=v-a,x=Math.sign(f),P=Math.sign(h)*Math.sqrt(n*n+f*f);let L=Math.atan2(n,Math.abs(f))*x;f*h<0&&(L-=Math.PI*Math.sign(n)*x);const N=ui(vi(L/h)+this.center[0],-180,180),I=ui(vi(2*Math.atan(Math.pow(v/P,1/h))-Iy),-85.051129,xo);return new Kr(N,this.southernCenter?-I:I)}}class zE extends dg{constructor(n){super(n),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(n,a){return{x:ch(n),y:Ga(a),z:0}}unproject(n,a){const h=Nl(n),v=Ws(a);return new Kr(h,v)}}const OE=zn(xo);class AO extends dg{project(n,a){const h=(a=zn(a))*a,v=h*h;return{x:.5*((n=zn(n))*(.8707-.131979*h+v*(v*(.003971*h-.001529*v)-.013791))/Math.PI+.5),y:1-.5*(a*(1.007226+h*(.015085+v*(.028874*h-.044475-.005916*v)))/Math.PI+1),z:0}}unproject(n,a){n=(2*n-.5)*Math.PI;let h=a=(2*(1-a)-1)*Math.PI,v=25,f=0,x=h*h;do{x=h*h;const N=x*x;f=(h*(1.007226+x*(.015085+N*(.028874*x-.044475-.005916*N)))-a)/(1.007226+x*(.045255+N*(.259866*x-.311325-.005916*11*N))),h=ui(h-f,-OE,OE)}while(Math.abs(f)>1e-6&&--v>0);x=h*h;const P=ui(vi(n/(.8707+x*(x*(x*x*x*(.003971-.001529*x)-.013791)-.131979))),-180,180),L=vi(h);return new Kr(P,L)}}const FE=zn(xo);class kO extends dg{project(n,a){a=zn(a),n=zn(n);const h=Math.cos(a),v=2/Math.PI,f=Math.acos(h*Math.cos(n/2)),x=Math.sin(f)/f,P=.5*(n*v+2*h*Math.sin(n/2)/x)||0,L=.5*(a+Math.sin(a)/x)||0;return{x:.5*(P/Math.PI+.5),y:1-.5*(L/Math.PI+1),z:0}}unproject(n,a){let h=n=(2*n-.5)*Math.PI,v=a=(2*(1-a)-1)*Math.PI,f=25;const x=1e-6;let P=0,L=0;do{const N=Math.cos(v),I=Math.sin(v),z=2*I*N,F=I*I,R=N*N,O=Math.cos(h/2),q=Math.sin(h/2),te=2*O*q,ae=q*q,ge=1-R*O*O,_e=ge?1/ge:0,he=ge?Math.acos(N*O)*Math.sqrt(1/ge):0,xe=.5*(2*he*N*q+2*h/Math.PI)-n,Te=.5*(he*I+v)-a,Ae=.5*_e*(R*ae+he*N*O*F)+1/Math.PI,tt=_e*(te*z/4-he*I*q),Ke=.125*_e*(z*q-he*I*R*te),Ye=.5*_e*(F*O+he*ae*N)+.5,Ct=tt*Ke-Ye*Ae;P=(Te*tt-xe*Ye)/Ct,L=(xe*Ke-Te*Ae)/Ct,h=ui(h-P,-Math.PI,Math.PI),v=ui(v-L,-FE,FE)}while((Math.abs(P)>x||Math.abs(L)>x)&&--f>0);return new Kr(vi(h),vi(v))}}class BE extends dg{constructor(n){super(n),this.center=n.center||[0,0],this.parallels=n.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(zn(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(n,a){const{scale:h,cosPhi:v}=this;return{x:zn(n)*v*h+.5,y:-Math.sin(zn(a))/v*h+.5,z:0}}unproject(n,a){const{scale:h,cosPhi:v}=this,f=-(a-.5)/h,x=ui(vi((n-.5)/h)/v,-180,180),P=Math.asin(ui(f*v,-1,1)),L=ui(vi(P),-85.051129,xo);return new Kr(x,L)}}class DO extends zE{constructor(n){super(n),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(n,a,h){const v=$r(n,a,h),f=Lr(Ls(h));return ht.vec3.transformMat4(v,v,f),{x:v[0],y:v[1],z:v[2]}}locationPoint(n,a){const h=Pd(a.lat,a.lng),v=ht.vec3.normalize([],h),f=n.elevation?n.elevation.getAtPointOrZero(n.locationCoordinate(a),n._centerAltitude):n._centerAltitude,x=ao(1,0)*mi*f;ht.vec3.scaleAndAdd(h,h,v,x);const P=ht.mat4.identity(new Float64Array(16));return ht.mat4.multiply(P,n.pixelMatrix,n.globeMatrix),ht.vec3.transformMat4(h,h,P),new at(h[0],h[1])}pixelsPerMeter(n,a){return ao(1,0)*a}pixelSpaceConversion(n,a,h){const v=ao(1,n)*a,f=ir(ao(1,45)*a,v,h);return this.pixelsPerMeter(n,a)/f}createTileMatrix(n,a,h){const v=Fo(Ls(h.canonical));return ht.mat4.multiply(new Float64Array(16),n.globeMatrix,v)}createInversionMatrix(n,a){const{center:h}=n,v=Lr(Ls(a));return ht.mat4.rotateY(v,v,zn(h.lng)),ht.mat4.rotateX(v,v,zn(h.lat)),ht.mat4.scale(v,v,[n._pixelsPerMercatorPixel,n._pixelsPerMercatorPixel,1]),Float32Array.from(v)}pointCoordinate(n,a,h,v){return Xa(n,a,h,!0)||new y(0,0)}pointCoordinate3D(n,a,h){const v=this.pointCoordinate(n,a,h,0);return[v.x,v.y,v.z]}isPointAboveHorizon(n,a){return!Xa(n,a.x,a.y,!1)}farthestPixelDistance(n){const a=function(v,f){const x=v.cameraToCenterDistance,P=v._centerAltitude*f,L=v._camera,N=v._camera.forward(),I=ht.vec3.add([],ht.vec3.scale([],N,-x),[0,0,P]),z=v.worldSize/(2*Math.PI),F=[0,0,-z],R=v.width/v.height,O=Math.tan(v.fovAboveCenter),q=ht.vec3.scale([],L.up(),O),te=ht.vec3.scale([],L.right(),O*R),ae=ht.vec3.normalize([],ht.vec3.add([],ht.vec3.add([],N,q),te)),ge=[];let _e;if(new Ur(I,ae).closestPointOnSphere(F,z,ge)){const he=ht.vec3.add([],ge,F),xe=ht.vec3.sub([],he,I);_e=Math.cos(v.fovAboveCenter)*ht.vec3.length(xe)}else{const he=ht.vec3.sub([],I,F),xe=ht.vec3.sub([],F,I);ht.vec3.normalize(xe,xe);const Te=ht.vec3.length(he)-z;_e=Math.sqrt(Te*(Te+2*z));const Ae=Math.acos(_e/(z+Te))-Math.acos(ht.vec3.dot(N,xe));_e*=Math.cos(Ae)}return 1.01*_e}(n,this.pixelsPerMeter(n.center.lat,n.worldSize)),h=Ho(n.zoom);if(h>0){const v=RE(n,ao(1,n.center.lat)*n.worldSize),f=n.worldSize/(2*Math.PI),x=Math.max(n.width,n.height)/n.worldSize*Math.PI;return ir(a,v+f*(1-Math.cos(x)),Math.pow(h,10))}return a}upVector(n,a,h){return $r(a,h,n,1)}upVectorScale(n){return{metersToTile:ea(is(Ls(n)))}}}function VE(c){const n=c.parallels,a=!!n&&Math.abs(n[0]+n[1])<.01;switch(c.name){case"mercator":return new zE(c);case"equirectangular":return new IO(c);case"naturalEarth":return new AO(c);case"equalEarth":return new MO(c);case"winkelTripel":return new kO(c);case"albers":return a?new BE(c):new EO(c);case"lambertConformalConic":return a?new BE(c):new PO(c);case"globe":return new DO(c)}throw new Error(`Invalid projection name: ${c.name}`)}const RO=pm.VectorTileFeature.types,LO=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function m0(c,n,a,h,v,f,x,P,L,N,I,z,F){const R=P?Math.min(hg,Math.round(P[0])):0,O=P?Math.min(hg,Math.round(P[1])):0;c.emplaceBack(n,a,Math.round(32*h),Math.round(32*v),f,x,(R<<1)+(L?1:0),O,16*N,16*I,256*z,256*F)}function g0(c,n,a){c.emplaceBack(n,a)}function _0(c,n,a,h,v,f,x){c.emplaceBack(n,a,h,v,f,x)}function y0(c,n,a,h,v){c.emplaceBack(n,a,h,v),c.emplaceBack(n,a,h,v),c.emplaceBack(n,a,h,v),c.emplaceBack(n,a,h,v)}function zO(c){for(const n of c.sections)if(bd(n.text))return!0;return!1}class Hw{constructor(n){this.layoutVertexArray=new Gi,this.indexArray=new Wr,this.programConfigurations=n,this.segments=new Wa,this.dynamicLayoutVertexArray=new ei,this.opacityVertexArray=new ua,this.placedSymbolArray=new _l,this.iconTransitioningVertexArray=new Ma,this.globeExtVertexArray=new Hr,this.zOffsetVertexArray=new gs}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(n,a,h,v,f){this.isEmpty()||(h&&(this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,xl.members),this.indexBuffer=n.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=n.createVertexBuffer(this.dynamicLayoutVertexArray,Ec.members,!0),this.opacityVertexBuffer=n.createVertexBuffer(this.opacityVertexArray,LO,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=n.createVertexBuffer(this.iconTransitioningVertexArray,zs.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=n.createVertexBuffer(this.globeExtVertexArray,Cu.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||f)&&(this.zOffsetVertexBuffer=n.createVertexBuffer(this.zOffsetVertexArray,ol.members,!0)),this.opacityVertexBuffer.itemSize=1),(h||v)&&this.programConfigurations.upload(n))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}ki(Hw,"SymbolBuffers");class Zw{constructor(n,a,h){this.layoutVertexArray=new n,this.layoutAttributes=a,this.indexArray=new h,this.segments=new Wa,this.collisionVertexArray=new Pa,this.collisionVertexArrayExt=new ei}upload(n){this.layoutVertexBuffer=n.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=n.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=n.createVertexBuffer(this.collisionVertexArray,Xo.members,!0),this.collisionVertexBufferExt=n.createVertexBuffer(this.collisionVertexArrayExt,ll.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}ki(Zw,"CollisionBuffers");class v0{constructor(n){this.collisionBoxArray=n.collisionBoxArray,this.zoom=n.zoom,this.lut=n.lut,this.overscaling=n.overscaling,this.layers=n.layers,this.layerIds=this.layers.map(x=>x.fqid),this.index=n.index,this.pixelRatio=n.pixelRatio,this.sourceLayerIndex=n.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ht.mat4.identity([]),this.placementViewportMatrix=ht.mat4.identity([]);const a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=oo(this.zoom,a["text-size"]),this.iconSizeData=oo(this.zoom,a["icon-size"]);const h=this.layers[0].layout,v=h.get("symbol-sort-key"),f=h.get("symbol-z-order");this.canOverlap=h.get("text-allow-overlap")||h.get("icon-allow-overlap")||h.get("text-ignore-placement")||h.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&v.constantOr(1)!==void 0,this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=h.get("text-writing-mode").map(x=>Vo[x]),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=n.sourceID,this.projection=n.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=h.get("symbol-z-elevate"),this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new Hw(new oh(this.layers,{zoom:this.zoom,lut:this.lut},n=>n.startsWith("text")||n.startsWith("symbol"))),this.icon=new Hw(new oh(this.layers,{zoom:this.zoom,lut:this.lut},n=>n.startsWith("icon")||n.startsWith("symbol"))),this.glyphOffsetArray=new Td,this.lineVertexArray=new Lh,this.symbolInstances=new Zm}calculateGlyphDependencies(n,a,h,v,f){for(const x of n){const P=x.codePointAt(0);if(P===void 0)break;if(a[P]=!0,v&&f&&P<=65535){const L=Mc[x];L&&(a[L.charCodeAt(0)]=!0)}}}updateFootprints(n,a){}updateReplacement(n,a){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const h=a.getReplacementRegionsForTile(n.toUnwrapped(),!0);return!ng(this.activeReplacements,h)&&(this.activeReplacements=h,!0)}populate(n,a,h,v){const f=this.layers[0],x=f.layout,P=this.projection.name==="globe",L=x.get("text-font"),N=x.get("text-field"),I=x.get("icon-image"),[z,F]=x.get("icon-size-scale-range"),R=ui(a.scaleFactor||1,z,F),O=(N.value.kind!=="constant"||N.value.value instanceof Yr&&!N.value.value.isEmpty()||N.value.value.toString().length>0)&&(L.value.kind!=="constant"||L.value.value.length>0),q=I.value.kind!=="constant"||!!I.value.value||Object.keys(I.parameters).length>0,te=x.get("symbol-sort-key");if(this.features=[],!O&&!q)return;const ae=a.iconDependencies,ge=a.glyphDependencies,_e=a.availableImages,he=new ba(this.zoom);for(const{feature:xe,id:Te,index:Ae,sourceLayerIndex:tt}of n){const Ke=f._featureFilter.needGeometry,Ye=le(xe,Ke);if(!f._featureFilter.filter(he,Ye,h))continue;if(Ke||(Ye.geometry=se(xe,h,v)),P&&xe.type!==1&&h.z<=5){const At=Ye.geometry,Vt=.98078528056,Wt=(Kt,qt)=>{const yn=$r(Kt.x,Kt.y,h,1),Yn=$r(qt.x,qt.y,h,1);return ht.vec3.dot(yn,Yn)<Vt};for(let Kt=0;Kt<At.length;Kt++)At[Kt]=V(At[Kt],Wt)}let Ct,ct;if(O){const At=f.getValueAndResolveTokens("text-field",Ye,h,_e),Vt=Yr.factory(At);zO(Vt)&&(this.hasRTLText=!0),(!this.hasRTLText||mf()==="unavailable"||this.hasRTLText&&Go.isParsed())&&(Ct=Ts(Vt,f,Ye))}if(q){const At=f.getValueAndResolveTokens("icon-image",Ye,h,_e);ct=At instanceof Oa?At:Oa.build(At)}if(!Ct&&!ct)continue;const It=this.sortFeaturesByKey?te.evaluate(Ye,{},h):void 0,Rt={id:Te,text:Ct,icon:ct,index:Ae,sourceLayerIndex:tt,geometry:Ye.geometry,properties:xe.properties,type:RO[xe.type],sortKey:It};if(this.features.push(Rt),ct){const At=bl(this.iconSizeData,this.layers[0]._unevaluatedLayout._values["icon-size"],h,this.zoom,Rt)*R*this.pixelRatio,Vt=ct.getPrimary().scaleSelf(At);if(ae[Vt.id]=ae[Vt.id]||[],ae[Vt.id].push(Vt),ct.nameSecondary){const Wt=ct.getSecondary().scaleSelf(At);ae[Wt.id]=ae[Wt.id]||[],ae[Wt.id].push(Wt)}}if(Ct){const At=L.evaluate(Ye,{},h).join(","),Vt=x.get("text-rotation-alignment")==="map"&&x.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Vo.vertical)>=0;for(const Wt of Ct.sections)if(Wt.image){const Kt=Wt.image.getPrimary().scaleSelf(this.pixelRatio);ae[Kt.id]=ae[Kt.id]||[],ae[Kt.id].push(Kt)}else{const Kt=ff(Ct.toString()),qt=Wt.fontStack||At,yn=ge[qt]=ge[qt]||{};this.calculateGlyphDependencies(Wt.text,yn,Vt,this.allowVerticalPlacement,Kt)}}}x.get("symbol-placement")==="line"&&(this.features=function(xe){const Te={},Ae={},tt=[];let Ke=0;function Ye(Rt){tt.push(xe[Rt]),Ke++}function Ct(Rt,At,Vt){const Wt=Ae[Rt];return delete Ae[Rt],Ae[At]=Wt,tt[Wt].geometry[0].pop(),tt[Wt].geometry[0]=tt[Wt].geometry[0].concat(Vt[0]),Wt}function ct(Rt,At,Vt){const Wt=Te[At];return delete Te[At],Te[Rt]=Wt,tt[Wt].geometry[0].shift(),tt[Wt].geometry[0]=Vt[0].concat(tt[Wt].geometry[0]),Wt}function It(Rt,At,Vt){const Wt=Vt?At[0][At[0].length-1]:At[0][0];return`${Rt}:${Wt.x}:${Wt.y}`}for(let Rt=0;Rt<xe.length;Rt++){const At=xe[Rt],Vt=At.geometry,Wt=At.text?At.text.toString():null;if(!Wt){Ye(Rt);continue}const Kt=It(Wt,Vt),qt=It(Wt,Vt,!0);if(Kt in Ae&&qt in Te&&Ae[Kt]!==Te[qt]){const yn=ct(Kt,qt,Vt),Yn=Ct(Kt,qt,tt[yn].geometry);delete Te[Kt],delete Ae[qt],Ae[It(Wt,tt[Yn].geometry,!0)]=Yn,tt[yn].geometry=null}else Kt in Ae?Ct(Kt,qt,Vt):qt in Te?ct(Kt,qt,Vt):(Ye(Rt),Te[Kt]=Ke-1,Ae[qt]=Ke-1)}return tt.filter(Rt=>Rt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((xe,Te)=>xe.sortKey-Te.sortKey)}update(n,a,h,v,f,x,P){this.text.programConfigurations.updatePaintArrays(n,a,f,h,v,x,P),this.icon.programConfigurations.updatePaintArrays(n,a,f,h,v,x,P)}updateZOffset(){const n=(f,x,P)=>{h+=x,h>f.length&&f.resize(h);for(let L=-x;L<0;L++)f.emplace(L+h,P)},a=(f,x,P)=>{v+=x,v>f.length&&f.resize(v);for(let L=-x;L<0;L++)f.emplace(L+v,P)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let h=0,v=0;for(let f=0;f<this.symbolInstances.length;f++){const x=this.symbolInstances.get(f),{numHorizontalGlyphVertices:P,numVerticalGlyphVertices:L,numIconVertices:N}=x,I=x.zOffset,z=N>0;if((P>0||L>0)&&(n(this.text.zOffsetVertexArray,P,I),n(this.text.zOffsetVertexArray,L,I)),z){const{placedIconSymbolIndex:F,verticalPlacedIconSymbolIndex:R}=x;F>=0&&a(this.icon.zOffsetVertexArray,N,I),R>=0&&a(this.icon.zOffsetVertexArray,x.numVerticalIconVertices,I)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(n){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(n),this.iconCollisionBox.upload(n)),this.text.upload(n,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(n,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=VE(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(n,a){const h=this.lineVertexArray.length;if(n.segment!==void 0)for(const{x:v,y:f}of a)this.lineVertexArray.emplaceBack(v,f);return{lineStartIndex:h,lineLength:this.lineVertexArray.length-h}}addSymbols(n,a,h,v,f,x,P,L,N,I,z,F,R,O,q,te){const ae=n.indexArray,ge=n.layoutVertexArray,_e=n.globeExtVertexArray,he=n.segments.prepareSegment(4*a.length,ge,ae,this.canOverlap?x.sortKey:void 0),xe=this.glyphOffsetArray.length,Te=he.vertexLength,Ae=this.allowVerticalPlacement&&P===Vo.vertical?Math.PI/2:0,tt=x.text&&x.text.sections;for(let Ye=0;Ye<a.length;Ye++){const{tl:Ct,tr:ct,bl:It,br:Rt,texPrimary:At,texSecondary:Vt,pixelOffsetTL:Wt,pixelOffsetBR:Kt,minFontScaleX:qt,minFontScaleY:yn,glyphOffset:Yn,isSDF:xn,sectionIndex:di}=a[Ye],ci=he.vertexLength,Ti=Yn[1];if(m0(ge,N.x,N.y,Ct.x,Ti+Ct.y,At.x,At.y,h,xn,Wt.x,Wt.y,qt,yn),m0(ge,N.x,N.y,ct.x,Ti+ct.y,At.x+At.w,At.y,h,xn,Kt.x,Wt.y,qt,yn),m0(ge,N.x,N.y,It.x,Ti+It.y,At.x,At.y+At.h,h,xn,Wt.x,Kt.y,qt,yn),m0(ge,N.x,N.y,Rt.x,Ti+Rt.y,At.x+At.w,At.y+At.h,h,xn,Kt.x,Kt.y,qt,yn),L){const{x:In,y:ji,z:gi}=L.anchor,[Oi,rr,wr]=L.up;_0(_e,In,ji,gi,Oi,rr,wr),_0(_e,In,ji,gi,Oi,rr,wr),_0(_e,In,ji,gi,Oi,rr,wr),_0(_e,In,ji,gi,Oi,rr,wr),y0(n.dynamicLayoutVertexArray,In,ji,gi,Ae)}else y0(n.dynamicLayoutVertexArray,N.x,N.y,N.z,Ae);if(te){const In=Vt||At;g0(n.iconTransitioningVertexArray,In.x,In.y),g0(n.iconTransitioningVertexArray,In.x+In.w,In.y),g0(n.iconTransitioningVertexArray,In.x,In.y+In.h),g0(n.iconTransitioningVertexArray,In.x+In.w,In.y+In.h)}ae.emplaceBack(ci,ci+1,ci+2),ae.emplaceBack(ci+1,ci+2,ci+3),he.vertexLength+=4,he.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Yn[0]),Ye!==a.length-1&&di===a[Ye+1].sectionIndex||n.programConfigurations.populatePaintArrays(ge.length,x,x.index,{},R,O,q,tt&&tt[di])}const Ke=L?L.anchor:N;n.placedSymbolArray.emplaceBack(Ke.x,Ke.y,Ke.z,N.x,N.y,xe,this.glyphOffsetArray.length-xe,Te,I,z,N.segment,h?h[0]:0,h?h[1]:0,v[0],v[1],P,0,!1,0,F,0)}_commitLayoutVertex(n,a,h,v,f,x,P){n.emplaceBack(a,h,v,f,x,Math.round(P.x),Math.round(P.y))}_addCollisionDebugVertices(n,a,h,v,f,x,P){const L=h.segments.prepareSegment(4,h.layoutVertexArray,h.indexArray),N=L.vertexLength,I=P.tileAnchorX,z=P.tileAnchorY;for(let R=0;R<4;R++)h.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(h.collisionVertexArrayExt,a,n.padding,P.zOffset),this._commitLayoutVertex(h.layoutVertexArray,v,f,x,I,z,new at(n.x1,n.y1)),this._commitLayoutVertex(h.layoutVertexArray,v,f,x,I,z,new at(n.x2,n.y1)),this._commitLayoutVertex(h.layoutVertexArray,v,f,x,I,z,new at(n.x2,n.y2)),this._commitLayoutVertex(h.layoutVertexArray,v,f,x,I,z,new at(n.x1,n.y2)),L.vertexLength+=4;const F=h.indexArray;F.emplaceBack(N,N+1),F.emplaceBack(N+1,N+2),F.emplaceBack(N+2,N+3),F.emplaceBack(N+3,N),L.primitiveLength+=4}_addTextDebugCollisionBoxes(n,a,h,v,f,x){for(let P=v;P<f;P++){const L=h.get(P),N=this.getSymbolInstanceTextSize(n,x,a,P);this._addCollisionDebugVertices(L,N,this.textCollisionBox,L.projectedAnchorX,L.projectedAnchorY,L.projectedAnchorZ,x)}}_addIconDebugCollisionBoxes(n,a,h,v,f,x){for(let P=v;P<f;P++){const L=h.get(P),N=this.getSymbolInstanceIconSize(n,a,x.placedIconSymbolIndex);this._addCollisionDebugVertices(L,N,this.iconCollisionBox,L.projectedAnchorX,L.projectedAnchorY,L.projectedAnchorZ,x)}}generateCollisionDebugBuffers(n,a,h){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Zw(Ha,Yo.members,Ma),this.iconCollisionBox=new Zw(Ha,Yo.members,Ma);const v=js(this.iconSizeData,n),f=js(this.textSizeData,n,h);for(let x=0;x<this.symbolInstances.length;x++){const P=this.symbolInstances.get(x);this._addTextDebugCollisionBoxes(f,n,a,P.textBoxStartIndex,P.textBoxEndIndex,P),this._addTextDebugCollisionBoxes(f,n,a,P.verticalTextBoxStartIndex,P.verticalTextBoxEndIndex,P),this._addIconDebugCollisionBoxes(v,n,a,P.iconBoxStartIndex,P.iconBoxEndIndex,P),this._addIconDebugCollisionBoxes(v,n,a,P.verticalIconBoxStartIndex,P.verticalIconBoxEndIndex,P)}}getSymbolInstanceTextSize(n,a,h,v){const f=this.text.placedSymbolArray.get(a.rightJustifiedTextSymbolIndex>=0?a.rightJustifiedTextSymbolIndex:a.centerJustifiedTextSymbolIndex>=0?a.centerJustifiedTextSymbolIndex:a.leftJustifiedTextSymbolIndex>=0?a.leftJustifiedTextSymbolIndex:a.verticalPlacedTextSymbolIndex>=0?a.verticalPlacedTextSymbolIndex:v),x=lo(this.textSizeData,n,f)/rs;return this.tilePixelRatio*x}getSymbolInstanceIconSize(n,a,h){const v=this.icon.placedSymbolArray.get(h),f=lo(this.iconSizeData,n,v);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(n,a,h,v){n.emplaceBack(a,-h,-h,v),n.emplaceBack(a,h,-h,v),n.emplaceBack(a,h,h,v),n.emplaceBack(a,-h,h,v)}_updateTextDebugCollisionBoxes(n,a,h,v,f,x,P){for(let L=v;L<f;L++){const N=h.get(L),I=this.getSymbolInstanceTextSize(n,x,a,L);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,I,N.padding,x.zOffset)}}_updateIconDebugCollisionBoxes(n,a,h,v,f,x,P){for(let L=v;L<f;L++){const N=h.get(L),I=this.getSymbolInstanceIconSize(n,a,x.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,I,N.padding,x.zOffset)}}updateCollisionDebugBuffers(n,a,h,v){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const f=js(this.iconSizeData,n,v),x=js(this.textSizeData,n,h);for(let P=0;P<this.symbolInstances.length;P++){const L=this.symbolInstances.get(P);this._updateTextDebugCollisionBoxes(x,n,a,L.textBoxStartIndex,L.textBoxEndIndex,L,h),this._updateTextDebugCollisionBoxes(x,n,a,L.verticalTextBoxStartIndex,L.verticalTextBoxEndIndex,L,h),this._updateIconDebugCollisionBoxes(f,n,a,L.iconBoxStartIndex,L.iconBoxEndIndex,L,v),this._updateIconDebugCollisionBoxes(f,n,a,L.verticalIconBoxStartIndex,L.verticalIconBoxEndIndex,L,v)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(n,a,h,v,f,x,P,L,N){const I={};if(a<h){const{x1:z,y1:F,x2:R,y2:O,padding:q,projectedAnchorX:te,projectedAnchorY:ae,projectedAnchorZ:ge,tileAnchorX:_e,tileAnchorY:he,featureIndex:xe}=n.get(a);I.textBox={x1:z,y1:F,x2:R,y2:O,padding:q,projectedAnchorX:te,projectedAnchorY:ae,projectedAnchorZ:ge,tileAnchorX:_e,tileAnchorY:he},I.textFeatureIndex=xe}if(v<f){const{x1:z,y1:F,x2:R,y2:O,padding:q,projectedAnchorX:te,projectedAnchorY:ae,projectedAnchorZ:ge,tileAnchorX:_e,tileAnchorY:he,featureIndex:xe}=n.get(v);I.verticalTextBox={x1:z,y1:F,x2:R,y2:O,padding:q,projectedAnchorX:te,projectedAnchorY:ae,projectedAnchorZ:ge,tileAnchorX:_e,tileAnchorY:he},I.verticalTextFeatureIndex=xe}if(x<P){const{x1:z,y1:F,x2:R,y2:O,padding:q,projectedAnchorX:te,projectedAnchorY:ae,projectedAnchorZ:ge,tileAnchorX:_e,tileAnchorY:he,featureIndex:xe}=n.get(x);I.iconBox={x1:z,y1:F,x2:R,y2:O,padding:q,projectedAnchorX:te,projectedAnchorY:ae,projectedAnchorZ:ge,tileAnchorX:_e,tileAnchorY:he},I.iconFeatureIndex=xe}if(L<N){const{x1:z,y1:F,x2:R,y2:O,padding:q,projectedAnchorX:te,projectedAnchorY:ae,projectedAnchorZ:ge,tileAnchorX:_e,tileAnchorY:he,featureIndex:xe}=n.get(L);I.verticalIconBox={x1:z,y1:F,x2:R,y2:O,padding:q,projectedAnchorX:te,projectedAnchorY:ae,projectedAnchorZ:ge,tileAnchorX:_e,tileAnchorY:he},I.verticalIconFeatureIndex=xe}return I}deserializeCollisionBoxes(n){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const h=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(n,h.textBoxStartIndex,h.textBoxEndIndex,h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h.iconBoxStartIndex,h.iconBoxEndIndex,h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(n,a){const h=n.placedSymbolArray.get(a),v=h.vertexStartIndex+4*h.numGlyphs;for(let f=h.vertexStartIndex;f<v;f+=4)n.indexArray.emplaceBack(f,f+1,f+2),n.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(n){if(this.sortedAngle===n&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const a=Math.sin(n),h=Math.cos(n),v=[],f=[],x=[];for(let P=0;P<this.symbolInstances.length;++P){x.push(P);const L=this.symbolInstances.get(P);v.push(0|Math.round(a*L.tileAnchorX+h*L.tileAnchorY)),f.push(L.featureIndex)}return x.sort((P,L)=>v[P]-v[L]||f[L]-f[P]),x}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let n=0;n<this.symbolInstances.length;++n)this.symbolInstanceIndexesSortedZOffset.push(n)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((n,a)=>this.symbolInstances.get(a).zOffset-this.symbolInstances.get(n).zOffset)}addToSortKeyRanges(n,a){const h=this.sortKeyRanges[this.sortKeyRanges.length-1];h&&h.sortKey===a?h.symbolInstanceEnd=n+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:n,symbolInstanceEnd:n+1})}sortFeatures(n){if(this.sortFeaturesByY&&this.sortedAngle!==n&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(n),this.sortedAngle=n,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const h=this.symbolInstances.get(a);this.featureSortOrder.push(h.featureIndex);const{rightJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:f,leftJustifiedTextSymbolIndex:x,verticalPlacedTextSymbolIndex:P,placedIconSymbolIndex:L,verticalPlacedIconSymbolIndex:N}=h;v>=0&&this.addIndicesForPlacedSymbol(this.text,v),f>=0&&f!==v&&this.addIndicesForPlacedSymbol(this.text,f),x>=0&&x!==f&&x!==v&&this.addIndicesForPlacedSymbol(this.text,x),P>=0&&this.addIndicesForPlacedSymbol(this.text,P),L>=0&&this.addIndicesForPlacedSymbol(this.icon,L),N>=0&&this.addIndicesForPlacedSymbol(this.icon,N)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let NE,jE,Ww;ki(v0,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),v0.addDynamicAttributes=y0;class UE{constructor(n){this.type=n.property.overrides?n.property.overrides.runtimeType:su,this.defaultValue=n}evaluate(n){if(n.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(n.formattedSection))return a.getOverride(n.formattedSection)}return n.feature&&n.featureState?this.defaultValue.evaluate(n.feature,n.featureState):this.defaultValue.property.specification.default}eachChild(n){this.defaultValue.isConstant()||n(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ki(UE,"FormatSectionOverride",{omit:["defaultValue"]});const Xw=()=>Ww||(Ww={layout:NE||(NE=new _a({"symbol-placement":new Xn(tn.layout_symbol["symbol-placement"]),"symbol-spacing":new Xn(tn.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Xn(tn.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ei(tn.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Xn(tn.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Xn(tn.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Xn(tn.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Xn(tn.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Xn(tn.layout_symbol["icon-ignore-placement"]),"icon-optional":new Xn(tn.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Xn(tn.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ei(tn.layout_symbol["icon-size"]),"icon-size-scale-range":new Xn(tn.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Ei(tn.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ei(tn.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ei(tn.layout_symbol["icon-image"]),"icon-rotate":new Ei(tn.layout_symbol["icon-rotate"]),"icon-padding":new Xn(tn.layout_symbol["icon-padding"]),"icon-keep-upright":new Xn(tn.layout_symbol["icon-keep-upright"]),"icon-offset":new Ei(tn.layout_symbol["icon-offset"]),"icon-anchor":new Ei(tn.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Xn(tn.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Xn(tn.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Xn(tn.layout_symbol["text-rotation-alignment"]),"text-field":new Ei(tn.layout_symbol["text-field"]),"text-font":new Ei(tn.layout_symbol["text-font"]),"text-size":new Ei(tn.layout_symbol["text-size"]),"text-size-scale-range":new Xn(tn.layout_symbol["text-size-scale-range"]),"text-max-width":new Ei(tn.layout_symbol["text-max-width"]),"text-line-height":new Ei(tn.layout_symbol["text-line-height"]),"text-letter-spacing":new Ei(tn.layout_symbol["text-letter-spacing"]),"text-justify":new Ei(tn.layout_symbol["text-justify"]),"text-radial-offset":new Ei(tn.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Xn(tn.layout_symbol["text-variable-anchor"]),"text-anchor":new Ei(tn.layout_symbol["text-anchor"]),"text-max-angle":new Xn(tn.layout_symbol["text-max-angle"]),"text-writing-mode":new Xn(tn.layout_symbol["text-writing-mode"]),"text-rotate":new Ei(tn.layout_symbol["text-rotate"]),"text-padding":new Xn(tn.layout_symbol["text-padding"]),"text-keep-upright":new Xn(tn.layout_symbol["text-keep-upright"]),"text-transform":new Ei(tn.layout_symbol["text-transform"]),"text-offset":new Ei(tn.layout_symbol["text-offset"]),"text-allow-overlap":new Xn(tn.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Xn(tn.layout_symbol["text-ignore-placement"]),"text-optional":new Xn(tn.layout_symbol["text-optional"]),visibility:new Xn(tn.layout_symbol.visibility)})),paint:jE||(jE=new _a({"icon-opacity":new Ei(tn.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Ei(tn.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Ei(tn.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Ei(tn.paint_symbol["text-emissive-strength"]),"icon-color":new Ei(tn.paint_symbol["icon-color"]),"icon-halo-color":new Ei(tn.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ei(tn.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ei(tn.paint_symbol["icon-halo-blur"]),"icon-translate":new Xn(tn.paint_symbol["icon-translate"]),"icon-translate-anchor":new Xn(tn.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Ei(tn.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Ei(tn.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Ei(tn.paint_symbol["text-occlusion-opacity"]),"text-color":new Ei(tn.paint_symbol["text-color"],{runtimeType:Sr,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new Ei(tn.paint_symbol["text-halo-color"]),"text-halo-width":new Ei(tn.paint_symbol["text-halo-width"]),"text-halo-blur":new Ei(tn.paint_symbol["text-halo-blur"]),"text-translate":new Xn(tn.paint_symbol["text-translate"]),"text-translate-anchor":new Xn(tn.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Xn(tn.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Xn(tn.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Xn(tn.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Xn(tn.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Ei(tn.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Ei({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Ei({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Ei({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Ei({type:"string",default:"default","property-type":"data-driven"})}))},Ww);class x0 extends Et{constructor(n,a,h,v){super(n,Xw(),a,h,v),this._colorAdjustmentMatrix=ht.mat4.identity([]),this.hasInitialOcclusionOpacityProperties=n.paint!==void 0&&("icon-occlusion-opacity"in n.paint||"text-occlusion-opacity"in n.paint)}recalculate(n,a){super.recalculate(n,a),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const h=this.layout.get("text-writing-mode");if(h){const v=[];for(const f of h)v.indexOf(f)<0&&v.push(f);this.layout._values["text-writing-mode"]=v}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(n,a,h,v){return this._saturation===n&&this._contrast===a&&this._brightnessMin===h&&this._brightnessMax===v||(this._colorAdjustmentMatrix=function(f,x,P,L){f=Pe(f),x=we(x);const N=ht.mat4.create(),I=f/3,z=1-2*I,F=[z,I,I,0,I,z,I,0,I,I,z,0,0,0,0,1],R=.5-.5*x,O=L-P;return ht.mat4.multiply(N,[O,0,0,0,0,O,0,0,0,0,O,0,P,P,P,1],[x,0,0,0,0,x,0,0,0,0,x,0,R,R,R,1]),ht.mat4.multiply(N,N,F),N}(n,a,h,v),this._saturation=n,this._contrast=a,this._brightnessMin=h,this._brightnessMax=v),this._colorAdjustmentMatrix}getValueAndResolveTokens(n,a,h,v){const f=this.layout.get(n).evaluate(a,{},h,v),x=this._unevaluatedLayout._values[n];return x.isDataDriven()||Qr(x.value)||!f?f:function(P,L){return L.replace(/{([^{}]+)}/g,(N,I)=>I in P?String(P[I]):"")}(a.properties,f)}createBucket(n){return new v0(n)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const n of Xw().paint.overridableProperties){if(!x0.hasPaintOverride(this.layout,n))continue;const a=this.paint.get(n),h=new UE(a),v=new cp(h,a.property.specification,this.scope,this.options);let f=null;f=a.value.kind==="constant"||a.value.kind==="source"?new up("source",v):new yu("composite",v,a.value.zoomStops,a.value._interpolationType),this.paint._values[n]=new nh(a.property,f,a.parameters)}}_handleOverridablePaintPropertyUpdate(n,a,h){return!(!this.layout||a.isDataDriven()||h.isDataDriven())&&x0.hasPaintOverride(this.layout,n)}static hasPaintOverride(n,a){const h=n.get("text-field"),v=Xw().paint.properties[a];let f=!1;const x=P=>{for(const L of P)if(v.overrides&&v.overrides.hasOverride(L))return void(f=!0)};if(h.value.kind==="constant"&&h.value.value instanceof Yr)x(h.value.value.sections);else if(h.value.kind==="source"){const P=N=>{f||(N instanceof Il&&Ca(N.value)===io?x(N.value.sections):N instanceof cu?x(N.sections):N.eachChild(P))},L=h.value;L._styleExpression&&P(L._styleExpression.expression)}return f}getProgramIds(){return["symbol"]}getDefaultProgramParams(n,a,h){return{config:new Md(this,{zoom:a,lut:h}),overrideFog:!1}}}let $E,GE,qE,HE;var Yw=Bt([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function Kw(c){switch(c){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function Jw(c){switch(c){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class Qw{constructor(n,a,h,v){this.context=n,this.format=h,this.useMipmap=v&&v.useMipmap,this.texture=n.gl.createTexture(),this.update(a,{premultiply:v&&v.premultiply})}update(n,a){const h=n&&n instanceof HTMLVideoElement&&n.width===0?n.videoWidth:n.width,v=n&&n instanceof HTMLVideoElement&&n.height===0?n.videoHeight:n.height,{context:f}=this,{gl:x}=f,{x:P,y:L}=a&&a.position?a.position:{x:0,y:0},N=P+h,I=L+v;!this.size||this.size[0]===N&&this.size[1]===I||(x.bindTexture(x.TEXTURE_2D,null),x.deleteTexture(this.texture),this.texture=x.createTexture(),this.size=null),x.bindTexture(x.TEXTURE_2D,this.texture),f.pixelStoreUnpackFlipY.set(!1),f.pixelStoreUnpack.set(1),f.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA8&&(!a||a.premultiply!==!1));const z=n instanceof HTMLImageElement||n instanceof HTMLCanvasElement||n instanceof HTMLVideoElement||n instanceof ImageData||ImageBitmap&&n instanceof ImageBitmap;if(!this.size&&N>0&&I>0){const F=this.useMipmap?Math.floor(Math.log2(Math.max(N,I)))+1:1;x.texStorage2D(x.TEXTURE_2D,F,this.format,N,I),this.size=[N,I]}if(this.size)if(z)x.texSubImage2D(x.TEXTURE_2D,0,P,L,Kw(this.format),Jw(this.format),n);else{const F=n.data;F&&x.texSubImage2D(x.TEXTURE_2D,0,P,L,h,v,Kw(this.format),Jw(this.format),F)}this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(n,a,h=!1){const{context:v}=this,{gl:f}=v;f.bindTexture(f.TEXTURE_2D,this.texture),n!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,n),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap&&!h?n===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_LINEAR:n),this.minFilter=n),a!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,a),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,a),this.wrapS=a)}bindExtraParam(n,a,h,v){const{context:f}=this,{gl:x}=f;x.bindTexture(x.TEXTURE_2D,this.texture),a!==this.magFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,a),this.magFilter=a),n!==this.minFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,this.useMipmap?n===x.NEAREST?x.NEAREST_MIPMAP_NEAREST:x.LINEAR_MIPMAP_LINEAR:n),this.minFilter=n),h!==this.wrapS&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,h),this.wrapS=h),v!==this.wrapT&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,v),this.wrapT=v)}destroy(){const{gl:n}=this.context;n.deleteTexture(this.texture),this.texture=null}}class b0{constructor(n,a){this.context=n,this.texture=a}bind(n,a){const{context:h}=this,{gl:v}=h;v.bindTexture(v.TEXTURE_2D,this.texture),n!==this.minFilter&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,n),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,n),this.minFilter=n),a!==this.wrapS&&(v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,a),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,a),this.wrapS=a)}}function w0(c,n,a,h,v,f,x,P){const L=[c,n,1,a,h,1,v,f,1],N=[x,P,1],I=ht.mat3.adjoint([],L),[z,F,R]=ht.vec3.transformMat3(N,N,I);return ht.mat3.multiply(L,L,[z,0,0,0,F,0,0,0,R])}function ZE(c,n,a,h,v,f,x,P){const L=function(N,I,z,F,R,O,q,te){const ae=w0(0,0,1,0,1,1,0,1),ge=w0(N,I,z,F,R,O,q,te),_e=ht.mat3.adjoint([],ae);return ht.mat3.multiply(ge,ge,_e)}(c,n,a,h,v,f,x,P);return[L[2]/L[8]/mi,L[5]/L[8]/mi]}function S0(c){return[c[0],Math.min(Math.max(c[1],-85.051129),xo)]}class WE extends Vs{constructor(n,a,h,v){super(),this.id=n,this.dispatcher=h,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(v),this.options=a,this._dirty=!1}load(n,a){if(this._loaded=a||!1,this.fire(new $a("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return n&&(this.coordinates=n),this._loaded=!0,void this._finishLoading();this._imageRequest=zc(this.map._requestManager.transformRequest(this.url,Fu.Image),(h,v)=>{this._imageRequest=null,this._loaded=!0,h?this.fire(new ss(h)):v&&(this.image=v instanceof HTMLImageElement?_i.getImageData(v):v,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,n&&(this.coordinates=n),this._finishLoading())})}loaded(){return this._loaded}updateImage(n){return n.url?(this._imageRequest&&n.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=n.url,this.load(n.coordinates,this._loaded),this):this}setTexture(n){if(!(n.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new b0(this.map.painter.context,n.handle),this.width=n.dimensions[0],this.height=n.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new $a("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(n){this.map=n,this.load()}onRemove(n){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof b0||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(n){if(this.coordinates=n,this._boundsArray=void 0,this._unsupportedCoords=!1,!n.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let a=n[0][1],h=n[0][1];for(const f of n)f[1]>h&&(h=f[1]),f[1]<a&&(a=f[1]);const v=(h+a)/2;if(v>xo?this.onNorthPole=!0:v<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const f=n.map(y.fromLngLat);this.tileID=function(x){let P=1/0,L=1/0,N=-1/0,I=-1/0;for(const q of x)P=Math.min(P,q.x),L=Math.min(L,q.y),N=Math.max(N,q.x),I=Math.max(I,q.y);const z=Math.max(N-P,I-L),F=Math.max(0,Math.floor(-Math.log(z)/Math.LN2)),R=Math.pow(2,F);let O=Math.floor((P+N)/2*R);return O>1&&(O-=1),new wn(F,O,Math.floor((L+I)/2*R))}(f),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new $a("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(n){for(const ae in this.tiles){const ge=this.tiles[ae];ge.state!=="loaded"&&(ge.state="loaded",ge.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const a=ix(new wn(0,0,0),this.map.transform.projection),h=[a.projection.project(this.coordinates[0][0],this.coordinates[0][1]),a.projection.project(this.coordinates[1][0],this.coordinates[1][1]),a.projection.project(this.coordinates[2][0],this.coordinates[2][1]),a.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(ae){const ge=ae[1].x-ae[0].x,_e=ae[1].y-ae[0].y,he=ae[2].x-ae[1].x,xe=ae[2].y-ae[1].y,Te=ae[3].x-ae[2].x,Ae=ae[3].y-ae[2].y,tt=ae[0].x-ae[3].x,Ke=ae[0].y-ae[3].y,Ye=ge*xe-he*_e,Ct=he*Ae-Te*xe,ct=Te*Ke-tt*Ae,It=tt*_e-ge*Ke;return Ye>0&&Ct>0&&ct>0&&It>0||Ye<0&&Ct<0&&ct<0&&It<0}(h))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const v=ix(this.tileID,this.map.transform.projection),[f,x,P,L]=this.coordinates.map(ae=>{const ge=v.projection.project(ae[0],ae[1]);return LE(v,ge)._round()});this.perspectiveTransform=ZE(f.x,f.y,x.x,x.y,P.x,P.y,L.x,L.y);const N=this._boundsArray=new Mn;N.emplaceBack(f.x,f.y,0,0),N.emplaceBack(x.x,x.y,mi,0),N.emplaceBack(L.x,L.y,0,mi),N.emplaceBack(P.x,P.y,mi,mi),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=n.createVertexBuffer(N,Yw.members),this.boundsSegments=Wa.simpleSegment(0,0,4,2);const I=[],z=[S0((F=this.coordinates)[0]),S0(F[1]),S0(F[2]),S0(F[3])];var F;const[R,O,q,te]=function(ae){let ge=ae[0][0],_e=ge,he=ae[0][1],xe=he;for(let Te=1;Te<ae.length;Te++)ae[Te][0]<ge?ge=ae[Te][0]:ae[Te][0]>_e&&(_e=ae[Te][0]),ae[Te][1]<he?he=ae[Te][1]:ae[Te][1]>xe&&(xe=ae[Te][1]);return[ge,he,_e-ge,xe-he]}(z);{const ae=new Mn,[ge,_e,he,xe]=function(Wt){let Kt=Wt[0].x,qt=Kt,yn=Wt[0].y,Yn=yn;for(let xn=1;xn<Wt.length;xn++)Wt[xn].x<Kt?Kt=Wt[xn].x:Wt[xn].x>qt&&(qt=Wt[xn].x),Wt[xn].y<yn?yn=Wt[xn].y:Wt[xn].y>Yn&&(Yn=Wt[xn].y);return[Kt,yn,qt-Kt,Yn-yn]}(h),Te=Wt=>[(Wt.x-ge)/he,(Wt.y-_e)/xe],[Ae,tt,Ke,Ye]=h.map(Te),Ct=function(Wt,Kt,qt,yn,Yn,xn,di,ci){const Ti=w0(0,0,1,0,1,1,0,1),In=w0(Wt,Kt,qt,yn,Yn,xn,di,ci),ji=ht.mat3.adjoint([],In);return ht.mat3.multiply(Ti,Ti,ji)}(Ae[0],Ae[1],tt[0],tt[1],Ke[0],Ke[1],Ye[0],Ye[1]);this.elevatedGlobePerspectiveTransform=ZE(Ae[0],Ae[1],tt[0],tt[1],Ke[0],Ke[1],Ye[0],Ye[1]);const ct=(Wt,Kt)=>{I.push(Wt.lng);const qt=Math.round((Wt.lng-R)/q*mi),yn=Math.round((Wt.lat-O)/te*mi),Yn=Te(Kt),xn=ht.vec3.transformMat3([],[Yn[0],Yn[1],1],Ct),di=Math.round(xn[0]/xn[2]*mi),ci=Math.round(xn[1]/xn[2]*mi);ae.emplaceBack(qt,yn,di,ci)},It=h[3].x-h[0].x,Rt=h[3].y-h[0].y,At=h[2].x-h[1].x,Vt=h[2].y-h[1].y;for(let Wt=0;Wt<65;Wt++){const Kt=Wt/64,qt=[h[0].x+Kt*It,h[0].y+Kt*Rt],yn=[h[1].x+Kt*At,h[1].y+Kt*Vt],Yn=yn[0]-qt[0],xn=yn[1]-qt[1];for(let di=0;di<65;di++){const ci=di/64,Ti={x:qt[0]+Yn*ci,y:qt[1]+xn*ci,z:0};ct(a.projection.unproject(Ti.x,Ti.y),Ti)}}this.elevatedGlobeVertexBuffer=n.createVertexBuffer(ae,Yw.members)}{this.maxLongitudeTriangleSize=0;let ae=[],ge=new Wr;const _e=(he,xe,Te)=>{ge.emplaceBack(he,xe,Te);const Ae=I[he],tt=I[xe],Ke=I[Te],Ye=Math.min(Math.min(Ae,tt),Ke),Ct=Math.max(Math.max(Ae,tt),Ke)-Ye;Ct>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ct),ae.push(Ye+Ct/2)};for(let he=0;he<64;he++)for(let xe=0;xe<64;xe++){const Te=65*he+xe,Ae=Te+1,tt=Te+65,Ke=tt+1;_e(Te,tt,Ae),_e(Ae,tt,Ke)}[ae,ge]=function(he,xe){const Te=Array.from({length:he.length},(Ke,Ye)=>Ye);Te.sort((Ke,Ye)=>he[Ke]-he[Ye]);const Ae=[],tt=new Wr;for(let Ke=0;Ke<Te.length;Ke++){const Ye=Te[Ke];Ae.push(he[Ye]);const Ct=3*Ye,ct=Ct+1;tt.emplaceBack(xe.uint16[Ct],xe.uint16[ct],xe.uint16[ct+1])}return[Ae,tt]}(ae,ge),this.elevatedGlobeTrianglesCenterLongitudes=ae,this.elevatedGlobeIndexBuffer=n.createIndexBuffer(ge)}this.elevatedGlobeSegments=Wa.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,q/mi,0,te/mi,0,0,O,R,0])}prepare(){const n=Object.keys(this.tiles).length!==0;if(this.tileID&&!n)return;const a=this.map.painter.context,h=a.gl;!this._dirty||this.texture instanceof b0||(this.texture?this.texture.update(this.image):(this.texture=new Qw(a,this.image,h.RGBA8),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this._dirty=!1),n&&this._prepareData(a)}loadTile(n,a){this.tileID&&this.tileID.equals(n.tileID.canonical)?(this.tiles[String(n.tileID.wrap)]=n,n.buckets={},a(null)):(n.state="errored",a(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(n){const a=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!a)return null;const h=this.elevatedGlobeTrianglesCenterLongitudes;let v=(f=n+180)+360*Math.round((h[0]-f)/360);var f;const x=new Wa,P=(z,F)=>{x.segments.push({vertexOffset:0,primitiveOffset:z,vertexLength:a.segments[0].vertexLength,primitiveLength:F,sortKey:void 0,vaos:{}})},L=.51*this.maxLongitudeTriangleSize;if(Math.abs(h[0]-v)<=L){const z=et(h,0,h.length,v+L);return z===h.length||P(z,Sn(h,z+1,h.length,v+360-L)-z),x}v<h[0]&&(v+=360);const N=Sn(h,0,h.length,v-L);if(N===h.length)return P(0,h.length),x;P(0,N-0);const I=et(h,N+1,h.length,v+L);return I!==h.length&&P(I,h.length-I),x}}const OO=(Math.pow(256,2)-1)/16907520;class XE extends Et{constructor(n,a,h,v){super(n,{layout:qE||(qE=new _a({visibility:new Xn(tn.layout_raster.visibility)})),paint:HE||(HE=new _a({"raster-opacity":new Xn(tn.paint_raster["raster-opacity"]),"raster-color":new bc(tn.paint_raster["raster-color"]),"raster-color-mix":new Xn(tn.paint_raster["raster-color-mix"]),"raster-color-range":new Xn(tn.paint_raster["raster-color-range"]),"raster-hue-rotate":new Xn(tn.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Xn(tn.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Xn(tn.paint_raster["raster-brightness-max"]),"raster-saturation":new Xn(tn.paint_raster["raster-saturation"]),"raster-contrast":new Xn(tn.paint_raster["raster-contrast"]),"raster-resampling":new Xn(tn.paint_raster["raster-resampling"]),"raster-fade-duration":new Xn(tn.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Xn(tn.paint_raster["raster-emissive-strength"]),"raster-array-band":new Xn(tn.paint_raster["raster-array-band"]),"raster-elevation":new Xn(tn.paint_raster["raster-elevation"]),"raster-color-use-theme":new Ei({type:"string",default:"default","property-type":"data-driven"})}))},a,h,v),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(n){return!(n&&n._source instanceof WE&&(n._source.onNorthPole||n._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(n){n!=="raster-color"&&n!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(n){if(!this.hasColorMap()||!this._curRampRange)return;const a=this._transitionablePaint._values["raster-color"].value.expression,[h,v]=n||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(h)&&isNaN(v)||h===this._curRampRange[0]&&v===this._curRampRange[1]||(this.colorRamp=Jg({expression:a,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:h,end:v}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[h,v])}}let YE,KE,JE,QE,eM;class tM extends Et{constructor(n,a,h,v){super(n,{layout:YE||(YE=new _a({visibility:new Xn(tn["layout_raster-particle"].visibility)})),paint:KE||(KE=new _a({"raster-particle-array-band":new Xn(tn["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Xn(tn["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new bc(tn["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Xn(tn["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Xn(tn["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Xn(tn["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Xn(tn["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Xn(tn["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Ei({type:"string",default:"default","property-type":"data-driven"})}))},a,h,v),this._updateColorRamp(),this.lastInvalidatedAt=_i.now()}onRemove(n){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(n){return!1}_handleSpecialPaintPropertyUpdate(n){n!=="raster-particle-color"&&n!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),n==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const n=this._transitionablePaint._values["raster-particle-color"].value.expression,a=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Jg({expression:n,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:a}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=_i.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class FO extends Et{constructor(n,a){super(n,{},a,null),this.implementation=n,n.slot&&(this.slot=n.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(n){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(n){this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)}onRemove(n){this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)}}function eS(c,n,a){const h=[0,0,1],v=ht.quat.identity([]);return ht.quat.rotateY(v,v,a?-zn(c)+Math.PI:zn(c)),ht.quat.rotateX(v,v,-zn(n)),ht.vec3.transformQuat(h,h,v),ht.vec3.normalize(h,h)}function nM(c,n){const a=T0(c.projection,c.zoom,c.width,c.height),h=function(f,x,P,L,N){const I=new Kr(P.lng-180*fg,P.lat),z=new Kr(P.lng+180*fg,P.lat),F=f.project(I.lng,I.lat),R=f.project(z.lng,z.lat),O=-Math.atan2(R.y-F.y,R.x-F.x),q=y.fromLngLat(P);q.y=ui(q.y,-1+fg,1-fg);const te=q.toLngLat(),ae=f.project(te.lng,te.lat),ge=y.fromLngLat(te);ge.x+=fg;const _e=ge.toLngLat(),he=f.project(_e.lng,_e.lat),xe=rM(he.x-ae.x,he.y-ae.y,O),Te=y.fromLngLat(te);Te.y+=fg;const Ae=Te.toLngLat(),tt=f.project(Ae.lng,Ae.lat),Ke=rM(tt.x-ae.x,tt.y-ae.y,O),Ye=Math.abs(xe.x)/Math.abs(Ke.y),Ct=ht.mat4.identity([]);ht.mat4.rotateZ(Ct,Ct,-O*(1-(N?0:L)));const ct=ht.mat4.identity([]);return ht.mat4.scale(ct,ct,[1,1-(1-Ye)*L,1]),ct[4]=-Ke.x/Ke.y*L,ht.mat4.rotateZ(ct,ct,O),ht.mat4.multiply(ct,Ct,ct),ct}(c.projection,0,c.center,a,n),v=iM(c);return ht.mat4.scale(h,h,[v,v,1]),h}function iM(c){const n=c.projection,a=T0(c.projection,c.zoom,c.width,c.height),h=tS(n,c.center),v=tS(n,Kr.convert(n.center));return Math.pow(2,h*a+(1-a)*v)}function T0(c,n,a,h,v=1/0){const f=c.range;if(!f)return 0;const x=Math.min(v,Math.max(a,h)),P=Math.log(x/1024)/Math.LN2;return pr(f[0]+P,f[1]+P,n)}const fg=1/4e4;function tS(c,n){const a=ui(n.lat,-85.051129,xo),h=new Kr(n.lng-180*fg,a),v=new Kr(n.lng+180*fg,a),f=c.project(h.lng,a),x=c.project(v.lng,a),P=y.fromLngLat(h),L=y.fromLngLat(v),N=x.x-f.x,I=x.y-f.y,z=L.x-P.x,F=L.y-P.y,R=Math.sqrt((z*z+F*F)/(N*N+I*I));return Math.log(R)/Math.LN2}function rM(c,n,a){const h=Math.cos(a),v=Math.sin(a);return{x:c*h-n*v,y:c*v+n*h}}function aM(c,n,a){ht.mat4.identity(c),ht.mat4.rotateZ(c,c,zn(n[2])),ht.mat4.rotateX(c,c,zn(n[0])),ht.mat4.rotateY(c,c,zn(n[1])),ht.mat4.scale(c,c,a),ht.mat4.multiply(c,c,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function C0(c,n,a,h,v,f,x,P){const L=[a[0]-n[0],a[1]-n[1],0],N=[h[0]-n[0],h[1]-n[1],0];if(ht.vec3.length(L)<1e-12||ht.vec3.length(N)<1e-12)return ht.quat.identity(c);const I=ht.vec3.cross([],L,N);ht.vec3.normalize(I,I),ht.vec3.subtract(N,h,n),L[2]=(f-v)*P,N[2]=(x-v)*P;const z=L;return ht.vec3.cross(z,L,N),ht.vec3.normalize(z,z),ht.quat.rotationTo(c,I,z)}function nS(c,n,a=!1){const h=Ho(n.zoom),v=function(f,x,P){const L=x.worldSize,N=[f[12],f[13],f[14]],I=Ws(N[1]/L),z=Nl(N[0]/L),F=ht.mat4.identity([]),R=ao(1,I)*L,O=ao(1,0)*L*_(I,x.zoom),q=1/Tc(L);let te=O*q;if(P){const he=T0(x.projection,x.zoom,x.width,x.height,1024);te=q*x.projection.pixelSpaceConversion(x.center.lat,L,he)}const ae=Pd(I,z);ht.vec3.add(ae,ae,ht.vec3.scale([],ht.vec3.normalize([],ae),R*te*N[2]));const ge=function(he){const xe=[he[0],he[1],he[2]];let Te=[0,1,0];const Ae=ht.vec3.cross([],Te,xe);return ht.vec3.cross(Te,xe,Ae),ht.vec3.squaredLength(Te)===0&&(Te=[0,1,0],ht.vec3.cross(Ae,xe,Te)),ht.vec3.normalize(Ae,Ae),ht.vec3.normalize(Te,Te),ht.vec3.normalize(xe,xe),[Ae[0],Ae[1],Ae[2],0,Te[0],Te[1],Te[2],0,xe[0],xe[1],xe[2],0,he[0],he[1],he[2],1]}(ae);ht.mat4.scale(F,F,[te,te,te*R]),ht.mat4.translate(F,F,[-N[0],-N[1],-N[2]]);const _e=ht.mat4.multiply([],x.globeMatrix,ge);return ht.mat4.multiply(_e,_e,F),ht.mat4.multiply(_e,_e,f),_e}(c,n,a);if(h>0){const f=function(x,P){const L=P.worldSize,N=ao(1,0)*L*_(P.center.lat,P.zoom)/Tc(L),I=ao(1,P.center.lat)*L,z=ht.mat4.identity([]);return ht.mat4.rotateY(z,z,zn(P.center.lng)),ht.mat4.rotateX(z,z,zn(P.center.lat)),ht.mat4.translate(z,z,[0,0,yl]),ht.mat4.scale(z,z,[N,N,N*I]),ht.mat4.translate(z,z,[P.point.x-.5*L,P.point.y-.5*L,0]),ht.mat4.multiply(z,z,x),ht.mat4.multiply(z,P.globeMatrix,z)}(c,n);return function(x,P,L){const N=(O,q,te)=>{const ae=ht.vec3.length(O),ge=ht.vec3.length(q),_e=wo(O,q,te);return ht.vec3.scale(_e,_e,1/ht.vec3.length(_e)*ir(ae,ge,te))},I=N([x[0],x[1],x[2]],[P[0],P[1],P[2]],L),z=N([x[4],x[5],x[6]],[P[4],P[5],P[6]],L),F=N([x[8],x[9],x[10]],[P[8],P[9],P[10]],L),R=wo([x[12],x[13],x[14]],[P[12],P[13],P[14]],L);return[I[0],I[1],I[2],0,z[0],z[1],z[2],0,F[0],F[1],F[2],0,R[0],R[1],R[2],1]}(v,f,h)}return v}function sM(c,n,a,h){const v=nr.projectAabbCorners(h,a);let f=Number.MAX_VALUE,x=-1;for(let N=0;N<v.length;++N){const I=v[N];I[0]=(.5*I[0]+.5)*n.width,I[1]=(.5-.5*I[1])*n.height,I[2]<f&&(x=N,f=I[2])}const P=N=>new at(v[N][0],v[N][1]);let L;switch(x){case 0:case 6:L=[P(1),P(5),P(4),P(7),P(3),P(2),P(1)];break;case 1:case 7:L=[P(0),P(4),P(5),P(6),P(2),P(3),P(0)];break;case 3:case 5:L=[P(1),P(0),P(4),P(7),P(6),P(2),P(1)];break;default:L=[P(1),P(5),P(6),P(7),P(3),P(0),P(1)]}if(ke(c,L))return f}const BO=Bt([{name:"a_pos_3f",components:3,type:"Float32"}]),VO=Bt([{name:"a_color_3f",components:3,type:"Float32"}]),NO=Bt([{name:"a_color_4f",components:4,type:"Float32"}]),jO=Bt([{name:"a_uv_2f",components:2,type:"Float32"}]),UO=Bt([{name:"a_normal_3f",components:3,type:"Float32"}]),$O=Bt([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),GO=Bt([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),oM={None:0,Model:1,Symbol:2,FillExtrusion:4,All:7};class E0{constructor(n,a,h,v){this.message=(n?`${n}: `:"")+h,v&&(this.identifier=v),a!=null&&a.__line__&&(this.line=a.__line__)}}function lM(c,n){const a=c.indexOf("://")===-1;try{return new URL(c,a&&n?"http://example.com":void 0),!0}catch{return!1}}class cM{constructor(n,a){this.feature=n,this.instancedDataOffset=a,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class uM{constructor(){this.instancedDataArray=new ah,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class iS{constructor(n){this.zoom=n.zoom,this.canonical=n.canonical,this.layers=n.layers,this.layerIds=this.layers.map(a=>a.fqid),this.projection=n.projection,this.index=n.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0}updateFootprints(n,a){}populate(n,a,h,v){this.tileToMeter=l(h);const f=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:x,id:P,index:L,sourceLayerIndex:N}of n){const I=P??(x.properties&&x.properties.hasOwnProperty("id")?x.properties.id:void 0),z=le(x,f);if(!this.layers[0]._featureFilter.filter(new ba(this.zoom),z,h))continue;const F={id:I,sourceLayerIndex:N,index:L,geometry:f?z.geometry:se(x,h,v),properties:x.properties,type:x.type,patterns:{}},R=this.addFeature(F,F.geometry,z);R&&a.featureIndex.insert(x,F.geometry,L,N,this.index,this.instancesPerModel[R].instancedDataArray.length,mi/32)}this.lookup=null}update(n,a,h,v){for(const f in this.instancesPerModel){const x=this.instancesPerModel[f];for(const P in n)x.idToFeaturesIndex.hasOwnProperty(P)&&(this.evaluate(x.features[x.idToFeaturesIndex[P]],n[P],x,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let n=!1;for(const a in this.instancesPerModel){const h=this.instancesPerModel[a];for(const v of h.features){const f=this.layers[0],x=v.feature,P=this.canonical,L=f.paint.get("model-rotation").evaluate(x,{},P),N=f.paint.get("model-scale").evaluate(x,{},P),I=f.paint.get("model-translation").evaluate(x,{},P);ht.vec3.exactEquals(v.rotation,L)&&ht.vec3.exactEquals(v.scale,N)&&ht.vec3.exactEquals(v.translation,I)||(this.evaluate(v,v.featureStates,h,!0),n=!0)}}return n}updateReplacement(n,a,h,v){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const f=a.getReplacementRegionsForTile(n.toUnwrapped(),!0);if(ng(this.activeReplacements,f))return!1;this.activeReplacements=f;let x=!1;for(const P in this.instancesPerModel){const L=this.instancesPerModel[P],N=L.instancedDataArray;for(const I of L.features){const z=I.instancedDataOffset,F=I.instancedDataCount;for(let R=0;R<F;R++){const O=16*(R+z);let q=N.float32[O+0];const te=q>mi;q=te?q-mi:q;const ae=Math.floor(q),ge=N.float32[O+1];let _e=!1;for(const he of this.activeReplacements)if(!tg(he,h,oM.Model,v)&&!(he.min.x>ae||ae>he.max.x||he.min.y>ge||ge>he.max.y)&&(_e=mm(Wb(ae,ge,n.canonical,he.footprintTileId.canonical),he.footprint),_e))break;N.float32[O]=_e?q+mi:q,x=x||_e!==te}}}return x}isEmpty(){for(const n in this.instancesPerModel)if(this.instancesPerModel[n].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(n){if(!this.uploaded)for(const a in this.instancesPerModel){const h=this.instancesPerModel[a];h.instancedDataArray.length<0||h.instancedDataArray.length===0||(h.instancedDataBuffer?h.instancedDataBuffer.updateData(h.instancedDataArray):h.instancedDataBuffer=n.createVertexBuffer(h.instancedDataArray,$O.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const a in this.instancesPerModel){const h=this.instancesPerModel[a];h.instancedDataArray.length!==0&&h.instancedDataBuffer&&h.instancedDataBuffer.destroy()}const n=this.layers[0].modelManager;if(n&&this.modelUris)for(const a of this.modelUris)n.removeModel(a,"")}addFeature(n,a,h){const v=this.layers[0],f=v.layout.get("model-id").evaluate(h,{},this.canonical);if(!f)return it(`modelId is not evaluated for layer ${v.id} and it is not going to get rendered.`),f;lM(f,!1)&&(this.modelUris.includes(f)||this.modelUris.push(f)),this.instancesPerModel[f]||(this.instancesPerModel[f]=new uM);const x=this.instancesPerModel[f],P=x.instancedDataArray,L=new cM(h,P.length);for(const N of a)for(const I of N){if(I.x<0||I.x>=mi||I.y<0||I.y>=mi)continue;const z=(this.lookupDim-1)/mi,F=this.lookupDim*(I.y*z|0)+I.x*z|0;if(this.lookup){if(this.lookup[F]!==0)continue;this.lookup[F]=1}this.instanceCount++;const R=P.length;P.resize(R+1),x.instancesEvaluatedElevation.push(0),P.float32[16*R]=I.x,P.float32[16*R+1]=I.y}return L.instancedDataCount=x.instancedDataArray.length-L.instancedDataOffset,L.instancedDataCount>0&&(n.id&&(x.idToFeaturesIndex[n.id]=x.features.length),x.features.push(L),this.evaluate(L,{},x,!1)),f}getModelUris(){return this.modelUris}evaluate(n,a,h,v){const f=this.layers[0],x=n.feature,P=this.canonical,L=n.rotation=f.paint.get("model-rotation").evaluate(x,a,P),N=n.scale=f.paint.get("model-scale").evaluate(x,a,P),I=n.translation=f.paint.get("model-translation").evaluate(x,a,P),z=f.paint.get("model-color").evaluate(x,a,P);z.a=f.paint.get("model-color-mix-intensity").evaluate(x,a,P);const F=[];this.maxVerticalOffset<I[2]&&(this.maxVerticalOffset=I[2]),this.maxScale=Math.max(Math.max(this.maxScale,N[0]),Math.max(N[1],N[2])),aM(F,L,N);const R=Math.round(100*z.a)+z.b/1.05;for(let O=0;O<n.instancedDataCount;++O){const q=n.instancedDataOffset+O,te=16*q,ae=h.instancedDataArray.float32;let ge=0;v&&(ge=ae[te+6]-h.instancesEvaluatedElevation[q]);const _e=0|ae[te+1];ae[te]=(0|ae[te])+z.r/1.05,ae[te+1]=_e+z.g/1.05,ae[te+2]=R,ae[te+3]=1/(P.z>10?this.tileToMeter:l(P,_e)),ae[te+4]=I[0],ae[te+5]=I[1],ae[te+6]=I[2]+ge,ae[te+7]=F[0],ae[te+8]=F[1],ae[te+9]=F[2],ae[te+10]=F[4],ae[te+11]=F[5],ae[te+12]=F[6],ae[te+13]=F[8],ae[te+14]=F[9],ae[te+15]=F[10],h.instancesEvaluatedElevation[q]=I[2]}}}let hM,dM;ki(iS,"ModelBucket",{omit:["layers"]}),ki(uM,"PerModelAttributes"),ki(cM,"ModelFeature");const m_=64,Py={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function fM(c,n,a,h,v,f,x,P,L,N=!1){const I=a.zoom,z=a.project(h),F=_(h.lat,I),R=1/F;ht.mat4.identity(c),ht.mat4.translate(c,c,[z.x+x[0]*R,z.y+x[1]*R,x[2]]);let O=1,q=1;const te=a.worldSize;if(N){if(a.projection.name==="mercator"){let he=0;a.elevation&&(he=a.elevation.getAtPointOrZero(new y(z.x/te,z.y/te),0));const xe=ht.vec4.transformMat4([],[z.x,z.y,he,1],a.projMatrix)[3]/a.cameraToCenterDistance;O=xe,q=xe*_(a.center.lat,I)}else if(a.projection.name==="globe"){const he=nS(c,a),xe=ht.mat4.multiply([],a.projMatrix,he),Te=[0,0,0,1];ht.vec4.transformMat4(Te,Te,xe);const Ae=Te[3]/a.cameraToCenterDistance,tt=Ho(I),Ke=a.projection.pixelsPerMeter(h.lat,te)*_(h.lat,I),Ye=a.projection.pixelsPerMeter(a.center.lat,te)*_(a.center.lat,I);O=Ae/ir(Ke,ly(a.center.lat),tt),q=Ae*F/Ke,O*=Ye,q*=Ye}}else O=R;ht.mat4.scale(c,c,[O,O,q]);const ae=[...c],ge=n.orientation,_e=[];if(aM(_e,[ge[0]+v[0],ge[1]+v[1],ge[2]+v[2]],f),ht.mat4.multiply(c,ae,_e),P&&a.elevation){let he=0;const xe=[];if(L&&a.elevation){he=function(tt,Ke,Ye,Ct,ct){const It=Ke.elevation;if(!It)return 0;const Rt=nr.projectAabbCorners(Ye,Ct),At=ao(1,ct.lat)*Ke.worldSize,Vt=function(ji,gi){const Oi=[0,0,1],rr=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const wr of rr){const Ir=ji[wr.corners[0]],Fr=ji[wr.corners[1]],Pr=ji[wr.corners[2]],qr=[Fr[0]-Ir[0],Fr[1]-Ir[1],gi*(Fr[2]-Ir[2])],Aa=ht.vec3.cross(qr,qr,[Pr[0]-Ir[0],Pr[1]-Ir[1],gi*(Pr[2]-Ir[2])]);ht.vec3.normalize(Aa,Aa),wr.dotProductWithUp=ht.vec3.dot(Aa,Oi)}return rr.sort((wr,Ir)=>wr.dotProductWithUp-Ir.dotProductWithUp),rr[0].corners}(Rt,At),Wt=Rt[Vt[0]],Kt=Rt[Vt[1]],qt=Rt[Vt[2]],yn=Rt[Vt[3]],Yn=It.getAtPointOrZero(new y(Wt[0]/Ke.worldSize,Wt[1]/Ke.worldSize),0),xn=It.getAtPointOrZero(new y(Kt[0]/Ke.worldSize,Kt[1]/Ke.worldSize),0),di=It.getAtPointOrZero(new y(qt[0]/Ke.worldSize,qt[1]/Ke.worldSize),0),ci=It.getAtPointOrZero(new y(yn[0]/Ke.worldSize,yn[1]/Ke.worldSize),0),Ti=(Yn+ci)/2,In=(xn+di)/2;return Ti>In?xn<di?C0(tt,Kt,yn,Wt,xn,ci,Yn,At):C0(tt,qt,Wt,yn,di,Yn,ci,At):Yn<ci?C0(tt,Wt,Kt,qt,Yn,xn,di,At):C0(tt,yn,qt,Kt,ci,di,xn,At),Math.max(Ti,In)}(xe,a,n.aabb,c,h);const Te=ht.mat4.fromQuat([],xe),Ae=ht.mat4.multiply([],Te,_e);ht.mat4.multiply(c,ae,Ae)}else he=a.elevation.getAtPointOrZero(new y(z.x/te,z.y/te),0);he!==0&&(c[14]+=he)}}function lx(c,n,a=!1){c.uploaded||(c.gfxTexture=new Qw(n,c.image,a?n.gl.R8:n.gl.RGBA8,{useMipmap:c.sampler.minFilter>=n.gl.NEAREST_MIPMAP_NEAREST}),c.uploaded=!0,c.image=null)}function qO(c,n,a){c.indexBuffer=n.createIndexBuffer(c.indexArray,!1,!0),c.vertexBuffer=n.createVertexBuffer(c.vertexArray,BO.members,!1,!0),c.normalArray&&(c.normalBuffer=n.createVertexBuffer(c.normalArray,UO.members,!1,!0)),c.texcoordArray&&(c.texcoordBuffer=n.createVertexBuffer(c.texcoordArray,jO.members,!1,!0)),c.colorArray&&(c.colorBuffer=n.createVertexBuffer(c.colorArray,(c.colorArray.bytesPerElement===12?VO:NO).members,!1,!0)),c.featureArray&&(c.pbrBuffer=n.createVertexBuffer(c.featureArray,GO.members,!0)),c.segments=Wa.simpleSegment(0,0,c.vertexArray.length,c.indexArray.length);const h=c.material;h.pbrMetallicRoughness.baseColorTexture&&lx(h.pbrMetallicRoughness.baseColorTexture,n),h.pbrMetallicRoughness.metallicRoughnessTexture&&lx(h.pbrMetallicRoughness.metallicRoughnessTexture,n),h.normalTexture&&lx(h.normalTexture,n),h.occlusionTexture&&lx(h.occlusionTexture,n,a),h.emissionTexture&&lx(h.emissionTexture,n)}function rS(c,n,a){if(c.meshes)for(const h of c.meshes)qO(h,n,a);if(c.children)for(const h of c.children)rS(h,n,a)}function M0(c){if(c.meshes)for(const n of c.meshes)n.indexArray.destroy(),n.vertexArray.destroy(),n.colorArray&&n.colorArray.destroy(),n.normalArray&&n.normalArray.destroy(),n.texcoordArray&&n.texcoordArray.destroy(),n.featureArray&&n.featureArray.destroy();if(c.children)for(const n of c.children)M0(n)}function aS(c){if(c.meshes)for(const a of c.meshes)a.vertexBuffer&&(a.vertexBuffer.destroy(),a.indexBuffer.destroy(),a.normalBuffer&&a.normalBuffer.destroy(),a.texcoordBuffer&&a.texcoordBuffer.destroy(),a.colorBuffer&&a.colorBuffer.destroy(),a.pbrBuffer&&a.pbrBuffer.destroy(),a.segments.destroy(),a.material&&((n=a.material).pbrMetallicRoughness.baseColorTexture&&n.pbrMetallicRoughness.baseColorTexture.gfxTexture&&n.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),n.pbrMetallicRoughness.metallicRoughnessTexture&&n.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&n.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),n.normalTexture&&n.normalTexture.gfxTexture&&n.normalTexture.gfxTexture.destroy(),n.emissionTexture&&n.emissionTexture.gfxTexture&&n.emissionTexture.gfxTexture.destroy(),n.occlusionTexture&&n.occlusionTexture.gfxTexture&&n.occlusionTexture.gfxTexture.destroy()));var n;if(c.children)for(const a of c.children)aS(a)}class Ay{constructor(n,a,h){this._demTile=n,this._dem=this._demTile.dem,this._scale=a,this._offset=h}static create(n,a,h){const v=h||n.findDEMTileFor(a);if(!v||!v.dem)return;const f=v.dem,x=v.tileID,P=1<<a.canonical.z-x.canonical.z;return new Ay(v,f.dim/mi/P,[(a.canonical.x/P-x.canonical.x)*f.dim,(a.canonical.y/P-x.canonical.y)*f.dim])}tileCoordToPixel(n,a){const h=a*this._scale+this._offset[1],v=Math.floor(n*this._scale+this._offset[0]),f=Math.floor(h);return new at(v,f)}getElevationAt(n,a,h,v){const f=n*this._scale+this._offset[0],x=a*this._scale+this._offset[1],P=Math.floor(f),L=Math.floor(x),N=this._dem;return v=!!v,h?ir(ir(N.get(P,L,v),N.get(P,L+1,v),x-L),ir(N.get(P+1,L,v),N.get(P+1,L+1,v),x-L),f-P):N.get(P,L,v)}getElevationAtPixel(n,a,h){return this._dem.get(n,a,!!h)}getMeterToDEM(n){return(1<<this._demTile.tileID.canonical.z)*ao(1,n)*this._dem.stride}}const sS=new Float32Array(262144),g_=new Uint8Array(262144);function pM(c){let n=0;if(c.meshes)for(const a of c.meshes)n=Math.max(n,a.aabb.max[2]);if(c.children)for(const a of c.children)n=Math.max(n,pM(a));return n}function mM(c,n,a){if(c.meshes)for(const h of c.meshes){if(h.aabb.min[0]===1/0)continue;const v=nr.applyTransform(h.aabb,c.matrix);a.insert(n,v.min[0],v.min[1],v.max[0],v.max[1])}if(c.children)for(const h of c.children)mM(h,n,a)}const gM=["","wall","door","roof","window","lamp","logo"];class _M{constructor(n){this.node=n,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:n.id,geometry:[],properties:{height:pM(n)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new nr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let n=0;const a=new nr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const h of this.node.meshes)this.node.lightMeshIndex!==n&&(h.transformedAabb=nr.applyTransformFast(h.aabb,this.node.matrix),a.encapsulate(h.transformedAabb)),n++;this.aabb=a}return this.aabb}}class I0{constructor(n,a,h,v,f,x,P){this.id=h,this.layers=n,this.layerIds=this.layers.map(L=>L.fqid),this.stateDependentLayerIds=this.layers.filter(L=>L.isStateDependent()).map(L=>L.id),this.modelTraits|=Py.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,v&&(this.modelTraits|=Py.HasMapboxMeshFeatures),f&&(this.modelTraits|=Py.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=x,this.dirty=!0,this.needsUpload=!1,this.nodesInfo=[];for(const L of a)this.nodesInfo.push(new _M(L)),mM(L,P.featureIndexArray.length,P.grid),P.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,P.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(n,a){for(const h of this.getNodesInfo()){const v=h.node;v.footprint&&a.push({footprint:v.footprint,id:n})}}update(n){const a=Object.keys(n).length!==0;if(a&&!this.stateDependentLayers.length)return;const h=a?this.stateDependentLayers:this.layers;if(!Tn(n,this.states))for(const v of h)this.evaluate(v,n);this.states=structuredClone(n)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(n){if(!this.needsUpload)return;const a=this.getNodesInfo();for(const h of a){const v=h.node;this.uploaded?this.updatePbrBuffer(v):rS(v,n,!0)}for(const h of a)M0(h.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(n){let a=!1;if(!n.meshes)return a;for(const h of n.meshes)h.pbrBuffer&&(h.pbrBuffer.updateData(h.featureArray),a=!0);return a}needsReEvaluation(n,a,h){const v=n.transform.projectionOptions,f=n.style.getBrightness(),x=this.brightness!==f;if(!this.uploaded||this.dirty||v.name!==this.projection.name||cx(h.paint.get("model-color").value,x)||cx(h.paint.get("model-color-mix-intensity").value,x)||cx(h.paint.get("model-roughness").value,x)||cx(h.paint.get("model-emissive-strength").value,x)||cx(h.paint.get("model-height-based-emissive-strength-multiplier").value,x)){this.projection=v,this.brightness=f;const P=this.getNodesInfo();for(const L of P)L.state=null;return!0}return!1}evaluateScale(n,a){if(n.transform.zoom===this.zoom)return;this.zoom=n.transform.zoom;const h=this.getNodesInfo(),v=this.id.canonical;for(const f of h){const x=f.feature;f.evaluatedScale=a.paint.get("model-scale").evaluate(x,{},v)}}evaluate(n,a){const h=this.getNodesInfo();for(const v of h){if(!v.node.meshes)continue;const f=v.feature,x=a&&a[f.id];if(Tn(x,v.state))continue;v.state=structuredClone(x);const P=v.node.meshes&&v.node.meshes[0].featureData,L=v.evaluatedColor[2],N=v.evaluatedRMEA[2],I=this.id.canonical;if(v.hasTranslucentParts=!1,P){for(let z=0;z<gM.length;z++){const F=gM[z];F.length&&(f.properties.part=F);const R=n.paint.get("model-color").evaluate(f,x,I).toRenderColor(null),O=n.paint.get("model-color-mix-intensity").evaluate(f,x,I);v.evaluatedColor[z]=[R.r,R.g,R.b,O],v.evaluatedRMEA[z][0]=n.paint.get("model-roughness").evaluate(f,x,I),v.evaluatedRMEA[z][2]=n.paint.get("model-emissive-strength").evaluate(f,x,I),v.evaluatedRMEA[z][3]=R.a,v.emissionHeightBasedParams[z]=n.paint.get("model-height-based-emissive-strength-multiplier").evaluate(f,x,I),!v.hasTranslucentParts&&R.a<1&&(v.hasTranslucentParts=!0)}delete f.properties.part,ZO(v,L!==v.evaluatedColor[2]||N!==v.evaluatedRMEA[2],this.modelTraits)}else v.evaluatedRMEA[0][2]=n.paint.get("model-emissive-strength").evaluate(f,x,I);v.evaluatedScale=n.paint.get("model-scale").evaluate(f,x,I),this.updatePbrBuffer(v.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(n,a,h,v){const f=n.findDEMTileFor(h);if(f&&(f.tileID.canonical!==this.terrainTile||a!==this.terrainExaggeration)){if(f.dem&&f.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=f.tileID.overscaledZ;const x=Ay.create(n,h,f);if(!x)return;this.modelTraits&Py.HasMapboxMeshFeatures&&this.updateDEM(n,x,h,v);for(const P of this.getNodesInfo()){const L=P.node;if(!L.footprint||!L.footprint.vertices||!L.footprint.vertices.length)continue;const N=L.footprint.vertices;let I=x.getElevationAt(N[0].x,N[0].y,!0,!0);for(let z=1;z<N.length;z++)I=Math.min(I,x.getElevationAt(N[z].x,N[z].y,!0,!0));L.elevation=I}}this.terrainTile=f.tileID.canonical,this.terrainExaggeration=a}}updateDEM(n,a,h,v){let f=a._dem._modifiedForSources[v];if(f===void 0&&(a._dem._modifiedForSources[v]=[],f=a._dem._modifiedForSources[v]),f.includes(h.canonical))return;const x=a._dem.dim;f.push(h.canonical);let P=!1;for(const L of this.getNodesInfo()){const N=L.node;if(!N.footprint||!N.footprint.grid)continue;const I=N.footprint.grid,z=a.tileCoordToPixel(I.min.x,I.min.y),F=a.tileCoordToPixel(I.max.x,I.max.y),R=Math.min(Math.min(x-F.y,z.x),Math.min(z.y,x-F.x));if(R<0)continue;const O=ui(R,2,5);let q=Math.max(0,z.x-O),te=Math.max(0,z.y-O),ae=Math.min(F.x+O,x-1),ge=Math.min(F.y+O,x-1);for(let Te=te;Te<=ge;++Te)for(let Ae=q;Ae<=ae;++Ae)g_[Te*x+Ae]=255;let _e=0,he=0;for(let Te=0;Te<I.cellsY;++Te)for(let Ae=0;Ae<I.cellsX;++Ae){if(!I.cells[Te*I.cellsX+Ae])continue;const tt=a.tileCoordToPixel(I.min.x+Ae/I.xScale,I.min.y+Te/I.yScale),Ke=a.tileCoordToPixel(I.min.x+(Ae+1)/I.xScale,I.min.y+(Te+1)/I.yScale);for(let Ye=tt.y;Ye<=Math.min(Ke.y+1,x-1);++Ye)for(let Ct=tt.x;Ct<=Math.min(Ke.x+1,x-1);++Ct)g_[Ye*x+Ct]===255&&(g_[Ye*x+Ct]=0,_e+=a.getElevationAtPixel(Ct,Ye),he++)}const xe=_e/he;q=Math.max(1,z.x-O),te=Math.max(1,z.y-O),ae=Math.min(F.x+O,x-2),ge=Math.min(F.y+O,x-2),P=!0;for(let Te=te;Te<=ge;++Te)for(let Ae=q;Ae<=ae;++Ae)g_[Te*x+Ae]===0&&(sS[Te*x+Ae]=a._dem.set(Ae,Te,xe));for(let Te=1;Te<O;++Te){q=Math.max(1,z.x-Te),te=Math.max(1,z.y-Te),ae=Math.min(F.x+Te,x-2),ge=Math.min(F.y+Te,x-2);for(let Ae=te;Ae<=ge;++Ae)for(let tt=q;tt<=ae;++tt){const Ke=Ae*x+tt;if(g_[Ke]===255){let Ye=0,Ct=0,ct=-1,It=-1;for(let Rt=-1;Rt<=1;++Rt)for(let At=-1;At<=1;++At){const Vt=(Ae+Rt)*x+tt+At;if(g_[Vt]>=Te)continue;const Wt=sS[Vt],Kt=Math.abs(Wt);Kt>Ct&&(Ye=Wt,Ct=Kt,ct=At,It=Rt)}if(Ct>.1){const Rt=1-(Te+.5*Math.abs(ct*It))/O;let At=a._dem.get(tt,Ae)+Ye*Rt;const Vt=a._dem.get(tt+ct,Ae+It),Wt=a._dem.get(tt-ct,Ae-It,!0);(At-Vt)*(At-Wt)>0&&(At=(Vt+Wt)/2),sS[Ke]=a._dem.set(tt,Ae,At),g_[Ke]=Te}}}}}P&&(a._demTile.needsDEMTextureUpload=!0,a._dem._timestamp=_i.now())}getNodesInfo(){return this.nodesInfo}destroy(){const n=this.getNodesInfo();for(const a of n)M0(a.node),aS(a.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(n,a){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const h=a.getReplacementRegionsForTile(n.toUnwrapped()),v=this.getNodesInfo();for(let f=0;f<this.nodesInfo.length;f++){const x=v[f].node;v[f].hiddenByReplacement=!!x.footprint&&!h.find(P=>P.footprint===x.footprint)}}getHeightAtTileCoord(n,a){const h=this.getNodesInfo(),v=[],f=[0,0,0],x=ht.mat4.identity([]);for(let P=0;P<this.nodesInfo.length;P++){const L=h[P],N=L.node.meshes[0],I=N.transformedAabb;if(n<I.min[0]||a<I.min[1]||n>I.max[0]||a>I.max[1])continue;if(L.node.hidden===!0)return{height:1/0,maxHeight:L.feature.properties.height,hidden:!1,verticalScale:L.evaluatedScale[2]};ht.mat4.invert(x,L.node.matrix),f[0]=n,f[1]=a,ht.vec3.transformMat4(f,f,x);const z=(f[0]-N.aabb.min[0])/(N.aabb.max[0]-N.aabb.min[0])*m_|0,F=Math.min(63,(f[1]-N.aabb.min[1])/(N.aabb.max[1]-N.aabb.min[1])*m_|0)*m_+Math.min(63,z),R=N.heightmap[F];if(!(R<0&&L.node.footprint))return L.hiddenByReplacement?void 0:{height:R,maxHeight:L.feature.properties.height,hidden:!1,verticalScale:L.evaluatedScale[2]};if(L.node.footprint.grid.query(new at(n,a),new at(n,a),v),v.length>0)return{height:void 0,maxHeight:L.feature.properties.height,hidden:L.hiddenByReplacement,verticalScale:L.evaluatedScale[2]}}}}function cx(c,n){return!c.isLightConstant&&n}function HO(c,n,a,h,v,f,x,P){let L=(61440&n|(61440&n)>>4)>>8,N=(3840&n|(3840&n)>>4)>>4,I=240&n|(240&n)>>4;a[3]>0&&(L=ir(L,255*a[0],a[3]),N=ir(N,255*a[1],a[3]),I=ir(I,255*a[2],a[3]));const z=L<<8|N,F=I<<8|Math.floor(255*h[3]),R=function(Te){const Ae=ui(Te,0,2);return Math.min(Math.round(.5*Ae*255),255)}(h[2])<<8|15*h[0]<<4|15*h[1],O=ui(v[0],0,1),q=ui(v[1],0,1),te=ui(v[2],0,1),ae=ui(v[3],0,1);let ge,_e,he,xe;if(O!==q&&x!==f&&q!==O){const Te=x-f;_e=1/(Te*(q-O)),he=-(f+Te*O)/(Te*(q-O));const Ae=ui(v[4],-1,1);xe=Math.pow(10,Ae),ge=255*te<<8|255*ae}else ge=65535,_e=0,he=1,xe=1;if(c.emplaceBack(z,F,R,ge,_e,he,xe),P){const Te=P.length;P.clear();for(let Ae=0;Ae<Te;Ae++)P.emplaceBack(z,F,R,ge,_e,he,xe)}}function ZO(c,n,a){const h=c.node;let v=0;const f=a&Py.HasMeshoptCompression;for(const x of h.meshes){if(h.lights&&h.lightMeshIndex===v||!x.featureData)continue;x.featureArray=new yo,x.featureArray.reserve(x.featureData.length);let P=n;for(const L of x.featureData){const N=f?65535&L:L>>16&65535,I=f?L>>16&65535:65535&L,z=(15&I)<8?15&I:0,F=c.evaluatedRMEA[z],R=c.evaluatedColor[z],O=c.emissionHeightBasedParams[z];let q;if(P&&z===2&&h.lights&&(q=new yo,q.resize(10*h.lights.length)),HO(x.featureArray,N,R,F,O,x.aabb.min[2],x.aabb.max[2],q),q&&P){P=!1;const te=h.meshes[h.lightMeshIndex];te.featureArray=q,te.featureArray._trim()}}x.featureArray._trim(),v++}}function yM(c,n,a,h){const v=1<<c.z;n.lat=Ws((h/mi+c.y)/v),n.lng=Nl((a/mi+c.x)/v)}ki(I0,"Tiled3dModelBucket",{omit:["layers"]}),ki(_M,"Tiled3dModelFeature");const WO={circle:class extends Et{constructor(c,n,a,h){super(c,{layout:Qt||(Qt=new _a({"circle-sort-key":new Ei(tn.layout_circle["circle-sort-key"]),visibility:new Xn(tn.layout_circle.visibility)})),paint:An||(An=new _a({"circle-radius":new Ei(tn.paint_circle["circle-radius"]),"circle-color":new Ei(tn.paint_circle["circle-color"]),"circle-blur":new Ei(tn.paint_circle["circle-blur"]),"circle-opacity":new Ei(tn.paint_circle["circle-opacity"]),"circle-translate":new Xn(tn.paint_circle["circle-translate"]),"circle-translate-anchor":new Xn(tn.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Xn(tn.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Xn(tn.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ei(tn.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ei(tn.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ei(tn.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Xn(tn.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Ei({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Ei({type:"string",default:"default","property-type":"data-driven"})}))},n,a,h)}createBucket(c){return new Se(c)}queryRadius(c){const n=c;return Ht("circle-radius",this,n)+Ht("circle-stroke-width",this,n)+En(this.paint.get("circle-translate"))}queryIntersectsFeature(c,n,a,h,v,f,x,P){const L=ti(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,c.pixelToTileUnitsFactor),N=this.paint.get("circle-radius").evaluate(n,a)+this.paint.get("circle-stroke-width").evaluate(n,a);return hm(c,h,f,x,P,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",L,N)}getProgramIds(){return["circle"]}getDefaultProgramParams(c,n,a){const h=Tp(this);return{config:new Md(this,{zoom:n,lut:a}),defines:h,overrideFog:!1}}},heatmap:class extends Et{createBucket(c){return new Yg(c)}constructor(c,n,a,h){super(c,{layout:Kg||(Kg=new _a({visibility:new Xn(tn.layout_heatmap.visibility)})),paint:Ab||(Ab=new _a({"heatmap-radius":new Ei(tn.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ei(tn.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Xn(tn.paint_heatmap["heatmap-intensity"]),"heatmap-color":new bc(tn.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Xn(tn.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Ei({type:"string",default:"default","property-type":"data-driven"})}))},n,a,h),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Jg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(c){return Ht("heatmap-radius",this,c)}queryIntersectsFeature(c,n,a,h,v,f,x,P){const L=this.paint.get("heatmap-radius").evaluate(n,a);return hm(c,h,f,x,P,!0,!0,new at(0,0),L)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(c,n,a){return c==="heatmap"?{config:new Md(this,{zoom:n,lut:a}),overrideFog:!1}:{}}},hillshade:class extends Et{constructor(c,n,a,h){super(c,{layout:kb||(kb=new _a({visibility:new Xn(tn.layout_hillshade.visibility)})),paint:Mv||(Mv=new _a({"hillshade-illumination-direction":new Xn(tn.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Xn(tn.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Xn(tn.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Xn(tn.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Xn(tn.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Xn(tn.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Xn(tn.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Ei({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Ei({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Ei({type:"string",default:"default","property-type":"data-driven"})}))},n,a,h)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(c,n,a){return{overrideFog:!1}}},fill:class extends Et{constructor(c,n,a,h){super(c,{layout:Bb||(Bb=new _a({"fill-sort-key":new Ei(tn.layout_fill["fill-sort-key"]),visibility:new Xn(tn.layout_fill.visibility),"fill-elevation-reference":new Xn(tn.layout_fill["fill-elevation-reference"])})),paint:my||(my=new _a({"fill-antialias":new Xn(tn.paint_fill["fill-antialias"]),"fill-opacity":new Ei(tn.paint_fill["fill-opacity"]),"fill-color":new Ei(tn.paint_fill["fill-color"]),"fill-outline-color":new Ei(tn.paint_fill["fill-outline-color"]),"fill-translate":new Xn(tn.paint_fill["fill-translate"]),"fill-translate-anchor":new Xn(tn.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ei(tn.paint_fill["fill-pattern"]),"fill-emissive-strength":new Xn(tn.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Ei(tn.paint_fill["fill-z-offset"]),"fill-color-use-theme":new Ei({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Ei({type:"string",default:"default","property-type":"data-driven"})}))},n,a,h)}getProgramIds(){const c=this.paint.get("fill-pattern"),n=c&&c.constantOr(1),a=[n?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&a.push(n&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),a}getDefaultProgramParams(c,n,a){return{config:new Md(this,{zoom:n,lut:a}),overrideFog:!1}}recalculate(c,n){super.recalculate(c,n);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(c){return new Ov(c)}queryRadius(){return En(this.paint.get("fill-translate"))}queryIntersectsFeature(c,n,a,h,v,f){return!c.queryGeometry.isAboveHorizon&&Xe(Vn(c.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,c.pixelToTileUnitsFactor),h)}isTileClipped(){return!0}is3D(){return this.paint.get("fill-z-offset").constantOr(1)!==0}},"fill-extrusion":class extends Et{constructor(c,n,a,h){super(c,{layout:X||(X=new _a({visibility:new Xn(tn["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Xn(tn["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:oe||(oe=new _a({"fill-extrusion-opacity":new Xn(tn["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ei(tn["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Xn(tn["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Xn(tn["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ei(tn["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ei(tn["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ei(tn["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Xn(tn["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Xn(tn["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Xn(tn["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Xn(tn["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Xn(tn["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Xn(tn["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Xn(tn["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Xn(tn["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Xn(tn["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Xn(tn["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Ei(tn["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Ei(tn["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Xn(tn["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Xn(tn["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Xn(tn["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Xn(tn["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Ei(tn["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Ei(tn["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Xn(tn["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Ei({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Ei({type:"string",default:"default","property-type":"data-driven"})}))},n,a,h),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(c){return new og(c)}queryRadius(){return En(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(c,n,a,h,v,f,x,P,L){const N=ti(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,c.pixelToTileUnitsFactor),I=this.paint.get("fill-extrusion-height").evaluate(n,a),z=this.paint.get("fill-extrusion-base").evaluate(n,a),F=[0,0],R=P&&f.elevation,O=f.elevation?f.elevation.exaggeration():1,q=c.tile.getBucket(this);if(R&&q instanceof og){const he=q.centroidVertexArray,xe=L+1;xe<he.length&&(F[0]=he.geta_centroid_pos0(xe),F[1]=he.geta_centroid_pos1(xe))}if(F[0]===0&&F[1]===1)return!1;f.projection.name==="globe"&&(h=U([h],[new at(0,0),new at(mi,mi)],c.tileID.canonical).map(he=>he.polygon).flat());const te=R?P:null,[ae,ge]=function(he,xe,Te,Ae,tt,Ke,Ye,Ct,ct,It,Rt){return he.projection.name==="globe"?function(At,Vt,Wt,Kt,qt,yn,Yn,xn,di,ci,Ti){const In=[],ji=[],gi=At.projection.upVectorScale(Ti,At.center.lat,At.worldSize).metersToTile,Oi=[0,0,0,1],rr=[0,0,0,1],wr=(Fr,Pr,qr,Aa)=>{Fr[0]=Pr,Fr[1]=qr,Fr[2]=Aa,Fr[3]=1},Ir=D();Wt>0&&(Wt+=Ir),Kt+=Ir;for(const Fr of Vt){const Pr=[],qr=[];for(const Aa of Fr){const ya=Aa.x+qt.x,fr=Aa.y+qt.y,va=At.projection.projectTilePoint(ya,fr,Ti),ma=At.projection.upVector(Ti,Aa.x,Aa.y);let ka=Wt,uo=Kt;if(Yn){const ho=Ce(ya,fr,Wt,Kt,Yn,xn,di,ci);ka+=ho.base,uo+=ho.top}Wt!==0?wr(Oi,va.x+ma[0]*gi*ka,va.y+ma[1]*gi*ka,va.z+ma[2]*gi*ka):wr(Oi,va.x,va.y,va.z),wr(rr,va.x+ma[0]*gi*uo,va.y+ma[1]*gi*uo,va.z+ma[2]*gi*uo),ht.vec3.transformMat4(Oi,Oi,yn),ht.vec3.transformMat4(rr,rr,yn),Pr.push(new Ip(Oi[0],Oi[1],Oi[2])),qr.push(new Ip(rr[0],rr[1],rr[2]))}In.push(Pr),ji.push(qr)}return[In,ji]}(he,xe,Te,Ae,tt,Ke,Ye,Ct,ct,It,Rt):Ye?function(At,Vt,Wt,Kt,qt,yn,Yn,xn,di){const ci=[],Ti=[],In=[0,0,0,1];for(const ji of At){const gi=[],Oi=[];for(const rr of ji){const wr=rr.x+Kt.x,Ir=rr.y+Kt.y,Fr=Ce(wr,Ir,Vt,Wt,yn,Yn,xn,di);In[0]=wr,In[1]=Ir,In[2]=Fr.base,In[3]=1,ht.vec4.transformMat4(In,In,qt),In[3]=Math.max(In[3],1e-5);const Pr=new Ip(In[0]/In[3],In[1]/In[3],In[2]/In[3]);In[0]=wr,In[1]=Ir,In[2]=Fr.top,In[3]=1,ht.vec4.transformMat4(In,In,qt),In[3]=Math.max(In[3],1e-5);const qr=new Ip(In[0]/In[3],In[1]/In[3],In[2]/In[3]);gi.push(Pr),Oi.push(qr)}ci.push(gi),Ti.push(Oi)}return[ci,Ti]}(xe,Te,Ae,tt,Ke,Ye,Ct,ct,It):function(At,Vt,Wt,Kt,qt){const yn=[],Yn=[],xn=qt[8]*Vt,di=qt[9]*Vt,ci=qt[10]*Vt,Ti=qt[11]*Vt,In=qt[8]*Wt,ji=qt[9]*Wt,gi=qt[10]*Wt,Oi=qt[11]*Wt;for(const rr of At){const wr=[],Ir=[];for(const Fr of rr){const Pr=Fr.x+Kt.x,qr=Fr.y+Kt.y,Aa=qt[0]*Pr+qt[4]*qr+qt[12],ya=qt[1]*Pr+qt[5]*qr+qt[13],fr=qt[2]*Pr+qt[6]*qr+qt[14],va=qt[3]*Pr+qt[7]*qr+qt[15],ma=Aa+xn,ka=ya+di,uo=fr+ci,ho=Math.max(va+Ti,1e-5),Us=Aa+In,Wc=ya+ji,as=fr+gi,ds=Math.max(va+Oi,1e-5);wr.push(new Ip(ma/ho,ka/ho,uo/ho)),Ir.push(new Ip(Us/ds,Wc/ds,as/ds))}yn.push(wr),Yn.push(Ir)}return[yn,Yn]}(xe,Te,Ae,tt,Ke)}(f,h,z,I,N,x,te,F,O,f.center.lat,c.tileID.canonical),_e=c.queryGeometry;return function(he,xe,Te){let Ae=1/0;Xe(Te,xe)&&(Ae=ve(Te,xe[0]));for(let tt=0;tt<xe.length;tt++){const Ke=xe[tt],Ye=he[tt];for(let Ct=0;Ct<Ke.length-1;Ct++){const ct=Ke[Ct],It=[ct,Ke[Ct+1],Ye[Ct+1],Ye[Ct],ct];ke(Te,It)&&(Ae=Math.min(Ae,ve(Te,It)))}}return Ae!==1/0&&Ae}(ae,ge,_e.isPointQuery()?_e.screenBounds:_e.screenGeometry)}},line:class extends Et{constructor(c,n,a,h){const v=hr();super(c,v,n,a,h),v.layout&&(this.layout=new xc(v.layout)),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(c){if(c==="line-gradient"){const n=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=n._styleExpression&&n._styleExpression.expression instanceof Rr,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(c,n){super.recalculate(c,n),this.paint._values["line-floorwidth"]=(()=>{if(vs)return vs;const a=hr();return vs=new pa(a.paint.properties["line-width"].specification),vs.useIntegerZoom=!0,vs})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)}createBucket(c){return new Dn(c)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(c,n,a){const h=ar(this);return{config:new Md(this,{zoom:n,lut:a}),defines:h,overrideFog:!1}}queryRadius(c){const n=c,a=To(Ht("line-width",this,n),Ht("line-gap-width",this,n)),h=Ht("line-offset",this,n);return a/2+Math.abs(h)+En(this.paint.get("line-translate"))}queryIntersectsFeature(c,n,a,h,v,f){if(c.queryGeometry.isAboveHorizon)return!1;const x=Vn(c.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,c.pixelToTileUnitsFactor),P=c.pixelToTileUnitsFactor/2*To(this.paint.get("line-width").evaluate(n,a),this.paint.get("line-gap-width").evaluate(n,a)),L=this.paint.get("line-offset").evaluate(n,a);return L&&(h=function(N,I){const z=[],F=new at(0,0);for(let R=0;R<N.length;R++){const O=N[R],q=[];for(let te=0;te<O.length;te++){const ae=O[te],ge=O[te+1],_e=te===0?F:ae.sub(O[te-1])._unit()._perp(),he=te===O.length-1?F:ge.sub(ae)._unit()._perp(),xe=_e._add(he)._unit();xe._mult(1/(xe.x*he.x+xe.y*he.y)),q.push(xe._mult(I)._add(ae))}z.push(q)}return z}(h,L*c.pixelToTileUnitsFactor)),function(N,I,z){for(let F=0;F<I.length;F++){const R=I[F];if(N.length>=3){for(let O=0;O<R.length;O++)if(Mt(N,R[O]))return!0}if(ut(N,R,z))return!0}return!1}(x,h,P)}isTileClipped(){return!0}isDraped(c){const n=this.layout.get("line-z-offset"),a=n.isConstant()&&!n.constantOr(0),h=this.layout.get("line-elevation-reference");return!(h==="sea"||h==="ground")&&(a||h!=="none")}},symbol:x0,background:class extends Et{constructor(c,n,a,h){super(c,{layout:$E||($E=new _a({visibility:new Xn(tn.layout_background.visibility)})),paint:GE||(GE=new _a({"background-pitch-alignment":new Xn(tn.paint_background["background-pitch-alignment"]),"background-color":new Xn(tn.paint_background["background-color"]),"background-pattern":new Xn(tn.paint_background["background-pattern"]),"background-opacity":new Xn(tn.paint_background["background-opacity"]),"background-emissive-strength":new Xn(tn.paint_background["background-emissive-strength"]),"background-color-use-theme":new Ei({type:"string",default:"default","property-type":"data-driven"})}))},n,a,h)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(c,n,a){return{overrideFog:!1}}is3D(){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:XE,"raster-particle":tM,sky:class extends Et{constructor(c,n,a,h){super(c,{layout:JE||(JE=new _a({visibility:new Xn(tn.layout_sky.visibility)})),paint:QE||(QE=new _a({"sky-type":new Xn(tn.paint_sky["sky-type"]),"sky-atmosphere-sun":new Xn(tn.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Xn(tn.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Xn(tn.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Xn(tn.paint_sky["sky-gradient-radius"]),"sky-gradient":new bc(tn.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Xn(tn.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Xn(tn.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Xn(tn.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Ei({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Ei({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Ei({type:"string",default:"default","property-type":"data-driven"})}))},n,a,h),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(c){c==="sky-gradient"?this._updateColorRamp():c!=="sky-atmosphere-sun"&&c!=="sky-atmosphere-halo-color"&&c!=="sky-atmosphere-color"&&c!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Jg({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(c){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const n=c.style.light.properties.get("position");return this._lightPosition.azimuthal!==n.azimuthal||this._lightPosition.polar!==n.polar}return!1}getCenter(c,n){if(this.paint.get("sky-type")==="atmosphere"){const h=this.paint.get("sky-atmosphere-sun"),v=!h,f=c.style.light,x=f.properties.get("position");return v&&f.properties.get("anchor")==="viewport"&&it("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),v?eS(x.azimuthal,90-x.polar,n):eS(h[0],90-h[1],n)}const a=this.paint.get("sky-gradient-center");return eS(a[0],90-a[1],n)}isSky(){return!0}markSkyboxValid(c){this._skyboxInvalidated=!1,this._lightPosition=c.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const c=this.paint.get("sky-type");return c==="atmosphere"?["skyboxCapture","skybox"]:c==="gradient"?["skyboxGradient"]:null}},slot:class extends Et{constructor(c,n,a,h){super(c,{paint:eM||(eM=new _a({}))},n,null)}},model:class extends Et{constructor(c,n,a,h){super(c,{layout:hM||(hM=new _a({visibility:new Xn(tn.layout_model.visibility),"model-id":new Ei(tn.layout_model["model-id"])})),paint:dM||(dM=new _a({"model-opacity":new Ei(tn.paint_model["model-opacity"]),"model-rotation":new Ei(tn.paint_model["model-rotation"]),"model-scale":new Ei(tn.paint_model["model-scale"]),"model-translation":new Ei(tn.paint_model["model-translation"]),"model-color":new Ei(tn.paint_model["model-color"]),"model-color-mix-intensity":new Ei(tn.paint_model["model-color-mix-intensity"]),"model-type":new Xn(tn.paint_model["model-type"]),"model-cast-shadows":new Xn(tn.paint_model["model-cast-shadows"]),"model-receive-shadows":new Xn(tn.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Xn(tn.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Ei(tn.paint_model["model-emissive-strength"]),"model-roughness":new Ei(tn.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Ei(tn.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Xn(tn.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Xn(tn.paint_model["model-front-cutoff"]),"model-color-use-theme":new Ei({type:"string",default:"default","property-type":"data-driven"})}))},n,a,h),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(c){return new iS(c)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(c){return c instanceof I0?mi-1:0}queryIntersectsFeature(c,n,a,h,v,f){if(!this.modelManager)return!1;const x=this.modelManager,P=c.tile.getBucket(this);if(!(P&&P instanceof iS))return!1;for(const L in P.instancesPerModel){const N=P.instancesPerModel[L],I=n.id!==void 0?n.id:n.properties&&n.properties.hasOwnProperty("id")?n.properties.id:void 0;if(N.idToFeaturesIndex.hasOwnProperty(I)){const z=N.features[N.idToFeaturesIndex[I]],F=x.getModel(L,this.scope);if(!F)return!1;let R=ht.mat4.create();const O=new Kr(0,0),q=P.canonical;let te=Number.MAX_VALUE;for(let ae=0;ae<z.instancedDataCount;++ae){const ge=16*(z.instancedDataOffset+ae),_e=N.instancedDataArray.float32,he=[_e[ge+4],_e[ge+5],_e[ge+6]];yM(q,O,_e[ge],0|_e[ge+1]),fM(R,F,f,O,z.rotation,z.scale,he,!1,!1,!1),f.projection.name==="globe"&&(R=nS(R,f));const xe=ht.mat4.multiply([],f.projMatrix,R),Te=c.queryGeometry,Ae=sM(Te.isPointQuery()?Te.screenBounds:Te.screenGeometry,f,xe,F.aabb);Ae!=null&&(te=Math.min(Ae,te))}return te!==Number.MAX_VALUE&&te}}return!1}_handleOverridablePaintPropertyUpdate(c,n,a){return!(!this.layout||n.isDataDriven()||a.isDataDriven()||c!=="model-color"&&c!=="model-color-mix-intensity"&&c!=="model-rotation"&&c!=="model-scale"&&c!=="model-translation"&&c!=="model-emissive-strength")}_isPropertyZoomDependent(c){const n=this._transitionablePaint._values[c];return n!=null&&n.value!=null&&n.value.expression!=null&&n.value.expression instanceof yu}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Et{constructor(c,n,a,h){super(c,{layout:Cf||(Cf=new _a({"clip-layer-types":new Xn(tn.layout_clip["clip-layer-types"]),"clip-layer-scope":new Xn(tn.layout_clip["clip-layer-scope"])})),paint:Fv||(Fv=new _a({}))},n,a,h)}recalculate(c,n){super.recalculate(c,n)}createBucket(c){return new Bv(c)}isTileClipped(){return!0}is3D(){return!0}}};class XO{constructor(n){this._callback=n,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class YO{constructor(){this.tasks={},this.taskQueue=[],As(["process"],this),this.invoker=new XO(this.process),this.nextId=0}add(n,a){const h=this.nextId++,v=function({type:f,isSymbolTile:x,zoom:P}){return P=P||0,f==="message"?0:f!=="maybePrepare"||x?f!=="parseTile"||x?f==="parseTile"&&x?300-P:f==="maybePrepare"&&x?400-P:500:200-P:100-P}(a);if(v===0){try{n()}finally{}return null}return this.tasks[h]={fn:n,metadata:a,priority:v,id:h},this.taskQueue.push(h),this.invoker.trigger(),{cancel:()=>{delete this.tasks[h]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(h=>!!this.tasks[h]),!this.taskQueue.length)return;const n=this.pick();if(n===null)return;const a=this.tasks[n];if(delete this.tasks[n],this.taskQueue.length&&this.invoker.trigger(),!a)return;a.fn()}finally{}}pick(){let n=null,a=1/0;for(let v=0;v<this.taskQueue.length;v++){const f=this.tasks[this.taskQueue[v]];f.priority<a&&(a=f.priority,n=v)}if(n===null)return null;const h=this.taskQueue[n];return this.taskQueue.splice(n,1),h}remove(){this.invoker.remove()}}class vM{constructor(n,a,h){this.target=n,this.parent=a,this.mapId=h,this.callbacks={},this.cancelCallbacks={},As(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new YO}send(n,a,h,v,f=!1,x){const P=Math.round(1e18*Math.random()).toString(36).substring(0,10);h&&(h.metadata=x,this.callbacks[P]=h);const L=new Set;return this.target.postMessage({id:P,type:n,hasCallback:!!h,targetMapId:v,mustQueue:f,sourceMapId:this.mapId,data:nl(a,L)},L),{cancel:()=>{h&&delete this.callbacks[P],this.target.postMessage({id:P,type:"<cancel>",targetMapId:v,sourceMapId:this.mapId})}}}receive(n){const a=n.data,h=a.id;if(h&&(!a.targetMapId||this.mapId===a.targetMapId))if(a.type==="<cancel>"){const v=this.cancelCallbacks[h];delete this.cancelCallbacks[h],v&&v.cancel()}else if(a.mustQueue||kn()){const v=this.callbacks[h],f=this.scheduler.add(()=>this.processTask(h,a),v&&v.metadata||{type:"message"});f&&(this.cancelCallbacks[h]=f)}else this.processTask(h,a)}processTask(n,a){if(delete this.cancelCallbacks[n],a.type==="<response>"){const h=this.callbacks[n];delete this.callbacks[n],h&&(a.error?h($c(a.error)):h(null,$c(a.data)))}else{const h=new Set,v=a.hasCallback?(x,P)=>{this.target.postMessage({id:n,type:"<response>",sourceMapId:this.mapId,error:x?nl(x):null,data:nl(P,h)},h)}:()=>{},f=$c(a.data);if(this.parent[a.type])this.parent[a.type](a.sourceMapId,f,v);else if(this.parent.getWorkerSource){const x=a.type.split(".");this.parent.getWorkerSource(a.sourceMapId,x[0],f.source,f.scope)[x[1]](f,v)}else v(new Error(`Could not find function ${a.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var ux={workerUrl:"",workerClass:null,workerParams:void 0};const oS="mapboxgl_preloaded_worker_pool";class __{constructor(){this.active={}}acquire(n,a=__.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<a;)this.workers.push(ux.workerClass!=null?new ux.workerClass:new self.Worker(ux.workerUrl,ux.workerParams));return this.active[n]=!0,this.workers.slice()}release(n){delete this.active[n],this.workers&&this.numActive()===0&&(this.workers.forEach(a=>{a.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[oS]}numActive(){return Object.keys(this.active).length}}__.workerCount=2;class ky{constructor(n,a,h="Worker",v=__.workerCount){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=Qa();const f=this.workerPool.acquire(this.id,v);for(let x=0;x<f.length;x++){const P=new ky.Actor(f[x],a,this.id);P.name=`${h} ${x}`,this.actors.push(P)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,a,h){sa(this.actors,(v,f)=>{v.send(n,a,f)},h=h||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}let hx,lS;function P0(){return hx||(hx=new __),hx}ky.Actor=vM;const cS=new Or(0,0,0);var A0=(c=>(c[c.PATH_RULE_UNSPECIFIED=0]="PATH_RULE_UNSPECIFIED",c[c.PATH_RULE_NON_ZERO=1]="PATH_RULE_NON_ZERO",c[c.PATH_RULE_EVEN_ODD=2]="PATH_RULE_EVEN_ODD",c))(A0||{}),k0=(c=>(c[c.LINE_CAP_UNSPECIFIED=0]="LINE_CAP_UNSPECIFIED",c[c.LINE_CAP_BUTT=1]="LINE_CAP_BUTT",c[c.LINE_CAP_ROUND=2]="LINE_CAP_ROUND",c[c.LINE_CAP_SQUARE=3]="LINE_CAP_SQUARE",c))(k0||{}),dx=(c=>(c[c.LINE_JOIN_UNSPECIFIED=0]="LINE_JOIN_UNSPECIFIED",c[c.LINE_JOIN_MITER=1]="LINE_JOIN_MITER",c[c.LINE_JOIN_MITER_CLIP=2]="LINE_JOIN_MITER_CLIP",c[c.LINE_JOIN_ROUND=3]="LINE_JOIN_ROUND",c[c.LINE_JOIN_BEVEL=4]="LINE_JOIN_BEVEL",c))(dx||{}),xM=(c=>(c[c.PAINT_ORDER_UNSPECIFIED=0]="PAINT_ORDER_UNSPECIFIED",c[c.PAINT_ORDER_FILL_AND_STROKE=1]="PAINT_ORDER_FILL_AND_STROKE",c[c.PAINT_ORDER_STROKE_AND_FILL=2]="PAINT_ORDER_STROKE_AND_FILL",c))(xM||{}),Dy=(c=>(c[c.PATH_COMMAND_UNSPECIFIED=0]="PATH_COMMAND_UNSPECIFIED",c[c.PATH_COMMAND_MOVE=1]="PATH_COMMAND_MOVE",c[c.PATH_COMMAND_LINE=2]="PATH_COMMAND_LINE",c[c.PATH_COMMAND_QUAD=3]="PATH_COMMAND_QUAD",c[c.PATH_COMMAND_CUBIC=4]="PATH_COMMAND_CUBIC",c[c.PATH_COMMAND_CLOSE=5]="PATH_COMMAND_CLOSE",c))(Dy||{}),bM=(c=>(c[c.MASK_TYPE_UNSPECIFIED=0]="MASK_TYPE_UNSPECIFIED",c[c.MASK_TYPE_LUMINANCE=1]="MASK_TYPE_LUMINANCE",c[c.MASK_TYPE_ALPHA=2]="MASK_TYPE_ALPHA",c))(bM||{});function KO(c,n,a){c===1&&n.icons.push(function(h,v){return function(f){if(f.usvg_tree.height||(f.usvg_tree.height=f.usvg_tree.width),!f.metadata)return f;const{metadata:x}=f;if(x.content_area){const{content_area:P}=x;P.top==null&&(P.top=P.left),P.width==null&&(P.width=f.usvg_tree.width),P.height==null&&(P.height=P.width)}return x.stretch_x&&x.stretch_x.length&&wM(x,"x"),x.stretch_y&&x.stretch_y.length&&wM(x,"y"),f}(h.readFields(JO,{name:void 0},v))}(a,a.readVarint()+a.pos))}function wM(c,n){const a=[],h=c[`stretch_${n}`];let v=null;for(let f=0;f<h.length;f++)v===null?v=a.length===0?h[0]:a[a.length-1][1]+h[f]:(a.push([v,v+h[f]]),v=null);c[`stretch_${n}_areas`]=a}function JO(c,n,a){c===1?n.name=a.readString():c===2?n.metadata=function(h,v){return h.readFields(QO,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},v)}(a,a.readVarint()+a.pos):c===3&&(n.usvg_tree=function(h,v){return h.readFields(nF,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},v)}(a,a.readVarint()+a.pos),n.data="usvg_tree")}function QO(c,n,a){c===1?n.stretch_x=a.readPackedVarint():c===2?n.stretch_y=a.readPackedVarint():c===3?n.content_area=function(h,v){return h.readFields(eF,{left:0},v)}(a,a.readVarint()+a.pos):c===4&&n.variables.push(function(h,v){return h.readFields(tF,{name:void 0},v)}(a,a.readVarint()+a.pos))}function eF(c,n,a){c===1?n.left=a.readVarint():c===2?n.width=a.readVarint():c===3?n.top=a.readVarint():c===4&&(n.height=a.readVarint())}function tF(c,n,a){c===1?n.name=a.readString():c===2&&(n.rgb_color=L0(a.readVarint()),n.value="rgb_color")}function nF(c,n,a){c===1?n.width=n.height=a.readVarint():c===2?n.height=a.readVarint():c===3?n.children.push(D0(a,a.readVarint()+a.pos)):c===4?n.linear_gradients.push(function(h,v){return h.readFields(cF,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},v)}(a,a.readVarint()+a.pos)):c===5?n.radial_gradients.push(function(h,v){return h.readFields(hF,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},v)}(a,a.readVarint()+a.pos)):c===7?n.clip_paths.push(function(h,v){return h.readFields(dF,{children:[]},v)}(a,a.readVarint()+a.pos)):c===8&&n.masks.push(function(h,v){const f=h.readFields(fF,{left:0,width:20,mask_type:1,children:[]},v);return f.height==null&&(f.height=f.width),f.top==null&&(f.top=f.left),f}(a,a.readVarint()+a.pos))}function D0(c,n){return c.readFields(iF,{},n)}function iF(c,n,a){c===1?(n.group=function(h,v){return h.readFields(rF,{opacity:255,children:[]},v)}(a,a.readVarint()+a.pos),n.node="group"):c===2&&(n.path=function(h,v){return h.readFields(sF,{paint_order:1,commands:[],step:1,diffs:[],rule:1},v)}(a,a.readVarint()+a.pos),n.node="path")}function rF(c,n,a){c===1?n.transform=R0(a,a.readVarint()+a.pos):c===2?n.opacity=a.readVarint():c===5?n.clip_path_idx=a.readVarint():c===6?n.mask_idx=a.readVarint():c===7&&n.children.push(D0(a,a.readVarint()+a.pos))}function R0(c,n){return c.readFields(aF,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},n)}function aF(c,n,a){c===1?n.sx=a.readFloat():c===2?n.ky=a.readFloat():c===3?n.kx=a.readFloat():c===4?n.sy=a.readFloat():c===5?n.tx=a.readFloat():c===6&&(n.ty=a.readFloat())}function sF(c,n,a){c===1?n.fill=function(h,v){return h.readFields(oF,{rgb_color:cS,paint:"rgb_color",opacity:255},v)}(a,a.readVarint()+a.pos):c===2?n.stroke=function(h,v){return h.readFields(lF,{rgb_color:cS,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},v)}(a,a.readVarint()+a.pos):c===3?n.paint_order=a.readVarint():c===5?a.readPackedVarint(n.commands):c===6?n.step=a.readFloat():c===7?a.readPackedSVarint(n.diffs):c===8&&(n.rule=a.readVarint())}function oF(c,n,a){c===1?(n.rgb_color=L0(a.readVarint()),n.paint="rgb_color"):c===2?(n.linear_gradient_idx=a.readVarint(),n.paint="linear_gradient_idx"):c===3?(n.radial_gradient_idx=a.readVarint(),n.paint="radial_gradient_idx"):c===5&&(n.opacity=a.readVarint())}function L0(c){return new Or((c>>16&255)/255,(c>>8&255)/255,(255&c)/255,1)}function lF(c,n,a){c===1?(n.rgb_color=L0(a.readVarint()),n.paint="rgb_color"):c===2?(n.linear_gradient_idx=a.readVarint(),n.paint="linear_gradient_idx"):c===3?(n.radial_gradient_idx=a.readVarint(),n.paint="radial_gradient_idx"):c===5?a.readPackedFloat(n.dasharray):c===6?n.dashoffset=a.readFloat():c===7?n.miterlimit=a.readFloat():c===8?n.opacity=a.readVarint():c===9?n.width=a.readFloat():c===10?n.linecap=a.readVarint():c===11&&(n.linejoin=a.readVarint())}function cF(c,n,a){c===1?n.transform=R0(a,a.readVarint()+a.pos):c===2?n.spread_method=a.readVarint():c===3?n.stops.push(SM(a,a.readVarint()+a.pos)):c===4?n.x1=a.readFloat():c===5?n.y1=a.readFloat():c===6?n.x2=a.readFloat():c===7&&(n.y2=a.readFloat())}function SM(c,n){return c.readFields(uF,{offset:0,opacity:255,rgb_color:cS},n)}function uF(c,n,a){c===1?n.offset=a.readFloat():c===2?n.opacity=a.readVarint():c===3&&(n.rgb_color=L0(a.readVarint()))}function hF(c,n,a){c===1?n.transform=R0(a,a.readVarint()+a.pos):c===2?n.spread_method=a.readVarint():c===3?n.stops.push(SM(a,a.readVarint()+a.pos)):c===4?n.cx=a.readFloat():c===5?n.cy=a.readFloat():c===6?n.r=a.readFloat():c===7?n.fx=a.readFloat():c===8?n.fy=a.readFloat():c===9&&(n.fr=a.readFloat())}function dF(c,n,a){c===1?n.transform=R0(a,a.readVarint()+a.pos):c===2?n.clip_path_idx=a.readVarint():c===3&&n.children.push(D0(a,a.readVarint()+a.pos))}function fF(c,n,a){c===1?n.left=n.top=a.readFloat():c===2?n.width=n.height=a.readFloat():c===3?n.top=a.readFloat():c===4?n.height=a.readFloat():c===5?n.mask_type=a.readVarint():c===6?n.mask_idx=a.readVarint():c===7&&n.children.push(D0(a,a.readVarint()+a.pos))}class pF{static calculate(n,a){const h=new Map,v=new Map;if(Object.keys(n).length===0)return h;a.forEach(f=>{v.set(f.name,f.rgb_color||new Or(0,0,0))});for(const[f,x]of Object.entries(n))v.has(f)?h.set(v.get(f).toStringPremultipliedAlpha(),x):console.warn(`Ignoring unknown image variable "${f}"`);return h}}function Ry(c,n=255,a){const h=n/255,v=c.toStringPremultipliedAlpha(),f=a.has(v)?a.get(v).clone():c.clone();return f.a=h,f.toString()}function uS(c,n){if(!On()){const a=document.createElement("canvas");return a.width=c,a.height=n,a}return new OffscreenCanvas(c,n)}function mF(c,n){const a=pF.calculate(n.params,c.metadata?c.metadata.variables:[]),h=c.usvg_tree,v=h.width,f=h.height,x=n.transform?n.transform:new DOMMatrix,P=Math.max(1,Math.round(v*x.a)),L=Math.max(1,Math.round(f*x.d)),N=new DOMMatrix([P/v,0,0,L/f,0,0]),I=uS(P,L).getContext("2d");return hS(I,N,h,h,a),I.getImageData(0,0,P,L)}function hS(c,n,a,h,v){for(const f of h.children)TM(c,n,a,f,v)}function TM(c,n,a,h,v){h.group?(c.save(),function(f,x,P,L,N){const I=L.mask_idx!=null?P.masks[L.mask_idx]:null,z=L.clip_path_idx!=null?P.clip_paths[L.clip_path_idx]:null;if(L.transform&&(x=fx(L.transform).preMultiplySelf(x)),!function(O,q,te){return O.opacity!==255||q||te}(L,z!=null,I!=null))return void hS(f,x,P,L,N);const F=uS(f.canvas.width,f.canvas.height),R=F.getContext("2d");z&&PM(R,x,P,z),hS(R,x,P,L,N),I&&AM(R,x,P,I,N),f.globalAlpha=L.opacity/255,f.drawImage(F,0,0)}(c,n,a,h.group,v),c.restore()):h.path&&(c.save(),function(f,x,P,L,N){const I=kM(L);f.setTransform(x),L.paint_order===xM.PAINT_ORDER_FILL_AND_STROKE?(CM(f,P,L,I,N),EM(f,P,L,I,N)):(EM(f,P,L,I,N),CM(f,P,L,I,N))}(c,n,a,h.path,v),c.restore())}function CM(c,n,a,h,v){const f=a.fill;if(!f)return;const x=f.opacity/255;switch(f.paint){case"rgb_color":c.fillStyle=Ry(f.rgb_color,f.opacity,v);break;case"linear_gradient_idx":c.fillStyle=MM(c,n.linear_gradients[f.linear_gradient_idx],x,v);break;case"radial_gradient_idx":c.fillStyle=IM(c,n.radial_gradients[f.radial_gradient_idx],x,v)}let P;switch(a.rule){case A0.PATH_RULE_NON_ZERO:P="nonzero";break;case A0.PATH_RULE_EVEN_ODD:P="evenodd"}c.fill(h,P)}function EM(c,n,a,h,v){const f=a.stroke;if(!f)return;c.lineWidth=f.width,c.miterLimit=f.miterlimit,c.setLineDash(f.dasharray),c.lineDashOffset=f.dashoffset;const x=f.opacity/255;switch(f.paint){case"rgb_color":c.strokeStyle=Ry(f.rgb_color,f.opacity,v);break;case"linear_gradient_idx":c.strokeStyle=MM(c,n.linear_gradients[f.linear_gradient_idx],x,v);break;case"radial_gradient_idx":c.strokeStyle=IM(c,n.radial_gradients[f.radial_gradient_idx],x,v)}switch(f.linejoin){case dx.LINE_JOIN_MITER_CLIP:case dx.LINE_JOIN_MITER:c.lineJoin="miter";break;case dx.LINE_JOIN_ROUND:c.lineJoin="round";break;case dx.LINE_JOIN_BEVEL:c.lineJoin="bevel"}switch(f.linecap){case k0.LINE_CAP_BUTT:c.lineCap="butt";break;case k0.LINE_CAP_ROUND:c.lineCap="round";break;case k0.LINE_CAP_SQUARE:c.lineCap="square"}c.stroke(h)}function MM(c,n,a,h){if(n.stops.length===1){const F=n.stops[0];return Ry(F.rgb_color,F.opacity*a,h)}const v=fx(n.transform),{x1:f,y1:x,x2:P,y2:L}=n,N=v.transformPoint(new DOMPoint(f,x)),I=v.transformPoint(new DOMPoint(P,L)),z=c.createLinearGradient(N.x,N.y,I.x,I.y);for(const F of n.stops)z.addColorStop(F.offset,Ry(F.rgb_color,F.opacity*a,h));return z}function IM(c,n,a,h){if(n.stops.length===1){const F=n.stops[0];return Ry(F.rgb_color,F.opacity*a,h)}const v=fx(n.transform),{fx:f,fy:x,cx:P,cy:L}=n,N=v.transformPoint(new DOMPoint(f,x)),I=v.transformPoint(new DOMPoint(P,L)),z=c.createRadialGradient(N.x,N.y,0,I.x,I.y,n.r*((v.a+v.d)/2));for(const F of n.stops)z.addColorStop(F.offset,Ry(F.rgb_color,F.opacity*a,h));return z}function PM(c,n,a,h){const v=fx(h.transform).preMultiplySelf(n),f=h.clip_path_idx!=null?a.clip_paths[h.clip_path_idx]:null;f&&PM(c,v,a,f);const x=new Path2D;let P;function L(N,I){if(N.path){const z=N.path;x.addPath(kM(z),I),z.rule===A0.PATH_RULE_EVEN_ODD&&(P="evenodd")}else if(N.group){const z=N.group.transform?fx(N.group.transform).preMultiplySelf(I):I;for(const F of N.group.children)L(F,z)}}for(const N of h.children)L(N,v);c.clip(x,P)}function AM(c,n,a,h,v){if(h.children.length===0)return;const f=h.mask_idx!=null?a.masks[h.mask_idx]:null;f&&AM(c,n,a,f,v);const x=c.canvas.width,P=c.canvas.height,L=uS(x,P),N=L.getContext("2d"),I=h.width,z=h.height,F=h.left,R=h.top,O=new Path2D,q=new Path2D;q.rect(F,R,I,z),O.addPath(q,n),N.clip(O);for(const ge of h.children)TM(N,n,a,ge,v);const te=N.getImageData(0,0,x,P),ae=te.data;if(h.mask_type===bM.MASK_TYPE_LUMINANCE)for(let ge=0;ge<ae.length;ge+=4)ae[ge+3]=ae[ge+3]/255*(.2126*ae[ge]+.7152*ae[ge+1]+.0722*ae[ge+2]);N.putImageData(te,0,0),c.globalCompositeOperation="destination-in",c.drawImage(L,0,0)}function fx(c){return c?new DOMMatrix([c.sx,c.ky,c.kx,c.sy,c.tx,c.ty]):new DOMMatrix}function kM(c){const n=new Path2D,a=c.step;let h=c.diffs[0]*a,v=c.diffs[1]*a;n.moveTo(h,v);for(let f=0,x=2;f<c.commands.length;f++)switch(c.commands[f]){case Dy.PATH_COMMAND_MOVE:h+=c.diffs[x++]*a,v+=c.diffs[x++]*a,n.moveTo(h,v);break;case Dy.PATH_COMMAND_LINE:h+=c.diffs[x++]*a,v+=c.diffs[x++]*a,n.lineTo(h,v);break;case Dy.PATH_COMMAND_QUAD:{const P=h+c.diffs[x++]*a,L=v+c.diffs[x++]*a;h=P+c.diffs[x++]*a,v=L+c.diffs[x++]*a,n.quadraticCurveTo(P,L,h,v);break}case Dy.PATH_COMMAND_CUBIC:{const P=h+c.diffs[x++]*a,L=v+c.diffs[x++]*a,N=P+c.diffs[x++]*a,I=L+c.diffs[x++]*a;h=N+c.diffs[x++]*a,v=I+c.diffs[x++]*a,n.bezierCurveTo(P,L,N,I,h,v);break}case Dy.PATH_COMMAND_CLOSE:n.closePath()}return n}class dS{constructor(n){this.capacity=n,this.cache=new Map}get(n){if(!this.cache.has(n))return;const a=this.cache.get(n);return this.cache.delete(n),this.cache.set(n,a),a}put(n,a){this.cache.has(n)?this.cache.delete(n):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(n,a)}delete(n){this.cache.delete(n)}}class fS{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(n){return new Zo(n,n.data)}getFromCache(n,a,h){return this.cacheMap.has(h)||this.cacheMap.set(h,new dS(150)),this.cacheMap.get(h).get(Je(n.serialize(),a))}setInCache(n,a,h,v){this.cacheDependenciesMap.has(v)||this.cacheDependenciesMap.set(v,new Map),this.cacheMap.has(v)||this.cacheMap.set(v,new dS(150));const f=this.cacheDependenciesMap.get(v);f.get(Je(n.id,h))||f.set(Je(n.id,h),new Set);const x=this.cacheMap.get(v),P=n.serialize();f.get(Je(n.id,h)).add(P),x.put(Je(n.serialize(),h),a)}removeImagesFromCacheByIds(n,a,h=""){if(!this.cacheMap.has(h)||!this.cacheDependenciesMap.has(h))return;const v=this.cacheMap.get(h),f=this.cacheDependenciesMap.get(h);for(const x of n)if(f.has(Je(x,a))){for(const P of f.get(Je(x,a)))v.delete(P);f.delete(Je(x,a))}}rasterize(n,a,h,v,f=mF){const x=this.getFromCache(n,h,v);if(x)return x.clone();const P=f(a.icon,n.options),L=fS._getImage(P);return this.setInCache(n,L,h,v),L.clone()}}class DM{constructor(n){this.size=n,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(n,a){const h=this.toIdx(n,a);return{min:this.minimums[h],max:this.maximums[h]}}isLeaf(n,a){return this.leaves[this.toIdx(n,a)]}toIdx(n,a){return a*this.size+n}}function RM(c,n,a,h){let v=0,f=Number.MAX_VALUE;for(let x=0;x<3;x++)if(Math.abs(h[x])<1e-15){if(a[x]<c[x]||a[x]>n[x])return null}else{const P=1/h[x];let L=(c[x]-a[x])*P,N=(n[x]-a[x])*P;if(L>N){const I=L;L=N,N=I}if(L>v&&(v=L),N<f&&(f=N),v>f)return null}return v}function LM(c,n,a,h,v,f,x,P,L,N,I){const z=h-c,F=v-n,R=f-a,O=x-c,q=P-n,te=L-a,ae=I[1]*te-I[2]*q,ge=I[2]*O-I[0]*te,_e=I[0]*q-I[1]*O,he=z*ae+F*ge+R*_e;if(Math.abs(he)<1e-15)return null;const xe=1/he,Te=N[0]-c,Ae=N[1]-n,tt=N[2]-a,Ke=(Te*ae+Ae*ge+tt*_e)*xe;if(Ke<0||Ke>1)return null;const Ye=Ae*R-tt*F,Ct=tt*z-Te*R,ct=Te*F-Ae*z,It=(I[0]*Ye+I[1]*Ct+I[2]*ct)*xe;return It<0||Ke+It>1?null:(O*Ye+q*Ct+te*ct)*xe}function zM(c,n,a){return(c-n)/(a-n)}function OM(c,n,a,h,v,f,x,P,L){const N=1<<a,I=f-h,z=x-v,F=(c+1)/N*I+h,R=(n+0)/N*z+v,O=(n+1)/N*z+v;P[0]=(c+0)/N*I+h,P[1]=R,L[0]=F,L[1]=O}class FM{constructor(n){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=n,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const a=function(f){const x=Math.ceil(Math.log2(f.dim/8)),P=[];let L=Math.ceil(Math.pow(2,x));const N=1/L,I=(R,O,q,te,ae)=>{const ge=te?1:0,_e=(R+1)*q-ge,he=O*q,xe=(O+1)*q-ge;ae[0]=R*q,ae[1]=he,ae[2]=_e,ae[3]=xe};let z=new DM(L);const F=[];for(let R=0;R<L*L;R++){I(R%L,Math.floor(R/L),N,!1,F);const O=pg(F[0],F[1],f),q=pg(F[2],F[1],f),te=pg(F[2],F[3],f),ae=pg(F[0],F[3],f);z.minimums.push(Math.min(O,q,te,ae)),z.maximums.push(Math.max(O,q,te,ae)),z.leaves.push(1)}for(P.push(z),L/=2;L>=1;L/=2){const R=P[P.length-1];z=new DM(L);for(let O=0;O<L*L;O++){I(O%L,Math.floor(O/L),2,!0,F);const q=R.getElevation(F[0],F[1]),te=R.getElevation(F[2],F[1]),ae=R.getElevation(F[2],F[3]),ge=R.getElevation(F[0],F[3]),_e=R.isLeaf(F[0],F[1]),he=R.isLeaf(F[2],F[1]),xe=R.isLeaf(F[2],F[3]),Te=R.isLeaf(F[0],F[3]),Ae=Math.min(q.min,te.min,ae.min,ge.min),tt=Math.max(q.max,te.max,ae.max,ge.max),Ke=_e&&he&&xe&&Te;z.maximums.push(tt),z.minimums.push(Ae),z.leaves.push(tt-Ae<=5&&Ke?1:0)}P.push(z)}return P}(this.dem),h=a.length-1,v=a[h];this._addNode(v.minimums[0],v.maximums[0],v.leaves[0]),this._construct(a,0,0,h,0)}raycastRoot(n,a,h,v,f,x,P=1){return RM([n,a,-100],[h,v,this.maximums[0]*P],f,x)}raycast(n,a,h,v,f,x,P=1){if(!this.nodeCount)return null;const L=this.raycastRoot(n,a,h,v,f,x,P);if(L==null)return null;const N=[],I=[],z=[],F=[],R=[{idx:0,t:L,nodex:0,nodey:0,depth:0}];for(;R.length>0;){const{idx:O,t:q,nodex:te,nodey:ae,depth:ge}=R.pop();if(this.leaves[O]){OM(te,ae,ge,n,a,h,v,z,F);const he=1<<ge,xe=(te+0)/he,Te=(te+1)/he,Ae=(ae+0)/he,tt=(ae+1)/he,Ke=pg(xe,Ae,this.dem)*P,Ye=pg(Te,Ae,this.dem)*P,Ct=pg(Te,tt,this.dem)*P,ct=pg(xe,tt,this.dem)*P,It=LM(z[0],z[1],Ke,F[0],z[1],Ye,F[0],F[1],Ct,f,x),Rt=LM(F[0],F[1],Ct,z[0],F[1],ct,z[0],z[1],Ke,f,x),At=Math.min(It!==null?It:Number.MAX_VALUE,Rt!==null?Rt:Number.MAX_VALUE);if(At!==Number.MAX_VALUE)return At;{const Vt=ht.vec3.scaleAndAdd([],f,x,q);if(BM(Ke,Ye,ct,Ct,zM(Vt[0],z[0],F[0]),zM(Vt[1],z[1],F[1]))>=Vt[2])return q}continue}let _e=0;for(let he=0;he<this._siblingOffset.length;he++){OM((te<<1)+this._siblingOffset[he][0],(ae<<1)+this._siblingOffset[he][1],ge+1,n,a,h,v,z,F),z[2]=-100,F[2]=this.maximums[this.childOffsets[O]+he]*P;const xe=RM(z,F,f,x);if(xe!=null){const Te=xe;N[he]=Te;let Ae=!1;for(let tt=0;tt<_e&&!Ae;tt++)Te>=N[I[tt]]&&(I.splice(tt,0,he),Ae=!0);Ae||(I[_e]=he),_e++}}for(let he=0;he<_e;he++){const xe=I[he];R.push({idx:this.childOffsets[O]+xe,t:N[xe],nodex:(te<<1)+this._siblingOffset[xe][0],nodey:(ae<<1)+this._siblingOffset[xe][1],depth:ge+1})}}return null}_addNode(n,a,h){return this.minimums.push(n),this.maximums.push(a),this.leaves.push(h),this.childOffsets.push(0),this.nodeCount++}_construct(n,a,h,v,f){if(n[v].isLeaf(a,h)===1)return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const x=v-1,P=n[x];let L=0,N=0;for(let I=0;I<this._siblingOffset.length;I++){const z=2*a+this._siblingOffset[I][0],F=2*h+this._siblingOffset[I][1],R=P.getElevation(z,F),O=P.isLeaf(z,F),q=this._addNode(R.min,R.max,O);O&&(L|=1<<I),N||(N=q)}for(let I=0;I<this._siblingOffset.length;I++)L&1<<I||this._construct(n,2*a+this._siblingOffset[I][0],2*h+this._siblingOffset[I][1],x,N+I)}}function BM(c,n,a,h,v,f){return ir(ir(c,a,f),ir(n,h,f),v)}function pg(c,n,a){const h=a.dim,v=ui(c*h-.5,0,h-1),f=ui(n*h-.5,0,h-1),x=Math.floor(v),P=Math.floor(f),L=Math.min(x+1,h-1),N=Math.min(P+1,h-1);return BM(a.get(x,P),a.get(L,P),a.get(x,N),a.get(L,N),v-x,f-P)}const gF={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function _F(c,n,a){return(256*c*256+256*n+a)/10-1e4}function yF(c,n,a){return 256*c+n+a/256-32768}class z0{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(n,a,h,v=!1){if(this.uid=n,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(h&&h!=="mapbox"&&h!=="terrarium")return void it(`"${h}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=a.height;const f=this.dim=a.height-2,x=new Uint32Array(a.data.buffer);if(this.pixels=new Uint8Array(a.data.buffer),this.floatView=new Float32Array(a.data.buffer),this.borderReady=v,this._modifiedForSources={},!v){for(let L=0;L<f;L++)x[this._idx(-1,L)]=x[this._idx(0,L)],x[this._idx(f,L)]=x[this._idx(f-1,L)],x[this._idx(L,-1)]=x[this._idx(L,0)],x[this._idx(L,f)]=x[this._idx(L,f-1)];x[this._idx(-1,-1)]=x[this._idx(0,0)],x[this._idx(f,-1)]=x[this._idx(f-1,0)],x[this._idx(-1,f)]=x[this._idx(0,f-1)],x[this._idx(f,f)]=x[this._idx(f-1,f-1)]}const P=h==="terrarium"?yF:_F;for(let L=0;L<x.length;++L){const N=4*L;this.floatView[L]=P(this.pixels[N],this.pixels[N+1],this.pixels[N+2])}this._timestamp=_i.now()}_buildQuadTree(){this._tree=new FM(this)}get(n,a,h=!1){h&&(n=ui(n,-1,this.dim),a=ui(a,-1,this.dim));const v=this._idx(n,a);return this.floatView[v]}set(n,a,h){const v=this._idx(n,a),f=this.floatView[v];return this.floatView[v]=h,h-f}static getUnpackVector(n){return gF[n]}_idx(n,a){if(n<-1||n>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(n+1)}static pack(n,a){const h=[0,0,0,0],v=z0.getUnpackVector(a);let f=Math.floor((n+v[3])/v[2]);return h[2]=f%256,f=Math.floor(f/256),h[1]=f%256,f=Math.floor(f/256),h[0]=f,h}getPixels(){return new uy({width:this.stride,height:this.stride},this.pixels)}backfillBorder(n,a,h){if(this.dim!==n.dim)throw new Error("dem dimension mismatch");let v=a*this.dim,f=a*this.dim+this.dim,x=h*this.dim,P=h*this.dim+this.dim;switch(a){case-1:v=f-1;break;case 1:f=v+1}switch(h){case-1:x=P-1;break;case 1:P=x+1}const L=-a*this.dim,N=-h*this.dim;for(let I=x;I<P;I++)for(let z=v;z<f;z++){const F=4*this._idx(z,I),R=4*this._idx(z+L,I+N);this.pixels[F+0]=n.pixels[R+0],this.pixels[F+1]=n.pixels[R+1],this.pixels[F+2]=n.pixels[R+2],this.pixels[F+3]=n.pixels[R+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function vF(c,n,a){c===1?n.headerLength=a.readFixed32():c===2?n.x=a.readVarint():c===3?n.y=a.readVarint():c===4?n.z=a.readVarint():c===5&&n.layers.push(function(h,v){return h.readFields(TF,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},v)}(a,a.readVarint()+a.pos))}function xF(c,n,a){c===1?(n.delta_filter=function(h,v){return h.readFields(bF,{blockSize:0},v)}(a,a.readVarint()+a.pos),n.filter="delta_filter"):c===2?(a.readVarint(),n.filter="zigzag_filter"):c===3?(a.readVarint(),n.filter="bitshuffle_filter"):c===4&&(a.readVarint(),n.filter="byteshuffle_filter")}function bF(c,n,a){c===1&&(n.blockSize=a.readVarint())}function wF(c,n,a){c===1?(a.readVarint(),n.codec="gzip_data"):c===2?(a.readVarint(),n.codec="jpeg_image"):c===3?(a.readVarint(),n.codec="webp_image"):c===4&&(a.readVarint(),n.codec="png_image")}function SF(c,n,a){let h=0,v=0;c===1?n.firstByte=a.readFixed64():c===2?n.lastByte=a.readFixed64():c===3?n.filters.push(function(f,x){return f.readFields(xF,{},x)}(a,a.readVarint()+a.pos)):c===4?n.codec=function(f,x){return f.readFields(wF,{},x)}(a,a.readVarint()+a.pos):c===5?v=a.readFloat():c===6?h=a.readFloat():c===7?n.bands.push(a.readString()):c===8?n.offset=a.readDouble():c===9&&(n.scale=a.readDouble()),n.offset===0&&(n.offset=v),n.scale===0&&(n.scale=h)}function TF(c,n,a){c===1?n.version=a.readVarint():c===2?n.name=a.readString():c===3?n.units=a.readString():c===4?n.tileSize=a.readVarint():c===5?n.buffer=a.readVarint():c===6?n.pixelFormat=a.readVarint():c===7&&n.dataIndex.push(function(h,v){return h.readFields(SF,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},v)}(a,a.readVarint()+a.pos))}function CF(c,n,a){if(c===2)(function(h,v,f){h.readFields(EF,f,v)})(a,a.readVarint()+a.pos,n);else if(c===3)throw new Error("Not implemented")}function EF(c,n,a){if(c===1){let h=0;const v=a.readVarint()+a.pos;for(;a.pos<v;)n[h++]=a.readVarint()}}function MF(c,n){if(n.length!==4)throw new Error(`Expected data of dimension 4 but got ${n.length}.`);let a=n[3];for(let h=2;h>=1;h--){const v=h===1?1:0,f=h===2?1:0;for(let x=0;x<n[0];x++){const P=n[1]*x;for(let L=v;L<n[1];L++){const N=n[2]*(L+P);for(let I=f;I<n[2];I++){const z=n[3]*(I+N);for(let F=0;F<n[3];F++){const R=z+F;c[R]+=c[R-a]}}}}a*=n[h]}return c}function IF(c){for(let n=0,a=c.length;n<a;n++)c[n]=c[n]>>>1^-(1&c[n]);return c}function PF(c,n){switch(n){case"uint32":return c;case"uint16":for(let a=0;a<c.length;a+=2){const h=c[a],v=c[a+1];c[a]=(240&h)>>4|(61440&h)>>8|(240&v)<<4|61440&v,c[a+1]=15&h|(3840&h)>>4|(15&v)<<8|(3840&v)<<4}return c;case"uint8":for(let a=0;a<c.length;a+=4){const h=c[a],v=c[a+1],f=c[a+2],x=c[a+3];c[a+0]=(192&h)>>6|(192&v)>>4|(192&f)>>2|192&x,c[a+1]=(48&h)>>4|(48&v)>>2|48&f|(48&x)<<2,c[a+2]=(12&h)>>2|12&v|(12&f)<<2|(12&x)<<4,c[a+3]=3&h|(3&v)<<2|(3&f)<<4|(3&x)<<6}return c;default:throw new Error(`Invalid pixel format, "${n}"`)}}ki(z0,"DEMData"),ki(FM,"DemMinMaxQuadTree",{omit:["dem"]});var Nh=Uint8Array,px=Uint16Array,AF=Int32Array,VM=new Nh([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),NM=new Nh([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),kF=new Nh([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),jM=function(c,n){for(var a=new px(31),h=0;h<31;++h)a[h]=n+=1<<c[h-1];var v=new AF(a[30]);for(h=1;h<30;++h)for(var f=a[h];f<a[h+1];++f)v[f]=f-a[h]<<5|h;return{b:a,r:v}},UM=jM(VM,2),$M=UM.b,DF=UM.r;$M[28]=258,DF[258]=28;for(var RF=jM(NM,0).b,GM=new px(32768),co=0;co<32768;++co){var Ly=(43690&co)>>1|(21845&co)<<1;GM[co]=((65280&(Ly=(61680&(Ly=(52428&Ly)>>2|(13107&Ly)<<2))>>4|(3855&Ly)<<4))>>8|(255&Ly)<<8)>>1}var mx=function(c,n,a){for(var h=c.length,v=0,f=new px(n);v<h;++v)c[v]&&++f[c[v]-1];var x,P=new px(n);for(v=1;v<n;++v)P[v]=P[v-1]+f[v-1]<<1;x=new px(1<<n);var L=15-n;for(v=0;v<h;++v)if(c[v])for(var N=v<<4|c[v],I=n-c[v],z=P[c[v]-1]++<<I,F=z|(1<<I)-1;z<=F;++z)x[GM[z]>>L]=N;return x},gx=new Nh(288);for(co=0;co<144;++co)gx[co]=8;for(co=144;co<256;++co)gx[co]=9;for(co=256;co<280;++co)gx[co]=7;for(co=280;co<288;++co)gx[co]=8;var qM=new Nh(32);for(co=0;co<32;++co)qM[co]=5;var LF=mx(gx,9),zF=mx(qM,5),pS=function(c){for(var n=c[0],a=1;a<c.length;++a)c[a]>n&&(n=c[a]);return n},kf=function(c,n,a){var h=n/8|0;return(c[h]|c[h+1]<<8)>>(7&n)&a},mS=function(c,n){var a=n/8|0;return(c[a]|c[a+1]<<8|c[a+2]<<16)>>(7&n)},OF=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Df=function(c,n,a){var h=new Error(n||OF[c]);if(h.code=c,Error.captureStackTrace&&Error.captureStackTrace(h,Df),!a)throw h;return h},FF=new Nh(0),BF=typeof TextDecoder<"u"&&new TextDecoder;try{BF.decode(FF,{stream:!0})}catch{}const VF={gzip_data:"gzip"};class Rd extends Error{constructor(n){super(n),this.name="MRTError"}}const NF={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},HM={uint32:1,uint16:2,uint8:4},jF={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let gS;class _S{constructor(n=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=n}getLayer(n){const a=this.layers[n];if(!a)throw new Rd(`Layer '${n}' not found`);return a}getHeaderLength(n){const a=new Uint8Array(n),h=new DataView(n);if(a[0]!==13)throw new Rd("File is not a valid MRT.");return h.getUint32(1,!0)}parseHeader(n){const a=new Uint8Array(n),h=this.getHeaderLength(n);if(a.length<h)throw new Rd(`Expected header with length >= ${h} but got buffer of length ${a.length}`);const v=function(f,x){return f.readFields(vF,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new gS(a.subarray(0,h)));if(!isNaN(this.x)&&(this.x!==v.x||this.y!==v.y||this.z!==v.z))throw new Rd(`Invalid attempt to parse header ${v.z}/${v.x}/${v.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=v.x,this.y=v.y,this.z=v.z;for(const f of v.layers)this.layers[f.name]=new UF(f,{cacheSize:this._cacheSize});return this}createDecodingTask(n){const a=[],h=this.getLayer(n.layerName);for(let v of n.blockIndices){const f=h.dataIndex[v],x=f.firstByte-n.firstByte,P=f.lastByte-n.firstByte;if(h._blocksInProgress.has(v))continue;const L={layerName:h.name,firstByte:x,lastByte:P,pixelFormat:h.pixelFormat,blockIndex:v,blockShape:[f.bands.length].concat(h.bandShape),buffer:h.buffer,codec:f.codec.codec,filters:f.filters.map(N=>N.filter)};h._blocksInProgress.add(v),a.push(L)}return new ZM(a,()=>{a.forEach(v=>h._blocksInProgress.delete(v.blockIndex))},(v,f)=>{if(a.forEach(x=>h._blocksInProgress.delete(x.blockIndex)),v)throw v;f.forEach(x=>{this.getLayer(x.layerName).processDecodedData(x)})})}}class UF{constructor({version:n,name:a,units:h,tileSize:v,pixelFormat:f,buffer:x,dataIndex:P},L){if(this.version=n,this.version!==1)throw new Rd(`Cannot parse raster layer encoded with MRT version ${n}`);this.name=a,this.units=h,this.tileSize=v,this.buffer=x,this.pixelFormat=NF[f],this.dataIndex=P,this.bandShape=[v+2*x,v+2*x,HM[this.pixelFormat]],this._decodedBlocks=new dS(L?L.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return HM[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:n})=>n).flat()}processDecodedData(n){const a=n.blockIndex.toString();this._decodedBlocks.get(a)||this._decodedBlocks.put(a,n.data)}getBlockForBand(n){let a=0;switch(typeof n){case"string":for(const[h,v]of this.dataIndex.entries()){for(const[f,x]of v.bands.entries())if(x===n)return{bandIndex:a+f,blockIndex:h,blockBandIndex:f};a+=v.bands.length}break;case"number":for(const[h,v]of this.dataIndex.entries()){if(n>=a&&n<a+v.bands.length)return{bandIndex:n,blockIndex:h,blockBandIndex:n-a};a+=v.bands.length}break;default:throw new Rd(`Invalid band \`${JSON.stringify(n)}\`. Expected string or integer.`)}throw new Rd(`Band not found: ${JSON.stringify(n)}`)}getDataRange(n){let a=1/0,h=-1/0;const v=[],f=new Set;for(const x of n){const{blockIndex:P}=this.getBlockForBand(x);if(P<0)throw new Rd(`Invalid band: ${JSON.stringify(x)}`);const L=this.dataIndex[P];v.includes(P)||v.push(P),f.add(P),a=Math.min(a,L.firstByte),h=Math.max(h,L.lastByte)}if(f.size>this.cacheSize)throw new Rd(`Number of blocks to decode (${f.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:a,lastByte:h,blockIndices:v}}hasBand(n){const{blockIndex:a}=this.getBlockForBand(n);return a>=0}hasDataForBand(n){const{blockIndex:a}=this.getBlockForBand(n);return a>=0&&!!this._decodedBlocks.get(a.toString())}getBandView(n){const{blockIndex:a,blockBandIndex:h}=this.getBlockForBand(n),v=this._decodedBlocks.get(a.toString());if(!v)throw new Rd(`Data for band ${JSON.stringify(n)} of layer "${this.name}" not decoded.`);const f=this.dataIndex[a],x=this.bandShape.reduce((N,I)=>N*I,1),P=h*x,L=v.subarray(P,P+x);return{data:L,bytes:new Uint8Array(L.buffer).subarray(L.byteOffset,L.byteOffset+L.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:f.offset,scale:f.scale}}}_S.setPbf=function(c){gS=c};class ZM{constructor(n,a,h){this.tasks=n,this._onCancel=a,this._onComplete=h,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(n,a){this._finalized||(this._onComplete(n,a),this._finalized=!0)}}_S.performDecoding=function(c,n){const a=new Uint8Array(c);return Promise.all(n.tasks.map(h=>{const{layerName:v,firstByte:f,lastByte:x,pixelFormat:P,blockShape:L,blockIndex:N,filters:I,codec:z}=h,F=a.subarray(f,x+1),R=new Uint32Array(L[0]*L[1]*L[2]);let O;if(z!=="gzip_data")throw new Rd(`Unhandled codec: ${z}`);return O=function(q,te){if(!globalThis.DecompressionStream&&te==="gzip_data")return Promise.resolve(((he=function(Ae){Ae[0]==31&&Ae[1]==139&&Ae[2]==8||Df(6,"invalid gzip data");var tt=Ae[3],Ke=10;4&tt&&(Ke+=2+(Ae[10]|Ae[11]<<8));for(var Ye=(tt>>3&1)+(tt>>4&1);Ye>0;Ye-=!Ae[Ke++]);return Ke+(2&tt)}(_e=q))+8>_e.length&&Df(6,"invalid gzip data"),function(Ae,tt,Ke,Ye){var Ct=Ae.length;if(!Ct||tt.f&&!tt.l)return Ke||new Nh(0);var ct=!Ke,It=ct||tt.i!=2,Rt=tt.i;ct&&(Ke=new Nh(3*Ct));var At,Vt,Wt=function(xm){var _g=Ke.length;if(xm>_g){var yg=new Nh(Math.max(2*_g,xm));yg.set(Ke),Ke=yg}},Kt=tt.f||0,qt=tt.p||0,yn=tt.b||0,Yn=tt.l,xn=tt.d,di=tt.m,ci=tt.n,Ti=8*Ct;do{if(!Yn){Kt=kf(Ae,qt,1);var In=kf(Ae,qt+1,3);if(qt+=3,!In){var ji=Ae[(fr=4+((qt+7)/8|0))-4]|Ae[fr-3]<<8,gi=fr+ji;if(gi>Ct){Rt&&Df(0);break}It&&Wt(yn+ji),Ke.set(Ae.subarray(fr,gi),yn),tt.b=yn+=ji,tt.p=qt=8*gi,tt.f=Kt;continue}if(In==1)Yn=LF,xn=zF,di=9,ci=5;else if(In==2){var Oi=kf(Ae,qt,31)+257,rr=kf(Ae,qt+10,15)+4,wr=Oi+kf(Ae,qt+5,31)+1;qt+=14;for(var Ir=new Nh(wr),Fr=new Nh(19),Pr=0;Pr<rr;++Pr)Fr[kF[Pr]]=kf(Ae,qt+3*Pr,7);qt+=3*rr;var qr=pS(Fr),Aa=(1<<qr)-1,ya=mx(Fr,qr);for(Pr=0;Pr<wr;){var fr,va=ya[kf(Ae,qt,Aa)];if(qt+=15&va,(fr=va>>4)<16)Ir[Pr++]=fr;else{var ma=0,ka=0;for(fr==16?(ka=3+kf(Ae,qt,3),qt+=2,ma=Ir[Pr-1]):fr==17?(ka=3+kf(Ae,qt,7),qt+=3):fr==18&&(ka=11+kf(Ae,qt,127),qt+=7);ka--;)Ir[Pr++]=ma}}var uo=Ir.subarray(0,Oi),ho=Ir.subarray(Oi);di=pS(uo),ci=pS(ho),Yn=mx(uo,di),xn=mx(ho,ci)}else Df(1);if(qt>Ti){Rt&&Df(0);break}}It&&Wt(yn+131072);for(var Us=(1<<di)-1,Wc=(1<<ci)-1,as=qt;;as=qt){var ds=(ma=Yn[mS(Ae,qt)&Us])>>4;if((qt+=15&ma)>Ti){Rt&&Df(0);break}if(ma||Df(2),ds<256)Ke[yn++]=ds;else{if(ds==256){as=qt,Yn=null;break}var Ic=ds-254;ds>264&&(Ic=kf(Ae,qt,(1<<(No=VM[Pr=ds-257]))-1)+$M[Pr],qt+=No);var fo=xn[mS(Ae,qt)&Wc],Mu=fo>>4;if(fo||Df(3),qt+=15&fo,ho=RF[Mu],Mu>3){var No=NM[Mu];ho+=mS(Ae,qt)&(1<<No)-1,qt+=No}if(qt>Ti){Rt&&Df(0);break}It&&Wt(yn+131072);var Rp=yn+Ic;if(yn<ho){var mg=0-ho,gg=Math.min(ho,Rp);for(mg+yn<0&&Df(3);yn<gg;++yn)Ke[yn]=(void 0)[mg+yn]}for(;yn<Rp;++yn)Ke[yn]=Ke[yn-ho]}}tt.l=Yn,tt.p=as,tt.b=yn,tt.f=Kt,Yn&&(Kt=1,tt.m=di,tt.d=xn,tt.n=ci)}while(!Kt);return yn!=Ke.length&&ct?(At=Ke,((Vt=yn)==null||Vt>At.length)&&(Vt=At.length),new Nh(At.subarray(0,Vt))):Ke.subarray(0,yn)}(_e.subarray(he,-8),{i:2},new Nh(((ae=_e)[(ge=ae.length)-4]|ae[ge-3]<<8|ae[ge-2]<<16|ae[ge-1]<<24)>>>0))));var ae,ge,_e,he;const xe=VF[te];if(!xe)throw new Error(`Unhandled codec: ${te}`);const Te=new globalThis.DecompressionStream(xe);return new Response(new Blob([q]).stream().pipeThrough(Te)).arrayBuffer().then(Ae=>new Uint8Array(Ae))}(F,z).then(q=>(function(te,ae){te.readFields(CF,ae)}(new gS(q),R),new jF[P](R.buffer))),O.then(q=>{for(let te=I.length-1;te>=0;te--)switch(I[te]){case"delta_filter":MF(q,L);break;case"zigzag_filter":IF(q);break;case"bitshuffle_filter":PF(q,P);break;default:throw new Rd(`Unhandled filter "${I[te]}"`)}return{layerName:v,blockIndex:N,data:q}}).catch(q=>{throw q})}))},ki(ZM,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]});let _x,yS,Rf,zy,vS,Oy=null;function WM(){return kn()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:yS||Ze.DRACO_URL}function XM(){if(kn()&&self.worker&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(zy)return zy;const c=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return zy=WebAssembly.validate(c)?Ze.MESHOPT_SIMD_URL:Ze.MESHOPT_URL,zy}const O0={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},$F={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},yx={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function YM(c,n,a){const h=a.json.bufferViews.length,v=a.buffers.length;n.bufferView=h,a.json.bufferViews[h]={buffer:v,byteLength:c.byteLength},a.buffers[v]=c}const xS="KHR_draco_mesh_compression";function GF(c,n){const a=c.extensions&&c.extensions[xS];if(!a)return;const h=new Rf.Decoder,v=eI(n,a.bufferView),f=new Rf.Mesh;if(!h.DecodeArrayToMesh(v,v.byteLength,f))throw new Error("Failed to decode Draco mesh");const x=n.json.accessors[c.indices],P=O0[x.componentType],L=x.count*P.BYTES_PER_ELEMENT,N=Rf._malloc(L);P===Uint16Array?h.GetTrianglesUInt16Array(f,L,N):h.GetTrianglesUInt32Array(f,L,N),YM(Rf.memory.buffer.slice(N,N+L),x,n),Rf._free(N);for(const I of Object.keys(a.attributes)){const z=h.GetAttributeByUniqueId(f,a.attributes[I]),F=n.json.accessors[c.attributes[I]],R=$F[F.componentType],O=F.count*yx[F.type]*O0[F.componentType].BYTES_PER_ELEMENT,q=Rf._malloc(O);h.GetAttributeDataArrayForAllPoints(f,z,Rf[R],O,q),YM(Rf.memory.buffer.slice(q,q+O),F,n),Rf._free(q)}h.destroy(),f.destroy(),delete c.extensions[xS]}const F0="EXT_meshopt_compression";function qF(c,n){if(!c.extensions||!c.extensions[F0])return;const a=c.extensions[F0],h=new Uint8Array(n.buffers[a.buffer],a.byteOffset||0,a.byteLength||0),v=new Uint8Array(a.count*a.byteStride);vS.decodeGltfBuffer(v,a.count,a.byteStride,h,a.mode,a.filter),c.buffer=n.buffers.length,c.byteOffset=0,n.buffers[c.buffer]=v.buffer,delete c.extensions[F0]}const KM=1179937895,JM=new TextDecoder("utf8");function QM(c,n){return new URL(c,n).href}function HF(c,n,a,h){return fetch(QM(c.uri,h)).then(v=>v.arrayBuffer()).then(v=>{n.buffers[a]=v})}function eI(c,n){const a=c.json.bufferViews[n];return new Uint8Array(c.buffers[a.buffer],a.byteOffset||0,a.byteLength)}function ZF(c,n,a,h){if(c.uri){const v=QM(c.uri,h);return fetch(v).then(f=>f.blob()).then(f=>createImageBitmap(f)).then(f=>{n.images[a]=f})}if(c.bufferView!==void 0){const v=eI(n,c.bufferView),f=new Blob([v],{type:c.mimeType});return createImageBitmap(f).then(x=>{n.images[a]=x})}}function tI(c,n=0,a){const h={json:null,images:[],buffers:[]};if(new Uint32Array(c,n,1)[0]===KM){const I=new Uint32Array(c,n);let z=2;const F=(I[z++]>>2)-3,R=I[z++]>>2;if(z++,h.json=JSON.parse(JM.decode(I.subarray(z,z+R))),z+=R,z<F){const O=I[z++];z++;const q=n+(z<<2);h.buffers[0]=c.slice(q,q+O)}}else h.json=JSON.parse(JM.decode(new Uint8Array(c,n)));const{buffers:v,images:f,meshes:x,extensionsUsed:P,bufferViews:L}=h.json;let N=Promise.resolve();if(v){const I=[];for(let z=0;z<v.length;z++){const F=v[z];F.uri?I.push(HF(F,h,z,a)):h.buffers[z]||(h.buffers[z]=null)}N=Promise.all(I)}return N.then(()=>{const I=[],z=P&&P.includes(xS),F=P&&P.includes(F0);if(z&&I.push(function(){if(!Rf)return _x??(_x=function(R){let O,q=null;function te(){O=new Uint8Array(q.buffer)}function ae(){throw new Error("Unexpected Draco error.")}const ge={a:{a:ae,d:function(_e,he,xe){return O.copyWithin(_e,he,he+xe)},c:function(_e){const he=O.length,xe=Math.max(_e>>>0,Math.ceil(1.2*he)),Te=Math.ceil((xe-he)/65536);try{return q.grow(Te),te(),!0}catch{return!1}},b:ae}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(R,ge):R.then(_e=>_e.arrayBuffer()).then(_e=>WebAssembly.instantiate(_e,ge))).then(_e=>{const{Rb:he,Qb:xe,P:Te,T:Ae,X:tt,Ja:Ke,La:Ye,Qa:Ct,Va:ct,Wa:It,eb:Rt,jb:At,f:Vt,e:Wt,yb:Kt,zb:qt,Ab:yn,Bb:Yn,Db:xn,Gb:di}=_e.instance.exports;q=Wt;const ci=(()=>{let Ti=0,In=0,ji=0,gi=0;return Oi=>{ji&&(he(gi),he(Ti),In+=ji,ji=Ti=0),Ti||(In+=128,Ti=xe(In));const rr=Oi.length+7&-8;let wr=Ti;rr>=In&&(ji=rr,wr=gi=xe(rr));for(let Ir=0;Ir<Oi.length;Ir++)O[wr+Ir]=Oi[Ir];return wr}})();return te(),Vt(),{memory:Wt,_free:he,_malloc:xe,Mesh:class{constructor(){this.ptr=Te()}destroy(){Ae(this.ptr)}},Decoder:class{constructor(){this.ptr=Ke()}destroy(){At(this.ptr)}DecodeArrayToMesh(Ti,In,ji){const gi=ci(Ti),Oi=Ye(this.ptr,gi,In,ji.ptr);return!!tt(Oi)}GetAttributeByUniqueId(Ti,In){return{ptr:Ct(this.ptr,Ti.ptr,In)}}GetTrianglesUInt16Array(Ti,In,ji){ct(this.ptr,Ti.ptr,In,ji)}GetTrianglesUInt32Array(Ti,In,ji){It(this.ptr,Ti.ptr,In,ji)}GetAttributeDataArrayForAllPoints(Ti,In,ji,gi,Oi){Rt(this.ptr,Ti.ptr,In.ptr,ji,gi,Oi)}},DT_INT8:Kt(),DT_UINT8:qt(),DT_INT16:yn(),DT_UINT16:Yn(),DT_UINT32:xn(),DT_FLOAT32:di()}})}(fetch(WM())),_x.then(R=>{Rf=R,_x=void 0}))}()),F&&I.push(function(){if(vS)return;const R=function(O){let q;const te=WebAssembly.instantiateStreaming(O,{}).then(_e=>{q=_e.instance,q.exports.__wasm_call_ctors()}),ae={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ge={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:te,supported:!0,decodeGltfBuffer(_e,he,xe,Te,Ae,tt){(function(Ke,Ye,Ct,ct,It,Rt,At){const Vt=Ke.exports.sbrk,Wt=ct+3&-4,Kt=Vt(Wt*It),qt=Vt(Rt.length),yn=new Uint8Array(Ke.exports.memory.buffer);yn.set(Rt,qt);const Yn=Ye(Kt,ct,It,qt,Rt.length);if(Yn===0&&At&&At(Kt,Wt,It),Ct.set(yn.subarray(Kt,Kt+ct*It)),Vt(Kt-Vt(0)),Yn!==0)throw new Error(`Malformed buffer data: ${Yn}`)})(q,q.exports[ge[Ae]],_e,he,xe,Te,q.exports[ae[tt]])}}}(fetch(XM()));return R.ready.then(()=>{vS=R})}()),f)for(let R=0;R<f.length;R++)I.push(ZF(f[R],h,R,a));return(I.length?Promise.all(I):Promise.resolve()).then(()=>{if(z&&x)for(const{primitives:R}of x)for(const O of R)GF(O,h);if(F&&x&&L)for(const R of L)qF(R,h);return h})})}function y_(c,n){const a=c.json.bufferViews[n.bufferView],h=O0[n.componentType];return new h(c.buffers[a.buffer],(n.byteOffset||0)+(a.byteOffset||0),n.count*(a.byteStride&&a.byteStride!==yx[n.type]*h.BYTES_PER_ELEMENT?a.byteStride/h.BYTES_PER_ELEMENT:yx[n.type]))}function bS(c,n,a,h){const v=O0[n.componentType],f=function(I){switch(I){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(v),x=c.json.bufferViews[n.bufferView],P=x.byteStride?x.byteStride/v.BYTES_PER_ELEMENT:yx[n.type],L=a.float32,N=L.length/a.capacity;for(let I=0,z=0;I<n.count*P;I+=P,z+=N)for(let F=0;F<N;F++)L[z+F]=h[I+F]*f;a._trim()}function WF(c,n,a){const h=c.indices,v=c.attributes,f={};f.indexArray=new Wr;const x=n.json.accessors[h],P=x.count/3;f.indexArray.reserve(P);const L=y_(n,x);for(let F=0;F<P;F++)f.indexArray.emplaceBack(L[3*F],L[3*F+1],L[3*F+2]);f.indexArray._trim(),f.vertexArray=new jn;const N=n.json.accessors[v.POSITION];f.vertexArray.reserve(N.count);const I=y_(n,N);for(let F=0;F<N.count;F++)f.vertexArray.emplaceBack(I[3*F],I[3*F+1],I[3*F+2]);if(f.vertexArray._trim(),f.aabb=new nr(N.min,N.max),f.centroid=function(F,R){const O=[0,0,0],q=F.length;if(q>0){for(let te=0;te<q;te++){const ae=3*F[te];O[0]+=R[ae],O[1]+=R[ae+1],O[2]+=R[ae+2]}O[0]/=q,O[1]/=q,O[2]/=q}return O}(L,I),v.COLOR_0!==void 0){const F=n.json.accessors[v.COLOR_0],R=yx[F.type],O=y_(n,F);f.colorArray=R===3?new jn:new ei,f.colorArray.resize(F.count),bS(n,F,f.colorArray,O)}if(v.NORMAL!==void 0){f.normalArray=new jn;const F=n.json.accessors[v.NORMAL];f.normalArray.resize(F.count);const R=y_(n,F);bS(n,F,f.normalArray,R)}if(v.TEXCOORD_0!==void 0&&a.length>0){f.texcoordArray=new rl;const F=n.json.accessors[v.TEXCOORD_0];f.texcoordArray.resize(F.count);const R=y_(n,F);bS(n,F,f.texcoordArray,R)}if(v._FEATURE_ID_RGBA4444!==void 0){const F=n.json.accessors[v._FEATURE_ID_RGBA4444];n.json.extensionsUsed&&n.json.extensionsUsed.includes("EXT_meshopt_compression")&&(f.featureData=y_(n,F))}v._FEATURE_RGBA4444!==void 0&&(f.featureData=new Uint32Array(y_(n,n.json.accessors[v._FEATURE_RGBA4444]).buffer));const z=c.material;return f.material=function(F,R){const{emissiveFactor:O=[0,0,0],alphaMode:q="OPAQUE",alphaCutoff:te=.5,normalTexture:ae,occlusionTexture:ge,emissiveTexture:_e,doubleSided:he}=F,{baseColorFactor:xe=[1,1,1,1],metallicFactor:Te=1,roughnessFactor:Ae=1,baseColorTexture:tt,metallicRoughnessTexture:Ke}=F.pbrMetallicRoughness||{},Ye=ge?R[ge.index]:void 0;if(ge&&ge.extensions&&ge.extensions.KHR_texture_transform&&Ye){const Ct=ge.extensions.KHR_texture_transform;Ye.offsetScale=[Ct.offset[0],Ct.offset[1],Ct.scale[0],Ct.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Or(...xe),metallicFactor:Te,roughnessFactor:Ae,baseColorTexture:tt?R[tt.index]:void 0,metallicRoughnessTexture:Ke?R[Ke.index]:void 0},doubleSided:he,emissiveFactor:O,alphaMode:q,alphaCutoff:te,normalTexture:ae?R[ae.index]:void 0,occlusionTexture:Ye,emissionTexture:_e?R[_e.index]:void 0,defined:F.defined===void 0}}(z!==void 0?n.json.materials[z]:{defined:!1},a),f}function nI(c,n,a){const{matrix:h,rotation:v,translation:f,scale:x,mesh:P,extras:L,children:N}=c,I={};if(I.matrix=h||ht.mat4.fromRotationTranslationScale([],v||[0,0,0,1],f||[0,0,0],x||[1,1,1]),P!==void 0){I.meshes=a[P];const z=I.anchor=[0,0];for(const F of I.meshes){const{min:R,max:O}=F.aabb;z[0]+=R[0]+O[0],z[1]+=R[1]+O[1]}z[0]=Math.floor(z[0]/I.meshes.length/2),z[1]=Math.floor(z[1]/I.meshes.length/2)}if(L&&(L.id&&(I.id=L.id),L.lights&&(I.lights=function(z){if(!z.length)return[];const F=function(ae){const ge=atob(ae),_e=new Uint8Array(ge.length);for(let he=0;he<ge.length;he++)_e[he]=ge.codePointAt(he);return _e}(z),R=[],O=F.length/24,q=new Uint16Array(F.buffer),te=new Float32Array(F.buffer);for(let ae=0;ae<O;ae++){const ge=q[2*ae*6]/30,_e=q[2*ae*6+1]/30,he=q[2*ae*6+10]/100,xe=te[6*ae+1],Te=te[6*ae+2],Ae=te[6*ae+3],tt=te[6*ae+4],Ke=Ae-xe,Ye=tt-Te,Ct=Math.hypot(Ke,Ye);R.push({pos:[xe+.5*Ke,Te+.5*Ye,_e],normal:[Ye/Ct,-Ke/Ct,0],width:Ct,height:ge,depth:he,points:[xe,Te,Ae,tt]})}return R}(L.lights))),N){const z=[];for(const F of N)z.push(nI(n.json.nodes[F],n,a));I.children=z}return I}function XF(c){if(c.vertices.length===0||c.indices.length===0)return null;const n=new gy(c.vertices,c.indices,8,256),[a,h]=[n.min.clone(),n.max.clone()];return{vertices:c.vertices,indices:c.indices,grid:n,min:a,max:h}}function YF(c){if(!c.extras||!c.extras.ground)return null;const n=c.extras.ground;if(!n||!Array.isArray(n)||n.length===0)return null;const a=n[0];if(!a||!Array.isArray(a)||a.length===0)return null;const h=[];for(const x of a){if(!Array.isArray(x)||x.length!==2)continue;const P=x[0],L=x[1];typeof P=="number"&&typeof L=="number"&&h.push(new at(P,L))}if(h.length<3)return null;h.length>1&&h[h.length-1].equals(h[0])&&h.pop();let v=0;for(let x=0;x<h.length;x++){const P=h[x],L=h[(x+1)%h.length],N=h[(x+2)%h.length];v+=(P.x-L.x)*(N.y-L.y)-(N.x-L.x)*(P.y-L.y)}v>0&&h.reverse();const f=Qg(h.flatMap(x=>[x.x,x.y]),[]);return f.length===0?null:{vertices:h,indices:f}}function KF(c,n){const a=[],h=[];let v=0;const f=[];for(const x of c){v=a.length;const P=x.vertexArray.float32,L=x.indexArray.uint16;for(let N=0;N<x.vertexArray.length;N++)f[0]=P[3*N+0],f[1]=P[3*N+1],f[2]=P[3*N+2],ht.vec3.transformMat4(f,f,n),a.push(new at(f[0],f[1]));for(let N=0;N<3*x.indexArray.length;N++)h.push(L[N]+v)}if(h.length%3!=0)return null;for(let x=0;x<h.length;x+=3){const P=a[h[x+0]],L=a[h[x+1]],N=a[h[x+2]];(P.x-L.x)*(N.y-L.y)-(N.x-L.x)*(P.y-L.y)>0&&([h[x+1],h[x+2]]=[h[x+2],h[x+1]])}return{vertices:a,indices:h}}function iI(c){const n=function(L,N){const I=[],z=WebGL2RenderingContext;if(L.json.textures)for(const F of L.json.textures){const R={magFilter:z.LINEAR,minFilter:z.NEAREST,wrapS:z.REPEAT,wrapT:z.REPEAT};F.sampler!==void 0&&Object.assign(R,L.json.samplers[F.sampler]),I.push({image:N[F.source],sampler:R,uploaded:!1})}return I}(c,c.images),a=function(L,N){const I=[];for(const z of L.json.meshes){const F=[];for(const R of z.primitives)F.push(WF(R,L,N));I.push(F)}return I}(c,n),{scenes:h,scene:v,nodes:f}=c.json,x=h?h[v||0].nodes:f,P=[];for(const L of x)P.push(nI(f[L],c,a));return function(L,N,I){const z={},F=new Set;for(let R=0;R<L.length;R++){const O=I[N[R]];if(!O.extras)continue;const q=O.extras["mapbox:footprint:version"],te=O.extras["mapbox:footprint:id"];(q||te)&&F.add(R),q==="1.0.0"&&te&&(z[te]=R)}for(let R=0;R<L.length;R++){if(F.has(R))continue;const O=L[R],q=I[N[R]];if(!q.extras)continue;let te=null;O.id in z&&(te=KF(L[z[O.id]].meshes,O.matrix)),te||(te=YF(q)),te&&(O.footprint=XF(te))}if(F.size>0){const R=Array.from(F.values()).sort((O,q)=>O-q);for(let O=R.length-1;O>=0;O--)L.splice(R[O],1)}}(P,x,c.json.nodes),P}function JF(c){c.heightmap=new Float32Array(4096),c.heightmap.fill(-1);const n=c.vertexArray.float32,a=c.aabb.min[0]-1,h=c.aabb.min[1]-1,v=m_/(c.aabb.max[0]-a+2),f=m_/(c.aabb.max[1]-h+2);for(let x=0;x<n.length;x+=3){const P=n[x+2],L=(n[x+0]-a)*v|0,N=(n[x+1]-h)*f|0;P>c.heightmap[N*m_+L]&&(c.heightmap[N*m_+L]=P)}}function QF(c,n){const a={};a.indexArray=new Wr,a.indexArray.reserve(4*c.length),a.vertexArray=new jn,a.vertexArray.reserve(10*c.length),a.colorArray=new ei,a.vertexArray.reserve(10*c.length);let h=0;for(const x of c){const P=Math.min(10,Math.max(4,1.3*x.height))*n,L=[-x.normal[1],x.normal[0],0],N=Math.min(.29,.1*x.width/x.depth),I=x.width-2*x.depth*n*(N+.01),z=ht.vec3.scaleAndAdd([],x.pos,L,I/2),F=ht.vec3.scaleAndAdd([],x.pos,L,-I/2),R=[z[0],z[1],z[2]+x.height],O=[F[0],F[1],F[2]+x.height],q=ht.vec3.scaleAndAdd([],x.normal,L,N);ht.vec3.scale(q,q,P);const te=ht.vec3.scaleAndAdd([],x.normal,L,-N);ht.vec3.scale(te,te,P),ht.vec3.add(q,z,q),ht.vec3.add(te,F,te),z[2]+=.1,F[2]+=.1,a.vertexArray.emplaceBack(q[0],q[1],q[2]),a.vertexArray.emplaceBack(te[0],te[1],te[2]),a.vertexArray.emplaceBack(z[0],z[1],z[2]),a.vertexArray.emplaceBack(F[0],F[1],F[2]),a.vertexArray.emplaceBack(R[0],R[1],R[2]),a.vertexArray.emplaceBack(O[0],O[1],O[2]),a.vertexArray.emplaceBack(z[0],z[1],z[2]),a.vertexArray.emplaceBack(F[0],F[1],F[2]),a.vertexArray.emplaceBack(q[0],q[1],q[2]),a.vertexArray.emplaceBack(te[0],te[1],te[2]);const ae=I/P/2;a.colorArray.emplaceBack(-ae-N,-1,ae,.8),a.colorArray.emplaceBack(ae+N,-1,ae,.8),a.colorArray.emplaceBack(-ae,0,ae,1.3),a.colorArray.emplaceBack(ae,0,ae,1.3),a.colorArray.emplaceBack(ae+N,-.8,ae,.7),a.colorArray.emplaceBack(ae+N,-.8,ae,.7),a.colorArray.emplaceBack(0,0,ae,1.3),a.colorArray.emplaceBack(0,0,ae,1.3),a.colorArray.emplaceBack(ae+N,-1.2,ae,.8),a.colorArray.emplaceBack(ae+N,-1.2,ae,.8),a.indexArray.emplaceBack(6+h,4+h,8+h),a.indexArray.emplaceBack(7+h,9+h,5+h),a.indexArray.emplaceBack(0+h,1+h,2+h),a.indexArray.emplaceBack(1+h,3+h,2+h),h+=10}const v={defined:!0,emissiveFactor:[0,0,0]},f={};return f.baseColorFactor=Or.white,v.pbrMetallicRoughness=f,a.material=v,a.aabb=new nr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),a}class rI{constructor(n){this._stringToNumber={},this._numberToString=[];for(let a=0;a<n.length;a++){const h=n[a];this._stringToNumber[h]=a,this._numberToString[a]=h}}encode(n){return this._stringToNumber[n]}decode(n){return this._numberToString[n]}}const eB=["id","tile","layer","source","sourceLayer","state"];class Fy{constructor(n,a,h,v,f){this.type="Feature",this._vectorTileFeature=n,this._z=a,this._x=h,this._y=v,this.properties=n.properties,this.id=f}clone(){const n=new Fy(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(n.state={...this.state}),this.layer&&(n.layer={...this.layer}),this.source&&(n.source=this.source),this.sourceLayer&&(n.sourceLayer=this.sourceLayer),n}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(n){this._geometry=n}toJSON(){const n={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const a of eB)this[a]!==void 0&&(n[a]=this[a]);return n}}class aI{constructor(n,a){this.tileID=n,this.x=n.canonical.x,this.y=n.canonical.y,this.z=n.canonical.z,this.grid=new Rh(mi,16,0),this.featureIndexArray=new wc,this.promoteId=a,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(n,a,h,v,f,x=0,P=0){const L=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(h,v,f,x);const N=this.grid;for(let I=0;I<a.length;I++){const z=a[I],F=[1/0,1/0,-1/0,-1/0];for(let R=0;R<z.length;R++){const O=z[R];F[0]=Math.min(F[0],O.x),F[1]=Math.min(F[1],O.y),F[2]=Math.max(F[2],O.x),F[3]=Math.max(F[3],O.y)}P!==0&&(F[0]-=P,F[1]-=P,F[2]+=P,F[3]+=P),F[0]<mi&&F[1]<mi&&F[2]>=0&&F[3]>=0&&N.insert(L,F[0],F[1],F[2],F[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new pm.VectorTile(new d_(this.rawTileData)).layers,this.sourceLayerCoder=new rI(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const n in this.vtLayers)this.vtFeatures[n]=[]}return this.vtLayers}query(n,a){const{tilespaceGeometry:h,transform:v,tileTransform:f,pixelPosMatrix:x,availableImages:P}=a;this.loadVTLayers(),this.serializedLayersCache.clear();const L=h.bufferedTilespaceBounds,N=this.grid.query(L.min.x,L.min.y,L.max.x,L.max.y,(R,O,q,te)=>Ft(h.bufferedTilespaceGeometry,R,O,q,te));N.sort(tB);let I=null;v.elevation&&N.length>0&&(I=Ay.create(v.elevation,this.tileID));const z={};let F;for(let R=0;R<N.length;R++){const O=N[R];if(O===F)continue;F=O;const q=this.featureIndexArray.get(O);let te=null;this.is3DTile?this.loadMatchingModelFeature(z,q,n,h,v):this.loadMatchingFeature(z,q,n,P,(ae,ge,_e,he=0)=>(te||(te=se(ae,this.tileID.canonical,f)),ge.queryIntersectsFeature(h,ae,_e,te,this.z,v,x,I,he)))}return z}loadMatchingFeature(n,a,h,v,f){const{featureIndex:x,bucketIndex:P,sourceLayerIndex:L,layoutVertexArrayOffset:N}=a,I=this.bucketLayerIDs[P],z=h.layers,F=Object.keys(z);if(F.length&&!function(ae,ge){for(let _e=0;_e<ae.length;_e++)if(ge.indexOf(ae[_e])>=0)return!0;return!1}(F,I))return;const R=h.sourceCache,O=this.sourceLayerCoder.decode(L),q=this.vtLayers[O].feature(x),te=this.getId(q,O);for(let ae=0;ae<I.length;ae++){const ge=I[ae];if(!z[ge])continue;const{styleLayer:_e,targets:he}=z[ge];let xe={};te!==void 0&&(xe=R.getFeatureState(_e.sourceLayer,te));const Te=!f||f(q,_e,xe,N);if(!Te)continue;const Ae=new Fy(q,this.z,this.x,this.y,te);Ae.tile=this.tileID.canonical,Ae.state=xe;let tt=this.serializedLayersCache.get(ge);tt||(tt=_e.serialize(),tt.id=ge,this.serializedLayersCache.set(ge,tt)),Ae.source=tt.source,Ae.sourceLayer=tt["source-layer"],Ae.layer=Ar({},tt),Ae.layer.paint=sI(tt.paint,_e.paint,q,xe,v),Ae.layer.layout=sI(tt.layout,_e.layout,q,xe,v);let Ke=!1;for(const Ye of he){this.updateFeatureProperties(Ae,Ye);const{filter:Ct}=Ye;if(Ct){if(q.properties=Ae.properties,Ct.needGeometry){const ct=le(q,!0);if(!Ct.filter(new ba(this.tileID.overscaledZ),ct,this.tileID.canonical))continue}else if(!Ct.filter(new ba(this.tileID.overscaledZ),q))continue}Ke=!0,Ye.targetId&&this.addFeatureVariant(Ae,Ye)}Ke&&this.appendToResult(n,ge,x,Ae,Te)}}loadMatchingModelFeature(n,a,h,v,f){const x=this.bucketLayerIDs[0][0],P=h.layers;if(!P[x])return;const{styleLayer:L,targets:N}=P[x];if(L.type!=="model")return;const I=v.tile,z=a.featureIndex,F=I.getBucket(L);if(!(F&&F instanceof I0))return;const R=function(tt,Ke,Ye,Ct){const ct=tt.getNodesInfo()[Ke];if(ct.hiddenByReplacement||!ct.node.meshes)return;let It=Number.MAX_VALUE;const Rt=ct.node,At=Ye.tile,Vt=Ct.calculatePosMatrix(At.tileID.toUnwrapped(),Ct.worldSize),Wt=ct.evaluatedScale;let Kt=0;Ct.elevation&&Rt.elevation&&(Kt=Rt.elevation*Ct.elevation.exaggeration()),ht.mat4.translate(Vt,Vt,[(Rt.anchor?Rt.anchor[0]:0)*(Wt[0]-1),(Rt.anchor?Rt.anchor[1]:0)*(Wt[1]-1),Kt]),ht.mat4.scale(Vt,Vt,Wt);const qt=Ye.queryGeometry,yn=qt.isPointQuery()?qt.screenBounds:qt.screenGeometry,Yn=function(di){const ci=ht.mat4.multiply([],Vt,di.matrix);ht.mat4.multiply(ci,Ct.expandedFarZProjMatrix,ci);for(let Ti=0;Ti<di.meshes.length;++Ti){const In=di.meshes[Ti];if(Ti===di.lightMeshIndex)continue;const ji=sM(yn,Ct,ci,In.aabb);ji!=null&&(It=Math.min(ji,It))}if(di.children)for(const Ti of di.children)Yn(Ti)};if(Yn(Rt),It===Number.MAX_VALUE)return;const xn=new Kr(0,0);return yM(At.tileID.canonical,xn,ct.node.anchor[0],ct.node.anchor[1]),{intersectionZ:It,position:xn,feature:ct.feature}}(F,z,v,f);if(!R)return;const{z:O,x:q,y:te}=I.tileID.canonical,{feature:ae,intersectionZ:ge,position:_e}=R;let he={};ae.id!==void 0&&(he=h.sourceCache.getFeatureState(L.sourceLayer,ae.id));const xe=new Fy({},O,q,te,ae.id);xe.tile=this.tileID.canonical,xe.state=he,xe.properties=ae.properties,xe.geometry={type:"Point",coordinates:[_e.lng,_e.lat]};let Te=this.serializedLayersCache.get(x);Te||(Te=L.serialize(),Te.id=x,this.serializedLayersCache.set(x,Te)),xe.source=Te.source,xe.sourceLayer=Te["source-layer"],xe.layer=Ar({},Te);let Ae=!1;for(const tt of N){this.updateFeatureProperties(xe,tt);const{filter:Ke}=tt;if(Ke){if(ae.properties=xe.properties,Ke.needGeometry){if(!Ke.filter(new ba(this.tileID.overscaledZ),ae,this.tileID.canonical))continue}else if(!Ke.filter(new ba(this.tileID.overscaledZ),ae))continue}Ae=!0,tt.targetId&&this.addFeatureVariant(xe,tt)}Ae&&this.appendToResult(n,x,z,xe,ge)}updateFeatureProperties(n,a,h){if(a.properties){const v={};for(const f in a.properties){const x=a.properties[f].evaluate({zoom:this.z},n._vectorTileFeature,n.state,n.tile,h);x!=null&&(v[f]=x)}n.properties=v}}addFeatureVariant(n,a,h){const v={target:a.target,namespace:a.namespace};a.properties&&(v.properties=n.properties),n.variants=n.variants||{},n.variants[a.targetId]=n.variants[a.targetId]||[],n.variants[a.targetId].push(v)}appendToResult(n,a,h,v,f){let x=n[a];x===void 0&&(x=n[a]=[]),x.push({featureIndex:h,feature:v,intersectionZ:f})}lookupSymbolFeatures(n,a,h,v,f){const x={};this.loadVTLayers();for(const P of n)this.loadMatchingFeature(x,{bucketIndex:a,sourceLayerIndex:h,featureIndex:P,layoutVertexArrayOffset:0},v,f);return x}loadFeature(n){const{featureIndex:a,sourceLayerIndex:h}=n;this.loadVTLayers();const v=this.sourceLayerCoder.decode(h),f=this.vtFeatures[v];if(f[a])return f[a];const x=this.vtLayers[v].feature(a);return f[a]=x,x}hasLayer(n){for(const a of this.bucketLayerIDs)for(const h of a)if(n===h)return!0;return!1}getId(n,a){let h=n.id;if(this.promoteId){const v=typeof this.promoteId=="string"?this.promoteId:this.promoteId[a];v!=null&&(h=n.properties[v]),typeof h=="boolean"&&(h=Number(h))}return h}}function sI(c,n,a,h,v){return ko(c,(f,x)=>{const P=n instanceof xc?n.get(x):null;return P&&P.evaluate?P.evaluate(a,h,v):P})}function tB(c,n){return n-c}ki(aI,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const oI=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class wS{static from(n){if(!(n instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[a,h]=new Uint8Array(n,0,2);if(a!==219)throw new Error("Data does not appear to be in a KDBush format.");const v=h>>4;if(v!==1)throw new Error(`Got v${v} data when expected v1.`);const f=oI[15&h];if(!f)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(n,2,1),[P]=new Uint32Array(n,4,1);return new wS(P,x,f,n)}constructor(n,a=64,h=Float64Array,v){if(isNaN(n)||n<0)throw new Error(`Unpexpected numItems value: ${n}.`);this.numItems=+n,this.nodeSize=Math.min(Math.max(+a,2),65535),this.ArrayType=h,this.IndexArrayType=n<65536?Uint16Array:Uint32Array;const f=oI.indexOf(this.ArrayType),x=2*n*this.ArrayType.BYTES_PER_ELEMENT,P=n*this.IndexArrayType.BYTES_PER_ELEMENT,L=(8-P%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${h}.`);v&&v instanceof ArrayBuffer?(this.data=v,this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+P+L,2*n),this._pos=2*n,this._finished=!0):(this.data=new ArrayBuffer(8+x+P+L),this.ids=new this.IndexArrayType(this.data,8,n),this.coords=new this.ArrayType(this.data,8+P+L,2*n),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=a,new Uint32Array(this.data,4,1)[0]=n)}add(n,a){const h=this._pos>>1;return this.ids[h]=h,this.coords[this._pos++]=n,this.coords[this._pos++]=a,h}finish(){const n=this._pos>>1;if(n!==this.numItems)throw new Error(`Added ${n} items when expected ${this.numItems}.`);return SS(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(n,a,h,v){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:x,nodeSize:P}=this,L=[0,f.length-1,0],N=[];for(;L.length;){const I=L.pop()||0,z=L.pop()||0,F=L.pop()||0;if(z-F<=P){for(let te=F;te<=z;te++){const ae=x[2*te],ge=x[2*te+1];ae>=n&&ae<=h&&ge>=a&&ge<=v&&N.push(f[te])}continue}const R=F+z>>1,O=x[2*R],q=x[2*R+1];O>=n&&O<=h&&q>=a&&q<=v&&N.push(f[R]),(I===0?n<=O:a<=q)&&(L.push(F),L.push(R-1),L.push(1-I)),(I===0?h>=O:v>=q)&&(L.push(R+1),L.push(z),L.push(1-I))}return N}within(n,a,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:f,nodeSize:x}=this,P=[0,v.length-1,0],L=[],N=h*h;for(;P.length;){const I=P.pop()||0,z=P.pop()||0,F=P.pop()||0;if(z-F<=x){for(let te=F;te<=z;te++)cI(f[2*te],f[2*te+1],n,a)<=N&&L.push(v[te]);continue}const R=F+z>>1,O=f[2*R],q=f[2*R+1];cI(O,q,n,a)<=N&&L.push(v[R]),(I===0?n-h<=O:a-h<=q)&&(P.push(F),P.push(R-1),P.push(1-I)),(I===0?n+h>=O:a+h>=q)&&(P.push(R+1),P.push(z),P.push(1-I))}return L}}function SS(c,n,a,h,v,f){if(v-h<=a)return;const x=h+v>>1;lI(c,n,x,h,v,f),SS(c,n,a,h,x-1,1-f),SS(c,n,a,x+1,v,1-f)}function lI(c,n,a,h,v,f){for(;v>h;){if(v-h>600){const N=v-h+1,I=a-h+1,z=Math.log(N),F=.5*Math.exp(2*z/3),R=.5*Math.sqrt(z*F*(N-F)/N)*(I-N/2<0?-1:1);lI(c,n,a,Math.max(h,Math.floor(a-I*F/N+R)),Math.min(v,Math.floor(a+(N-I)*F/N+R)),f)}const x=n[2*a+f];let P=h,L=v;for(vx(c,n,h,a),n[2*v+f]>x&&vx(c,n,h,v);P<L;){for(vx(c,n,P,L),P++,L--;n[2*P+f]<x;)P++;for(;n[2*L+f]>x;)L--}n[2*h+f]===x?vx(c,n,h,L):(L++,vx(c,n,L,v)),L<=a&&(h=L+1),a<=L&&(v=L-1)}}function vx(c,n,a,h){TS(c,a,h),TS(n,2*a,2*h),TS(n,2*a+1,2*h+1)}function TS(c,n,a){const h=c[n];c[n]=c[a],c[a]=h}function cI(c,n,a,h){const v=c-a,f=n-h;return v*v+f*f}t.$=yf,t.A=Oa,t.B=2,t.C=SE,t.D=ky,t.E=Vs,t.F=jw,t.G=class extends E0{},t.H=Pl,t.I=fS,t.J=Qo,t.K=mp,t.L=lp,t.M=Vc,t.N=op,t.O=Qr,t.P=at,t.Q=ih,t.R=Fu,t.S=hp,t.T=Qw,t.U=Uc,t.V=E0,t.W=nf,t.X=zl,t.Y=pu,t.Z=ps,t._=Jh,t.a=function(c){return Ze.API_CDN_URL_REGEX.test(c)},t.a$=Fy,t.a0=Nc,t.a1=hf,t.a2=function(c){const n=c.value;let a=[];if(!n)return a;const h=Pl(n);return h!=="string"?(a=a.concat([new E0(c.key,n,`string expected, "${h}" found`)]),a):(lM(n,!0)||(a=a.concat([new E0(c.key,n,`invalid url "${n}"`)])),a)},t.a3=tn,t.a4=Gc,t.a5=_a,t.a6=Xn,t.a7=class{constructor(c){this.specification=c}possiblyEvaluate(c,n){return un(c.expression.evaluate(n))}interpolate(c,n,a){return{x:ir(c.x,n.x,a),y:ir(c.y,n.y,a),z:ir(c.z,n.z,a),azimuthal:ir(c.azimuthal,n.azimuthal,a),polar:ir(c.polar,n.polar,a)}}},t.a8=ba,t.a9=yu,t.aA=Ga,t.aB=class{constructor(c){this.entries={},this.scheduler=c}request(c,n,a,h){const v=this.entries[c]=this.entries[c]||{callbacks:[]};if(v.result){const[f,x]=v.result;return this.scheduler?this.scheduler.add(()=>{h(f,x)},n):h(f,x),()=>{}}return v.callbacks.push(h),v.cancel||(v.cancel=a((f,x)=>{v.result=[f,x];for(const P of v.callbacks)this.scheduler?this.scheduler.add(()=>{P(f,x)},n):P(f,x);setTimeout(()=>delete this.entries[c],3e3)})),()=>{v.result||(v.callbacks=v.callbacks.filter(f=>f!==h),v.callbacks.length||(v.cancel(),delete this.entries[c]))}}},t.aC=Je,t.aD=function(c,n,a){const h=JSON.stringify(c.request);return c.data&&(this.deduped.entries[h]={result:[null,c.data]}),this.deduped.request(h,{type:"parseTile",isSymbolTile:c.isSymbolTile,zoom:c.tileZoom},v=>{const f=Bu(c.request,(x,P,L,N)=>{x?v(x):P&&v(null,{vectorTile:a?void 0:new pm.VectorTile(new d_(P)),rawData:P,cacheControl:L,expires:N})});return()=>{f.cancel(),v()}},n)},t.aE=function(c){xs++,xs>Ni&&(c.getActor().send("enforceCacheSizeLimit",Qi),xs=0)},t.aF=function(c){return c<=1?1:Math.pow(2,Math.floor(Math.log(c)/Math.LN2))},t.aG=si,t.aH=XE,t.aI=tM,t.aJ=WE,t.aK=function(c,n){const a=document.createElement("video");a.muted=!0,a.onloadstart=function(){n(null,a)};for(let h=0;h<c.length;h++){const v=document.createElement("source");ru(c[h])||(a.crossOrigin="Anonymous"),v.src=c[h],a.appendChild(v)}return{cancel:()=>{}}},t.aL=b0,t.aM=function(c){return fetch(c).then(n=>n.arrayBuffer()).then(n=>tI(n,0,c))},t.aN=iI,t.aO=class{constructor(c,n,a,h){this.id=c,this.position=n!=null?new Kr(n[0],n[1]):new Kr(0,0),this.orientation=a??[0,0,0],this.nodes=h,this.uploaded=!1,this.aabb=new nr([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(c,n){if(ht.mat4.multiply(c.matrix,n,c.matrix),c.meshes)for(const a of c.meshes){const h=nr.applyTransformFast(a.aabb,c.matrix);this.aabb.encapsulate(h)}if(c.children)for(const a of c.children)this._applyTransformations(a,c.matrix)}computeBoundsAndApplyParent(){const c=ht.mat4.identity([]);for(const n of this.nodes)this._applyTransformations(n,c)}computeModelMatrix(c,n,a,h,v,f,x=!1){fM(this.matrix,this,c.transform,this.position,n,a,h,v,f,x)}upload(c){if(!this.uploaded){for(const n of this.nodes)rS(n,c);for(const n of this.nodes)M0(n);this.uploaded=!0}}destroy(){for(const c of this.nodes)aS(c)}},t.aP=As,t.aQ=ix,t.aR=Nl,t.aS=Ws,t.aT=Mn,t.aU=Wr,t.aV=Qa,t.aW=Fa,t.aX=v0,t.aY=function(){Go.isLoading()||Go.isLoaded()||mf()!=="deferred"||Sd()},t.aZ=B,t.a_=le,t.aa=y,t.ab=ht,t.ac=pr,t.ad=xc,t.ae=Ho,t.af=ir,t.ag=mi,t.ah=Xl,t.ai=zn,t.aj=Or,t.ak=class{constructor(c){this.specification=c}possiblyEvaluate(c,n){return function([a,h]){const v=un([1,a,h]);return{x:v.x,y:v.y,z:v.z}}(c.expression.evaluate(n))}interpolate(c,n,a){return{x:ir(c.x,n.x,a),y:ir(c.y,n.y,a),z:ir(c.z,n.z,a)}}},t.al=function(c,n,a=0,h=!0){const v=new at(a,a),f=c.sub(v),x=n.add(v),P=[f,new at(x.x,f.y),x,new at(f.x,x.y)];return h&&P.push(f.clone()),P},t.am=function(c,n){const a=[];for(let h=0;h<c.length;h++){const v=Er(h-1,-1,c.length-1),f=Er(h+1,-1,c.length-1),x=c[h],P=c[f],L=c[v].sub(x).unit(),N=P.sub(x).unit(),I=N.angleWithSep(L.x,L.y),z=L.add(N).unit().mult(-1*n/Math.sin(I/2));a.push(x.add(z))}return a},t.an=LE,t.ao=Ft,t.ap=function(c,n,a=0){return ht.vec3.fromValues(((n.x-a)*c.scale-c.x)*mi,(n.y*c.scale-c.y)*mi,um(n.z,n.y))},t.aq=Ur,t.ar=Di,t.as=function(c){let n=1/0,a=1/0,h=-1/0,v=-1/0;for(const f of c)n=Math.min(n,f.x),a=Math.min(a,f.y),h=Math.max(h,f.x),v=Math.max(v,f.y);return{min:new at(n,a),max:new at(h,v)}},t.at=ch,t.au=Mt,t.av=M,t.aw=ui,t.ax=yl,t.ay=function(c,n){const a={};for(let h=0;h<n.length;h++){const v=n[h];v in c&&(a[v]=c[v])}return a},t.az=lh,t.b=function(c){return Ze.API_FONTS_REGEX.test(c)},t.b$=T0,t.b0=fn,t.b1=Dn,t.b2=Ov,t.b3=se,t.b4=rn,t.b5=rh,t.b6=dr,t.b7=Wa,t.b8=Qg,t.b9=Yw,t.bA=mm,t.bB=Gw,t.bC=AE,t.bD=Eu,t.bE=wS,t.bF=Er,t.bG=Gn,t.bH=ao,t.bI=function(c,n,a){c[4*n+0]=a[0],c[4*n+1]=a[1],c[4*n+2]=a[2],c[4*n+3]=a[3]},t.bJ=om,t.bK=rc,t.bL=vp,t.bM=Ba,t.bN=yp,t.bO=Kr,t.bP=VE,t.bQ=Mi,t.bR=br,t.bS=iM,t.bT=wn,t.bU=ys,t.bV=function(c,n,a,h,v,f,x,P,L){if(L.name==="globe")return ys(c,n,new wn(a,h,v),!1);const N=ix({z:a,x:h,y:v},L);return new nr([(f+N.x/N.scale)*n,n*(N.y/N.scale),x],[(f+N.x2/N.scale)*n,n*(N.y2/N.scale),P])},t.bW=function(c,n,a){let h=0;for(let v=0;v<2;++v)c[v]>0&&(h+=(c[v]-0)*(c[v]-0)),n[v]<0&&(h+=(0-n[v])*(0-n[v]));return h},t.bX=xo,t.bY=Km,t.bZ=function(c){const n=ht.mat4.identity(new Float64Array(16));ht.mat4.multiply(n,c.pixelMatrix,c.globeMatrix);const a=[0,qc,0],h=[0,Hc,0];return ht.vec3.transformMat4(a,a,n),ht.vec3.transformMat4(h,h,n),[a[0]>0&&a[0]<=c.width&&a[1]>0&&a[1]<=c.height&&!ac(c,new Kr(c.center.lat,90)),h[0]>0&&h[0]<=c.width&&h[1]>0&&h[1]<=c.height&&!ac(c,new Kr(c.center.lat,-90))]},t.b_=function(c,n){const{scale:a}=c.tileTransform,h=a*mi/(c.tileSize*Math.pow(2,n.zoom-c.tileID.overscaledZ+c.tileID.canonical.z));return ht.mat2.scale(new Float32Array(4),n.inverseAdjustmentMatrix,[h,h])},t.ba=function(c,n){const a=Ho(n.zoom);if(a===0)return Ls(c);const h=wa(c),v=fa(h),f=ch(h.getWest())*n.worldSize,x=ch(h.getEast())*n.worldSize,P=Ga(h.getNorth())*n.worldSize,L=Ga(h.getSouth())*n.worldSize,N=[f,P,0],I=[x,P,0],z=[f,L,0],F=[x,L,0],R=ht.mat4.invert([],n.globeMatrix);return ht.vec3.transformMat4(N,N,R),ht.vec3.transformMat4(I,I,R),ht.vec3.transformMat4(z,z,R),ht.vec3.transformMat4(F,F,R),v[0]=wo(v[0],z,a),v[1]=wo(v[1],F,a),v[2]=wo(v[2],I,a),v[3]=wo(v[3],N,a),nr.fromPoints(v)},t.bb=Lr,t.bc=$r,t.bd=wo,t.be=an,t.bf=er,t.bg=_S,t.bh=d_,t.bi=Bu,t.bj=function(c){const n=[];for(const a in c)n.push(c[a]);return n},t.bk=function(c,n){const a=[];for(const h in c)h in n||a.push(h);return a},t.bl=sa,t.bm=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.bn=Tn,t.bo=function(c,n){const{x:a,y:h}=c.point,v=Su(a,h,c.worldSize/c._pixelsPerMercatorPixel,0,0);return ht.mat4.multiply(v,v,Fo(Ls(n)))},t.bp=js,t.bq=Vo,t.br=lo,t.bs=function(c,n,a,h,v){const f=5*n+2;c.float32[f+0]=a,c.float32[f+1]=h,c.float32[f+2]=v},t.bt=y0,t.bu=wE,t.bv=ke,t.bw=rs,t.bx=tg,t.by=oM,t.bz=Wb,t.c=We,t.c$=(c,n,a,h,v,f,x,P)=>{const L=c.transform,N=L.pitch<15?Si(.07,.7,ui((14-L.zoom)/5,0,1)):.07,I=a.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:ni(c,n,a,h),u_texsize:n.imageAtlasTexture?n.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:L.calculatePixelsToTileUnitsMatrix(n),u_device_pixel_ratio:v,u_width_scale:f,u_floor_width_scale:x,u_image:0,u_tile_units_to_pixels:Li(n,L),u_units_to_pixels:[1/L.pixelsToGLUnits[0],1/L.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:P,u_trim_fade_range:a.paint.get("line-trim-fade-range"),u_trim_color:a.paint.get("line-trim-color").toRenderColor(I?null:a.lut).toArray01(),u_emissive_strength:a.paint.get("line-emissive-strength"),u_zbias_factor:N,u_tile_to_meter:l(n.tileID.canonical,0)}},t.c0=nM,t.c1=function(c){const n=nM(c,!0);return ht.mat2.invert([],[n[0],n[1],n[4],n[5]])},t.c2=Mr,t.c3=function(c){const{x:n,y:a}=c.point,{lng:h,lat:v}=c._center;return Su(n,a,c.worldSize,h,v)},t.c4=vi,t.c5=Ii,t.c6=bp,t.c7=function(c){const n=Math.round((c+45+360)%360/90)%4;return ii[n]},t.c8=45,t.c9=zh,t.cA=class extends ic{constructor(c){super(c),this.current=sy}set(c,n,a){if(this.fetchUniformLocation(c,n)){for(let h=0;h<9;h++)if(a[h]!==this.current[h]){this.current=a,this.gl.uniformMatrix3fv(this.location,!1,a);break}}}},t.cB=wi,t.cC=function(c,n,a){const h=Ho(a.zoom),v=c.style.map._antialias,f=n.options.extStandardDerivativesForceOff||c.terrain&&c.terrain.exaggeration()>0;return h===0&&!v&&!f},t.cD=function(c){const n=c.pixelsPerMeter,a=n/ao(1,c.center.lat),h=ht.mat4.identity(new Float64Array(16));return ht.mat4.translate(h,h,[c.point.x,c.point.y,0]),ht.mat4.scale(h,h,[a,a,n]),Float32Array.from(h)},t.cE=wa,t.cF=function(c){const n=xo-5;c=ui(c,-80.051129,n)/n*90;const a=Math.pow(Math.abs(Math.sin(zn(c))),3);return Math.round(a*(Id.length-1))},t.cG=function(c,n,a,h){const v=n.getNorth(),f=n.getSouth(),x=n.getWest(),P=n.getEast(),L=1<<c.z,N=P-x,I=v-f,z=N/Sc,F=-I/Id[a],R=[0,z,0,F,0,0,v,x,0];if(c.z>0){const O=180/h;ht.mat3.multiply(R,R,[O/N+1,0,0,0,O/I+1,0,-.5*O/z,.5*O/F,1])}return R[2]=L,R[5]=c.x,R[8]=c.y,R},t.cH=Ls,t.cI=function(c,n,a){const h=ht.mat4.identity(new Float64Array(16)),v=(n/(1<<c)-.5)*Math.PI*2;return ht.mat4.rotateY(h,a.globeMatrix,v),Float32Array.from(h)},t.cJ=class{isDataAvailableAtPoint(c){const n=this._source();if(this.isUsingMockSource()||!n||c.y<0||c.y>1)return!1;const a=n.getSource().maxzoom,h=1<<a,v=Math.floor(c.x),f=Math.floor((c.x-v)*h),x=Math.floor(c.y*h),P=this.findDEMTileFor(new si(a,v,a,f,x));return!(!P||!P.dem)}getAtPointOrZero(c,n=0){return this.getAtPoint(c,n)||0}getAtPoint(c,n,a=!0){if(this.isUsingMockSource())return null;n==null&&(n=null);const h=this._source();if(!h||c.y<0||c.y>1)return n;const v=h.getSource().maxzoom,f=1<<v,x=Math.floor(c.x),P=c.x-x,L=new si(v,x,v,Math.floor(P*f),Math.floor(c.y*f)),N=this.findDEMTileFor(L);if(!N||!N.dem)return n;const I=N.dem,z=1<<N.tileID.canonical.z,F=(P*z-N.tileID.canonical.x)*I.dim,R=(c.y*z-N.tileID.canonical.y)*I.dim,O=Math.floor(F),q=Math.floor(R);return(a?this.exaggeration():1)*ir(ir(I.get(O,q),I.get(O,q+1),R-q),ir(I.get(O+1,q),I.get(O+1,q+1),R-q),F-O)}getAtTileOffset(c,n,a){const h=1<<c.canonical.z;return this.getAtPointOrZero(new y(c.wrap+(c.canonical.x+n/mi)/h,(c.canonical.y+a/mi)/h))}getAtTileOffsetFunc(c,n,a,h){return v=>{const f=this.getAtTileOffset(c,v.x,v.y),x=h.upVector(c.canonical,v.x,v.y),P=h.upVectorScale(c.canonical,n,a).metersToTile;return ht.vec3.scale(x,x,f*P),x}}getForTilePoints(c,n,a,h){if(this.isUsingMockSource())return!1;const v=Ay.create(this,c,h);return!!v&&(n.forEach(f=>{f[2]=this.exaggeration()*v.getElevationAt(f[0],f[1],a)}),!0)}getMinMaxForTile(c){if(this.isUsingMockSource())return null;const n=this.findDEMTileFor(c);if(!n||!n.dem)return null;const a=n.dem.tree,h=n.tileID,v=1<<c.canonical.z-h.canonical.z;let f=c.canonical.x/v-h.canonical.x,x=c.canonical.y/v-h.canonical.y,P=0;for(let L=0;L<c.canonical.z-h.canonical.z&&!a.leaves[P];L++){f*=2,x*=2;const N=2*Math.floor(x)+Math.floor(f);P=a.childOffsets[P]+N,f%=1,x%=1}return{min:this.exaggeration()*a.minimums[P],max:this.exaggeration()*a.maximums[P]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(c,n,a){throw new Error("Pure virtual method called.")}pointCoordinate(c){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(c){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const c=this.visibleDemTiles;if(c.length===0)return null;let n=!1,a=Number.MAX_VALUE,h=Number.MIN_VALUE;for(const v of c){const f=this.getMinMaxForTile(v.tileID);f&&(a=Math.min(a,f.min),h=Math.max(h,f.max),n=!0)}return n?{min:a,max:h}:null}},t.cK=uy,t.cL=ea,t.cM=function(c,n){return[Math.pow(c[0],2.2)*n,Math.pow(c[1],2.2)*n,Math.pow(c[2],2.2)*n]},t.cN=jl,t.cO=Pe,t.cP=we,t.cQ=256,t.cR=function(c,n){const a=[0,0,0],h=Lr(Ls(n.canonical));return ht.vec3.transformMat4(a,a,h),ht.vec3.transformMat4(a,a,c),a},t.cS=c=>({u_camera_to_center_distance:new Ba(c),u_extrude_scale:new Xm(c),u_device_pixel_ratio:new Ba(c),u_matrix:new om(c),u_inv_rot_matrix:new om(c),u_merc_center:new rc(c),u_tile_id:new vp(c),u_zoom_transition:new Ba(c),u_up_dir:new vp(c),u_emissive_strength:new Ba(c)}),t.cT=c=>({u_matrix:new om(c),u_pixels_to_tile_units:new Xm(c),u_device_pixel_ratio:new Ba(c),u_width_scale:new Ba(c),u_floor_width_scale:new Ba(c),u_units_to_pixels:new rc(c),u_dash_image:new yp(c),u_gradient_image:new yp(c),u_image_height:new Ba(c),u_texsize:new rc(c),u_tile_units_to_pixels:new Ba(c),u_alpha_discard_threshold:new Ba(c),u_trim_offset:new rc(c),u_trim_fade_range:new rc(c),u_trim_color:new xp(c),u_emissive_strength:new Ba(c),u_zbias_factor:new Ba(c),u_tile_to_meter:new Ba(c)}),t.cU=c=>({u_matrix:new om(c),u_texsize:new rc(c),u_pixels_to_tile_units:new Xm(c),u_device_pixel_ratio:new Ba(c),u_width_scale:new Ba(c),u_floor_width_scale:new Ba(c),u_image:new yp(c),u_units_to_pixels:new rc(c),u_tile_units_to_pixels:new Ba(c),u_alpha_discard_threshold:new Ba(c),u_trim_offset:new rc(c),u_trim_fade_range:new rc(c),u_trim_color:new xp(c),u_emissive_strength:new Ba(c),u_zbias_factor:new Ba(c),u_tile_to_meter:new Ba(c)}),t.cV=Ia,t.cW=sc,t.cX=Co,t.cY=Tp,t.cZ=(c,n,a,h,v,f)=>{const x=c.transform,P=x.projection.name==="globe";let L;if(f.paint.get("circle-pitch-alignment")==="map")if(P){const I=jl(x.zoom,n.canonical)*x._pixelsPerMercatorPixel;L=Float32Array.from([I,0,0,I])}else L=x.calculatePixelsToTileUnitsMatrix(a);else L=new Float32Array([x.pixelsToGLUnits[0],0,0,x.pixelsToGLUnits[1]]);const N={u_camera_to_center_distance:c.transform.getCameraToCenterDistance(x.projection),u_matrix:c.translatePosMatrix(n.projMatrix,a,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_device_pixel_ratio:_i.devicePixelRatio,u_extrude_scale:L,u_inv_rot_matrix:Bo,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:f.paint.get("circle-emissive-strength")};if(P){N.u_inv_rot_matrix=h,N.u_merc_center=v,N.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],N.u_zoom_transition=Ho(x.zoom);const I=v[0]*mi,z=v[1]*mi;N.u_up_dir=x.projection.upVector(new wn(0,0,0),I,z)}return N},t.c_=ar,t.ca=xp,t.cb=function(c,n,a){const h=Math.sqrt(c*c+n*n+a*a),v=h>0?Math.acos(a/h)*Cn:0;let f=c!==0||n!==0?Math.atan2(-n,-c)*Cn+90:0;return f<0&&(f+=360),[h,f,v]},t.cc=l,t.cd=nr,t.ce=un,t.cf=function(c){return[Math.pow(c[0],1/2.2),Math.pow(c[1],1/2.2),Math.pow(c[2],1/2.2)]},t.cg=function(c,n){return c.readFields(KO,{icons:[]},n)},t.ch=function(c){return c({pluginStatus:Ss,pluginURL:eh}),cs.on("pluginStateChange",c),c},t.ci=P0,t.cj=Ey,t.ck=Uw,t.cl=Zl,t.cm=vu,t.cn=Ui,t.co=au,t.cp=Qe,t.cq=function(c){const n=c.indexOf(ze);return n>=0?c.slice(0,n):c},t.cr=function(c){return c.indexOf(ze)>=0},t.cs=function(c){const n=c.indexOf(ze);return n>=0?c.slice(n+1):""},t.ct=function(c){const n=[],a=c.id;return a===void 0&&n.push({message:`layers.${a}: missing required property "id"`}),c.render===void 0&&n.push({message:`layers.${a}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&n.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),n},t.cu=function(c,n,a,h){return c.type==="custom"?new FO(c,n):new WO[c.type](c,n,a,h)},t.cv=bt,t.cw=class extends Fy{constructor(c,n){super(c._vectorTileFeature,c._z,c._x,c._y,c.id),c.state&&(this.state={...c.state}),this.target=n.target,this.namespace=n.namespace,n.properties&&(this.properties=n.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=c.source,this.sourceLayer=c.sourceLayer,this.layer=c.layer)}toJSON(){const c=super.toJSON();return c.target=this.target,c.namespace=this.namespace,c}},t.cx=cs,t.cy=dc,t.cz=$g,t.d=function(c){return Ze.API_TILEJSON_REGEX.test(c)},t.d$=ko,t.d0=(c,n,a,h,v,f,x,P,L)=>{const N=c.transform,I=N.calculatePixelsToTileUnitsMatrix(n),z=a.paint.get("line-trim-color-use-theme").constantOr("default")==="none",F=N.pitch<15?Si(.07,.7,ui((14-N.zoom)/5,0,1)):.07;return{u_matrix:ni(c,n,a,h),u_pixels_to_tile_units:I,u_device_pixel_ratio:f,u_width_scale:x,u_floor_width_scale:P,u_units_to_pixels:[1/N.pixelsToGLUnits[0],1/N.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:v,u_texsize:Cr(a)&&n.lineAtlasTexture?n.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Li(n,c.transform),u_alpha_discard_threshold:0,u_trim_offset:L,u_trim_fade_range:a.paint.get("line-trim-fade-range"),u_trim_color:a.paint.get("line-trim-color").toRenderColor(z?null:a.lut).toArray01(),u_emissive_strength:a.paint.get("line-emissive-strength"),u_zbias_factor:F,u_tile_to_meter:l(n.tileID.canonical,0)}},t.d1=Os,t.d2=Jg,t.d3=D,t.d4=Ai,t.d5=og,t.d6=If,t.d7=450,t.d8=7,t.d9=OO,t.dA=Vi,t.dB=i,t.dC=Pd,t.dD=function([c,n,a]){const h=Math.hypot(c,n,a),v=Math.atan2(c,a),f=.5*Math.PI-Math.acos(-n/h);return new Kr(vi(v),vi(f))},t.dE=tS,t.dF=function(c){const n=c.navigator?c.navigator.userAgent:null;return!!function(a){if(Wn==null){const h=a.navigator?a.navigator.userAgent:null;Wn=!!a.safari||!(!h||!(/\b(iPad|iPhone|iPod)\b/.test(h)||h.match("Safari")&&!h.match("Chrome")))}return Wn}(c)&&n&&(n.match("Version/15.4")||n.match("Version/15.5")||n.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},t.dG=function(c,n){Qi=c,Ni=n},t.dH=ac,t.dI=Tu,t.dJ=function(c){const n=[0,0,0],a=ht.mat4.identity(new Float64Array(16));return ht.mat4.multiply(a,c.pixelMatrix,c.globeMatrix),ht.vec3.transformMat4(n,n,a),new at(n[0],n[1])},t.dK=function(c,n,a=!1){if(Ss===wd||Ss===Bl||Ss===$o)throw new Error("setRTLTextPlugin cannot be called multiple times.");eh=_i.resolveURL(c),Ss=wd,pp=n,Ra(),a||Sd()},t.dL=mf,t.dM=function(){P0().acquire(oS)},t.dN=function(){const c=hx;c&&(c.isPreloaded()&&c.numActive()===1?(c.release(oS),hx=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},t.dO=__,t.dP=function(c){const n=Zr();if(!n)return;const a=n.delete(qi);c&&a.catch(c).then(()=>c())},t.dQ=ux,t.dR=WM,t.dS=function(c){yS=_i.resolveURL(c),Oy||(Oy=new ky(P0(),new Vs)),Oy.broadcast("setDracoUrl",yS)},t.dT=XM,t.dU=function(c){zy=_i.resolveURL(c),Oy||(Oy=new ky(P0(),new Vs)),Oy.broadcast("setMeshoptUrl",zy)},t.dV=ki,t.dW=wf,t.dX=Af,t.dY=rI,t.dZ=aI,t.d_=Zt,t.da=Bt,t.db=gl,t.dc=256,t.dd=Fo,t.de=jn,t.df=Za,t.dg=tc,t.dh=function(c,n,a,h,v){return ui((c-n)/(a-n)*(v-h)+h,h,v)},t.di=sp,t.dj=_,t.dk=class{constructor(c,n,a,h){this.context=c,this.format=h,this.size=a,this.texture=c.gl.createTexture();const[v,f,x]=this.size,{gl:P}=c;P.bindTexture(P.TEXTURE_3D,this.texture),c.pixelStoreUnpackFlipY.set(!1),c.pixelStoreUnpack.set(1),c.pixelStoreUnpackPremultiplyAlpha.set(!1),P.texImage3D(P.TEXTURE_3D,0,this.format,v,f,x,0,Kw(this.format),Jw(this.format),n.data)}bind(c,n){const{context:a}=this,{gl:h}=a;h.bindTexture(h.TEXTURE_3D,this.texture),c!==this.minFilter&&(h.texParameteri(h.TEXTURE_3D,h.TEXTURE_MAG_FILTER,c),h.texParameteri(h.TEXTURE_3D,h.TEXTURE_MIN_FILTER,c),this.minFilter=c),n!==this.wrapS&&(h.texParameteri(h.TEXTURE_3D,h.TEXTURE_WRAP_S,n),h.texParameteri(h.TEXTURE_3D,h.TEXTURE_WRAP_T,n),this.wrapS=n)}destroy(){const{gl:c}=this.context;c.deleteTexture(this.texture),this.texture=null}},t.dl=nS,t.dm=[1,1,1],t.dn=Ay,t.dp=Py,t.dq=Ma,t.dr=rl,t.ds=Sp,t.dt=il,t.du=nc,t.dv=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new at(1/0,1/0),max:new at(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(c,n=!1){const a=c_(new at(0,0),new at(mi,mi),c),h=[];if(n&&!vy(a,this._globalClipBounds))return h;for(const v of this._activeRegions){if(v.hiddenByOverlap||!vy(a,v))continue;const f=xy(v.min,v.max,c);h.push({min:f.min,max:f.max,sourceId:this._sourceIds[v.priority],footprint:v.footprint,footprintTileId:v.tileId,order:v.order,clipMask:v.clipMask,clipScope:v.clipScope})}return h}setSources(c){this._setSources(c.map(n=>({getSourceId:()=>n.cache.id,getFootprints:()=>{const a=[];for(const h of n.cache.getVisibleCoordinates()){const v=n.cache.getTile(h).buckets[n.layer];v&&v.updateFootprints(h.toUnwrapped(),a)}return a},getOrder:()=>n.order,getClipMask:()=>n.clipMask,getClipScope:()=>n.clipScope})))}_addSource(c){const n=c.getFootprints();if(n.length===0)return;const a=c.getOrder(),h=c.getClipMask(),v=c.getClipScope();for(const f of n){if(!f.footprint)continue;const x=c_(f.footprint.min,f.footprint.max,f.id);this._activeRegions.push({min:x.min,max:x.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:f.id,footprint:f.footprint,order:a,clipMask:h,clipScope:v})}this._sourceIds.push(c.getSourceId())}_computeReplacement(){this._activeRegions.sort((n,a)=>n.priority-a.priority||o_(n.min,a.min)||o_(n.max,a.max)||n.order-a.order||n.clipMask-a.clipMask||function(h,v){const f=(x,P)=>x+P;return h.length-v.length||h.reduce(f,"").localeCompare(v.reduce(f,""))}(n.clipScope,a.clipScope));let c=this._activeRegions.length!==this._prevRegions.length;if(!c){let n=0;for(;!c&&n!==this._activeRegions.length;){const a=this._activeRegions[n],h=this._prevRegions[n];c=a.priority!==h.priority||!l_(a,h)||a.order!==h.order||a.clipMask!==h.clipMask||!Tn(a.clipScope,h.clipScope),++n}}if(c){++this._updateTime;for(const a of this._activeRegions)a.order!==s_&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,a.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,a.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,a.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,a.max.y));const n=a=>{const h=this._activeRegions;if(a>=h.length)return a;const v=h[a].priority;for(;a<h.length&&h[a].priority===v;)++a;return a};if(this._sourceIds.length>1){let a=0,h=n(a);for(;a!==h;){let v=a;const f=a;for(;v!==h;){const x=this._activeRegions[v];x.hiddenByOverlap=!1;for(let P=0;P<f;P++){const L=this._activeRegions[P];if(!L.hiddenByOverlap&&x.order===s_&&vy(x,L)&&(x.hiddenByOverlap=Zb(x.footprint,x.tileId,L.footprint,L.tileId),x.hiddenByOverlap))break}++v}a=h,h=n(a)}}}}_setSources(c){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let n=c.length-1;n>=0;n--)this._addSource(c[n]);this._computeReplacement()}},t.dw=class{constructor(c){this._createGrid(c),this._createPoles(c)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const c of this._poleSegments)c.destroy();for(const c of this._gridSegments)c.withSkirts.destroy(),c.withoutSkirts.destroy()}_fillGridMeshWithLods(c,n){const a=new rn,h=new Wr,v=[],f=c+1+2,x=n[0]+1,P=n[0]+1+(1+n.length),L=(N,I,z)=>{let F=N===f-1?N-2:N===0?N:N-1;return F+=z?24575:0,[F,I]};for(let N=0;N<f;++N)a.emplaceBack(...L(N,0,!0));for(let N=0;N<x;++N)for(let I=0;I<f;++I)a.emplaceBack(...L(I,N,(I===0||I===f-1)&&!0));for(let N=0;N<n.length;++N){const I=n[N];for(let z=0;z<f;++z)a.emplaceBack(...L(z,I,!0))}for(let N=0;N<n.length;++N){const I=h.length,z=n[N]+1+2,F=new Wr;for(let q=0;q<z-1;q++){const te=q===z-2,ae=te?f*(P-n.length+N-q):f;for(let ge=0;ge<f-1;ge++){const _e=q*f+ge;q===0||te||ge===0||ge===f-2?(F.emplaceBack(_e+1,_e,_e+ae),F.emplaceBack(_e+ae,_e+ae+1,_e+1)):(h.emplaceBack(_e+1,_e,_e+ae),h.emplaceBack(_e+ae,_e+ae+1,_e+1))}}const R=Wa.simpleSegment(0,I,a.length,h.length-I);for(let q=0;q<F.uint16.length;q+=3)h.emplaceBack(F.uint16[q],F.uint16[q+1],F.uint16[q+2]);const O=Wa.simpleSegment(0,I,a.length,h.length-I);v.push({withoutSkirts:R,withSkirts:O})}return{vertices:a,indices:h,segments:v}}_createGrid(c){const n=this._fillGridMeshWithLods(Sc,Id);this._gridSegments=n.segments,this._gridBuffer=c.createVertexBuffer(n.vertices,dr.members),this._gridIndexBuffer=c.createIndexBuffer(n.indices,!0)}_createPoles(c){const n=new Wr;for(let x=0;x<=Sc;x++)n.emplaceBack(0,x+1,x+2);this._poleIndexBuffer=c.createIndexBuffer(n,!0);const a=new Za,h=new Za,v=new Za,f=new Za;this._poleSegments=[];for(let x=0,P=0;x<bp;x++){const L=360/(1<<x);a.emplaceBack(0,-yl,0,.5,0),h.emplaceBack(0,-yl,0,.5,1),v.emplaceBack(0,-yl,0,.5,.5),f.emplaceBack(0,-yl,0,.5,.5);for(let N=0;N<=Sc;N++){let I=N/Sc,z=0;const F=ir(0,L,I),[R,O,q]=wp(uh,kd,F,yl);a.emplaceBack(R,O,q,I,z),h.emplaceBack(R,O,q,I,1-z);const te=zn(F);I=.5+.5*Math.sin(te),z=.5+.5*Math.cos(te),v.emplaceBack(R,O,q,I,z),f.emplaceBack(R,O,q,I,1-z)}this._poleSegments.push(Wa.simpleSegment(P,0,66,64)),P+=66}this._poleNorthVertexBuffer=c.createVertexBuffer(a,Xi,!1),this._poleSouthVertexBuffer=c.createVertexBuffer(h,Xi,!1),this._texturedPoleNorthVertexBuffer=c.createVertexBuffer(v,Xi,!1),this._texturedPoleSouthVertexBuffer=c.createVertexBuffer(f,Xi,!1)}getGridBuffers(c,n){return[this._gridBuffer,this._gridIndexBuffer,n?this._gridSegments[c].withSkirts:this._gridSegments[c].withoutSkirts]}getPoleBuffers(c,n){return[n?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,n?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[c]]}},t.dx=s_,t.dy=Ki,t.dz=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},t.e=Ze,t.e0=el,t.e1=TE,t.e2=function(c,n,a,h,v,f,x,P,L,N,I=1,z,F){c.createArrays(),c.tilePixelRatio=mi/(512*c.overscaling),c.compareText={},c.iconsNeedLinear=!1;const R=c.layers[0].layout,O=c.layers[0]._unevaluatedLayout._values,q={};q.scaleFactor=I,q.textSizeScaleRange=R.get("text-size-scale-range"),q.iconSizeScaleRange=R.get("icon-size-scale-range");const[te,ae]=q.textSizeScaleRange,[ge,_e]=q.iconSizeScaleRange;if(q.textScaleFactor=ui(q.scaleFactor,te,ae),q.iconScaleFactor=ui(q.scaleFactor,ge,_e),c.textSizeData.kind==="composite"){const{minZoom:Ae,maxZoom:tt}=c.textSizeData;q.compositeTextSizes=[O["text-size"].possiblyEvaluate(new ba(Ae),P),O["text-size"].possiblyEvaluate(new ba(tt),P)]}if(c.iconSizeData.kind==="composite"){const{minZoom:Ae,maxZoom:tt}=c.iconSizeData;q.compositeIconSizes=[O["icon-size"].possiblyEvaluate(new ba(Ae),P),O["icon-size"].possiblyEvaluate(new ba(tt),P)]}q.layoutTextSize=O["text-size"].possiblyEvaluate(new ba(L+1),P),q.layoutIconSize=O["icon-size"].possiblyEvaluate(new ba(L+1),P),q.textMaxSize=O["text-size"].possiblyEvaluate(new ba(18),P);const he=R.get("text-rotation-alignment")==="map"&&R.get("symbol-placement")!=="point",xe=R.get("text-size");let Te=!1;for(const Ae of c.features)if(Ae.icon&&Ae.icon.nameSecondary){Te=!0;break}for(const Ae of c.features){const tt=R.get("text-font").evaluate(Ae,{},P).join(","),Ke=xe.evaluate(Ae,{},P)*q.textScaleFactor,Ye=q.layoutTextSize.evaluate(Ae,{},P)*q.textScaleFactor,Ct=(q.layoutIconSize.evaluate(Ae,{},P),{horizontal:{},vertical:void 0}),ct=Ae.text;let It,Rt=[0,0];if(ct){const Kt=ct.toString(),qt=R.get("text-letter-spacing").evaluate(Ae,{},P)*rs,yn=R.get("text-line-height").evaluate(Ae,{},P)*rs,Yn=fp(Kt)?qt:0,xn=R.get("text-anchor").evaluate(Ae,{},P),di=R.get("text-variable-anchor");if(!di){const gi=R.get("text-radial-offset").evaluate(Ae,{},P);Rt=gi?AE(xn,[gi*rs,$w]):R.get("text-offset").evaluate(Ae,{},P).map(Oi=>Oi*rs)}let ci=he?"center":R.get("text-justify").evaluate(Ae,{},P);const Ti=R.get("symbol-placement")==="point",In=Ti?R.get("text-max-width").evaluate(Ae,{},P)*rs:1/0,ji=gi=>{c.allowVerticalPlacement&&ff(Kt)&&(Ct.vertical=ex(ct,n,a,v,tt,In,yn,xn,gi,Yn,Rt,Vo.vertical,!0,Ye,Ke))};if(!he&&di){const gi=ci==="auto"?di.map(rr=>Gw(rr)):[ci];let Oi=!1;for(let rr=0;rr<gi.length;rr++){const wr=gi[rr];if(!Ct.horizontal[wr])if(Oi)Ct.horizontal[wr]=Ct.horizontal[0];else{const Ir=ex(ct,n,a,v,tt,In,yn,"center",wr,Yn,Rt,Vo.horizontal,!1,Ye,Ke);Ir&&(Ct.horizontal[wr]=Ir,Oi=Ir.positionedLines.length===1)}}ji("left")}else{if(ci==="auto"&&(ci=Gw(xn)),Ti||R.get("text-writing-mode").indexOf("horizontal")>=0||!ff(Kt)){const gi=ex(ct,n,a,v,tt,In,yn,xn,ci,Yn,Rt,Vo.horizontal,!1,Ye,Ke);gi&&(Ct.horizontal[ci]=gi)}ji(Ti?"left":ci)}}let At=!1,Vt=!1;if(Ae.icon&&Ae.icon.namePrimary){const Kt=bl(c.iconSizeData,O["icon-size"],P,c.zoom,Ae)*q.iconScaleFactor*z,qt=Ae.icon.getPrimary().scaleSelf(Kt).serialize(),yn=h[qt];yn&&(It=a0(v[qt],Ae.icon.nameSecondary?v[Ae.icon.getSecondary().scaleSelf(Kt).serialize()]:void 0,R.get("icon-offset").evaluate(Ae,{},P),R.get("icon-anchor").evaluate(Ae,{},P)),At=yn.sdf,Vt=yn.usvg,c.sdfIcons===void 0?c.sdfIcons=yn.sdf:c.sdfIcons!==yn.sdf&&it("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(yn.pixelRatio!==c.pixelRatio||R.get("icon-rotate").constantOr(1)!==0)&&(c.iconsNeedLinear=!0))}const Wt=DE(Ct.horizontal)||Ct.vertical;c.iconsInText||(c.iconsInText=!!Wt&&Wt.iconsInText),(Wt||It)&&SO(c,Ae,Ct,It,h,q,Ye,0,Rt,At,Vt,x,P,N,F,Te)}f&&c.generateCollisionDebugBuffers(L,c.collisionBoxArray,q.textScaleFactor)},t.e3=pm,t.e4=z0,t.e5=mt,t.e6=Ef,t.e7=_m,t.e8=G,t.e9=function(c){let n=0;if(new Uint32Array(c,0,1)[0]!==KM){const a=new Uint32Array(c,0,7),[,,h,v,f,x]=a;n=a.byteLength+v+f+x+f,(h!==c.byteLength||n>=c.byteLength)&&it("Invalid b3dm header information.")}return tI(c,n)},t.ea=function(c,n){const a=iI(c);for(const h of a){for(const v of h.meshes)JF(v);h.lights&&(h.lightMeshIndex=h.meshes.length,h.meshes.push(QF(h.lights,n)))}return a},t.eb=I0,t.ec=vM,t.ed=Go,t.ee=function(c){Xr(),Nr!=null&&Nr.then(n=>{n.keys().then(a=>{for(let h=0;h<a.length-c;h++)n.delete(a[h])})})},t.f=function(c){return c.indexOf("mapbox:")===0},t.g=function(c,n){return dc(Ar(c,{method:"GET"}),n)},t.h=yt,t.i=function(c){return Ze.API_STYLE_REGEX.test(c)&&!We(c)},t.j=function(c){return decodeURIComponent(atob(c).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join(""))},t.k=function(c){return btoa(encodeURIComponent(c).replace(/%([0-9A-F]{2})/g,(n,a)=>String.fromCharCode(+("0x"+a))))},t.l=Ar,t.m=go,t.n=function(c,n){return dc(Ar(c,{type:"json"}),n)},t.o=zc,t.p=function(c,n){return dc(Ar(c,{method:"POST"}),n)},t.q=_i,t.r=Zo,t.s=function(c){try{const n=self[c];return n.setItem("_mapbox_test_",1),n.removeItem("_mapbox_test_"),!0}catch{return!1}},t.t=On,t.u=function(){return function c(n){return n?(n^Math.random()*(16>>n/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,c)}()},t.v=function(c){return!!c&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(c)},t.w=it,t.x=function(){return lS||(lS=new __),lS},t.y=ss,t.z=$a}),E(["./shared"],function(t){function G(et){const we=et?et.url.toString():void 0;return we?performance.getEntriesByName(we):[]}function W(et){if(typeof et=="number"||typeof et=="boolean"||typeof et=="string"||et==null)return JSON.stringify(et);if(Array.isArray(et)){let Pe="[";for(const Ze of et)Pe+=`${W(Ze)},`;return`${Pe}]`}let we="{";for(const Pe of Object.keys(et).sort())we+=`${Pe}:${W(et[Pe])},`;return`${we}}`}function Y(et){let we="";for(const Pe of t.bm)we+=`/${W(et[Pe])}`;return we}class ne{constructor(we){this.keyCache={},this._layers={},this._layerConfigs={},we&&this.replace(we)}replace(we,Pe){this._layerConfigs={},this._layers={},this.update(we,[],Pe)}update(we,Pe,Ze){this._options=Ze;for(const We of we)this._layerConfigs[We.id]=We,(this._layers[We.id]=t.cu(We,this.scope,null,this._options)).compileFilter(Ze),this.keyCache[We.id]&&delete this.keyCache[We.id];for(const We of Pe)delete this.keyCache[We],delete this._layerConfigs[We],delete this._layers[We];this.familiesBySource={};const yt=function(We,pt){const kt={};for(let Jt=0;Jt<We.length;Jt++){const Xt=We[Jt];let Gt=pt&&pt[Xt.id];!Gt&&(Gt=Y(Xt),Xt.type==="line"&&Xt.paint)&&function _i(li){return typeof li=="string"&&li==="line-progress"||(Array.isArray(li)?li.some(_i):!(!li||typeof li!="object")&&Object.values(li).some(_i))}(Xt.paint["line-width"])&&(Gt+=`/${W(Xt.paint["line-width"])}`),pt&&(pt[Xt.id]=Gt);let On=kt[Gt];On||(On=kt[Gt]=[]),On.push(Xt)}const Dt=[];for(const Jt in kt)Dt.push(kt[Jt]);return Dt}(t.bj(this._layerConfigs),this.keyCache);for(const We of yt){const pt=We.map(On=>this._layers[On.id]),kt=pt[0];if(kt.visibility==="none")continue;const Dt=kt.source||"";let Jt=this.familiesBySource[Dt];Jt||(Jt=this.familiesBySource[Dt]={});const Xt=kt.sourceLayer||"_geojsonTileLayer";let Gt=Jt[Xt];Gt||(Gt=Jt[Xt]=[]),Gt.push(pt)}}}const J=1*t.dX;class Q{constructor(we){const Pe={},Ze=[];for(const kt in we){const Dt=we[kt],Jt=Pe[kt]={};for(const Xt in Dt.glyphs){const Gt=Dt.glyphs[+Xt];if(!Gt||Gt.bitmap.width===0||Gt.bitmap.height===0)continue;const On=Gt.metrics.localGlyph?J:1,_i={x:0,y:0,w:Gt.bitmap.width+2*On,h:Gt.bitmap.height+2*On};Ze.push(_i),Jt[Xt]=_i}}const{w:yt,h:We}=t.C(Ze),pt=new t.dW({width:yt||1,height:We||1});for(const kt in we){const Dt=we[kt];for(const Jt in Dt.glyphs){const Xt=Dt.glyphs[+Jt];if(!Xt||Xt.bitmap.width===0||Xt.bitmap.height===0)continue;const Gt=Pe[kt][Jt],On=Xt.metrics.localGlyph?J:1;t.dW.copy(Xt.bitmap,pt,{x:0,y:0},{x:Gt.x+On,y:Gt.y+On},Xt.bitmap)}}this.image=pt,this.positions=Pe}}t.dV(Q,"GlyphAtlas");class ce{constructor(we){this.tileID=new t.aG(we.tileID.overscaledZ,we.tileID.wrap,we.tileID.canonical.z,we.tileID.canonical.x,we.tileID.canonical.y),this.tileZoom=we.tileZoom,this.uid=we.uid,this.zoom=we.zoom,this.lut=we.lut,this.canonical=we.tileID.canonical,this.pixelRatio=we.pixelRatio,this.tileSize=we.tileSize,this.source=we.source,this.scope=we.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=we.showCollisionBoxes,this.collectResourceTiming=!!we.request&&we.request.collectResourceTiming,this.promoteId=we.promoteId,this.isSymbolTile=we.isSymbolTile,this.tileTransform=t.aQ(we.tileID.canonical,we.projection),this.projection=we.projection,this.worldview=we.worldview,this.localizableLayerIds=we.localizableLayerIds,this.brightness=we.brightness,this.extraShadowCaster=!!we.extraShadowCaster,this.tessellationStep=we.tessellationStep,this.scaleFactor=we.scaleFactor}parse(we,Pe,Ze,yt,We){this.status="parsing",this.data=we,this.collisionBoxArray=new t.aW;const pt=new t.dY(Object.keys(we.layers).sort()),kt=new t.dZ(this.tileID,this.promoteId);kt.bucketLayerIDs=[];const Dt={},Jt=new t.d_(256,256),Xt={featureIndex:kt,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:Jt,availableImages:Ze,brightness:this.brightness,scaleFactor:this.scaleFactor},Gt=Pe.familiesBySource[this.source];for(const Ni in Gt){const Jr=we.layers[Ni];if(!Jr)continue;let Nr=!1,kr=!1,Zr=!1;for(const go of Gt[Ni])go[0].type==="symbol"?Nr=!0:kr=!0,go[0].is3D()&&go[0].type!=="model"&&(Zr=!0);if(this.extraShadowCaster&&!Zr||this.isSymbolTile===!0&&!Nr||this.isSymbolTile===!1&&!kr)continue;Jr.version===1&&t.w(`Vector tile source "${this.source}" layer "${Ni}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Xr=pt.encode(Ni),xs=[];for(let go=0,Fs=0;go<Jr.length;go++){const bs=Jr.feature(go),Ou=kt.getId(bs,Ni);if(this.localizableLayerIds&&this.localizableLayerIds.has(Ni)){const Lc=bs.properties?bs.properties.worldview:null;if(this.worldview&&typeof Lc=="string")if(Lc==="all")bs.properties.$localized=!0;else{if(!Lc.split(",").includes(this.worldview))continue;bs.properties.$localized=!0,bs.properties.worldview=this.worldview}}xs.push({feature:bs,id:Ou,index:Fs,sourceLayerIndex:Xr}),Fs++}for(const go of Gt[Ni]){const Fs=go[0];(!this.extraShadowCaster||Fs.is3D()&&Fs.type!=="model")&&(this.isSymbolTile!==void 0&&Fs.type==="symbol"!==this.isSymbolTile||Fs.minzoom&&this.zoom<Math.floor(Fs.minzoom)||Fs.maxzoom&&this.zoom>=Fs.maxzoom||Fs.visibility!=="none"&&(ie(go,this.zoom,Xt.brightness,Ze),(Dt[Fs.id]=Fs.createBucket({index:kt.bucketLayerIDs.length,layers:go,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Xr,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep})).populate(xs,Xt,this.tileID.canonical,this.tileTransform),kt.bucketLayerIDs.push(go.map(bs=>t.aC(bs.id,bs.scope)))))}}let On,_i,li,Ui;Jt.trim();const qi={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Qi=()=>{if(On)return this.status="done",We(On);if(this.extraShadowCaster)this.status="done",We(null,{buckets:t.bj(Dt).filter(Ni=>!Ni.isEmpty()),featureIndex:kt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Xt.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(_i&&li&&Ui){const Ni=new Q(_i),Jr=new t.e1(li,Ui,this.lut);for(const Nr in Dt){const kr=Dt[Nr];kr instanceof t.aX?(ie(kr.layers,this.zoom,Xt.brightness,Ze),t.e2(kr,_i,Ni.positions,li,Jr.iconPositions,this.showCollisionBoxes,Ze,this.tileID.canonical,this.tileZoom,this.projection,this.scaleFactor,this.pixelRatio,this.brightness)):kr.hasPattern&&(kr instanceof t.b1||kr instanceof t.b2||kr instanceof t.d5)&&(ie(kr.layers,this.zoom,Xt.brightness,Ze),kr.addFeatures(Xt,this.tileID.canonical,Jr.patternPositions,Ze,this.tileTransform,this.brightness))}this.status="done",We(null,{buckets:t.bj(Dt).filter(Nr=>!Nr.isEmpty()),featureIndex:kt,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Ni.image,lineAtlas:Jt,imageAtlas:Jr,brightness:Xt.brightness})}};if(!this.extraShadowCaster){const Ni=t.d$(Xt.glyphDependencies,kr=>Object.keys(kr).map(Number));Object.keys(Ni).length?yt.send("getGlyphs",{uid:this.uid,stacks:Ni,scope:this.scope},(kr,Zr)=>{On||(On=kr,_i=Zr,Qi())},void 0,!1,qi):_i={};const Jr=Object.keys(Xt.iconDependencies);Jr.length?yt.send("getImages",{icons:Jr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(kr,Zr)=>{if(On)return;On=kr;const Xr={};Object.values(Zr).some(xs=>xs.usvg)?this.rasterize(yt,Xr,Zr,Xt.iconDependencies,()=>{li=Xr,Qi()}):(this.fillImageMap(Xr,Xt.iconDependencies,Zr),li=Xr,Qi())},void 0,!1,qi):li={};const Nr=Object.keys(Xt.patternDependencies);Nr.length?yt.send("getImages",{icons:Nr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(kr,Zr)=>{if(!On){On=kr;const Xr={};Object.values(Zr).some(xs=>xs.usvg)?this.rasterize(yt,Xr,Zr,Xt.patternDependencies,()=>{Ui=Xr,Qi()}):(this.fillImageMap(Xr,Xt.patternDependencies,Zr),Ui=Xr,Qi())}},void 0,!1,qi):Ui={}}Qi()}fillImageMap(we,Pe,Ze){for(const yt in Ze){const We=Pe[yt]||[];for(const pt of We)Ze[pt.id].usvg||(we[pt.serialize()]=Ze[pt.id])}}getImageTaskQueue(we,Pe,Ze){const yt={};for(const We in Pe){const pt=Ze[We]||[];for(const kt of pt){const Dt=kt.serialize();Pe[kt.id].usvg?yt[Dt]||(yt[Dt]=kt):we[Dt]=Pe[kt.id]}}return yt}rasterize(we,Pe,Ze,yt,We){const pt=this.getImageTaskQueue(Pe,Ze,yt);this.rasterizeTask=we.send("rasterizeImages",{scope:this.scope,imageTasks:pt},(kt,Dt)=>{if(!kt)for(const Jt in Dt){const{id:Xt}=t.e0.deserializeFromString(Jt);Pe[Jt]=Object.assign({},Ze[Xt],{data:Dt[Jt]})}We()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function ie(et,we,Pe,Ze){const yt=new t.a8(we,{brightness:Pe});for(const We of et)We.recalculate(yt,Ze)}class pe extends t.E{constructor(we,Pe,Ze,yt,We,pt){super(),this.actor=we,this.layerIndex=Pe,this.availableImages=Ze,this.loadVectorData=We||t.aD,this.loading={},this.loaded={},this.deduped=new t.aB(we.scheduler),this.isSpriteLoaded=yt,this.scheduler=we.scheduler,this.brightness=pt}loadTile(we,Pe){const Ze=we.uid,yt=we&&we.request,We=yt&&yt.collectResourceTiming,pt=this.loading[Ze]=new ce(we);pt.abort=this.loadVectorData(we,(kt,Dt)=>{const Jt=!this.loading[Ze];if(delete this.loading[Ze],pt.cancelRasterize(),Jt||kt||!Dt)return pt.status="done",Jt||(this.loaded[Ze]=pt),Pe(kt);const Xt=Dt.rawData,Gt={};Dt.expires&&(Gt.expires=Dt.expires),Dt.cacheControl&&(Gt.cacheControl=Dt.cacheControl),pt.vectorTile=Dt.vectorTile||new t.e3.VectorTile(new t.bh(Xt));const On=()=>{pt.parse(pt.vectorTile,this.layerIndex,this.availableImages,this.actor,(_i,li)=>{if(_i||!li)return Pe(_i);const Ui={};if(We){const qi=G(yt);qi.length>0&&(Ui.resourceTiming=JSON.parse(JSON.stringify(qi)))}Pe(null,t.l({rawTileData:Xt.slice(0)},li,Gt,Ui))})};this.isSpriteLoaded?On():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(On,{type:"parseTile",isSymbolTile:we.isSymbolTile,zoom:we.tileZoom}):On()}),this.loaded=this.loaded||{},this.loaded[Ze]=pt})}reloadTile(we,Pe){const Ze=this.loaded,yt=we.uid;if(Ze&&Ze[yt]){const We=Ze[yt];We.scaleFactor=we.scaleFactor,We.showCollisionBoxes=we.showCollisionBoxes,We.projection=we.projection,We.brightness=we.brightness,We.tileTransform=t.aQ(we.tileID.canonical,we.projection),We.extraShadowCaster=we.extraShadowCaster,We.lut=we.lut;const pt=(kt,Dt)=>{const Jt=We.reloadCallback;Jt&&(delete We.reloadCallback,We.parse(We.vectorTile,this.layerIndex,this.availableImages,this.actor,Jt)),Pe(kt,Dt)};We.status==="parsing"?We.reloadCallback=pt:We.status==="done"&&(We.vectorTile?We.parse(We.vectorTile,this.layerIndex,this.availableImages,this.actor,pt):pt())}else Pe(null,void 0)}abortTile(we,Pe){const Ze=we.uid,yt=this.loading[Ze];yt&&(yt.abort&&yt.abort(),delete this.loading[Ze]),Pe()}removeTile(we,Pe){const Ze=this.loaded,yt=we.uid;Ze&&Ze[yt]&&delete Ze[yt],Pe()}}class be{loadTile(we,Pe){const{uid:Ze,encoding:yt,rawImageData:We,padding:pt}=we,kt=ImageBitmap&&We instanceof ImageBitmap?this.getImageData(We,pt):We;Pe(null,new t.e4(Ze,kt,yt,pt<1))}getImageData(we,Pe){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(we.width,we.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=we.width,this.offscreenCanvas.height=we.height,this.offscreenCanvasContext.drawImage(we,0,0,we.width,we.height);const Ze=this.offscreenCanvasContext.getImageData(-Pe,-Pe,we.width+2*Pe,we.height+2*Pe);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Ze}}t.bg.setPbf(t.bh);class Ie{decodeRasterArray({task:we,buffer:Pe},Ze){t.bg.performDecoding(Pe,we).then(yt=>{Ze(null,yt)},yt=>{Ze(yt)})}}const $e=t.e3.VectorTileFeature.prototype.toGeoJSON;class Le{constructor(we){this._feature=we,this.extent=t.ag,this.type=we.type,this.properties=we.tags,"id"in we&&!isNaN(we.id)&&(this.id=parseInt(we.id,10))}loadGeometry(){if(this._feature.type===1){const we=[];for(const Pe of this._feature.geometry)we.push([new t.P(Pe[0],Pe[1])]);return we}{const we=[];for(const Pe of this._feature.geometry){const Ze=[];for(const yt of Pe)Ze.push(new t.P(yt[0],yt[1]));we.push(Ze)}return we}}toGeoJSON(we,Pe,Ze){return $e.call(this,we,Pe,Ze)}}class Oe{constructor(we){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.ag,this.length=we.length,this._features=we}feature(we){return new Le(this._features[we])}}const Ve=64/4096,Ue=128;class qe{constructor(){this.features=new Map}clear(){this.features.clear()}load(we=[],Pe){for(const Ze of we){const yt=Ze.id;if(yt==null)continue;let We=this.features.get(yt);We&&this.updateCache(We,Pe),Ze.geometry?(We=nt(Ze),this.updateCache(We,Pe),this.features.set(yt,We)):this.features.delete(yt),this.updateCache(We,Pe)}}updateCache(we,Pe){for(const{canonical:Ze,uid:yt}of Object.values(Pe)){const{z:We,x:pt,y:kt}=Ze;He(we,Math.pow(2,We),pt,kt)&&delete Pe[yt]}}getTile(we,Pe,Ze){const yt=Math.pow(2,we),We=[];for(const pt of this.features.values())He(pt,yt,Pe,Ze)&&We.push(hn(pt,yt,Pe,Ze));return{features:We}}getFeatures(){return[...this.features.values()]}}function He({minX:et,minY:we,maxX:Pe,maxY:Ze},yt,We,pt){return et<(We+1+Ve)/yt&&we<(pt+1+Ve)/yt&&Pe>(We-Ve)/yt&&Ze>(pt-Ve)/yt}function nt(et){const{id:we,geometry:Pe,properties:Ze}=et;if(!Pe)return;if(Pe.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:yt,coordinates:We}=Pe,pt={id:we,type:1,geometry:[],tags:Ze,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},kt=pt.geometry;if(yt==="Point")rt(We,kt,pt);else if(yt==="MultiPoint")for(const Dt of We)rt(Dt,kt,pt);else if(yt==="LineString")pt.type=2,ft(We,kt,pt);else if(yt==="MultiLineString")pt.type=2,$t(We,kt,pt);else if(yt==="Polygon")pt.type=3,$t(We,kt,pt,!0);else{if(yt!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");pt.type=3;for(const Dt of We)$t(Dt,kt,pt,!0)}return pt}function rt([et,we],Pe,Ze){const yt=t.at(et);let We=t.aA(we);We=We<0?0:We>1?1:We,Pe.push(yt,We),Ze.minX=Math.min(Ze.minX,yt),Ze.minY=Math.min(Ze.minY,We),Ze.maxX=Math.max(Ze.maxX,yt),Ze.maxY=Math.max(Ze.maxY,We)}function ft(et,we,Pe,Ze=!1,yt=!1){const We=[];for(const pt of et)rt(pt,We,Pe);we.push(We),Ze&&function(pt,kt){let Dt=0;for(let Jt=0,Xt=pt.length,Gt=Xt-2;Jt<Xt;Gt=Jt,Jt+=2)Dt+=(pt[Jt]-pt[Gt])*(pt[Jt+1]+pt[Gt+1]);if(Dt>0===kt)for(let Jt=0,Xt=pt.length;Jt<Xt/2;Jt+=2){const Gt=pt[Jt],On=pt[Jt+1];pt[Jt]=pt[Xt-2-Jt],pt[Jt+1]=pt[Xt-1-Jt],pt[Xt-2-Jt]=Gt,pt[Xt-1-Jt]=On}}(We,yt)}function $t(et,we,Pe,Ze=!1){for(let yt=0;yt<et.length;yt++)ft(et[yt],we,Pe,Ze,yt===0)}function hn(et,we,Pe,Ze){const{id:yt,type:We,geometry:pt,tags:kt}=et,Dt=[];if(We===1)(function(Jt,Xt,Gt,On,_i){for(let li=0;li<Jt.length;li+=2){const Ui=Math.round(t.ag*(Jt[li+0]*Xt-Gt)),qi=Math.round(t.ag*(Jt[li+1]*Xt-On));_i.push([Ui,qi])}})(pt,we,Pe,Ze,Dt);else for(const Jt of pt)gn(Jt,we,Pe,Ze,Dt);return{id:yt,type:We,geometry:Dt,tags:kt}}function gn(et,we,Pe,Ze,yt){const pt=t.ag+Ue;let kt;for(let Dt=0;Dt<et.length-2;Dt+=2){let Jt=Math.round(t.ag*(et[Dt+0]*we-Pe)),Xt=Math.round(t.ag*(et[Dt+1]*we-Ze)),Gt=Math.round(t.ag*(et[Dt+2]*we-Pe)),On=Math.round(t.ag*(et[Dt+3]*we-Ze));const _i=Gt-Jt,li=On-Xt;Jt<-128&&Gt<-128||(Jt<-128?(Xt+=Math.round(li*((-128-Jt)/_i)),Jt=-128):Gt<-128&&(On=Xt+Math.round(li*((-128-Jt)/_i)),Gt=-128),Xt<-128&&On<-128||(Xt<-128?(Jt+=Math.round(_i*((-128-Xt)/li)),Xt=-128):On<-128&&(Gt=Jt+Math.round(_i*((-128-Xt)/li)),On=-128),Jt>=pt&&Gt>=pt||(Jt>=pt?(Xt+=Math.round(li*((pt-Jt)/_i)),Jt=pt):Gt>=pt&&(On=Xt+Math.round(li*((pt-Jt)/_i)),Gt=pt),Xt>=pt&&On>=pt||(Xt>=pt?(Jt+=Math.round(_i*((pt-Xt)/li)),Xt=pt):On>=pt&&(Gt=Jt+Math.round(_i*((pt-Xt)/li)),On=pt),kt&&Jt===kt[kt.length-1][0]&&Xt===kt[kt.length-1][1]||(kt=[[Jt,Xt]],yt.push(kt)),kt.push([Gt,On])))))}}var pn,ri,ai,_n={exports:{}},Bn=function(){if(ai)return _n.exports;ai=1;var et=t.e7(),we=function(){if(ri)return pn;ri=1;var Xt=t.e5(),Gt=t.e6().VectorTileFeature;function On(li,Ui){this.options=Ui||{},this.features=li,this.length=li.length}function _i(li,Ui){this.id=typeof li.id=="number"?li.id:void 0,this.type=li.type,this.rawGeometry=li.type===1?[li.geometry]:li.geometry,this.properties=li.tags,this.extent=Ui||4096}return pn=On,On.prototype.feature=function(li){return new _i(this.features[li],this.options.extent)},_i.prototype.loadGeometry=function(){var li=this.rawGeometry;this.geometry=[];for(var Ui=0;Ui<li.length;Ui++){for(var qi=li[Ui],Qi=[],Ni=0;Ni<qi.length;Ni++)Qi.push(new Xt(qi[Ni][0],qi[Ni][1]));this.geometry.push(Qi)}return this.geometry},_i.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var li=this.geometry,Ui=1/0,qi=-1/0,Qi=1/0,Ni=-1/0,Jr=0;Jr<li.length;Jr++)for(var Nr=li[Jr],kr=0;kr<Nr.length;kr++){var Zr=Nr[kr];Ui=Math.min(Ui,Zr.x),qi=Math.max(qi,Zr.x),Qi=Math.min(Qi,Zr.y),Ni=Math.max(Ni,Zr.y)}return[Ui,Qi,qi,Ni]},_i.prototype.toGeoJSON=Gt.prototype.toGeoJSON,pn}();function Pe(Xt){var Gt=new et;return function(On,_i){for(var li in On.layers)_i.writeMessage(3,Ze,On.layers[li])}(Xt,Gt),Gt.finish()}function Ze(Xt,Gt){var On;Gt.writeVarintField(15,Xt.version||1),Gt.writeStringField(1,Xt.name||""),Gt.writeVarintField(5,Xt.extent||4096);var _i={keys:[],values:[],keycache:{},valuecache:{}};for(On=0;On<Xt.length;On++)_i.feature=Xt.feature(On),Gt.writeMessage(2,yt,_i);var li=_i.keys;for(On=0;On<li.length;On++)Gt.writeStringField(3,li[On]);var Ui=_i.values;for(On=0;On<Ui.length;On++)Gt.writeMessage(4,Jt,Ui[On])}function yt(Xt,Gt){var On=Xt.feature;On.id!==void 0&&Gt.writeVarintField(1,On.id),Gt.writeMessage(2,We,Xt),Gt.writeVarintField(3,On.type),Gt.writeMessage(4,Dt,On)}function We(Xt,Gt){var On=Xt.feature,_i=Xt.keys,li=Xt.values,Ui=Xt.keycache,qi=Xt.valuecache;for(var Qi in On.properties){var Ni=On.properties[Qi],Jr=Ui[Qi];if(Ni!==null){Jr===void 0&&(_i.push(Qi),Ui[Qi]=Jr=_i.length-1),Gt.writeVarint(Jr);var Nr=typeof Ni;Nr!=="string"&&Nr!=="boolean"&&Nr!=="number"&&(Ni=JSON.stringify(Ni));var kr=Nr+":"+Ni,Zr=qi[kr];Zr===void 0&&(li.push(Ni),qi[kr]=Zr=li.length-1),Gt.writeVarint(Zr)}}}function pt(Xt,Gt){return(Gt<<3)+(7&Xt)}function kt(Xt){return Xt<<1^Xt>>31}function Dt(Xt,Gt){for(var On=Xt.loadGeometry(),_i=Xt.type,li=0,Ui=0,qi=On.length,Qi=0;Qi<qi;Qi++){var Ni=On[Qi],Jr=1;_i===1&&(Jr=Ni.length),Gt.writeVarint(pt(1,Jr));for(var Nr=_i===3?Ni.length-1:Ni.length,kr=0;kr<Nr;kr++){kr===1&&_i!==1&&Gt.writeVarint(pt(2,Nr-1));var Zr=Ni[kr].x-li,Xr=Ni[kr].y-Ui;Gt.writeVarint(kt(Zr)),Gt.writeVarint(kt(Xr)),li+=Zr,Ui+=Xr}_i===3&&Gt.writeVarint(pt(7,1))}}function Jt(Xt,Gt){var On=typeof Xt;On==="string"?Gt.writeStringField(1,Xt):On==="boolean"?Gt.writeBooleanField(7,Xt):On==="number"&&(Xt%1!=0?Gt.writeDoubleField(3,Xt):Xt<0?Gt.writeSVarintField(6,Xt):Gt.writeVarintField(5,Xt))}return _n.exports=Pe,_n.exports.fromVectorTileJs=Pe,_n.exports.fromGeojsonVt=function(Xt,Gt){Gt=Gt||{};var On={};for(var _i in Xt)On[_i]=new we(Xt[_i].features,Gt),On[_i].name=_i,On[_i].version=Gt.version,On[_i].extent=Gt.extent;return Pe({layers:On})},_n.exports.GeoJSONWrapper=we,_n.exports}(),mn=t.e8(Bn);const Nn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:et=>et},Pn=Math.fround||(Ci=new Float32Array(1),et=>(Ci[0]=+et,Ci[0]));var Ci;const Fi=3,Ln=5,sn=6;class qn{constructor(we){this.options=Object.assign(Object.create(Nn),we),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(we){const{log:Pe,minZoom:Ze,maxZoom:yt}=this.options;Pe&&console.time("total time");const We=`prepare ${we.length} points`;Pe&&console.time(We),this.points=we;const pt=[];for(let Dt=0;Dt<we.length;Dt++){const Jt=we[Dt];if(!Jt.geometry)continue;const[Xt,Gt]=Jt.geometry.coordinates,On=Pn(Zn(Xt)),_i=Pn(St(Gt));pt.push(On,_i,1/0,Dt,-1,1),this.options.reduce&&pt.push(0)}let kt=this.trees[yt+1]=this._createTree(pt);Pe&&console.timeEnd(We);for(let Dt=yt;Dt>=Ze;Dt--){const Jt=+Date.now();kt=this.trees[Dt]=this._createTree(this._cluster(kt,Dt)),Pe&&console.log("z%d: %d clusters in %dms",Dt,kt.numItems,+Date.now()-Jt)}return Pe&&console.timeEnd("total time"),this}getClusters(we,Pe){let Ze=((we[0]+180)%360+360)%360-180;const yt=Math.max(-90,Math.min(90,we[1]));let We=we[2]===180?180:((we[2]+180)%360+360)%360-180;const pt=Math.max(-90,Math.min(90,we[3]));if(we[2]-we[0]>=360)Ze=-180,We=180;else if(Ze>We){const Gt=this.getClusters([Ze,yt,180,pt],Pe),On=this.getClusters([-180,yt,We,pt],Pe);return Gt.concat(On)}const kt=this.trees[this._limitZoom(Pe)],Dt=kt.range(Zn(Ze),St(pt),Zn(We),St(yt)),Jt=kt.data,Xt=[];for(const Gt of Dt){const On=this.stride*Gt;Xt.push(Jt[On+Ln]>1?pi(Jt,On,this.clusterProps):this.points[Jt[On+Fi]])}return Xt}getChildren(we){const Pe=this._getOriginId(we),Ze=this._getOriginZoom(we),yt="No cluster with the specified id.",We=this.trees[Ze];if(!We)throw new Error(yt);const pt=We.data;if(Pe*this.stride>=pt.length)throw new Error(yt);const kt=this.options.radius/(this.options.extent*Math.pow(2,Ze-1)),Dt=We.within(pt[Pe*this.stride],pt[Pe*this.stride+1],kt),Jt=[];for(const Xt of Dt){const Gt=Xt*this.stride;pt[Gt+4]===we&&Jt.push(pt[Gt+Ln]>1?pi(pt,Gt,this.clusterProps):this.points[pt[Gt+Fi]])}if(Jt.length===0)throw new Error(yt);return Jt}getLeaves(we,Pe,Ze){const yt=[];return this._appendLeaves(yt,we,Pe=Pe||10,Ze=Ze||0,0),yt}getTile(we,Pe,Ze){const yt=this.trees[this._limitZoom(we)],We=Math.pow(2,we),{extent:pt,radius:kt}=this.options,Dt=kt/pt,Jt=(Ze-Dt)/We,Xt=(Ze+1+Dt)/We,Gt={features:[]};return this._addTileFeatures(yt.range((Pe-Dt)/We,Jt,(Pe+1+Dt)/We,Xt),yt.data,Pe,Ze,We,Gt),Pe===0&&this._addTileFeatures(yt.range(1-Dt/We,Jt,1,Xt),yt.data,We,Ze,We,Gt),Pe===We-1&&this._addTileFeatures(yt.range(0,Jt,Dt/We,Xt),yt.data,-1,Ze,We,Gt),Gt.features.length?Gt:null}getClusterExpansionZoom(we){let Pe=this._getOriginZoom(we)-1;for(;Pe<=this.options.maxZoom;){const Ze=this.getChildren(we);if(Pe++,Ze.length!==1)break;we=Ze[0].properties.cluster_id}return Pe}_appendLeaves(we,Pe,Ze,yt,We){const pt=this.getChildren(Pe);for(const kt of pt){const Dt=kt.properties;if(Dt&&Dt.cluster?We+Dt.point_count<=yt?We+=Dt.point_count:We=this._appendLeaves(we,Dt.cluster_id,Ze,yt,We):We<yt?We++:we.push(kt),we.length===Ze)break}return We}_createTree(we){const Pe=new t.bE(we.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Ze=0;Ze<we.length;Ze+=this.stride)Pe.add(we[Ze],we[Ze+1]);return Pe.finish(),Pe.data=we,Pe}_addTileFeatures(we,Pe,Ze,yt,We,pt){for(const kt of we){const Dt=kt*this.stride,Jt=Pe[Dt+Ln]>1;let Xt,Gt,On;if(Jt)Xt=ht(Pe,Dt,this.clusterProps),Gt=Pe[Dt],On=Pe[Dt+1];else{const Ui=this.points[Pe[Dt+Fi]];Xt=Ui.properties;const[qi,Qi]=Ui.geometry.coordinates;Gt=Zn(qi),On=St(Qi)}const _i={type:1,geometry:[[Math.round(this.options.extent*(Gt*We-Ze)),Math.round(this.options.extent*(On*We-yt))]],tags:Xt};let li;li=Jt||this.options.generateId?Pe[Dt+Fi]:this.points[Pe[Dt+Fi]].id,li!==void 0&&(_i.id=li),pt.features.push(_i)}}_limitZoom(we){return Math.max(this.options.minZoom,Math.min(Math.floor(+we),this.options.maxZoom+1))}_cluster(we,Pe){const{radius:Ze,extent:yt,reduce:We,minPoints:pt}=this.options,kt=Ze/(yt*Math.pow(2,Pe)),Dt=we.data,Jt=[],Xt=this.stride;for(let Gt=0;Gt<Dt.length;Gt+=Xt){if(Dt[Gt+2]<=Pe)continue;Dt[Gt+2]=Pe;const On=Dt[Gt],_i=Dt[Gt+1],li=we.within(Dt[Gt],Dt[Gt+1],kt),Ui=Dt[Gt+Ln];let qi=Ui;for(const Qi of li){const Ni=Qi*Xt;Dt[Ni+2]>Pe&&(qi+=Dt[Ni+Ln])}if(qi>Ui&&qi>=pt){let Qi,Ni=On*Ui,Jr=_i*Ui,Nr=-1;const kr=(Gt/Xt<<5)+(Pe+1)+this.points.length;for(const Zr of li){const Xr=Zr*Xt;if(Dt[Xr+2]<=Pe)continue;Dt[Xr+2]=Pe;const xs=Dt[Xr+Ln];Ni+=Dt[Xr]*xs,Jr+=Dt[Xr+1]*xs,Dt[Xr+4]=kr,We&&(Qi||(Qi=this._map(Dt,Gt,!0),Nr=this.clusterProps.length,this.clusterProps.push(Qi)),We(Qi,this._map(Dt,Xr)))}Dt[Gt+4]=kr,Jt.push(Ni/qi,Jr/qi,1/0,kr,-1,qi),We&&Jt.push(Nr)}else{for(let Qi=0;Qi<Xt;Qi++)Jt.push(Dt[Gt+Qi]);if(qi>1)for(const Qi of li){const Ni=Qi*Xt;if(!(Dt[Ni+2]<=Pe)){Dt[Ni+2]=Pe;for(let Jr=0;Jr<Xt;Jr++)Jt.push(Dt[Ni+Jr])}}}}return Jt}_getOriginId(we){return we-this.points.length>>5}_getOriginZoom(we){return(we-this.points.length)%32}_map(we,Pe,Ze){if(we[Pe+Ln]>1){const pt=this.clusterProps[we[Pe+sn]];return Ze?Object.assign({},pt):pt}const yt=this.points[we[Pe+Fi]].properties,We=this.options.map(yt);return Ze&&We===yt?Object.assign({},We):We}}function pi(et,we,Pe){return{type:"Feature",id:et[we+Fi],properties:ht(et,we,Pe),geometry:{type:"Point",coordinates:[(Ze=et[we],360*(Ze-.5)),mt(et[we+1])]}};var Ze}function ht(et,we,Pe){const Ze=et[we+Ln],yt=Ze>=1e4?`${Math.round(Ze/1e3)}k`:Ze>=1e3?Math.round(Ze/100)/10+"k":Ze,We=et[we+sn],pt=We===-1?{}:Object.assign({},Pe[We]);return Object.assign(pt,{cluster:!0,cluster_id:et[we+Fi],point_count:Ze,point_count_abbreviated:yt})}function Zn(et){return et/360+.5}function St(et){const we=Math.sin(et*Math.PI/180),Pe=.5-.25*Math.log((1+we)/(1-we))/Math.PI;return Pe<0?0:Pe>1?1:Pe}function mt(et){const we=(180-360*et)*Math.PI/180;return 360*Math.atan(Math.exp(we))/Math.PI-90}function at(et,we,Pe,Ze){let yt=Ze;const We=we+(Pe-we>>1);let pt,kt=Pe-we;const Dt=et[we],Jt=et[we+1],Xt=et[Pe],Gt=et[Pe+1];for(let On=we+3;On<Pe;On+=3){const _i=Tn(et[On],et[On+1],Dt,Jt,Xt,Gt);if(_i>yt)pt=On,yt=_i;else if(_i===yt){const li=Math.abs(On-We);li<kt&&(pt=On,kt=li)}}yt>Ze&&(pt-we>3&&at(et,we,pt,Ze),et[pt+2]=yt,Pe-pt>3&&at(et,pt,Pe,Ze))}function Tn(et,we,Pe,Ze,yt,We){let pt=yt-Pe,kt=We-Ze;if(pt!==0||kt!==0){const Dt=((et-Pe)*pt+(we-Ze)*kt)/(pt*pt+kt*kt);Dt>1?(Pe=yt,Ze=We):Dt>0&&(Pe+=pt*Dt,Ze+=kt*Dt)}return pt=et-Pe,kt=we-Ze,pt*pt+kt*kt}function bn(et,we,Pe,Ze){const yt={id:et??null,type:we,geometry:Pe,tags:Ze,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(we==="Point"||we==="MultiPoint"||we==="LineString")Cn(yt,Pe);else if(we==="Polygon")Cn(yt,Pe[0]);else if(we==="MultiLineString")for(const We of Pe)Cn(yt,We);else if(we==="MultiPolygon")for(const We of Pe)Cn(yt,We[0]);return yt}function Cn(et,we){for(let Pe=0;Pe<we.length;Pe+=3)et.minX=Math.min(et.minX,we[Pe]),et.minY=Math.min(et.minY,we[Pe+1]),et.maxX=Math.max(et.maxX,we[Pe]),et.maxY=Math.max(et.maxY,we[Pe+1])}function zn(et,we,Pe,Ze){if(!we.geometry)return;const yt=we.geometry.coordinates;if(yt&&yt.length===0)return;const We=we.geometry.type,pt=Math.pow(Pe.tolerance/((1<<Pe.maxZoom)*Pe.extent),2);let kt=[],Dt=we.id;if(Pe.promoteId?Dt=we.properties[Pe.promoteId]:Pe.generateId&&(Dt=Ze||0),We==="Point")vi(yt,kt);else if(We==="MultiPoint")for(const Jt of yt)vi(Jt,kt);else if(We==="LineString")ii(yt,kt,pt,!1);else if(We==="MultiLineString"){if(Pe.lineMetrics){for(const Jt of yt)kt=[],ii(Jt,kt,pt,!1),et.push(bn(Dt,"LineString",kt,we.properties));return}wi(yt,kt,pt,!1)}else if(We==="Polygon")wi(yt,kt,pt,!0);else{if(We!=="MultiPolygon"){if(We==="GeometryCollection"){for(const Jt of we.geometry.geometries)zn(et,{id:Dt,geometry:Jt,properties:we.properties},Pe,Ze);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Jt of yt){const Xt=[];wi(Jt,Xt,pt,!0),kt.push(Xt)}}et.push(bn(Dt,We,kt,we.properties))}function vi(et,we){we.push(Ki(et[0]),Vi(et[1]),0)}function ii(et,we,Pe,Ze){let yt,We,pt=0;for(let Dt=0;Dt<et.length;Dt++){const Jt=Ki(et[Dt][0]),Xt=Vi(et[Dt][1]);we.push(Jt,Xt,0),Dt>0&&(pt+=Ze?(yt*Xt-Jt*We)/2:Math.sqrt(Math.pow(Jt-yt,2)+Math.pow(Xt-We,2))),yt=Jt,We=Xt}const kt=we.length-3;we[2]=1,at(we,0,kt,Pe),we[kt+2]=1,we.size=Math.abs(pt),we.start=0,we.end=we.size}function wi(et,we,Pe,Ze){for(let yt=0;yt<et.length;yt++){const We=[];ii(et[yt],We,Pe,Ze),we.push(We)}}function Ki(et){return et/360+.5}function Vi(et){const we=Math.sin(et*Math.PI/180),Pe=.5-.25*Math.log((1+we)/(1-we))/Math.PI;return Pe<0?0:Pe>1?1:Pe}function ui(et,we,Pe,Ze,yt,We,pt,kt){if(Ze/=we,We>=(Pe/=we)&&pt<Ze)return et;if(pt<Pe||We>=Ze)return null;const Dt=[];for(const Jt of et){const Xt=Jt.geometry;let Gt=Jt.type;const On=yt===0?Jt.minX:Jt.minY,_i=yt===0?Jt.maxX:Jt.maxY;if(On>=Pe&&_i<Ze){Dt.push(Jt);continue}if(_i<Pe||On>=Ze)continue;let li=[];if(Gt==="Point"||Gt==="MultiPoint")pr(Xt,li,Pe,Ze,yt);else if(Gt==="LineString")Er(Xt,li,Pe,Ze,yt,!1,kt.lineMetrics);else if(Gt==="MultiLineString")Ar(Xt,li,Pe,Ze,yt,!1);else if(Gt==="Polygon")Ar(Xt,li,Pe,Ze,yt,!0);else if(Gt==="MultiPolygon")for(const Ui of Xt){const qi=[];Ar(Ui,qi,Pe,Ze,yt,!0),qi.length&&li.push(qi)}if(li.length){if(kt.lineMetrics&&Gt==="LineString"){for(const Ui of li)Dt.push(bn(Jt.id,Gt,Ui,Jt.tags));continue}Gt!=="LineString"&&Gt!=="MultiLineString"||(li.length===1?(Gt="LineString",li=li[0]):Gt="MultiLineString"),Gt!=="Point"&&Gt!=="MultiPoint"||(Gt=li.length===3?"Point":"MultiPoint"),Dt.push(bn(Jt.id,Gt,li,Jt.tags))}}return Dt.length?Dt:null}function pr(et,we,Pe,Ze,yt){for(let We=0;We<et.length;We+=3){const pt=et[We+yt];pt>=Pe&&pt<=Ze&&Ta(we,et[We],et[We+1],et[We+2])}}function Er(et,we,Pe,Ze,yt,We,pt){let kt=sa(et);const Dt=yt===0?Qa:Os;let Jt,Xt,Gt=et.start;for(let qi=0;qi<et.length-3;qi+=3){const Qi=et[qi],Ni=et[qi+1],Jr=et[qi+2],Nr=et[qi+3],kr=et[qi+4],Zr=yt===0?Qi:Ni,Xr=yt===0?Nr:kr;let xs=!1;pt&&(Jt=Math.sqrt(Math.pow(Qi-Nr,2)+Math.pow(Ni-kr,2))),Zr<Pe?Xr>Pe&&(Xt=Dt(kt,Qi,Ni,Nr,kr,Pe),pt&&(kt.start=Gt+Jt*Xt)):Zr>Ze?Xr<Ze&&(Xt=Dt(kt,Qi,Ni,Nr,kr,Ze),pt&&(kt.start=Gt+Jt*Xt)):Ta(kt,Qi,Ni,Jr),Xr<Pe&&Zr>=Pe&&(Xt=Dt(kt,Qi,Ni,Nr,kr,Pe),xs=!0),Xr>Ze&&Zr<=Ze&&(Xt=Dt(kt,Qi,Ni,Nr,kr,Ze),xs=!0),!We&&xs&&(pt&&(kt.end=Gt+Jt*Xt),we.push(kt),kt=sa(et)),pt&&(Gt+=Jt)}let On=et.length-3;const _i=et[On],li=et[On+1],Ui=yt===0?_i:li;Ui>=Pe&&Ui<=Ze&&Ta(kt,_i,li,et[On+2]),On=kt.length-3,We&&On>=3&&(kt[On]!==kt[0]||kt[On+1]!==kt[1])&&Ta(kt,kt[0],kt[1],kt[2]),kt.length&&we.push(kt)}function sa(et){const we=[];return we.size=et.size,we.start=et.start,we.end=et.end,we}function Ar(et,we,Pe,Ze,yt,We){for(const pt of et)Er(pt,we,Pe,Ze,yt,We,!1)}function Ta(et,we,Pe,Ze){et.push(we,Pe,Ze)}function Qa(et,we,Pe,Ze,yt,We){const pt=(We-we)/(Ze-we);return Ta(et,We,Pe+(yt-Pe)*pt,1),pt}function Os(et,we,Pe,Ze,yt,We){const pt=(We-Pe)/(yt-Pe);return Ta(et,we+(Ze-we)*pt,We,1),pt}function As(et,we){const Pe=[];for(let Ze=0;Ze<et.length;Ze++){const yt=et[Ze],We=yt.type;let pt;if(We==="Point"||We==="MultiPoint"||We==="LineString")pt=to(yt.geometry,we);else if(We==="MultiLineString"||We==="Polygon"){pt=[];for(const kt of yt.geometry)pt.push(to(kt,we))}else if(We==="MultiPolygon"){pt=[];for(const kt of yt.geometry){const Dt=[];for(const Jt of kt)Dt.push(to(Jt,we));pt.push(Dt)}}Pe.push(bn(yt.id,We,pt,yt.tags))}return Pe}function to(et,we){const Pe=[];Pe.size=et.size,et.start!==void 0&&(Pe.start=et.start,Pe.end=et.end);for(let Ze=0;Ze<et.length;Ze+=3)Pe.push(et[Ze]+we,et[Ze+1],et[Ze+2]);return Pe}function ko(et,we){if(et.transformed)return et;const Pe=1<<et.z,Ze=et.x,yt=et.y;for(const We of et.features){const pt=We.geometry,kt=We.type;if(We.geometry=[],kt===1)for(let Dt=0;Dt<pt.length;Dt+=2)We.geometry.push(bt(pt[Dt],pt[Dt+1],we,Pe,Ze,yt));else for(let Dt=0;Dt<pt.length;Dt++){const Jt=[];for(let Xt=0;Xt<pt[Dt].length;Xt+=2)Jt.push(bt(pt[Dt][Xt],pt[Dt][Xt+1],we,Pe,Ze,yt));We.geometry.push(Jt)}}return et.transformed=!0,et}function bt(et,we,Pe,Ze,yt,We){return[Math.round(Pe*(et*Ze-yt)),Math.round(Pe*(we*Ze-We))]}function Qe(et,we,Pe,Ze,yt){const We=we===yt.maxZoom?0:yt.tolerance/((1<<we)*yt.extent),pt={features:[],numPoints:0,numSimplified:0,numFeatures:et.length,source:null,x:Pe,y:Ze,z:we,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const kt of et)dt(pt,kt,We,yt);return pt}function dt(et,we,Pe,Ze){const yt=we.geometry,We=we.type,pt=[];if(et.minX=Math.min(et.minX,we.minX),et.minY=Math.min(et.minY,we.minY),et.maxX=Math.max(et.maxX,we.maxX),et.maxY=Math.max(et.maxY,we.maxY),We==="Point"||We==="MultiPoint")for(let kt=0;kt<yt.length;kt+=3)pt.push(yt[kt],yt[kt+1]),et.numPoints++,et.numSimplified++;else if(We==="LineString")it(pt,yt,et,Pe,!1,!1);else if(We==="MultiLineString"||We==="Polygon")for(let kt=0;kt<yt.length;kt++)it(pt,yt[kt],et,Pe,We==="Polygon",kt===0);else if(We==="MultiPolygon")for(let kt=0;kt<yt.length;kt++){const Dt=yt[kt];for(let Jt=0;Jt<Dt.length;Jt++)it(pt,Dt[Jt],et,Pe,!0,Jt===0)}if(pt.length){let kt=we.tags||null;if(We==="LineString"&&Ze.lineMetrics){kt={};for(const Jt in we.tags)kt[Jt]=we.tags[Jt];kt.mapbox_clip_start=yt.start/yt.size,kt.mapbox_clip_end=yt.end/yt.size}const Dt={geometry:pt,type:We==="Polygon"||We==="MultiPolygon"?3:We==="LineString"||We==="MultiLineString"?2:1,tags:kt};we.id!==null&&(Dt.id=we.id),et.features.push(Dt)}}function it(et,we,Pe,Ze,yt,We){const pt=Ze*Ze;if(Ze>0&&we.size<(yt?pt:Ze))return void(Pe.numPoints+=we.length/3);const kt=[];for(let Dt=0;Dt<we.length;Dt+=3)(Ze===0||we[Dt+2]>pt)&&(Pe.numSimplified++,kt.push(we[Dt],we[Dt+1])),Pe.numPoints++;yt&&function(Dt,Jt){let Xt=0;for(let Gt=0,On=Dt.length,_i=On-2;Gt<On;_i=Gt,Gt+=2)Xt+=(Dt[Gt]-Dt[_i])*(Dt[Gt+1]+Dt[_i+1]);if(Xt>0===Jt)for(let Gt=0,On=Dt.length;Gt<On/2;Gt+=2){const _i=Dt[Gt],li=Dt[Gt+1];Dt[Gt]=Dt[On-2-Gt],Dt[Gt+1]=Dt[On-1-Gt],Dt[On-2-Gt]=_i,Dt[On-1-Gt]=li}}(kt,We),et.push(kt)}const Ut={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class on{constructor(we,Pe){const Ze=(Pe=this.options=function(We,pt){for(const kt in pt)We[kt]=pt[kt];return We}(Object.create(Ut),Pe)).debug;if(Ze&&console.time("preprocess data"),Pe.maxZoom<0||Pe.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(Pe.promoteId&&Pe.generateId)throw new Error("promoteId and generateId cannot be used together.");let yt=function(We,pt){const kt=[];if(We.type==="FeatureCollection")for(let Dt=0;Dt<We.features.length;Dt++)zn(kt,We.features[Dt],pt,Dt);else zn(kt,We.type==="Feature"?We:{geometry:We},pt);return kt}(we,Pe);this.tiles={},this.tileCoords=[],Ze&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",Pe.indexMaxZoom,Pe.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),yt=function(We,pt){const kt=pt.buffer/pt.extent;let Dt=We;const Jt=ui(We,1,-1-kt,kt,0,-1,2,pt),Xt=ui(We,1,1-kt,2+kt,0,-1,2,pt);return(Jt||Xt)&&(Dt=ui(We,1,-kt,1+kt,0,-1,2,pt)||[],Jt&&(Dt=As(Jt,1).concat(Dt)),Xt&&(Dt=Dt.concat(As(Xt,-1)))),Dt}(yt,Pe),yt.length&&this.splitTile(yt,0,0,0),Ze&&(yt.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(we,Pe,Ze,yt,We,pt,kt){const Dt=[we,Pe,Ze,yt],Jt=this.options,Xt=Jt.debug;for(;Dt.length;){yt=Dt.pop(),Ze=Dt.pop(),Pe=Dt.pop(),we=Dt.pop();const Gt=1<<Pe,On=un(Pe,Ze,yt);let _i=this.tiles[On];if(!_i&&(Xt>1&&console.time("creation"),_i=this.tiles[On]=Qe(we,Pe,Ze,yt,Jt),this.tileCoords.push({z:Pe,x:Ze,y:yt}),Xt)){Xt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",Pe,Ze,yt,_i.numFeatures,_i.numPoints,_i.numSimplified),console.timeEnd("creation"));const xs=`z${Pe}`;this.stats[xs]=(this.stats[xs]||0)+1,this.total++}if(_i.source=we,We==null){if(Pe===Jt.indexMaxZoom||_i.numPoints<=Jt.indexMaxPoints)continue}else{if(Pe===Jt.maxZoom||Pe===We)continue;if(We!=null){const xs=We-Pe;if(Ze!==pt>>xs||yt!==kt>>xs)continue}}if(_i.source=null,we.length===0)continue;Xt>1&&console.time("clipping");const li=.5*Jt.buffer/Jt.extent,Ui=.5-li,qi=.5+li,Qi=1+li;let Ni=null,Jr=null,Nr=null,kr=null,Zr=ui(we,Gt,Ze-li,Ze+qi,0,_i.minX,_i.maxX,Jt),Xr=ui(we,Gt,Ze+Ui,Ze+Qi,0,_i.minX,_i.maxX,Jt);we=null,Zr&&(Ni=ui(Zr,Gt,yt-li,yt+qi,1,_i.minY,_i.maxY,Jt),Jr=ui(Zr,Gt,yt+Ui,yt+Qi,1,_i.minY,_i.maxY,Jt),Zr=null),Xr&&(Nr=ui(Xr,Gt,yt-li,yt+qi,1,_i.minY,_i.maxY,Jt),kr=ui(Xr,Gt,yt+Ui,yt+Qi,1,_i.minY,_i.maxY,Jt),Xr=null),Xt>1&&console.timeEnd("clipping"),Dt.push(Ni||[],Pe+1,2*Ze,2*yt),Dt.push(Jr||[],Pe+1,2*Ze,2*yt+1),Dt.push(Nr||[],Pe+1,2*Ze+1,2*yt),Dt.push(kr||[],Pe+1,2*Ze+1,2*yt+1)}}getTile(we,Pe,Ze){we=+we,Pe=+Pe,Ze=+Ze;const yt=this.options,{extent:We,debug:pt}=yt;if(we<0||we>24)return null;const kt=1<<we,Dt=un(we,Pe=Pe+kt&kt-1,Ze);if(this.tiles[Dt])return ko(this.tiles[Dt],We);pt>1&&console.log("drilling down to z%d-%d-%d",we,Pe,Ze);let Jt,Xt=we,Gt=Pe,On=Ze;for(;!Jt&&Xt>0;)Xt--,Gt>>=1,On>>=1,Jt=this.tiles[un(Xt,Gt,On)];return Jt&&Jt.source?(pt>1&&(console.log("found parent tile z%d-%d-%d",Xt,Gt,On),console.time("drilling down")),this.splitTile(Jt.source,Xt,Gt,On,we,Pe,Ze),pt>1&&console.timeEnd("drilling down"),this.tiles[Dt]?ko(this.tiles[Dt],We):null):null}}function un(et,we,Pe){return 32*((1<<et)*Pe+we)+et}function kn(et,we){const Pe=et.tileID.canonical;if(!this._geoJSONIndex)return void we(null,null);const Ze=this._geoJSONIndex.getTile(Pe.z,Pe.x,Pe.y);if(!Ze)return void we(null,null);const yt=new Oe(Ze.features);let We=mn(yt);We.byteOffset===0&&We.byteLength===We.buffer.byteLength||(We=new Uint8Array(We)),we(null,{vectorTile:yt,rawData:We.buffer})}class fn extends pe{constructor(we,Pe,Ze,yt,We,pt){super(we,Pe,Ze,yt,kn,pt),We&&(this.loadGeoJSON=We),this._dynamicIndex=new qe}loadData(we,Pe){const Ze=we&&we.request,yt=Ze&&Ze.collectResourceTiming;this.loadGeoJSON(we,(We,pt)=>{if(We||!pt)return Pe(We);if(typeof pt!="object")return Pe(new Error(`Input data given to '${we.source}' is not a valid GeoJSON object.`));{try{if(we.filter){const Dt=t.U(we.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Dt.result==="error")throw new Error(Dt.value.map(Jt=>`${Jt.key}: ${Jt.message}`).join(", "));pt.features=pt.features.filter(Jt=>Dt.value.evaluate({zoom:0},Jt))}we.dynamic?(pt.type==="Feature"&&(pt={type:"FeatureCollection",features:[pt]}),we.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(pt.features,this.loaded),we.cluster&&(pt.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=we.cluster?new qn(function({superclusterOptions:Dt,clusterProperties:Jt}){if(!Jt||!Dt)return Dt;const Xt={},Gt={},On={accumulated:null,zoom:0},_i={properties:null},li=Object.keys(Jt);for(const Ui of li){const[qi,Qi]=Jt[Ui],Ni=t.U(Qi),Jr=t.U(typeof qi=="string"?[qi,["accumulated"],["get",Ui]]:qi);Xt[Ui]=Ni.value,Gt[Ui]=Jr.value}return Dt.map=Ui=>{_i.properties=Ui;const qi={};for(const Qi of li)qi[Qi]=Xt[Qi].evaluate(On,_i);return qi},Dt.reduce=(Ui,qi)=>{_i.properties=qi;for(const Qi of li)On.accumulated=Ui[Qi],Ui[Qi]=Gt[Qi].evaluate(On,_i)},Dt}(we)).load(pt.features):we.dynamic?this._dynamicIndex:function(Dt,Jt){return new on(Dt,Jt)}(pt,we.geojsonVtOptions)}catch(Dt){return Pe(Dt)}const kt={};if(yt){const Dt=G(Ze);Dt&&(kt.resourceTiming={},kt.resourceTiming[we.source]=JSON.parse(JSON.stringify(Dt)))}Pe(null,kt)}})}reloadTile(we,Pe){const Ze=this.loaded;return Ze&&Ze[we.uid]?we.partial?Pe(null,void 0):super.reloadTile(we,Pe):this.loadTile(we,Pe)}loadGeoJSON(we,Pe){if(we.request)t.n(we.request,Pe);else{if(typeof we.data!="string")return Pe(new Error(`Input data given to '${we.source}' is not a valid GeoJSON object.`));try{return Pe(null,JSON.parse(we.data))}catch{return Pe(new Error(`Input data given to '${we.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(we,Pe){try{Pe(null,this._geoJSONIndex.getClusterExpansionZoom(we.clusterId))}catch(Ze){Pe(Ze)}}getClusterChildren(we,Pe){try{Pe(null,this._geoJSONIndex.getChildren(we.clusterId))}catch(Ze){Pe(Ze)}}getClusterLeaves(we,Pe){try{Pe(null,this._geoJSONIndex.getLeaves(we.clusterId,we.limit,we.offset))}catch(Ze){Pe(Ze)}}}class Wn{constructor(we,Pe){this.tileID=new t.aG(we.tileID.overscaledZ,we.tileID.wrap,we.tileID.canonical.z,we.tileID.canonical.x,we.tileID.canonical.y),this.tileZoom=we.tileZoom,this.uid=we.uid,this.zoom=we.zoom,this.canonical=we.tileID.canonical,this.pixelRatio=we.pixelRatio,this.tileSize=we.tileSize,this.source=we.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=we.projection,this.brightness=Pe}parse(we,Pe,Ze,yt){this.status="parsing";const We=new t.aG(Ze.tileID.overscaledZ,Ze.tileID.wrap,Ze.tileID.canonical.z,Ze.tileID.canonical.x,Ze.tileID.canonical.y),pt=[],kt=Pe.familiesBySource[Ze.source],Dt=new t.dZ(We,Ze.promoteId);return Dt.bucketLayerIDs=[],Dt.is3DTile=!0,t.e9(we).then(Jt=>{if(!Jt)return yt(new Error("Could not parse tile"));const Xt=t.ea(Jt,1/t.cc(Ze.tileID.canonical)),Gt=Jt.json.extensionsUsed&&Jt.json.extensionsUsed.includes("MAPBOX_mesh_features")||Jt.json.asset.extras&&Jt.json.asset.extras.MAPBOX_mesh_features,On=Jt.json.extensionsUsed&&Jt.json.extensionsUsed.includes("EXT_meshopt_compression"),_i=new t.a8(this.zoom,{brightness:this.brightness});for(const li in kt)for(const Ui of kt[li]){const qi=Ui[0];Dt.bucketLayerIDs.push(Ui.map(Ni=>t.aC(Ni.id,Ni.scope))),qi.recalculate(_i,[]);const Qi=new t.eb(Ui,Xt,We,Gt,On,this.brightness,Dt);Gt||(Qi.needsUpload=!0),pt.push(Qi),Qi.evaluate(qi)}this.status="done",yt(null,{buckets:pt,featureIndex:Dt,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Jt=>yt(new Error(Jt.message)))}}class Gn{constructor(we,Pe,Ze,yt,We,pt){this.actor=we,this.layerIndex=Pe,this.availableImages=Ze,this.brightness=pt,this.loading={},this.loaded={}}loadTile(we,Pe){const Ze=we.uid,yt=this.loading[Ze]=new Wn(we,this.brightness);t.bi(we.request,(We,pt)=>{const kt=!this.loading[Ze];return delete this.loading[Ze],kt||We?(yt.status="done",kt||(this.loaded[Ze]=yt),Pe(We)):pt&&pt.byteLength!==0?void yt.parse(pt,this.layerIndex,we,(Dt,Jt)=>{yt.status="done",this.loaded=this.loaded||{},this.loaded[Ze]=yt,Dt||!Jt?Pe(Dt):Pe(null,Jt)}):(yt.status="done",this.loaded[Ze]=yt,Pe())})}reloadTile(we,Pe){const Ze=this.loaded,yt=we.uid;if(Ze&&Ze[yt]){const We=Ze[yt];We.projection=we.projection,We.brightness=we.brightness;const pt=(kt,Dt)=>{We.reloadCallback&&(delete We.reloadCallback,this.loadTile(we,Pe)),Pe(kt,Dt)};We.status==="parsing"?We.reloadCallback=pt:We.status==="done"&&this.loadTile(we,Pe)}}abortTile(we,Pe){const Ze=we.uid;this.loading[Ze]&&delete this.loading[Ze],Pe()}removeTile(we,Pe){const Ze=this.loaded,yt=we.uid;Ze&&Ze[yt]&&delete Ze[yt],Pe()}}class Sn{constructor(we){this.self=we,this.actor=new t.ec(we,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.imageRasterizer=new t.I,this.projections={},this.defaultProjection=t.bP({name:"mercator"}),this.workerSourceTypes={vector:pe,geojson:fn,"batched-model":Gn},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Pe,Ze)=>{if(this.workerSourceTypes[Pe])throw new Error(`Worker source with name "${Pe}" already registered.`);this.workerSourceTypes[Pe]=Ze},this.self.registerRTLTextPlugin=Pe=>{if(t.ed.isParsed())throw new Error("RTL text plugin already registered.");t.ed.applyArabicShaping=Pe.applyArabicShaping,t.ed.processBidirectionalText=Pe.processBidirectionalText,t.ed.processStyledBidirectionalText=Pe.processStyledBidirectionalText}}clearCaches(we,Pe,Ze){delete this.layerIndexes[we],delete this.availableImages[we],delete this.workerSources[we],delete this.demWorkerSources[we],delete this.rasterArrayWorkerSource,Ze()}checkIfReady(we,Pe,Ze){Ze()}setReferrer(we,Pe){this.referrer=Pe}spriteLoaded(we,{scope:Pe,isLoaded:Ze}){if(this.isSpriteLoaded[we]||(this.isSpriteLoaded[we]={}),this.isSpriteLoaded[we][Pe]=Ze,this.workerSources[we]&&this.workerSources[we][Pe])for(const yt in this.workerSources[we][Pe]){const We=this.workerSources[we][Pe][yt];for(const pt in We){const kt=We[pt];kt instanceof pe&&(kt.isSpriteLoaded=Ze,kt.fire(new t.z("isSpriteLoaded")))}}}setImages(we,{scope:Pe,images:Ze},yt){if(this.availableImages[we]||(this.availableImages[we]={}),this.availableImages[we][Pe]=Ze,this.workerSources[we]&&this.workerSources[we][Pe]){for(const We in this.workerSources[we][Pe]){const pt=this.workerSources[we][Pe][We];for(const kt in pt)pt[kt].availableImages=Ze}yt()}else yt()}setProjection(we,Pe){this.projections[we]=t.bP(Pe)}setBrightness(we,Pe,Ze){this.brightness=Pe,Ze()}setLayers(we,Pe,Ze){this.getLayerIndex(we,Pe.scope).replace(Pe.layers,Pe.options),Ze()}updateLayers(we,Pe,Ze){this.getLayerIndex(we,Pe.scope).update(Pe.layers,Pe.removedIds,Pe.options),Ze()}loadTile(we,Pe,Ze){Pe.projection=this.projections[we]||this.defaultProjection,this.getWorkerSource(we,Pe.type,Pe.source,Pe.scope).loadTile(Pe,Ze)}loadDEMTile(we,Pe,Ze){this.getDEMWorkerSource(we,Pe.source,Pe.scope).loadTile(Pe,Ze)}decodeRasterArray(we,Pe,Ze){this.getRasterArrayWorkerSource().decodeRasterArray(Pe,Ze)}reloadTile(we,Pe,Ze){Pe.projection=this.projections[we]||this.defaultProjection,this.getWorkerSource(we,Pe.type,Pe.source,Pe.scope).reloadTile(Pe,Ze)}abortTile(we,Pe,Ze){this.getWorkerSource(we,Pe.type,Pe.source,Pe.scope).abortTile(Pe,Ze)}removeTile(we,Pe,Ze){this.getWorkerSource(we,Pe.type,Pe.source,Pe.scope).removeTile(Pe,Ze)}removeSource(we,Pe,Ze){if(!(this.workerSources[we]&&this.workerSources[we][Pe.scope]&&this.workerSources[we][Pe.scope][Pe.type]&&this.workerSources[we][Pe.scope][Pe.type][Pe.source]))return;const yt=this.workerSources[we][Pe.scope][Pe.type][Pe.source];delete this.workerSources[we][Pe.scope][Pe.type][Pe.source],yt.removeSource!==void 0?yt.removeSource(Pe,Ze):Ze()}loadWorkerSource(we,Pe,Ze){try{this.self.importScripts(Pe.url),Ze()}catch(yt){Ze(yt.toString())}}syncRTLPluginState(we,Pe,Ze){try{t.ed.setState(Pe);const yt=t.ed.getPluginURL();if(t.ed.isLoaded()&&!t.ed.isParsed()&&yt!=null){this.self.importScripts(yt);const We=t.ed.isParsed();Ze(We?void 0:new Error(`RTL Text Plugin failed to import scripts from ${yt}`),We)}}catch(yt){Ze(yt.toString())}}setDracoUrl(we,Pe){this.dracoUrl=Pe}getAvailableImages(we,Pe){this.availableImages[we]||(this.availableImages[we]={});let Ze=this.availableImages[we][Pe];return Ze||(Ze=[]),Ze}getLayerIndex(we,Pe){this.layerIndexes[we]||(this.layerIndexes[we]={});let Ze=this.layerIndexes[we][Pe];return Ze||(Ze=this.layerIndexes[we][Pe]=new ne,Ze.scope=Pe),Ze}getWorkerSource(we,Pe,Ze,yt){return this.workerSources[we]||(this.workerSources[we]={}),this.workerSources[we][yt]||(this.workerSources[we][yt]={}),this.workerSources[we][yt][Pe]||(this.workerSources[we][yt][Pe]={}),this.isSpriteLoaded[we]||(this.isSpriteLoaded[we]={}),this.workerSources[we][yt][Pe][Ze]||(this.workerSources[we][yt][Pe][Ze]=new this.workerSourceTypes[Pe]({send:(We,pt,kt,Dt,Jt,Xt)=>{this.actor.send(We,pt,kt,we,Jt,Xt)},scheduler:this.actor.scheduler},this.getLayerIndex(we,yt),this.getAvailableImages(we,yt),this.isSpriteLoaded[we][yt],void 0,this.brightness)),this.workerSources[we][yt][Pe][Ze]}rasterizeImages(we,Pe,Ze){const{imageTasks:yt,scope:We}=Pe,pt={};for(const kt in yt){const{image:Dt,imageIdWithOptions:Jt}=yt[kt];pt[kt]=this.imageRasterizer.rasterize(Jt,Dt,We,we)}Ze(void 0,pt)}removeRasterizedImages(we,Pe,Ze){const{imageIds:yt,scope:We}=Pe;this.imageRasterizer.removeImagesFromCacheByIds(yt,We,we),Ze()}getDEMWorkerSource(we,Pe,Ze){return this.demWorkerSources[we]||(this.demWorkerSources[we]={}),this.demWorkerSources[we][Ze]||(this.demWorkerSources[we][Ze]={}),this.demWorkerSources[we][Ze][Pe]||(this.demWorkerSources[we][Ze][Pe]=new be),this.demWorkerSources[we][Ze][Pe]}getRasterArrayWorkerSource(){return this.rasterArrayWorkerSource||(this.rasterArrayWorkerSource=new Ie),this.rasterArrayWorkerSource}enforceCacheSizeLimit(we,Pe){t.ee(Pe)}getWorkerPerformanceMetrics(we,Pe,Ze){Ze(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Sn(self)),Sn}),E(["./shared"],function(t){var G="3.9.4";const W={create:"create",load:"load",fullLoad:"fullLoad"},Y={mark(_){performance.mark(_)},measure(_,i,l){performance.measure(_,i,l)}};function ne(_){const i=_.name.split("?")[0];return t.a(i)&&i.includes("mapbox-gl.js")?"javascript":t.a(i)&&i.includes("mapbox-gl.css")?"css":t.b(i)?"fontRange":t.c(i)?"sprite":t.i(i)?"style":t.d(i)?"tilejson":"other"}var J,Q={},ce=function(){if(J)return Q;function _(y){return!i(y)}function i(y){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var M,A,V=new Blob([""],{type:"text/javascript"}),H=URL.createObjectURL(V);try{A=new Worker(H),M=!0}catch{M=!1}return A&&A.terminate(),URL.revokeObjectURL(H),M}()?function(){var M=document.createElement("canvas");M.width=M.height=1;var A=M.getContext("2d");if(!A)return!1;var V=A.getImageData(0,0,1,1);return V&&V.width===M.width}()?(l[w=y&&y.failIfMajorPerformanceCaveat]===void 0&&(l[w]=function(M){var A,V=function(H){var K=document.createElement("canvas"),ee=Object.create(_.webGLContextAttributes);return ee.failIfMajorPerformanceCaveat=H,K.getContext("webgl2",ee)}(M);if(!V)return!1;try{A=V.createShader(V.VERTEX_SHADER)}catch{return!1}return!(!A||V.isContextLost())&&(V.shaderSource(A,"void main() {}"),V.compileShader(A),V.getShaderParameter(A,V.COMPILE_STATUS)===!0)}(w)),l[w]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var w}J=1,Q.supported=_,Q.notSupportedReason=i;var l={};return _.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},Q}();function ie(_,i,l){const y=document.createElement(_);return i!=null&&(y.className=i),l&&l.appendChild(y),y}function pe(_,i,l){const y=document.createElementNS("http://www.w3.org/2000/svg",_);for(const w of Object.keys(i))y.setAttributeNS(null,w,String(i[w]));return l&&l.appendChild(y),y}const be=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Ie=be&&be.userSelect!==void 0?"userSelect":"WebkitUserSelect";let $e;function Le(){be&&Ie&&($e=be[Ie],be[Ie]="none")}function Oe(){be&&Ie&&(be[Ie]=$e)}function Ve(_){_.preventDefault(),_.stopPropagation(),window.removeEventListener("click",Ve,!0)}function Ue(){window.addEventListener("click",Ve,!0),window.setTimeout(()=>{window.removeEventListener("click",Ve,!0)},0)}function qe(_,i){const l=_.getBoundingClientRect();return rt(_,l,i)}function He(_,i){const l=_.getBoundingClientRect(),y=[];for(let w=0;w<i.length;w++)y.push(rt(_,l,i[w]));return y}function nt(_){return window.InstallTrigger!==void 0&&_.button===2&&_.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:_.button}function rt(_,i,l){const y=_.offsetWidth===i.width?1:_.offsetWidth/i.width;return new t.P((l.clientX-i.left)*y,(l.clientY-i.top)*y)}const ft="01",$t="NO_ACCESS_TOKEN";class hn{constructor(i,l,y){this._transformRequestFn=i,this._customAccessToken=l,this._silenceAuthErrors=!!y,this._createSkuToken()}_createSkuToken(){const i=function(){let l="";for(let y=0;y<10;y++)l+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ft,l].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,l){return this._transformRequestFn&&this._transformRequestFn(i,l)||{url:i}}normalizeStyleURL(i,l){if(!t.f(i))return i;const y=pn(i);return y.params.push(`sdk=js-${G}`),y.path=`/styles/v1${y.path}`,this._makeAPIURL(y,this._customAccessToken||l)}normalizeGlyphsURL(i,l){if(!t.f(i))return i;const y=pn(i);return y.path=`/fonts/v1${y.path}`,this._makeAPIURL(y,this._customAccessToken||l)}normalizeModelURL(i,l){if(!t.f(i))return i;const y=pn(i);return y.path=`/models/v1${y.path}`,this._makeAPIURL(y,this._customAccessToken||l)}normalizeSourceURL(i,l,y,w){if(!t.f(i))return i;const M=pn(i);return M.path=`/v4/${M.authority}.json`,M.params.push("secure"),y&&M.params.push(`language=${y}`),w&&M.params.push(`worldview=${w}`),this._makeAPIURL(M,this._customAccessToken||l)}normalizeIconsetURL(i,l){const y=pn(i);return t.f(i)?(y.path=`/styles/v1${y.path}/iconset.pbf`,this._makeAPIURL(y,this._customAccessToken||l)):ri(y)}normalizeSpriteURL(i,l,y,w){const M=pn(i);return t.f(i)?(M.path=`/styles/v1${M.path}/sprite${l}${y}`,this._makeAPIURL(M,this._customAccessToken||w)):(M.path+=`${l}${y}`,ri(M))}normalizeTileURL(i,l,y){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!t.f(i))return i;const w=pn(i);w.path=w.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${l||y&&w.authority!=="raster"&&y===512?"@2x":""}${t.m.supported?".webp":"$1"}`),w.authority==="raster"?w.path=`/${t.e.RASTER_URL_PREFIX}${w.path}`:w.authority==="rasterarrays"?w.path=`/${t.e.RASTERARRAYS_URL_PREFIX}${w.path}`:w.authority==="3dtiles"?w.path=`/${t.e.TILES3D_URL_PREFIX}${w.path}`:(w.path=w.path.replace(/^.+\/v4\//,"/"),w.path=`/${t.e.TILE_URL_VERSION}${w.path}`);const M=this._customAccessToken||function(A){for(const V of A){const H=V.match(/^access_token=(.*)$/);if(H)return H[1]}return null}(w.params)||t.e.ACCESS_TOKEN;return t.e.REQUIRE_ACCESS_TOKEN&&M&&this._skuToken&&w.params.push(`sku=${this._skuToken}`),this._makeAPIURL(w,M)}canonicalizeTileURL(i,l){const y=pn(i);if(!y.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!y.path.match(/\.[\w]+$/))return i;let w="mapbox://";y.path.match(/^\/raster\/v1\//)?w+=`raster/${y.path.replace(`/${t.e.RASTER_URL_PREFIX}/`,"")}`:y.path.match(/^\/rasterarrays\/v1\//)?w+=`rasterarrays/${y.path.replace(`/${t.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:w+=`tiles/${y.path.replace(`/${t.e.TILE_URL_VERSION}/`,"")}`;let M=y.params;return l&&(M=M.filter(A=>!A.match(/^access_token=/))),M.length&&(w+=`?${M.join("&")}`),w}canonicalizeTileset(i,l){const y=!!l&&t.f(l),w=[];for(const M of i.tiles||[])t.h(M)?w.push(this.canonicalizeTileURL(M,y)):w.push(M);return w}_makeAPIURL(i,l){const y="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",w=pn(t.e.API_URL);if(i.protocol=w.protocol,i.authority=w.authority,i.protocol==="http"){const M=i.params.indexOf("secure");M>=0&&i.params.splice(M,1)}if(w.path!=="/"&&(i.path=`${w.path}${i.path}`),!t.e.REQUIRE_ACCESS_TOKEN)return ri(i);if(l=l||t.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!l)throw new Error(`An API access token is required to use Mapbox GL. ${y}`);if(l[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${y}`)}return i.params=i.params.filter(M=>M.indexOf("access_token")===-1),i.params.push(`access_token=${l||""}`),ri(i)}}const gn=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function pn(_){const i=_.match(gn);if(!i)throw new Error("Unable to parse URL object");return{protocol:i[1],authority:i[2],path:i[3]||"/",params:i[4]?i[4].split("&"):[]}}function ri(_){const i=_.params.length?`?${_.params.join("&")}`:"";return`${_.protocol}://${_.authority}${_.path}${i}`}const ai="mapbox.eventData";function _n(_){if(!_)return null;const i=_.split(".");if(!i||i.length!==3)return null;try{return JSON.parse(t.j(i[1]))}catch{return null}}class Bn{constructor(i){this.type=i,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(i){const l=_n(t.e.ACCESS_TOKEN);let y="";return y=l&&l.u?t.k(l.u):t.e.ACCESS_TOKEN||"",i?`${ai}.${i}:${y}`:`${ai}:${y}`}fetchEventData(){const i=t.s("localStorage"),l=this.getStorageKey(),y=this.getStorageKey("uuid");if(i)try{const w=localStorage.getItem(l);w&&(this.eventData=JSON.parse(w));const M=localStorage.getItem(y);M&&(this.anonId=M)}catch{t.w("Unable to read from LocalStorage")}}saveEventData(){const i=t.s("localStorage"),l=this.getStorageKey(),y=this.getStorageKey("uuid"),w=this.anonId;if(i&&w)try{localStorage.setItem(y,w),Object.keys(this.eventData).length>=1&&localStorage.setItem(l,JSON.stringify(this.eventData))}catch{t.w("Unable to write to LocalStorage")}}processRequests(i){}postEvent(i,l,y,w){if(!t.e.EVENTS_URL)return;const M=pn(t.e.EVENTS_URL);M.params.push(`access_token=${w||t.e.ACCESS_TOKEN||""}`);const A={event:this.type,created:new Date(i).toISOString()},V=l?t.l(A,l):A,H={url:ri(M),headers:{"Content-Type":"text/plain"},body:JSON.stringify([V])};this.pendingRequest=t.p(H,K=>{this.pendingRequest=null,y(K),this.saveEventData(),this.processRequests(w)})}queueRequest(i,l){this.queue.push(i),this.processRequests(l)}}const mn=new class extends Bn{constructor(_){super("appUserTurnstile"),this._customAccessToken=_}postTurnstileEvent(_,i){t.e.EVENTS_URL&&t.e.ACCESS_TOKEN&&Array.isArray(_)&&_.some(l=>t.f(l)||t.h(l))&&this.queueRequest(Date.now(),i)}processRequests(_){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=_n(t.e.ACCESS_TOKEN),l=i?i.u:t.e.ACCESS_TOKEN;let y=l!==this.eventData.tokenU;t.v(this.anonId)||(this.anonId=t.u(),y=!0);const w=this.queue.shift();if(this.eventData.lastSuccess){const M=new Date(this.eventData.lastSuccess),A=new Date(w),V=(w-this.eventData.lastSuccess)/864e5;y=y||V>=1||V<-1||M.getDate()!==A.getDate()}else y=!0;y?this.postEvent(w,{sdkIdentifier:"mapbox-gl-js",sdkVersion:G,skuId:ft,"enabled.telemetry":!1,userId:this.anonId},M=>{M||(this.eventData.lastSuccess=w,this.eventData.tokenU=l)},_):this.processRequests()}},Nn=mn.postTurnstileEvent.bind(mn),Pn=new class extends Bn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(_,i,l,y){this.skuToken=i,this.errorCb=y,t.e.EVENTS_URL&&(l||t.e.ACCESS_TOKEN?this.queueRequest({id:_,timestamp:Date.now()},l):this.errorCb(new Error($t)))}processRequests(_){if(this.pendingRequest||this.queue.length===0)return;const{id:i,timestamp:l}=this.queue.shift();i&&this.success[i]||(this.anonId||this.fetchEventData(),t.v(this.anonId)||(this.anonId=t.u()),this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:G,skuId:ft,skuToken:this.skuToken,userId:this.anonId},y=>{y?this.errorCb(y):i&&(this.success[i]=!0)},_))}remove(){this.errorCb=null}},Ci=Pn.postMapLoadEvent.bind(Pn),Fi=new class extends Bn{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(_){let i=this.mapInstanceIdMap.get(_);return i||(i=t.u(),this.mapInstanceIdMap.set(_,i)),i}getEventId(_){const i=this.eventIdPerMapInstanceMap.get(_)||0;return this.eventIdPerMapInstanceMap.set(_,i+1),i}postStyleLoadEvent(_,i){const{map:l,style:y,importedStyles:w}=i;if(!t.e.EVENTS_URL||!_&&!t.e.ACCESS_TOKEN)return;const M=this.getMapInstanceId(l),A={mapInstanceId:M,eventId:this.getEventId(M),style:y};w.length&&(A.importedStyles=w),this.queueRequest({timestamp:Date.now(),payload:A},_)}processRequests(_){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:i,payload:l}=this.queue.shift();this.postEvent(i,l,()=>{},_)}},Ln=Fi.postStyleLoadEvent.bind(Fi),sn=new class extends Bn{constructor(){super("gljs.performance")}postPerformanceEvent(_,i){t.e.EVENTS_URL&&(_||t.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:i},_)}processRequests(_){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:i,performanceData:l}=this.queue.shift(),y=function(w){const M=performance.getEntriesByType("resource"),A=performance.getEntriesByType("mark"),V=function(me){const Ee={};if(me){for(const Se in me)if(Se!=="other")for(const ke of me[Se]){const De=`${Se}ResolveRangeMin`,Xe=`${Se}ResolveRangeMax`,ut=`${Se}RequestCount`,st=`${Se}RequestCachedCount`;Ee[De]=Math.min(Ee[De]||1/0,ke.startTime),Ee[Xe]=Math.max(Ee[Xe]||-1/0,ke.responseEnd);const wt=gt=>{Ee[gt]===void 0&&(Ee[gt]=0),++Ee[gt]};ke.transferSize!==void 0&&ke.transferSize===0&&wt(st),wt(ut)}}return Ee}(function(me,Ee){const Se={};if(me)for(const ke of me){const De=Ee(ke);Se[De]===void 0&&(Se[De]=[]),Se[De].push(ke)}return Se}(M,ne)),H=window.devicePixelRatio,K=navigator.connection||navigator.mozConnection||navigator.webkitConnection,ee=K?K.effectiveType:void 0,se={counters:[],metadata:[],attributes:[]},le=(me,Ee,Se)=>{Se!=null&&me.push({name:Ee,value:Se.toString()})};for(const me in V)le(se.counters,me,V[me]);if(w.interactionRange[0]!==1/0&&w.interactionRange[1]!==-1/0&&(le(se.counters,"interactionRangeMin",w.interactionRange[0]),le(se.counters,"interactionRangeMax",w.interactionRange[1])),A)for(const me of Object.keys(W)){const Ee=W[me],Se=A.find(ke=>ke.name===Ee);Se&&le(se.counters,Ee,Se.startTime)}return le(se.counters,"visibilityHidden",w.visibilityHidden),le(se.attributes,"style",function(me){if(me)for(const Ee of me){const Se=Ee.name.split("?")[0];if(t.i(Se)){const ke=Se.split("/").slice(-2);if(ke.length===2)return`mapbox://styles/${ke[0]}/${ke[1]}`}}}(M)),le(se.attributes,"terrainEnabled",w.terrainEnabled?"true":"false"),le(se.attributes,"fogEnabled",w.fogEnabled?"true":"false"),le(se.attributes,"projection",w.projection),le(se.attributes,"zoom",w.zoom),le(se.metadata,"devicePixelRatio",H),le(se.metadata,"connectionEffectiveType",ee),le(se.metadata,"navigatorUserAgent",navigator.userAgent),le(se.metadata,"screenWidth",window.screen.width),le(se.metadata,"screenHeight",window.screen.height),le(se.metadata,"windowWidth",window.innerWidth),le(se.metadata,"windowHeight",window.innerHeight),le(se.metadata,"mapWidth",w.width/H),le(se.metadata,"mapHeight",w.height/H),le(se.metadata,"webglRenderer",w.renderer),le(se.metadata,"webglVendor",w.vendor),le(se.metadata,"sdkVersion",G),le(se.metadata,"sdkIdentifier","mapbox-gl-js"),se}(l);for(const w of y.metadata);for(const w of y.counters);for(const w of y.attributes);this.postEvent(i,y,()=>{},_)}},qn=sn.postPerformanceEvent.bind(sn),pi=new class extends Bn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(_,i,l,y){if(!t.e.API_URL||!t.e.SESSION_PATH)return;const w=pn(t.e.API_URL+t.e.SESSION_PATH);w.params.push(`sku=${i||""}`),w.params.push(`access_token=${y||t.e.ACCESS_TOKEN||""}`);const M={url:ri(w),headers:{"Content-Type":"text/plain"}};this.pendingRequest=t.g(M,A=>{this.pendingRequest=null,l(A),this.saveEventData(),this.processRequests(y)})}getSessionAPI(_,i,l,y){this.skuToken=i,this.errorCb=y,t.e.SESSION_PATH&&t.e.API_URL&&(l||t.e.ACCESS_TOKEN?this.queueRequest({id:_,timestamp:Date.now()},l):this.errorCb(new Error($t)))}processRequests(_){if(this.pendingRequest||this.queue.length===0)return;const{id:i,timestamp:l}=this.queue.shift();i&&this.success[i]||this.getSession(l,this.skuToken,y=>{y?this.errorCb(y):i&&(this.success[i]=!0)},_)}remove(){this.errorCb=null}},ht=pi.getSessionAPI.bind(pi),Zn=new Set;function St(_,i){i?Zn.add(_):Zn.delete(_)}class mt{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(i,l){this._updatedSourceCaches[i]=l,this.setDirty()}discardSourceCacheUpdate(i){delete this._updatedSourceCaches[i]}updateLayer(i){const l=i.scope;this._updatedLayers[l]=this._updatedLayers[l]||new Set,this._updatedLayers[l].add(i.id),this.setDirty()}removeLayer(i){const l=i.scope;this._removedLayers[l]=this._removedLayers[l]||{},this._updatedLayers[l]=this._updatedLayers[l]||new Set,this._removedLayers[l][i.id]=i,this._updatedLayers[l].delete(i.id),this._updatedPaintProps.delete(i.fqid),this.setDirty()}getRemovedLayer(i){return this._removedLayers[i.scope]?this._removedLayers[i.scope][i.id]:null}discardLayerRemoval(i){this._removedLayers[i.scope]&&delete this._removedLayers[i.scope][i.id]}getLayerUpdatesByScope(){const i={};for(const l in this._updatedLayers)i[l]=i[l]||{},i[l].updatedIds=Array.from(this._updatedLayers[l].values());for(const l in this._removedLayers)i[l]=i[l]||{},i[l].removedIds=Object.keys(this._removedLayers[l]);return i}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(i){this._updatedPaintProps.add(i.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(i){this._updatedImages.add(i),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}function at(_){const{userImage:i}=_;return!!(i&&i.render&&i.render())&&(_.data.replace(new Uint8Array(i.data.buffer)),!0)}class Tn extends t.E{constructor(i){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0,this.spriteFormat=i,i!=="raster"&&t.t()&&(this.imageRasterizerDispatcher=new t.D(t.x(),this,"Image Rasterizer Worker",1))}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new t.I),this._imageRasterizer}createScope(i){this.images[i]={},this.loaded[i]=!1,this.updatedImages[i]={},this.patterns[i]={},this.callbackDispatchedThisFrame[i]={},this.atlasImage[i]=new t.r({width:1,height:1})}isLoaded(){for(const i in this.loaded)if(!this.loaded[i])return!1;return!0}setLoaded(i,l){if(this.loaded[l]!==i&&(this.loaded[l]=i,i)){for(const{ids:y,callback:w}of this.requestors)this._notify(y,l,w);this.requestors=[]}}hasImage(i,l){return!!this.getImage(i,l)}getImage(i,l){return this.images[l][i]}addImage(i,l,y){this._validate(i,y)&&(this.images[l][i]=y)}_validate(i,l){let y=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new t.y(new Error(`Image "${i}" has invalid "stretchX" value`))),y=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new t.y(new Error(`Image "${i}" has invalid "stretchY" value`))),y=!1),this._validateContent(l.content,l)||(this.fire(new t.y(new Error(`Image "${i}" has invalid "content" value`))),y=!1),y}_validateStretch(i,l){if(!i)return!0;let y=0;for(const w of i){if(w[0]<y||w[1]<w[0]||l<w[1])return!1;y=w[1]}return!0}_validateContent(i,l){return i?i.length!==4||!l.usvg&&(i[0]<0||l.data.width<i[0]||i[1]<0||l.data.height<i[1]||i[2]<0||l.data.width<i[2]||i[3]<0||l.data.height<i[3])?!1:!(i[2]<i[0]||i[3]<i[1]):!0}updateImage(i,l,y){y.version=this.images[l][i].version+1,this.images[l][i]=y,this.updatedImages[l][i]=!0,this.removeFromImageRasterizerCache(i,l)}removeFromImageRasterizerCache(i,l){this.spriteFormat!=="raster"&&(t.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[i],scope:l}):this.imageRasterizer.removeImagesFromCacheByIds([i],l))}removeImage(i,l){const y=this.images[l][i];delete this.images[l][i],delete this.patterns[l][i],this.removeFromImageRasterizerCache(i,l),y.userImage&&y.userImage.onRemove&&y.userImage.onRemove()}listImages(i){return Object.keys(this.images[i])}getImages(i,l,y){let w=!0;const M=!!this.loaded[l];if(!M)for(const A of i)this.images[l][A]||(w=!1);M||w?this._notify(i,l,y):this.requestors.push({ids:i,scope:l,callback:y})}rasterizeImages({scope:i,imageTasks:l},y){const w={};for(const M in l){const A=l[M],V=this.getImage(A.id,i);V&&(w[M]={image:V,imageIdWithOptions:A})}t.t()?this.imageRasterizerDispatcher.getActor().send("rasterizeImages",{imageTasks:w,scope:i},y):this.rasterizeImagesInMainThread({imageTasks:w,scope:i},y)}rasterizeImagesInMainThread(i,l){const{imageTasks:y,scope:w}=i,M={};for(const A in y){const{image:V,imageIdWithOptions:H}=y[A];M[A]=this.imageRasterizer.rasterize(H,V,w,"")}l(void 0,M)}getUpdatedImages(i){return this.updatedImages[i]}_notify(i,l,y){const w={};for(const M of i){this.images[l][M]||this.fire(new t.z("styleimagemissing",{id:M}));const A=this.images[l][M];A?w[M]={data:A.usvg?null:A.data.clone(),pixelRatio:A.pixelRatio,sdf:A.sdf,usvg:A.usvg,version:A.version,stretchX:A.stretchX,stretchY:A.stretchY,content:A.content,hasRenderCallback:!!(A.userImage&&A.userImage.render)}:t.w(`Image "${M}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}y(null,w)}getPixelSize(i){const{width:l,height:y}=this.atlasImage[i];return{width:l,height:y}}getPattern(i,l,y){const w=this.patterns[l][i],M=this.getImage(i,l);if(!M)return null;if(w&&w.position.version===M.version)return w.position;if(w)w.position.version=M.version;else{M.usvg&&!M.data&&(M.data=this.imageRasterizer.rasterize(t.A.from(i).getPrimary(),M,l,""));const A={w:M.data.width+2*t.B,h:M.data.height+2*t.B,x:0,y:0},V=new t.F(A,M,t.B);this.patterns[l][i]={bin:A,position:V}}return this._updatePatternAtlas(l,y),this.patterns[l][i].position}bind(i,l){const y=i.gl;let w=this.atlasTexture[l];w?this.dirty&&(w.update(this.atlasImage[l]),this.dirty=!1):(w=new t.T(i,this.atlasImage[l],y.RGBA8),this.atlasTexture[l]=w),w.bind(y.LINEAR,y.CLAMP_TO_EDGE)}_updatePatternAtlas(i,l){const y=[];for(const V in this.patterns[i])y.push(this.patterns[i][V].bin);const{w,h:M}=t.C(y),A=this.atlasImage[i];A.resize({width:w||1,height:M||1});for(const V in this.patterns[i]){const{bin:H,position:K}=this.patterns[i][V];let ee=K.padding;const se=H.x+ee,le=H.y+ee,me=this.images[i][V].data,Ee=me.width,Se=me.height;ee=ee>1?ee-1:ee,t.r.copy(me,A,{x:0,y:0},{x:se,y:le},{width:Ee,height:Se},l),t.r.copy(me,A,{x:0,y:Se-ee},{x:se,y:le-ee},{width:Ee,height:ee},l),t.r.copy(me,A,{x:0,y:0},{x:se,y:le+Se},{width:Ee,height:ee},l),t.r.copy(me,A,{x:Ee-ee,y:0},{x:se-ee,y:le},{width:ee,height:Se},l),t.r.copy(me,A,{x:0,y:0},{x:se+Ee,y:le},{width:ee,height:Se},l),t.r.copy(me,A,{x:Ee-ee,y:Se-ee},{x:se-ee,y:le-ee},{width:ee,height:ee},l),t.r.copy(me,A,{x:0,y:Se-ee},{x:se+Ee,y:le-ee},{width:ee,height:ee},l),t.r.copy(me,A,{x:0,y:0},{x:se+Ee,y:le+Se},{width:ee,height:ee},l),t.r.copy(me,A,{x:Ee-ee,y:0},{x:se-ee,y:le+Se},{width:ee,height:ee},l)}this.dirty=!0}beginFrame(){for(const i in this.images)this.callbackDispatchedThisFrame[i]={}}dispatchRenderCallbacks(i,l){for(const y of i){if(this.callbackDispatchedThisFrame[l][y])continue;this.callbackDispatchedThisFrame[l][y]=!0;const w=this.images[l][y];at(w)&&this.updateImage(y,l,w)}}}function bn(_){const i=_.key,l=_.value,y=_.valueSpec||{},w=_.objectElementValidators||{},M=_.style,A=_.styleSpec;let V=[];const H=t.H(l);if(H!=="object")return[new t.V(i,l,`object expected, ${H} found`)];for(const K in l){const ee=K.split(".")[0];let se;w[ee]?se=w[ee]:y[ee]?se=it:w["*"]?se=w["*"]:y["*"]&&(se=it),se?V=V.concat(se({key:(i&&`${i}.`)+K,value:l[K],valueSpec:y[ee]||y["*"],style:M,styleSpec:A,object:l,objectKey:K},l)):V.push(new t.G(i,l[K],`unknown property "${K}"`))}for(const K in y)w[K]||y[K].required&&y[K].default===void 0&&l[K]===void 0&&V.push(new t.V(i,l,`missing required property "${K}"`));return V}function Cn(_){const i=_.value,l=_.valueSpec,y=_.style,w=_.styleSpec,M=_.key,A=_.arrayElementValidator||it;if(t.H(i)!=="array")return[new t.V(M,i,`array expected, ${t.H(i)} found`)];if(l.length&&i.length!==l.length)return[new t.V(M,i,`array length ${l.length} expected, length ${i.length} found`)];if(l["min-length"]&&i.length<l["min-length"])return[new t.V(M,i,`array length at least ${l["min-length"]} expected, length ${i.length} found`)];let V={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum,function:void 0};w.$version<7&&(V.function=l.function),t.H(l.value)==="object"&&(V=l.value);let H=[];for(let K=0;K<i.length;K++)H=H.concat(A({array:i,arrayIndex:K,value:i[K],valueSpec:V,style:y,styleSpec:w,key:`${M}[${K}]`},!0));return H}function zn(_){const i=_.key,l=_.value,y=_.valueSpec;let w=t.H(l);if(w==="number"&&l!=l&&(w="NaN"),w!=="number")return[new t.V(i,l,`number expected, ${w} found`)];if("minimum"in y){let M=y.minimum;if(t.H(y.minimum)==="array"&&(M=y.minimum[_.arrayIndex]),l<M)return[new t.V(i,l,`${l} is less than the minimum value ${M}`)]}if("maximum"in y){let M=y.maximum;if(t.H(y.maximum)==="array"&&(M=y.maximum[_.arrayIndex]),l>M)return[new t.V(i,l,`${l} is greater than the maximum value ${M}`)]}return[]}function vi(_){const i=_.valueSpec,l=t.K(_.value.type);let y,w,M,A={};const V=l!=="categorical"&&_.value.property===void 0,H=!V,K=t.H(_.value.stops)==="array"&&t.H(_.value.stops[0])==="array"&&t.H(_.value.stops[0][0])==="object",ee=bn({key:_.key,value:_.value,valueSpec:_.styleSpec.function,style:_.style,styleSpec:_.styleSpec,objectElementValidators:{stops:function(me){if(l==="identity")return[new t.V(me.key,me.value,'identity function may not have a "stops" property')];let Ee=[];const Se=me.value;return Ee=Ee.concat(Cn({key:me.key,value:Se,valueSpec:me.valueSpec,style:me.style,styleSpec:me.styleSpec,arrayElementValidator:se})),t.H(Se)==="array"&&Se.length===0&&Ee.push(new t.V(me.key,Se,"array must have at least one stop")),Ee},default:function(me){return it({key:me.key,value:me.value,valueSpec:i,style:me.style,styleSpec:me.styleSpec})}}});return l==="identity"&&V&&ee.push(new t.V(_.key,_.value,'missing required property "property"')),l==="identity"||_.value.stops||ee.push(new t.V(_.key,_.value,'missing required property "stops"')),l==="exponential"&&_.valueSpec.expression&&!t.L(_.valueSpec)&&ee.push(new t.V(_.key,_.value,"exponential functions not supported")),_.styleSpec.$version>=8&&(H&&!t.M(_.valueSpec)?ee.push(new t.V(_.key,_.value,"property functions not supported")):V&&!t.N(_.valueSpec)&&ee.push(new t.V(_.key,_.value,"zoom functions not supported"))),l!=="categorical"&&!K||_.value.property!==void 0||ee.push(new t.V(_.key,_.value,'"property" property is required')),ee;function se(me){let Ee=[];const Se=me.value,ke=me.key;if(t.H(Se)!=="array")return[new t.V(ke,Se,`array expected, ${t.H(Se)} found`)];if(Se.length!==2)return[new t.V(ke,Se,`array length 2 expected, length ${Se.length} found`)];if(K){if(t.H(Se[0])!=="object")return[new t.V(ke,Se,`object expected, ${t.H(Se[0])} found`)];if(Se[0].zoom===void 0)return[new t.V(ke,Se,"object stop key must have zoom")];if(Se[0].value===void 0)return[new t.V(ke,Se,"object stop key must have value")];const De=t.K(Se[0].zoom);if(typeof De!="number")return[new t.V(ke,Se[0].zoom,"stop zoom values must be numbers")];if(M&&M>De)return[new t.V(ke,Se[0].zoom,"stop zoom values must appear in ascending order")];De!==M&&(M=De,w=void 0,A={}),Ee=Ee.concat(bn({key:`${ke}[0]`,value:Se[0],valueSpec:{zoom:{}},style:me.style,styleSpec:me.styleSpec,objectElementValidators:{zoom:zn,value:le}}))}else Ee=Ee.concat(le({key:`${ke}[0]`,value:Se[0],valueSpec:{},style:me.style,styleSpec:me.styleSpec},Se));return t.O(t.Q(Se[1]))?Ee.concat([new t.V(`${ke}[1]`,Se[1],"expressions are not allowed in function stops.")]):Ee.concat(it({key:`${ke}[1]`,value:Se[1],valueSpec:i,style:me.style,styleSpec:me.styleSpec}))}function le(me,Ee){const Se=t.H(me.value),ke=t.K(me.value),De=me.value!==null?me.value:Ee;if(y){if(Se!==y)return[new t.V(me.key,De,`${Se} stop domain type must match previous stop domain type ${y}`)]}else y=Se;if(Se!=="number"&&Se!=="string"&&Se!=="boolean"&&typeof ke!="number"&&typeof ke!="string"&&typeof ke!="boolean")return[new t.V(me.key,De,"stop domain value must be a number, string, or boolean")];if(Se!=="number"&&l!=="categorical"){let Xe=`number expected, ${Se} found`;return t.M(i)&&l===void 0&&(Xe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new t.V(me.key,De,Xe)]}return l!=="categorical"||Se!=="number"||typeof ke=="number"&&isFinite(ke)&&Math.floor(ke)===ke?l!=="categorical"&&Se==="number"&&typeof ke=="number"&&typeof w=="number"&&w!==void 0&&ke<w?[new t.V(me.key,De,"stop domain values must appear in ascending order")]:(w=ke,l==="categorical"&&ke in A?[new t.V(me.key,De,"stop domain values must be unique")]:(A[ke]=!0,[])):[new t.V(me.key,De,`integer expected, found ${String(ke)}`)]}}function ii(_){const i=(_.expressionContext==="property"?t.S:t.U)(t.Q(_.value),_.valueSpec);if(i.result==="error")return i.value.map(y=>new t.V(`${_.key}${y.key}`,_.value,y.message));const l=i.value.expression||i.value._styleExpression.expression;if(_.expressionContext==="property"&&_.propertyKey==="text-font"&&!l.outputDefined())return[new t.V(_.key,_.value,`Invalid data expression for "${_.propertyKey}". Output values must be contained as literals within the expression.`)];if(_.expressionContext==="property"&&_.propertyType==="layout"&&!t.W(l))return[new t.V(_.key,_.value,'"feature-state" data expressions are not supported with layout properties.')];if(_.expressionContext==="filter")return wi(l,_);if(_.expressionContext&&_.expressionContext.indexOf("cluster")===0){if(!t.X(l,["zoom","feature-state"]))return[new t.V(_.key,_.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(_.expressionContext==="cluster-initial"&&!t.Y(l))return[new t.V(_.key,_.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function wi(_,i){const l=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const w of i.valueSpec.expression.parameters)l.delete(w);if(l.size===0)return[];const y=[];return _ instanceof t.Z&&l.has(_.name)?[new t.V(i.key,i.value,`["${_.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(_.eachChild(w=>{y.push(...wi(w,i))}),y)}function Ki(_){const i=_.key,l=_.value,y=_.valueSpec,w=[];return Array.isArray(y.values)?y.values.indexOf(t.K(l))===-1&&w.push(new t.V(i,l,`expected one of [${y.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(y.values).indexOf(t.K(l))===-1&&w.push(new t.V(i,l,`expected one of [${Object.keys(y.values).join(", ")}], ${JSON.stringify(l)} found`)),w}function Vi(_){return t.$(t.Q(_.value))?ii(t.J({},_,{expressionContext:"filter",valueSpec:_.styleSpec[`filter_${_.layerType||"fill"}`]})):ui(_)}function ui(_){const i=_.value,l=_.key;if(t.H(i)!=="array")return[new t.V(l,i,`array expected, ${t.H(i)} found`)];const y=_.styleSpec;let w,M=[];if(i.length<1)return[new t.V(l,i,"filter array must have at least 1 element")];switch(M=M.concat(Ki({key:`${l}[0]`,value:i[0],valueSpec:y.filter_operator,style:_.style,styleSpec:_.styleSpec})),t.K(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&t.K(i[1])==="$type"&&M.push(new t.V(l,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&M.push(new t.V(l,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(w=t.H(i[1]),w!=="string"&&M.push(new t.V(`${l}[1]`,i[1],`string expected, ${w} found`)));for(let A=2;A<i.length;A++)w=t.H(i[A]),t.K(i[1])==="$type"?M=M.concat(Ki({key:`${l}[${A}]`,value:i[A],valueSpec:y.geometry_type,style:_.style,styleSpec:_.styleSpec})):w!=="string"&&w!=="number"&&w!=="boolean"&&M.push(new t.V(`${l}[${A}]`,i[A],`string, number, or boolean expected, ${w} found`));break;case"any":case"all":case"none":for(let A=1;A<i.length;A++)M=M.concat(ui({key:`${l}[${A}]`,value:i[A],style:_.style,styleSpec:_.styleSpec}));break;case"has":case"!has":w=t.H(i[1]),i.length!==2?M.push(new t.V(l,i,`filter array for "${i[0]}" operator must have 2 elements`)):w!=="string"&&M.push(new t.V(`${l}[1]`,i[1],`string expected, ${w} found`))}return M}function pr(_,i){const l=_.key,y=_.style,w=_.layer,M=_.styleSpec,A=_.value,V=_.objectKey,H=M[`${i}_${_.layerType}`];if(!H)return[];const K=V.match(/^(.*)-use-theme$/);if(i==="paint"&&K&&H[K[1]])return it({key:l,value:A,valueSpec:{type:"string"},style:y,styleSpec:M});const ee=V.match(/^(.*)-transition$/);if(i==="paint"&&ee&&H[ee[1]]&&H[ee[1]].transition)return it({key:l,value:A,valueSpec:M.transition,style:y,styleSpec:M});const se=_.valueSpec||H[V];if(!se)return[new t.G(l,A,`unknown property "${V}"`)];let le;if(t.H(A)==="string"&&t.M(se)&&!se.tokens&&(le=/^{([^}]+)}$/.exec(A))){const Ee=`\`{ "type": "identity", "property": ${le?JSON.stringify(le[1]):'"_"'} }\``;return[new t.V(l,A,`"${V}" does not support interpolation syntax
Use an identity property function instead: ${Ee}.`)]}const me=[];if(_.layerType==="symbol")V!=="text-field"||!y||y.glyphs||y.imports||me.push(new t.V(l,A,'use of "text-field" requires a style "glyphs" property')),V==="text-font"&&t.a0(t.Q(A))&&t.K(A.type)==="identity"&&me.push(new t.V(l,A,'"text-font" does not support identity functions'));else if(_.layerType==="model"&&i==="paint"&&w&&w.layout&&w.layout.hasOwnProperty("model-id")&&t.M(se)&&(t.a1(se)||t.N(se))){const Ee=t.S(t.Q(A),se),Se=Ee.value.expression||Ee.value._styleExpression.expression;Se&&!t.X(Se,["measure-light"])&&(V==="model-emissive-strength"&&t.Y(Se)&&t.W(Se)||me.push(new t.V(l,A,`${V} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return me.concat(it({key:_.key,value:A,valueSpec:se,style:y,styleSpec:M,expressionContext:"property",propertyType:i,propertyKey:V}))}function Er(_){return pr(_,"paint")}function sa(_){return pr(_,"layout")}function Ar(_){let i=[];const l=_.value,y=_.key,w=_.style,M=_.styleSpec;l.type||l.ref||i.push(new t.V(y,l,'either "type" or "ref" is required'));let A=t.K(l.type);const V=t.K(l.ref);if(l.id){const H=t.K(l.id);for(let K=0;K<_.arrayIndex;K++){const ee=w.layers[K];t.K(ee.id)===H&&i.push(new t.V(y,l.id,`duplicate layer id "${l.id}", previously used at line ${ee.id.__line__}`))}}if("ref"in l){let H;["type","source","source-layer","filter","layout"].forEach(K=>{K in l&&i.push(new t.V(y,l[K],`"${K}" is prohibited for ref layers`))}),w.layers.forEach(K=>{t.K(K.id)===V&&(H=K)}),H?H.ref?i.push(new t.V(y,l.ref,"ref cannot reference another ref layer")):A=t.K(H.type):typeof V=="string"&&i.push(new t.V(y,l.ref,`ref layer "${V}" not found`))}else if(A!=="background"&&A!=="sky"&&A!=="slot")if(l.source){const H=w.sources&&w.sources[l.source],K=H&&t.K(H.type);H?K==="vector"&&A==="raster"?i.push(new t.V(y,l.source,`layer "${l.id}" requires a raster source`)):K==="raster"&&A!=="raster"?i.push(new t.V(y,l.source,`layer "${l.id}" requires a vector source`)):K!=="vector"||l["source-layer"]?K==="raster-dem"&&A!=="hillshade"?i.push(new t.V(y,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):K!=="raster-array"||["raster","raster-particle"].includes(A)?A!=="line"||!l.paint||!l.paint["line-gradient"]&&!l.paint["line-trim-offset"]||K==="geojson"&&H.lineMetrics?A==="raster-particle"&&K!=="raster-array"&&i.push(new t.V(y,l.source,`layer "${l.id}" requires a 'raster-array' source.`)):i.push(new t.V(y,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new t.V(y,l.source,"raster-array source can only be used with layer type 'raster'.")):i.push(new t.V(y,l,`layer "${l.id}" must specify a "source-layer"`)):i.push(new t.V(y,l.source,`source "${l.source}" not found`))}else i.push(new t.V(y,l,'missing required property "source"'));return i=i.concat(bn({key:y,value:l,valueSpec:M.layer,style:_.style,styleSpec:_.styleSpec,objectElementValidators:{"*":()=>[],type:()=>it({key:`${y}.type`,value:l.type,valueSpec:M.layer.type,style:_.style,styleSpec:_.styleSpec,object:l,objectKey:"type"}),filter:H=>Vi(t.J({layerType:A},H)),layout:H=>bn({layer:l,key:H.key,value:H.value,valueSpec:{},style:H.style,styleSpec:H.styleSpec,objectElementValidators:{"*":K=>sa(t.J({layerType:A},K))}}),paint:H=>bn({layer:l,key:H.key,value:H.value,valueSpec:{},style:H.style,styleSpec:H.styleSpec,objectElementValidators:{"*":K=>Er(t.J({layerType:A,layer:l},K))}})}})),i}function Ta(_){const i=_.value,l=_.key,y=t.H(i);return y!=="string"?[new t.V(l,i,`string expected, ${y} found`)]:[]}const Qa={promoteId:function({key:_,value:i}){if(t.H(i)==="string")return Ta({key:_,value:i});{const l=[];for(const y in i)l.push(...Ta({key:`${_}.${y}`,value:i[y]}));return l}}};function Os(_){const i=_.value,l=_.key,y=_.styleSpec,w=_.style;if(!i.type)return[new t.V(l,i,'"type" is required')];const M=t.K(i.type);let A=[];switch(["vector","raster","raster-dem","raster-array"].includes(M)&&(i.url||i.tiles||A.push(new t.G(l,i,'Either "url" or "tiles" is required.'))),M){case"vector":case"raster":case"raster-dem":case"raster-array":return A=A.concat(bn({key:l,value:i,valueSpec:y[`source_${M.replace("-","_")}`],style:_.style,styleSpec:y,objectElementValidators:Qa})),A;case"geojson":if(A=bn({key:l,value:i,valueSpec:y.source_geojson,style:w,styleSpec:y,objectElementValidators:Qa}),i.cluster)for(const V in i.clusterProperties){const[H,K]=i.clusterProperties[V],ee=typeof H=="string"?[H,["accumulated"],["get",V]]:H;A.push(...ii({key:`${l}.${V}.map`,value:K,expressionContext:"cluster-map"})),A.push(...ii({key:`${l}.${V}.reduce`,value:ee,expressionContext:"cluster-reduce"}))}return A;case"video":return bn({key:l,value:i,valueSpec:y.source_video,style:w,styleSpec:y});case"image":return bn({key:l,value:i,valueSpec:y.source_image,style:w,styleSpec:y});case"canvas":return[new t.V(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ki({key:`${l}.type`,value:i.type,valueSpec:{values:As(y)},style:w,styleSpec:y})}}function As(_){return _.source.reduce((i,l)=>{const y=_[l];return y.type.type==="enum"&&(i=i.concat(Object.keys(y.type.values))),i},[])}function to(_){const i=_.value,l=_.styleSpec,y=l.light,w=_.style;let M=[];const A=t.H(i);if(i===void 0)return M;if(A!=="object")return M=M.concat([new t.V("light",i,`object expected, ${A} found`)]),M;for(const V in i){const H=V.match(/^(.*)-transition$/),K=V.match(/^(.*)-use-theme$/);M=M.concat(K&&y[K[1]]?it({key:V,value:i[V],valueSpec:{type:"string"},style:w,styleSpec:l}):H&&y[H[1]]&&y[H[1]].transition?it({key:V,value:i[V],valueSpec:l.transition,style:w,styleSpec:l}):y[V]?it({key:V,value:i[V],valueSpec:y[V],style:w,styleSpec:l}):[new t.V(V,i[V],`unknown property "${V}"`)])}return M}function ko(_){const i=_.value;let l=[];if(!i)return l;const y=t.H(i);if(y!=="object")return l=l.concat([new t.V("light-3d",i,`object expected, ${y} found`)]),l;const w=_.styleSpec,M=w["light-3d"],A=_.key,V=_.style,H=_.style.lights;for(const se of["type","id"])if(!(se in i))return l=l.concat([new t.V("light-3d",i,`missing property ${se} on light`)]),l;if(i.type&&H)for(let se=0;se<_.arrayIndex;se++){const le=t.K(i.type),me=H[se];t.K(me.type)===le&&l.push(new t.V(A,i.id,`duplicate light type "${i.type}", previously defined at line ${me.id.__line__}`))}const K=`properties_light_${i.type}`;if(!(K in w))return l=l.concat([new t.V("light-3d",i,`Invalid light type ${i.type}`)]),l;const ee=w[K];for(const se in i)if(se==="properties"){const le=i[se],me=t.H(le);if(me!=="object")return l=l.concat([new t.V("properties",le,`object expected, ${me} found`)]),l;for(const Ee in le)l=l.concat(ee[Ee]?it({key:Ee,value:le[Ee],valueSpec:ee[Ee],style:V,styleSpec:w}):[new t.G(_.key,le[Ee],`unknown property "${Ee}"`)])}else{const le=se.match(/^(.*)-transition$/),me=se.match(/^(.*)-use-theme$/);l=l.concat(me&&M[me[1]]?it({key:se,value:i[se],valueSpec:{type:"string"},style:V,styleSpec:w}):le&&M[le[1]]&&M[le[1]].transition?it({key:se,value:i[se],valueSpec:w.transition,style:V,styleSpec:w}):M[se]?it({key:se,value:i[se],valueSpec:M[se],style:V,styleSpec:w}):[new t.G(se,i[se],`unknown property "${se}"`)])}return l}function bt(_){const i=_.value,l=_.key,y=_.style,w=_.styleSpec,M=w.terrain;let A=[];const V=t.H(i);if(i===void 0||V==="null")return A;if(V!=="object")return A=A.concat([new t.V("terrain",i,`object expected, ${V} found`)]),A;for(const H in i){const K=H.match(/^(.*)-transition$/),ee=H.match(/^(.*)-use-theme$/);A=A.concat(ee&&M[ee[1]]?it({key:H,value:i[H],valueSpec:{type:"string"},style:y,styleSpec:w}):K&&M[K[1]]&&M[K[1]].transition?it({key:H,value:i[H],valueSpec:w.transition,style:y,styleSpec:w}):M[H]?it({key:H,value:i[H],valueSpec:M[H],style:y,styleSpec:w}):[new t.G(H,i[H],`unknown property "${H}"`)])}if(i.source){const H=y.sources&&y.sources[i.source],K=H&&t.K(H.type);H?K!=="raster-dem"&&A.push(new t.V(l,i.source,`terrain cannot be used with a source of type ${String(K)}, it only be used with a "raster-dem" source type`)):A.push(new t.V(l,i.source,`source "${i.source}" not found`))}else A.push(new t.V(l,i,'terrain is missing required property "source"'));return A}function Qe(_){const i=_.value,l=_.style,y=_.styleSpec,w=y.fog;let M=[];const A=t.H(i);if(i===void 0)return M;if(A!=="object")return M=M.concat([new t.V("fog",i,`object expected, ${A} found`)]),M;for(const V in i){const H=V.match(/^(.*)-transition$/),K=V.match(/^(.*)-use-theme$/);M=M.concat(K&&w[K[1]]?it({key:V,value:i[V],valueSpec:{type:"string"},style:l,styleSpec:y}):H&&w[H[1]]&&w[H[1]].transition?it({key:V,value:i[V],valueSpec:y.transition,style:l,styleSpec:y}):w[V]?it({key:V,value:i[V],valueSpec:w[V],style:l,styleSpec:y}):[new t.G(V,i[V],`unknown property "${V}"`)])}return M}const dt={"*":()=>[],array:Cn,boolean:function(_){const i=_.value,l=_.key,y=t.H(i);return y!=="boolean"?[new t.V(l,i,`boolean expected, ${y} found`)]:[]},number:zn,color:function(_){const i=_.key,l=_.value,y=t.H(l);return y!=="string"?[new t.V(i,l,`color expected, ${y} found`)]:t._.parseCSSColor(l)===null?[new t.V(i,l,`color expected, "${l}" found`)]:[]},enum:Ki,filter:Vi,function:vi,layer:Ar,object:bn,source:Os,model:t.a2,light:to,"light-3d":ko,terrain:bt,fog:Qe,string:Ta,formatted:function(_){return Ta(_).length===0?[]:ii(_)},resolvedImage:function(_){return Ta(_).length===0?[]:ii(_)},projection:function(_){const i=_.value,l=_.styleSpec,y=l.projection,w=_.style;let M=[];const A=t.H(i);if(A==="object")for(const V in i)M=M.concat(it({key:V,value:i[V],valueSpec:y[V],style:w,styleSpec:l}));else A!=="string"&&(M=M.concat([new t.V("projection",i,`object or string expected, ${A} found`)]));return M},import:function(_){const{value:i,styleSpec:l}=_,{data:y,...w}=i;Object.defineProperty(w,"__line__",{value:i.__line__,enumerable:!1});let M=bn(t.J({},_,{value:w,valueSpec:l.import}));return t.K(w.id)===""&&M.push(new t.V(`${_.key}.id`,w,"import id can't be an empty string")),y&&(M=M.concat(on(y,l,{key:`${_.key}.data`}))),M}};function it(_,i=!1){const l=_.value,y=_.valueSpec,w=_.styleSpec;if(y.expression&&t.a0(t.K(l)))return vi(_);if(y.expression&&t.O(t.Q(l)))return ii(_);if(y.type&&dt[y.type]){const M=dt[y.type](_);return i===!0&&M.length>0&&t.H(_.value)==="array"?ii(_):M}return bn(t.J({},_,{valueSpec:y.type?w[y.type]:y}))}function Ut(_){const i=_.value,l=_.key,y=Ta(_);return y.length||(i.indexOf("{fontstack}")===-1&&y.push(new t.V(l,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&y.push(new t.V(l,i,'"glyphs" url must include a "{range}" token'))),y}function on(_,i=t.a3,l={}){return it({key:l.key||"",value:_,valueSpec:i.$root,styleSpec:i,style:_,objectElementValidators:{glyphs:Ut,"*":()=>[]}})}function un(_,i=t.a3){return kt(on(_,i))}const kn=_=>kt(Os(_)),fn=_=>kt(to(_)),Wn=_=>kt(ko(_)),Gn=_=>kt(bt(_)),Sn=_=>kt(Qe(_)),et=_=>kt(function(i){const l=i.value,y=i.style,w=i.styleSpec,M=w.snow;let A=[];const V=t.H(l);if(l===void 0)return A;if(V!=="object")return A=A.concat([new t.V("snow",l,`object expected, ${V} found`)]),A;for(const H in l){const K=H.match(/^(.*)-transition$/);A=A.concat(K&&M[K[1]]&&M[K[1]].transition?it({key:H,value:l[H],valueSpec:w.transition,style:y,styleSpec:w}):M[H]?it({key:H,value:l[H],valueSpec:M[H],style:y,styleSpec:w}):[new t.G(H,l[H],`unknown property "${H}"`)])}return A}(_)),we=_=>kt(function(i){const l=i.value,y=i.style,w=i.styleSpec,M=w.rain;let A=[];const V=t.H(l);if(l===void 0)return A;if(V!=="object")return A=A.concat([new t.V("rain",l,`object expected, ${V} found`)]),A;for(const H in l){const K=H.match(/^(.*)-transition$/);A=A.concat(K&&M[K[1]]&&M[K[1]].transition?it({key:H,value:l[H],valueSpec:w.transition,style:y,styleSpec:w}):M[H]?it({key:H,value:l[H],valueSpec:M[H],style:y,styleSpec:w}):[new t.G(H,l[H],`unknown property "${H}"`)])}return A}(_)),Pe=_=>kt(Ar(_)),Ze=_=>kt(Vi(_)),yt=_=>kt(Er(_)),We=_=>kt(sa(_)),pt=_=>kt(t.a2(_));function kt(_){return _.slice().sort((i,l)=>i.line&&l.line?i.line-l.line:0)}function Dt(_,i){let l=!1;if(i&&i.length)for(const y of i)y instanceof t.G?t.w(y.message):(_.fire(new t.y(new Error(y.message))),l=!0);return l}let Jt;class Xt extends t.E{constructor(i,l="flat"){super(),this._transitionable=new t.a4(Jt||(Jt=new t.a5({anchor:new t.a6(t.a3.light.anchor),position:new t.a7(t.a3.light.position),color:new t.a6(t.a3.light.color),intensity:new t.a6(t.a3.light.intensity)}))),this.setLight(i,l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,l,y={}){this._validate(fn,i,y)||(this._transitionable.setTransitionOrValue(i),this.id=l)}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,l,y){return(!y||y.validate!==!1)&&Dt(this,i.call(un,t.l({value:l,style:{glyphs:!0,sprite:!0},styleSpec:t.a3})))}}let Gt=class extends t.E{constructor(_,i,l,y){super(),this.scope=l,this._transitionable=new t.a4(new t.a5({source:new t.a6(t.a3.terrain.source),exaggeration:new t.a6(t.a3.terrain.exaggeration)}),l,y),this._transitionable.setTransitionOrValue(_,y),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i}get(){return this._transitionable.serialize()}set(_,i){this._transitionable.setTransitionOrValue(_,i)}updateTransitions(_){this._transitioning=this._transitionable.transitioned(_,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(_){this.properties=this._transitioning.possiblyEvaluate(_)}getExaggeration(_){return this._transitioning.possiblyEvaluate(new t.a8(_)).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const _=this._transitionable._values.exaggeration;if(!_)return null;const i=_.value.expression;if(!i)return null;let l=-1,y=-1,w=1;for(const M of i.zoomStops)w=i.evaluate(new t.a8(M)),w>.01?(l=M,y=-1):y=M;return w<.01&&l>0&&y>l?[l,y]:null}isZoomDependent(){const _=this._transitionable._values.exaggeration;return _!=null&&_.value!=null&&_.value.expression!=null&&_.value.expression instanceof t.a9}};const On=45,_i=65,li=.05;function Ui(_,i,l,y){const w=t.ac(On,_i,l),[M,A]=qi(_,y);let V=1-Math.min(1,Math.exp((i-M)/(A-M)*-6));return V*=V*V,V=Math.min(1,1.00747*V),V*w*_.alpha}function qi(_,i){const l=.5/Math.tan(.5*i);return[_.range[0]+l,_.range[1]+l]}function Qi(_,i,l,y,w){const M=t.ab.vec3.transformMat4([],[i,l,y],w.mercatorFogMatrix);return Ui(_,t.ab.vec3.length(M),w.pitch,w._fov)}function Ni(_,i,l,y,w,M,A){const V=[[l,y,0],[w,y,0],[w,M,0],[l,M,0]];let H=Number.MAX_VALUE,K=-Number.MAX_VALUE;for(const ee of V){const se=t.ab.vec3.transformMat4([],ee,i),le=t.ab.vec3.length(se);H=Math.min(H,le),K=Math.max(K,le)}return[Ui(_,H,A.pitch,A._fov),Ui(_,K,A.pitch,A._fov)]}class Jr extends t.E{constructor(i,l,y,w){super();const M=new t.a5({range:new t.a6(t.a3.fog.range),color:new t.a6(t.a3.fog.color),"color-use-theme":new t.a6({type:"string","property-type":"data-constant",default:"default"}),"high-color":new t.a6(t.a3.fog["high-color"]),"high-color-use-theme":new t.a6({type:"string","property-type":"data-constant",default:"default"}),"space-color":new t.a6(t.a3.fog["space-color"]),"space-color-use-theme":new t.a6({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new t.a6(t.a3.fog["horizon-blend"]),"star-intensity":new t.a6(t.a3.fog["star-intensity"]),"vertical-range":new t.a6(t.a3.fog["vertical-range"])});this._transitionable=new t.a4(M,y,new Map(w)),this.set(i,w),this._transitioning=this._transitionable.untransitioned(),this._transform=l,this.properties=new t.ad(M),this.scope=y}get state(){const i=this._transform,l=i.projection.name==="globe",y=t.ae(i.zoom),w=this.properties.get("range"),M=[.5,3];return{range:l?[t.af(M[0],w[0],y),t.af(M[1],w[1],y)]:w,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,l,y={}){if(this._validate(Sn,i,y))return;const w=t.l({},i);for(const M of Object.keys(t.a3.fog))w[M]===void 0&&(w[M]=t.a3.fog[M].default);this._options=w,this._transitionable.setTransitionOrValue(this._options,l)}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;const l=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:t.ac(On,_i,i))*l.a}getOpacityAtLatLng(i,l){return this._transform.projection.supportsFog?function(y,w,M){const A=t.aa.fromLngLat(w),V=M.elevation?M.elevation.getAtPointOrZero(A):0;return Qi(y,A.x,A.y,V,M)}(this.state,i,l):0}getOpacityForTile(i){if(!this._transform.projection.supportsFog)return[1,1];const l=this._transform.calculateFogTileMatrix(i.toUnwrapped());return Ni(this.state,l,0,0,t.ag,t.ag,this._transform)}getOpacityForBounds(i,l,y,w,M){return this._transform.projection.supportsFog?Ni(this.state,i,l,y,w,M,this._transform):[1,1]}getFovAdjustedRange(i){return this._transform.projection.supportsFog?qi(this.state,i):[0,1]}isVisibleOnFrustum(i){if(!this._transform.projection.supportsFog)return!1;const l=[4,5,6,7];for(const y of l){const w=i.points[y];let M;if(w[2]>=0)M=w;else{const A=i.points[y-4];M=t.ah(A,w,A[2]/(A[2]-w[2]))}if(Qi(this.state,M[0],M[1],0,this._transform)>=li)return!0}return!1}updateConfig(i){this._transitionable.setTransitionOrValue(this._options,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,l,y){return(!y||y.validate!==!1)&&Dt(this,i.call(un,t.l({value:l,style:{glyphs:!0,sprite:!0},styleSpec:t.a3})))}}let Nr,kr,Zr,Xr,xs=class extends t.E{constructor(_,i,l,y){super();const w=Nr||(Nr=new t.a5({density:new t.a6(t.a3.snow.density),intensity:new t.a6(t.a3.snow.intensity),color:new t.a6(t.a3.snow.color),opacity:new t.a6(t.a3.snow.opacity),vignette:new t.a6(t.a3.snow.vignette),"vignette-color":new t.a6(t.a3.snow["vignette-color"]),"center-thinning":new t.a6(t.a3.snow["center-thinning"]),direction:new t.a6(t.a3.snow.direction),"flake-size":new t.a6(t.a3.snow["flake-size"])}));this._transitionable=new t.a4(w,l,new Map(y)),this.set(_,y),this._transitioning=this._transitionable.untransitioned(),this.properties=new t.ad(w),this.scope=l}get state(){const _=this.properties.get("opacity"),i=this.properties.get("color"),l=this.properties.get("direction"),y=t.ai(l[0]),w=-Math.max(t.ai(l[1]),.01),M=[Math.cos(y)*Math.cos(w),Math.sin(y)*Math.cos(w),Math.sin(w)],A=this.properties.get("vignette"),V=this.properties.get("vignette-color");return V.a=A,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new t.aj(i.r,i.g,i.b,i.a*_),direction:M,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:V}}get(){return this._transitionable.serialize()}set(_,i,l={}){if(this._validate(et,_,l))return;const y=t.l({},_);for(const w of Object.keys(t.a3.snow))y[w]===void 0&&(y[w]=t.a3.snow[w].default);this._options=y,this._transitionable.setTransitionOrValue(this._options,i)}updateConfig(_){this._transitionable.setTransitionOrValue(this._options,new Map(_))}updateTransitions(_){this._transitioning=this._transitionable.transitioned(_,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(_){this.properties=this._transitioning.possiblyEvaluate(_)}_validate(_,i,l){return(!l||l.validate!==!1)&&Dt(this,_.call(un,t.l({value:i,style:{glyphs:!0,sprite:!0},styleSpec:t.a3})))}},go=class extends t.E{constructor(_,i,l,y){super();const w=kr||(kr=new t.a5({density:new t.a6(t.a3.rain.density),intensity:new t.a6(t.a3.rain.intensity),color:new t.a6(t.a3.rain.color),opacity:new t.a6(t.a3.rain.opacity),vignette:new t.a6(t.a3.rain.vignette),"vignette-color":new t.a6(t.a3.rain["vignette-color"]),"center-thinning":new t.a6(t.a3.rain["center-thinning"]),direction:new t.a6(t.a3.rain.direction),"droplet-size":new t.a6(t.a3.rain["droplet-size"]),"distortion-strength":new t.a6(t.a3.rain["distortion-strength"])}));this._transitionable=new t.a4(w,l,new Map(y)),this.set(_,y),this._transitioning=this._transitionable.untransitioned(),this.properties=new t.ad(w),this.scope=l}get state(){const _=this.properties.get("opacity"),i=this.properties.get("color"),l=this.properties.get("direction"),y=t.ai(l[0]),w=-Math.max(t.ai(l[1]),.01),M=[Math.cos(y)*Math.cos(w),Math.sin(y)*Math.cos(w),Math.sin(w)],A=this.properties.get("vignette-color");return A.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new t.aj(i.r,i.g,i.b,i.a*_),direction:M,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:A}}get(){return this._transitionable.serialize()}set(_,i,l={}){if(this._validate(we,_,l))return;const y=t.l({},_);for(const w of Object.keys(t.a3.rain))y[w]===void 0&&(y[w]=t.a3.rain[w].default);this._options=y,this._transitionable.setTransitionOrValue(this._options,i)}updateConfig(_){this._transitionable.setTransitionOrValue(this._options,new Map(_))}updateTransitions(_){this._transitioning=this._transitionable.transitioned(_,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(_){this.properties=this._transitioning.possiblyEvaluate(_)}_validate(_,i,l){return(!l||l.validate!==!1)&&Dt(this,_.call(un,t.l({value:i,style:{glyphs:!0,sprite:!0},styleSpec:t.a3})))}};class Fs extends t.E{constructor(i,l,y,w){super(),this.scope=y,this._options=i,this.properties=new t.ad(l),this._transitionable=new t.a4(l,y,new Map(w)),this._transitionable.setTransitionOrValue(i.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(i){this._transitionable.setTransitionOrValue(this._options.properties,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(i,l){this._options=i,this._transitionable.setTransitionOrValue(i.properties,l)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class bs{constructor(i,l,y,w){this.screenBounds=i,this.cameraPoint=l,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=y,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,w)}static createFromScreenPoints(i,l){let y,w;if(i instanceof t.P||typeof i[0]=="number"){const M=t.P.convert(i);y=[M],w=l.isPointAboveHorizon(M)}else{const M=t.P.convert(i[0]),A=t.P.convert(i[1]);y=[M,A],w=t.al(M,A).every(V=>l.isPointAboveHorizon(V))}return new bs(y,l.getCameraPoint(),w,l)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(i){return t.al(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){const l=this.screenBounds[0],y=this.screenBounds.length===1?this.screenBounds[0].add(new t.P(1,1)):this.screenBounds[1],w=t.al(l,y,0,!1);return this.cameraPoint.y>y.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<y.x?w.splice(3,0,this.cameraPoint):this.cameraPoint.x>=y.x?w[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(w[3]=this.cameraPoint)),t.am(w,i)}bufferedCameraGeometryGlobe(i){const l=this.screenBounds[0],y=this.screenBounds.length===1?this.screenBounds[0].add(new t.P(1,1)):this.screenBounds[1],w=t.al(l,y,i),M=this.cameraPoint.clone();switch(3*((M.y>l.y)+(M.y>y.y))+((M.x>l.x)+(M.x>y.x))){case 0:w[0]=M,w[4]=M.clone();break;case 1:w.splice(1,0,M);break;case 2:w[1]=M;break;case 3:w.splice(4,0,M);break;case 5:w.splice(2,0,M);break;case 6:w[3]=M;break;case 7:w.splice(3,0,M);break;case 8:w[2]=M}return w}containsTile(i,l,y,w=0){const M=i.queryPadding/l._pixelsPerMercatorPixel+1,A=y?this._bufferedCameraMercator(M,l):this._bufferedScreenMercator(M,l);let V=i.tileID.wrap+(A.unwrapped?w:0);const H=A.polygon.map(ke=>t.an(i.tileTransform,ke,V));if(!t.ao(H,0,0,t.ag,t.ag))return;V=i.tileID.wrap+(this.screenGeometryMercator.unwrapped?w:0);const K=this.screenGeometryMercator.polygon.map(ke=>t.ap(i.tileTransform,ke,V)),ee=K.map(ke=>new t.P(ke[0],ke[1])),se=l.getFreeCameraOptions().position||new t.aa(0,0,0),le=t.ap(i.tileTransform,se,V),me=K.map(ke=>{const De=t.ab.vec3.sub(ke,ke,le);return t.ab.vec3.normalize(De,De),new t.aq(le,De)}),Ee=t.ar(i,1,l.zoom)*l._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:ee,tilespaceRays:me,bufferedTilespaceGeometry:H,bufferedTilespaceBounds:(Se=t.as(H),Se.min.x=t.aw(Se.min.x,0,t.ag),Se.min.y=t.aw(Se.min.y,0,t.ag),Se.max.x=t.aw(Se.max.x,0,t.ag),Se.max.y=t.aw(Se.max.y,0,t.ag),Se),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:Ee};var Se}_bufferedScreenMercator(i,l){const y=Xp(i);if(this._screenRaycastCache[y])return this._screenRaycastCache[y];{let w;return w=l.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(i),l):{polygon:this.bufferedScreenGeometry(i).map(M=>l.pointCoordinate3D(M)),unwrapped:!0},this._screenRaycastCache[y]=w,w}}_bufferedCameraMercator(i,l){const y=Xp(i);if(this._cameraRaycastCache[y])return this._cameraRaycastCache[y];{let w;return w=l.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(i),l):{polygon:this.bufferedCameraGeometry(i).map(M=>l.pointCoordinate3D(M)),unwrapped:!0},this._cameraRaycastCache[y]=w,w}}_projectAndResample(i,l){const y=function(M,A){const V=t.ab.mat4.multiply([],A.pixelMatrix,A.globeMatrix),H=[0,-t.ax,0,1],K=[0,t.ax,0,1],ee=[0,0,0,1];t.ab.vec4.transformMat4(H,H,V),t.ab.vec4.transformMat4(K,K,V),t.ab.vec4.transformMat4(ee,ee,V);const se=new t.P(H[0]/H[3],H[1]/H[3]),le=new t.P(K[0]/K[3],K[1]/K[3]),me=t.au(M,se)&&H[3]<ee[3],Ee=t.au(M,le)&&K[3]<ee[3];if(!me&&!Ee)return null;const Se=function(vt,_t,Mt){for(let Ft=1;Ft<vt.length;Ft++){const cn=Lc(_t.pointCoordinate3D(vt[Ft-1]).x),en=Lc(_t.pointCoordinate3D(vt[Ft]).x);if(Mt<0){if(cn<en)return{idx:Ft,t:-cn/(en-1-cn)}}else if(en<cn)return{idx:Ft,t:(1-cn)/(en+1-cn)}}return null}(M,A,me?-1:1);if(!Se)return null;const{idx:ke,t:De}=Se;let Xe=ke>1?Ou(M.slice(0,ke),A):[],ut=ke<M.length?Ou(M.slice(ke),A):[];Xe=Xe.map(vt=>new t.P(Lc(vt.x),vt.y)),ut=ut.map(vt=>new t.P(Lc(vt.x),vt.y));const st=[...Xe];st.length===0&&st.push(ut[ut.length-1]);const wt=t.af(st[st.length-1].y,(ut.length===0?Xe[0]:ut[0]).y,De);let gt;return gt=me?[new t.P(0,wt),new t.P(0,0),new t.P(1,0),new t.P(1,wt)]:[new t.P(1,wt),new t.P(1,1),new t.P(0,1),new t.P(0,wt)],st.push(...gt),ut.length===0?st.push(Xe[0]):st.push(...ut),{polygon:st.map(vt=>new t.aa(vt.x,vt.y)),unwrapped:!1}}(i,l);if(y)return y;const w=function(M,A){let V=!1,H=-1/0,K=0;for(let se=0;se<M.length-1;se++)M[se].x>H&&(H=M[se].x,K=se);for(let se=0;se<M.length-1;se++){const le=(K+se)%(M.length-1),me=M[le],Ee=M[le+1];Math.abs(me.x-Ee.x)>.5&&(me.x<Ee.x?(me.x+=1,le===0&&(M[M.length-1].x+=1)):(Ee.x+=1,le+1===M.length-1&&(M[0].x+=1)),V=!0)}const ee=t.at(A.center.lng);return V&&ee<Math.abs(ee-1)&&M.forEach(se=>{se.x-=1}),{polygon:M,unwrapped:V}}(Ou(i,l).map(M=>new t.P(Lc(M.x),M.y)),l);return{polygon:w.polygon.map(M=>new t.aa(M.x,M.y)),unwrapped:w.unwrapped}}}function Ou(_,i){return t.av(_,l=>{const y=i.pointCoordinate3D(l);l.x=y.x,l.y=y.y},1/256)}function Lc(_){return _<0?1+_%1:_%1}function Xp(_){return 100*_|0}function Gf(_,i,l,y,w){const M=function(V,H){if(V)return w(V);if(H){if(_.url&&H.tiles&&_.tiles&&delete _.tiles,H.variants){if(!Array.isArray(H.variants))return w(new Error("variants must be an array"));for(const ee of H.variants){if(ee==null||typeof ee!="object"||ee.constructor!==Object)return w(new Error("variant must be an object"));if(!Array.isArray(ee.capabilities))return w(new Error("capabilities must be an array"));if(ee.capabilities.length===1&&ee.capabilities[0]==="meshopt"){H=t.l(H,ee);break}}}const K=t.ay(t.l({},H,_),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);K.tiles=i.canonicalizeTileset(K,_.url),w(null,K)}},A=function(V,H,K){if(!V)return null;if(!H&&!K)return V;K=K||V.worldview_default;const ee=Object.values(V.language||{});if(ee.length===0)return null;const se=Object.values(V.worldview||{});if(se.length===0)return null;const le=ee.every(Ee=>Ee===H),me=se.every(Ee=>Ee===K);return le&&me?V:H in(V.language_options||{})||K in(V.worldview_options||{})?null:V.language_options&&V.worldview_options?V:null}(_.data,l,y);return A?t.q.frame(()=>M(null,A)):_.url?t.n(i.transformRequest(i.normalizeSourceURL(_.url,null,l,y),t.R.Source),M):t.q.frame(()=>{const{data:V,...H}=_;M(null,H)})}class Fu{constructor(i,l,y){this.bounds=t.az.convert(this.validateBounds(i)),this.minzoom=l||0,this.maxzoom=y||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const l=Math.pow(2,i.z),y=Math.floor(t.at(this.bounds.getWest())*l),w=Math.floor(t.aA(this.bounds.getNorth())*l),M=Math.ceil(t.at(this.bounds.getEast())*l),A=Math.ceil(t.aA(this.bounds.getSouth())*l);return i.x>=y&&i.x<M&&i.y>=w&&i.y<A}}class Yh extends t.E{constructor(i,l,y,w){if(super(),this.id=i,this.dispatcher=y,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.l(this,t.ay(l,["url","scheme","tileSize","promoteId"])),this._options=t.l({type:"vector"},l),this._collectResourceTiming=!!l.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w),this._tileWorkers={},this._deduped=new t.aB}load(i){this._loaded=!1,this.fire(new t.z("dataloading",{dataType:"source"}));const l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,y=this.map.getWorldview();this._tileJSONRequest=Gf(this._options,this.map._requestManager,l,y,(w,M)=>{if(this._tileJSONRequest=null,this._loaded=!0,w)l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),y&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${y}`),this.fire(new t.y(w));else if(M){if(t.l(this,M),this.hasWorldviews=!!M.worldview_options,M.worldview_default&&(this.worldviewDefault=M.worldview_default),M.vector_layers){this.vectorLayers=M.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const A of M.vector_layers)this.vectorLayerIds.push(A.id),M.worldview&&M.worldview[A.source]&&this.localizableLayerIds.add(A.id)}M.bounds&&(this.tileBounds=new Fu(M.bounds,this.minzoom,this.maxzoom)),Nn(M.tiles,this.map._requestManager._customAccessToken),this.fire(new t.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.z("data",{dataType:"source",sourceDataType:"content"}))}i&&i(w)})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();const i=t.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(i){this.cancelTileJSONRequest()}serialize(){return t.l({},this._options)}loadTile(i,l){const y=i.tileID.canonical.url(this.tiles,this.scheme),w=this.map._requestManager.normalizeTileURL(y),M=this.map._requestManager.transformRequest(w,t.R.Tile),A=this.map.style?this.map.style.getLut(this.scope):null,V=A?{image:A.image.clone()}:null,H={request:M,data:void 0,uid:i.uid,tileID:i.tileID,tileZoom:i.tileZoom,zoom:i.tileID.overscaledZ,maxZoom:this.maxzoom,lut:V,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:t.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:i.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:i.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor()};if(this.hasWorldviews&&t.f(y)&&(H.worldview=this.map.getWorldview()||this.worldviewDefault,H.localizableLayerIds=this.localizableLayerIds),H.request.collectResourceTiming=this._collectResourceTiming,i.actor&&i.state!=="expired")i.state==="loading"?i.reloadCallback=l:i.request=i.actor.send("reloadTile",H,K.bind(this));else if(i.actor=this._tileWorkers[w]=this._tileWorkers[w]||this.dispatcher.getActor(),this.dispatcher.ready)i.request=i.actor.send("loadTile",H,K.bind(this),void 0,!0);else{const ee=t.aD.call({deduped:this._deduped},H,(se,le)=>{se||!le?K.call(this,se):(H.data={cacheControl:le.cacheControl,expires:le.expires,rawData:le.rawData.slice(0)},i.actor&&i.actor.send("loadTile",H,K.bind(this),void 0,!0))},!0);i.request={cancel:ee}}function K(ee,se){return delete i.request,i.aborted?l(null):ee&&ee.status!==404?l(ee):(se&&se.resourceTiming&&(i.resourceTiming=se.resourceTiming),this.map._refreshExpiredTiles&&se&&i.setExpiryData(se),i.loadVectorData(se,this.map.painter),t.aE(this.dispatcher),l(null),void(i.reloadCallback&&(this.loadTile(i,i.reloadCallback),i.reloadCallback=null)))}}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.actor&&i.actor.send("abortTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(i,l){i.actor&&i.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope}),i.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Zl extends t.E{constructor(i,l,y,w){super(),this.id=i,this.dispatcher=y,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.l({type:"raster"},l),t.l(this,t.ay(l,["url","scheme","tileSize"]))}load(i){this._loaded=!1,this.fire(new t.z("dataloading",{dataType:"source"})),this._tileJSONRequest=Gf(this._options,this.map._requestManager,null,null,(l,y)=>{this._tileJSONRequest=null,this._loaded=!0,l?this.fire(new t.y(l)):y&&(t.l(this,y),y.raster_layers&&(this.rasterLayers=y.raster_layers,this.rasterLayerIds=this.rasterLayers.map(w=>w.id)),y.bounds&&(this.tileBounds=new Fu(y.bounds,this.minzoom,this.maxzoom)),Nn(y.tiles),this.fire(new t.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.z("data",{dataType:"source",sourceDataType:"content"}))),i&&i(l)})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();const i=t.aC(this.id,this.scope);this.load(()=>this.map.style.clearSource(i))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(i){this.cancelTileJSONRequest()}serialize(){return t.l({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,l){const y=t.q.devicePixelRatio>=2,w=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),y,this.tileSize);i.request=t.o(this.map._requestManager.transformRequest(w,t.R.Tile),(M,A,V,H)=>(delete i.request,i.aborted?(i.state="unloaded",l(null)):M?(i.state="errored",l(M)):A?(this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:V,expires:H}),i.setTexture(A,this.map.painter),i.state="loaded",t.aE(this.dispatcher),void l(null)):l(null)))}abortTile(i,l){i.request&&(i.request.cancel(),delete i.request),l&&l()}unloadTile(i,l){i.texture&&i.texture instanceof t.T?(i.destroy(!0),i.texture&&i.texture instanceof t.T&&this.map.painter.saveTileTexture(i.texture)):i.destroy(),l&&l()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class dc extends Zl{constructor(i,l,y,w){super(i,l,y,w),this.type="raster-array",this.maxzoom=22,this._options=t.l({type:"raster-array"},l)}triggerRepaint(i){const l=this.map.painter._terrain,y=this.map.style.getSourceCache(this.id);l&&l.enabled&&y&&l._clearRenderCacheForTile(y.id,i.tileID),this.map.triggerRepaint()}loadTile(i,l){const y=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),w=this.map._requestManager.transformRequest(y,t.R.Tile);i.requestParams=w,i.actor||(i.actor=this.dispatcher.getActor()),i.request=i.fetchHeader(void 0,(M,A,V,H)=>{if(delete i.request,i.aborted)return i.state="unloaded",l(null);if(M)return M.code===20?void 0:(i.state="errored",l(M));this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:V,expires:H}),i.state="empty",l(null)})}unloadTile(i,l){const y=i.texture;y&&y instanceof t.T?(i.destroy(!0),this.map.painter.saveTileTexture(y)):(i.destroy(),i.flushQueues(),i._isHeaderLoaded=!1,delete i._mrt,delete i.textureDescriptor),i.fbo&&(i.fbo.destroy(),delete i.fbo),delete i.request,delete i.requestParams,delete i.neighboringTiles,i.state="unloaded"}prepareTile(i,l,y){i._isHeaderLoaded&&(i.state!=="empty"&&(i.state="reloading"),i.fetchBand(l,y,(w,M)=>{if(w)return i.state="errored",this.fire(new t.y(w)),void this.triggerRepaint(i);M&&(i.setTexture(M,this.map.painter),i.state="loaded",this.triggerRepaint(i))}))}getInitialBand(i){if(!this.rasterLayers)return 0;const l=this.rasterLayers.find(({id:M})=>M===i),y=l&&l.fields,w=y&&y.bands&&y.bands;return w?w[0]:0}getTextureDescriptor(i,l,y){if(!i)return;const w=l.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!w)return;let M=null;l instanceof t.aH?M=l.paint.get("raster-array-band"):l instanceof t.aI&&(M=l.paint.get("raster-particle-array-band"));const A=M||this.getInitialBand(w);if(A!=null)if(i.textureDescriptor){if(!i.updateNeeded(w,A)||y)return Object.assign({},i.textureDescriptor,{texture:i.texture})}else this.prepareTile(i,w,A)}}const Bu={vector:Yh,raster:Zl,"raster-dem":class extends Zl{constructor(_,i,l,y){super(_,i,l,y),this.type="raster-dem",this.maxzoom=22,this._options=t.l({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(_,i){const l=this.map._requestManager.normalizeTileURL(_.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function y(w,M){w&&(_.state="errored",i(w)),M&&(_.dem=M,_.dem.onDeserialize(),_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0,_.state="loaded",i(null))}_.request=t.o(this.map._requestManager.transformRequest(l,t.R.Tile),(function(w,M,A,V){if(delete _.request,_.aborted)_.state="unloaded",i(null);else if(w)_.state="errored",i(w);else if(M){this.map._refreshExpiredTiles&&_.setExpiryData({cacheControl:A,expires:V});const H=ImageBitmap&&M instanceof ImageBitmap&&t.t(),K=1-(M.width-t.aF(M.width))/2;K<1||_.neighboringTiles||(_.neighboringTiles=this._getNeighboringTiles(_.tileID));const ee=H?M:t.q.getImageData(M,K),se={uid:_.uid,coord:_.tileID,source:this.id,scope:this.scope,rawImageData:ee,encoding:this.encoding,padding:K};_.actor&&_.state!=="expired"||(_.actor=this.dispatcher.getActor(),_.actor.send("loadDEMTile",se,y.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(_){const i=_.canonical,l=Math.pow(2,i.z),y=(i.x-1+l)%l,w=i.x===0?_.wrap-1:_.wrap,M=(i.x+1+l)%l,A=i.x+1===l?_.wrap+1:_.wrap,V={};return V[new t.aG(_.overscaledZ,w,i.z,y,i.y).key]={backfilled:!1},V[new t.aG(_.overscaledZ,A,i.z,M,i.y).key]={backfilled:!1},i.y>0&&(V[new t.aG(_.overscaledZ,w,i.z,y,i.y-1).key]={backfilled:!1},V[new t.aG(_.overscaledZ,_.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},V[new t.aG(_.overscaledZ,A,i.z,M,i.y-1).key]={backfilled:!1}),i.y+1<l&&(V[new t.aG(_.overscaledZ,w,i.z,y,i.y+1).key]={backfilled:!1},V[new t.aG(_.overscaledZ,_.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},V[new t.aG(_.overscaledZ,A,i.z,M,i.y+1).key]={backfilled:!1}),V}},"raster-array":dc,geojson:class extends t.E{constructor(_,i,l,y){super(),this.id=_,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(y),this._data=i.data,this._options=t.l({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.minzoom!==void 0&&(this.minzoom=i.minzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const w=t.ag/this.tileSize;this.workerOptions=t.l({source:this.id,scope:this.scope,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(i.buffer!==void 0?i.buffer:128)*w,tolerance:(i.tolerance!==void 0?i.tolerance:.375)*w,extent:t.ag,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:i.clusterMaxZoom!==void 0?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:t.ag,radius:(i.clusterRadius!==void 0?i.clusterRadius:50)*w,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter,dynamic:i.dynamic},i.workerOptions)}onAdd(_){this.map=_,this.setData(this._data)}setData(_){return this._data=_,this._updateWorkerData(),this}updateData(_){if(!this._options.dynamic)return this.fire(new t.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof _!="string"&&(_.type==="Feature"&&(_={type:"FeatureCollection",features:[_]}),_.type!=="FeatureCollection"))return this.fire(new t.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof _!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const i=new Map;for(const l of this._data.features)i.set(l.id,l);for(const l of _.features)i.set(l.id,l);this._data.features=[...i.values()]}else this._data=_;return this._updateWorkerData(!0),this}getClusterExpansionZoom(_,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:_,source:this.id,scope:this.scope},i),this}getClusterChildren(_,i){return this.actor.send("geojson.getClusterChildren",{clusterId:_,source:this.id,scope:this.scope},i),this}getClusterLeaves(_,i,l,y){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:_,limit:i,offset:l},y),this}_updateWorkerData(_=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new t.z("dataloading",{dataType:"source"})),this._loaded=!1;const i=t.l({append:_},this.workerOptions);i.scope=this.scope;const l=this._data;typeof l=="string"?(i.request=this.map._requestManager.transformRequest(t.q.resolveURL(l),t.R.Source),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(l),this._pendingLoad=this.actor.send(`${this.type}.loadData`,i,(y,w)=>{if(this._loaded=!0,this._pendingLoad=null,y)this.fire(new t.y(y));else{const M={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&w&&w.resourceTiming&&w.resourceTiming[this.id]&&(M.resourceTiming=w.resourceTiming[this.id]),_&&(this._partialReload=!0),this.fire(new t.z("data",M)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(_),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(_,i){const l=_.actor?"reloadTile":"loadTile";_.actor=this.actor;const y=this.map.style?this.map.style.getLut(this.scope):null,w=y?{image:y.image.clone()}:null,M=this._partialReload,A={type:this.type,uid:_.uid,tileID:_.tileID,tileZoom:_.tileZoom,zoom:_.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:w,scope:this.scope,pixelRatio:t.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,scaleFactor:this.map.getScaleFactor(),partial:M};_.request=this.actor.send(l,A,(V,H)=>M&&!H?(_.state="loaded",i(null)):(delete _.request,_.destroy(),_.aborted?i(null):V?i(V):(_.loadVectorData(H,this.map.painter,l==="reloadTile"),i(null))),void 0,l==="loadTile")}abortTile(_){_.request&&(_.request.cancel(),delete _.request),_.aborted=!0}unloadTile(_,i){this.actor.send("removeTile",{uid:_.uid,type:this.type,source:this.id,scope:this.scope}),_.destroy()}onRemove(_){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return t.l({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends t.aJ{constructor(_,i,l,y){super(_,i,l,y),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;const _=this.options;this.urls=[];for(const i of _.urls)this.urls.push(this.map._requestManager.transformRequest(i,t.R.Source).url);t.aK(this.urls,(i,l)=>{this._loaded=!0,i?this.fire(new t.y(i)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(_){if(this.video){const i=this.video.seekable;_<i.start(0)||_>i.end(0)?this.fire(new t.y(new t.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=_}}getVideo(){return this.video}onAdd(_){this.map||(this.map=_,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const _=this.map.painter.context,i=_.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new t.T(_,this.video,i.RGBA8),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(_)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:t.aJ,model:class extends t.E{constructor(_,i,l,y){super(),this.id=_,this.type="model",this.models=[],this._loaded=!1,this._options=i}load(){const _=[];for(const i in this._options.models){const l=this._options.models[i],y=t.aM(this.map._requestManager.transformRequest(l.uri,t.R.Model).url).then(w=>{if(!w)return;const M=t.aN(w),A=new t.aO(i,l.position,l.orientation,M);A.computeBoundsAndApplyParent(),this.models.push(A)}).catch(w=>{this.fire(new t.y(new Error(`Could not load model ${i} from ${l.uri}: ${w.message}`)))});_.push(y)}return Promise.allSettled(_).then(()=>{this._loaded=!0,this.fire(new t.z("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(i=>{this.fire(new t.y(new Error(`Could not load models: ${i.message}`)))})}onAdd(_){this.map=_,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(_,i){}serialize(){return{type:"model"}}},"batched-model":class extends t.E{constructor(_,i,l,y){super(),this.type="batched-model",this.id=_,this.tileSize=512,this._options=i,this.tiles=this._options.tiles,this.maxzoom=i.maxzoom||19,this.minzoom=i.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=l,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(y)}onAdd(_){this.map=_,this.load()}load(_){this._loaded=!1,this.fire(new t.z("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,l=this.map.getWorldview();this._tileJSONRequest=Gf(this._options,this.map._requestManager,i,l,(y,w)=>{this._tileJSONRequest=null,this._loaded=!0,y?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),l&&l.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${l}`),this.fire(new t.y(y))):w&&(t.l(this,w),w.bounds&&(this.tileBounds=new Fu(w.bounds,this.minzoom,this.maxzoom)),Nn(w.tiles,this.map._requestManager._customAccessToken),this.fire(new t.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.z("data",{dataType:"source",sourceDataType:"content"}))),_&&_(y)})}hasTransition(){return!1}hasTile(_){return!this.tileBounds||this.tileBounds.contains(_.canonical)}loaded(){return this._loaded}loadTile(_,i){const l=this.map._requestManager.normalizeTileURL(_.tileID.canonical.url(this.tiles,this.scheme)),y={request:this.map._requestManager.transformRequest(l,t.R.Tile),data:void 0,uid:_.uid,tileID:_.tileID,tileZoom:_.tileZoom,zoom:_.tileID.overscaledZ,tileSize:this.tileSize*_.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:_.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,lut:null,maxZoom:null,promoteId:null,pixelRatio:null,scaleFactor:null};if(_.actor&&_.state!=="expired")if(_.state==="loading")_.reloadCallback=i;else{if(_.buckets){const M=Object.values(_.buckets);for(const A of M)A.dirty=!0;return void(_.state="loaded")}_.request=_.actor.send("reloadTile",y,w.bind(this))}else _.actor=this.dispatcher.getActor(),_.request=_.actor.send("loadTile",y,w.bind(this),void 0,!0);function w(M,A){return _.aborted?i(null):M&&M.status!==404?i(M):(this.map._refreshExpiredTiles&&A&&_.setExpiryData(A),_.loadModelData(A,this.map.painter),_.state="loaded",void i(null))}}serialize(){return t.l({},this._options)}},canvas:class extends t.aJ{constructor(_,i,l,y){super(_,i,l,y),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some(w=>!Array.isArray(w)||w.length!==2||w.some(M=>typeof M!="number"))||this.fire(new t.y(new t.V(`sources.${_}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.y(new t.V(`sources.${_}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new t.y(new t.V(`sources.${_}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof HTMLCanvasElement||this.fire(new t.y(new t.V(`sources.${_}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.y(new t.V(`sources.${_}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(_){this.map=_,this.load(),this.canvas&&this.animate&&this.play()}onRemove(_){this.pause()}prepare(){let _=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,_=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,_=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const i=this.map.painter.context;this.texture?!_&&!this._playing||this.texture instanceof t.aL||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.T(i,this.canvas,i.gl.RGBA8,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const _ of[this.canvas.width,this.canvas.height])if(isNaN(_)||_<=0)return!0;return!1}},custom:class extends t.E{constructor(_,i,l,y){super(),this.id=_,this.type="custom",this._dataType="raster",this._dispatcher=l,this._implementation=i,this.setEventedParent(y),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new t.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new t.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Fu(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),t.l(this,t.ay(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return t.ay(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new t.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(_){this.map=_,this._loaded=!1,this.fire(new t.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(_),this.load()}onRemove(_){this._implementation.onRemove&&this._implementation.onRemove(_)}hasTile(_){if(this._implementation.hasTile){const{x:i,y:l,z:y}=_.canonical;return this._implementation.hasTile({x:i,y:l,z:y})}return!this.tileBounds||this.tileBounds.contains(_.canonical)}loadTile(_,i){const{x:l,y,z:w}=_.tileID.canonical,M=new AbortController;_.request=Promise.resolve(this._implementation.loadTile({x:l,y,z:w},{signal:M.signal})).then((function(A){return delete _.request,_.aborted?(_.state="unloaded",i(null)):A===void 0?(_.state="errored",i(null)):A===null?(this.loadTileData(_,{width:this.tileSize,height:this.tileSize,data:null}),_.state="loaded",i(null)):function(V){return V instanceof ImageData||V instanceof HTMLCanvasElement||V instanceof ImageBitmap||V instanceof HTMLImageElement}(A)?(this.loadTileData(_,A),_.state="loaded",void i(null)):(_.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(A=>{A.code!==20&&(_.state="errored",i(A))}),_.request.cancel=()=>M.abort()}loadTileData(_,i){_.setTexture(i,this.map.painter)}unloadTile(_,i){if(_.texture&&_.texture instanceof t.T?(_.destroy(!0),_.texture&&_.texture instanceof t.T&&this.map.painter.saveTileTexture(_.texture)):_.destroy(),this._implementation.unloadTile){const{x:l,y,z:w}=_.tileID.canonical;this._implementation.unloadTile({x:l,y,z:w})}i&&i()}abortTile(_,i){_.request&&_.request.cancel&&(_.request.cancel(),delete _.request),i&&i()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(_=>({x:_.canonical.x,y:_.canonical.y,z:_.canonical.z}))}_clearTiles(){const _=t.aC(this.id,this.scope);this.map.style.clearSource(_)}_update(){this.fire(new t.z("data",{dataType:"source",sourceDataType:"content"}))}}},ru=function(_,i,l,y){const w=new Bu[i.type](_,i,l,y);if(w.id!==_)throw new Error(`Expected Source id to be ${_} instead of ${w.id}`);return t.aP(["load","abort","unload","serialize","prepare"],w),w};function qf(_,i,l,y,w=!1){const M=i.sourceCache.transform,A=i.sourceCache.tilesIn(_,i.has3DLayers,w);A.sort(zc);const V=[];for(const H of A){const K=H.tile.queryRenderedFeatures(i,H,l,y,M,w);Object.keys(K).length&&V.push({wrappedTileID:H.tile.tileID.wrapped().key,queryResults:K})}return V.length===0?{}:function(H){const K={},ee={};for(const se of H){const le=se.queryResults,me=se.wrappedTileID,Ee=ee[me]=ee[me]||{};for(const Se in le){const ke=le[Se],De=Ee[Se]=Ee[Se]||{},Xe=K[Se]=K[Se]||[];for(const ut of ke)De[ut.featureIndex]||(De[ut.featureIndex]=!0,Xe.push(ut))}}return K}(V)}function _h(_,i,l,y,w){const M={},A=y.queryRenderedSymbols(_),V=[];for(const H of Object.keys(A).map(Number))V.push(w[H]);V.sort(zc);for(const H of V){const K=H.featureIndex.lookupSymbolFeatures(A[H.bucketInstanceId],H.bucketIndex,H.sourceLayerIndex,i,l);for(const ee in K){const se=M[ee]=M[ee]||[],le=K[ee];le.sort((me,Ee)=>{const Se=H.featureSortOrder;if(Se){const ke=Se.indexOf(me.featureIndex);return Se.indexOf(Ee.featureIndex)-ke}return Ee.featureIndex-me.featureIndex});for(const me of le)se.push(me)}}return M}function Kh(_,i){const l=_.getRenderableIds().map(M=>_.getTileByID(M)),y=[],w={};for(let M=0;M<l.length;M++){const A=l[M],V=A.tileID.canonical.key;w[V]||(w[V]=!0,A.querySourceFeatures(y,i))}return y}function zc(_,i){const l=_.tileID,y=i.tileID;return l.overscaledZ-y.overscaledZ||l.canonical.y-y.canonical.y||l.wrap-y.wrap||l.canonical.x-y.canonical.x}function Gd(_,i){const l={};if(!i)return l;for(const y of _){const w=y.layerIds.map(M=>i.getLayer(M)).filter(Boolean);if(w.length!==0){y.layers=w,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(M=>w.filter(A=>A.id===M)[0]));for(const M of w)l[M.fqid]=y}}return l}const ks=32,zr=33,Bs=new Uint16Array(8184);for(let _=0;_<2046;_++){let i=_+2,l=0,y=0,w=0,M=0,A=0,V=0;for(1&i?w=M=A=ks:l=y=V=ks;(i>>=1)>1;){const K=l+w>>1,ee=y+M>>1;1&i?(w=l,M=y,l=A,y=V):(l=w,y=M,w=A,M=V),A=K,V=ee}const H=4*_;Bs[H+0]=l,Bs[H+1]=y,Bs[H+2]=w,Bs[H+3]=M}const Br=new Uint16Array(2178),Wl=new Uint8Array(1089),qd=new Uint16Array(1089);function au(_){return _===0?-.03125:_===32?.03125:0}const $a={type:2,extent:t.ag,loadGeometry:()=>[[new t.P(0,0),new t.P(t.ag+1,0),new t.P(t.ag+1,t.ag+1),new t.P(0,t.ag+1),new t.P(0,0)]]};class ss{constructor(i,l,y,w,M){this.tileID=i,this.uid=t.aV(),this.uses=0,this.tileSize=l,this.tileZoom=y,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=M,w&&w.style&&(this._lastUpdatedBrightness=w.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",w&&w.transform&&(this.projection=w.transform.projection)}registerFadeDuration(i){const l=i+this.timeAdded;l<t.q.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=t.aQ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(i,l,y){if(this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=Gd(i.buckets,l.style),this.hasSymbolBuckets=!1;for(const w in this.buckets){const M=this.buckets[w];if(M instanceof t.aX){if(this.hasSymbolBuckets=!0,!y)break;M.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const w in this.buckets){const M=this.buckets[w];if(M instanceof t.aX&&M.hasRTLText){this.hasRTLText=!0,t.aY();break}}this.queryPadding=0;for(const w in this.buckets){const M=this.buckets[w],A=l.style.getOwnLayer(w);if(!A)continue;const V=A.queryRadius(M);this.queryPadding=Math.max(this.queryPadding,V)}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),i.lineAtlas&&(this.lineAtlas=i.lineAtlas),this._lastUpdatedBrightness=i.brightness}else this.collisionBoxArray=new t.aW}unloadVectorData(){if(this.hasData()){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(i,l,y){i&&(i.resourceTiming&&(this.resourceTiming=i.resourceTiming),this.buckets={...this.buckets,...Gd(i.buckets,l.style)},i.featureIndex&&(this.latestFeatureIndex=i.featureIndex))}getBucket(i){return this.buckets[i.fqid]}upload(i){for(const w in this.buckets){const M=this.buckets[w];M.uploadPending()&&M.upload(i)}const l=i.gl,y=this.imageAtlas;if(y&&!y.uploaded){const w=!!Object.keys(y.patternPositions).length;this.imageAtlasTexture=new t.T(i,y.image,l.RGBA8,{useMipmap:w}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new t.T(i,this.glyphAtlasImage,l.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new t.T(i,this.lineAtlas.image,l.R8),this.lineAtlas.uploaded=!0)}prepare(i,l,y){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture,y),!l||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const w=l.style.getBrightness();(this._lastUpdatedBrightness||w)&&(this._lastUpdatedBrightness&&w&&Math.abs(this._lastUpdatedBrightness-w)<.001||(this.updateBuckets(l,this._lastUpdatedBrightness!==w),this._lastUpdatedBrightness=w))}queryRenderedFeatures(i,l,y,w,M,A){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const V=function(H,K){const ee=t.ab.mat4.fromScaling([],[.5*H.width,.5*-H.height,1]);return t.ab.mat4.translate(ee,ee,[1,-1,0]),t.ab.mat4.multiply(ee,ee,H.calculateProjMatrix(K.toUnwrapped())),Float32Array.from(ee)}(M,this.tileID);return this.latestFeatureIndex.query(i,{tilespaceGeometry:l,pixelPosMatrix:V,transform:w,availableImages:y,tileTransform:this.tileTransform})}querySourceFeatures(i,l){const y=this.latestFeatureIndex;if(!y||!y.rawTileData)return;const w=y.loadVTLayers(),M=l?l.sourceLayer:"",A=w._geojsonTileLayer||w[M];if(!A)return;const V=t.aZ(l&&l.filter),{z:H,x:K,y:ee}=this.tileID.canonical,se={z:H,x:K,y:ee};for(let le=0;le<A.length;le++){const me=A.feature(le);if(V.needGeometry){const ke=t.a_(me,!0);if(!V.filter(new t.a8(this.tileID.overscaledZ),ke,this.tileID.canonical))continue}else if(!V.filter(new t.a8(this.tileID.overscaledZ),me))continue;const Ee=y.getId(me,M),Se=new t.a$(me,H,K,ee,Ee);Se.tile=se,i.push(Se)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const l=this.expirationTime;if(i.cacheControl){const y=t.b0(i.cacheControl);y["max-age"]&&(this.expirationTime=Date.now()+1e3*y["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const y=Date.now();let w=!1;if(this.expirationTime>y)w=!1;else if(l)if(this.expirationTime<l)w=!0;else{const M=this.expirationTime-l;M?this.expirationTime=y+Math.max(M,3e4):w=!0}else w=!0;w?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(i){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&i&&this.updateBuckets(i)}updateBuckets(i,l){if(!this.latestFeatureIndex||!i.style)return;const y=this.latestFeatureIndex.loadVTLayers(),w=i.style.listImages(),M=i.style.getBrightness();for(const A in this.buckets){if(!i.style.hasLayer(A))continue;const V=this.buckets[A],H=V.layers[0],K=H.sourceLayer||"_geojsonTileLayer",ee=y[K],se=i.style.getLayerSourceCache(H);let le={};se&&(le=se._state.getState(K,void 0));const me=this.imageAtlas&&this.imageAtlas.patternPositions||{},Ee=Object.keys(le).length>0&&!l;Ee&&!V.stateDependentLayers.length&&!l||V.update(le,ee,w,me,Ee?V.stateDependentLayers:V.layers,l,M),(V instanceof t.b1||V instanceof t.b2)&&i._terrain&&i._terrain.enabled&&se&&V.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(se.id,this.tileID);const Se=i&&i.style&&i.style.getOwnLayer(A);Se&&(this.queryPadding=Math.max(this.queryPadding,Se.queryRadius(V)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<t.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=t.q.now()+i}setTexture(i,l){const y=l.context,w=y.gl;this.texture=this.texture||l.getTileTexture(i.width),this.texture&&this.texture instanceof t.T?this.texture.update(i):(this.texture=new t.T(y,i,w.RGBA8,{useMipmap:!0}),this.texture.bind(w.LINEAR,w.CLAMP_TO_EDGE))}setDependencies(i,l){const y={};for(const w of l)y[w]=!0;this.dependencies[i]=y}hasDependency(i,l){for(const y of i){const w=this.dependencies[y];if(w){for(const M of l)if(w[M])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(i,l){if(!l||l.name==="mercator"||this._tileDebugBuffer)return;const y=t.b3($a,this.tileID.canonical,this.tileTransform)[0],w=new t.b4,M=new t.b5;for(let A=0;A<y.length;A++){const{x:V,y:H}=y[A];w.emplaceBack(V,H),M.emplaceBack(A)}M.emplaceBack(0),this._tileDebugIndexBuffer=i.createIndexBuffer(M),this._tileDebugBuffer=i.createVertexBuffer(w,t.b6.members),this._tileDebugSegments=t.b7.simpleSegment(0,0,w.length,M.length)}_makeTileBoundsBuffers(i,l){if(this._tileBoundsBuffer||!l||l.name==="mercator")return;const y=t.b3($a,this.tileID.canonical,this.tileTransform)[0];let w,M;if(this.isRaster){const A=function(V,H){const K=t.aQ(V,H),ee=Math.pow(2,V.z);for(let ke=0;ke<zr;ke++)for(let De=0;De<zr;De++){const Xe=t.aR((V.x+(De+au(De))/ks)/ee),ut=t.aS((V.y+(ke+au(ke))/ks)/ee),st=H.project(Xe,ut),wt=ke*zr+De;Br[2*wt+0]=Math.round((st.x*K.scale-K.x)*t.ag),Br[2*wt+1]=Math.round((st.y*K.scale-K.y)*t.ag)}Wl.fill(0),qd.fill(0);for(let ke=2045;ke>=0;ke--){const De=4*ke,Xe=Bs[De+0],ut=Bs[De+1],st=Bs[De+2],wt=Bs[De+3],gt=Xe+st>>1,vt=ut+wt>>1,_t=gt+vt-ut,Mt=vt+Xe-gt,Ft=ut*zr+Xe,cn=wt*zr+st,en=vt*zr+gt,zt=Math.hypot((Br[2*Ft+0]+Br[2*cn+0])/2-Br[2*en+0],(Br[2*Ft+1]+Br[2*cn+1])/2-Br[2*en+1])>=16;Wl[en]=Wl[en]||(zt?1:0),ke<1022&&(Wl[en]=Wl[en]||Wl[(ut+Mt>>1)*zr+(Xe+_t>>1)]||Wl[(wt+Mt>>1)*zr+(st+_t>>1)])}const se=new t.aT,le=new t.aU;let me=0;function Ee(ke,De){const Xe=De*zr+ke;return qd[Xe]===0&&(se.emplaceBack(Br[2*Xe+0],Br[2*Xe+1],ke*t.ag/ks,De*t.ag/ks),qd[Xe]=++me),qd[Xe]-1}function Se(ke,De,Xe,ut,st,wt){const gt=ke+Xe>>1,vt=De+ut>>1;if(Math.abs(ke-st)+Math.abs(De-wt)>1&&Wl[vt*zr+gt])Se(st,wt,ke,De,gt,vt),Se(Xe,ut,st,wt,gt,vt);else{const _t=Ee(ke,De),Mt=Ee(Xe,ut),Ft=Ee(st,wt);le.emplaceBack(_t,Mt,Ft)}}return Se(0,0,ks,ks,ks,0),Se(ks,ks,0,0,0,ks),{vertices:se,indices:le}}(this.tileID.canonical,l);w=A.vertices,M=A.indices}else{w=new t.aT,M=new t.aU;for(const{x:V,y:H}of y)w.emplaceBack(V,H,0,0);const A=t.b8(w.int16,void 0,4);for(let V=0;V<A.length;V+=3)M.emplaceBack(A[V],A[V+1],A[V+2])}this._tileBoundsBuffer=i.createVertexBuffer(w,t.b9.members),this._tileBoundsIndexBuffer=i.createIndexBuffer(M),this._tileBoundsSegments=t.b7.simpleSegment(0,0,w.length,M.length)}_makeGlobeTileDebugBuffers(i,l){const y=l.projection;if(!y||y.name!=="globe"||l.freezeTileCoverage)return;const w=this.tileID.canonical,M=t.ba(w,l),A=t.bb(M),V=t.ae(l.zoom);let H;V>0&&(H=t.ab.mat4.invert(new Float64Array(16),l.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(i,w,l,A,H,V),this._makeGlobeTileDebugTextBuffer(i,w,l,A,H,V)}_globePoint(i,l,y,w,M,A,V){let H=t.bc(i,l,y);if(A){const K=1<<y.z,ee=t.at(w.center.lng),se=t.aA(w.center.lat),le=(y.x+.5)/K-ee;let me=0;le>.5?me=-1:le<-.5&&(me=1);let Ee=(i/t.ag+y.x)/K+me,Se=(l/t.ag+y.y)/K;Ee=(Ee-ee)*w._pixelsPerMercatorPixel+ee,Se=(Se-se)*w._pixelsPerMercatorPixel+se;const ke=[Ee*w.worldSize,Se*w.worldSize,0];t.ab.vec3.transformMat4(ke,ke,A),H=t.bd(H,ke,V)}return t.ab.vec3.transformMat4(H,H,M)}_makeGlobeTileDebugBorderBuffer(i,l,y,w,M,A){const V=new t.b4,H=new t.b5,K=new t.be,ee=(le,me,Ee,Se,ke)=>{const De=(Ee-le)/(ke-1),Xe=(Se-me)/(ke-1),ut=V.length;for(let st=0;st<ke;st++){const wt=le+st*De,gt=me+st*Xe;V.emplaceBack(wt,gt);const vt=this._globePoint(wt,gt,l,y,w,M,A);K.emplaceBack(vt[0],vt[1],vt[2]),H.emplaceBack(ut+st)}},se=t.ag;ee(0,0,se,0,16),ee(se,0,se,se,16),ee(se,se,0,se,16),ee(0,se,0,0,16),this._tileDebugIndexBuffer=i.createIndexBuffer(H),this._tileDebugBuffer=i.createVertexBuffer(V,t.b6.members),this._globeTileDebugBorderBuffer=i.createVertexBuffer(K,t.bf.members),this._tileDebugSegments=t.b7.simpleSegment(0,0,V.length,H.length)}_makeGlobeTileDebugTextBuffer(i,l,y,w,M,A){const V=t.ag/4,H=new t.b4,K=new t.aU,ee=new t.be,se=25;K.reserve(32),H.reserve(se),ee.reserve(se);const le=(me,Ee)=>se*me+Ee;for(let me=0;me<se;me++){const Ee=me*V;for(let Se=0;Se<se;Se++){const ke=Se*V;H.emplaceBack(ke,Ee);const De=this._globePoint(ke,Ee,l,y,w,M,A);ee.emplaceBack(De[0],De[1],De[2])}}for(let me=0;me<4;me++)for(let Ee=0;Ee<4;Ee++){const Se=le(me,Ee),ke=le(me,Ee+1),De=le(me+1,Ee),Xe=le(me+1,Ee+1);K.emplaceBack(Se,ke,De),K.emplaceBack(De,ke,Xe)}this._tileDebugTextIndexBuffer=i.createIndexBuffer(K),this._tileDebugTextBuffer=i.createVertexBuffer(H,t.b6.members),this._globeTileDebugTextBuffer=i.createVertexBuffer(ee,t.bf.members),this._tileDebugTextSegments=t.b7.simpleSegment(0,0,se,32)}destroy(i=!1){for(const l in this.buckets)this.buckets[l].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!i&&this.texture&&this.texture instanceof t.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}t.bg.setPbf(t.bh);class es extends ss{constructor(i,l,y,w,M){super(i,l,y,w,M),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}setTexture(i,l){const y=l.context,w=y.gl;this.texture=this.texture||l.getTileTexture(i.width),this.texture&&this.texture instanceof t.T?this.texture.update(i,{premultiply:!1}):this.texture=new t.T(y,i,w.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(i=16384,l){const y=this._mrt=new t.bg(30),w=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(i-1)}});return this.entireBuffer=null,this.request=t.bi(w,(M,A,V,H)=>{if(M)l(M);else try{const K=y.getHeaderLength(A);if(K>i)return void(this.request=this.fetchHeader(K,l));y.parseHeader(A),this._isHeaderLoaded=!0;let ee=0;for(const se of Object.values(y.layers))ee=Math.max(ee,se.dataIndex[se.dataIndex.length-1].last_byte);A.byteLength>=ee&&(this.entireBuffer=A),l(null,this.entireBuffer||A,V,H)}catch(K){l(K)}}),this.request}fetchBand(i,l,y){const w=this._mrt;if(!this._isHeaderLoaded||!w)return void y(new Error("Tile header is not ready"));const M=this.actor;if(!M)return void y(new Error("Can't fetch tile band without an actor"));let A;const V=(se,le)=>{A.complete(se,le),se?y(se):(this.updateTextureDescriptor(i,l),y(null,this.textureDescriptor&&this.textureDescriptor.img))},H=(se,le)=>{if(se)return y(se);const me=M.send("decodeRasterArray",{buffer:le,task:A},V,void 0,!0);this._workQueue.push(()=>{me&&me.cancel(),A.cancel()})},K=w.getLayer(i);if(!K)return void y(new Error(`Unknown sourceLayer "${i}"`));if(K.hasDataForBand(l))return this.updateTextureDescriptor(i,l),void y(null,this.textureDescriptor?this.textureDescriptor.img:null);const ee=K.getDataRange([l]);if(A=w.createDecodingTask(ee),!A||A.tasks.length)if(this.flushQueues(),this.entireBuffer)H(null,this.entireBuffer.slice(ee.firstByte,ee.lastByte+1));else{const se=Object.assign({},this.requestParams,{headers:{Range:`bytes=${ee.firstByte}-${ee.lastByte}`}}),le=t.bi(se,H);this._fetchQueue.push(()=>{le.cancel(),A.cancel()})}else y(null)}updateNeeded(i,l){return(!this.textureDescriptor||this.textureDescriptor.band!==l||this.textureDescriptor.layer!==i)&&this.state!=="errored"}updateTextureDescriptor(i,l){if(!this._mrt)return;const y=this._mrt.getLayer(i);if(!y||!y.hasBand(l)||!y.hasDataForBand(l))return;const{bytes:w,tileSize:M,buffer:A,offset:V,scale:H}=y.getBandView(l),K=M+2*A,ee={data:w,width:K,height:K},se=this.texture;se&&se instanceof t.T&&se.update(ee,{premultiply:!1}),this.textureDescriptor={layer:i,band:l,img:ee,buffer:A,offset:V,tileSize:M,format:y.pixelFormat,mix:[H,256*H,65536*H,16777216*H]}}}class Hd{constructor(i,l){this.max=i,this.onRemove=l,this.reset()}reset(){for(const i in this.data)for(const l of this.data[i])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(i,l,y){const w=i.wrapped().key;this.data[w]===void 0&&(this.data[w]=[]);const M={value:l,timeout:void 0};if(y!==void 0&&(M.timeout=setTimeout(()=>{this.remove(i,M)},y)),this.data[w].push(M),this.order.push(w),this.order.length>this.max){const A=this._getAndRemoveByKey(this.order[0]);A&&this.onRemove(A)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const l=this.data[i].shift();return l.timeout&&clearTimeout(l.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),l.value}getByKey(i){const l=this.data[i];return l?l[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,l){if(!this.has(i))return this;const y=i.wrapped().key,w=l===void 0?0:this.data[y].indexOf(l),M=this.data[y][w];return this.data[y].splice(w,1),M.timeout&&clearTimeout(M.timeout),this.data[y].length===0&&delete this.data[y],this.onRemove(M.value),this.order.splice(this.order.indexOf(y),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(i){const l=[];for(const y in this.data)for(const w of this.data[y])i(w.value)||l.push(w);for(const y of l)this.remove(y.value.tileID,y)}}class Vs{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,l,y){const w=String(l);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][w]=this.stateChanges[i][w]||{},t.l(this.stateChanges[i][w],y),this.deletedStates[i]===null){this.deletedStates[i]={};for(const M in this.state[i])M!==w&&(this.deletedStates[i][M]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][w]===null){this.deletedStates[i][w]={};for(const M in this.state[i][w])y[M]||(this.deletedStates[i][w][M]=null)}else for(const M in y)this.deletedStates[i]&&this.deletedStates[i][w]&&this.deletedStates[i][w][M]===null&&delete this.deletedStates[i][w][M]}removeFeatureState(i,l,y){if(this.deletedStates[i]===null)return;const w=String(l);if(this.deletedStates[i]=this.deletedStates[i]||{},y&&l!==void 0)this.deletedStates[i][w]!==null&&(this.deletedStates[i][w]=this.deletedStates[i][w]||{},this.deletedStates[i][w][y]=null);else if(l!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][w])for(y in this.deletedStates[i][w]={},this.stateChanges[i][w])this.deletedStates[i][w][y]=null;else this.deletedStates[i][w]=null;else this.deletedStates[i]=null}getState(i,l){const y=this.state[i]||{},w=this.stateChanges[i]||{},M=this.deletedStates[i];if(M===null)return{};if(l!==void 0){const V=String(l),H=t.l({},y[V],w[V]);if(M){const K=M[l];if(K===null)return{};for(const ee in K)delete H[ee]}return H}const A=t.l({},y,w);if(M)for(const V in M)delete A[V];return A}initializeTileState(i,l){i.refreshFeatureState(l)}coalesceChanges(i,l){const y={};for(const w in this.stateChanges){this.state[w]=this.state[w]||{};const M={};for(const A in this.stateChanges[w])this.state[w][A]||(this.state[w][A]={}),t.l(this.state[w][A],this.stateChanges[w][A]),M[A]=this.state[w][A];y[w]=M}for(const w in this.deletedStates){this.state[w]=this.state[w]||{};const M={};if(this.deletedStates[w]===null)for(const A in this.state[w])M[A]={},this.state[w][A]={};else for(const A in this.deletedStates[w]){if(this.deletedStates[w][A]===null)this.state[w][A]={};else if(this.state[w][A])for(const V of Object.keys(this.deletedStates[w][A]))delete this.state[w][A][V];M[A]=this.state[w][A]}y[w]=y[w]||{},t.l(y[w],M)}if(this.stateChanges={},this.deletedStates={},Object.keys(y).length!==0)for(const w in i)i[w].refreshFeatureState(l)}}class ts extends t.E{constructor(i,l,y){super(),this.id=i,this._onlySymbols=y,l.on("data",w=>{w.dataType==="source"&&w.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&w.dataType==="source"&&w.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),l.on("error",()=>{this._sourceErrored=!0}),this._source=l,this._tiles={},this._cache=new Hd(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Vs,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(i){this.map=i,this._minTileCacheSize=this._minTileCacheSize===void 0&&i?i._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&i?i._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const i in this._tiles){const l=this._tiles[i];if(l.state!=="loaded"&&l.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(i,l){return i.isSymbolTile=this._onlySymbols,i.isExtraShadowCaster=this._shadowCasterTiles[i.tileID.key],this._source.loadTile(i,l)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i)}_abortTile(i){if(this._source.abortTile)return this._source.abortTile(i)}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const y=this._tiles[l];y.upload(i),y.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return t.bj(this._tiles).map(i=>i.tileID).sort(no).map(i=>i.key)}getRenderableIds(i,l){const y=[];for(const w in this._tiles)this._isIdRenderable(+w,i,l)&&y.push(this._tiles[w]);return i?y.sort((w,M)=>{const A=w.tileID,V=M.tileID,H=new t.P(A.canonical.x,A.canonical.y)._rotate(this.transform.angle),K=new t.P(V.canonical.x,V.canonical.y)._rotate(this.transform.angle);return A.overscaledZ-V.overscaledZ||K.y-H.y||K.x-H.x}).map(w=>w.tileID.key):y.map(w=>w.tileID).sort(no).map(w=>w.key)}hasRenderableParent(i){const l=this.findLoadedParent(i,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(i,l,y){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(l||!this._tiles[i].holdingForFade())&&(y||!this._shadowCasterTiles[i])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)this._tiles[i].state!=="errored"&&this._reloadTile(+i,"reloading")}}_reloadTile(i,l){const y=this._tiles[i];y&&(y.state!=="loading"&&(y.state=l),this._loadTile(y,this._tileLoaded.bind(this,y,i,l)))}_tileLoaded(i,l,y,w){if(w)if(i.state="errored",w.status!==404)this._source.fire(new t.y(w,{tile:i}));else{if(this._source.fire(new t.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:i})),!(i.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const M=this.map.painter.terrain;this.update(this.transform,M.getScaledDemTileSize(),!0),M.resetTileLookupCache(this.id)}else this.update(this.transform)}else i.timeAdded=t.q.now(),y==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(l,i),this._source.type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new t.z("data",{dataType:"source",tile:i,coord:i.tileID,sourceCacheId:this.id}))}_backfillDEM(i){const l=this.getRenderableIds();for(let w=0;w<l.length;w++){const M=l[w];if(i.neighboringTiles&&i.neighboringTiles[M]){const A=this.getTileByID(M);y(i,A),y(A,i)}}function y(w,M){if(!w.dem||w.dem.borderReady)return;w.needsHillshadePrepare=!0,w.needsDEMTextureUpload=!0;let A=M.tileID.canonical.x-w.tileID.canonical.x;const V=M.tileID.canonical.y-w.tileID.canonical.y,H=Math.pow(2,w.tileID.canonical.z),K=M.tileID.key;A===0&&V===0||Math.abs(V)>1||(Math.abs(A)>1&&(Math.abs(A+H)===1?A+=H:Math.abs(A-H)===1&&(A-=H)),M.dem&&w.dem&&(w.dem.backfillBorder(M.dem,A,V),w.neighboringTiles&&w.neighboringTiles[K]&&(w.neighboringTiles[K].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,l,y,w){for(const M in this._tiles){let A=this._tiles[M];if(w[M]||!A.hasData()||A.tileID.overscaledZ<=l||A.tileID.overscaledZ>y)continue;let V=A.tileID;for(;A&&A.tileID.overscaledZ>l+1;){const K=A.tileID.scaledTo(A.tileID.overscaledZ-1);A=this._tiles[K.key],A&&A.hasData()&&(V=K)}let H=V;for(;H.overscaledZ>l;)if(H=H.scaledTo(H.overscaledZ-1),i[H.key]){w[V.key]=V;break}}}findLoadedParent(i,l){if(i.key in this._loadedParentTiles){const y=this._loadedParentTiles[i.key];return y&&y.tileID.overscaledZ>=l?y:null}for(let y=i.overscaledZ-1;y>=l;y--){const w=i.scaledTo(y),M=this._getLoadedTile(w);if(M)return M}}_getLoadedTile(i){const l=this._tiles[i.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?i.wrapped().key:i.canonical.key)}updateCacheSize(i,l){l=l||this._source.tileSize;const y=Math.ceil(i.width/l)+1,w=Math.ceil(i.height/l)+1,M=Math.floor(y*w*5),A=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,M):M,V=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,A):A;this._cache.setMaxSize(V)}handleWrapJump(i){const l=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,l){const y={};for(const w in this._tiles){const M=this._tiles[w];M.tileID=M.tileID.unwrapTo(M.tileID.wrap+l),y[M.tileID.key]=M}this._tiles=y;for(const w in this._timers)clearTimeout(this._timers[w]),delete this._timers[w];for(const w in this._tiles)this._setTileReloadTimer(+w,this._tiles[w])}}update(i,l,y,w){if(this.transform=i,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!y)return;this.updateCacheSize(i,l),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const M=this._source.type==="batched-model";let A,V=this._source.maxzoom;const H=this.map&&this.map.painter?this.map.painter._terrain:null;if(H&&H.sourceCache===this&&H.attenuationRange()){const se=H.attenuationRange()[0],le=Math.floor(se)-Math.log2(H.getDemUpscale());V>le&&(V=le)}if(this.used||this.usedForTerrain){if(this._source.tileID)A=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(se=>new t.aG(se.canonical.z,se.wrap,se.canonical.z,se.canonical.x,se.canonical.y));else if(this.tileCoverLift!==0){const se=i.clone();se.tileCoverLift=this.tileCoverLift,A=se.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:V,roundZoom:this._source.roundZoom&&!y,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:M}),this._source.minzoom<=1&&i.projection.name==="globe"&&(A.push(new t.aG(1,0,1,0,0)),A.push(new t.aG(1,0,1,1,0)),A.push(new t.aG(1,0,1,0,1)),A.push(new t.aG(1,0,1,1,1)))}else if(A=i.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:V,roundZoom:this._source.roundZoom&&!y,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:M}),this._source.hasTile){const se=this._source.hasTile.bind(this._source);A=A.filter(le=>se(le))}}else A=[];if(A.length>0&&this.castsShadows&&w&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Jh(this._source.type)){const se=i.coveringZoomLevel({tileSize:l||this._source.tileSize,roundZoom:this._source.roundZoom&&!y}),le=Math.min(se,this._source.maxzoom);if(M){const me=i.extendTileCover(A,le);for(const Ee of me)A.push(Ee)}else{const me=i.extendTileCover(A,le,w);for(const Ee of me)this._shadowCasterTiles[Ee.key]=!0,A.push(Ee)}}const K=this._updateRetainedTiles(A);if(Jh(this._source.type)&&A.length!==0){const se={},le={},me=Object.keys(K);for(const Se of me){const ke=K[Se],De=this._tiles[Se];if(!De||De.fadeEndTime&&De.fadeEndTime<=t.q.now())continue;const Xe=this.findLoadedParent(ke,Math.max(ke.overscaledZ-ts.maxOverzooming,this._source.minzoom));Xe&&(this._addTile(Xe.tileID),se[Xe.tileID.key]=Xe.tileID),le[Se]=ke}const Ee=A[A.length-1].overscaledZ;for(const Se in this._tiles){const ke=this._tiles[Se];if(K[Se]||!ke.hasData())continue;let De=ke.tileID;for(;De.overscaledZ>Ee;){De=De.scaledTo(De.overscaledZ-1);const Xe=this._tiles[De.key];if(Xe&&Xe.hasData()&&le[De.key]){K[Se]=ke.tileID;break}}}for(const Se in se)K[Se]||(this._coveredTiles[Se]=!0,K[Se]=se[Se])}for(const se in K)this._tiles[se].clearFadeHold();const ee=t.bk(this._tiles,K);for(const se of ee){const le=this._tiles[se];le.hasSymbolBuckets&&!le.holdingForFade()?le.setHoldDuration(this.map._fadeDuration):le.hasSymbolBuckets&&!le.symbolFadeFinished()||this._removeTile(+se)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(+i)}_updateRetainedTiles(i){const l={};if(i.length===0)return l;const y={},w=i.reduce((K,ee)=>Math.min(K,ee.overscaledZ),1/0),M=i[0].overscaledZ,A=Math.max(M-ts.maxOverzooming,this._source.minzoom),V=Math.max(M+ts.maxUnderzooming,this._source.minzoom),H={};for(const K of i){const ee=this._addTile(K);l[K.key]=K,ee.hasData()||w<this._source.maxzoom&&(H[K.key]=K)}this._retainLoadedChildren(H,w,V,l);for(const K of i){let ee=this._tiles[K.key];if(ee.hasData())continue;if(K.canonical.z>=this._source.maxzoom){const le=K.children(this._source.maxzoom)[0],me=this.getTile(le);if(me&&me.hasData()){l[le.key]=le;continue}}else{const le=K.children(this._source.maxzoom);if(l[le[0].key]&&l[le[1].key]&&l[le[2].key]&&l[le[3].key])continue}let se=ee.wasRequested();for(let le=K.overscaledZ-1;le>=A;--le){const me=K.scaledTo(le);if(y[me.key]||(y[me.key]=!0,ee=this.getTile(me),!ee&&se&&(ee=this._addTile(me)),ee&&(l[me.key]=me,se=ee.wasRequested(),ee.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const l=[];let y,w=this._tiles[i].tileID;for(;w.overscaledZ>0;){if(w.key in this._loadedParentTiles){y=this._loadedParentTiles[w.key];break}l.push(w.key);const M=w.scaledTo(w.overscaledZ-1);if(y=this._getLoadedTile(M),y)break;w=M}for(const M of l)this._loadedParentTiles[M]=y}}_addTile(i){let l=this._tiles[i.key];if(l)return l.isExtraShadowCaster!==!0||this._shadowCasterTiles[i.key]||this._reloadTile(i.key,"reloading"),l;l=this._cache.getAndRemove(i),l&&(this._setTileReloadTimer(i.key,l),l.tileID=i,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,l)));const y=!!l;if(!y){const w=this.map?this.map.painter:null,M=this._source.tileSize*i.overscaleFactor();l=this._source.type==="raster-array"?new es(i,M,this.transform.tileZoom,w,this._isRaster):new ss(i,M,this.transform.tileZoom,w,this._isRaster),this._loadTile(l,this._tileLoaded.bind(this,l,i.key,l.state))}return l?(l.uses++,this._tiles[i.key]=l,y||this._source.fire(new t.z("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l):null}_setTileReloadTimer(i,l){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const y=l.getExpiryTimeout();y&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},y))}_removeTile(i){const l=this._tiles[i];l&&(l.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),l.uses>0||(l.hasData()&&l.state!=="reloading"||l.state==="empty"?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(+i);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(i,l,y){const w=[],M=this.transform;if(!M)return w;const A=M.projection.name==="globe",V=t.at(M.center.lng);for(const H in this._tiles){const K=this._tiles[H];if(y&&K.clearQueryDebugViz(),K.holdingForFade())continue;let ee;if(A){const se=K.tileID.canonical;if(se.z===0){const le=[Math.abs(t.aw(V,...Or(se,-1))-V),Math.abs(t.aw(V,...Or(se,1))-V)];ee=[0,2*le.indexOf(Math.min(...le))-1]}else{const le=[Math.abs(t.aw(V,...Or(se,-1))-V),Math.abs(t.aw(V,...Or(se,0))-V),Math.abs(t.aw(V,...Or(se,1))-V)];ee=[le.indexOf(Math.min(...le))-1]}}else ee=[0];for(const se of ee){const le=i.containsTile(K,M,l,se);le&&w.push(le)}}return w}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(i){return this._getRenderableCoordinates(i)}_getRenderableCoordinates(i,l){const y=this.getRenderableIds(i,l).map(M=>this._tiles[M].tileID),w=this.transform.projection.name==="globe";for(const M of y)M.projMatrix=this.transform.calculateProjMatrix(M.toUnwrapped()),M.expandedProjMatrix=w?this.transform.calculateProjMatrix(M.toUnwrapped(),!1,!0):M.projMatrix;return y}sortCoordinatesByDistance(i){const l=i.slice(),y=this.transform._camera.position,w=this.transform._camera.forward(),M={};for(const A of l){const V=1/(1<<A.canonical.z);M[A.key]=((A.canonical.x+.5)*V+A.wrap-y[0])*w[0]+((A.canonical.y+.5)*V-y[1])*w[1]-y[2]*w[2]}return l.sort((A,V)=>M[A.key]-M[V.key]),l}hasTransition(){if(this._source.hasTransition())return!0;if(Jh(this._source.type))for(const i in this._tiles){const l=this._tiles[i];if(l.fadeEndTime!==void 0&&l.fadeEndTime>=t.q.now())return!0}return!1}setFeatureState(i,l,y){this._state.updateState(i=i||"_geojsonTileLayer",l,y)}removeFeatureState(i,l,y){this._state.removeFeatureState(i=i||"_geojsonTileLayer",l,y)}getFeatureState(i,l){return this._state.getState(i=i||"_geojsonTileLayer",l)}setDependencies(i,l,y){const w=this._tiles[i];w&&w.setDependencies(l,y)}reloadTilesForDependencies(i,l){for(const y in this._tiles)this._tiles[y].hasDependency(i,l)&&this._reloadTile(+y,"reloading");this._cache.filter(y=>!y.hasDependency(i,l))}_preloadTiles(i,l){if(!this._sourceLoaded){const H=()=>{this._sourceLoaded&&(this._source.off("data",H),this._preloadTiles(i,l))};return void this._source.on("data",H)}const y=new Map,w=Array.isArray(i)?i:[i],M=this.map.painter.terrain,A=this.usedForTerrain&&M?M.getScaledDemTileSize():this._source.tileSize;for(const H of w){const K=H.coveringTiles({tileSize:A,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const ee of K)y.set(ee.key,ee);this.usedForTerrain&&H.updateElevation(!1)}const V=Array.from(y.values());t.bl(V,(H,K)=>{const ee=new ss(H,this._source.tileSize*H.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(ee,se=>{this._source.type==="raster-dem"&&ee.dem&&this._backfillDEM(ee),K(se,ee)})},l)}}function no(_,i){const l=Math.abs(2*_.wrap)-+(_.wrap<0),y=Math.abs(2*i.wrap)-+(i.wrap<0);return _.overscaledZ-i.overscaledZ||y-l||i.canonical.y-_.canonical.y||i.canonical.x-_.canonical.x}function Jh(_){return _==="raster"||_==="image"||_==="video"||_==="custom"}function Or(_,i){const l=1<<_.z;return[_.x/l+i,(_.x+1)/l+i]}ts.maxOverzooming=10,ts.maxUnderzooming=3;class os{constructor(i){this.style=i,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const i=!1,l=!1;for(const y in this.style._mergedLayers){const w=this.style._mergedLayers[y];if(w.type==="fill-extrusion")this.layers.push({layer:w,visible:i,visibilityChanged:l});else if(w.type==="model"){const M=this.style.getLayerSource(w);M&&M.type==="batched-model"&&this.layers.push({layer:w,visible:i,visibilityChanged:l})}}}onNewFrame(i){this.layersGotHidden=!1;for(const l of this.layers){const y=l.layer;let w=!1;y.type==="fill-extrusion"?w=!y.isHidden(i)&&y.paint.get("fill-extrusion-opacity")>0:y.type==="model"&&(w=!y.isHidden(i)&&y.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!w&&l.visible,l.visible=w}}updateZOffset(i,l){this.currentBuildingBuckets=[];for(const w of this.layers){const M=w.layer,A=this.style.getLayerSourceCache(M);let V=1;M.type==="fill-extrusion"&&(V=w.visible?M.paint.get("fill-extrusion-vertical-scale"):0);let H=A?A.getTile(l):null;if(!H&&A&&l.canonical.z>A.getSource().minzoom){let K=l.scaledTo(Math.min(A.getSource().maxzoom,l.overscaledZ-1));for(;K.overscaledZ>=A.getSource().minzoom&&(H=A.getTile(K),!H&&K.overscaledZ!==0);)K=K.scaledTo(K.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:H?H.getBucket(M):null,tileID:H?H.tileID:l,verticalScale:V})}i.hasAnyZOffset=!1;let y=!1;for(let w=0;w<i.symbolInstances.length;w++){const M=i.symbolInstances.get(w),A=M.zOffset,V=this._getHeightAtTileOffset(l,M.tileAnchorX,M.tileAnchorY);M.zOffset=V!==Number.NEGATIVE_INFINITY?V:A,y||A===M.zOffset||(y=!0),i.hasAnyZOffset||M.zOffset===0||(i.hasAnyZOffset=!0)}y&&(i.zOffsetBuffersNeedUpload=!0,i.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(i,l,y,w){let M=l,A=y;if(i.canonical.z!==w.canonical.z){const V=w.canonical,H=1/(1<<i.canonical.z-V.z);M=(l+i.canonical.x*t.ag)*H-V.x*t.ag|0,A=(y+i.canonical.y*t.ag)*H-V.y*t.ag|0}return{tileX:M,tileY:A}}_getHeightAtTileOffset(i,l,y){let w,M;for(let A=0;A<this.layers.length;++A){if(this.layers[A].layer.type!=="fill-extrusion")continue;const{bucket:V,tileID:H,verticalScale:K}=this.currentBuildingBuckets[A];if(!V)continue;const{tileX:ee,tileY:se}=this._mapCoordToOverlappingTile(i,l,y,H),le=V.getHeightAtTileCoord(ee,se);le&&le.height!==void 0&&(le.hidden?w=le.height:M=Math.max(le.height*K,M||0))}if(M!==void 0)return M;for(let A=0;A<this.layers.length;++A){const V=this.layers[A];if(V.layer.type!=="model"||!V.visible)continue;const{bucket:H,tileID:K}=this.currentBuildingBuckets[A];if(!H)continue;const{tileX:ee,tileY:se}=this._mapCoordToOverlappingTile(i,l,y,K),le=H.getHeightAtTileCoord(ee,se);if(le&&!le.hidden)return le.height===void 0&&w!==void 0?Math.min(le.maxHeight,w)*le.verticalScale:le.height?le.height*le.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function ir(_,i){const l={};for(const y in _)y!=="ref"&&(l[y]=_[y]);return t.bm.forEach(y=>{y in i&&(l[y]=i[y])}),l}function Xl(_){_=_.slice();const i=Object.create(null);for(let l=0;l<_.length;l++)i[_[l].id]=_[l];for(let l=0;l<_.length;l++)"ref"in _[l]&&(_[l]=ir(_[l],i[_[l].ref]));return _}const Dr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport"};function Qo(_,i,l){l.push({command:Dr.addSource,args:[_,i[_]]})}function fl(_,i,l){i.push({command:Dr.removeSource,args:[_]}),l[_]=!0}function fc(_,i,l,y){fl(_,l,y),Qo(_,i,l)}function su(_,i,l){let y;for(y in _[l])if(_[l].hasOwnProperty(y)&&y!=="data"&&!t.bn(_[l][y],i[l][y]))return!1;for(y in i[l])if(i[l].hasOwnProperty(y)&&y!=="data"&&!t.bn(_[l][y],i[l][y]))return!1;return!0}function hi(_,i,l,y,w,M){let A;for(A in i=i||{},_=_||{})_.hasOwnProperty(A)&&(t.bn(_[A],i[A])||l.push({command:M,args:[y,A,i[A],w]}));for(A in i)i.hasOwnProperty(A)&&!_.hasOwnProperty(A)&&(t.bn(_[A],i[A])||l.push({command:M,args:[y,A,i[A],w]}))}function jr(_){return _.id}function Wi(_,i){return _[i.id]=i,_}class Sr{constructor(i,l){this.reset(i,l)}reset(i,l){this.points=i||[],this._distances=[0];for(let y=1;y<this.points.length;y++)this._distances[y]=this._distances[y-1]+this.points[y].dist(this.points[y-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=t.aw(i,0,1);let l=1,y=this._distances[l];const w=i*this.paddedLength+this.padding;for(;y<w&&l<this._distances.length;)y=this._distances[++l];const M=l-1,A=this._distances[M],V=y-A,H=V>0?(w-A)/V:0;return this.points[M].mult(1-H).add(this.points[l].mult(H))}}class pc{constructor(i,l,y){const w=this.boxCells=[],M=this.circleCells=[];this.xCellCount=Math.ceil(i/y),this.yCellCount=Math.ceil(l/y);for(let A=0;A<this.xCellCount*this.yCellCount;A++)w.push([]),M.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=l,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,l,y,w,M){this._forEachCell(l,y,w,M,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(l),this.bboxes.push(y),this.bboxes.push(w),this.bboxes.push(M)}insertCircle(i,l,y,w){this._forEachCell(l-w,y-w,l+w,y+w,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(l),this.circles.push(y),this.circles.push(w)}_insertBoxCell(i,l,y,w,M,A){this.boxCells[M].push(A)}_insertCircleCell(i,l,y,w,M,A){this.circleCells[M].push(A)}_query(i,l,y,w,M,A){if(y<0||i>this.width||w<0||l>this.height)return!M&&[];const V=[];if(i<=0&&l<=0&&this.width<=y&&this.height<=w){if(M)return!0;for(let H=0;H<this.boxKeys.length;H++)V.push({key:this.boxKeys[H],x1:this.bboxes[4*H],y1:this.bboxes[4*H+1],x2:this.bboxes[4*H+2],y2:this.bboxes[4*H+3]});for(let H=0;H<this.circleKeys.length;H++){const K=this.circles[3*H],ee=this.circles[3*H+1],se=this.circles[3*H+2];V.push({key:this.circleKeys[H],x1:K-se,y1:ee-se,x2:K+se,y2:ee+se})}return A?V.filter(A):V}return this._forEachCell(i,l,y,w,this._queryCell,V,{hitTest:M,seenUids:{box:{},circle:{}}},A),M?V.length>0:V}_queryCircle(i,l,y,w,M){const A=i-y,V=i+y,H=l-y,K=l+y;if(V<0||A>this.width||K<0||H>this.height)return!w&&[];const ee=[];return this._forEachCell(A,H,V,K,this._queryCellCircle,ee,{hitTest:w,circle:{x:i,y:l,radius:y},seenUids:{box:{},circle:{}}},M),w?ee.length>0:ee}query(i,l,y,w,M){return this._query(i,l,y,w,!1,M)}hitTest(i,l,y,w,M){return this._query(i,l,y,w,!0,M)}hitTestCircle(i,l,y,w){return this._queryCircle(i,l,y,!0,w)}_queryCell(i,l,y,w,M,A,V,H){const K=V.seenUids,ee=this.boxCells[M];if(ee!==null){const le=this.bboxes;for(const me of ee)if(!K.box[me]){K.box[me]=!0;const Ee=4*me;if(i<=le[Ee+2]&&l<=le[Ee+3]&&y>=le[Ee+0]&&w>=le[Ee+1]&&(!H||H(this.boxKeys[me]))){if(V.hitTest)return A.push(!0),!0;A.push({key:this.boxKeys[me],x1:le[Ee],y1:le[Ee+1],x2:le[Ee+2],y2:le[Ee+3]})}}}const se=this.circleCells[M];if(se!==null){const le=this.circles;for(const me of se)if(!K.circle[me]){K.circle[me]=!0;const Ee=3*me;if(this._circleAndRectCollide(le[Ee],le[Ee+1],le[Ee+2],i,l,y,w)&&(!H||H(this.circleKeys[me]))){if(V.hitTest)return A.push(!0),!0;{const Se=le[Ee],ke=le[Ee+1],De=le[Ee+2];A.push({key:this.circleKeys[me],x1:Se-De,y1:ke-De,x2:Se+De,y2:ke+De})}}}}}_queryCellCircle(i,l,y,w,M,A,V,H){const K=V.circle,ee=V.seenUids,se=this.boxCells[M];if(se!==null){const me=this.bboxes;for(const Ee of se)if(!ee.box[Ee]){ee.box[Ee]=!0;const Se=4*Ee;if(this._circleAndRectCollide(K.x,K.y,K.radius,me[Se+0],me[Se+1],me[Se+2],me[Se+3])&&(!H||H(this.boxKeys[Ee])))return A.push(!0),!0}}const le=this.circleCells[M];if(le!==null){const me=this.circles;for(const Ee of le)if(!ee.circle[Ee]){ee.circle[Ee]=!0;const Se=3*Ee;if(this._circlesCollide(me[Se],me[Se+1],me[Se+2],K.x,K.y,K.radius)&&(!H||H(this.circleKeys[Ee])))return A.push(!0),!0}}}_forEachCell(i,l,y,w,M,A,V,H){const K=this._convertToXCellCoord(i),ee=this._convertToYCellCoord(l),se=this._convertToXCellCoord(y),le=this._convertToYCellCoord(w);for(let me=K;me<=se;me++)for(let Ee=ee;Ee<=le;Ee++)if(M.call(this,i,l,y,w,this.xCellCount*Ee+me,A,V,H))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,l,y,w,M,A){const V=w-i,H=M-l,K=y+A;return K*K>V*V+H*H}_circleAndRectCollide(i,l,y,w,M,A,V){const H=(A-w)/2,K=Math.abs(i-(w+H));if(K>H+y)return!1;const ee=(V-M)/2,se=Math.abs(l-(M+ee));if(se>ee+y)return!1;if(K<=H||se<=ee)return!0;const le=K-H,me=se-ee;return le*le+me*me<=y*y}}const Hi={unknown:0,flipRequired:1,flipNotRequired:2},ou=Math.tan(85*Math.PI/180);function io(_,i,l,y,w,M,A){const V=t.ab.mat4.create();if(l)if(M.name==="globe"){const H=t.bo(w,i);t.ab.mat4.multiply(V,V,H)}else{const H=t.ab.mat2.invert([],A);V[0]=H[0],V[1]=H[1],V[4]=H[2],V[5]=H[3],y||t.ab.mat4.rotateZ(V,V,w.angle)}else t.ab.mat4.multiply(V,w.labelPlaneMatrix,_);return V}function mc(_,i,l,y,w,M,A){const V=io(_,i,l,y,w,M,A);return M.name==="globe"&&l||(V[2]=V[6]=V[10]=V[14]=0),V}function Ns(_,i,l,y,w,M,A){if(l){if(M.name==="globe"){const V=io(_,i,l,y,w,M,A);return t.ab.mat4.invert(V,V),t.ab.mat4.multiply(V,_,V),V}{const V=t.ab.mat4.clone(_),H=t.ab.mat4.identity([]);return H[0]=A[0],H[1]=A[1],H[4]=A[2],H[5]=A[3],t.ab.mat4.multiply(V,V,H),y||t.ab.mat4.rotateZ(V,V,-w.angle),V}}return w.glCoordMatrix}function ca(_,i,l,y){const w=[_,i,l,1];l?t.ab.vec4.transformMat4(w,w,y):fs(w,w,y);const M=w[3];return w[0]/=M,w[1]/=M,w[2]/=M,w}function Vu(_,i){return Math.min(.5+_/i*.5,1.5)}function Qh(_,i){const l=_[0]/_[3],y=_[1]/_[3];return l>=-i[0]&&l<=i[0]&&y>=-i[1]&&y<=i[1]}function ed(_,i,l,y,w,M,A,V,H,K){const ee=l.transform,se=y?_.textSizeData:_.iconSizeData,le=t.bp(se,l.transform.zoom),me=ee.projection.name==="globe",Ee=[256/l.width*2+1,256/l.height*2+1],Se=y?_.text.dynamicLayoutVertexArray:_.icon.dynamicLayoutVertexArray;Se.clear();let ke=null;me&&(ke=y?_.text.globeExtVertexArray:_.icon.globeExtVertexArray);const De=_.lineVertexArray,Xe=y?_.text.placedSymbolArray:_.icon.placedSymbolArray,ut=l.transform.width/l.transform.height;let st,wt=!1;for(let gt=0;gt<Xe.length;gt++){const vt=Xe.get(gt),{numGlyphs:_t,writingMode:Mt}=vt;if(Mt!==t.bq.vertical||wt||st===t.bq.horizontal||(wt=!0),st=Mt,(vt.hidden||Mt===t.bq.vertical)&&!wt){Ml(_t,Se);continue}wt=!1;const Ft=new t.P(vt.tileAnchorX,vt.tileAnchorY);let{x:cn,y:en,z:zt}=ee.projection.projectTilePoint(Ft.x,Ft.y,K.canonical);if(H){const[wn,Mi,si]=H(Ft);cn+=wn,en+=Mi,zt+=si}const Ht=[cn,en,zt,1];if(t.ab.vec4.transformMat4(Ht,Ht,i),!Qh(Ht,Ee)){Ml(_t,Se);continue}const En=Ht[3],Vn=Vu(l.transform.getCameraToCenterDistance(ee.projection),En),ti=t.br(se,le,vt),Qt=A?ti/Vn:ti*Vn,An=ca(cn,en,zt,w);if(An[3]<=0){Ml(_t,Se);continue}let dn={};const Jn=A?null:H,Fn=lu(vt,Qt,!1,V,i,w,M,_.glyphOffsetArray,De,Se,ke,An,Ft,dn,ut,Jn,ee.projection,K,A);wt=Fn.useVertical,Jn&&Fn.needsFlipping&&(dn={}),(Fn.notEnoughRoom||wt||Fn.needsFlipping&&lu(vt,Qt,!0,V,i,w,M,_.glyphOffsetArray,De,Se,ke,An,Ft,dn,ut,Jn,ee.projection,K,A).notEnoughRoom)&&Ml(_t,Se)}y?(_.text.dynamicLayoutVertexBuffer.updateData(Se),ke&&_.text.globeExtVertexBuffer&&_.text.globeExtVertexBuffer.updateData(ke)):(_.icon.dynamicLayoutVertexBuffer.updateData(Se),ke&&_.icon.globeExtVertexBuffer&&_.icon.globeExtVertexBuffer.updateData(ke))}function Nu(_,i,l,y,w,M,A,V,H,K,ee,se,le,me,Ee,Se){const{lineStartIndex:ke,glyphStartIndex:De,segment:Xe}=V,ut=De+V.numGlyphs,st=ke+V.lineLength,wt=i.getoffsetX(De),gt=i.getoffsetX(ut-1),vt=Oa(_*wt,l,y,w,M,A,Xe,ke,st,H,K,ee,se,le,!0,me,Ee,Se);if(!vt)return null;const _t=Oa(_*gt,l,y,w,M,A,Xe,ke,st,H,K,ee,se,le,!0,me,Ee,Se);return _t?{first:vt,last:_t}:null}function Zd(_,i,l,y){return _===t.bq.horizontal&&Math.abs(y)>Math.abs(l)?{useVertical:!0}:_===t.bq.vertical?y>0?{needsFlipping:!0}:null:i!==Hi.unknown&&function(w,M){return w===0||Math.abs(M/w)>ou}(l,y)?i===Hi.flipRequired?{needsFlipping:!0}:null:l<0?{needsFlipping:!0}:null}function lu(_,i,l,y,w,M,A,V,H,K,ee,se,le,me,Ee,Se,ke,De,Xe){const ut=i/24,st=_.lineOffsetX*ut,wt=_.lineOffsetY*ut,{lineStartIndex:gt,glyphStartIndex:vt,numGlyphs:_t,segment:Mt,writingMode:Ft,flipState:cn}=_,en=gt+_.lineLength,zt=Ht=>{if(ee){const[Qt,An,dn]=Ht.up,Jn=K.length;t.bs(ee,Jn+0,Qt,An,dn),t.bs(ee,Jn+1,Qt,An,dn),t.bs(ee,Jn+2,Qt,An,dn),t.bs(ee,Jn+3,Qt,An,dn)}const[En,Vn,ti]=Ht.point;t.bt(K,En,Vn,ti,Ht.angle)};if(_t>1){const Ht=Nu(ut,V,st,wt,l,se,le,_,H,M,me,Se,!1,ke,De,Xe);if(!Ht)return{notEnoughRoom:!0};if(y&&!l){let[En,Vn,ti]=Ht.first.point,[Qt,An,dn]=Ht.last.point;[En,Vn]=ca(En,Vn,ti,A),[Qt,An]=ca(Qt,An,dn,A);const Jn=Zd(Ft,cn,(Qt-En)*Ee,An-Vn);if(_.flipState=Jn&&Jn.needsFlipping?Hi.flipRequired:Hi.flipNotRequired,Jn)return Jn}zt(Ht.first);for(let En=vt+1;En<vt+_t-1;En++){const Vn=Oa(ut*V.getoffsetX(En),st,wt,l,se,le,Mt,gt,en,H,M,me,Se,!1,!1,ke,De,Xe);if(!Vn)return K.length-=4*(En-vt),{notEnoughRoom:!0};zt(Vn)}zt(Ht.last)}else{if(y&&!l){const En=ca(le.x,le.y,0,w),Vn=gt+Mt+1,ti=new t.P(H.getx(Vn),H.gety(Vn)),Qt=ca(ti.x,ti.y,0,w),An=Qt[3]>0?Qt:el(le,ti,En,1,w,void 0,ke,De.canonical),dn=Zd(Ft,cn,(An[0]-En[0])*Ee,An[1]-En[1]);if(_.flipState=dn&&dn.needsFlipping?Hi.flipRequired:Hi.flipNotRequired,dn)return dn}const Ht=Oa(ut*V.getoffsetX(vt),st,wt,l,se,le,Mt,gt,en,H,M,me,Se,!1,!1,ke,De,Xe);if(!Ht)return{notEnoughRoom:!0};zt(Ht)}return{}}function Yr(_,i,l,y,w){const{x:M,y:A,z:V}=y.projectTilePoint(_.x,_.y,i);if(!w)return ca(M,A,V,l);const[H,K,ee]=w(_);return ca(M+H,A+K,V+ee,l)}function el(_,i,l,y,w,M,A,V){const H=Yr(_.sub(i)._unit()._add(_),V,w,A,M);return t.ab.vec3.sub(H,l,H),t.ab.vec3.normalize(H,H),t.ab.vec3.scaleAndAdd(H,l,H,y)}function Oa(_,i,l,y,w,M,A,V,H,K,ee,se,le,me,Ee,Se,ke,De){const Xe=y?_-i:_+i;let ut=Xe>0?1:-1,st=0;y&&(ut*=-1,st=Math.PI),ut<0&&(st+=Math.PI);let wt=V+A+(ut>0?0:1)|0,gt=w,vt=w,_t=0,Mt=0;const Ft=Math.abs(Xe),cn=[],en=[];let zt=M,Ht=zt;const En=()=>el(Ht,zt,vt,Ft-_t+1,ee,le,Se,ke.canonical);for(;_t+Mt<=Ft;){if(wt+=ut,wt<V||wt>=H)return null;if(vt=gt,Ht=zt,cn.push(vt),me&&en.push(Ht),zt=new t.P(K.getx(wt),K.gety(wt)),gt=se[wt],!gt){const Mi=Yr(zt,ke.canonical,ee,Se,le);gt=Mi[3]>0?se[wt]=Mi:En()}_t+=Mt,Mt=t.ab.vec3.distance(vt,gt)}Ee&&le&&(se[wt]&&(gt=En(),Mt=t.ab.vec3.distance(vt,gt)),se[wt]=gt);const Vn=(Ft-_t)/Mt,ti=zt.sub(Ht)._mult(Vn)._add(Ht),Qt=t.ab.vec3.sub([],gt,vt),An=t.ab.vec3.scaleAndAdd([],vt,Qt,Vn);let dn=[0,0,1],Jn=Qt[0],Fn=Qt[1];if(De&&(dn=Se.upVector(ke.canonical,ti.x,ti.y),dn[0]!==0||dn[1]!==0||dn[2]!==1)){const Mi=[dn[2],0,-dn[0]],si=t.ab.vec3.cross([],dn,Mi);t.ab.vec3.normalize(Mi,Mi),t.ab.vec3.normalize(si,si),Jn=t.ab.vec3.dot(Qt,Mi),Fn=t.ab.vec3.dot(Qt,si)}if(l){const Mi=t.ab.vec3.cross([],dn,Qt);t.ab.vec3.normalize(Mi,Mi),t.ab.vec3.scaleAndAdd(An,An,Mi,l*ut)}const wn=st+Math.atan2(Fn,Jn);return cn.push(An),me&&en.push(ti),{point:An,angle:wn,path:cn,tilePath:en,up:dn}}function Ml(_,i){const l=i.length,y=l+4*_;i.resize(y),i.float32.fill(-1/0,4*l,4*y)}function fs(_,i,l){const y=i[0],w=i[1];return _[0]=l[0]*y+l[4]*w+l[12],_[1]=l[1]*y+l[5]*w+l[13],_[3]=l[3]*y+l[7]*w+l[15],_}const Ca=100;class _o{constructor(i,l,y=new pc(i.width+200,i.height+200,25),w=new pc(i.width+200,i.height+200,25)){this.transform=i,this.grid=y,this.ignoredGrid=w,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+Ca,this.screenBottomBoundary=i.height+Ca,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=l}placeCollisionBox(i,l,y,w,M,A,V,H){let K=y.projectedAnchorX,ee=y.projectedAnchorY,se=y.projectedAnchorZ;const le=y.elevation,me=y.tileID,Ee=i.getProjection();if(le&&me){const[gt,vt,_t]=Ee.upVector(me.canonical,y.tileAnchorX,y.tileAnchorY),Mt=Ee.upVectorScale(me.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;K+=gt*le*Mt,ee+=vt*le*Mt,se+=_t*le*Mt}const Se=this.projectAndGetPerspectiveRatio(V,K,ee,se,y.tileID,Ee.name==="globe"||!!le||this.transform.pitch>0,Ee),ke=A*Se.perspectiveRatio,De=(y.x1*l+w.x-y.padding)*ke+Se.point.x,Xe=(y.y1*l+w.y-y.padding)*ke+Se.point.y,ut=(y.x2*l+w.x+y.padding)*ke+Se.point.x,st=(y.y2*l+w.y+y.padding)*ke+Se.point.y,wt=Se.perspectiveRatio<=.55||Se.occluded;return!this.isInsideGrid(De,Xe,ut,st)||!M&&this.grid.hitTest(De,Xe,ut,st,H)||wt?{box:[],offscreen:!1,occluded:Se.occluded}:{box:[De,Xe,ut,st],offscreen:this.isOffscreen(De,Xe,ut,st),occluded:!1}}placeCollisionCircles(i,l,y,w,M,A,V,H,K,ee,se,le,me,Ee,Se){const ke=[],De=this.transform.elevation,Xe=i.getProjection(),ut=De?De.getAtTileOffsetFunc(Se,this.transform.center.lat,this.transform.worldSize,Xe):null,st=new t.P(y.tileAnchorX,y.tileAnchorY);let{x:wt,y:gt,z:vt}=Xe.projectTilePoint(st.x,st.y,Se.canonical);if(ut){const[ti,Qt,An]=ut(st);wt+=ti,gt+=Qt,vt+=An}const _t=Xe.name==="globe",Mt=this.projectAndGetPerspectiveRatio(V,wt,gt,vt,Se,_t||!!De||this.transform.pitch>0,Xe),{perspectiveRatio:Ft}=Mt,cn=(se?A/Ft:A*Ft)/t.bw,en=ca(wt,gt,vt,H),zt=Mt.signedDistanceFromCamera>0?Nu(cn,M,y.lineOffsetX*cn,y.lineOffsetY*cn,!1,en,st,y,w,H,{},De&&!se?ut:null,se&&!!De,Xe,Se,se):null;let Ht=!1,En=!1,Vn=!0;if(zt&&!Mt.occluded){const ti=.5*me*Ft+Ee,Qt=new t.P(-100,-100),An=new t.P(this.screenRightBoundary,this.screenBottomBoundary),dn=new Sr,{first:Jn,last:Fn}=zt,wn=Jn.path.length;let Mi=[];for(let Ai=wn-1;Ai>=1;Ai--)Mi.push(Jn.path[Ai]);for(let Ai=1;Ai<Fn.path.length;Ai++)Mi.push(Fn.path[Ai]);const si=2.5*ti;K&&(Mi=Mi.map(([Ai,ur,Xi],er)=>(ut&&!_t&&(Xi=ut(er<wn-1?Jn.tilePath[wn-1-er]:Fn.tilePath[er-wn+2])[2]),ca(Ai,ur,Xi,K))),Mi.some(Ai=>Ai[3]<=0)&&(Mi=[]));let Ii=[];if(Mi.length>0){let Ai=1/0,ur=-1/0,Xi=1/0,er=-1/0;for(const dr of Mi)Ai=Math.min(Ai,dr[0]),Xi=Math.min(Xi,dr[1]),ur=Math.max(ur,dr[0]),er=Math.max(er,dr[1]);ur>=Qt.x&&Ai<=An.x&&er>=Qt.y&&Xi<=An.y&&(Ii=[Mi.map(dr=>new t.P(dr[0],dr[1]))],(Ai<Qt.x||ur>An.x||Xi<Qt.y||er>An.y)&&(Ii=t.bu(Ii,Qt.x,Qt.y,An.x,An.y)))}for(const Ai of Ii){dn.reset(Ai,.25*ti);let ur=0;ur=dn.length<=.5*ti?1:Math.ceil(dn.paddedLength/si)+1;for(let Xi=0;Xi<ur;Xi++){const er=Xi/Math.max(ur-1,1),dr=dn.lerp(er),Ur=dr.x+Ca,Mr=dr.y+Ca;ke.push(Ur,Mr,ti,0);const Ea=Ur-ti,za=Mr-ti,ra=Ur+ti,ha=Mr+ti;if(Vn=Vn&&this.isOffscreen(Ea,za,ra,ha),En=En||this.isInsideGrid(Ea,za,ra,ha),!l&&this.grid.hitTestCircle(Ur,Mr,ti,le)&&(Ht=!0,!ee))return{circles:[],offscreen:!1,collisionDetected:Ht,occluded:!1}}}}return{circles:!ee&&Ht||!En?[]:ke,offscreen:Vn,collisionDetected:Ht,occluded:Mt.occluded}}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const l=[];let y=1/0,w=1/0,M=-1/0,A=-1/0;for(const ee of i){const se=new t.P(ee.x+Ca,ee.y+Ca);y=Math.min(y,se.x),w=Math.min(w,se.y),M=Math.max(M,se.x),A=Math.max(A,se.y),l.push(se)}const V=this.grid.query(y,w,M,A).concat(this.ignoredGrid.query(y,w,M,A)),H={},K={};for(const ee of V){const se=ee.key;if(H[se.bucketInstanceId]===void 0&&(H[se.bucketInstanceId]={}),H[se.bucketInstanceId][se.featureIndex])continue;const le=[new t.P(ee.x1,ee.y1),new t.P(ee.x2,ee.y1),new t.P(ee.x2,ee.y2),new t.P(ee.x1,ee.y2)];t.bv(l,le)&&(H[se.bucketInstanceId][se.featureIndex]=!0,K[se.bucketInstanceId]===void 0&&(K[se.bucketInstanceId]=[]),K[se.bucketInstanceId].push(se.featureIndex))}return K}insertCollisionBox(i,l,y,w,M){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:y,featureIndex:w,collisionGroupID:M},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,l,y,w,M){const A=l?this.ignoredGrid:this.grid,V={bucketInstanceId:y,featureIndex:w,collisionGroupID:M};for(let H=0;H<i.length;H+=4)A.insertCircle(V,i[H],i[H+1],i[H+2])}projectAndGetPerspectiveRatio(i,l,y,w,M,A,V){const H=[l,y,w,1];let K=!1;w||this.transform.pitch>0?(t.ab.vec4.transformMat4(H,H,i),this.fogState&&M&&V.name!=="globe"&&(K=function(le,me,Ee,Se,ke,De){const Xe=De.calculateFogTileMatrix(ke),ut=[me,Ee,Se];return t.ab.vec3.transformMat4(ut,ut,Xe),Ui(le,t.ab.vec3.length(ut),De.pitch,De._fov)}(this.fogState,l,y,w,M.toUnwrapped(),this.transform)>.9)):fs(H,H,i);const ee=H[3];return{point:new t.P((H[0]/ee+1)/2*this.transform.width+Ca,(-H[1]/ee+1)/2*this.transform.height+Ca),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(V)/ee*.5,1.5),signedDistanceFromCamera:ee,occluded:A&&H[2]>ee||K}}isOffscreen(i,l,y,w){return y<Ca||i>=this.screenRightBoundary||w<Ca||l>this.screenBottomBoundary}isInsideGrid(i,l,y,w){return y>=0&&i<this.gridRightBoundary&&w>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const i=t.ab.mat4.identity([]);return t.ab.mat4.translate(i,i,[-100,-100,0]),i}}function Il(_,i,l){const y=i.createTileMatrix(_,_.worldSize,l.toUnwrapped());return t.ab.mat4.multiply(new Float32Array(16),_.projMatrix,y)}function ws(_,i,l){if(i.projection.name===l.projection.name)return _.projMatrix;const y=l.clone();return y.setProjection(i.projection),Il(y,i.getProjection(),_)}function ju(_,i,l){return i.name===l.projection.name?_.projMatrix:Il(l,i,_)}class pl{constructor(i,l,y,w){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?l:-l))):w&&y?1:0,this.placed=y}isHidden(){return this.opacity===0&&!this.placed}}class cu{constructor(i,l,y,w,M,A=!1){this.text=new pl(i?i.text:null,l,y,M),this.icon=new pl(i?i.icon:null,l,w,M),this.clipped=A}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class uu{constructor(i,l,y,w=!1){this.text=i,this.icon=l,this.skipFade=y,this.clipped=w}}class Pl{constructor(){this.invProjMatrix=t.ab.mat4.create(),this.viewportMatrix=t.ab.mat4.create(),this.circles=[]}}class Al{constructor(i,l,y,w,M){this.bucketInstanceId=i,this.featureIndex=l,this.sourceLayerIndex=y,this.bucketIndex=w,this.tileID=M}}class kl{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const l=++this.maxGroupID;this.collisionGroups[i]={ID:l,predicate:y=>y.collisionGroupID===l}}return this.collisionGroups[i]}}function yh(_,i,l,y,w){const{horizontalAlign:M,verticalAlign:A}=t.bD(_),V=-(M-.5)*i,H=-(A-.5)*l,K=t.bC(_,y);return new t.P(V+K[0]*w,H+K[1]*w)}function td(_,i,l,y,w){const M=new t.P(_,i);return l&&M._rotate(y?w:-w),M}class ps{constructor(i,l,y,w,M,A){this.transform=i.clone(),this.projection=i.projection.name,this.collisionIndex=new _o(this.transform,M),this.buildingIndex=A,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new kl(y),this.collisionCircleArrays={},this.prevPlacement=w,w&&(w.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,l,y,w,M=1){const A=y.getBucket(l),V=y.latestFeatureIndex;if(!A||!V||l.fqid!==A.layerIds[0])return;const H=A.layers[0].layout,K=A.layers[0].paint,ee=y.collisionBoxArray,se=Math.pow(2,this.transform.zoom-y.tileID.overscaledZ),le=y.tileSize/t.ag,me=y.tileID.toUnwrapped();this.transform.setProjection(A.projection);const Ee=(Se=y.tileID,ke=A.getProjection(),De=this.transform,ke.name===this.projection?De.calculateProjMatrix(Se.toUnwrapped()):Il(De,ke,Se));var Se,ke,De;const Xe=H.get("text-pitch-alignment")==="map",ut=H.get("text-rotation-alignment")==="map";l.compileFilter(l.options);const st=l.dynamicFilter(),wt=l.dynamicFilterNeedsFeature(),gt=this.transform.calculatePixelsToTileUnitsMatrix(y),vt=mc(Ee,y.tileID.canonical,Xe,ut,this.transform,A.getProjection(),gt);let _t=null;if(Xe){const ti=Ns(Ee,y.tileID.canonical,Xe,ut,this.transform,A.getProjection(),gt);_t=t.ab.mat4.multiply([],this.transform.labelPlaneMatrix,ti)}let Mt=null;st&&y.latestFeatureIndex&&(Mt={unwrappedTileID:me,dynamicFilter:st,dynamicFilterNeedsFeature:wt}),this.retainedQueryData[A.bucketInstanceId]=new Al(A.bucketInstanceId,V,A.sourceLayerIndex,A.index,y.tileID);const[Ft,cn]=A.layers[0].layout.get("text-size-scale-range"),en=t.aw(M,Ft,cn),[zt,Ht]=H.get("icon-size-scale-range"),En=t.aw(M,zt,Ht),Vn={bucket:A,layout:H,paint:K,posMatrix:Ee,textLabelPlaneMatrix:vt,labelToScreenMatrix:_t,clippingData:Mt,scale:se,textPixelRatio:le,holdingForFade:y.holdingForFade(),collisionBoxArray:ee,partiallyEvaluatedTextSize:t.bp(A.textSizeData,this.transform.zoom,en),partiallyEvaluatedIconSize:t.bp(A.iconSizeData,this.transform.zoom,En),collisionGroup:this.collisionGroups.get(A.sourceID),latestFeatureIndex:y.latestFeatureIndex};if(w)for(const ti of A.sortKeyRanges){const{sortKey:Qt,symbolInstanceStart:An,symbolInstanceEnd:dn}=ti;i.push({sortKey:Qt,symbolInstanceStart:An,symbolInstanceEnd:dn,parameters:Vn})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:A.symbolInstances.length,parameters:Vn})}attemptAnchorPlacement(i,l,y,w,M,A,V,H,K,ee,se,le,me,Ee,Se,ke,De,Xe){const{textOffset0:ut,textOffset1:st,crossTileID:wt}=le,gt=[ut,st],vt=yh(i,y,w,gt,M),_t=this.collisionIndex.placeCollisionBox(Ee,M,l,td(vt.x,vt.y,A,V,this.transform.angle),se,H,K,ee.predicate);if(ke){const Mt=Ee.getSymbolInstanceIconSize(Xe,this.transform.zoom,le.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Ee,Mt,ke,td(vt.x,vt.y,A,V,this.transform.angle),se,H,K,ee.predicate).box.length===0)return}if(_t.box.length>0){let Mt;return this.prevPlacement&&this.prevPlacement.variableOffsets[wt]&&this.prevPlacement.placements[wt]&&this.prevPlacement.placements[wt].text&&(Mt=this.prevPlacement.variableOffsets[wt].anchor),this.variableOffsets[wt]={textOffset:gt,width:y,height:w,anchor:i,textScale:M,prevAnchor:Mt},this.markUsedJustification(Ee,i,le,Se),Ee.allowVerticalPlacement&&(this.markUsedOrientation(Ee,Se,le),this.placedOrientations[wt]=Se),{shift:vt,placedGlyphBoxes:_t}}}placeLayerBucketPart(i,l,y,w,M=1){const{bucket:A,layout:V,paint:H,posMatrix:K,textLabelPlaneMatrix:ee,labelToScreenMatrix:se,clippingData:le,textPixelRatio:me,holdingForFade:Ee,collisionBoxArray:Se,partiallyEvaluatedTextSize:ke,partiallyEvaluatedIconSize:De,collisionGroup:Xe,latestFeatureIndex:ut}=i.parameters,st=V.get("text-optional"),wt=V.get("icon-optional"),gt=V.get("text-allow-overlap"),vt=V.get("icon-allow-overlap"),_t=V.get("text-rotation-alignment")==="map",Mt=V.get("text-pitch-alignment")==="map",Ft=V.get("symbol-z-elevate"),cn=H.get("symbol-z-offset"),en=V.get("symbol-elevation-reference")==="sea",[zt,Ht]=V.get("text-size-scale-range"),[En,Vn]=V.get("icon-size-scale-range"),ti=t.aw(M,zt,Ht),Qt=t.aw(M,En,Vn);this.transform.setProjection(A.projection);let An=gt&&(vt||!A.hasIconData()||wt),dn=vt&&(gt||!A.hasTextData()||st);const Jn=!cn.isConstant();!A.collisionArrays&&Se&&A.deserializeCollisionBoxes(Se),y&&w&&A.updateCollisionDebugBuffers(this.transform.zoom,Se,ti,Qt);const Fn=(wn,Mi,si)=>{const{crossTileID:Ii,numVerticalGlyphVertices:Ai}=wn;let ur=null;if(le&&le.dynamicFilterNeedsFeature||Jn){const wa=this.retainedQueryData[A.bucketInstanceId];ur=ut.loadFeature({featureIndex:wn.featureIndex,bucketIndex:wa.bucketIndex,sourceLayerIndex:wa.sourceLayerIndex,layoutVertexArrayOffset:0})}if(le&&!(0,le.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},ur,this.retainedQueryData[A.bucketInstanceId].tileID.canonical,new t.P(wn.tileAnchorX,wn.tileAnchorY),this.transform.calculateDistanceTileData(le.unwrappedTileID)))return this.placements[Ii]=new uu(!1,!1,!1,!0),void l.add(Ii);const Xi=cn.evaluate(ur,{});if(l.has(Ii))return;if(Ee)return void(this.placements[Ii]=new uu(!1,!1,!1));let er=!1,dr=!1,Ur=!0,Mr=!1,Ea=!1,za=null,ra={box:null,offscreen:null,occluded:null},ha={box:null,offscreen:null,occluded:null},br=null,nr=null,ea=null,ta=0,Xa=0,bo=0;si.textFeatureIndex?ta=si.textFeatureIndex:wn.useRuntimeCollisionCircles&&(ta=wn.featureIndex),si.verticalTextFeatureIndex&&(Xa=si.verticalTextFeatureIndex);const vl=wa=>{wa.tileID=this.retainedQueryData[A.bucketInstanceId].tileID;const fa=this.transform.elevation;wa.elevation=en?Xi:Xi+(fa?fa.getAtTileOffset(wa.tileID,wa.tileAnchorX,wa.tileAnchorY):0),wa.elevation+=wn.zOffset},Ls=si.textBox;if(Ls){vl(Ls);const wa=$r=>{let is=t.bq.horizontal;if(A.allowVerticalPlacement&&!$r&&this.prevPlacement){const So=this.prevPlacement.placedOrientations[Ii];So&&(this.placedOrientations[Ii]=So,is=So,this.markUsedOrientation(A,is,wn))}return is},fa=($r,is)=>{if(A.allowVerticalPlacement&&Ai>0&&si.verticalTextBox){for(const So of A.writingModes)if(So===t.bq.vertical?(ra=is(),ha=ra):ra=$r(),ra&&ra.box&&ra.box.length)break}else ra=$r()};if(V.get("text-variable-anchor")){let $r=V.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ii]){const Lr=this.prevPlacement.variableOffsets[Ii];$r.indexOf(Lr.anchor)>0&&($r=$r.filter(Fo=>Fo!==Lr.anchor),$r.unshift(Lr.anchor))}const is=(Lr,Fo,Tc)=>{const jl=A.getSymbolInstanceTextSize(ke,wn,this.transform.zoom,Mi),Su=(Lr.x2-Lr.x1)*jl+2*Lr.padding,Ho=(Lr.y2-Lr.y1)*jl+2*Lr.padding,Tu=wn.hasIconTextFit&&!vt?Fo:null;Tu&&vl(Tu);let ac={box:[],offscreen:!1,occluded:!1};const Ad=gt?2*$r.length:$r.length;for(let uh=0;uh<Ad;++uh){const kd=this.attemptAnchorPlacement($r[uh%$r.length],Lr,Su,Ho,jl,_t,Mt,me,K,Xe,uh>=$r.length,wn,Mi,A,Tc,Tu,ke,De);if(kd&&(ac=kd.placedGlyphBoxes,ac&&ac.box&&ac.box.length)){er=!0,za=kd.shift;break}}return ac};fa(()=>is(Ls,si.iconBox,t.bq.horizontal),()=>{const Lr=si.verticalTextBox;return Lr&&vl(Lr),A.allowVerticalPlacement&&!(ra&&ra.box&&ra.box.length)&&Ai>0&&Lr?is(Lr,si.verticalIconBox,t.bq.vertical):{box:null,offscreen:null,occluded:null}}),ra&&(er=ra.box,Ur=ra.offscreen,Mr=ra.occluded);const So=wa(!(!ra||!ra.box));if(!er&&this.prevPlacement){const Lr=this.prevPlacement.variableOffsets[Ii];Lr&&(this.variableOffsets[Ii]=Lr,this.markUsedJustification(A,Lr.anchor,wn,So))}}else{const $r=(is,So)=>{const Lr=A.getSymbolInstanceTextSize(ke,wn,this.transform.zoom,Mi,M),Fo=this.collisionIndex.placeCollisionBox(A,Lr,is,new t.P(0,0),gt,me,K,Xe.predicate);return Fo&&Fo.box&&Fo.box.length&&(this.markUsedOrientation(A,So,wn),this.placedOrientations[Ii]=So),Fo};fa(()=>$r(Ls,t.bq.horizontal),()=>{const is=si.verticalTextBox;return A.allowVerticalPlacement&&Ai>0&&is?(vl(is),$r(is,t.bq.vertical)):{box:null,offscreen:null,occluded:null}}),wa(!!(ra&&ra.box&&ra.box.length))}}if(br=ra,er=br&&br.box&&br.box.length>0,Ur=br&&br.offscreen,Mr=br&&br.occluded,wn.useRuntimeCollisionCircles){const wa=A.text.placedSymbolArray.get(wn.centerJustifiedTextSymbolIndex>=0?wn.centerJustifiedTextSymbolIndex:wn.verticalPlacedTextSymbolIndex),fa=t.br(A.textSizeData,ke,wa),$r=V.get("text-padding");nr=this.collisionIndex.placeCollisionCircles(A,gt,wa,A.lineVertexArray,A.glyphOffsetArray,fa,K,ee,se,y,Mt,Xe.predicate,wn.collisionCircleDiameter*fa/t.bw,$r,this.retainedQueryData[A.bucketInstanceId].tileID),er=gt||nr.circles.length>0&&!nr.collisionDetected,Ur=Ur&&nr.offscreen,Mr=nr.occluded}if(si.iconFeatureIndex&&(bo=si.iconFeatureIndex),si.iconBox){const wa=fa=>{vl(fa);const $r=wn.hasIconTextFit&&za?td(za.x,za.y,_t,Mt,this.transform.angle):new t.P(0,0),is=A.getSymbolInstanceIconSize(De,this.transform.zoom,wn.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(A,is,fa,$r,vt,me,K,Xe.predicate)};ha&&ha.box&&ha.box.length&&si.verticalIconBox?(ea=wa(si.verticalIconBox),dr=ea.box.length>0):(ea=wa(si.iconBox),dr=ea.box.length>0),Ur=Ur&&ea.offscreen,Ea=ea.occluded}const wo=st||wn.numHorizontalGlyphVertices===0&&Ai===0,qo=wt||wn.numIconVertices===0;if(wo||qo?qo?wo||(dr=dr&&er):er=dr&&er:dr=er=dr&&er,er&&br&&br.box&&this.collisionIndex.insertCollisionBox(br.box,V.get("text-ignore-placement"),A.bucketInstanceId,ha&&ha.box&&Xa?Xa:ta,Xe.ID),dr&&ea&&this.collisionIndex.insertCollisionBox(ea.box,V.get("icon-ignore-placement"),A.bucketInstanceId,bo,Xe.ID),nr&&(er&&this.collisionIndex.insertCollisionCircles(nr.circles,V.get("text-ignore-placement"),A.bucketInstanceId,ta,Xe.ID),y)){const wa=A.bucketInstanceId;let fa=this.collisionCircleArrays[wa];fa===void 0&&(fa=this.collisionCircleArrays[wa]=new Pl);for(let $r=0;$r<nr.circles.length;$r+=4)fa.circles.push(nr.circles[$r+0]),fa.circles.push(nr.circles[$r+1]),fa.circles.push(nr.circles[$r+2]),fa.circles.push(nr.collisionDetected?1:0)}const ys=A.projection.name!=="globe";An=An&&(ys||!Mr),dn=dn&&(ys||!Ea),this.placements[Ii]=new uu(er||An,dr||dn,Ur||A.justReloaded),l.add(Ii)};if(Ft&&this.buildingIndex&&(this.buildingIndex.updateZOffset(A,this.retainedQueryData[A.bucketInstanceId].tileID),A.updateZOffset()),A.sortFeaturesByY){const wn=A.getSortedSymbolIndexes(this.transform.angle);for(let Mi=wn.length-1;Mi>=0;--Mi){const si=wn[Mi];Fn(A.symbolInstances.get(si),si,A.collisionArrays[si])}A.hasAnyZOffset&&t.w(`${A.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(A.hasAnyZOffset){const wn=A.getSortedIndexesByZOffset();for(let Mi=0;Mi<wn.length;++Mi){const si=wn[Mi];Fn(A.symbolInstances.get(si),si,A.collisionArrays[si])}}else for(let wn=i.symbolInstanceStart;wn<i.symbolInstanceEnd;wn++)Fn(A.symbolInstances.get(wn),wn,A.collisionArrays[wn]);if(y&&A.bucketInstanceId in this.collisionCircleArrays){const wn=this.collisionCircleArrays[A.bucketInstanceId];t.ab.mat4.invert(wn.invProjMatrix,K),wn.viewportMatrix=this.collisionIndex.getViewportMatrix()}A.justReloaded=!1}markUsedJustification(i,l,y,w){const{leftJustifiedTextSymbolIndex:M,centerJustifiedTextSymbolIndex:A,rightJustifiedTextSymbolIndex:V,verticalPlacedTextSymbolIndex:H,crossTileID:K}=y,ee=t.bB(l),se=w===t.bq.vertical?H:ee==="left"?M:ee==="center"?A:ee==="right"?V:-1;M>=0&&(i.text.placedSymbolArray.get(M).crossTileID=se>=0&&M!==se?0:K),A>=0&&(i.text.placedSymbolArray.get(A).crossTileID=se>=0&&A!==se?0:K),V>=0&&(i.text.placedSymbolArray.get(V).crossTileID=se>=0&&V!==se?0:K),H>=0&&(i.text.placedSymbolArray.get(H).crossTileID=se>=0&&H!==se?0:K)}markUsedOrientation(i,l,y){const w=l===t.bq.horizontal||l===t.bq.horizontalOnly?l:0,M=l===t.bq.vertical?l:0,{leftJustifiedTextSymbolIndex:A,centerJustifiedTextSymbolIndex:V,rightJustifiedTextSymbolIndex:H,verticalPlacedTextSymbolIndex:K}=y,ee=i.text.placedSymbolArray;A>=0&&(ee.get(A).placedOrientation=w),V>=0&&(ee.get(V).placedOrientation=w),H>=0&&(ee.get(H).placedOrientation=w),K>=0&&(ee.get(K).placedOrientation=M)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let y=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const w=l?l.symbolFadeChange(i):1,M=l?l.opacities:{},A=l?l.variableOffsets:{},V=l?l.placedOrientations:{};for(const H in this.placements){const K=this.placements[H],ee=M[H];ee?(this.opacities[H]=new cu(ee,w,K.text,K.icon,null,K.clipped),y=y||K.text!==ee.text.placed||K.icon!==ee.icon.placed):(this.opacities[H]=new cu(null,w,K.text,K.icon,K.skipFade,K.clipped),y=y||K.text||K.icon)}for(const H in M){const K=M[H];if(!this.opacities[H]){const ee=new cu(K,w,!1,!1);ee.isHidden()||(this.opacities[H]=ee,y=y||K.text.placed||K.icon.placed)}}for(const H in A)this.variableOffsets[H]||!this.opacities[H]||this.opacities[H].isHidden()||(this.variableOffsets[H]=A[H]);for(const H in V)this.placedOrientations[H]||!this.opacities[H]||this.opacities[H].isHidden()||(this.placedOrientations[H]=V[H]);y?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:i)}updateLayerOpacities(i,l,y,w){const M=new Set;for(const A of l){const V=A.getBucket(i);V&&A.latestFeatureIndex&&i.fqid===V.layerIds[0]&&(this.updateBucketOpacities(V,M,A,A.collisionBoxArray,y,w,A.tileID,i.scope),V.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(V,A.tileID),V.updateZOffset()))}}updateBucketOpacities(i,l,y,w,M,A,V,H){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const K=i.layers[0].layout,ee=i.layers[0].paint,se=!!i.layers[0].dynamicFilter(),le=new cu(null,0,!1,!1,!0),me=K.get("text-allow-overlap"),Ee=K.get("icon-allow-overlap"),Se=K.get("text-variable-anchor"),ke=K.get("text-rotation-alignment")==="map",De=K.get("text-pitch-alignment")==="map",Xe=ee.get("symbol-z-offset"),ut=K.get("symbol-elevation-reference")==="sea",st=!Xe.isConstant(),wt=new cu(null,0,me&&(Ee||!i.hasIconData()||K.get("icon-optional")),Ee&&(me||!i.hasTextData()||K.get("text-optional")),!0);!i.collisionArrays&&w&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(w);const gt=(_t,Mt,Ft)=>{for(let cn=0;cn<Mt/4;cn++)_t.opacityVertexArray.emplaceBack(Ft)};let vt=0;A&&i.updateReplacement(V,A);for(let _t=0;_t<i.symbolInstances.length;_t++){const Mt=i.symbolInstances.get(_t),{numHorizontalGlyphVertices:Ft,numVerticalGlyphVertices:cn,crossTileID:en,numIconVertices:zt,tileAnchorX:Ht,tileAnchorY:En}=Mt;let Vn=null;const ti=this.retainedQueryData[i.bucketInstanceId];st&&Mt&&ti&&(Vn=y.latestFeatureIndex.loadFeature({featureIndex:Mt.featureIndex,bucketIndex:ti.bucketIndex,sourceLayerIndex:ti.sourceLayerIndex,layoutVertexArrayOffset:0}));const Qt=Xe.evaluate(Vn,{}),An=l.has(en);let dn=this.opacities[en];An?dn=le:dn||(dn=wt,this.opacities[en]=dn),l.add(en);const Jn=Ft>0||cn>0,Fn=zt>0,wn=this.placedOrientations[en],Mi=wn===t.bq.vertical,si=wn===t.bq.horizontal||wn===t.bq.horizontalOnly;!Jn&&!Fn||dn.isHidden()||vt++;let Ii=!1;if((Jn||Fn)&&A)for(const Ai of i.activeReplacements){if(t.bx(Ai,M,t.by.Symbol,H)||Ai.min.x>Ht||Ht>Ai.max.x||Ai.min.y>En||En>Ai.max.y)continue;const ur=t.bz(Ht,En,V.canonical,Ai.footprintTileId.canonical);if(Ii=t.bA(ur,Ai.footprint),Ii)break}if(Jn){const Ai=Ii?Dl:Bm(dn.text);gt(i.text,Ft,Mi?Dl:Ai),gt(i.text,cn,si?Dl:Ai);const ur=dn.text.isHidden(),{leftJustifiedTextSymbolIndex:Xi,centerJustifiedTextSymbolIndex:er,rightJustifiedTextSymbolIndex:dr,verticalPlacedTextSymbolIndex:Ur}=Mt,Mr=i.text.placedSymbolArray,Ea=ur||Mi?1:0;Xi>=0&&(Mr.get(Xi).hidden=Ea),er>=0&&(Mr.get(er).hidden=Ea),dr>=0&&(Mr.get(dr).hidden=Ea),Ur>=0&&(Mr.get(Ur).hidden=ur||si?1:0);const za=this.variableOffsets[en];za&&this.markUsedJustification(i,za.anchor,Mt,wn);const ra=this.placedOrientations[en];ra&&(this.markUsedJustification(i,"left",Mt,ra),this.markUsedOrientation(i,ra,Mt))}if(Fn){const Ai=Ii?Dl:Bm(dn.icon),{placedIconSymbolIndex:ur,verticalPlacedIconSymbolIndex:Xi}=Mt,er=i.icon.placedSymbolArray,dr=dn.icon.isHidden()?1:0;ur>=0&&(gt(i.icon,zt,Mi?Dl:Ai),er.get(ur).hidden=dr),Xi>=0&&(gt(i.icon,Mt.numVerticalIconVertices,si?Dl:Ai),er.get(Xi).hidden=dr)}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const Ai=i.collisionArrays[_t];if(Ai){let ur=new t.P(0,0),Xi=!0;if(Ai.textBox||Ai.verticalTextBox){if(Se){const dr=this.variableOffsets[en];dr?(ur=yh(dr.anchor,dr.width,dr.height,dr.textOffset,dr.textScale),ke&&ur._rotate(De?this.transform.angle:-this.transform.angle)):Xi=!1}se&&(Xi=!dn.clipped),Ai.textBox&&Hf(i.textCollisionBox.collisionVertexArray,dn.text.placed,!Xi||Mi,Qt,ut,ur.x,ur.y),Ai.verticalTextBox&&Hf(i.textCollisionBox.collisionVertexArray,dn.text.placed,!Xi||si,Qt,ut,ur.x,ur.y)}const er=Xi&&!!(!si&&Ai.verticalIconBox);Ai.iconBox&&Hf(i.iconCollisionBox.collisionVertexArray,dn.icon.placed,er,Qt,ut,Mt.hasIconTextFit?ur.x:0,Mt.hasIconTextFit?ur.y:0),Ai.verticalIconBox&&Hf(i.iconCollisionBox.collisionVertexArray,dn.icon.placed,!er,Qt,ut,Mt.hasIconTextFit?ur.x:0,Mt.hasIconTextFit?ur.y:0)}}}if(i.fullyClipped=vt===0,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const _t=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=_t.invProjMatrix,i.placementViewportMatrix=_t.viewportMatrix,i.collisionCircleArray=_t.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,l){const y=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*y>i}setStale(){this.stale=!0}}function Hf(_,i,l,y,w,M,A){_.emplaceBack(i?1:0,l?1:0,M||0,A||0,y,w?1:0),_.emplaceBack(i?1:0,l?1:0,M||0,A||0,y,w?1:0),_.emplaceBack(i?1:0,l?1:0,M||0,A||0,y,w?1:0),_.emplaceBack(i?1:0,l?1:0,M||0,A||0,y,w?1:0)}const nd=Math.pow(2,25),id=Math.pow(2,24),hu=Math.pow(2,17),Zf=Math.pow(2,16),Wf=Math.pow(2,9),rd=Math.pow(2,8),gc=Math.pow(2,1);function Bm(_){if(_.opacity===0&&!_.placed)return 0;if(_.opacity===1&&_.placed)return 4294967295;const i=_.placed?1:0,l=Math.floor(127*_.opacity);return l*nd+i*id+l*hu+i*Zf+l*Wf+i*rd+l*gc+i}const Dl=0;class Vm{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&i.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(i,l,y,w,M,A){const V=this._bucketParts;for(;this._currentTileIndex<i.length;)if(l.getBucketParts(V,w,i[this._currentTileIndex],this._sortAcrossTiles,A),this._currentTileIndex++,M())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,V.sort((H,K)=>H.sortKey-K.sortKey));this._currentPartIndex<V.length;){const H=V[this._currentPartIndex];if(l.placeLayerBucketPart(H,this._seenCrossTileIDs,y,H.symbolInstanceStart===0,A),this._currentPartIndex++,M())return!0}return!1}}class Wd{constructor(i,l,y,w,M,A,V,H,K){this.placement=new ps(i,M,A,V,H,K),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=y,this._showCollisionBoxes=w,this._done=!1}isDone(){return this._done}continuePlacement(i,l,y,w,M){const A=t.q.now(),V=()=>{const H=t.q.now()-A;return!this._forceFullPlacement&&H>2};for(;this._currentPlacementIndex>=0;){const H=l[i[this._currentPlacementIndex]],K=this.placement.collisionIndex.transform.zoom;if(H.type==="symbol"&&(!H.minzoom||H.minzoom<=K)&&(!H.maxzoom||H.maxzoom>K)){const ee=H,se=ee.layout.get("symbol-z-elevate"),le=ee.layout.get("symbol-sort-key").constantOr(1)!==void 0,me=ee.layout.get("symbol-z-order"),Ee=me==="viewport-y"||me==="auto"&&!(me!=="viewport-y"&&le),Se=ee.layout.get("text-allow-overlap")||ee.layout.get("icon-allow-overlap")||ee.layout.get("text-ignore-placement")||ee.layout.get("icon-ignore-placement"),ke=Ee&&Se,De=this._inProgressLayer=this._inProgressLayer||new Vm(ee),Xe=t.aC(H.source,H.scope);if(De.continuePlacement(se||ke?w[Xe]:y[Xe],this.placement,this._showCollisionBoxes,H,V,M))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const Yl=512/t.ag/2;class Nm{constructor(i,l,y){this.tileID=i,this.bucketInstanceId=y,this.index=new t.bE(l.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const w=i.canonical.x*t.ag,M=i.canonical.y*t.ag;for(let A=0;A<l.length;A++){const{key:V,crossTileID:H,tileAnchorX:K,tileAnchorY:ee}=l.get(A),se=Math.floor((w+K)*Yl),le=Math.floor((M+ee)*Yl);this.index.add(se,le),this.keys.push(V),this.crossTileIDs.push(H)}this.index.finish()}findMatches(i,l,y){const w=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z),M=Yl/Math.pow(2,l.canonical.z-this.tileID.canonical.z),A=l.canonical.x*t.ag,V=l.canonical.y*t.ag;for(let H=0;H<i.length;H++){const K=i.get(H);if(K.crossTileID)continue;const{key:ee,tileAnchorX:se,tileAnchorY:le}=K,me=Math.floor((A+se)*M),Ee=Math.floor((V+le)*M),Se=this.index.range(me-w,Ee-w,me+w,Ee+w);for(const ke of Se){const De=this.crossTileIDs[ke];if(this.keys[ke]===ee&&!y.has(De)){y.add(De),K.crossTileID=De;break}}}}}class jm{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Yp{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const l=Math.round((i-this.lng)/360);if(l!==0)for(const y in this.indexes){const w=this.indexes[y],M={};for(const A in w){const V=w[A];V.tileID=V.tileID.unwrapTo(V.tileID.wrap+l),M[V.tileID.key]=V}this.indexes[y]=M}this.lng=i}addBucket(i,l,y){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let M=0;M<l.symbolInstances.length;M++)l.symbolInstances.get(M).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]=new Set);const w=this.usedCrossTileIDs[i.overscaledZ];for(const M in this.indexes){const A=this.indexes[M];if(Number(M)>i.overscaledZ)for(const V in A){const H=A[V];H.tileID.isChildOf(i)&&H.findMatches(l.symbolInstances,i,w)}else{const V=A[i.scaledTo(Number(M)).key];V&&V.findMatches(l.symbolInstances,i,w)}}for(let M=0;M<l.symbolInstances.length;M++){const A=l.symbolInstances.get(M);A.crossTileID||(A.crossTileID=y.generate(),w.add(A.crossTileID))}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new Nm(i,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(i,l){for(const y of l.crossTileIDs)this.usedCrossTileIDs[i].delete(y)}removeStaleBuckets(i){let l=!1;for(const y in this.indexes){const w=this.indexes[y];for(const M in w)i[w[M].bucketInstanceId]||(this.removeBucketCrossTileIDs(y,w[M]),delete w[M],l=!0)}return l}}class Xf{constructor(){this.layerIndexes={},this.crossTileIDs=new jm,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,l,y,w){let M=this.layerIndexes[i.fqid];M===void 0&&(M=this.layerIndexes[i.fqid]=new Yp);let A=!1;const V={};w.name!=="globe"&&M.handleWrapJump(y);for(const H of l){const K=H.getBucket(i);K&&i.fqid===K.layerIds[0]&&(K.bucketInstanceId||(K.bucketInstanceId=++this.maxBucketInstanceId),M.addBucket(H.tileID,K,this.crossTileIDs)&&(A=!0),V[K.bucketInstanceId]=!0)}return M.removeStaleBuckets(V)&&(A=!0),A}pruneUnusedLayers(i){const l={};i.forEach(y=>{l[y]=!0});for(const y in this.layerIndexes)l[y]||delete this.layerIndexes[y]}}const Rl=771;class Tr{constructor(i,l,y,w){this.blendFunction=i,this.blendColor=l,this.mask=y,this.blendEquation=w}}Tr.Replace=[1,0,1,0],Tr.disabled=new Tr(Tr.Replace,t.aj.transparent,[!1,!1,!1,!1]),Tr.unblended=new Tr(Tr.Replace,t.aj.transparent,[!0,!0,!0,!0]),Tr.alphaBlended=new Tr([1,Rl,1,Rl],t.aj.transparent,[!0,!0,!0,!0]),Tr.alphaBlendedNonPremultiplied=new Tr([770,Rl,770,Rl],t.aj.transparent,[!0,!0,!0,!0]),Tr.multiply=new Tr([774,0,774,0],t.aj.transparent,[!0,!0,!0,!0]);class Zi{constructor(i,l,y){this.func=i,this.mask=l,this.range=y}}Zi.ReadOnly=!1,Zi.ReadWrite=!0,Zi.disabled=new Zi(519,Zi.ReadOnly,[0,1]);const Uu=7680;class lr{constructor(i,l,y,w,M,A){this.test=i,this.ref=l,this.mask=y,this.fail=w,this.depthFail=M,this.pass=A}}lr.disabled=new lr({func:519,mask:0},0,0,Uu,Uu,Uu);const vh=1029,du=2305;class or{constructor(i,l,y){this.enable=i,this.mode=l,this.frontFace=y}}function Xd(_,i){const l=t.bG(_,3);t.ab.mat4.fromQuat(_,i),t.bI(_,3,l)}function ad(_,i){const l=t.ab.quat.identity([]);return t.ab.quat.rotateZ(l,l,-i),t.ab.quat.rotateX(l,l,-_),l}function xh(_,i){const l=[_[0],_[1],0],y=[i[0],i[1],0];if(t.ab.vec3.length(l)>=1e-15){const A=t.ab.vec3.normalize([],l);t.ab.vec3.scale(y,A,t.ab.vec3.dot(y,A)),i[0]=y[0],i[1]=y[1]}const w=t.ab.vec3.cross([],i,_);if(t.ab.vec3.len(w)<1e-15)return null;const M=Math.atan2(-w[1],w[0]);return ad(Math.atan2(Math.sqrt(_[0]*_[0]+_[1]*_[1]),-_[2]),M)}or.disabled=new or(!1,vh,du),or.backCCW=new or(!0,vh,du),or.backCW=new or(!0,vh,2304),or.frontCW=new or(!0,1028,2304),or.frontCCW=new or(!0,1028,du);class $u{constructor(i,l){this.position=i,this.orientation=l}get position(){return this._position}set position(i){if(i){const l=i instanceof t.aa?i:new t.aa(i[0],i[1],i[2]);this._renderWorldCopies&&(l.x=t.bF(l.x,0,1)),this._position=l}else this._position=null}lookAtPoint(i,l){if(this.orientation=null,!this.position)return;const y=this.position,w=this._elevation?this._elevation.getAtPointOrZero(t.aa.fromLngLat(i)):0,M=t.aa.fromLngLat(i,w),A=[M.x-y.x,M.y-y.y,M.z-y.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=xh(A,l)}setPitchBearing(i,l){this.orientation=ad(t.ai(i),t.ai(-l))}}class bh{constructor(i,l){this._transform=t.ab.mat4.identity([]),this.orientation=l,this.position=i}get mercatorPosition(){const i=this.position;return new t.aa(i[0],i[1],i[2])}get position(){const i=t.bG(this._transform,3);return[i[0],i[1],i[2]]}set position(i){var l;i&&t.bI(this._transform,3,[(l=i)[0],l[1],l[2],1])}get orientation(){return this._orientation}set orientation(i){this._orientation=i||t.ab.quat.identity([]),i&&Xd(this._transform,this._orientation)}getPitchBearing(){const i=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,l){this._orientation=ad(i,l),Xd(this._transform,this._orientation)}forward(){const i=t.bG(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){const i=t.bG(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){const i=t.bG(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,l){const y=new Float64Array(16);return t.ab.mat4.invert(y,this.getWorldToCamera(i,l)),y}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(i,l,y){const w=this.position;t.ab.vec3.scale(w,w,-i);const M=new Float64Array(16);return t.ab.mat4.fromScaling(M,[y,y,y]),t.ab.mat4.translate(M,M,w),M[10]*=l,M}getWorldToCamera(i,l){const y=new Float64Array(16),w=new Float64Array(4),M=this.position;return t.ab.quat.conjugate(w,this._orientation),t.ab.vec3.scale(M,M,-i),t.ab.mat4.fromQuat(y,w),t.ab.mat4.translate(y,y,M),y[1]*=-1,y[5]*=-1,y[9]*=-1,y[13]*=-1,y[8]*=l,y[9]*=l,y[10]*=l,y[11]*=l,y}getCameraToClipPerspective(i,l,y,w){const M=new Float64Array(16);return t.ab.mat4.perspective(M,i,l,y,w),M}getCameraToClipOrthographic(i,l,y,w,M,A){const V=new Float64Array(16);return t.ab.mat4.ortho(V,i,l,y,w,M,A),V}getDistanceToElevation(i,l=!1){const y=i===0?0:t.bH(i,l?t.aS(this.position[1]):this.position[1]),w=this.forward();return(y-this.position[2])/w[2]}clone(){return new bh([...this.position],[...this.orientation])}}const Ds={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class Rs{constructor(i=0,l=0,y=0,w=0){if(isNaN(i)||i<0||isNaN(l)||l<0||isNaN(y)||y<0||isNaN(w)||w<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=l,this.left=y,this.right=w}interpolate(i,l,y){return l.top!=null&&i.top!=null&&(this.top=t.af(i.top,l.top,y)),l.bottom!=null&&i.bottom!=null&&(this.bottom=t.af(i.bottom,l.bottom,y)),l.left!=null&&i.left!=null&&(this.left=t.af(i.left,l.left,y)),l.right!=null&&i.right!=null&&(this.right=t.af(i.right,l.right,y)),this}getCenter(i,l){const y=t.aw((this.left+i-this.right)/2,0,i),w=t.aw((this.top+l-this.bottom)/2,0,l);return new t.P(y,w)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new Rs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const sd=(_,i,l)=>(1-l)*_+l*i,mi=_=>_*_*_*_*_;class wh{constructor(i,l,y,w,M,A,V){this.tileSize=512,this._renderWorldCopies=M===void 0||M,this._minZoom=i||0,this._maxZoom=l||22,this._minPitch=y??0,this._maxPitch=w??60,this.setProjection(A),this.setMaxBounds(V),this.width=0,this.height=0,this._center=new t.bO(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Rs,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new bh,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const i=new wh(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,i.tileSize=this.tileSize,i.mercatorFromTransition=this.mercatorFromTransition,i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._seaLevelZoom=this._seaLevelZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i.frustumCorners=this.frustumCorners,i}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(i,l=!1){const y=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||y)&&this._updateCameraOnTerrain(),(i||y)&&this._constrainCamera(l),this._calcMatrices()}getProjection(){return t.ay(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const l=this.projection?this.getProjection():void 0;this.projection=t.bP(this.projectionOptions);const y=this.getProjection(),w=!t.bn(l,y);return w&&this._calcMatrices(),this.mercatorFromTransition=!1,w}setOrthographicProjectionAtLowPitch(i){return this._orthographicProjectionAtLowPitch!==i&&(this._orthographicProjectionAtLowPitch=i,this._calcMatrices(),!0)}setMercatorFromTransition(){const i=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=t.bP({name:"mercator"});const l=i!==this.projection.name;return l&&this._calcMatrices(),l}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get cameraWorldSize(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return t.bH(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new t.P(this.width,this.height)}get bearing(){return t.bF(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){const l=-i*Math.PI/180;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=t.ab.mat2.create(),t.ab.mat2.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const l=t.aw(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const i=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/i)}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=t.ai(i),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(i){const l=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(i){this._tileCoverLift!==i&&(this._tileCoverLift=i)}_updateCameraOnTerrain(){const i=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,l=this.elevation&&i===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||i===Number.NEGATIVE_INFINITY&&(!l||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const y=this._elevation;l||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&y.exaggeration()&&this._centerAltitudeValidForExaggeration!==y.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*y.exaggeration(),this._centerAltitudeValidForExaggeration=y.exaggeration()):(this._centerAltitude=i||0,this._centerAltitudeValidForExaggeration=y.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const i=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],y=this.horizonLineFromTop();let w=0,M=0;for(let A=0;A<l.length;A++){const V=new t.P(l[A][0]*this.width,y+l[A][1]*(this.height-y)),H=i.pointCoordinate(V);if(!H)continue;const K=1/Math.hypot(H[0]-this._camera.position[0],H[1]-this._camera.position[1]);w+=H[3]*K,M+=K}return M===0?NaN:w/M}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const i=this._seaLevelZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),y=this.pixelsPerMeter/this.worldSize*l,w=this._mercatorZfromZoom(i),M=this._mercatorZfromZoom(this._maxZoom),A=Math.max(w-y,M);this._setZoom(this._zoomFromMercatorZ(A))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){const l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));let y;y=i.z<this._camera.position[2]?[l.x,l.y,l.z]:[i.x,i.y,i.z];const w=t.ab.vec3.length(t.ab.vec3.sub([],this._camera.position,y));return t.aw(this._zoomFromMercatorZ(w),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let l=!1;if(i.orientation&&!t.ab.quat.exactEquals(i.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(i.orientation)),i.position){const y=[i.position.x,i.position.y,i.position.z];t.ab.vec3.exactEquals(y,this._camera.position)||(this._setCameraPosition(y),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const i=this._camera.position,l=new $u;return l.position=new t.aa(i[0],i[1],i[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(i){if(!t.ab.quat.length(i))return!1;t.ab.quat.normalize(i,i);const l=t.ab.vec3.transformQuat([],[0,0,-1],i),y=t.ab.vec3.transformQuat([],[0,-1,0],i);if(y[2]<0)return!1;const w=xh(l,y);return!!w&&(this._camera.orientation=w,!0)}_setCameraPosition(i){const l=this.zoomScale(this.minZoom)*this.tileSize,y=this.zoomScale(this.maxZoom)*this.tileSize,w=this.cameraToCenterDistance;i[2]=t.aw(i[2],w/y,w/l),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,l,y){this._unmodified=!1,this._edgeInsets.interpolate(i,l,y),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const l=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(i){const l=[new t.bQ(0,i)];if(this.renderWorldCopies){const y=this.pointCoordinate(new t.P(0,0)),w=this.pointCoordinate(new t.P(this.width,0)),M=this.pointCoordinate(new t.P(this.width,this.height)),A=this.pointCoordinate(new t.P(0,this.height)),V=Math.floor(Math.min(y.x,w.x,M.x,A.x)),H=Math.floor(Math.max(y.x,w.x,M.x,A.x)),K=1;for(let ee=V-K;ee<=H+K;ee++)ee!==0&&l.push(new t.bQ(ee,i))}return l}isLODDisabled(i){return(!i||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(i,l,y){let w=[];const M=y!==void 0,A=!M;if(A&&this.zoom<l||M&&y[0]===0&&y[1]===0)return w;const V=new Set,H=(ee,se,le,me,Ee)=>{const Se=t.c5(se,ee,le,me,Ee);V.has(Se)||(w.push(new t.aG(ee,se,le,me,Ee)),V.add(Se))};for(let ee=0;ee<i.length;ee++){const se=i[ee];if(A&&se.canonical.z!==l)continue;const le=se.canonical,me=se.overscaledZ,Ee=se.wrap,Se=1<<le.z,ke=le.x+1<Se,De=le.x>0,Xe=le.y+1<Se,ut=le.y>0,st=se.wrap-(De?0:1),wt=se.wrap+(ke?0:1),gt=De?le.x-1:Se-1,vt=ke?le.x+1:0;if(M)y[0]<0?(H(me,wt,le.z,vt,le.y),y[1]<0&&Xe&&(H(me,Ee,le.z,le.x,le.y+1),H(me,wt,le.z,vt,le.y+1)),y[1]>0&&ut&&(H(me,Ee,le.z,le.x,le.y-1),H(me,wt,le.z,vt,le.y-1))):y[0]>0?(H(me,st,le.z,gt,le.y),y[1]<0&&Xe&&(H(me,Ee,le.z,le.x,le.y+1),H(me,st,le.z,gt,le.y+1)),y[1]>0&&ut&&(H(me,Ee,le.z,le.x,le.y-1),H(me,st,le.z,gt,le.y-1))):y[1]<0&&Xe?H(me,Ee,le.z,le.x,le.y+1):ut&&H(me,Ee,le.z,le.x,le.y-1);else{const _t=se.visibleQuadrants;1&_t&&(H(me,st,le.z,gt,le.y),ut&&(H(me,Ee,le.z,le.x,le.y-1),H(me,st,le.z,gt,le.y-1))),2&_t&&(H(me,wt,le.z,vt,le.y),ut&&(H(me,Ee,le.z,le.x,le.y-1),H(me,wt,le.z,vt,le.y-1))),4&_t&&(H(me,st,le.z,gt,le.y),Xe&&(H(me,Ee,le.z,le.x,le.y+1),H(me,st,le.z,gt,le.y+1))),8&_t&&(H(me,wt,le.z,vt,le.y),Xe&&(H(me,Ee,le.z,le.x,le.y+1),H(me,wt,le.z,vt,le.y+1)))}}const K=[];for(const ee of w)w.some(se=>ee.isChildOf(se))||K.push(ee);if(w=K.filter(ee=>!i.some(se=>!!(ee.overscaledZ<l&&se.isChildOf(ee))||ee.equals(se)||ee.isChildOf(se))),A){const ee=1<<l,se=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),le=[ee*se.x,ee*se.y],me=4,Ee=me*me;w=w.filter(Se=>{const ke=Se.canonical.x+.5-le[0],De=Se.canonical.y+.5-le[1];return ke*ke+De*De<Ee})}return w}coveringTiles(i){let l=this.coveringZoomLevel(i);const y=l,w=this.elevation&&this.elevation.exaggeration(),M=w&&!i.isTerrainDEM,A=this.projection.name==="mercator";if(i.minzoom!==void 0&&l<i.minzoom)return[];i.maxzoom!==void 0&&l>i.maxzoom&&(l=i.maxzoom);const V=this.locationCoordinate(this.center),H=this.center.lat,K=1<<l,ee=[K*V.x,K*V.y,0],se=this.projection.name==="globe",le=!se,me=t.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,le),Ee=se?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Se=K*t.bH(1,this.center.lat),ke=this._camera.position[2]/t.bH(1,this.center.lat),De=[K*Ee.x,K*Ee.y,ke*(le?1:Se)],Xe=se||w,ut=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),st=this.isLODDisabled(!0)?l:0;let wt;if(this._elevation&&i.isTerrainDEM)wt=1e4*this._elevation.exaggeration();else if(this._elevation){const Qt=this._elevation.getMinMaxForVisibleTiles();wt=Qt?Qt.max:this._centerAltitude}else wt=this._centerAltitude;const gt=i.isTerrainDEM?-wt:this._elevation?this._elevation.getMinElevationBelowMSL():0,vt=this.projection.isReprojectedInTileSpace?t.bS(this):1,_t=Qt=>{const dn=new t.aa(Qt.x+25e-6,Qt.y,Qt.z),Jn=new t.aa(Qt.x,Qt.y+25e-6,Qt.z),Fn=Qt.toLngLat(),wn=dn.toLngLat(),Mi=Jn.toLngLat(),si=this.locationCoordinate(Fn),Ii=this.locationCoordinate(wn),Ai=this.locationCoordinate(Mi),ur=Math.hypot(Ii.x-si.x,Ii.y-si.y),Xi=Math.hypot(Ai.x-si.x,Ai.y-si.y);return Math.sqrt(ur*Xi)*vt/25e-6},Mt=Qt=>{const An=wt,dn=gt;return{aabb:t.bV(this,K,0,0,0,Qt,dn,An,this.projection),zoom:0,x:0,y:0,minZ:dn,maxZ:An,wrap:Qt,fullyVisible:!1}},Ft=[];let cn=[];const en=l,zt=i.reparseOverscaled?y:l,Ht=(ke-this._centerAltitude)*Se,En=Qt=>{if(!this._elevation||!Qt.tileID||!A)return;const An=this._elevation.getMinMaxForTile(Qt.tileID),dn=Qt.aabb;An?(dn.min[2]=An.min,dn.max[2]=An.max,dn.center[2]=(dn.min[2]+dn.max[2])/2):(Qt.shouldSplit=ti(Qt),Qt.shouldSplit||(dn.min[2]=dn.max[2]=dn.center[2]=this._centerAltitude))},Vn=(Qt,An)=>{if(.707*An<Qt)return 1;const dn=An/Qt;return dn/(1.4144271570014144+(Math.pow(1.1,dn-1.4144271570014144+1)-1)/(1.1-1)-1)},ti=Qt=>{if(Qt.zoom<st)return!0;if(Qt.zoom===en)return!1;if(Qt.shouldSplit!=null)return Qt.shouldSplit;const An=Qt.aabb.distanceX(De),dn=Qt.aabb.distanceY(De);let Jn=Ht,Fn=1;if(se){Jn=Qt.aabb.distanceZ(De);const Xi=Math.pow(2,Qt.zoom),er=t.aS((Qt.y+1)/Xi),dr=t.aS(Qt.y/Xi),Ur=Math.min(Math.max(H,er),dr),Mr=t.c9(Ur)/t.c9(H);if(Fn=Ur===H?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Mr/this._mercatorScaleRatio),this.zoom<=t.c6&&Qt.zoom===en-1&&Mr>=.9)return!0}else if(M&&(Jn=Qt.aabb.distanceZ(De)*Se),this.projection.isReprojectedInTileSpace&&y<=5){const Xi=Math.pow(2,Qt.zoom),er=_t(new t.aa((Qt.x+.5)/Xi,(Qt.y+.5)/Xi));Fn=er>.85?1:er}if(!A){const Xi=Math.sqrt(An*An+dn*dn+Jn*Jn);let er=(1<<en-Qt.zoom)*ut*Fn;return er*=Vn(Math.max(Jn,Ht),Xi),Xi<er}let wn=Number.MAX_VALUE,Mi=0;const si=Qt.aabb.getCorners(),Ii=[];for(const Xi of si){t.ab.vec3.sub(Ii,Xi,De),se||(M?Ii[2]*=Se:Ii[2]=Ht);const er=t.ab.vec3.dot(Ii,this._camera.forward());er<wn&&(wn=er,Mi=Math.abs(Ii[2]))}let Ai=(1<<en-Qt.zoom)*ut*Fn;if(Ai*=Vn(Math.max(Mi,Ht),wn),wn<Ai)return!0;const ur=Qt.aabb.closestPoint(ee);return ur[0]===ee[0]&&ur[1]===ee[1]};if(this.renderWorldCopies)for(let Qt=1;Qt<=3;Qt++)Ft.push(Mt(-Qt)),Ft.push(Mt(Qt));for(Ft.push(Mt(0));Ft.length>0;){const Qt=Ft.pop(),An=Qt.x,dn=Qt.y;let Jn=Qt.fullyVisible;const Fn=()=>this.projection.name==="globe"&&(Qt.y===0||Qt.y===(1<<Qt.zoom)-1);if(!Jn){let wn=Xe?Qt.aabb.intersects(me):Qt.aabb.intersectsFlat(me);if(wn===0&&Fn()){const Mi=new t.bT(Qt.zoom,An,dn);wn=t.bU(this,K,Mi,!0).intersects(me)}if(wn===0)continue;Jn=wn===2}if(Qt.zoom!==en&&ti(Qt))for(let wn=0;wn<4;wn++){const Mi=(An<<1)+wn%2,si=(dn<<1)+(wn>>1),Ii={aabb:A?Qt.aabb.quadrant(wn):t.bV(this,K,Qt.zoom+1,Mi,si,Qt.wrap,Qt.minZ,Qt.maxZ,this.projection),zoom:Qt.zoom+1,x:Mi,y:si,wrap:Qt.wrap,fullyVisible:Jn,tileID:void 0,shouldSplit:void 0,minZ:Qt.minZ,maxZ:Qt.maxZ};M&&!se&&(Ii.tileID=new t.aG(Qt.zoom+1===en?zt:Qt.zoom+1,Qt.wrap,Qt.zoom+1,Mi,si),En(Ii)),Ft.push(Ii)}else{const wn=Qt.zoom===en?zt:Qt.zoom;if(i.minzoom&&i.minzoom>wn)continue;let Mi=0;if(!Jn){let ur=Xe?Qt.aabb.intersectsPrecise(me):Qt.aabb.intersectsPreciseFlat(me);if(ur===0&&Fn()){const Xi=new t.bT(Qt.zoom,An,dn);ur=t.bU(this,K,Xi,!0).intersectsPrecise(me)}if(ur===0)continue;if(i.calculateQuadrantVisibility)if(me.containsPoint(Qt.aabb.center))Mi=15;else for(let Xi=0;Xi<4;Xi++)Qt.aabb.quadrant(Xi).intersects(me)!==0&&(Mi|=1<<Xi)}const si=ee[0]-(.5+An+(Qt.wrap<<Qt.zoom))*(1<<l-Qt.zoom),Ii=ee[1]-.5-dn,Ai=Qt.tileID?Qt.tileID:new t.aG(wn,Qt.wrap,Qt.zoom,An,dn);i.calculateQuadrantVisibility&&(Ai.visibleQuadrants=Mi),cn.push({tileID:Ai,distanceSq:si*si+Ii*Ii})}}if(this.fogCullDistSq){const Qt=this.fogCullDistSq,An=this.horizonLineFromTop();cn=cn.filter(dn=>{const Jn=[0,0,0,1],Fn=[t.ag,t.ag,0,1],wn=this.calculateFogTileMatrix(dn.tileID.toUnwrapped());t.ab.vec4.transformMat4(Jn,Jn,wn),t.ab.vec4.transformMat4(Fn,Fn,wn);const Mi=t.ab.vec4.min([],Jn,Fn),si=t.ab.vec4.max([],Jn,Fn),Ii=t.bW(Mi,si);if(Ii===0)return!0;let Ai=!1;const ur=this._elevation;if(ur&&Ii>Qt&&An!==0){const Xi=this.calculateProjMatrix(dn.tileID.toUnwrapped());let er;i.isTerrainDEM||(er=ur.getMinMaxForTile(dn.tileID)),er||(er={min:gt,max:wt});const dr=t.c7(this.rotation),Ur=[dr[0]*t.ag,dr[1]*t.ag,er.max];t.ab.vec3.transformMat4(Ur,Ur,Xi),Ai=(1-Ur[1])*this.height*.5<An}return Ii<Qt||Ai})}return cn.sort((Qt,An)=>Qt.distanceSq-An.distanceSq).map(Qt=>Qt.tileID)}resize(i,l){this.width=i,this.height=l,this.pixelsToGLUnits=[2/i,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const l=t.aw(i.lat,-t.bX,t.bX),y=this.projection.project(i.lng,l);return new t.P(y.x*this.worldSize,y.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/t.bH(1,this.center.lat)/this.worldSize}setLocationAtPoint(i,l){let y,w;const M=this.centerPoint;if(this.projection.name==="globe"){const V=this.worldSize;y=(l.x-M.x)/V,w=(l.y-M.y)/V}else{const V=this.pointCoordinate(l),H=this.pointCoordinate(M);y=V.x-H.x,w=V.y-H.y}const A=this.locationCoordinate(i);this.setLocation(new t.aa(A.x-y,A.y-w))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i){return this.projection.locationPoint(this,i)}locationPoint3D(i){return this.projection.locationPoint(this,i,!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i){return this.coordinateLocation(this.pointCoordinate3D(i))}locationCoordinate(i,l){const y=l?t.bH(l,i.lat):void 0,w=this.projection.project(i.lng,i.lat);return new t.aa(w.x,w.y,y)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,l){const y=l??this._centerAltitude,w=[i.x,i.y,0,1],M=[i.x,i.y,1,1];t.ab.vec4.transformMat4(w,w,this.pixelMatrixInverse),t.ab.vec4.transformMat4(M,M,this.pixelMatrixInverse);const A=M[3];t.ab.vec4.scale(w,w,1/w[3]),t.ab.vec4.scale(M,M,1/A);const V=w[2],H=M[2];return{p0:w,p1:M,t:V===H?0:(y-V)/(H-V)}}screenPointToMercatorRay(i){const l=[i.x,i.y,0,1],y=[i.x,i.y,1,1];return t.ab.vec4.transformMat4(l,l,this.pixelMatrixInverse),t.ab.vec4.transformMat4(y,y,this.pixelMatrixInverse),t.ab.vec4.scale(l,l,1/l[3]),t.ab.vec4.scale(y,y,1/y[3]),l[2]=t.bH(l[2],this._center.lat)*this.worldSize,y[2]=t.bH(y[2],this._center.lat)*this.worldSize,t.ab.vec4.scale(l,l,1/this.worldSize),t.ab.vec4.scale(y,y,1/this.worldSize),new t.aq([l[0],l[1],l[2]],t.ab.vec3.normalize([],t.ab.vec3.sub([],y,l)))}rayIntersectionCoordinate(i){const{p0:l,p1:y,t:w}=i,M=t.bH(l[2],this._center.lat),A=t.bH(y[2],this._center.lat);return new t.aa(t.af(l[0],y[0],w)/this.worldSize,t.af(l[1],y[1],w)/this.worldSize,t.af(M,A,w))}pointCoordinate(i,l=this._centerAltitude){return this.projection.pointCoordinate(this,i.x,i.y,l)}pointCoordinate3D(i){if(!this.elevation)return this.pointCoordinate(i);let l=this.projection.pointCoordinate3D(this,i.x,i.y);if(l)return new t.aa(l[0],l[1],l[2]);let y=0,w=this.horizonLineFromTop();if(i.y>w)return this.pointCoordinate(i);const M=.02*w,A=i.clone();for(let V=0;V<10&&w-y>M;V++){A.y=t.af(y,w,.66);const H=this.projection.pointCoordinate3D(this,A.x,A.y);H?(w=A.y,l=H):y=A.y}return l?new t.aa(l[0],l[1],l[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){return this.projection.isPointAboveHorizon(this,i)}isPointOnSurface(i){if(i.y<0||i.y>this.height||i.x<0||i.x>this.width)return!1;if(this.elevation||this.zoom>=t.bY)return!this.isPointAboveHorizon(i);const l=this.pointCoordinate(i);return l.y>=0&&l.y<=1}_coordinatePoint(i,l){const y=l&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,w=[i.x*this.worldSize,i.y*this.worldSize,y+i.toAltitude(),1];return t.ab.vec4.transformMat4(w,w,this.pixelMatrix),w[3]>0?new t.P(w[0]/w[3],w[1]/w[3]):new t.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:i,left:l}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,w=this.width-this._edgeInsets.right,M=this.pointLocation3D(new t.P(l,i)),A=this.pointLocation3D(new t.P(w,i)),V=this.pointLocation3D(new t.P(w,y)),H=this.pointLocation3D(new t.P(l,y));let K=Math.min(M.lng,A.lng,V.lng,H.lng),ee=Math.max(M.lng,A.lng,V.lng,H.lng),se=Math.min(M.lat,A.lat,V.lat,H.lat),le=Math.max(M.lat,A.lat,V.lat,H.lat);const me=Math.pow(2,-this.zoom)/16*270,Ee=this.projection.name==="globe"?1:4,Se=(ke,De,Xe,ut,st)=>{const wt=(ke+Xe)/2,gt=(De+ut)/2,vt=new t.P(wt,gt),{lng:_t,lat:Mt}=this.pointLocation3D(vt),Ft=Math.max(0,K-_t,se-Mt,_t-ee,Mt-le);K=Math.min(K,_t),ee=Math.max(ee,_t),se=Math.min(se,Mt),le=Math.max(le,Mt),(st<Ee||Ft>me)&&(Se(ke,De,wt,gt,st+1),Se(wt,gt,Xe,ut,st+1))};if(Se(l,i,w,i,1),Se(w,i,w,y,1),Se(w,y,l,y,1),Se(l,y,l,i,1),this.projection.name==="globe"){const[ke,De]=t.bZ(this);ke?(le=90,ee=180,K=-180):De&&(se=-90,ee=180,K=-180)}return new t.az(new t.bO(K,se),new t.bO(ee,le))}_getBoundsRectangular(i,l){const{top:y,left:w}=this._edgeInsets,M=this.height-this._edgeInsets.bottom,A=this.width-this._edgeInsets.right,V=new t.P(w,y),H=new t.P(A,y),K=new t.P(A,M),ee=new t.P(w,M);let se=this.pointCoordinate(V,i),le=this.pointCoordinate(H,i);const me=this.pointCoordinate(K,l),Ee=this.pointCoordinate(ee,l),Se=(ke,De)=>(De.y-ke.y)/(De.x-ke.x);return se.y>1&&le.y>=0?se=new t.aa((1-Ee.y)/Se(Ee,se)+Ee.x,1):se.y<0&&le.y<=1&&(se=new t.aa(-Ee.y/Se(Ee,se)+Ee.x,0)),le.y>1&&se.y>=0?le=new t.aa((1-me.y)/Se(me,le)+me.x,1):le.y<0&&se.y<=1&&(le=new t.aa(-me.y/Se(me,le)+me.x,0)),new t.az().extend(this.coordinateLocation(se)).extend(this.coordinateLocation(le)).extend(this.coordinateLocation(Ee)).extend(this.coordinateLocation(me))}_getBoundsRectangularTerrain(){const i=this.elevation;if(!i.visibleDemTiles.length||i.isUsingMockSource())return this._getBoundsRectangular(0,0);const l=i.visibleDemTiles.reduce((y,w)=>{if(w.dem){const M=w.dem.tree;y.min=Math.min(y.min,M.minimums[0]),y.max=Math.max(y.max,M.maximums[0])}return y},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(l.min*i.exaggeration(),l.max*i.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(i=!0){const l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,y=this.height/2-l*(1-this._horizonShift);return i?Math.max(0,y):y}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-t.bX,this.maxLat=t.bX,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=t.at(this.minLng)*this.tileSize,this.worldMaxX=t.at(this.maxLng)*this.tileSize,this.worldMinY=t.aA(this.maxLat)*this.tileSize,this.worldMaxY=t.aA(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,l){return this.projection.createTileMatrix(this,l,i)}calculateDistanceTileData(i){const l=i.key,y=this._distanceTileDataCache;if(y[l])return y[l];const w=i.canonical,M=1/this.height,A=this.cameraWorldSize,V=A/this.zoomScale(w.z),H=(w.x+Math.pow(2,w.z)*i.wrap)*V,K=w.y*V,ee=this.point;ee.x*=A/this.worldSize,ee.y*=A/this.worldSize;const se=this.angle,le=Math.sin(-se),me=-Math.cos(-se);return y[l]={bearing:[le,me],center:[(ee.x-H)*M,(ee.y-K)*M],scale:V/t.ag*M},y[l]}calculateFogTileMatrix(i){const l=i.key,y=this._fogTileMatrixCache;if(y[l])return y[l];const w=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,i);return t.ab.mat4.multiply(w,this.worldToFogMatrix,w),y[l]=new Float32Array(w),y[l]}calculateProjMatrix(i,l=!1,y=!1){const w=i.key;let M;if(M=y?this._expandedProjMatrixCache:l?this._alignedProjMatrixCache:this._projMatrixCache,M[w])return M[w];const A=this.calculatePosMatrix(i,this.worldSize);let V;return V=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:y?this.expandedFarZProjMatrix:l?this.alignedProjMatrix:this.projMatrix,t.ab.mat4.multiply(A,V,A),M[w]=new Float32Array(A),M[w]}calculatePixelsToTileUnitsMatrix(i){const l=i.tileID.key,y=this._pixelsToTileUnitsCache;if(y[l])return y[l];const w=t.b_(i,this);return y[l]=w,y[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const i=1/this.worldSize,l=t.ab.mat4.fromScaling([],[i,i,i]);return t.ab.mat4.multiply(l,l,this.globeMatrix),l}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const i=this._elevation;this._updateCameraState();const l=t.bH(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(l),w=this._camera.forward(),M=t.bH(1,this._center.lat);y[2]/=M,w[2]/=M,t.ab.vec3.normalize(w,w);const A=i.raycast(y,w,i.exaggeration());if(A){const V=t.ab.vec3.scaleAndAdd([],y,w,A),H=new t.aa(V[0],V[1],t.bH(V[2],t.aS(V[1]))),K=(H.z+t.ab.vec3.length([H.x-y[0],H.y-y[1],H.z-y[2]*M]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(K),this._centerAltitude=H.toAltitude(),this._center=this.coordinateLocation(H),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(i=!1){if(!this._elevation)return;const l=this._elevation,y=t.bH(1,this._center.lat)*this.worldSize,w=this._computeCameraPosition(y),M=l.getAtPointOrZero(new t.aa(...w)),A=this.pixelsPerMeter/this.worldSize*M,V=this._minimumHeightOverTerrain(),H=w[2]-A;if(H<=V)if(H<0||i){const K=this.locationCoordinate(this._center,this._centerAltitude),ee=[w[0],w[1],K.z-w[2]],se=t.ab.vec3.length(ee);ee[2]-=(V-H)/this._pixelsPerMercatorPixel;const le=t.ab.vec3.length(ee);if(le===0)return;t.ab.vec3.scale(ee,ee,se/le*this._pixelsPerMercatorPixel),this._camera.position=[w[0],w[1],K.z*this._pixelsPerMercatorPixel-ee[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const i=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||i){const le=this.center;return le.lat=t.aw(le.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!i)&&(le.lng=t.aw(le.lng,this.minLng,this.maxLng)),this.center=le,void(this._constraining=!1)}const l=this._unmodified,{x:y,y:w}=this.point;let M=0,A=y,V=w;const H=this.width/2,K=this.height/2,ee=this.worldMinY*this.scale,se=this.worldMaxY*this.scale;if(w-K<ee&&(V=ee+K),w+K>se&&(V=se-K),se-ee<this.height&&(M=Math.max(M,this.height/(se-ee)),V=(se+ee)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const le=this.worldMinX*this.scale,me=this.worldMaxX*this.scale,Ee=this.worldSize/2-(le+me)/2;A=(y+Ee+this.worldSize)%this.worldSize-Ee,A-H<le&&(A=le+H),A+H>me&&(A=me-H),me-le<this.width&&(M=Math.max(M,this.width/(me-le)),A=(me+le)/2)}A===y&&V===w||(this.center=this.unproject(new t.P(A,V))),M&&(this.zoom+=this.scaleZoom(M)),this._constrainCamera(),this._unmodified=l,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,l=this.projection.name==="globe",y=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=t.bH(1,this.center.lat)/t.bH(1,t.c8));const w=t.b$(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,w),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const M=this.projection.zAxisUnit==="meters"?y:1,A=this._camera.getWorldToCamera(this.worldSize,M);let V;const H=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(H[8]=2*-i.x/this.width,H[9]=2*i.y/this.height,this.isOrthographic){let Mt=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Ft=Mt*this.aspect,cn=-Ft,en=-Mt;Ft-=i.x,cn-=i.x,Mt+=i.y,en+=i.y,V=this._camera.getCameraToClipOrthographic(cn,Ft,en,Mt,this._nearZ,this._farZ),((zt,Ht,En,Vn)=>{for(let ti=0;ti<16;ti++)zt[ti]=sd(Ht[ti],En[ti],Vn)})(V,V,H,mi(this.pitch>=15?1:this.pitch/15))}else V=H;const K=t.ab.mat4.mul([],H,A);let ee=t.ab.mat4.mul([],V,A);if(this.projection.isReprojectedInTileSpace){const Mt=this.locationCoordinate(this.center),Ft=t.ab.mat4.identity([]);t.ab.mat4.translate(Ft,Ft,[Mt.x*this.worldSize,Mt.y*this.worldSize,0]),t.ab.mat4.multiply(Ft,Ft,t.c0(this)),t.ab.mat4.translate(Ft,Ft,[-Mt.x*this.worldSize,-Mt.y*this.worldSize,0]),t.ab.mat4.multiply(ee,ee,Ft),t.ab.mat4.multiply(K,K,Ft),this.inverseAdjustmentMatrix=t.c1(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=t.ab.mat4.scale([],ee,[this.worldSize,this.worldSize,this.worldSize/M,1]),this.projMatrix=ee,this.invProjMatrix=t.ab.mat4.invert(new Float64Array(16),this.projMatrix),l){const Mt=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Mt[8]=2*-i.x/this.width,Mt[9]=2*i.y/this.height,this.expandedFarZProjMatrix=t.ab.mat4.mul([],Mt,A)}else this.expandedFarZProjMatrix=this.projMatrix;const se=t.ab.mat4.invert([],V);this.frustumCorners=t.c2.fromInvProjectionMatrix(se,this.horizonLineFromTop(),this.height),this.cameraFrustum=t.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!l);const le=new Float32Array(16);t.ab.mat4.identity(le),t.ab.mat4.scale(le,le,[1,-1,1]),t.ab.mat4.rotateX(le,le,this._pitch),t.ab.mat4.rotateZ(le,le,this.angle);const me=t.ab.mat4.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=t.ab.mat4.clone(me);const Ee=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;me[8]=2*-i.x/this.width,me[9]=2*(i.y+Ee)/this.height,this.skyboxMatrix=t.ab.mat4.multiply(le,me,le);const Se=this.point,ke=Se.x,De=Se.y,Xe=this.width%2/2,ut=this.height%2/2,st=Math.cos(this.angle),wt=Math.sin(this.angle),gt=ke-Math.round(ke)+st*Xe+wt*ut,vt=De-Math.round(De)+st*ut+wt*Xe,_t=new Float64Array(ee);if(t.ab.mat4.translate(_t,_t,[gt>.5?gt-1:gt,vt>.5?vt-1:vt,0]),this.alignedProjMatrix=_t,ee=t.ab.mat4.create(),t.ab.mat4.scale(ee,ee,[this.width/2,-this.height/2,1]),t.ab.mat4.translate(ee,ee,[1,-1,0]),this.labelPlaneMatrix=ee,ee=t.ab.mat4.create(),t.ab.mat4.scale(ee,ee,[1,-1,1]),t.ab.mat4.translate(ee,ee,[-1,-1,0]),t.ab.mat4.scale(ee,ee,[2/this.width,2/this.height,1]),this.glCoordMatrix=ee,this.pixelMatrix=t.ab.mat4.multiply(new Float64Array(16),this.labelPlaneMatrix,K),this._calcFogMatrices(),this._distanceTileDataCache={},ee=t.ab.mat4.invert(new Float64Array(16),this.pixelMatrix),!ee)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=ee,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=t.c3(this);const Mt=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=t.ab.vec3.transformMat4(Mt,Mt,A),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=ee;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const i=this.cameraWorldSizeForFog,l=this.cameraPixelsPerMeter,y=this._camera.position,w=1/this.height/this._pixelsPerMercatorPixel,M=[i,i,l];t.ab.vec3.scale(M,M,w),t.ab.vec3.scale(y,y,-1),t.ab.vec3.multiply(y,y,M);const A=t.ab.mat4.create();t.ab.mat4.translate(A,A,y),t.ab.mat4.scale(A,A,M),this.mercatorFogMatrix=A,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,l,w)}_computeCameraPosition(i){const l=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,y=this._camera.forward(),w=this.point,M=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*l-i/this.worldSize*this._centerAltitude;return[w.x/this.worldSize-y[0]*M,w.y/this.worldSize-y[1]*M,i/this.worldSize*this._centerAltitude-y[2]*M]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){const l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),y=this._camera.position[2],w=i[2];let M=1;this.projection.wrap&&(this.center=this.center.wrap()),w>0&&(M=Math.min((l-y)/w,1)),this._camera.position=t.ab.vec3.scaleAndAdd([],this._camera.position,i,M),this._updateStateFromCamera()}_updateStateFromCamera(){const i=this._camera.position,l=this._camera.forward(),{pitch:y,bearing:w}=this._camera.getPitchBearing(),M=t.bH(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,A=this._mercatorZfromZoom(this._maxZoom)*Math.cos(t.ai(this._maxPitch)),V=Math.max((i[2]-M)/Math.cos(y),A),H=this._zoomFromMercatorZ(V);t.ab.vec3.scaleAndAdd(i,i,l,V),this._pitch=t.aw(y,t.ai(this.minPitch),t.ai(this.maxPitch)),this.angle=t.bF(w,-Math.PI,Math.PI),this._setZoom(t.aw(H,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new t.aa(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){const i=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(i*this.tileSize))}zoomFromMercatorZAdjusted(i){let l=0,y=t.bY,w=0,M=1/0;for(;y-l>1e-6&&y>l;){const A=l+.5*(y-l),V=this.tileSize*Math.pow(2,A),H=this.getCameraToCenterDistance(this.projection,A,V),K=this.scaleZoom(H/(i*this.tileSize)),ee=Math.abs(A-K);ee<M&&(M=ee,w=A),A<K?l=A:y=A}return w}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(t.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(i,l){const y=Math.min(i.x,l.x),w=Math.max(i.x,l.x),M=Math.min(i.y,l.y),A=Math.max(i.y,l.y);if(M<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const V=[new t.P(y,M),new t.P(w,A),new t.P(y,A),new t.P(w,M)],H=this.renderWorldCopies?-3:0,K=this.renderWorldCopies?4:1;for(const ee of V){const se=this.pointRayIntersection(ee);if(se.t<0)return!0;const le=this.rayIntersectionCoordinate(se);if(le.x<H||le.y<0||le.x>K||le.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+t.c4(this.fovAboveCenter)>88||this.anyCornerOffEdge(new t.P(0,0),new t.P(this.width,this.height))}zoomDeltaToMovement(i,l){const y=t.ab.vec3.length(t.ab.vec3.sub([],this._camera.position,i)),w=this._zoomFromMercatorZ(y)+l;return y-this._mercatorZfromZoom(w)}getCameraPoint(){if(this.projection.name==="globe"){const i=function([l,y,w],M){const A=[l,y,w,1];t.ab.vec4.transformMat4(A,A,M);const V=A[3]=Math.max(A[3],1e-6);return A[0]/=V,A[1]/=V,A[2]/=V,A}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new t.P(i[0],i[1])}{const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.P(0,i))}}getCameraToCenterDistance(i,l=this.zoom,y=this.worldSize){const w=t.b$(i,l,this.width,this.height,1024),M=i.pixelSpaceConversion(this.center.lat,y,w);let A=.5/Math.tan(.5*this._fov)*this.height*M;return this.isOrthographic&&(A=sd(1,A,mi(this.pitch>=15?1:this.pitch/15))),A}getWorldToCameraMatrix(){const i=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&t.ab.mat4.multiply(i,i,this.globeMatrix),i}getFrustum(i){return t.bR.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,this.projection.zAxisUnit==="meters")}}const Oc=(_,i)=>{if(i>0&&_.terrain&&t.w("Cutoff is currently disabled on terrain"),i<=0||_.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const l=_.transform,y=Math.max(Math.abs(l._zoom-(_.minCutoffZoom-1)),1),w=l.isLODDisabled(!1)?t.ac(60,45,l.pitch):t.ac(30,15,l.pitch),M=l._farZ-l._nearZ,A=i*l.height,V=((1-(H=w))*l.cameraToCenterDistance+H*(l._farZ+A))*y;var H;return{shouldRenderCutoff:w<1,uniformValues:{u_cutoff_params:[l._nearZ,l._farZ,(V-l._nearZ)/M,(V-A-l._nearZ)/M]}}},Zs={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Gu{constructor(i,l){this.aabb=i,this.lastCascade=l}}class od{add(i,l){const y=this.receivers[i.key];y!==void 0?(y.aabb.min[0]=Math.min(y.aabb.min[0],l.min[0]),y.aabb.min[1]=Math.min(y.aabb.min[1],l.min[1]),y.aabb.min[2]=Math.min(y.aabb.min[2],l.min[2]),y.aabb.max[0]=Math.max(y.aabb.max[0],l.max[0]),y.aabb.max[1]=Math.max(y.aabb.max[1],l.max[1]),y.aabb.max[2]=Math.max(y.aabb.max[2],l.max[2])):this.receivers[i.key]=new Gu(l,null)}clear(){this.receivers={}}get(i){return this.receivers[i.key]}computeRequiredCascades(i,l,y){const w=t.cd.fromPoints(i.points);let M=0;for(const A in this.receivers){const V=this.receivers[A];if(!V||!w.intersectsAabb(V.aabb))continue;V.aabb.min=w.closestPoint(V.aabb.min),V.aabb.max=w.closestPoint(V.aabb.max);const H=V.aabb.getCorners();for(let K=0;K<y.length;K++){let ee=!0;for(const se of H){const le=[se[0]*l,se[1]*l,se[2]];if(t.ab.vec3.transformMat4(le,le,y[K].matrix),le[0]<-1||le[0]>1||le[1]<-1||le[1]>1){ee=!1;break}}if(V.lastCascade=K,M=Math.max(M,K),ee)break}}return M+1}}class oa{constructor(i){this.painter=i,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new od,this._depthMode=new Zi(i.context.gl.LEQUAL,Zi.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,i.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),i.tp.registerParameter(Zs,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),i.tp.registerParameter(Zs,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),i.tp.registerParameter(Zs,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),i.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const i of this._cascades)i.texture.destroy(),i.framebuffer.destroy();this._cascades=[]}updateShadowParameters(i,l){const y=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!l||!l.properties)return;const w=l.properties.get("shadow-intensity");if(!l.shadowsEnabled()||w<=0||(this._shadowLayerCount=y.style.order.reduce((Ee,Se)=>{const ke=y.style._mergedLayers[Se];return Ee+(ke.hasShadowPass()&&!ke.isHidden(i.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const M=y.context,A=Zs.shadowMapResolution,V=Zs.shadowMapResolution;if(this._cascades.length===0||Zs.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let Ee=0;Ee<Zs.cascadeCount;++Ee){const Se=y._shadowMapDebug,ke=M.gl,De=M.createFramebuffer(A,V,Se,"texture"),Xe=new t.T(M,{width:A,height:V,data:null},ke.DEPTH_COMPONENT16);if(De.depthAttachment.set(Xe.texture),Se){const ut=new t.T(M,{width:A,height:V,data:null},ke.RGBA8);De.colorAttachment.set(ut.texture)}this._cascades.push({framebuffer:De,texture:Xe,matrix:[],far:0,boundingSphereRadius:0,frustum:new t.bR,scale:0})}}this.shadowDirection=qu(l);let H=0;if(i.elevation){const Ee=i.elevation,Se=[1e4,-1e4];Ee.visibleDemTiles.filter(ke=>ke.dem).forEach(ke=>{const De=ke.dem.tree;Se[0]=Math.min(Se[0],De.minimums[0]),Se[1]=Math.max(Se[1],De.maximums[0])}),Se[0]!==1e4&&(H=(Se[1]-Se[0])*Ee.exaggeration())}const K=1.5*i.cameraToCenterDistance,ee=3*K,se=new Float64Array(16);for(let Ee=0;Ee<this._cascades.length;++Ee){const Se=this._cascades[Ee];let ke=i.height/50,De=1;Zs.cascadeCount===1?De=ee:Ee===0?De=K:(ke=K,De=ee);const[Xe,ut]=Sh(i,this.shadowDirection,ke,De,Zs.shadowMapResolution,H);Se.scale=i.scale,Se.matrix=Xe,Se.boundingSphereRadius=ut,t.ab.mat4.invert(se,Se.matrix),Se.frustum=t.bR.fromInvProjectionMatrix(se,1,0,!0),Se.far=De}const le=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[le].far,this._cascades[le].far],this._uniformValues.u_shadow_intensity=w,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Zs.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Zs.shadowMapResolution,this._uniformValues.u_shadowmap_0=Ds.ShadowMap0,this._uniformValues.u_shadowmap_1=Ds.ShadowMap0+1,this._groundShadowTiles=y.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const me=y.transform.elevation;for(const Ee of this._groundShadowTiles){let Se={min:0,max:0};if(me){const ke=me.getMinMaxForTile(Ee);ke&&(Se=ke)}this.addShadowReceiver(Ee.toUnwrapped(),Se.min,Se.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(i){this._enabled=i}drawShadowPass(i,l){if(!this.enabled)return;const y=this.painter,w=y.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(y.transform.getFrustum(0),y.transform.worldSize,this._cascades),w.viewport.set([0,0,Zs.shadowMapResolution,Zs.shadowMapResolution]);for(let M=0;M<this._numCascadesToRender;++M){y.currentShadowCascade=M,w.bindFramebuffer.set(this._cascades[M].framebuffer.framebuffer),w.clear({color:t.aj.white,depth:1});for(const A of i.order){const V=i._mergedLayers[A];if(!V.hasShadowPass()||V.isHidden(y.transform.zoom))continue;const H=i.getLayerSourceCache(V),K=H?l[H.id]:void 0;(V.type==="model"||K&&K.length)&&y.renderLayer(y,H,V,K)}}y.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const i=this.painter,l=i.style,y=i.context,w=l.directionalLight,M=l.ambientLight;if(!w||!M)return;const A=[],V=Oc(i,i.longestCutoffRange);V.shouldRenderCutoff&&A.push("RENDER_CUTOFF"),A.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&A.push("NORMAL_OFFSET");const H=cd(l,w,M),K=new Zi(y.gl.LEQUAL,Zi.ReadOnly,i.depthRangeFor3D);for(const ee of this._groundShadowTiles){const se=ee.toUnwrapped(),le=i.isTileAffectedByFog(ee),me=i.getOrCreateProgram("groundShadow",{defines:A,overrideFog:le});this.setupShadows(se,me),i.uploadCommonUniforms(y,me,se,null,V);const Ee={u_matrix:i.transform.calculateProjMatrix(se),u_ground_shadow_factor:H};me.draw(i,y.gl.TRIANGLES,K,lr.disabled,Tr.multiply,or.disabled,Ee,"ground_shadow",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments,{},i.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Tr.unblended:Tr.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(i){const l=this.painter.transform,y=l.calculatePosMatrix(i,l.worldSize);return t.ab.mat4.multiply(y,this._cascades[this.painter.currentShadowCascade].matrix,y),Float32Array.from(y)}calculateShadowPassMatrixFromMatrix(i){return t.ab.mat4.multiply(i,this._cascades[this.painter.currentShadowCascade].matrix,i),Float32Array.from(i)}setupShadows(i,l,y,w=0){if(!this.enabled)return;const M=this.painter.transform,A=this.painter.context,V=A.gl,H=this._uniformValues,K=new Float64Array(16),ee=M.calculatePosMatrix(i,M.worldSize);for(let se=0;se<this._cascades.length;se++)t.ab.mat4.multiply(K,this._cascades[se].matrix,ee),H[se===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(K),A.activeTexture.set(V.TEXTURE0+Ds.ShadowMap0+se),this._cascades[se].texture.bind(V.NEAREST,V.CLAMP_TO_EDGE);if(this.useNormalOffset=!!y,this.useNormalOffset){const se=t.cc(i.canonical),le=2/M.tileSize*t.ag/Zs.shadowMapResolution,me=le*this._cascades[0].boundingSphereRadius,Ee=le*this._cascades[this._cascades.length-1].boundingSphereRadius,Se=(y==="vector-tile"?1:3)/Math.pow(2,w-i.canonical.z-(1-M.zoom+Math.floor(M.zoom)));H.u_shadow_normal_offset=[se,me*Se,Ee*Se],H.u_shadow_bias=[6e-5,.0012,.012]}else H.u_shadow_bias=[36e-5,.0012,.012];l.setShadowUniformValues(A,H)}setupShadowsFromMatrix(i,l,y=!1){if(!this.enabled)return;const w=this.painter.context,M=w.gl,A=this._uniformValues,V=new Float64Array(16);for(let H=0;H<Zs.cascadeCount;H++)t.ab.mat4.multiply(V,this._cascades[H].matrix,i),A[H===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(V),w.activeTexture.set(M.TEXTURE0+Ds.ShadowMap0+H),this._cascades[H].texture.bind(M.NEAREST,M.CLAMP_TO_EDGE);if(this.useNormalOffset=y,y){const H=Zs.normalOffset;A.u_shadow_normal_offset=[1,H,H],A.u_shadow_bias=[6e-5,.0012,.012]}else A.u_shadow_bias=[36e-5,.0012,.012];l.setShadowUniformValues(w,A)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(i,l,y,w){if(w[2]>=0)return{};const M=function(H,K,ee){const se=ee/(1<<H.canonical.z);return new t.cd([H.canonical.x*se+H.wrap*ee,H.canonical.y*se+H.wrap*ee,0],[(H.canonical.x+1)*se+H.wrap*ee,(H.canonical.y+1)*se+H.wrap*ee,K])}(i,l,y).getCorners(),A=l/-w[2];w[0]<0?(t.ab.vec3.add(M[0],M[0],[w[0]*A,0,0]),t.ab.vec3.add(M[3],M[3],[w[0]*A,0,0])):w[0]>0&&(t.ab.vec3.add(M[1],M[1],[w[0]*A,0,0]),t.ab.vec3.add(M[2],M[2],[w[0]*A,0,0])),w[1]<0?(t.ab.vec3.add(M[0],M[0],[0,w[1]*A,0]),t.ab.vec3.add(M[1],M[1],[0,w[1]*A,0])):w[1]>0&&(t.ab.vec3.add(M[2],M[2],[0,w[1]*A,0]),t.ab.vec3.add(M[3],M[3],[0,w[1]*A,0]));const V={};return V.vertices=M,V.planes=[ld(M[1],M[0],M[4]),ld(M[2],M[1],M[5]),ld(M[3],M[2],M[6]),ld(M[0],M[3],M[7])],V}addShadowReceiver(i,l,y){this._receivers.add(i,t.cd.fromTileIdAndHeight(i,l,y))}getMaxCascadeForTile(i){const l=this._receivers.get(i);return l&&l.lastCascade?l.lastCascade:0}}function ld(_,i,l){const y=t.ab.vec3.sub([],l,i),w=t.ab.vec3.sub([],_,i),M=t.ab.vec3.cross([],y,w),A=t.ab.vec3.length(M);return A===0?[0,0,1,0]:(t.ab.vec3.scale(M,M,1/A),[M[0],M[1],M[2],-t.ab.vec3.dot(M,i)])}function qu(_){const i=_.properties.get("direction"),l=t.cb(i.x,i.y,i.z);l[2]=t.aw(l[2],0,75);const y=t.ce([l[0],l[1],l[2]]);return t.ab.vec3.fromValues(y.x,y.y,y.z)}function cd(_,i,l){const y=i.properties.get("color-use-theme")==="none",w=i.properties.get("color"),M=i.properties.get("intensity"),A=i.properties.get("direction"),V=[A.x,A.y,A.z],H=l.properties.get("color-use-theme")==="none",K=l.properties.get("color"),ee=l.properties.get("intensity"),se=Math.max(t.ab.vec3.dot([0,0,1],V),0),le=[0,0,0];t.ab.vec3.scale(le,K.toRenderColor(H?null:_.getLut(i.scope)).toArray01Linear().slice(0,3),ee);const me=[0,0,0];return t.ab.vec3.scale(me,w.toRenderColor(y?null:_.getLut(l.scope)).toArray01Linear().slice(0,3),se*M),t.cf([le[0]>0?le[0]/(le[0]+me[0]):0,le[1]>0?le[1]/(le[1]+me[1]):0,le[2]>0?le[2]/(le[2]+me[2]):0])}function Sh(_,i,l,y,w,M){const A=_.zoom,V=_.scale,H=_.worldSize,K=1/H,ee=_.aspect,se=Math.sqrt(1+ee*ee)*Math.tan(.5*_.fovX),le=se*se,me=y-l,Ee=y+l;let Se,ke;le>me/Ee?(Se=y,ke=y*se):(Se=.5*Ee*(1+le),ke=.5*Math.sqrt(me*me+2*(y*y+l*l)*le+Ee*Ee*le*le));const De=_.projection.pixelsPerMeter(_.center.lat,H),Xe=_._camera.getCameraToWorldMercator(),ut=[0,0,-Se*K];t.ab.vec3.transformMat4(ut,ut,Xe);let st=ke*K;const wt=_._edgeInsets;if(!(wt.left===0&&wt.top===0&&wt.right===0&&wt.bottom===0||wt.left===wt.right&&wt.top===wt.bottom)){const Jn=_._camera.getWorldToCamera(_.worldSize,_.projection.zAxisUnit==="meters"?De:1),Fn=_._camera.getCameraToClipPerspective(_._fov,_.width/_.height,l,y);Fn[8]=2*-_.centerOffset.x/_.width,Fn[9]=2*_.centerOffset.y/_.height;const wn=new Float64Array(16);t.ab.mat4.mul(wn,Fn,Jn);const Mi=new Float64Array(16);t.ab.mat4.invert(Mi,wn);const si=t.bR.fromInvProjectionMatrix(Mi,H,A,!0);for(const Ii of si.points){const Ai=((gt=Ii)[0]/=V,gt[1]/=V,gt[2]=t.bH(gt[2],_._center.lat),gt);st=Math.max(st,t.ab.vec3.len(t.ab.vec3.subtract([],ut,Ai)))}}var gt;st*=w/(w-1);const vt=Math.acos(i[2]),_t=Math.atan2(-i[0],-i[1]),Mt=new bh;Mt.position=ut,Mt.setPitchBearing(vt,_t);const Ft=Mt.getWorldToCamera(H,De),cn=st*H,en=Math.min(_._mercatorZfromZoom(17)*H*-2,-2*cn),zt=Mt.getCameraToClipOrthographic(-cn,cn,-cn,cn,en,(cn+M*De)/i[2]),Ht=new Float64Array(16);t.ab.mat4.multiply(Ht,zt,Ft);const En=t.ab.vec3.fromValues(Math.floor(1e6*ut[0])/1e6*H,Math.floor(1e6*ut[1])/1e6*H,0),Vn=.5*w,ti=[0,0,0];t.ab.vec3.transformMat4(ti,En,Ht),t.ab.vec3.scale(ti,ti,Vn);const Qt=[Math.floor(ti[0]),Math.floor(ti[1]),Math.floor(ti[2])],An=[0,0,0];t.ab.vec3.sub(An,ti,Qt),t.ab.vec3.scale(An,An,-1/Vn);const dn=new Float64Array(16);return t.ab.mat4.identity(dn),t.ab.mat4.translate(dn,dn,An),t.ab.mat4.multiply(Ht,dn,Ht),[Ht,cn]}class Ng extends t.E{constructor(i){super(),this.requestManager=i,this.models={"":{}},this.numModelsLoading={}}loadModel(i,l){return t.aM(this.requestManager.transformRequest(l,t.R.Model).url).then(y=>{if(!y)return;const w=t.aN(y),M=new t.aO(i,void 0,void 0,w);return M.computeBoundsAndApplyParent(),M}).catch(y=>{if(y&&y.status===404)return null;this.fire(new t.y(new Error(`Could not load model ${i} from ${l}: ${y.message}`)))})}load(i,l){this.models[l]||(this.models[l]={});const y=Object.keys(i);this.numModelsLoading[l]=(this.numModelsLoading[l]||0)+y.length;const w=[];for(const M of y)w.push(this.loadModel(M,i[M]));Promise.allSettled(w).then(M=>{for(let A=0;A<M.length;A++){const{status:V,value:H}=M[A];V==="fulfilled"&&H&&(this.models[l][y[A]]={model:H,numReferences:1})}this.numModelsLoading[l]-=y.length,this.fire(new t.z("data",{dataType:"style"}))}).catch(M=>{this.fire(new t.y(new Error(`Could not load models: ${M.message}`)))})}isLoaded(){for(const i in this.numModelsLoading)if(this.numModelsLoading[i]>0)return!1;return!0}hasModel(i,l){return!!this.getModel(i,l)}getModel(i,l){return this.models[l]||(this.models[l]={}),this.models[l][i]?this.models[l][i].model:void 0}addModel(i,l,y){this.models[y]||(this.models[y]={}),this.hasModel(i,y)&&this.models[y][i].numReferences++,this.load({[i]:this.requestManager.normalizeModelURL(l)},y)}addModels(i,l){this.models[l]||(this.models[l]={});const y={};for(const w in i)this.models[l][w]={},y[w]=this.requestManager.normalizeModelURL(i[w]);this.load(y,l)}addModelsFromBucket(i,l){this.models[l]||(this.models[l]={});const y={};for(const w of i)this.hasModel(w,l)?this.models[l][w].numReferences++:y[w]=this.requestManager.normalizeModelURL(w);this.load(y,l)}removeModel(i,l){if(this.models[l]&&this.models[l][i]&&(this.models[l][i].numReferences--,this.models[l][i].numReferences===0)){const y=this.models[l][i].model;delete this.models[l][i],y.destroy()}}listModels(i){return this.models[i]||(this.models[i]={}),Object.keys(this.models[i])}upload(i,l){this.models[l]||(this.models[l]={});for(const y in this.models[l])this.models[l][y].model&&this.models[l][y].model.upload(i.context)}}const Um=new t.a5({data:new t.a6(t.a3.colorTheme.data)}),ud={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function Yd(_){return _=_||{},Object.assign(_,ud)}class Kd extends t.E{constructor(i){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._selectedLevel=void 0,this._floorplanStates={},t.aP(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=i,this._checkFloorplanVisible(!0),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(i=>{i.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new t.y(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=i.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=i.stylesheet.indoor.buildingFeaturesetId,this._scope=i.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:i=>(i.feature&&i.feature.properties.floorplan&&this.selectFloorplan(i.feature.properties.floorplan),!0)}),this._checkFloorplanVisible(!0)}_onMove(){this._checkFloorplanVisible(!1)}_checkFloorplanVisible(i){if(!this._queryFeatureSetId||!this._map.isStyleLoaded()||this._map.transform.zoom<13)return;this._indoorData&&!function(A,V){const[H,K]=A,{center:ee,radius:se}=V,[le,me]=ee,Ee=Math.abs(H-le);return Math.sqrt((Ee>180?360-Ee:Ee)**2+(K-me)**2)<=se}([this._map.getCenter().lng,this._map.getCenter().lat],this._indoorData.circumCircle)&&(this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new t.z("floorplangone")));const l={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},y=new t.P(this._map.transform.width/2,this._map.transform.height/2),w=[new t.P(0,0),new t.P(this._map.transform.width,this._map.transform.height)],M=this._map.queryRenderedFeatures(i?w:y,l);M.length>0&&(this._selectedFloorplan&&M[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=M[0],this._floorplanSelected(!1)))}_floorplanSelected(i){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._indoorData.circumCircle=function(M){const[[A,V],[H,K]]=M,ee=(H-A+360)%360,se=ee>180?360-ee:ee;return{center:[(A+se/2+360)%360,(V+K)/2],radius:Math.sqrt(se**2+(K-V)**2)/2}}(this._indoorData.extent),this._floorplanStates[this._indoorData.id]||(this._floorplanStates[this._indoorData.id]={});const l=this._floorplanStates[this._indoorData.id].selectedBuilding,y=this._floorplanStates[this._indoorData.id].selectedLevel;let w;if(this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",this._indoorData.floorplanIDs),this._selectedLevel)for(const M of this._indoorData.levels)M.id===this._selectedLevel.id&&(w=M.id);if(this.fire(new t.z("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:w})),l){const M=this._indoorData.buildings.find(A=>A.id===l);this._buildingSelected(M,!1)}else this._indoorData.buildings.length>0&&this._buildingSelected(this._indoorData.buildings[0],!1);if(y){const M=this._indoorData.levels.find(A=>A.id===y);this._updateLevels(M,i)}else i&&this._indoorData["default-levels"].length>0&&this.selectLevel(this._indoorData["default-levels"][0])}_buildingSelected(i,l){l&&i&&i.extent&&this._map.fitBounds(i.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=i?i.id:void 0;const y=this._indoorData.levels.filter(w=>i.levels.includes(w.id));this.fire(new t.z("buildingselected",{buildingId:i.id,levels:y}))}_levelSelected(i){if(i==="overview")this._updateLevels(void 0,!0);else{const l=this._indoorData.levels.find(y=>y.id===i);this._updateLevels(l,!0)}this.fire(new t.z("levelselected",{levelId:i==="overview"?void 0:i}))}_updateLevels(i,l){if(!i)return this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",[]]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._floorplanStates[this._indoorData.id].selectedLevel=void 0,void(l&&this._indoorData.extent&&this._map.fitBounds(this._indoorData.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}));function y(K){const ee=K.indexOf("/floor/");if(ee===-1)return K;const se=ee+7,le=K.indexOf("/",se);return le===-1?K.slice(se):K.slice(se,le)}this._selectedLevel=i,this._floorplanStates[this._indoorData.id].selectedLevel=i?i.id:void 0;const w=[],M={},A={},V={},H={};for(const K of this._indoorData.levels)if(w.push(K.id),M[K.id]=K.height,A[K.id]=K.base,i){if(this.mergeFloors){const ee=y(i.id),se=y(K.id);V[K.id]=se===ee?"true":"false"}else V[K.id]=K.id===i.id?"true":"false";H[K.id]=K.base<i.base?"true":"false"}else H[K.id]=!0;if(this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",w]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",M]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",A]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",V]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",H]),i&&(this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!!i.isUnderground),l&&i.extent)){const K=this._map.cameraForBounds(i.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),ee=this._map.getZoom(),se=K.zoom?Math.abs(ee-K.zoom):0;this._map.fitBounds(i.extent,se>=1?{pitch:this._map.getPitch(),bearing:this._map.getBearing()}:{pitch:this._map.getPitch(),bearing:this._map.getBearing(),zoom:ee})}}selectFloorplan(i){const l={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},y=[new t.P(0,0),new t.P(this._map.transform.width,this._map.transform.height)],w=this._map.queryRenderedFeatures(y,l);if(w.length>0){for(const M of w)if(JSON.parse(M.properties["indoor-data"]).floorplanIDs.includes(i)){this._selectedFloorplan=M,this._floorplanSelected(!0);break}}}selectBuilding(i){const l=this._indoorData.buildings.find(y=>y.id===i);this._buildingSelected(l,!0)}selectLevel(i){this._levelSelected(i)}}function Yf(_){if(!_.metadata||!_.metadata.content_area)return;const i=t.q.devicePixelRatio,{left:l,top:y,width:w,height:M}=_.metadata.content_area,A=l*i,V=y*i;return[A,V,A+w*i,V+M*i]}function Fc(_){if(_)return _.map(([i,l])=>[i*t.q.devicePixelRatio,l*t.q.devicePixelRatio])}const Kl=(_,i)=>Dt(_,i&&i.filter(l=>l.identifier!=="source.canvas")),Jl=t.ay(Dr,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport"]),$m=t.ay(Dr,["setCenter","setZoom","setBearing","setPitch"]),Kf=new Set(["background","sky","slot","custom"]),Jd={version:8,layers:[],sources:{}},Hu={duration:300,delay:0};class Do extends t.E{constructor(i,l={}){super(),this.map=i,this.scope=l.scope||"",this.globalId=null,this.fragments=[],this.importDepth=l.importDepth||0,this.importsCache=l.importsCache||new Map,this.resolvedImports=l.resolvedImports||new Set,this.transition=t.l({},Hu),this._buildingIndex=new os(this),this.crossTileSymbolIndex=new Xf,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=l.styleChanges||new mt,this.dispatcher=l.dispatcher?l.dispatcher:new t.D(t.ci(),this),l.imageManager?this.imageManager=l.imageManager:(this.imageManager=new Tn(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=l.glyphManager?l.glyphManager:new t.cj(i._requestManager,l.localFontFamily?t.ck.all:l.localIdeographFontFamily?t.ck.ideographs:t.ck.none,l.localFontFamily||l.localIdeographFontFamily),l.modelManager?this.modelManager=l.modelManager:(this.modelManager=new Ng(i._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=l.configOptions?l.configOptions:new Map,this._configDependentLayers=l.configDependentLayers?l.configDependentLayers:new Set,this._config=l.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:l.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=l.initialConfig,this.dispatcher.broadcast("setReferrer",t.cl());const y=this;this._rtlTextPluginCallback=Do.registerForPluginStateChange(w=>{y.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:w.pluginStatus,pluginURL:w.pluginURL},(M,A)=>{if(t.cm(M),A&&A.every(V=>V))for(const V in y._sourceCaches){const H=y._sourceCaches[V],K=H.getSource().type;K!=="vector"&&K!=="geojson"||H.reload()}})}),this.on("data",w=>{if(w.dataType!=="source"||w.sourceDataType!=="metadata")return;const M=this.getOwnSource(w.sourceId);if(M&&M.vectorLayerIds)for(const A in this._layers){const V=this._layers[A];V.source===M.id&&this._validateLayer(V)}})}load(i){return i?(typeof i=="string"?this.loadURL(i):this.loadJSON(i),this):this}_getGlobalId(i){if(!i)return null;if(typeof i=="string"){if(t.f(i))return i;const l=t.cn(i);if(!l.startsWith("http"))try{return new URL(l,location.href).toString()}catch{return l}return l}return`json://${t.co(JSON.stringify(i))}`}_diffStyle(i,l,y){this.globalId=this._getGlobalId(i);const w=(M,A)=>{try{A(null,this.setState(M,y))}catch(V){A(V,!1)}};if(typeof i=="string"){const M=this.map._requestManager.normalizeStyleURL(i),A=this.map._requestManager.transformRequest(M,t.R.Style);t.n(A,(V,H)=>{V?this.fire(new t.y(V)):H&&w(H,l)})}else typeof i=="object"&&w(i,l)}loadURL(i,l={}){this.fire(new t.z("dataloading",{dataType:"style"}));const y=typeof l.validate=="boolean"?l.validate:!t.f(i);this.globalId=this._getGlobalId(i),i=this.map._requestManager.normalizeStyleURL(i,l.accessToken),this.resolvedImports.add(i);const w=this.importsCache.get(i);if(w)return this._load(w,y);const M=this.map._requestManager.transformRequest(i,t.R.Style);this._request=t.n(M,(A,V)=>{if(this._request=null,A)this.fire(new t.y(A));else if(V)return this.importsCache.set(i,V),this._load(V,y)})}loadJSON(i,l={}){this.fire(new t.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(i),this._request=t.q.frame(()=>{this._request=null,this._load(i,l.validate!==!1)})}loadEmpty(){this.fire(new t.z("dataloading",{dataType:"style"})),this._load(Jd,!1)}_loadImports(i,l,y){if(this.importDepth>=4)return t.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const w=[];for(const M of i){const A=this._createFragmentStyle(M),V=new Promise(ee=>{A.once("style.import.load",ee),A.once("error",ee)}).then(()=>this.mergeAll());if(w.push(V),this.resolvedImports.has(M.url)){A.loadEmpty();continue}const H=M.data||this.importsCache.get(M.url);H?(A.loadJSON(H,{validate:l}),this._isInternalStyle(H)&&(A.globalId=null)):M.url?A.loadURL(M.url,{validate:l}):A.loadEmpty();const K={style:A,id:M.id,config:M.config};if(y){const ee=this.fragments.findIndex(({id:se})=>se===y);this.fragments=this.fragments.slice(0,ee).concat(K).concat(this.fragments.slice(ee))}else this.fragments.push(K)}return Promise.allSettled(w)}getImportGlobalIds(i=this,l=new Set){for(const y of i.fragments)y.style.globalId&&l.add(y.style.globalId),this.getImportGlobalIds(y.style,l);return[...l.values()]}_createFragmentStyle(i){const l=this.scope?t.aC(i.id,this.scope):i.id;let y;const w=this._initialConfig&&this._initialConfig[l];(i.config||w)&&(y=t.l({},i.config,w));const M=new Do(this.map,{scope:l,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:y,configOptions:this.options,colorThemeOverride:i["color-theme"],configDependentLayers:this._configDependentLayers});return M.setEventedParent(this.map,{style:M}),M}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(i){return this.isRootStyle()&&(i.fragment||!!i.schema&&i.fragment!==!1)}_load(i,l){const y=i.indoor?Yd(i.schema):i.schema;if(this._isInternalStyle(i)){const A=t.l({},Jd,{imports:[{id:"basemap",data:i,url:""}]});return void this._load(A,l)}if(this.updateConfig(this._config,y),l&&Kl(this,un(i)))return;this._loaded=!0,this.stylesheet=t.cp(i);const w=()=>{for(const K in i.sources)this.addSource(K,i.sources[K],{validate:!1,isInitialLoad:!0});i.sprite?this._loadIconset(i.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(i.glyphs,this.scope);const A=Xl(this.stylesheet.layers);if(this._order=A.map(K=>K.id),this.stylesheet.light&&t.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const K=this.stylesheet.lights[0];this.light=new Xt(K.properties,K.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Xt(this.stylesheet.light)),this._layers={};for(const K of A){const ee=t.cu(K,this.scope,this._styleColorTheme.lut,this.options);ee.configDependencies.size!==0&&this._configDependentLayers.add(ee.fqid),ee.setEventedParent(this,{layer:{id:ee.id}}),this._layers[ee.id]=ee;const se=this.getOwnLayerSourceCache(ee),le=!!this.directionalLight&&this.directionalLight.shadowsEnabled();se&&ee.canCastShadows()&&le&&(se.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const V=this.stylesheet.terrain;V&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(V,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new t.z("data",{dataType:"style"}));const H=this.isRootStyle();i.imports?this._loadImports(i.imports,l).then(()=>{this._reloadImports(),this.fire(new t.z(H?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new t.z(H?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const M=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(M){const A=this._evaluateColorThemeData(M);this._loadColorTheme(A).then(()=>{w()}).catch(V=>{t.w(`Couldn't load color theme from the stylesheet: ${V}`),w()})}else this._styleColorTheme.lut=null,w()}isRootStyle(){return this.importDepth===0}mergeAll(){let i,l,y,w,M,A,V,H,K,ee;const se={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(le=>{if(le.stylesheet){if(le.light!=null&&(i=le.light),le.stylesheet.lights)for(const me of le.stylesheet.lights)me.type==="ambient"&&le.ambientLight!=null&&(l=le.ambientLight),me.type==="directional"&&le.directionalLight!=null&&(y=le.directionalLight);w=this._prioritizeTerrain(w,le.terrain,le.stylesheet.terrain),le.stylesheet.fog&&le.fog!=null&&(M=le.fog),le.stylesheet.snow&&le.snow!=null&&(A=le.snow),le.stylesheet.rain&&le.rain!=null&&(V=le.rain),le.stylesheet.camera!=null&&(ee=le.stylesheet.camera),le.stylesheet.projection!=null&&(H=le.stylesheet.projection),le.stylesheet.transition!=null&&(K=le.stylesheet.transition),se[le.scope]=le._styleColorTheme}}),this.light=i,this.ambientLight=l,this.directionalLight=y,this.fog=M,this.snow=A,this.rain=V,this._styleColorThemeForScope=se,w===null?delete this.terrain:this.terrain=w,this.camera=ee||{"camera-projection":"perspective"},this.projection=H||{name:"mercator"},this.transition=t.l({},Hu,K),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(i){const l=y=>{for(const w of y.fragments)l(w.style);i(y)};l(this)}_prioritizeTerrain(i,l,y){const w=i&&i.drapeRenderMode===0;return y===null?l&&l.drapeRenderMode===0?l:w?i:null:l!=null&&(!i||w||l&&l.drapeRenderMode===1)?l:i}mergeTerrain(){let i;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(l=>{i=this._prioritizeTerrain(i,l.terrain,l.stylesheet.terrain)}),i===null?delete this.terrain:this.terrain=i}mergeProjection(){let i;this.forEachFragmentStyle(l=>{l.stylesheet.projection!=null&&(i=l.stylesheet.projection)}),this.projection=i||{name:"mercator"}}mergeSources(){const i={},l={},y={};this.forEachFragmentStyle(w=>{for(const M in w._sourceCaches){const A=t.aC(M,w.scope);i[A]=w._sourceCaches[M]}for(const M in w._otherSourceCaches){const A=t.aC(M,w.scope);l[A]=w._otherSourceCaches[M]}for(const M in w._symbolSourceCaches){const A=t.aC(M,w.scope);y[A]=w._symbolSourceCaches[M]}}),this._mergedSourceCaches=i,this._mergedOtherSourceCaches=l,this._mergedSymbolSourceCaches=y}mergeLayers(){const i={},l=[],y={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(M=>{for(const A of M._order){const V=M._layers[A];if(V.type==="slot"){const H=t.cq(A);if(i[H])continue;i[H]=[]}V.slot&&i[V.slot]?i[V.slot].push(V):l.push(V)}}),this._mergedOrder=[];const w=(M=[])=>{for(const A of M)if(A.type==="slot"){const V=t.cq(A.id);i[V]&&w(i[V]),this._mergedSlots.push(V)}else{const V=t.aC(A.id,A.scope);this._mergedOrder.push(V),y[V]=A,A.is3D()&&(this._has3DLayers=!0),A.type==="circle"&&(this._hasCircleLayers=!0),A.type==="symbol"&&(this._hasSymbolLayers=!0),A.type==="clip"&&(this._clipLayerPresent=!0)}};w(l),this._mergedOrder.sort((M,A)=>{const V=y[M],H=y[A];return V.hasInitialOcclusionOpacityProperties?H.is3D()?1:0:V.is3D()&&H.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=y,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(i){return this.stylesheet.camera=t.l({},this.stylesheet.camera,i),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(i){return i.data?function(l,y,w){const M=t.l({},y);for(const V of Object.keys(t.a3.colorTheme))M[V]===void 0&&(M[V]=t.a3.colorTheme[V].default);const A=new t.a4(Um,l,new Map(w));return A.setTransitionOrValue(M,w),A.untransitioned().possiblyEvaluate(new t.a8(0))}(this.scope,i,this.options).get("data"):null}_loadColorTheme(i){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const l=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((y,w)=>{const M="data:image/png;base64,";if(!i||i.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void y();let A=i;A.startsWith(M)||(A=M+A);const V="mapbox-reserved-lut",H=new Image;H.src=A,H.onerror=()=>{this._styleColorTheme.lutLoading=!1,w(new Error("Failed to load image data"))},H.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==l)return void y();this._styleColorTheme.lutLoading=!1;const{width:K,height:ee,data:se}=t.q.getImageData(H);if(ee>32)return void w(new Error("The height of the image must be less than or equal to 32 pixels."));if(K!==ee*ee)return void w(new Error("The width of the image must be equal to the height squared."));this.getImage(V)&&this.removeImage(V),this.addImage(V,{data:new t.r({width:K,height:ee},se),pixelRatio:1,sdf:!1,usvg:!1,version:0});const le=this.imageManager.getImage(V,this.scope);le?(this._styleColorTheme.lut={image:le.data,data:i},y()):w(new Error("Missing LUT image."))}})}getLut(i){const l=this._styleColorThemeForScope[i];return l?l.lut:null}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(i){this._spriteRequest=function(l,y,w){let M,A,V;const H=t.q.devicePixelRatio>1?"@2x":"";let K=t.n(y.transformRequest(y.normalizeSpriteURL(l,H,".json"),t.R.SpriteJSON),(le,me)=>{K=null,V||(V=le,M=me,se())}),ee=t.o(y.transformRequest(y.normalizeSpriteURL(l,H,".png"),t.R.SpriteImage),(le,me)=>{ee=null,V||(V=le,A=me,se())});function se(){if(V)w(V);else if(M&&A){const le=t.q.getImageData(A),me={};for(const Ee in M){const{width:Se,height:ke,x:De,y:Xe,sdf:ut,pixelRatio:st,stretchX:wt,stretchY:gt,content:vt}=M[Ee],_t=new t.r({width:Se,height:ke});t.r.copy(le,_t,{x:De,y:Xe},{x:0,y:0},{width:Se,height:ke},null),me[Ee]={data:_t,pixelRatio:st,sdf:ut,stretchX:wt,stretchY:gt,content:vt,usvg:!1}}w(null,me)}}return{cancel(){K&&(K.cancel(),K=null),ee&&(ee.cancel(),ee=null)}}}(i,this.map._requestManager,(l,y)=>{if(this._spriteRequest=null,l)this.fire(new t.y(l));else if(y)for(const w in y)this.imageManager.addImage(w,this.scope,y[w]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new t.z("data",{dataType:"style"}))})}_loadIconset(i){if(!t.f(i)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(i);const l=this.map._spriteFormat==="auto";var y,w;this._spriteRequest=(w=(M,A)=>{if(this._spriteRequest=null,M)l?this._loadSprite(i):this.fire(new t.y(M));else if(A)for(const V in A)this.imageManager.addImage(V,this.scope,A[V]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new t.z("data",{dataType:"style"}))},t.bi((y=this.map._requestManager).transformRequest(y.normalizeIconsetURL(i),t.R.Iconset),(M,A)=>{if(M)return void w(M);const V={},H=t.cg(new t.bh(A));for(const K of H.icons){const ee={version:1,pixelRatio:t.q.devicePixelRatio,content:Yf(K),stretchX:K.metadata?Fc(K.metadata.stretch_x_areas):void 0,stretchY:K.metadata?Fc(K.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:K};V[K.name]=ee}w(null,V)}))}_validateLayer(i){const l=this.getOwnSource(i.source);if(!l)return;const y=i.sourceLayer;y&&(l.type==="geojson"||l.vectorLayerIds&&l.vectorLayerIds.indexOf(y)===-1)&&this.fire(new t.y(new Error(`Source layer "${y}" does not exist on source "${l.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:i}of this.fragments)if(!i.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((i,l)=>{const y=this.fragments[l];return y&&y.style&&(i.data=y.style.serialize()),i})}_serializeSources(){const i={};for(const l in this._sourceCaches){const y=this._sourceCaches[l].getSource();i[y.id]||(i[y.id]=y.serialize())}return i}_serializeLayers(i){const l=[];for(const y of i){const w=this._layers[y];w&&w.type!=="custom"&&l.push(w.serialize())}return l}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(i){return i?this.order:this._mergedOrder}isLayerDraped(i){return!!this.terrain&&i.isDraped(this.getLayerSourceCache(i))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(i){const l=this.getOwnLayer(i);if(l)return l;this.fire(new t.y(new Error(`The layer '${i}' does not exist in the map's style.`)))}_checkSource(i){const l=this.getOwnSource(i);if(l)return l;this.fire(new t.y(new Error(`The source '${i}' does not exist in the map's style.`)))}precompilePrograms(i,l){const y=this.map.painter;if(y)for(let w=i.minzoom||0;w<(i.maxzoom||25.5);w++){const M=i.getProgramIds();if(M)for(const A of M){const V=i.getDefaultProgramParams(A,l.zoom,this._styleColorTheme.lut);V&&(y.style=this,this.fog&&(y._fogVisible=!0,V.overrideFog=!0,y.getOrCreateProgram(A,V)),y._fogVisible=!1,V.overrideFog=!1,y.getOrCreateProgram(A,V),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(V.overrideRtt=!0,y.getOrCreateProgram(A,V)))}}}update(i){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(i),this.directionalLight&&this.directionalLight.recalculate(i);const l=this.calculateLightsBrightness();i.brightness=l||0,l!==this._brightness&&(this._brightness=l,this.dispatcher.broadcast("setBrightness",l));const y=this._changes.isDirty();let w=!1;if(this._changes.isDirty()){const A=this._changes.getLayerUpdatesByScope();for(const V in A){const{updatedIds:H,removedIds:K}=A[V];(H||K)&&(this._updateWorkerLayers(V,H,K),w=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(i),this.light&&this.light.updateTransitions(i),this.ambientLight&&this.ambientLight.updateTransitions(i),this.directionalLight&&this.directionalLight.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this.snow&&this.snow.updateTransitions(i),this.rain&&this.rain.updateTransitions(i),this._changes.reset()}const M={};for(const A in this._mergedSourceCaches){const V=this._mergedSourceCaches[A];M[A]=V.used,V.used=!1,V.tileCoverLift=0}for(const A of this._mergedOrder){const V=this._mergedLayers[A];if(V.recalculate(i,this._availableImages),!V.isHidden(i.zoom)){const H=this.getLayerSourceCache(V);H&&(H.used=!0,H.tileCoverLift=Math.max(H.tileCoverLift,V.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(V,i)}):this.precompilePrograms(V,i))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&w&&this.mergeLayers();for(const A in M){const V=this._mergedSourceCaches[A];M[A]!==V.used&&V.getSource().fire(new t.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:V.getSource().id}))}this.light&&this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.snow&&this.snow.recalculate(i),this.rain&&this.rain.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),y&&this.fire(new t.z("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=this._changes.getUpdatedImages();if(i.length){for(const l in this._sourceCaches)this._sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],i);this._changes.resetUpdatedImages()}}_updateWorkerLayers(i,l,y){const w=this.getFragmentStyle(i);w&&this.dispatcher.broadcast("updateLayers",{layers:l?w._serializeLayers(l):[],scope:i,removedIds:y||[],options:w.options})}setState(i,l){if(this._checkLoaded(),Kl(this,un(i)))return!1;(i=t.cp(i)).layers=Xl(i.layers);const y=function(A,V){if(!A)return[{command:Dr.setStyle,args:[V]}];let H=[];try{if(!t.bn(A.version,V.version))return[{command:Dr.setStyle,args:[V]}];if(t.bn(A.center,V.center)||H.push({command:Dr.setCenter,args:[V.center]}),t.bn(A.zoom,V.zoom)||H.push({command:Dr.setZoom,args:[V.zoom]}),t.bn(A.bearing,V.bearing)||H.push({command:Dr.setBearing,args:[V.bearing]}),t.bn(A.pitch,V.pitch)||H.push({command:Dr.setPitch,args:[V.pitch]}),t.bn(A.sprite,V.sprite)||H.push({command:Dr.setSprite,args:[V.sprite]}),t.bn(A.glyphs,V.glyphs)||H.push({command:Dr.setGlyphs,args:[V.glyphs]}),t.bn(A.imports,V.imports)||function(me=[],Ee=[],Se){Ee=Ee||[];const ke=(me=me||[]).map(jr),De=Ee.map(jr),Xe=me.reduce(Wi,{}),ut=Ee.reduce(Wi,{}),st=ke.slice();let wt,gt,vt,_t;for(wt=0,gt=0;wt<ke.length;wt++)vt=ke[wt],ut.hasOwnProperty(vt)?gt++:(Se.push({command:Dr.removeImport,args:[vt]}),st.splice(st.indexOf(vt,gt),1));for(wt=0,gt=0;wt<De.length;wt++)vt=De[De.length-1-wt],st[st.length-1-wt]!==vt&&(Xe.hasOwnProperty(vt)?(Se.push({command:Dr.removeImport,args:[vt]}),st.splice(st.lastIndexOf(vt,st.length-gt),1)):gt++,_t=st[st.length-wt],Se.push({command:Dr.addImport,args:[ut[vt],_t]}),st.splice(st.length-wt,0,vt));for(const Mt of Ee){const Ft=Xe[Mt.id];Ft&&!t.bn(Ft,Mt)&&Se.push({command:Dr.updateImport,args:[Mt.id,Mt]})}}(A.imports,V.imports,H),t.bn(A.transition,V.transition)||H.push({command:Dr.setTransition,args:[V.transition]}),t.bn(A.light,V.light)||H.push({command:Dr.setLight,args:[V.light]}),t.bn(A.fog,V.fog)||H.push({command:Dr.setFog,args:[V.fog]}),t.bn(A.snow,V.snow)||H.push({command:Dr.setSnow,args:[V.snow]}),t.bn(A.rain,V.rain)||H.push({command:Dr.setRain,args:[V.rain]}),t.bn(A.projection,V.projection)||H.push({command:Dr.setProjection,args:[V.projection]}),t.bn(A.lights,V.lights)||H.push({command:Dr.setLights,args:[V.lights]}),t.bn(A.camera,V.camera)||H.push({command:Dr.setCamera,args:[V.camera]}),!t.bn(A["color-theme"],V["color-theme"]))return[{command:Dr.setStyle,args:[V]}];const K={},ee=[];(function(me,Ee,Se,ke){let De;for(De in Ee=Ee||{},me=me||{})me.hasOwnProperty(De)&&(Ee.hasOwnProperty(De)||fl(De,Se,ke));for(De in Ee){if(!Ee.hasOwnProperty(De))continue;const Xe=Ee[De];me.hasOwnProperty(De)?t.bn(me[De],Xe)||(me[De].type==="geojson"&&Xe.type==="geojson"&&su(me,Ee,De)?Se.push({command:Dr.setGeoJSONSourceData,args:[De,Xe.data]}):fc(De,Ee,Se,ke)):Qo(De,Ee,Se)}})(A.sources,V.sources,ee,K);const se=[];A.layers&&A.layers.forEach(me=>{me.source&&K[me.source]?H.push({command:Dr.removeLayer,args:[me.id]}):se.push(me)});let le=A.terrain;le&&K[le.source]&&(H.push({command:Dr.setTerrain,args:[void 0]}),le=void 0),H=H.concat(ee),t.bn(le,V.terrain)||H.push({command:Dr.setTerrain,args:[V.terrain]}),function(me,Ee,Se){Ee=Ee||[];const ke=(me=me||[]).map(jr),De=Ee.map(jr),Xe=me.reduce(Wi,{}),ut=Ee.reduce(Wi,{}),st=ke.slice(),wt=Object.create(null);let gt,vt,_t,Mt,Ft,cn,en;for(gt=0,vt=0;gt<ke.length;gt++)_t=ke[gt],ut.hasOwnProperty(_t)?vt++:(Se.push({command:Dr.removeLayer,args:[_t]}),st.splice(st.indexOf(_t,vt),1));for(gt=0,vt=0;gt<De.length;gt++)_t=De[De.length-1-gt],st[st.length-1-gt]!==_t&&(Xe.hasOwnProperty(_t)?(Se.push({command:Dr.removeLayer,args:[_t]}),st.splice(st.lastIndexOf(_t,st.length-vt),1)):vt++,cn=st[st.length-gt],Se.push({command:Dr.addLayer,args:[ut[_t],cn]}),st.splice(st.length-gt,0,_t),wt[_t]=!0);for(gt=0;gt<De.length;gt++)if(_t=De[gt],Mt=Xe[_t],Ft=ut[_t],!wt[_t]&&!t.bn(Mt,Ft))if(t.bn(Mt.source,Ft.source)&&t.bn(Mt["source-layer"],Ft["source-layer"])&&t.bn(Mt.type,Ft.type)){for(en in hi(Mt.layout,Ft.layout,Se,_t,null,Dr.setLayoutProperty),hi(Mt.paint,Ft.paint,Se,_t,null,Dr.setPaintProperty),t.bn(Mt.slot,Ft.slot)||Se.push({command:Dr.setSlot,args:[_t,Ft.slot]}),t.bn(Mt.filter,Ft.filter)||Se.push({command:Dr.setFilter,args:[_t,Ft.filter]}),t.bn(Mt.minzoom,Ft.minzoom)&&t.bn(Mt.maxzoom,Ft.maxzoom)||Se.push({command:Dr.setLayerZoomRange,args:[_t,Ft.minzoom,Ft.maxzoom]}),Mt)Mt.hasOwnProperty(en)&&en!=="layout"&&en!=="paint"&&en!=="filter"&&en!=="metadata"&&en!=="minzoom"&&en!=="maxzoom"&&en!=="slot"&&(en.indexOf("paint.")===0?hi(Mt[en],Ft[en],Se,_t,en.slice(6),Dr.setPaintProperty):t.bn(Mt[en],Ft[en])||Se.push({command:Dr.setLayerProperty,args:[_t,en,Ft[en]]}));for(en in Ft)Ft.hasOwnProperty(en)&&!Mt.hasOwnProperty(en)&&en!=="layout"&&en!=="paint"&&en!=="filter"&&en!=="metadata"&&en!=="minzoom"&&en!=="maxzoom"&&en!=="slot"&&(en.indexOf("paint.")===0?hi(Mt[en],Ft[en],Se,_t,en.slice(6),Dr.setPaintProperty):t.bn(Mt[en],Ft[en])||Se.push({command:Dr.setLayerProperty,args:[_t,en,Ft[en]]}))}else Se.push({command:Dr.removeLayer,args:[_t]}),cn=st[st.lastIndexOf(_t)+1],Se.push({command:Dr.addLayer,args:[Ft,cn]})}(se,V.layers,H)}catch(K){console.warn("Unable to compute style diff:",K),H=[{command:Dr.setStyle,args:[V]}]}return H}(this.serialize(),i).filter(A=>!(A.command in $m));if(y.length===0)return!1;const w=y.filter(A=>!(A.command in Jl));if(w.length>0)throw new Error(`Unimplemented: ${w.map(A=>A.command).join(", ")}.`);const M=[];return y.forEach(A=>{M.push(this[A.command].apply(this,A.args))}),l&&Promise.all(M).then(l),this.stylesheet=i,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(i,l){return this.getImage(i)?this.fire(new t.y(new Error("An image with this name already exists."))):(this.imageManager.addImage(i,this.scope,l),this._afterImageUpdated(i),this)}updateImage(i,l,y=!1){this.imageManager.updateImage(i,this.scope,l),y&&this._afterImageUpdated(i)}getImage(i){return this.imageManager.getImage(i,this.scope)}removeImage(i){return this.getImage(i)?(this.imageManager.removeImage(i,this.scope),this._afterImageUpdated(i),this):this.fire(new t.y(new Error("No image with this name exists.")))}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(i),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new t.z("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(i,l,y={}){return this._checkLoaded(),this._validate(pt,`models.${i}`,l,null,y)||(this.modelManager.addModel(i,l,this.scope),this._changes.setDirty()),this}hasModel(i){return this.modelManager.hasModel(i,this.scope)}removeModel(i){return this.hasModel(i)?(this.modelManager.removeModel(i,this.scope),this):this.fire(new t.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(i,l,y={}){if(this._checkLoaded(),this.getOwnSource(i)!==void 0)throw new Error(`There is already a source with ID "${i}".`);if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(kn,`sources.${i}`,l,null,y))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const w=ru(i,l,this.dispatcher,this);w.scope=this.scope,w.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(w.id),source:w.serialize(),sourceId:w.id}));const M=A=>{const V=(A?"symbol:":"other:")+w.id,H=t.aC(V,this.scope),K=this._sourceCaches[V]=new ts(H,w,A);(A?this._symbolSourceCaches:this._otherSourceCaches)[w.id]=K,K.onAdd(this.map)};M(!1),l.type!=="vector"&&l.type!=="geojson"||M(!0),w.onAdd&&w.onAdd(this.map),y.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(i){this._checkLoaded();const l=this.getOwnSource(i);if(!l)throw new Error("There is no source with this ID");for(const w in this._layers)if(this._layers[w].source===i)return this.fire(new t.y(new Error(`Source "${i}" cannot be removed while layer "${w}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===i)return this.fire(new t.y(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));const y=this.getOwnSourceCaches(i);for(const w of y){const M=t.cq(w.id);delete this._sourceCaches[M],this._changes.discardSourceCacheUpdate(w.id),w.fire(new t.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:w.getSource().id})),w.setEventedParent(null),w.clearTiles()}return delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],this.mergeSources(),l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(i,l){this._checkLoaded(),this.getOwnSource(i).setData(l),this._changes.setDirty()}getOwnSource(i){const l=this.getOwnSourceCache(i);return l&&l.getSource()}getOwnSources(){const i=[];for(const l in this._otherSourceCaches){const y=this.getOwnSourceCache(l);y&&i.push(y.getSource())}return i}areTilesLoaded(){const i=this._mergedSourceCaches;for(const l in i){const y=i[l]._tiles;for(const w in y){const M=y[w];if(M.state!=="loaded"&&M.state!=="errored")return!1}}return!0}setLights(i){if(this._checkLoaded(),!i)return delete this.ambientLight,void delete this.directionalLight;const l=this._getTransitionParameters();for(const w of i){if(this._validate(Wn,"lights",w))return;switch(w.type){case"ambient":if(this.ambientLight){const M=this.ambientLight;M.set(w),M.updateTransitions(l)}else this.ambientLight=new Fs(w,Zr||(Zr=new t.a5({color:new t.a6(t.a3.properties_light_ambient.color),"color-use-theme":new t.a6({type:"string",default:"default","property-type":"data-constant"}),intensity:new t.a6(t.a3.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const M=this.directionalLight;M.set(w),M.updateTransitions(l)}else this.directionalLight=new Fs(w,Xr||(Xr=new t.a5({direction:new t.ak(t.a3.properties_light_directional.direction),color:new t.a6(t.a3.properties_light_directional.color),"color-use-theme":new t.a6({type:"string",default:"default","property-type":"data-constant"}),intensity:new t.a6(t.a3.properties_light_directional.intensity),"cast-shadows":new t.a6(t.a3.properties_light_directional["cast-shadows"]),"shadow-quality":new t.a6(t.a3.properties_light_directional["shadow-quality"]),"shadow-intensity":new t.a6(t.a3.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const y=new t.a8(this.z||0,l);this.ambientLight&&this.ambientLight.recalculate(y),this.directionalLight&&this.directionalLight.recalculate(y),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const i=this.directionalLight,l=this.ambientLight;if(!i||!l)return;const y=le=>.2126*(le[0]<=.03928?le[0]/12.92:Math.pow((le[0]+.055)/1.055,2.4))+.7152*(le[1]<=.03928?le[1]/12.92:Math.pow((le[1]+.055)/1.055,2.4))+.0722*(le[2]<=.03928?le[2]/12.92:Math.pow((le[2]+.055)/1.055,2.4)),w=i.properties.get("color").toRenderColor(null).toArray01(),M=i.properties.get("intensity"),A=i.properties.get("direction"),V=1-t.cb(A.x,A.y,A.z)[2]/90,H=y(w)*M*V,K=l.properties.get("color").toRenderColor(null).toArray01(),ee=l.properties.get("intensity"),se=y(K)*ee;return Number(((H+se)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const i=[];return this.directionalLight&&i.push(this.directionalLight.get()),this.ambientLight&&i.push(this.ambientLight.get()),i}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(i){if(!i)return this;if(t.cr(i)){const l=t.cs(i),y=this.fragments.find(({id:M})=>M===l);if(!y)throw new Error(`Style import '${i}' not found`);const w=t.cq(i);return y.style.getFragmentStyle(w)}{const l=this.fragments.find(({id:y})=>y===i);if(!l)throw new Error(`Style import '${i}' not found`);return l.style}}setFeaturesetSelectors(i){if(!i)return;const l={},y=(w,M="")=>`${w}::${M}`;this.featuresetSelectors={};for(const w in i){const M=this.featuresetSelectors[w]=[];for(const A of i[w].selectors){if(A.featureNamespace){const H=this.getOwnLayer(A.layer);if(!H){t.w(`Layer is undefined for selector: ${A.layer}`);continue}const K=y(H.source,H.sourceLayer);if(K in l&&l[K]!==A.featureNamespace){t.w(`"featureNamespace ${A.featureNamespace} of featureset ${w}'s selector is not associated to the same source, skip this selector`);continue}l[K]=A.featureNamespace}let V;if(A.properties)for(const H in A.properties){const K=t.U(A.properties[H]);K.result==="success"&&(V=V||{},V[H]=K.value)}M.push({layerId:A.layer,namespace:A.featureNamespace,properties:V})}}}getFeaturesetDescriptors(i){const l=this.getFragmentStyle(i);if(!l||!l.stylesheet.featuresets)return[];const y=[];for(const w in l.stylesheet.featuresets)y.push({featuresetId:w,importId:l.scope?l.scope:void 0});return y}getFeaturesetLayers(i,l){const y=this.getFragmentStyle(l),w=y.stylesheet.featuresets;if(!w||!w[i])return this.fire(new t.y(new Error(`The featureset '${i}' does not exist in the map's style and cannot be queried.`))),[];const M=[];for(const A of w[i].selectors){const V=y.getOwnLayer(A.layer);V&&M.push(V)}return M}getConfigProperty(i,l){const y=this.getFragmentStyle(i);if(!y)return null;const w=t.aC(l,y.scope),M=y.options.get(w),A=M?M.value||M.default:null;return A?A.serialize():null}setConfigProperty(i,l,y){const w=this.getFragmentStyle(i);if(!w)return;const M=w.stylesheet.indoor?Yd(w.stylesheet.schema):w.stylesheet.schema;if(!M||!M[l])return;const A=t.U(y);if(A.result!=="success")return void Kl(this,A.value);const V=A.value.expression,H=t.aC(l,w.scope),K=w.options.get(H);if(!K)return;let ee;const{minValue:se,maxValue:le,stepValue:me,type:Ee,values:Se}=M[l],ke=t.U(M[l].default);ke.result==="success"&&(ee=ke.value.expression),ee?(this.options.set(H,{...K,value:V,default:ee,minValue:se,maxValue:le,stepValue:me,type:Ee,values:Se}),this.updateConfigDependencies(l)):this.fire(new t.y(new Error(`No schema defined for the config option "${l}" in the "${i}" fragment.`)))}getConfig(i){const l=this.getFragmentStyle(i);if(!l)return null;const y=l.stylesheet.schema;if(!y)return null;const w={};for(const M in y){const A=t.aC(M,l.scope),V=l.options.get(A),H=V?V.value||V.default:null;w[M]=H?H.serialize():null}return w}setConfig(i,l){const y=this.getFragmentStyle(i);y&&(y.updateConfig(l,y.stylesheet.schema),this.updateConfigDependencies())}getSchema(i){const l=this.getFragmentStyle(i);return l?l.stylesheet.schema:null}setSchema(i,l){const y=this.getFragmentStyle(i);y&&(y.stylesheet.schema=l,y.updateConfig(y._config,l),this.updateConfigDependencies())}updateConfig(i,l){if(this._config=i,i||l)if(l)for(const y in l){let w,M;const A=t.U(l[y].default);if(A.result==="success"&&(w=A.value.expression),i&&i[y]!==void 0){const le=t.U(i[y]);le.result==="success"&&(M=le.value.expression)}const{minValue:V,maxValue:H,stepValue:K,type:ee,values:se}=l[y];if(w){const le=t.aC(y,this.scope);this.options.set(le,{default:w,value:M,minValue:V,maxValue:H,stepValue:K,type:ee,values:se})}else this.fire(new t.y(new Error(`No schema defined for config option "${y}".`)))}else this.fire(new t.y(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(i){for(const l of this._configDependentLayers){const y=this.getLayer(l);if(y){if(i&&!y.configDependencies.has(i))continue;y.possiblyEvaluateVisibility(),this._updateLayer(y)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(l=>{const y=l._styleColorTheme.colorThemeOverride?l._styleColorTheme.colorThemeOverride:l._styleColorTheme.colorTheme;if(y){const w=l._evaluateColorThemeData(y);(!l._styleColorTheme.lut&&w!==""||l._styleColorTheme.lut&&w!==l._styleColorTheme.lut.data)&&l.setColorTheme(y)}}),this._changes.setDirty()}addLayer(i,l,y={}){this._checkLoaded();const w=i.id;if(this._layers[w])return void this.fire(new t.y(new Error(`Layer with id "${w}" already exists on this map`)));let M;if(i.type==="custom"){if(Kl(this,t.ct(i)))return;M=t.cu(i,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof i.source=="object"&&(this.addSource(w,i.source),i=t.cp(i),i=t.l(i,{source:w})),this._validate(Pe,`layers.${w}`,i,{arrayIndex:-1},y))return;M=t.cu(i,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(M),M.setEventedParent(this,{layer:{id:w}})}M.configDependencies.size!==0&&this._configDependentLayers.add(M.fqid);let A=this._order.length;if(l){const ee=this._order.indexOf(l);if(ee===-1)return void this.fire(new t.y(new Error(`Layer with id "${l}" does not exist on this map.`)));M.slot===this._layers[l].slot?A=ee:t.w(`Layer with id "${l}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(A,0,w),this._layerOrderChanged=!0,this._layers[w]=M;const V=this.getOwnLayerSourceCache(M),H=!!this.directionalLight&&this.directionalLight.shadowsEnabled();V&&M.canCastShadows()&&H&&(V.castsShadows=!0);const K=this._changes.getRemovedLayer(M);if(K&&M.source&&V&&M.type!=="custom"){this._changes.discardLayerRemoval(M);const ee=t.aC(M.source,M.scope);K.type!==M.type?this._changes.updateSourceCache(ee,"clear"):(this._changes.updateSourceCache(ee,"reload"),V.pause())}this._updateLayer(M),M.onAdd&&M.onAdd(this.map),M.scope=this.scope,this.mergeLayers()}moveLayer(i,l){this._checkLoaded();const y=this._checkLayer(i);if(!y||i===l)return;const w=this._order.indexOf(i);this._order.splice(w,1);let M=this._order.length;if(l){const A=this._order.indexOf(l);if(A===-1)return void this.fire(new t.y(new Error(`Layer with id "${l}" does not exist on this map.`)));y.slot===this._layers[l].slot?M=A:t.w(`Layer with id "${l}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(M,0,i),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(i){this._checkLoaded();const l=this._checkLayer(i);if(!l)return;l.setEventedParent(null);const y=this._order.indexOf(i);this._order.splice(y,1),delete this._layers[i],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(l.fqid),this._changes.removeLayer(l);const w=this.getOwnLayerSourceCache(l);if(w&&w.castsShadows){let M=!1;for(const A in this._layers)if(this._layers[A].source===l.source&&this._layers[A].canCastShadows()){M=!0;break}w.castsShadows=M}l.onRemove&&l.onRemove(this.map),this.mergeLayers()}getOwnLayer(i){return this._layers[i]}hasLayer(i){return i in this._mergedLayers}hasLayerType(i){for(const l in this._layers)if(this._layers[l].type===i)return!0;return!1}setLayerZoomRange(i,l,y){this._checkLoaded();const w=this._checkLayer(i);w&&(w.minzoom===l&&w.maxzoom===y||(l!=null&&(w.minzoom=l),y!=null&&(w.maxzoom=y),this._updateLayer(w)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(i,l){this._checkLoaded();const y=this._checkLayer(i);y&&y.slot!==l&&(y.slot=l,this._updateLayer(y))}setFilter(i,l,y={}){this._checkLoaded();const w=this._checkLayer(i);if(w&&!t.bn(w.filter,l))return l==null?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(Ze,`layers.${w.id}.filter`,l,{layerType:w.type},y)||(w.filter=t.cp(l),this._updateLayer(w)))}getFilter(i){const l=this._checkLayer(i);if(l)return t.cp(l.filter)}setLayoutProperty(i,l,y,w={}){this._checkLoaded();const M=this._checkLayer(i);if(M&&!t.bn(M.getLayoutProperty(l),y)){if(y!=null&&(!w||w.validate!==!1)&&Kl(M,We.call(un,{key:`layers.${i}.layout.${l}`,layerType:M.type,objectKey:l,value:y,styleSpec:t.a3,style:{glyphs:!0,sprite:!0}})))return;M.setLayoutProperty(l,y),M.configDependencies.size!==0&&this._configDependentLayers.add(M.fqid),this._updateLayer(M)}}getLayoutProperty(i,l){const y=this._checkLayer(i);if(y)return y.getLayoutProperty(l)}setPaintProperty(i,l,y,w={}){this._checkLoaded();const M=this._checkLayer(i);if(!M||t.bn(M.getPaintProperty(l),y)||y!=null&&(!w||w.validate!==!1)&&Kl(M,yt.call(un,{key:`layers.${i}.paint.${l}`,layerType:M.type,objectKey:l,value:y,styleSpec:t.a3})))return;const A=M.setPaintProperty(l,y);M.configDependencies.size!==0&&this._configDependentLayers.add(M.fqid),A&&this._updateLayer(M),this._changes.updatePaintProperties(M)}getPaintProperty(i,l){const y=this._checkLayer(i);if(y)return y.getPaintProperty(l)}setFeatureState(i,l){if(this._checkLoaded(),"target"in i){if("featuresetId"in i.target){const{featuresetId:H,importId:K}=i.target,ee=this.getFragmentStyle(K),se=ee.getFeaturesetLayers(H);for(const{source:le,sourceLayer:me}of se)ee.setFeatureState({id:i.id,source:le,sourceLayer:me},l)}else if("layerId"in i.target){const{layerId:H}=i.target,K=this.getLayer(H);this.setFeatureState({id:i.id,source:K.source,sourceLayer:K.sourceLayer},l)}return}const y=i.source,w=i.sourceLayer,M=this._checkSource(y);if(!M)return;const A=M.type;if(A==="geojson"&&w)return void this.fire(new t.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(A==="vector"&&!w)return void this.fire(new t.y(new Error("The sourceLayer parameter must be provided for vector source types.")));i.id===void 0&&this.fire(new t.y(new Error("The feature id parameter must be provided.")));const V=this.getOwnSourceCaches(y);for(const H of V)H.setFeatureState(w,i.id,l)}removeFeatureState(i,l){if(this._checkLoaded(),"target"in i){if("featuresetId"in i.target){const{featuresetId:H,importId:K}=i.target,ee=this.getFragmentStyle(K),se=ee.getFeaturesetLayers(H);for(const{source:le,sourceLayer:me}of se)ee.removeFeatureState({id:i.id,source:le,sourceLayer:me},l)}else if("layerId"in i.target){const{layerId:H}=i.target,K=this.getLayer(H);this.removeFeatureState({id:i.id,source:K.source,sourceLayer:K.sourceLayer},l)}return}const y=i.source,w=this._checkSource(y);if(!w)return;const M=w.type,A=M==="vector"?i.sourceLayer:void 0;if(M==="vector"&&!A)return void this.fire(new t.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&typeof i.id!="string"&&typeof i.id!="number")return void this.fire(new t.y(new Error("A feature id is required to remove its specific state property.")));const V=this.getOwnSourceCaches(y);for(const H of V)H.removeFeatureState(A,i.id,l)}getFeatureState(i){if(this._checkLoaded(),"target"in i){let M;if("featuresetId"in i.target){const{featuresetId:A,importId:V}=i.target,H=this.getFragmentStyle(V),K=H.getFeaturesetLayers(A);for(const{source:ee,sourceLayer:se}of K){const le=H.getFeatureState({id:i.id,source:ee,sourceLayer:se});if(le&&!M)M=le;else if(!t.bn(M,le))return void this.fire(new t.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in i.target){const{layerId:A}=i.target,V=this.getLayer(A);M=this.getFeatureState({id:i.id,source:V.source,sourceLayer:V.sourceLayer})}return M}const l=i.source,y=i.sourceLayer,w=this._checkSource(l);if(w){if(w.type!=="vector"||y)return i.id===void 0&&this.fire(new t.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(l)[0].getFeatureState(y,i.id);this.fire(new t.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(i){return this.stylesheet.transition=t.l({},this.stylesheet.transition,i),this.transition=this.stylesheet.transition,this}getTransition(){return t.l({},this.stylesheet.transition)}serialize(){this._checkLoaded();const i=this.getTerrain(),l=i&&this.terrain&&this.terrain.scope===this.scope?i:this.stylesheet.terrain;return t.cv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:l,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},y=>y!==void 0)}_updateFilteredLayers(i){for(const l of Object.values(this._mergedLayers))i(l)&&this._updateLayer(l)}_updateLayer(i){this._changes.updateLayer(i);const l=this.getLayerSourceCache(i),y=t.aC(i.source,i.scope),w=this._changes.getUpdatedSourceCaches();i.source&&!w[y]&&l&&l.getSource().type!=="raster"&&(this._changes.updateSourceCache(y,"reload"),l.pause()),i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const l=V=>this._mergedLayers[V].is3D(),y=this.order,w={},M=[];for(let V=y.length-1;V>=0;V--){const H=y[V];if(l(H)){w[H]=V;for(const K of i){const ee=K[H];if(ee)for(const se of ee)M.push(se)}}}M.sort((V,H)=>H.intersectionZ-V.intersectionZ);const A=[];for(let V=y.length-1;V>=0;V--){const H=y[V];if(l(H))for(let K=M.length-1;K>=0;K--){const ee=M[K].feature;if(ee.layer&&w[ee.layer.id]<V)break;A.push(ee),M.pop()}else for(const K of i){const ee=K[H];if(ee)for(const se of ee)A.push(se.feature)}}return A}queryRenderedFeatures(i,l,y){let w;l&&!Array.isArray(l)&&l.filter&&(this._validate(Ze,"queryRenderedFeatures.filter",l.filter,null,l),w=t.aZ(l.filter));const M={},A=ee=>{if(Kf.has(ee.type))return;const se=this.getOwnLayerSourceCache(ee),le=M[se.id]=M[se.id]||{sourceCache:se,layers:{},has3DLayers:!1};ee.is3D()&&(le.has3DLayers=!0),le.layers[ee.fqid]=le.layers[ee.fqid]||{styleLayer:ee,targets:[]},le.layers[ee.fqid].targets.push({filter:w})};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new t.y(new Error("parameters.layers must be an Array."))),[];for(const ee of l.layers){const se=this._layers[ee];if(!se)return this.fire(new t.y(new Error(`The layer '${ee}' does not exist in the map's style and cannot be queried for features.`))),[];A(se)}}else for(const ee in this._layers)A(this._layers[ee]);const V=this._queryRenderedFeatures(i,M,y),H=this._flattenAndSortRenderedFeatures(V),K=[];for(const ee of H)t.cs(ee.layer.id)===this.scope&&K.push(ee);return K}queryRenderedFeatureset(i,l,y){let w;l&&!Array.isArray(l)&&l.filter&&(this._validate(Ze,"queryRenderedFeatures.filter",l.filter,null,l),w=t.aZ(l.filter));const M="mock",A=[];if(l&&l.target)A.push({...l,targetId:M,filter:w});else{const K=this.getFeaturesetDescriptors();for(const ee of K)A.push({targetId:M,filter:w,target:ee});for(const{style:ee}of this.fragments){const se=ee.getFeaturesetDescriptors();for(const le of se)A.push({targetId:M,filter:w,target:le})}}const V=this.queryRenderedTargets(i,A,y),H=[];for(const K of V)for(const ee of K.variants[M])H.push(new t.cw(K,ee));return H}queryRenderedTargets(i,l,y){const w={},M=(V,H,K,ee)=>{const se=w[H.id]=w[H.id]||{sourceCache:H,layers:{},has3DLayers:!1};se.layers[V.fqid]=se.layers[V.fqid]||{styleLayer:V,targets:[]},V.is3D()&&(se.has3DLayers=!0),se.layers[V.fqid].targets.push(ee?{...K,namespace:ee.namespace,properties:ee.properties}:K)};for(const V of l)if("featuresetId"in V.target){const{featuresetId:H,importId:K}=V.target,ee=this.getFragmentStyle(K),se=ee.featuresetSelectors[H];if(!se){this.fire(new t.y(new Error(`The featureset '${H}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const le of se){const me=ee.getOwnLayer(le.layerId);me&&!Kf.has(me.type)&&M(me,ee.getOwnLayerSourceCache(me),V,le)}}else if("layerId"in V.target){const{layerId:H}=V.target,K=this.getLayer(H);if(!K||Kf.has(K.type))continue;M(K,this.getLayerSourceCache(K),V)}const A=this._queryRenderedFeatures(i,w,y);return this._flattenAndSortRenderedFeatures(A)}_queryRenderedFeatures(i,l,y){const w=[],M=!!this.map._showQueryGeometry,A=bs.createFromScreenPoints(i,y);for(const V in l){const H=qf(A,l[V],this._availableImages,y,M);Object.keys(H).length&&w.push(H)}if(this.placement)for(const V in l){if(!l[V].sourceCache._onlySymbols)continue;const H=_h(A.screenGeometry,l[V],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData);Object.keys(H).length&&w.push(H)}return w}querySourceFeatures(i,l){const y=l&&l.filter;y&&this._validate(Ze,"querySourceFeatures.filter",y,null,l);let w=[];const M=this.getOwnSourceCaches(i);for(const A of M)w=w.concat(Kh(A,l));return w}addSourceType(i,l,y){return Do.getSourceType(i)?y(new Error(`A source type called "${i}" already exists.`)):(Do.setSourceType(i,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:l.workerSourceURL},y):y(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(i,l,y={}){this._checkLoaded();const w=this.light.getLight();let M=!1;for(const V in i)if(!t.bn(i[V],w[V])){M=!0;break}if(!M)return;const A=this._getTransitionParameters();this.light.setLight(i,l,y),this.light.updateTransitions(A)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=t.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&t.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(i,l=1){if(this._checkLoaded(),!i)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),l===0&&delete this.terrain,i===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let y=i;const w=i.source==null;if(l===1){if(this.disableElevatedTerrain)return;if(typeof y.source=="object"){const V="terrain-dem-src";this.addSource(V,y.source),y=t.cp(y),y=t.l(y,{source:V})}const M=t.l({},y),A={};if(this.terrain&&w){M.source=this.terrain.get().source;const V=this.terrain?this.getFragmentStyle(this.terrain.scope):null;V&&(A.style=V.serialize())}if(this._validate(Gn,"terrain",M,A))return}if(!this.terrain||this.terrain.scope!==this.scope&&!w||this.terrain&&l!==this.terrain.drapeRenderMode){if(!y)return;this._createTerrain(y,l),this.fire(new t.z("data",{dataType:"style"}))}else{const M=this.terrain,A=M.get();for(const V of Object.keys(t.a3.terrain))!y.hasOwnProperty(V)&&t.a3.terrain[V].default&&(y[V]=t.a3.terrain[V].default);for(const V in i)if(!t.bn(i[V],A[V])){M.set(i,this.options),this.stylesheet.terrain=i;const H=this._getTransitionParameters({duration:0});M.updateTransitions(H),this.fire(new t.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){const l=this.fog=new Jr(i,this.map.transform,this.scope,this.options);this.stylesheet.fog=l.get();const y=this._getTransitionParameters({duration:0});l.updateTransitions(y)}_createSnow(i){const l=this.snow=new xs(i,this.map.transform,this.scope,this.options);this.stylesheet.snow=l.get();const y=this._getTransitionParameters({duration:0});l.updateTransitions(y)}_createRain(i){const l=this.rain=new go(i,this.map.transform,this.scope,this.options);this.stylesheet.rain=l.get();const y=this._getTransitionParameters({duration:0});l.updateTransitions(y)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const l=this.fog;if(!t.bn(l.get(),i)){l.set(i,this.options),this.stylesheet.fog=l.get();const y=this._getTransitionParameters({duration:0});l.updateTransitions(y)}}else this._createFog(i);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(i){if(this._checkLoaded(),!i)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const l=this.snow;if(!t.bn(l.get(),i)){l.set(i,this.options),this.stylesheet.snow=l.get();const y=this._getTransitionParameters({duration:0});l.updateTransitions(y)}}else this._createSnow(i);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(i){if(this._checkLoaded(),!i)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const l=this.rain;if(!t.bn(l.get(),i)){l.set(i,this.options),this.stylesheet.rain=l.get();const y=this._getTransitionParameters({duration:0});l.updateTransitions(y)}}else this._createRain(i);this._markersNeedUpdate=!0}_reloadColorTheme(){const i=()=>{for(const w in this._layers)this._layers[w].lut=this._styleColorTheme.lut;for(const w in this._sourceCaches)this._sourceCaches[w].clearTiles()},l=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!l)return this._styleColorTheme.lut=null,void i();const y=this._evaluateColorThemeData(l);this._loadColorTheme(y).then(()=>{this.fire(new t.z("colorthemeset")),i()}).catch(w=>{t.w(`Couldn't set color theme: ${w}`)})}setColorTheme(i){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&t.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=i,this._reloadColorTheme()}setImportColorTheme(i,l){const y=this.getFragmentStyle(i);y&&(y._styleColorTheme.colorThemeOverride=l,y._reloadColorTheme())}_getTransitionParameters(i){return{now:t.q.now(),transition:t.l(this.transition,i)}}updateDrapeFirstLayers(){if(!this.terrain)return;const i=[],l=[];for(const y of this._mergedOrder)this.isLayerDraped(this._mergedLayers[y])?i.push(y):l.push(y);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...l)}_createTerrain(i,l){const y=this.terrain=new Gt(i,l,this.scope,this.options);l===1&&(this.stylesheet.terrain=i),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const w=this._getTransitionParameters({duration:0});y.updateTransitions(w)}_force3DLayerUpdate(){for(const i in this._layers){const l=this._layers[i];l.type==="fill-extrusion"&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(const i in this._layers){const l=this._layers[i];l.type==="symbol"&&this._updateLayer(l)}}_validate(i,l,y,w,M={}){if(M&&M.validate===!1)return!1;const A=t.l({},this.serialize());return Kl(this,i.call(un,t.l({key:l,style:A,value:y,styleSpec:t.a3},w)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.cx.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._mergedLayers)this._mergedLayers[i].setEventedParent(null);for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles(),this._mergedSourceCaches[i].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(i){const l=this.getSourceCaches(i);for(const y of l)y.clearTiles()}clearSources(){for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles()}reloadSource(i){const l=this.getSourceCaches(i);for(const y of l)y.resume(),y.reload()}reloadSources(){for(const i of this.getSources())i.reload&&i.reload()}updateSources(i){let l;this.directionalLight&&(l=qu(this.directionalLight));for(const y in this._mergedSourceCaches)this._mergedSourceCaches[y].update(i,void 0,void 0,l)}_generateCollisionBoxes(){for(const i in this._sourceCaches){const l=this._sourceCaches[i];l.resume(),l.reload()}}_updatePlacement(i,l,y,w,M,A,V=!1){let H=!1,K=!1;const ee={},se={};for(const le of this._mergedOrder){const me=this._mergedLayers[le];if(me.type!=="symbol")continue;const Ee=t.aC(me.source,me.scope);let Se=ee[Ee];if(!Se){const De=this.getLayerSourceCache(me);if(!De)continue;const Xe=De.getRenderableIds(!0).map(ut=>De.getTileByID(ut));se[Ee]=Xe.slice(),Se=ee[Ee]=Xe.sort((ut,st)=>st.tileID.overscaledZ-ut.tileID.overscaledZ||(ut.tileID.isLessThan(st.tileID)?-1:1))}const ke=this.crossTileSymbolIndex.addLayer(me,Se,l.center.lng,l.projection);H=H||ke}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),V=V||this._layerOrderChanged||w===0,this._layerOrderChanged&&this.fire(new t.z("neworder")),(V||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.q.now(),l.zoom))&&(this.pauseablePlacement=new Wd(l,this._mergedOrder,V,y,w,M,this.placement,this.fog&&l.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,ee,se,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.q.now()),K=!0),H&&this.pauseablePlacement.placement.setStale()),K||H){this._buildingIndex.onNewFrame(l.zoom);for(let le=0;le<this._mergedOrder.length;le++){const me=this._mergedLayers[this._mergedOrder[le]];if(me.type!=="symbol")continue;const Ee=this.isLayerClipped(me);this.placement.updateLayerOpacities(me,ee[t.aC(me.source,me.scope)],le,Ee?A:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.q.now())}}_releaseSymbolFadeTiles(){for(const i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}addImport(i,l){this._checkLoaded();const y=this.stylesheet.imports=this.stylesheet.imports||[];if(y.findIndex(({id:M})=>M===i.id)!==-1)return void this.fire(new t.y(new Error(`Import with id '${i.id}' already exists in the map's style.`)));if(!l)return y.push(i),this._loadImports([i],!0);const w=y.findIndex(({id:M})=>M===l);return w===-1&&this.fire(new t.y(new Error(`Import with id "${l}" does not exist on this map.`))),this.stylesheet.imports=y.slice(0,w).concat(i).concat(y.slice(w)),this._loadImports([i],!0,l)}updateImport(i,l){this._checkLoaded();const y=this.stylesheet.imports||[],w=this.getImportIndex(i);return w===-1?this:typeof l=="string"?(this.setImportUrl(i,l),this):(l.url&&l.url!==y[w].url&&this.setImportUrl(i,l.url),t.bn(l.config,y[w].config)||this.setImportConfig(i,l.config),t.bn(l.data,y[w].data)||this.setImportData(i,l.data),this)}moveImport(i,l){this._checkLoaded();let y=this.stylesheet.imports||[];const w=this.getImportIndex(i);if(w===-1)return this;const M=this.getImportIndex(l);if(M===-1)return this;const A=y[w],V=this.fragments[w];return y=y.filter(({id:H})=>H!==i),this.fragments=this.fragments.filter(({id:H})=>H!==i),this.stylesheet.imports=y.slice(0,M).concat(A).concat(y.slice(M)),this.fragments=this.fragments.slice(0,M).concat(V).concat(this.fragments.slice(M)),this.mergeLayers(),this}setImportUrl(i,l){this._checkLoaded();const y=this.stylesheet.imports||[],w=this.getImportIndex(i);if(w===-1)return this;y[w].url=l;const M=this.fragments[w];return M.style=this._createFragmentStyle(y[w]),M.style.on("style.import.load",()=>this.mergeAll()),M.style.loadURL(l),this}setImportData(i,l){this._checkLoaded();const y=this.getImportIndex(i),w=this.stylesheet.imports||[];return y===-1?this:l?(this.fragments[y].style.setState(l),this._reloadImports(),this):(delete w[y].data,this.setImportUrl(i,w[y].url))}setImportConfig(i,l){this._checkLoaded();const y=this.getImportIndex(i),w=this.stylesheet.imports||[];if(y===-1)return this;l?w[y].config=l:delete w[y].config;const M=this.fragments[y],A=M.style.stylesheet&&M.style.stylesheet.schema;return M.config=l,M.style.updateConfig(l,A),this.updateConfigDependencies(),this}removeImport(i){this._checkLoaded();const l=this.stylesheet.imports||[],y=this.getImportIndex(i);y!==-1&&(l.splice(y,1),this.fragments[y].style._remove(),this.fragments.splice(y,1),this._reloadImports())}getImportIndex(i){const l=(this.stylesheet.imports||[]).findIndex(y=>y.id===i);return l===-1&&this.fire(new t.y(new Error(`Import '${i}' does not exist in the map's style and cannot be updated.`))),l}getLayer(i){return this._mergedLayers[i]}getSources(){const i=[];for(const l in this._mergedOtherSourceCaches){const y=this._mergedOtherSourceCaches[l];y&&i.push(y.getSource())}return i}getSource(i,l){const y=this.getSourceCache(i,l);return y&&y.getSource()}getLayerSource(i){const l=this.getLayerSourceCache(i);return l&&l.getSource()}getSourceCache(i,l){const y=t.aC(i,l);return this._mergedOtherSourceCaches[y]}getLayerSourceCache(i){const l=t.aC(i.source,i.scope);return i.type==="symbol"?this._mergedSymbolSourceCaches[l]:this._mergedOtherSourceCaches[l]}getSourceCaches(i){if(i==null)return Object.values(this._mergedSourceCaches);const l=[];return this._mergedOtherSourceCaches[i]&&l.push(this._mergedOtherSourceCaches[i]),this._mergedSymbolSourceCaches[i]&&l.push(this._mergedSymbolSourceCaches[i]),l}updateSourceCaches(){const i=this._changes.getUpdatedSourceCaches();for(const l in i){const y=i[l];y==="reload"?this.reloadSource(l):y==="clear"&&this.clearSource(l)}}updateLayers(i){const l=this._changes.getUpdatedPaintProperties();for(const y of l){const w=this.getLayer(y);w&&w.updateTransitions(i)}}getImages(i,l,y){this.imageManager.getImages(l.icons,l.scope,y),this._updateTilesForChangedImages();const w=M=>{M&&M.setDependencies(l.tileID.key,l.type,l.icons)};w(this._otherSourceCaches[l.source]),w(this._symbolSourceCaches[l.source])}rasterizeImages(i,l,y){this.imageManager.rasterizeImages(l,y)}getGlyphs(i,l,y){this.glyphManager.getGlyphs(l.stacks,l.scope,y)}getResource(i,l,y){return t.cy(l,y)}getOwnSourceCache(i){return this._otherSourceCaches[i]}getOwnLayerSourceCache(i){return i.type==="symbol"?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}getOwnSourceCaches(i){const l=[];return this._otherSourceCaches[i]&&l.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&l.push(this._symbolSourceCaches[i]),l}_isSourceCacheLoaded(i){const l=this.getOwnSourceCaches(i);return l.length===0?(this.fire(new t.y(new Error(`There is no source with ID '${i}'`))),!1):l.every(y=>y.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(i,l){if(!this._clipLayerPresent&&i.type!=="fill-extrusion")return!1;const y=i.type==="fill-extrusion"&&i.sourceLayer==="building";if(i.is3D()){if(y||l&&l.type==="batched-model"||i.type==="model")return!0}else if(i.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(i=>{i.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Do.getSourceType=function(_){return Bu[_]},Do.setSourceType=function(_,i){Bu[_]=i},Do.registerForPluginStateChange=t.ch;var Qd=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Th=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Ch=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,hd="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",fu=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Ll=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,ef=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,tf=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,aa=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,pu=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,nf=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef TEXTURE_GATHER
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz/=light_view_pos0.w;vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Zu=[];Ql(Qd,Zu),Ql(Ch,Zu),Ql(Th,Zu);const zl={"_prelude_fog.vertex.glsl":Ll,"_prelude_terrain.vertex.glsl":fu,"_prelude_shadow.vertex.glsl":pu,"_prelude_fog.fragment.glsl":ef,"_prelude_shadow.fragment.glsl":nf,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":tf,"_prelude_raster_particle.glsl":aa},mu={};Rr("",fu),Rr(ef,Ll),Rr(nf,pu),Rr(tf,""),Rr(aa,"");const Jf=Rr(Th,Ch),Qf=Qd;var ep={background:Rr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Rr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Rr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float opacity_t=smoothstep((1.0-blur_positive)*antialiased_blur,blur_positive*antialiased_blur,extrude_length-1.0)-smoothstep(0.0,antialiasblur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Rr("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Rr(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Rr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Rr("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Rr("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Rr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Rr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Rr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Rr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Rr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Rr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Rr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Rr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Rr(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Rr(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Rr(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Rr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Rr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec2 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
halfwidth=(u_width_scale*a_z_offset_width.y)/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Rr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset > 0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec2 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec4 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec4 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset+0.01*step(0.01,a_z_offset),1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
float a_uv_x=a_packed[0];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Rr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Rr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Rr("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Rr("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Rr(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Rr(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+(u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#else
z+=u_pitch_with_map ? (u_elevation_from_sea ? z_offset : z_offset) : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#endif
}`),terrainRaster:Rr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Rr("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Rr(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,hd),skyboxGradient:Rr(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,hd),skyboxCapture:Rr(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Rr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Rr(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Rr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Rr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Rr(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Rr("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Rr("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Rr("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Rr("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Ql(_,i){const l=_.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let y of l)if(y=y.trim(),y[0]==="#"&&y.includes("if")&&!y.includes("endif")){y=y.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const w=y.split(" ");for(const M of w)i.includes(M)||i.push(M)}}function Rr(_,i){const l=/#include\s+"([^"]+)"/g,y=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let w=i.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);w&&(w=w.map(K=>{const ee=K.split(" ");return ee[ee.length-1]}),w=[...new Set(w)]);const M={},A=[],V=[];if(_=_.replace(l,(K,ee)=>(V.push(ee),"")),(i=i.replace(l,(K,ee)=>(A.push(ee),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let H=[...Zu];Ql(_,H),Ql(i,H);for(const K of[...A,...V])zl[K]||console.error(`Undefined include: ${K}`),mu[K]||(mu[K]=[],Ql(zl[K],mu[K])),H=[...H,...mu[K]];return{fragmentSource:_=_.replace(y,(K,ee,se,le,me)=>(M[me]=!0,ee==="define"?`
#ifndef HAS_UNIFORM_u_${me}
in ${se} ${le} ${me};
#else
uniform ${se} ${le} u_${me};
#endif
`:ee==="initialize"?`
#ifdef HAS_UNIFORM_u_${me}
    ${se} ${le} ${me} = u_${me};
#endif
`:ee==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${me}
    in ${se} ${le} ${me};
#endif
`:ee==="initialize-attribute"?"":void 0)),vertexSource:i=i.replace(y,(K,ee,se,le,me)=>{const Ee=le==="float"?"vec2":le,Se=me.match(/color/)?"color":Ee;return ee==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${me}
in ${se} ${le} a_${me};
#endif
`:M[me]?ee==="define"?`
#ifndef HAS_UNIFORM_u_${me}
uniform lowp float u_${me}_t;
in ${se} ${Ee} a_${me};
out ${se} ${le} ${me};
#else
uniform ${se} ${le} u_${me};
#endif
`:ee==="initialize"?Se==="vec4"?`
#ifndef HAS_UNIFORM_u_${me}
    ${me} = a_${me};
#else
    ${se} ${le} ${me} = u_${me};
#endif
`:`
#ifndef HAS_UNIFORM_u_${me}
    ${me} = unpack_mix_${Se}(a_${me}, u_${me}_t);
#else
    ${se} ${le} ${me} = u_${me};
#endif
`:ee==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${me}
    in ${se} ${le} a_${me};
    out ${se} ${le} ${me};
#endif
`:ee==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${me}
    ${me} = a_${me};
#endif
`:void 0:ee==="define"?`
#ifndef HAS_UNIFORM_u_${me}
uniform lowp float u_${me}_t;
in ${se} ${Ee} a_${me};
#else
uniform ${se} ${le} u_${me};
#endif
`:ee==="define-instanced"?Se==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${me}0;
in vec4 a_${me}1;
in vec4 a_${me}2;
in vec4 a_${me}3;
#else
uniform ${se} ${le} u_${me};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${se} ${Ee} a_${me};
#else
uniform ${se} ${le} u_${me};
#endif
`:ee==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${me}
    ${se} ${le} ${me} = a_${me};
#endif
`:Se==="vec4"?`
#ifndef HAS_UNIFORM_u_${me}
    ${se} ${le} ${me} = a_${me};
#else
    ${se} ${le} ${me} = u_${me};
#endif
`:`
#ifndef HAS_UNIFORM_u_${me}
    ${se} ${le} ${me} = unpack_mix_${Se}(a_${me}, u_${me}_t);
#else
    ${se} ${le} ${me} = u_${me};
#endif
`}),staticAttributes:w,usedDefines:H,vertexIncludes:A,fragmentIncludes:V}}class rf{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(i,l,y,w,M,A,V,H){this.context=i;let K=this.boundPaintVertexBuffers.length!==w.length;for(let se=0;!K&&se<w.length;se++)this.boundPaintVertexBuffers[se]!==w[se]&&(K=!0);let ee=this.boundDynamicVertexBuffers.length!==V.length;for(let se=0;!ee&&se<V.length;se++)this.boundDynamicVertexBuffers[se]!==V[se]&&(ee=!0);if(!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==y||K||ee||this.boundIndexBuffer!==M||this.boundVertexOffset!==A)this.freshBind(l,y,w,M,A,V,H);else{i.bindVertexArrayOES.set(this.vao);for(const se of V)se&&(se.bind(),H&&se.instanceCount&&se.setVertexAttribDivisor(i.gl,l,H));M&&M.dynamicDraw&&M.bind()}}freshBind(i,l,y,w,M,A,V){const H=i.numAttributes,K=this.context,ee=K.gl;this.vao&&this.destroy(),this.vao=K.gl.createVertexArray(),K.bindVertexArrayOES.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=y,this.boundIndexBuffer=w,this.boundVertexOffset=M,this.boundDynamicVertexBuffers=A,l.enableAttributes(ee,i),l.bind(),l.setVertexAttribPointers(ee,i,M);for(const se of y)se.enableAttributes(ee,i),se.bind(),se.setVertexAttribPointers(ee,i,M);for(const se of A)se&&(se.enableAttributes(ee,i),se.bind(),se.setVertexAttribPointers(ee,i,M),V&&se.instanceCount&&se.setVertexAttribDivisor(ee,i,V));w&&w.bind(),K.currentNumAttributes=H}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Eh(_,i){const l=Math.pow(2,i.canonical.z),y=i.canonical.y;return[new t.aa(0,y/l).toLngLat().lat,new t.aa(0,(y+1)/l).toLngLat().lat]}function af(_,i,l,y,w,M,A){const V=_.context,H=V.gl,K=l.hillshadeFBO;if(!K)return;_.prepareDrawTile();const ee=_.isTileAffectedByFog(i),se=_.getOrCreateProgram("hillshade",{overrideFog:ee});V.activeTexture.set(H.TEXTURE0),H.bindTexture(H.TEXTURE_2D,K.colorAttachment.get());const le=((ke,De,Xe,ut)=>{const st=Xe.paint.get("hillshade-shadow-color"),wt=Xe.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",gt=Xe.paint.get("hillshade-highlight-color"),vt=Xe.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",_t=Xe.paint.get("hillshade-accent-color"),Mt=Xe.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Ft=Xe.paint.get("hillshade-emissive-strength");let cn=t.ai(Xe.paint.get("hillshade-illumination-direction"));if(Xe.paint.get("hillshade-illumination-anchor")==="viewport")cn-=ke.transform.angle;else if(ke.style&&ke.style.enable3dLights()&&ke.style.directionalLight){const zt=ke.style.directionalLight.properties.get("direction"),Ht=t.cb(zt.x,zt.y,zt.z);cn=t.ai(Ht[1])}const en=!ke.options.moving;return{u_matrix:ut||ke.transform.calculateProjMatrix(De.tileID.toUnwrapped(),en),u_image:0,u_latrange:Eh(0,De.tileID),u_light:[Xe.paint.get("hillshade-exaggeration"),cn],u_shadow:st.toRenderColor(wt?null:Xe.lut),u_highlight:gt.toRenderColor(vt?null:Xe.lut),u_emissive_strength:Ft,u_accent:_t.toRenderColor(Mt?null:Xe.lut)}})(_,l,y,_.terrain?i.projMatrix:null);_.uploadCommonUniforms(V,se,i.toUnwrapped());const{tileBoundsBuffer:me,tileBoundsIndexBuffer:Ee,tileBoundsSegments:Se}=_.getTileBoundsBuffers(l);se.draw(_,H.TRIANGLES,w,M,A,or.disabled,le,y.id,me,Ee,Se)}function Wu(_,i,l){if(!i.needsDEMTextureUpload)return;const y=_.context,w=y.gl;y.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||_.getTileTexture(l.stride);const M=l.getPixels();i.demTexture?i.demTexture.update(M,{premultiply:!1}):i.demTexture=new t.T(y,M,w.R32F,{premultiply:!1}),i.needsDEMTextureUpload=!1}function sf(_,i,l){const y=_.context,w=y.gl;if(!i.dem)return;const M=i.dem;if(y.activeTexture.set(w.TEXTURE1),Wu(_,i,M),!i.demTexture)return;i.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE);const A=M.dim;y.activeTexture.set(w.TEXTURE0);let V=i.hillshadeFBO;if(!V){const le=new t.T(y,{width:A,height:A,data:null},w.RGBA8);le.bind(w.LINEAR,w.CLAMP_TO_EDGE),V=i.hillshadeFBO=y.createFramebuffer(A,A,!0,"renderbuffer"),V.colorAttachment.set(le.texture)}y.bindFramebuffer.set(V.framebuffer),y.viewport.set([0,0,A,A]);const{tileBoundsBuffer:H,tileBoundsIndexBuffer:K,tileBoundsSegments:ee}=_.getMercatorTileBoundsBuffers(),se=[];_.linearFloatFilteringSupported()&&se.push("TERRAIN_DEM_FLOAT_FORMAT"),_.getOrCreateProgram("hillshadePrepare",{defines:se}).draw(_,w.TRIANGLES,Zi.disabled,lr.disabled,Tr.unblended,or.disabled,((le,me)=>{const Ee=me.stride,Se=t.ab.mat4.create();return t.ab.mat4.ortho(Se,0,t.ag,-t.ag,0,0,1),t.ab.mat4.translate(Se,Se,[0,-t.ag,0]),{u_matrix:Se,u_image:1,u_dimension:[Ee,Ee],u_zoom:le.overscaledZ}})(i.tileID,M),l.id,H,K,ee),i.needsHillshadePrepare=!1}class ga{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Kp extends ga{getDefault(){return t.aj.transparent}set(i){const l=this.current;(i.r!==l.r||i.g!==l.g||i.b!==l.b||i.a!==l.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class jg extends ga{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class dd extends ga{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class tp extends ga{getDefault(){return[!0,!0,!0,!0]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||i[2]!==l[2]||i[3]!==l[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class np extends ga{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class fd extends ga{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class of extends ga{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const l=this.current;(i.func!==l.func||i.ref!==l.ref||i.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class ip extends ga{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||i[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class Jp extends ga{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;i?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=i,this.dirty=!1}}class gu extends ga{getDefault(){return[0,1]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class _u extends ga{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;i?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=i,this.dirty=!1}}class rp extends ga{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class Ro extends ga{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;i?l.enable(l.BLEND):l.disable(l.BLEND),this.current=i,this.dirty=!1}}class ns extends ga{getDefault(){const i=this.gl;return[i.ONE,i.ZERO,i.ONE,i.ZERO]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||i[2]!==l[2]||i[3]!==l[3]||this.dirty)&&(this.gl.blendFuncSeparate(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Bc extends ga{getDefault(){return t.aj.transparent}set(i){const l=this.current;(i.r!==l.r||i.g!==l.g||i.b!==l.b||i.a!==l.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class tl extends ga{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(i,i),this.current=i,this.dirty=!1)}}class lf extends ga{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;i?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=i,this.dirty=!1}}class cf extends ga{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class uf extends ga{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}let Xu=class extends ga{getDefault(){return null}set(_){(_!==this.current||this.dirty)&&(this.gl.useProgram(_),this.current=_,this.dirty=!1)}};class Yu extends ga{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class Mh extends ga{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||i[2]!==l[2]||i[3]!==l[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class pd extends ga{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class Qp extends ga{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Ku extends ga{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class em extends ga{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Gm extends ga{getDefault(){return null}set(i){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Ju extends ga{getDefault(){return null}set(i){this.gl&&(i!==this.current||this.dirty)&&(this.gl.bindVertexArray(i),this.current=i,this.dirty=!1)}}class tm extends ga{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class md extends ga{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class qm extends ga{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class gd extends ga{constructor(i,l){super(i),this.context=i,this.parent=l}getDefault(){return null}}class ap extends gd{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class sp extends gd{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Ih extends gd{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,this.attachment(),l.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class _d extends sp{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Ph=(_,i,l)=>({u_matrix:_,u_image0:0,u_skirt_height:i,u_ground_shadow_factor:l}),Lo=(_,i,l,y,w,M,A,V,H,K,ee,se,le,me,Ee,Se)=>({u_proj_matrix:Float32Array.from(_),u_globe_matrix:i,u_normalize_matrix:Float32Array.from(y),u_merc_matrix:l,u_zoom_transition:w,u_merc_center:M,u_image0:0,u_frustum_tl:A,u_frustum_tr:V,u_frustum_br:H,u_frustum_bl:K,u_globe_pos:ee,u_globe_radius:se,u_viewport:le,u_grid_matrix:Se?Float32Array.from(Se):new Float32Array(9),u_skirt_height:me,u_far_z_cutoff:Ee});function ms(_,i){return _!=null&&i!=null&&!(!_.hasData()||!i.hasData())&&_.demTexture!=null&&i.demTexture!=null&&_.tileID.key!==i.tileID.key}const zo=new class{constructor(){this.operations={}}newMorphing(_,i,l,y,w){if(_ in this.operations){const M=this.operations[_];M.to.tileID.key!==l.tileID.key&&(M.queued=l)}else this.operations[_]={startTime:y,phase:0,duration:w,from:i,to:l,queued:null}}getMorphValuesForProxy(_){if(!(_ in this.operations))return null;const i=this.operations[_];return{from:i.from,to:i.to,phase:i.phase}}update(_){for(const i in this.operations){const l=this.operations[i];for(l.phase=(_-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,_)){delete this.operations[i];break}}}_nextOp(_,i){return!!_.queued&&(_.from=_.to,_.to=_.queued,_.queued=null,_.phase=0,_.startTime=i,!0)}_validOp(_){return _.from.hasData()&&_.to.hasData()}},Ol={0:null,1:"TERRAIN_VERTEX_MORPHING"};function ml(_,i,l){if(i===0)return 0;const y=i<1&&l===514?.25/i:1;return 6*Math.pow(1.5,22-_)*Math.max(i,1)*y}function nm(_,i){const l=1<<_.z;return!i&&(_.x===0||_.x===l-1)||_.y===0||_.y===l-1}const Vc=_=>({u_matrix:_});function hf(_,i,l,y,w){if(w>0){const M=t.q.now(),A=(M-_.timeAdded)/w,V=i?(M-i.timeAdded)/w:-1,H=l.getSource(),K=y.coveringZoomLevel({tileSize:H.tileSize,roundZoom:H.roundZoom}),ee=!i||Math.abs(i.tileID.overscaledZ-K)>Math.abs(_.tileID.overscaledZ-K),se=ee&&_.refreshedUponExpiration?1:t.aw(ee?A:1-V,0,1);return _.refreshedUponExpiration&&A>=1&&(_.refreshedUponExpiration=!1),i?{opacity:1,mix:1-se}:{opacity:se,mix:0}}return{opacity:1,mix:0}}class op extends ts{constructor(i){const l={type:"raster-dem",maxzoom:i.transform.maxZoom},y=new t.D(t.ci(),null),w=ru("mock-dem",l,y,i.style);super("mock-dem",w,!1),w.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,l){i.state="loaded",l(null)}}class lp extends ts{constructor(i){const l=ru("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new t.D(t.ci(),null),i.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,l,y){if(i.freezeTileCoverage)return;this.transform=i;const w=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((M,A)=>{if(M[A.key]="",!this._tiles[A.key]){const V=new ss(A,this._source.tileSize*A.overscaleFactor(),i.tileZoom);V.state="loaded",this._tiles[A.key]=V}return M},{});for(const M in this._tiles)M in w||(this.freeFBO(M),this._tiles[M].unloadVectorData(),delete this._tiles[M])}freeFBO(i){const l=this.proxyCachedFBO[i];if(l!==void 0){const y=Object.values(l);this.renderCachePool.push(...y),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Nc extends t.aG{constructor(i,l,y){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=l,this.projMatrix=y}}class jc extends t.cJ{constructor(i,l){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},i.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),i.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[y,w,M]=function(H){const K=new t.b4,ee=new t.aU,se=131;K.reserve(17161),ee.reserve(33800);const le=t.ag/128,me=t.ag+le/2,Ee=me+le;for(let ke=-le;ke<Ee;ke+=le)for(let De=-le;De<Ee;De+=le){const Xe=De<0||De>me||ke<0||ke>me?24575:0,ut=t.aw(Math.round(De),0,t.ag),st=t.aw(Math.round(ke),0,t.ag);K.emplaceBack(ut+Xe,st)}const Se=(ke,De)=>{const Xe=De*se+ke;ee.emplaceBack(Xe+1,Xe,Xe+se),ee.emplaceBack(Xe+se,Xe+se+1,Xe+1)};for(let ke=1;ke<129;ke++)for(let De=1;De<129;De++)Se(De,ke);return[0,129].forEach(ke=>{for(let De=0;De<130;De++)Se(De,ke),Se(ke,De)}),[K,ee,32768]}(),A=i.context;this.gridBuffer=A.createVertexBuffer(y,t.b6.members),this.gridIndexBuffer=A.createIndexBuffer(w),this.gridSegments=t.b7.simpleSegment(0,0,y.length,w.length),this.gridNoSkirtSegments=t.b7.simpleSegment(0,0,y.length,M),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new lp(l.map),this.orthoMatrix=t.ab.mat4.create(),t.ab.mat4.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,t.ag,0,t.ag,0,1);const V=A.gl;this._overlapStencilMode=new lr({func:V.GEQUAL,mask:255},0,255,V.KEEP,V.KEEP,V.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new op(l.map),this._pendingGroundEffectLayers=[]}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),this._style=i,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(i,l,y){if(i&&i.terrain){this._style!==i&&(this.style=i,this._evaluationZoom=void 0);const w=i.terrain.properties,M=i.terrain.drapeRenderMode===0,A=i.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=t.q.now();const V=i.terrain&&i.terrain.scope,H=w.get("source"),K=M?this._mockSourceCache:i.getSourceCache(H,V);if(!K)return void t.w(`Couldn't find terrain source "${H}".`);if(this.sourceCache=K,this._attenuationRange=i.terrain.getAttenuationRange(),this._exaggeration=A?this.calculateExaggeration(l):w.get("exaggeration"),!l.projection.requiresDraping&&A&&this._exaggeration===0)return void this._disable();this.enabled=!0;const ee=()=>{this.sourceCache.used&&t.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const se=this.getScaledDemTileSize();this.sourceCache.update(l,se,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,ee(),this._initializing=!0),ee(),l.updateElevation(!0,y),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0,this._previousZoom=l.zoom}else this._disable()}calculateExaggeration(i){if(this._attenuationRange&&i.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(i.zoom);const l=this._previousCameraAltitude,y=i.getFreeCameraOptions().position.z/i.pixelsPerMeter*i.worldSize;this._previousCameraAltitude=y;const w=l!=null?y-l:Number.MAX_VALUE;if(Math.abs(w)<2)return this._exaggeration;const M=i.zoom,A=this._style.terrain;if(!this._previousUpdateTimestamp)return A.getExaggeration(M);let V=M-this._previousZoom;const H=this._previousUpdateTimestamp;let K=M;this._evaluationZoom!=null&&(K=this._evaluationZoom,Math.abs(M-K)>.5&&(V=.5*(M-K+V)),V*w<0&&(K+=V)),this._evaluationZoom=K;const ee=A.getExaggeration(K),se=ee===A.getExaggeration(Math.max(0,K-.1));if(se&&Math.abs(ee-this._exaggeration)<.01)return ee;let le=Math.min(.1,.00375*(this._updateTimestamp-H));return(se||ee<.1||Math.abs(V)<1e-4)&&(le=Math.min(.2,4*le)),t.af(this._exaggeration,ee,le)}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(i){i.coord&&i.dataType==="source"?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):i.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const i in this._style._mergedSourceCaches)this._style._mergedSourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const l=this.proxySourceCache,y=this.painter.transform;this._initializing&&(this._initializing=y._centerAltitude===0&&this.getAtPointOrZero(t.aa.fromLngLat(y.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const w=this.proxyCoords=l.getIds().map(H=>{const K=l.getTileByID(H).tileID;return K.projMatrix=y.calculateProjMatrix(K.toUnwrapped()),K});(function(H,K){const ee=K.transform.pointCoordinate(K.transform.getCameraPoint()),se=new t.P(ee.x,ee.y);H.sort((le,me)=>{if(me.overscaledZ-le.overscaledZ)return me.overscaledZ-le.overscaledZ;const Ee=new t.P(le.canonical.x+(1<<le.canonical.z)*le.wrap,le.canonical.y),Se=new t.P(me.canonical.x+(1<<me.canonical.z)*me.wrap,me.canonical.y),ke=se.mult(1<<le.canonical.z);return ke.x-=.5,ke.y-=.5,ke.distSqr(Ee)-ke.distSqr(Se)})})(w,this.painter);const M=this.proxyToSource||{};this.proxyToSource={},w.forEach(H=>{this.proxyToSource[H.key]={}}),this.terrainTileForTile={};const A=this._style._mergedSourceCaches;for(const H in A){const K=A[H];if(!K.used||(K!==this.sourceCache&&this.resetTileLookupCache(K.id),this._setupProxiedCoordsForOrtho(K,i[H],M),K.usedForTerrain))continue;const ee=i[H];K.getSource().reparseOverscaled&&this._assignTerrainTiles(ee)}this.proxiedCoords[l.id]=w.map(H=>new Nc(H,H.key,this.orthoMatrix)),this._assignTerrainTiles(w),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(M),this.renderingToTexture=!1;const V={};this._visibleDemTiles=[];for(const H of this.proxyCoords){const K=this.terrainTileForTile[H.key];if(!K)continue;const ee=K.tileID.key;ee in V||(this._visibleDemTiles.push(K),V[ee]=ee)}}_assignTerrainTiles(i){this._initializing||i.forEach(l=>{if(this.terrainTileForTile[l.key])return;const y=this._findTileCoveringTileID(l,this.sourceCache);y&&(this.terrainTileForTile[l.key]=y)})}_prepareDEMTextures(){const i=this.painter.context,l=i.gl;for(const y in this.terrainTileForTile){const w=this.terrainTileForTile[y],M=w.dem;!M||w.demTexture&&!w.needsDEMTextureUpload||(i.activeTexture.set(l.TEXTURE1),Wu(this.painter,w,M))}}_prepareDemTileUniforms(i,l,y,w){if(!l||l.demTexture==null)return!1;const M=i.tileID.canonical,A=Math.pow(2,l.tileID.canonical.z-M.z),V=w||"";return y[`u_dem_tl${V}`]=[M.x*A%1,M.y*A%1],y[`u_dem_scale${V}`]=A,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let i=0;const l=this._visibleDemTiles.reduce((y,w)=>{if(!w.dem)return y;const M=w.dem.tree.minimums[0];return M>0&&i++,y+M},0);return i?l/i:0}_updateEmptyDEMTexture(){const i=this.painter.context,l=i.gl;i.activeTexture.set(l.TEXTURE2);const y=this._getLoadedAreaMinimum(),w=new t.cK({width:1,height:1},new Float32Array([y]));this._emptyDEMTextureDirty=!1;let M=this._emptyDEMTexture;return M?M.update(w,{premultiply:!1}):M=this._emptyDEMTexture=new t.T(i,w,l.R32F,{premultiply:!1}),M}setupElevationDraw(i,l,y){const w=this.painter.context,M=w.gl,A={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};A.u_exaggeration=this.exaggeration();let V=null,H=null,K=1;if(y&&y.morphing&&this._useVertexMorphing){const me=y.morphing.srcDemTile,Ee=y.morphing.dstDemTile;K=y.morphing.phase,me&&Ee&&(this._prepareDemTileUniforms(i,me,A,"_prev")&&(H=me),this._prepareDemTileUniforms(i,Ee,A)&&(V=Ee))}const ee=me=>me&&me.demTexture&&this.painter.linearFloatFilteringSupported()?M.LINEAR:M.NEAREST;let se=null;var le;if(this.enabled?H&&V?(se=V.demTexture,w.activeTexture.set(M.TEXTURE4),H.demTexture.bind(ee(H),M.CLAMP_TO_EDGE),A.u_dem_lerp=K):(V=this.terrainTileForTile[i.tileID.key],se=this._prepareDemTileUniforms(i,V,A)?V.demTexture:this.emptyDEMTexture):se=this.emptyDEMTexture,w.activeTexture.set(M.TEXTURE2),se&&(A.u_dem_size=(le=se).size[0]===1?1:le.size[0]-2,se.bind(ee(V),M.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(y&&y.useDepthForOcclusion,l,A),y&&y.useMeterToDem&&V){const me=(1<<V.tileID.canonical.z)*t.bH(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;A.u_meter_to_dem=me}if(y&&y.labelPlaneMatrixInv&&(A.u_label_plane_matrix_inv=y.labelPlaneMatrixInv),l.setTerrainUniformValues(w,A),this.painter.transform.projection.name==="globe"){const me=this.globeUniformValues(this.painter.transform,i.tileID.canonical,y&&y.useDenormalizedUpVectorScale);l.setGlobeUniformValues(w,me)}}globeUniformValues(i,l,y){const w=i.projection;return{u_tile_tl_up:w.upVector(l,0,0),u_tile_tr_up:w.upVector(l,t.ag,0),u_tile_br_up:w.upVector(l,t.ag,t.ag),u_tile_bl_up:w.upVector(l,0,t.ag),u_tile_up_scale:y?t.cL(1):w.upVectorScale(l,i.center.lat,i.worldSize).metersToTile}}renderToBackBuffer(i){const l=this.painter,y=this.painter.context;i.length!==0&&(y.bindFramebuffer.set(null),y.viewport.set([0,0,l.width,l.height]),l.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(w,M,A,V,H){if(w.transform.projection.name==="globe")(function(K,ee,se,le,me){const Ee=K.context,Se=Ee.gl;let ke,De;const Xe=K.transform,ut=t.cC(K,Ee,Xe),st=(zt,Ht)=>{if(De===Ht)return;const En=[Ol[Ht],"PROJECTION_GLOBE_VIEW"];ut&&En.push("CUSTOM_ANTIALIASING");const Vn=K.isTileAffectedByFog(zt);ke=K.getOrCreateProgram("globeRaster",{defines:En,overrideFog:Vn}),De=Ht},wt=K.colorModeForRenderPass(),gt=new Zi(Se.LEQUAL,Zi.ReadWrite,K.depthRangeFor3D);zo.update(me);const vt=t.cD(Xe),_t=[t.at(Xe.center.lng),t.aA(Xe.center.lat)],Mt=K.globeSharedBuffers,Ft=[Xe.width*t.q.devicePixelRatio,Xe.height*t.q.devicePixelRatio],cn=Float32Array.from(Xe.globeMatrix),en={useDenormalizedUpVectorScale:!0};{const zt=K.transform,Ht=ml(zt.zoom,ee.exaggeration(),ee.sourceCache._source.tileSize);De=-1;const En=Se.TRIANGLES;for(const Vn of le){const ti=se.getTile(Vn),Qt=lr.disabled,An=ee.prevTerrainTileForTile[Vn.key],dn=ee.terrainTileForTile[Vn.key];ms(An,dn)&&zo.newMorphing(Vn.key,An,dn,me,250),Ee.activeTexture.set(Se.TEXTURE0),ti.texture&&ti.texture.bind(Se.LINEAR,Se.CLAMP_TO_EDGE);const Jn=zo.getMorphValuesForProxy(Vn.key),Fn=Jn?1:0;Jn&&t.J(en,{morphing:{srcDemTile:Jn.from,dstDemTile:Jn.to,phase:t.cB(Jn.phase)}});const wn=t.cE(Vn.canonical),Mi=t.cF(wn.getCenter().lat),si=t.cG(Vn.canonical,wn,Mi,zt.worldSize/zt._pixelsPerMercatorPixel),Ii=t.bb(t.cH(Vn.canonical)),Ai=Lo(zt.expandedFarZProjMatrix,cn,vt,Ii,t.ae(zt.zoom),_t,zt.frustumCorners.TL,zt.frustumCorners.TR,zt.frustumCorners.BR,zt.frustumCorners.BL,zt.globeCenterInViewSpace,zt.globeRadius,Ft,Ht,zt._farZ,si);if(st(Vn,Fn),ke&&(ee.setupElevationDraw(ti,ke,en),K.uploadCommonUniforms(Ee,ke,Vn.toUnwrapped()),Mt)){const[ur,Xi,er]=Mt.getGridBuffers(Mi,Ht!==0);ke.draw(K,En,gt,Qt,wt,or.backCCW,Ai,"globe_raster",ur,Xi,er)}}}if(Mt&&(K.renderDefaultNorthPole||K.renderDefaultSouthPole)){const zt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ut&&zt.push("CUSTOM_ANTIALIASING"),ke=K.getOrCreateProgram("globeRaster",{defines:zt});for(const Ht of le){const{x:En,y:Vn,z:ti}=Ht.canonical,Qt=Vn===0,An=Vn===(1<<ti)-1,[dn,Jn,Fn,wn]=Mt.getPoleBuffers(ti,!1);if(wn&&(Qt||An)){const Mi=se.getTile(Ht);Ee.activeTexture.set(Se.TEXTURE0),Mi.texture&&Mi.texture.bind(Se.LINEAR,Se.CLAMP_TO_EDGE);let si=t.cI(ti,En,Xe);const Ii=t.bb(t.cH(Ht.canonical)),Ai=(ur,Xi)=>ur.draw(K,Se.TRIANGLES,gt,lr.disabled,wt,or.disabled,Lo(Xe.expandedFarZProjMatrix,si,si,Ii,0,_t,Xe.frustumCorners.TL,Xe.frustumCorners.TR,Xe.frustumCorners.BR,Xe.frustumCorners.BL,Xe.globeCenterInViewSpace,Xe.globeRadius,Ft,0,Xe._farZ),"globe_pole_raster",Xi,Fn,wn);ee.setupElevationDraw(Mi,ke,en),K.uploadCommonUniforms(Ee,ke,Ht.toUnwrapped()),Qt&&K.renderDefaultNorthPole&&Ai(ke,dn),An&&K.renderDefaultSouthPole&&(si=t.ab.mat4.scale(t.ab.mat4.create(),si,[1,-1,1]),Ai(ke,Jn))}}}})(w,M,A,V,H);else{const K=w.context,ee=K.gl;let se,le;const me=w.shadowRenderer,Ee=Oc(w,w.longestCutoffRange),Se=wt=>{if(le===wt)return;const gt=[];gt.push(Ol[wt]),Ee.shouldRenderCutoff&&gt.push("RENDER_CUTOFF"),me&&(gt.push("RENDER_SHADOWS","DEPTH_TEXTURE"),me.useNormalOffset&&gt.push("NORMAL_OFFSET")),se=w.getOrCreateProgram("terrainRaster",{defines:gt}),le=wt},ke=w.colorModeForRenderPass(),De=new Zi(ee.LEQUAL,Zi.ReadWrite,w.depthRangeFor3D);zo.update(H);const Xe=w.transform,ut=ml(Xe.zoom,M.exaggeration(),M.sourceCache._source.tileSize);let st=[0,0,0];if(me){const wt=w.style.directionalLight,gt=w.style.ambientLight;wt&&gt&&(st=cd(w.style,wt,gt))}{le=-1;const wt=ee.TRIANGLES,[gt,vt]=[M.gridIndexBuffer,M.gridSegments];for(const _t of V){const Mt=A.getTile(_t),Ft=lr.disabled,cn=M.prevTerrainTileForTile[_t.key],en=M.terrainTileForTile[_t.key];ms(cn,en)&&zo.newMorphing(_t.key,cn,en,H,250),K.activeTexture.set(ee.TEXTURE0),Mt.texture&&Mt.texture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE);const zt=zo.getMorphValuesForProxy(_t.key),Ht=zt?1:0;let En;zt&&(En={morphing:{srcDemTile:zt.from,dstDemTile:zt.to,phase:t.cB(zt.phase)}});const Vn=Ph(_t.projMatrix,nm(_t.canonical,Xe.renderWorldCopies)?ut/10:ut,st);if(Se(Ht),!se)continue;M.setupElevationDraw(Mt,se,En);const ti=_t.toUnwrapped();me&&me.setupShadows(ti,se),w.uploadCommonUniforms(K,se,ti,null,Ee),se.draw(w,wt,De,Ft,ke,or.backCCW,Vn,"terrain_raster",M.gridBuffer,gt,vt)}}}}(l,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,l.gpuTimingDeferredRenderEnd(),i.splice(0,i.length))}renderBatch(i){if(this._drapedRenderBatches.length===0)return i+1;this.renderingToTexture=!0;const l=this.painter,y=this.painter.context,w=this.proxySourceCache,M=this.proxiedCoords[w.id],A=this._drapedRenderBatches.shift(),V=l.style.order,H=[];let K=0;for(const ee of M){const se=w.getTileByID(ee.proxyTileKey),le=w.proxyCachedFBO[ee.key]?w.proxyCachedFBO[ee.key][i]:void 0,me=le!==void 0?w.renderCache[le]:this.pool[K++],Ee=le!==void 0;if(se.texture=me.tex,Ee&&!me.dirty){H.push(se.tileID);continue}let Se;y.bindFramebuffer.set(me.fb.framebuffer),this.renderedToTile=!1,me.dirty&&(y.clear({color:t.aj.transparent,stencil:0}),me.dirty=!1);for(let ke=A.start;ke<=A.end;++ke){const De=l.style._mergedLayers[V[ke]];if(De.isHidden(l.transform.zoom))continue;const Xe=l.style.getLayerSourceCache(De),ut=Xe?this.proxyToSource[ee.key][Xe.id]:[ee];if(!ut)continue;const st=ut;y.viewport.set([0,0,me.fb.width,me.fb.height]),Se!==(Xe?Xe.id:null)&&(this._setupStencil(me,ut,De,Xe),Se=Xe?Xe.id:null),l.renderLayer(l,Xe,De,st)}if(this._drapedRenderBatches.length===0)for(const ke of this._pendingGroundEffectLayers){const De=l.style._mergedLayers[V[ke]];if(De.isHidden(l.transform.zoom))continue;const Xe=l.style.getLayerSourceCache(De),ut=Xe?this.proxyToSource[ee.key][Xe.id]:[ee];if(!ut)continue;const st=ut;y.viewport.set([0,0,me.fb.width,me.fb.height]),Se!==(Xe?Xe.id:null)&&(this._setupStencil(me,ut,De,Xe),Se=Xe?Xe.id:null),l.renderLayer(l,Xe,De,st)}this.renderedToTile?(me.dirty=!0,H.push(se.tileID)):Ee||--K,K===5&&(K=0,this.renderToBackBuffer(H))}return this.renderToBackBuffer(H),this.renderingToTexture=!1,y.bindFramebuffer.set(null),y.viewport.set([0,0,l.width,l.height]),A.end+1}postRender(){}isLayerOrderingCorrect(i){const l=i.order.length;let y=-1,w=l;for(let M=0;M<l;++M)this._style.isLayerDraped(i._mergedLayers[i.order[M]])?y=Math.max(y,M):w=Math.min(w,M);return w>y}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{i=Math.min(i,l.dem.tree.minimums[0])}),i===0?i:(i-30)*this._exaggeration}raycast(i,l,y){if(!this._visibleDemTiles)return null;const w=this._visibleDemTiles.filter(M=>M.dem).map(M=>{const A=M.tileID,V=1<<A.overscaledZ,{x:H,y:K}=A.canonical,ee=H/V,se=(H+1)/V,le=K/V,me=(K+1)/V;return{minx:ee,miny:le,maxx:se,maxy:me,t:M.dem.tree.raycastRoot(ee,le,se,me,i,l,y),tile:M}});w.sort((M,A)=>(M.t!==null?M.t:Number.MAX_VALUE)-(A.t!==null?A.t:Number.MAX_VALUE));for(const M of w){if(M.t==null)return null;const A=M.tile.dem.tree.raycast(M.minx,M.miny,M.maxx,M.maxy,i,l,y);if(A!=null)return A}return null}_createFBO(){const i=this.painter.context,l=i.gl,y=this.drapeBufferSize;i.activeTexture.set(l.TEXTURE0);const w=new t.T(i,{width:y[0],height:y[1],data:null},l.RGBA8);w.bind(l.LINEAR,l.CLAMP_TO_EDGE);const M=i.createFramebuffer(y[0],y[1],!0,null);return M.colorAttachment.set(w.texture),M.depthAttachment=new _d(i,M.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,y[0],y[1]),this._stencilRef=0,M.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):M.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&l.texParameterf(l.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:M,tex:w,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const i in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{const l=this._style._mergedLayers[i],y=l.isHidden(this.painter.transform.zoom);return l.type==="hillshade"||l.type==="custom"?!y&&l.shouldRedrape():!y&&l.hasTransition()})}_clearLineLayersFromRenderCache(){let i=!1;for(const y of this._style.getSources())if(y instanceof Yh){i=!0;break}if(!i)return;const l={};for(let y=0;y<this._style.order.length;++y){const w=this._style._mergedLayers[this._style.order[y]],M=this._style.getLayerSourceCache(w);if(M&&!l[M.id]&&!w.isHidden(this.painter.transform.zoom)&&w.type==="line"&&w.widthExpression()instanceof t.a9){l[M.id]=!0;for(const A of this.proxyCoords){const V=this.proxyToSource[A.key][M.id];if(V)for(const H of V)this._clearRenderCacheForTile(M.id,H)}}}}_clearRasterLayersFromRenderCache(){let i=!1;for(const y in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[y]._source instanceof Zl){i=!0;break}if(!i)return;const l={};for(let y=0;y<this._style.order.length;++y){const w=this._style._mergedLayers[this._style.order[y]],M=this._style.getLayerSourceCache(w);if(!M||l[M.id]||w.isHidden(this.painter.transform.zoom)||w.type!=="raster")continue;const A=w.paint.get("raster-fade-duration");for(const V of this.proxyCoords){const H=this.proxyToSource[V.key][M.id];if(H)for(const K of H){const ee=hf(M.getTile(K),M.findLoadedParent(K,0),M,this.painter.transform,A);(ee.opacity!==1||ee.mix!==0)&&this._clearRenderCacheForTile(M.id,K)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const i=this._style.order,l=i.length;if(l===0)return;const y=[];this._pendingGroundEffectLayers=[];let w,M=0,A=this._style._mergedLayers[i[M]];for(;!this._style.isLayerDraped(A)&&A.isHidden(this.painter.transform.zoom)&&++M<l;)A=this._style._mergedLayers[i[M]];for(;M<l;++M){const V=this._style._mergedLayers[i[M]];V.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(V)?w===void 0&&(w=M):(V.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(M),w!==void 0&&(y.push({start:w,end:M-1}),w=void 0)))}if(w!==void 0&&y.push({start:w,end:M-1}),y.length!==0){const V=y[y.length-1];this._pendingGroundEffectLayers.every(H=>H>V.end)||t.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=y}_setupRenderCache(i){const l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){const A=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let V=0;V<A.length;++V){const H=Object.values(A[V]);l.renderCachePool.push(...H)}}return}this._clearRasterLayersFromRenderCache();const y=this.proxyCoords,w=this._tilesDirty;for(let A=y.length-1;A>=0;A--){const V=y[A];if(l.getTileByID(V.key),l.proxyCachedFBO[V.key]!==void 0){const H=i[V.key],K=this.proxyToSource[V.key];let ee=0;for(const se in K){const le=K[se],me=H[se];if(!me||me.length!==le.length||le.some((Ee,Se)=>Ee!==me[Se]||w[se]&&w[se].hasOwnProperty(Ee.key))){ee=-1;break}++ee}for(const se in l.proxyCachedFBO[V.key])l.renderCache[l.proxyCachedFBO[V.key][se]].dirty=ee<0||ee!==Object.values(H).length}}const M=[...this._drapedRenderBatches];M.sort((A,V)=>V.end-V.start-(A.end-A.start));for(const A of M)for(const V of y){if(l.proxyCachedFBO[V.key])continue;let H=l.renderCachePool.pop();H===void 0&&l.renderCache.length<50&&(H=l.renderCache.length,l.renderCache.push(this._createFBO())),H!==void 0&&(l.proxyCachedFBO[V.key]={},l.proxyCachedFBO[V.key][A.start]=H,l.renderCache[H].dirty=!0)}this._tilesDirty={}}_setupStencil(i,l,y,w){if(!w||!this._sourceTilesOverlap[w.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const M=this.painter.context,A=M.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let V;if(y.isTileClipped())V=l.length,this._overlapStencilMode.test={func:A.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);V=1,this._overlapStencilMode.test={func:A.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+V>255&&(M.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=V,this._overlapStencilMode.ref=this._stencilRef,y.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):lr.disabled}_renderTileClippingMasks(i,l){const y=this.painter,w=this.painter.context,M=w.gl;y._tileClippingMaskIDs={},w.setColorMode(Tr.disabled),w.setDepthMode(Zi.disabled);const A=y.getOrCreateProgram("clippingMask");for(const V of i){const H=y._tileClippingMaskIDs[V.key]=--l;A.draw(y,M.TRIANGLES,Zi.disabled,new lr({func:M.ALWAYS,mask:0},H,255,M.KEEP,M.KEEP,M.REPLACE),Tr.disabled,or.disabled,Vc(V.projMatrix),"$clipping",y.tileExtentBuffer,y.quadTriangleIndexBuffer,y.tileExtentSegments)}}pointCoordinate(i){const l=this.painter.transform;if(i.x<0||i.x>l.width||i.y<0||i.y>l.height)return null;const y=[i.x,i.y,1,1];t.ab.vec4.transformMat4(y,y,l.pixelMatrixInverse),t.ab.vec4.scale(y,y,1/y[3]),y[0]/=l.worldSize,y[1]/=l.worldSize;const w=l._camera.position,M=t.bH(1,l.center.lat),A=[w[0],w[1],w[2]/M,0],V=t.ab.vec3.subtract([],y.slice(0,3),A);t.ab.vec3.normalize(V,V);const H=this.raycast(A,V,this._exaggeration);return H!==null&&H?(t.ab.vec3.scaleAndAdd(A,A,V,H),A[3]=A[2],A[2]*=M,A):null}_setupProxiedCoordsForOrtho(i,l,y){if(i.getSource()instanceof t.aJ)return this._setupProxiedCoordsForImageSource(i,l,y);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};const w=this.proxiedCoords[i.id]=[],M=this.proxyCoords;for(let H=0;H<M.length;H++){const K=M[H],ee=this._findTileCoveringTileID(K,i);if(ee){const se=this._createProxiedId(K,ee,y[K.key]&&y[K.key][i.id]);w.push(se),this.proxyToSource[K.key][i.id]=[se]}}let A=!1;const V=new Set;for(let H=0;H<l.length;H++){const K=i.getTile(l[H]);if(!K||!K.hasData())continue;const ee=this._findTileCoveringTileID(K.tileID,this.proxySourceCache);if(ee&&ee.tileID.canonical.z!==K.tileID.canonical.z){const se=this.proxyToSource[ee.tileID.key][i.id],le=this._createProxiedId(ee.tileID,K,y[ee.tileID.key]&&y[ee.tileID.key][i.id]);se?se.splice(se.length-1,0,le):this.proxyToSource[ee.tileID.key][i.id]=[le];const me=this.proxyToSource[ee.tileID.key][i.id];V.has(me)||V.add(me),w.push(le),A=!0}}if(this._sourceTilesOverlap[i.id]=A,A&&this._debugParams.sortTilesHiZFirst)for(const H of V)H.sort((K,ee)=>ee.overscaledZ-K.overscaledZ)}_setupProxiedCoordsForImageSource(i,l,y){if(!i.getSource().loaded())return;const w=this.proxiedCoords[i.id]=[],M=this.proxyCoords,A=i.getSource(),V=A.tileID;if(!V)return;const H=new t.P(V.x,V.y)._div(1<<V.z),K=A.coordinates.map(t.aa.fromLngLat).reduce((se,le)=>(se.min.x=Math.min(se.min.x,le.x-H.x),se.min.y=Math.min(se.min.y,le.y-H.y),se.max.x=Math.max(se.max.x,le.x-H.x),se.max.y=Math.max(se.max.y,le.y-H.y),se),{min:new t.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new t.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),ee=(se,le)=>{const me=se.wrap+se.canonical.x/(1<<se.canonical.z),Ee=se.canonical.y/(1<<se.canonical.z),Se=t.ag/(1<<se.canonical.z),ke=le.wrap+le.canonical.x/(1<<le.canonical.z),De=le.canonical.y/(1<<le.canonical.z);return me+Se<ke+K.min.x||me>ke+K.max.x||Ee+Se<De+K.min.y||Ee>De+K.max.y};for(let se=0;se<M.length;se++){const le=M[se];for(let me=0;me<l.length;me++){const Ee=i.getTile(l[me]);if(!Ee||!Ee.hasData()||ee(le,Ee.tileID))continue;const Se=this._createProxiedId(le,Ee,y[le.key]&&y[le.key][i.id]),ke=this.proxyToSource[le.key][i.id];ke?ke.push(Se):this.proxyToSource[le.key][i.id]=[Se],w.push(Se)}}}_createProxiedId(i,l,y){let w=this.orthoMatrix;if(y){const M=y.find(A=>A.key===l.tileID.key);if(M)return M}if(l.tileID.key!==i.key){const M=i.canonical.z-l.tileID.canonical.z;let A,V,H;w=t.ab.mat4.create();const K=l.tileID.wrap-i.wrap<<i.overscaledZ;M>0?(A=t.ag>>M,V=A*((l.tileID.canonical.x<<M)-i.canonical.x+K),H=A*((l.tileID.canonical.y<<M)-i.canonical.y)):(A=t.ag<<-M,V=t.ag*(l.tileID.canonical.x-(i.canonical.x+K<<-M)),H=t.ag*(l.tileID.canonical.y-(i.canonical.y<<-M))),t.ab.mat4.ortho(w,0,A,0,A,0,1),t.ab.mat4.translate(w,w,[V,H,0])}return new Nc(l.tileID,i.key,w)}_findTileCoveringTileID(i,l){let y=l.getTile(i);if(y&&y.hasData())return y;const w=this._findCoveringTileCache[l.id],M=w[i.key];if(y=M?l.getTileByID(M):null,y&&y.hasData()||M===null)return y;let A=y?y.tileID:i,V=A.overscaledZ;const H=l.getSource().minzoom,K=[];if(!M){const se=l.getSource().maxzoom;if(i.canonical.z>=se){const le=i.canonical.z-se;l.getSource().reparseOverscaled?(V=Math.max(i.canonical.z+2,l.transform.tileZoom),A=new t.aG(V,i.wrap,se,i.canonical.x>>le,i.canonical.y>>le)):le!==0&&(V=se,A=new t.aG(V,i.wrap,se,i.canonical.x>>le,i.canonical.y>>le))}A.key!==i.key&&(K.push(A.key),y=l.getTile(A))}const ee=se=>{K.forEach(le=>{w[le]=se}),K.length=0};for(V-=1;V>=H&&(!y||!y.hasData());V--){y&&ee(y.tileID.key);const se=A.calculateScaledKey(V);if(y=l.getTileByID(se),y&&y.hasData())break;const le=w[se];if(le===null)break;le===void 0?K.push(se):y=l.getTileByID(le)}return ee(y?y.tileID.key:null),y&&y.hasData()?y:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(i,l){let y=this._tilesDirty[i];y||(y=this._tilesDirty[i]={}),y[l.key]=!0}}function Yi(_,i,l){const y=function(V,H,K){const ee=t.ab.vec3.dot(H,V),se=t.ab.vec3.dot(K,[.2126,.7152,.0722]),le=(Ee,Se,ke)=>(1-ke)*Ee+ke*Se,me=le(1-.3*Math.min(se,1),1,Math.min(ee+1,1));return le(.92,1,Math.asin(t.aw(H[2],-1,1))/Math.PI+.5)*me}(_,[0,0,1],i),w=[0,0,0];t.ab.vec3.scale(w,l.slice(0,3),y);const M=[0,0,0];t.ab.vec3.scale(M,i.slice(0,3),_[2]);const A=[0,0,0];return t.ab.vec3.add(A,w,M),t.cf(A)}const yd=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Ah=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","model","symbol"];class im{static cacheKey(i,l,y,w){let M=`${l}${w?w.cacheKey:""}`;for(const A of y)i.usedDefines.includes(A)&&(M+=`/${A}`);return M}constructor(i,l,y,w,M,A){const V=i.gl;this.program=V.createProgram(),this.configuration=w,this.name=l,this.fixedDefines=[...A];const H=w?w.getBinderAttributes():[],K=(y.staticAttributes||[]).concat(H);let ee=w?w.defines():[];ee=ee.concat(A.map(ke=>`#define ${ke}`));const se=`#version 300 es
`;let le=se+ee.concat("precision mediump float;",Qf,Jf.fragmentSource).join(`
`);for(const ke of y.fragmentIncludes)le+=`
${zl[ke]}`;le+=`
${y.fragmentSource}`;let me=se+ee.concat("precision highp float;",Qf,Jf.vertexSource).join(`
`);for(const ke of y.vertexIncludes)me+=`
${zl[ke]}`;this.forceManualRenderingForInstanceIDShaders=i.forceManualRenderingForInstanceIDShaders&&y.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(me+=`
uniform int u_instanceID;
`),me+=`
${y.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(me=me.replaceAll("gl_InstanceID","u_instanceID"));const Ee=V.createShader(V.FRAGMENT_SHADER);if(V.isContextLost())return void(this.failedToCreate=!0);V.shaderSource(Ee,le),V.compileShader(Ee),V.attachShader(this.program,Ee);const Se=V.createShader(V.VERTEX_SHADER);if(V.isContextLost())this.failedToCreate=!0;else{V.shaderSource(Se,me),V.compileShader(Se),V.attachShader(this.program,Se),this.attributes={},this.numAttributes=K.length;for(let ke=0;ke<this.numAttributes;ke++)if(K[ke]){const De=K[ke].startsWith("a_")?K[ke]:`a_${K[ke]}`;V.bindAttribLocation(this.program,ke,De),this.attributes[De]=ke}V.linkProgram(this.program),V.deleteShader(Se),V.deleteShader(Ee),this.fixedUniforms=M(i),this.binderUniforms=w?w.getUniforms(i):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(ke=>({u_instanceID:new t.bN(ke)}))(i)),(A.includes("TERRAIN")||l.indexOf("symbol")!==-1||l.indexOf("circle")!==-1)&&(this.terrainUniforms=(ke=>({u_dem:new t.bN(ke),u_dem_prev:new t.bN(ke),u_dem_tl:new t.bK(ke),u_dem_scale:new t.bM(ke),u_dem_tl_prev:new t.bK(ke),u_dem_scale_prev:new t.bM(ke),u_dem_size:new t.bM(ke),u_dem_lerp:new t.bM(ke),u_exaggeration:new t.bM(ke),u_depth:new t.bN(ke),u_depth_size_inv:new t.bK(ke),u_depth_range_unpack:new t.bK(ke),u_occluder_half_size:new t.bM(ke),u_occlusion_depth_offset:new t.bM(ke),u_meter_to_dem:new t.bM(ke),u_label_plane_matrix_inv:new t.bJ(ke)}))(i)),A.includes("GLOBE")&&(this.globeUniforms=(ke=>({u_tile_tl_up:new t.bL(ke),u_tile_tr_up:new t.bL(ke),u_tile_br_up:new t.bL(ke),u_tile_bl_up:new t.bL(ke),u_tile_up_scale:new t.bM(ke)}))(i)),A.includes("FOG")&&(this.fogUniforms=(ke=>({u_fog_matrix:new t.bJ(ke),u_fog_range:new t.bK(ke),u_fog_color:new t.ca(ke),u_fog_horizon_blend:new t.bM(ke),u_fog_vertical_limit:new t.bK(ke),u_fog_temporal_offset:new t.bM(ke),u_frustum_tl:new t.bL(ke),u_frustum_tr:new t.bL(ke),u_frustum_br:new t.bL(ke),u_frustum_bl:new t.bL(ke),u_globe_pos:new t.bL(ke),u_globe_radius:new t.bM(ke),u_globe_transition:new t.bM(ke),u_is_globe:new t.bN(ke),u_viewport:new t.bK(ke)}))(i)),A.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(ke=>({u_cutoff_params:new t.ca(ke)}))(i)),A.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(ke=>({u_lighting_ambient_color:new t.bL(ke),u_lighting_directional_dir:new t.bL(ke),u_lighting_directional_color:new t.bL(ke),u_ground_radiance:new t.bL(ke)}))(i)),A.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(ke=>({u_light_matrix_0:new t.bJ(ke),u_light_matrix_1:new t.bJ(ke),u_fade_range:new t.bK(ke),u_shadow_normal_offset:new t.bL(ke),u_shadow_intensity:new t.bM(ke),u_shadow_texel_size:new t.bM(ke),u_shadow_map_resolution:new t.bM(ke),u_shadow_direction:new t.bL(ke),u_shadow_bias:new t.bL(ke),u_shadowmap_0:new t.bN(ke),u_shadowmap_1:new t.bN(ke)}))(i))}}setTerrainUniformValues(i,l){if(!this.terrainUniforms)return;const y=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const w in l)y[w]&&y[w].set(this.program,w,l[w])}}setGlobeUniformValues(i,l){if(!this.globeUniforms)return;const y=this.globeUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const w in l)y[w]&&y[w].set(this.program,w,l[w])}}setFogUniformValues(i,l){if(!this.fogUniforms)return;const y=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const w in l)y[w].set(this.program,w,l[w])}}setCutoffUniformValues(i,l){if(!this.cutoffUniforms)return;const y=this.cutoffUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const w in l)y[w].set(this.program,w,l[w])}}setLightsUniformValues(i,l){if(!this.lightsUniforms)return;const y=this.lightsUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const w in l)y[w].set(this.program,w,l[w])}}setShadowUniformValues(i,l){if(this.failedToCreate||!this.shadowUniforms)return;const y=this.shadowUniforms;i.program.set(this.program);for(const w in l)y[w].set(this.program,w,l[w])}_drawDebugWireframe(i,l,y,w,M,A,V,H,K,ee){const se=i.options.wireframe;if(se.terrain===!1&&se.layers2D===!1&&se.layers3D===!1)return;const le=i.context;if(!(!(!se.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!se.layers2D||i._terrain&&i._terrain.renderingToTexture||!yd.includes(this.name))||!(!se.layers3D||!Ah.includes(this.name))))return;const me=le.gl,Ee=i.wireframeDebugCache.getLinesFromTrianglesBuffer(i.frameCounter,M,le);if(!Ee)return;const Se=[...this.fixedDefines];Se.push("DEBUG_WIREFRAME");const ke=i.getOrCreateProgram(this.name,{config:this.configuration,defines:Se});le.program.set(ke.program);const De=(st,wt,gt)=>{if(wt[st]&&gt[st])for(const vt in wt[st])gt[st][vt]&&gt[st][vt].set(gt.program,vt,wt[st][vt].current)};K&&K.setUniforms(ke.program,le,ke.binderUniforms,V,{zoom:H}),De("fixedUniforms",this,ke),De("terrainUniforms",this,ke),De("globeUniforms",this,ke),De("fogUniforms",this,ke),De("lightsUniforms",this,ke),De("shadowUniforms",this,ke),Ee.bind(),le.setColorMode(new Tr([me.ONE,me.ONE_MINUS_SRC_ALPHA,me.ZERO,me.ONE],t.aj.transparent,[!0,!0,!0,!1])),le.setDepthMode(new Zi(l.func===me.LESS?me.LEQUAL:l.func,Zi.ReadOnly,l.range)),le.setStencilMode(lr.disabled);const Xe=3*A.primitiveLength*2,ut=3*A.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const st=ee||1;for(let wt=0;wt<st;++wt)ke.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",wt),me.drawElements(me.LINES,Xe,me.UNSIGNED_SHORT,ut)}else ee&&ee>1?me.drawElementsInstanced(me.LINES,Xe,me.UNSIGNED_SHORT,ut,ee):me.drawElements(me.LINES,Xe,me.UNSIGNED_SHORT,ut);M.bind(),le.program.set(this.program),le.setDepthMode(l),le.setStencilMode(y),le.setColorMode(w)}checkUniforms(i,l,y){if(this.fixedDefines.includes(l)){for(const w of Object.keys(y))if(!y[w].initialized)throw new Error(`Program '${this.name}', from draw '${i}': uniform ${w} not set but required by ${l} being defined`)}}draw(i,l,y,w,M,A,V,H,K,ee,se,le,me,Ee,Se,ke){const De=i.context,Xe=De.gl;if(this.failedToCreate)return;De.program.set(this.program),De.setDepthMode(y),De.setStencilMode(w),De.setColorMode(M),De.setCullFace(A);for(const wt of Object.keys(this.fixedUniforms))this.fixedUniforms[wt].set(this.program,wt,V[wt]);Ee&&Ee.setUniforms(this.program,De,this.binderUniforms,le,{zoom:me});const ut={[Xe.POINTS]:1,[Xe.LINES]:2,[Xe.TRIANGLES]:3,[Xe.LINE_STRIP]:1}[l];this.checkUniforms(H,"RENDER_SHADOWS",this.shadowUniforms);const st=ke&&ke>0?1:void 0;for(const wt of se.get()){const gt=wt.vaos||(wt.vaos={});if((gt[H]||(gt[H]=new rf)).bind(De,this,K,Ee?Ee.getPaintVertexBuffers():[],ee,wt.vertexOffset,Se||[],st),this.forceManualRenderingForInstanceIDShaders){const vt=ke||1;for(let _t=0;_t<vt;++_t)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",_t),ee?Xe.drawElements(l,wt.primitiveLength*ut,Xe.UNSIGNED_SHORT,wt.primitiveOffset*ut*2):Xe.drawArrays(l,wt.vertexOffset,wt.vertexLength)}else ke&&ke>1?Xe.drawElementsInstanced(l,wt.primitiveLength*ut,Xe.UNSIGNED_SHORT,wt.primitiveOffset*ut*2,ke):ee?Xe.drawElements(l,wt.primitiveLength*ut,Xe.UNSIGNED_SHORT,wt.primitiveOffset*ut*2):Xe.drawArrays(l,wt.vertexOffset,wt.vertexLength);l===Xe.TRIANGLES&&ee&&this._drawDebugWireframe(i,y,w,M,ee,wt,le,me,Ee,ke)}}}function kh(_,i){const l=Math.pow(2,i.tileID.overscaledZ),y=i.tileSize*Math.pow(2,_.transform.tileZoom)/l,w=y*(i.tileID.canonical.x+i.tileID.wrap*l),M=y*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/t.ar(i,1,_.transform.tileZoom),u_pixel_coord_upper:[w>>16,M>>16],u_pixel_coord_lower:[65535&w,65535&M]}}const _c={terrain:0,flat:1},cp=t.ab.mat4.create(),Qr=(_,i,l,y,w,M,A,V,H,K,ee,se,le,me,Ee,Se,ke,De)=>{const Xe=i.style.light,ut=Xe.properties.get("position"),st=[ut.x,ut.y,ut.z],wt=t.ab.mat3.create();Xe.properties.get("anchor")==="viewport"&&(t.ab.mat3.fromRotation(wt,-i.transform.angle),t.ab.vec3.transformMat3(st,st,wt));const gt=Xe.properties.get("color"),vt=i.transform,_t={u_matrix:_,u_lightpos:st,u_lightintensity:Xe.properties.get("intensity"),u_lightcolor:[gt.r,gt.g,gt.b],u_vertical_gradient:+l,u_opacity:y,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:cp,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:_c[K],u_base_type:_c[ee],u_ao:w,u_edge_radius:M,u_width_scale:A,u_flood_light_color:Ee,u_vertical_scale:Se,u_flood_light_intensity:ke,u_ground_shadow_factor:De};return vt.projection.name==="globe"&&(_t.u_tile_id=[V.canonical.x,V.canonical.y,1<<V.canonical.z],_t.u_zoom_transition=se,_t.u_inv_rot_matrix=me,_t.u_merc_center=le,_t.u_up_dir=vt.projection.upVector(new t.bT(0,0,0),le[0]*t.ag,le[1]*t.ag),_t.u_height_lift=H),_t},Uc=(_,i,l,y,w,M)=>({u_matrix:_,u_edge_radius:i,u_width_scale:l,u_vertical_scale:y,u_height_type:_c[w],u_base_type:_c[M]}),up=(_,i,l,y,w,M,A,V,H,K,ee,se,le,me,Ee,Se,ke)=>{const De=Qr(_,i,l,y,w,M,A,V,K,ee,se,le,me,Ee,Se,ke,1,[0,0,0]),Xe={u_height_factor:-Math.pow(2,V.overscaledZ)/H.tileSize/8};return t.l(De,kh(i,H),Xe)},yu=(_,i)=>({u_matrix:_,u_emissive_strength:i}),hp=(_,i,l,y)=>t.l(yu(_,i),kh(l,y)),df=(_,i,l)=>({u_matrix:_,u_world:l,u_emissive_strength:i}),Dh=(_,i,l,y,w)=>t.l(hp(_,i,l,y),{u_world:w}),vd=(_,i,l,y)=>{const w=t.ag/l.tileSize;return{u_matrix:_,u_camera_to_center_distance:i.getCameraToCenterDistance(y),u_extrude_scale:[i.pixelsToGLUnits[0]/w,i.pixelsToGLUnits[1]/w]}},dp=(_,i,l=1)=>({u_matrix:_,u_color:i.toRenderColor(null),u_overlay:0,u_overlay_scale:l}),Hm=t.ab.mat4.create(),Rh=(_,i,l,y,w,M,A)=>{const V=_.transform,H=V.projection.name==="globe",K=H?t.cN(V.zoom,i.canonical)*V._pixelsPerMercatorPixel:t.ar(l,1,M),ee={u_matrix:i.projMatrix,u_extrude_scale:K,u_intensity:A,u_inv_rot_matrix:Hm,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(H){ee.u_inv_rot_matrix=y,ee.u_merc_center=w,ee.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],ee.u_zoom_transition=t.ae(V.zoom);const se=w[0]*t.ag,le=w[1]*t.ag;ee.u_up_dir=V.projection.upVector(new t.bT(0,0,0),se,le)}return ee};function xd(_,[i,l,y,w],[M,A]){if(M===A)return[0,0,0,0];const V=255*(_-1)/(_*(A-M));return[i*V,l*V,y*V,w*V]}function ki(_,i,[l,y]){return l===y?0:.5/_+(i-l)*(_-1)/(_*(y-l))}const yc=(_,i,l,y,w,M,A,V,H,K,ee,se,le,me,Ee,Se,ke,De,Xe,ut,st)=>({u_matrix:_,u_normalize_matrix:i,u_globe_matrix:l,u_merc_matrix:y,u_grid_matrix:w,u_tl_parent:M,u_scale_parent:K,u_fade_t:ee.mix,u_opacity:ee.opacity*se.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:se.paint.get("raster-brightness-min"),u_brightness_high:se.paint.get("raster-brightness-max"),u_saturation_factor:t.cO(se.paint.get("raster-saturation")),u_contrast_factor:t.cP(se.paint.get("raster-contrast")),u_spin_weights:ls(se.paint.get("raster-hue-rotate")),u_perspective_transform:le,u_raster_elevation:me,u_zoom_transition:A,u_merc_center:V,u_cutoff_params:H,u_colorization_mix:xd(t.cQ,Se,De),u_colorization_offset:ki(t.cQ,ke,De),u_color_ramp:Ee,u_texture_offset:[ut/(Xe+2*ut),Xe/(Xe+2*ut)],u_texture_res:[Xe+2*ut,Xe+2*ut],u_emissive_strength:st});function ls(_){_*=Math.PI/180;const i=Math.sin(_),l=Math.cos(_);return[(2*l+1)/3,(-Math.sqrt(3)*i-l+1)/3,(Math.sqrt(3)*i-l+1)/3]}const nl=.05,$c=(_,i,l,y,w,M,A,V,H,K,ee,se)=>({u_matrix:_,u_normalize_matrix:i,u_globe_matrix:l,u_merc_matrix:y,u_grid_matrix:w,u_tl_parent:M,u_scale_parent:K,u_fade_t:ee.mix,u_opacity:ee.opacity,u_image0:0,u_image1:1,u_raster_elevation:se,u_zoom_transition:A,u_merc_center:V,u_cutoff_params:H}),$i=(_,i,l,y,w,M,A,V,H,K)=>({u_particle_texture:_,u_particle_texture_side_len:i,u_tile_offset:l,u_velocity:y,u_color_ramp:M,u_velocity_res:w,u_max_speed:A,u_uv_offset:V,u_data_scale:[255*H[0],255*H[1]],u_data_offset:K,u_particle_pos_scale:1.1,u_particle_pos_offset:[nl,nl]}),ff=(_,i,l,y,w,M,A,V,H,K)=>({u_particle_texture:_,u_particle_texture_side_len:i,u_velocity:l,u_velocity_res:y,u_max_speed:w,u_speed_factor:M,u_reset_rate:A,u_rand_seed:Math.random(),u_uv_offset:V,u_data_scale:[255*H[0],255*H[1]],u_data_offset:K,u_particle_pos_scale:1.1,u_particle_pos_offset:[nl,nl]}),fp=t.ab.mat4.create(),pf=(_,i,l,y,w,M,A,V,H,K,ee,se,le,me,Ee,Se,ke,De,Xe,ut,st,wt)=>{const gt=w.transform,vt={u_is_size_zoom_constant:+(_==="constant"||_==="source"),u_is_size_feature_constant:+(_==="constant"||_==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:gt.getCameraToCenterDistance(Xe),u_rotate_symbol:+l,u_aspect_ratio:gt.width/gt.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_matrix:M,u_label_plane_matrix:A,u_coord_matrix:V,u_is_text:+K,u_elevation_from_sea:H?1:0,u_pitch_with_map:+y,u_texsize:ee,u_texsize_icon:se,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:fp,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:fp,u_up_vector:[0,-1,0],u_color_adj_mat:ut,u_icon_transition:st||0,u_gamma_scale:y?w.transform.getCameraToCenterDistance(Xe)*Math.cos(w.terrain?0:w.transform._pitch):1,u_device_pixel_ratio:t.q.devicePixelRatio,u_is_halo:1,u_scale_factor:wt||1};return Xe.name==="globe"&&(vt.u_tile_id=[me.canonical.x,me.canonical.y,1<<me.canonical.z],vt.u_zoom_transition=Ee,vt.u_inv_rot_matrix=ke,vt.u_merc_center=Se,vt.u_camera_forward=gt._camera.forward(),vt.u_ecef_origin=t.cR(gt.globeMatrix,me.toUnwrapped()),vt.u_tile_matrix=Float32Array.from(gt.globeMatrix),vt.u_up_vector=De),vt},Fl=(_,i,l,y)=>({u_matrix:_,u_emissive_strength:i,u_opacity:l,u_color:y}),Qu=(_,i,l,y,w,M,A,V,H)=>t.l(function(K,ee,se,le,me,Ee){const{width:Se,height:ke}=le.imageManager.getPixelSize(ee),De=Math.pow(2,Ee.tileID.overscaledZ),Xe=Ee.tileSize*Math.pow(2,le.transform.tileZoom)/De,ut=Xe*(Ee.tileID.canonical.x+Ee.tileID.wrap*De),st=Xe*Ee.tileID.canonical.y;return{u_image:0,u_pattern_tl:se.tl,u_pattern_br:se.br,u_texsize:[Se,ke],u_pattern_size:se.displaySize,u_pattern_units_to_pixels:me?[le.transform.width,-1*le.transform.height]:[1/t.ar(Ee,1,le.transform.tileZoom),1/t.ar(Ee,1,le.transform.tileZoom)],u_pixel_coord_upper:[ut>>16,st>>16],u_pixel_coord_lower:[65535&ut,65535&st]}}(0,M,A,y,V,H),{u_matrix:_,u_emissive_strength:i,u_opacity:l}),cr=new Float32Array(t.ab.mat4.identity([])),xr=(_,i,l,y,w,M,A,V,H,K,ee,se,le,me=[0,0,0],Ee)=>{const Se=w.style.light,ke=Se.properties.get("position"),De=[-ke.x,-ke.y,ke.z],Xe=t.ab.mat3.create();Se.properties.get("anchor")==="viewport"&&(t.ab.mat3.fromRotation(Xe,-w.transform.angle),t.ab.vec3.transformMat3(De,De,Xe));const ut=ee.alphaMode==="MASK",st=Se.properties.get("color").toRenderColor(null),wt=le.paint.get("model-ambient-occlusion-intensity"),gt=le.paint.get("model-color").constantOr(t.aj.white).toRenderColor(null),vt=le.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:_,u_lighting_matrix:i,u_normal_matrix:l,u_node_matrix:y||cr,u_lightpos:De,u_lightintensity:Se.properties.get("intensity"),u_lightcolor:[st.r,st.g,st.b],u_camera_pos:me,u_opacity:M,u_baseTextureIsAlpha:0,u_alphaMask:+ut,u_alphaCutoff:ee.alphaCutoff,u_baseColorFactor:[A.r,A.g,A.b,A.a],u_emissiveFactor:[V[0],V[1],V[2],1],u_metallicFactor:H,u_roughnessFactor:K,u_baseColorTexture:Ds.BaseColor,u_metallicRoughnessTexture:Ds.MetallicRoughness,u_normalTexture:Ds.Normal,u_occlusionTexture:Ds.Occlusion,u_emissionTexture:Ds.Emission,u_lutTexture:Ds.LUT,u_color_mix:[gt.r,gt.g,gt.b,vt],u_aoIntensity:wt,u_emissive_strength:se,u_occlusionTextureTransform:Ee||[0,0,0,0]}},bd=(_,i=cr,l=cr)=>({u_matrix:_,u_instance:i,u_node_matrix:l}),wd={fillExtrusion:_=>({u_matrix:new t.bJ(_),u_lightpos:new t.bL(_),u_lightintensity:new t.bM(_),u_lightcolor:new t.bL(_),u_vertical_gradient:new t.bM(_),u_opacity:new t.bM(_),u_edge_radius:new t.bM(_),u_width_scale:new t.bM(_),u_ao:new t.bK(_),u_height_type:new t.bN(_),u_base_type:new t.bN(_),u_tile_id:new t.bL(_),u_zoom_transition:new t.bM(_),u_inv_rot_matrix:new t.bJ(_),u_merc_center:new t.bK(_),u_up_dir:new t.bL(_),u_height_lift:new t.bM(_),u_flood_light_color:new t.bL(_),u_vertical_scale:new t.bM(_),u_flood_light_intensity:new t.bM(_),u_ground_shadow_factor:new t.bL(_)}),fillExtrusionDepth:_=>({u_matrix:new t.bJ(_),u_edge_radius:new t.bM(_),u_width_scale:new t.bM(_),u_vertical_scale:new t.bM(_),u_height_type:new t.bN(_),u_base_type:new t.bN(_)}),fillExtrusionPattern:_=>({u_matrix:new t.bJ(_),u_lightpos:new t.bL(_),u_lightintensity:new t.bM(_),u_lightcolor:new t.bL(_),u_vertical_gradient:new t.bM(_),u_height_factor:new t.bM(_),u_edge_radius:new t.bM(_),u_width_scale:new t.bM(_),u_ao:new t.bK(_),u_height_type:new t.bN(_),u_base_type:new t.bN(_),u_tile_id:new t.bL(_),u_zoom_transition:new t.bM(_),u_inv_rot_matrix:new t.bJ(_),u_merc_center:new t.bK(_),u_up_dir:new t.bL(_),u_height_lift:new t.bM(_),u_image:new t.bN(_),u_texsize:new t.bK(_),u_pixel_coord_upper:new t.bK(_),u_pixel_coord_lower:new t.bK(_),u_tile_units_to_pixels:new t.bM(_),u_opacity:new t.bM(_)}),fillExtrusionGroundEffect:_=>({u_matrix:new t.bJ(_),u_opacity:new t.bM(_),u_ao_pass:new t.bM(_),u_meter_to_tile:new t.bM(_),u_ao:new t.bK(_),u_flood_light_intensity:new t.bM(_),u_flood_light_color:new t.bL(_),u_attenuation:new t.bM(_),u_edge_radius:new t.bM(_),u_fb:new t.bN(_),u_fb_size:new t.bM(_),u_dynamic_offset:new t.bM(_)}),fill:_=>({u_matrix:new t.bJ(_),u_emissive_strength:new t.bM(_)}),fillPattern:_=>({u_matrix:new t.bJ(_),u_emissive_strength:new t.bM(_),u_image:new t.bN(_),u_texsize:new t.bK(_),u_pixel_coord_upper:new t.bK(_),u_pixel_coord_lower:new t.bK(_),u_tile_units_to_pixels:new t.bM(_)}),fillOutline:_=>({u_matrix:new t.bJ(_),u_emissive_strength:new t.bM(_),u_world:new t.bK(_)}),fillOutlinePattern:_=>({u_matrix:new t.bJ(_),u_emissive_strength:new t.bM(_),u_world:new t.bK(_),u_image:new t.bN(_),u_texsize:new t.bK(_),u_pixel_coord_upper:new t.bK(_),u_pixel_coord_lower:new t.bK(_),u_tile_units_to_pixels:new t.bM(_)}),circle:t.cS,collisionBox:_=>({u_matrix:new t.bJ(_),u_camera_to_center_distance:new t.bM(_),u_extrude_scale:new t.bK(_)}),collisionCircle:_=>({u_matrix:new t.bJ(_),u_inv_matrix:new t.bJ(_),u_camera_to_center_distance:new t.bM(_),u_viewport_size:new t.bK(_)}),debug:_=>({u_color:new t.cz(_),u_matrix:new t.bJ(_),u_overlay:new t.bN(_),u_overlay_scale:new t.bM(_)}),clippingMask:_=>({u_matrix:new t.bJ(_)}),heatmap:_=>({u_extrude_scale:new t.bM(_),u_intensity:new t.bM(_),u_matrix:new t.bJ(_),u_inv_rot_matrix:new t.bJ(_),u_merc_center:new t.bK(_),u_tile_id:new t.bL(_),u_zoom_transition:new t.bM(_),u_up_dir:new t.bL(_)}),heatmapTexture:_=>({u_image:new t.bN(_),u_color_ramp:new t.bN(_),u_opacity:new t.bM(_)}),hillshade:_=>({u_matrix:new t.bJ(_),u_image:new t.bN(_),u_latrange:new t.bK(_),u_light:new t.bK(_),u_shadow:new t.cz(_),u_highlight:new t.cz(_),u_emissive_strength:new t.bM(_),u_accent:new t.cz(_)}),hillshadePrepare:_=>({u_matrix:new t.bJ(_),u_image:new t.bN(_),u_dimension:new t.bK(_),u_zoom:new t.bM(_)}),line:t.cT,linePattern:t.cU,raster:_=>({u_matrix:new t.bJ(_),u_normalize_matrix:new t.bJ(_),u_globe_matrix:new t.bJ(_),u_merc_matrix:new t.bJ(_),u_grid_matrix:new t.cA(_),u_tl_parent:new t.bK(_),u_scale_parent:new t.bM(_),u_fade_t:new t.bM(_),u_opacity:new t.bM(_),u_image0:new t.bN(_),u_image1:new t.bN(_),u_brightness_low:new t.bM(_),u_brightness_high:new t.bM(_),u_saturation_factor:new t.bM(_),u_contrast_factor:new t.bM(_),u_spin_weights:new t.bL(_),u_perspective_transform:new t.bK(_),u_raster_elevation:new t.bM(_),u_zoom_transition:new t.bM(_),u_merc_center:new t.bK(_),u_cutoff_params:new t.ca(_),u_colorization_mix:new t.ca(_),u_colorization_offset:new t.bM(_),u_color_ramp:new t.bN(_),u_texture_offset:new t.bK(_),u_texture_res:new t.bK(_),u_emissive_strength:new t.bM(_)}),rasterParticle:_=>({u_matrix:new t.bJ(_),u_normalize_matrix:new t.bJ(_),u_globe_matrix:new t.bJ(_),u_merc_matrix:new t.bJ(_),u_grid_matrix:new t.cA(_),u_tl_parent:new t.bK(_),u_scale_parent:new t.bM(_),u_fade_t:new t.bM(_),u_opacity:new t.bM(_),u_image0:new t.bN(_),u_image1:new t.bN(_),u_raster_elevation:new t.bM(_),u_zoom_transition:new t.bM(_),u_merc_center:new t.bK(_),u_cutoff_params:new t.ca(_)}),rasterParticleTexture:_=>({u_texture:new t.bN(_),u_opacity:new t.bM(_)}),rasterParticleDraw:_=>({u_particle_texture:new t.bN(_),u_particle_texture_side_len:new t.bM(_),u_tile_offset:new t.bK(_),u_velocity:new t.bN(_),u_color_ramp:new t.bN(_),u_velocity_res:new t.bK(_),u_max_speed:new t.bM(_),u_uv_offset:new t.bK(_),u_data_scale:new t.bK(_),u_data_offset:new t.bM(_),u_particle_pos_scale:new t.bM(_),u_particle_pos_offset:new t.bK(_)}),rasterParticleUpdate:_=>({u_particle_texture:new t.bN(_),u_particle_texture_side_len:new t.bM(_),u_velocity:new t.bN(_),u_velocity_res:new t.bK(_),u_max_speed:new t.bM(_),u_speed_factor:new t.bM(_),u_reset_rate:new t.bM(_),u_rand_seed:new t.bM(_),u_uv_offset:new t.bK(_),u_data_scale:new t.bK(_),u_data_offset:new t.bM(_),u_particle_pos_scale:new t.bM(_),u_particle_pos_offset:new t.bK(_)}),symbol:_=>({u_is_size_zoom_constant:new t.bN(_),u_is_size_feature_constant:new t.bN(_),u_size_t:new t.bM(_),u_size:new t.bM(_),u_camera_to_center_distance:new t.bM(_),u_rotate_symbol:new t.bN(_),u_aspect_ratio:new t.bM(_),u_fade_change:new t.bM(_),u_matrix:new t.bJ(_),u_label_plane_matrix:new t.bJ(_),u_coord_matrix:new t.bJ(_),u_is_text:new t.bN(_),u_elevation_from_sea:new t.bN(_),u_pitch_with_map:new t.bN(_),u_texsize:new t.bK(_),u_texsize_icon:new t.bK(_),u_texture:new t.bN(_),u_texture_icon:new t.bN(_),u_gamma_scale:new t.bM(_),u_device_pixel_ratio:new t.bM(_),u_tile_id:new t.bL(_),u_zoom_transition:new t.bM(_),u_inv_rot_matrix:new t.bJ(_),u_merc_center:new t.bK(_),u_camera_forward:new t.bL(_),u_tile_matrix:new t.bJ(_),u_up_vector:new t.bL(_),u_ecef_origin:new t.bL(_),u_is_halo:new t.bN(_),u_icon_transition:new t.bM(_),u_color_adj_mat:new t.bJ(_),u_scale_factor:new t.bM(_)}),background:_=>({u_matrix:new t.bJ(_),u_emissive_strength:new t.bM(_),u_opacity:new t.bM(_),u_color:new t.cz(_)}),backgroundPattern:_=>({u_matrix:new t.bJ(_),u_emissive_strength:new t.bM(_),u_opacity:new t.bM(_),u_image:new t.bN(_),u_pattern_tl:new t.bK(_),u_pattern_br:new t.bK(_),u_texsize:new t.bK(_),u_pattern_size:new t.bK(_),u_pixel_coord_upper:new t.bK(_),u_pixel_coord_lower:new t.bK(_),u_pattern_units_to_pixels:new t.bK(_)}),terrainRaster:_=>({u_matrix:new t.bJ(_),u_image0:new t.bN(_),u_skirt_height:new t.bM(_),u_ground_shadow_factor:new t.bL(_)}),skybox:_=>({u_matrix:new t.bJ(_),u_sun_direction:new t.bL(_),u_cubemap:new t.bN(_),u_opacity:new t.bM(_),u_temporal_offset:new t.bM(_)}),skyboxGradient:_=>({u_matrix:new t.bJ(_),u_color_ramp:new t.bN(_),u_center_direction:new t.bL(_),u_radius:new t.bM(_),u_opacity:new t.bM(_),u_temporal_offset:new t.bM(_)}),skyboxCapture:_=>({u_matrix_3f:new t.cA(_),u_sun_direction:new t.bL(_),u_sun_intensity:new t.bM(_),u_color_tint_r:new t.ca(_),u_color_tint_m:new t.ca(_),u_luminance:new t.bM(_)}),globeRaster:_=>({u_proj_matrix:new t.bJ(_),u_globe_matrix:new t.bJ(_),u_normalize_matrix:new t.bJ(_),u_merc_matrix:new t.bJ(_),u_zoom_transition:new t.bM(_),u_merc_center:new t.bK(_),u_image0:new t.bN(_),u_grid_matrix:new t.cA(_),u_skirt_height:new t.bM(_),u_far_z_cutoff:new t.bM(_),u_frustum_tl:new t.bL(_),u_frustum_tr:new t.bL(_),u_frustum_br:new t.bL(_),u_frustum_bl:new t.bL(_),u_globe_pos:new t.bL(_),u_globe_radius:new t.bM(_),u_viewport:new t.bK(_)}),globeAtmosphere:_=>({u_frustum_tl:new t.bL(_),u_frustum_tr:new t.bL(_),u_frustum_br:new t.bL(_),u_frustum_bl:new t.bL(_),u_horizon:new t.bM(_),u_transition:new t.bM(_),u_fadeout_range:new t.bM(_),u_color:new t.ca(_),u_high_color:new t.ca(_),u_space_color:new t.ca(_),u_temporal_offset:new t.bM(_),u_horizon_angle:new t.bM(_)}),model:_=>({u_matrix:new t.bJ(_),u_lighting_matrix:new t.bJ(_),u_normal_matrix:new t.bJ(_),u_node_matrix:new t.bJ(_),u_lightpos:new t.bL(_),u_lightintensity:new t.bM(_),u_lightcolor:new t.bL(_),u_camera_pos:new t.bL(_),u_opacity:new t.bM(_),u_baseColorFactor:new t.ca(_),u_emissiveFactor:new t.ca(_),u_metallicFactor:new t.bM(_),u_roughnessFactor:new t.bM(_),u_baseTextureIsAlpha:new t.bN(_),u_alphaMask:new t.bN(_),u_alphaCutoff:new t.bM(_),u_baseColorTexture:new t.bN(_),u_metallicRoughnessTexture:new t.bN(_),u_normalTexture:new t.bN(_),u_occlusionTexture:new t.bN(_),u_emissionTexture:new t.bN(_),u_lutTexture:new t.bN(_),u_color_mix:new t.ca(_),u_aoIntensity:new t.bM(_),u_emissive_strength:new t.bM(_),u_occlusionTextureTransform:new t.ca(_)}),modelDepth:_=>({u_matrix:new t.bJ(_),u_instance:new t.bJ(_),u_node_matrix:new t.bJ(_)}),groundShadow:_=>({u_matrix:new t.bJ(_),u_ground_shadow_factor:new t.bL(_)}),stars:_=>({u_matrix:new t.bJ(_),u_up:new t.bL(_),u_right:new t.bL(_),u_intensity_multiplier:new t.bM(_)}),snowParticle:_=>({u_modelview:new t.bJ(_),u_projection:new t.bJ(_),u_time:new t.bM(_),u_cam_pos:new t.bL(_),u_velocityConeAperture:new t.bM(_),u_velocity:new t.bM(_),u_horizontalOscillationRadius:new t.bM(_),u_horizontalOscillationRate:new t.bM(_),u_boxSize:new t.bM(_),u_billboardSize:new t.bM(_),u_simpleShapeParameters:new t.bK(_),u_screenSize:new t.bK(_),u_thinningCenterPos:new t.bK(_),u_thinningShape:new t.bL(_),u_thinningAffectedRatio:new t.bM(_),u_thinningParticleOffset:new t.bM(_),u_particleColor:new t.ca(_),u_direction:new t.bL(_)}),rainParticle:_=>({u_modelview:new t.bJ(_),u_projection:new t.bJ(_),u_time:new t.bM(_),u_cam_pos:new t.bL(_),u_texScreen:new t.bN(_),u_velocityConeAperture:new t.bM(_),u_velocity:new t.bM(_),u_boxSize:new t.bM(_),u_rainDropletSize:new t.bK(_),u_distortionStrength:new t.bM(_),u_rainDirection:new t.bL(_),u_color:new t.ca(_),u_screenSize:new t.bK(_),u_thinningCenterPos:new t.bK(_),u_thinningShape:new t.bL(_),u_thinningAffectedRatio:new t.bM(_),u_thinningParticleOffset:new t.bM(_),u_shapeDirectionalPower:new t.bM(_),u_shapeNormalPower:new t.bM(_),u_mode:new t.bM(_)}),vignette:_=>({u_vignetteShape:new t.bL(_),u_vignetteColor:new t.ca(_)}),occlusion:_=>({u_matrix:new t.bJ(_),u_anchorPos:new t.bL(_),u_screenSizePx:new t.bK(_),u_occluderSizePx:new t.bK(_),u_color:new t.ca(_)})};class Bl{constructor(i,l,y,w){this.id=Bl.uniqueIdxCounter,Bl.uniqueIdxCounter++,this.context=i;const M=i.gl;this.buffer=M.createBuffer(),this.dynamicDraw=!!y,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),M.bufferData(M.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?M.DYNAMIC_DRAW:M.STATIC_DRAW),this.dynamicDraw||w||l.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){this.id=Bl.uniqueIdxCounter,Bl.uniqueIdxCounter++;const l=this.context.gl;this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Bl.uniqueIdxCounter=0;const $o={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class pp{constructor(i,l,y,w,M,A){this.length=l.length,this.attributes=y,this.itemSize=l.bytesPerElement,this.dynamicDraw=w,this.instanceCount=A,this.context=i;const V=i.gl;this.buffer=V.createBuffer(),i.bindVertexBuffer.set(this.buffer),V.bufferData(V.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?V.DYNAMIC_DRAW:V.STATIC_DRAW),this.dynamicDraw||M||l.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,l){for(let y=0;y<this.attributes.length;y++){const w=l.attributes[this.attributes[y].name];w!==void 0&&i.enableVertexAttribArray(w)}}setVertexAttribPointers(i,l,y){for(let w=0;w<this.attributes.length;w++){const M=this.attributes[w],A=l.attributes[M.name];A!==void 0&&i.vertexAttribPointer(A,M.components,i[$o[M.type]],!1,this.itemSize,M.offset+this.itemSize*(y||0))}}setVertexAttribDivisor(i,l,y){for(let w=0;w<this.attributes.length;w++){const M=l.attributes[this.attributes[w].name];M!==void 0&&this.instanceCount&&this.instanceCount>0&&i.vertexAttribDivisor(M,y)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Ss{constructor(i,l,y,w,M){this.context=i,this.width=l,this.height=y;const A=this.framebuffer=i.gl.createFramebuffer();w&&(this.colorAttachment=new ap(i,A)),M&&(this.depthAttachmentType=M,this.depthAttachment=M==="renderbuffer"?new sp(i,A):new Ih(i,A))}destroy(){const i=this.context.gl;if(this.colorAttachment){const l=this.colorAttachment.get();l&&i.deleteTexture(l)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const l=this.depthAttachment.get();l&&i.deleteRenderbuffer(l)}else{const l=this.depthAttachment.get();l&&i.deleteTexture(l)}i.deleteFramebuffer(this.framebuffer)}}class eh{constructor(i,l){this.gl=i,this.clearColor=new Kp(this),this.clearDepth=new jg(this),this.clearStencil=new dd(this),this.colorMask=new tp(this),this.depthMask=new np(this),this.stencilMask=new fd(this),this.stencilFunc=new of(this),this.stencilOp=new ip(this),this.stencilTest=new Jp(this),this.depthRange=new gu(this),this.depthTest=new _u(this),this.depthFunc=new rp(this),this.blend=new Ro(this),this.blendFunc=new ns(this),this.blendColor=new Bc(this),this.blendEquation=new tl(this),this.cullFace=new lf(this),this.cullFaceSide=new cf(this),this.frontFace=new uf(this),this.program=new Xu(this),this.activeTexture=new Yu(this),this.viewport=new Mh(this),this.bindFramebuffer=new pd(this),this.bindRenderbuffer=new Qp(this),this.bindTexture=new Ku(this),this.bindVertexBuffer=new em(this),this.bindElementBuffer=new Gm(this),this.bindVertexArrayOES=new Ju(this),this.pixelStoreUnpack=new tm(this),this.pixelStoreUnpackPremultiplyAlpha=new md(this),this.pixelStoreUnpackFlipY=new qm(this),this.options=l?{...l}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=i.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=i.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=i.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=l&&!!l.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=i.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),this.maxPointSize=i.getParameter(i.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,l,y){return new Bl(this,i,l,y)}createVertexBuffer(i,l,y,w,M){return new pp(this,i,l,y,w,M)}createRenderbuffer(i,l,y){const w=this.gl,M=w.createRenderbuffer();return this.bindRenderbuffer.set(M),w.renderbufferStorage(w.RENDERBUFFER,i,l,y),this.bindRenderbuffer.set(null),M}createFramebuffer(i,l,y,w){return new Ss(this,i,l,y,w)}clear({color:i,depth:l,stencil:y,colorMask:w}){const M=this.gl;let A=0;i&&(A|=M.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set(w||[!0,!0,!0,!0])),l!==void 0&&(A|=M.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),y!==void 0&&(A|=M.STENCIL_BUFFER_BIT,this.clearStencil.set(y),this.stencilMask.set(255)),M.clear(A)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){t.bn(i.blendFunction,Tr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor),i.blendEquation?this.blendEquation.set(i.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(i.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let vu;function Ra(_,i,l,y,w,M,A){const V=_.context,H=V.gl,K=_.transform,ee=_.getOrCreateProgram("collisionBox"),se=[];let le=0,me=0;for(let st=0;st<y.length;st++){const wt=y[st],gt=i.getTile(wt),vt=gt.getBucket(l);if(!vt)continue;const _t=ws(wt,vt,K);let Mt=_t;w[0]===0&&w[1]===0||(Mt=_.translatePosMatrix(_t,gt,w,M));const Ft=A?vt.textCollisionBox:vt.iconCollisionBox,cn=vt.collisionCircleArray;if(cn.length>0){const en=t.ab.mat4.create(),zt=Mt;t.ab.mat4.mul(en,vt.placementInvProjMatrix,K.glCoordMatrix),t.ab.mat4.mul(en,en,vt.placementViewportMatrix),se.push({circleArray:cn,circleOffset:me,transform:zt,invTransform:en,projection:vt.getProjection()}),le+=cn.length/4,me=le}Ft&&(_.terrain&&_.terrain.setupElevationDraw(gt,ee),ee.draw(_,H.LINES,Zi.disabled,lr.disabled,_.colorModeForRenderPass(),or.disabled,vd(Mt,K,gt,vt.getProjection()),l.id,Ft.layoutVertexBuffer,Ft.indexBuffer,Ft.segments,null,K.zoom,null,[Ft.collisionVertexBuffer,Ft.collisionVertexBufferExt]))}if(!A||!se.length)return;const Ee=_.getOrCreateProgram("collisionCircle"),Se=new t.cV;Se.resize(4*le),Se._trim();let ke=0;for(const st of se)for(let wt=0;wt<st.circleArray.length/4;wt++){const gt=4*wt,vt=st.circleArray[gt+0],_t=st.circleArray[gt+1],Mt=st.circleArray[gt+2],Ft=st.circleArray[gt+3];Se.emplace(ke++,vt,_t,Mt,Ft,0),Se.emplace(ke++,vt,_t,Mt,Ft,1),Se.emplace(ke++,vt,_t,Mt,Ft,2),Se.emplace(ke++,vt,_t,Mt,Ft,3)}(!vu||vu.length<2*le)&&(vu=function(st){const wt=2*st,gt=new t.aU;gt.resize(wt),gt._trim();for(let vt=0;vt<wt;vt++){const _t=6*vt;gt.uint16[_t+0]=4*vt+0,gt.uint16[_t+1]=4*vt+1,gt.uint16[_t+2]=4*vt+2,gt.uint16[_t+3]=4*vt+2,gt.uint16[_t+4]=4*vt+3,gt.uint16[_t+5]=4*vt+0}return gt}(le));const De=V.createIndexBuffer(vu,!0),Xe=V.createVertexBuffer(Se,t.cW.members,!0);for(const st of se){const wt={u_matrix:st.transform,u_inv_matrix:st.invTransform,u_camera_to_center_distance:(ut=K).getCameraToCenterDistance(st.projection),u_viewport_size:[ut.width,ut.height]};Ee.draw(_,H.TRIANGLES,Zi.disabled,lr.disabled,_.colorModeForRenderPass(),or.disabled,wt,l.id,Xe,De,t.b7.simpleSegment(0,2*st.circleOffset,st.circleArray.length,st.circleArray.length/2),null,K.zoom)}var ut;Xe.destroy(),De.destroy()}const cs=t.ab.mat4.create();function mf(_){const i=_._camera.getWorldToCamera(_.worldSize,1),l=t.ab.mat4.multiply([],i,_.globeMatrix);t.ab.mat4.invert(l,l);const y=[0,0,0],w=[0,1,0,0];return t.ab.vec4.transformMat4(w,w,l),y[0]=w[0],y[1]=w[1],y[2]=w[2],t.ab.vec3.normalize(y,y),y}function Sd({width:_,height:i,anchor:l,textOffset:y,textScale:w},M){const{horizontalAlign:A,verticalAlign:V}=t.bD(l),H=-(A-.5)*_,K=-(V-.5)*i,ee=t.bC(l,y);return new t.P((H/w+ee[0])*M,(K/w+ee[1])*M)}function Go(_,i,l,y,w,M,A,V,H,K,ee){const se=_.text.placedSymbolArray,le=_.text.dynamicLayoutVertexArray,me=_.icon.dynamicLayoutVertexArray,Ee={},Se=_.getProjection(),ke=ju(V,Se,M),De=M.elevation,Xe=Se.upVectorScale(V.canonical,M.center.lat,M.worldSize).metersToTile;le.clear();for(let ut=0;ut<se.length;ut++){const st=se.get(ut),{tileAnchorX:wt,tileAnchorY:gt,numGlyphs:vt}=st,_t=st.hidden||!st.crossTileID||_.allowVerticalPlacement&&!st.placedOrientation?null:y[st.crossTileID];if(_t){let Mt=0,Ft=0,cn=0;if(De){const dn=De?De.getAtTileOffset(V,wt,gt):0,[Jn,Fn,wn]=Se.upVector(V.canonical,wt,gt);Mt=dn*Jn*Xe,Ft=dn*Fn*Xe,cn=dn*wn*Xe}let[en,zt,Ht,En]=ca(st.projectedAnchorX+Mt,st.projectedAnchorY+Ft,st.projectedAnchorZ+cn,l?ke:A);const Vn=Vu(M.getCameraToCenterDistance(Se),En);let ti=w.evaluateSizeForFeature(_.textSizeData,K,st)*Vn/t.bw;l&&(ti*=_.tilePixelRatio/H);const Qt=Sd(_t,ti);l?({x:en,y:zt,z:Ht}=Se.projectTilePoint(wt+Qt.x,gt+Qt.y,V.canonical),[en,zt,Ht]=ca(en+Mt,zt+Ft,Ht+cn,A)):(i&&Qt._rotate(-M.angle),en+=Qt.x,zt+=Qt.y,Ht=0);const An=_.allowVerticalPlacement&&st.placedOrientation===t.bq.vertical?Math.PI/2:0;for(let dn=0;dn<vt;dn++)t.bt(le,en,zt,Ht,An);ee&&st.associatedIconIndex>=0&&(Ee[st.associatedIconIndex]={x:en,y:zt,z:Ht,angle:An})}else Ml(vt,le)}if(ee){me.clear();const ut=_.icon.placedSymbolArray;for(let st=0;st<ut.length;st++){const wt=ut.get(st),{numGlyphs:gt}=wt,vt=Ee[st];if(wt.hidden||!vt)Ml(gt,me);else{const{x:_t,y:Mt,z:Ft,angle:cn}=vt;for(let en=0;en<gt;en++)t.bt(me,_t,Mt,Ft,cn)}}_.icon.dynamicLayoutVertexBuffer.updateData(me)}_.text.dynamicLayoutVertexBuffer.updateData(le)}function ba(_,i,l,y,w,M,A={}){const V=l.paint.get("icon-translate"),H=l.paint.get("text-translate"),K=l.paint.get("icon-translate-anchor"),ee=l.paint.get("text-translate-anchor"),se=l.layout.get("icon-rotation-alignment"),le=l.layout.get("text-rotation-alignment"),me=l.layout.get("icon-pitch-alignment"),Ee=l.layout.get("text-pitch-alignment"),Se=l.layout.get("icon-keep-upright"),ke=l.layout.get("text-keep-upright"),De=l.paint.get("icon-color-saturation"),Xe=l.paint.get("icon-color-contrast"),ut=l.paint.get("icon-color-brightness-min"),st=l.paint.get("icon-color-brightness-max"),wt=l.layout.get("symbol-elevation-reference")==="sea",gt=_.context,vt=gt.gl,_t=_.transform,Mt=se==="map",Ft=le==="map",cn=me==="map",en=Ee==="map",zt=l.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Ht=!1;const En=_.depthModeForSublayer(0,Zi.ReadOnly),Vn=[t.at(_t.center.lng),t.aA(_t.center.lat)],ti=l.layout.get("text-variable-anchor"),Qt=_t.projection.name==="globe",An=[],dn=[0,-1,0];for(const Jn of y){const Fn=i.getTile(Jn),wn=Fn.getBucket(l);if(!wn||wn.projection.name==="mercator"&&Qt||wn.fullyClipped)continue;const Mi=wn.projection.name==="globe",si=Mi?t.ae(_t.zoom):0,Ii=ju(Jn,wn.getProjection(),_t),Ai=_t.calculatePixelsToTileUnitsMatrix(Fn),ur=ti&&wn.hasTextData(),Xi=wn.hasIconTextFit()&&ur&&wn.hasIconData(),er=wn.getProjection().createInversionMatrix(_t,Jn.canonical),dr=ea=>{_t.depthOcclusionForSymbolsAndCircles&&(l.hasInitialOcclusionOpacityProperties||_.terrain)&&(ea.push("DEPTH_D24"),ea.push("DEPTH_OCCLUSION"))},Ur=()=>{const ea=Mt&&l.layout.get("symbol-placement")!=="point",ta=[];dr(ta);const Xa=ea||Xi,bo=l.paint.get("icon-image-cross-fade").constantOr(0);_.terrainRenderModeElevated()&&cn&&ta.push("PITCH_WITH_MAP_TERRAIN"),Mi&&(ta.push("PROJECTION_GLOBE_VIEW"),Xa&&ta.push("PROJECTED_POS_ON_VIEWPORT")),bo>0&&ta.push("ICON_TRANSITION"),wn.icon.zOffsetVertexBuffer&&ta.push("Z_OFFSET"),De===0&&Xe===0&&ut===0&&st===1||ta.push("COLOR_ADJUSTMENT"),wn.sdfIcons&&ta.push("RENDER_SDF");const vl=wn.icon.programConfigurations.get(l.id),Ls=_.getOrCreateProgram("symbol",{config:vl,defines:ta}),wo=Fn.imageAtlasTexture?Fn.imageAtlasTexture.size:[0,0],qo=wn.iconSizeData,ys=t.bp(qo,_t.zoom),wa=cn||_t.pitch!==0,fa=io(Ii,Fn.tileID.canonical,cn,Mt,_t,wn.getProjection(),Ai),$r=Ns(Ii,Fn.tileID.canonical,cn,Mt,_t,wn.getProjection(),Ai),is=_.translatePosMatrix($r,Fn,V,K,!0),So=_.translatePosMatrix(Ii,Fn,V,K),Lr=Xa?cs:fa,Fo=Mt&&!cn&&!ea;let Tc=dn;!Qt&&!_t.mercatorFromTransition||Mt||(Tc=mf(_t));const jl=Mi?Tc:dn,Su=l.getColorAdjustmentMatrix(De,Xe,ut,st),Ho=pf(qo.kind,ys,Fo,cn,_,So,Lr,is,wt,!1,wo,[0,0],!0,Jn,si,Vn,er,jl,wn.getProjection(),Su,bo),Tu=Fn.imageAtlasTexture?Fn.imageAtlasTexture:null,ac=l.layout.get("icon-size").constantOr(0)!==1||wn.iconsNeedLinear,Ad=wn.sdfIcons||_.options.rotating||_.options.zooming||ac||wa?vt.LINEAR:vt.NEAREST,uh=wn.sdfIcons&&l.paint.get("icon-halo-width").constantOr(1)!==0,kd=_.terrain&&cn&&ea?t.ab.mat4.invert(t.ab.mat4.create(),fa):cs;if(ea&&wn.icon){const Bo=_t.elevation,Tp=Bo?Bo.getAtTileOffsetFunc(Jn,_t.center.lat,_t.worldSize,wn.getProjection()):null,hm=mc(Ii,Fn.tileID.canonical,cn,Mt,_t,wn.getProjection(),Ai);ed(wn,Ii,_,!1,hm,$r,cn,Se,Tp,Jn)}return{program:Ls,buffers:wn.icon,uniformValues:Ho,atlasTexture:Tu,atlasTextureIcon:null,atlasInterpolation:Ad,atlasInterpolationIcon:null,isSDF:wn.sdfIcons,hasHalo:uh,tile:Fn,labelPlaneMatrixInv:kd}},Mr=()=>{const ea=Ft&&l.layout.get("symbol-placement")!=="point",ta=[],Xa=ea||ti||Xi;_.terrainRenderModeElevated()&&en&&ta.push("PITCH_WITH_MAP_TERRAIN"),Mi&&(ta.push("PROJECTION_GLOBE_VIEW"),Xa&&ta.push("PROJECTED_POS_ON_VIEWPORT")),wn.text.zOffsetVertexBuffer&&ta.push("Z_OFFSET"),wn.iconsInText&&ta.push("RENDER_TEXT_AND_SYMBOL"),ta.push("RENDER_SDF"),dr(ta);const bo=wn.text.programConfigurations.get(l.id),vl=_.getOrCreateProgram("symbol",{config:bo,defines:ta});let Ls,wo=[0,0],qo=null;const ys=wn.textSizeData;wn.iconsInText&&(wo=Fn.imageAtlasTexture?Fn.imageAtlasTexture.size:[0,0],qo=Fn.imageAtlasTexture?Fn.imageAtlasTexture:null,Ls=en||_t.pitch!==0||_.options.rotating||_.options.zooming||ys.kind==="composite"||ys.kind==="camera"?vt.LINEAR:vt.NEAREST);const wa=Fn.glyphAtlasTexture?Fn.glyphAtlasTexture.size:[0,0],fa=l.layout.get("text-size-scale-range"),$r=t.aw(_.scaleFactor,fa[0],fa[1]),is=t.bp(ys,_t.zoom,$r),So=io(Ii,Fn.tileID.canonical,en,Ft,_t,wn.getProjection(),Ai),Lr=Ns(Ii,Fn.tileID.canonical,en,Ft,_t,wn.getProjection(),Ai),Fo=_.translatePosMatrix(Lr,Fn,H,ee,!0),Tc=_.translatePosMatrix(Ii,Fn,H,ee),jl=Xa?cs:So,Su=Ft&&!en&&!ea;let Ho=dn;!Qt&&!_t.mercatorFromTransition||Ft||(Ho=mf(_t));const Tu=pf(ys.kind,is,Su,en,_,Tc,jl,Fo,wt,!0,wa,wo,!0,Jn,si,Vn,er,Mi?Ho:dn,wn.getProjection(),null,null,$r),ac=Fn.glyphAtlasTexture?Fn.glyphAtlasTexture:null,Ad=vt.LINEAR,uh=l.paint.get("text-halo-width").constantOr(1)!==0,kd=_.terrain&&en&&ea?t.ab.mat4.invert(t.ab.mat4.create(),So):cs;if(ea&&wn.text){const Bo=_t.elevation,Tp=Bo?Bo.getAtTileOffsetFunc(Jn,_t.center.lat,_t.worldSize,wn.getProjection()):null,hm=mc(Ii,Fn.tileID.canonical,en,Ft,_t,wn.getProjection(),Ai);ed(wn,Ii,_,!0,hm,Lr,en,ke,Tp,Jn)}return{program:vl,buffers:wn.text,uniformValues:Tu,atlasTexture:ac,atlasTextureIcon:qo,atlasInterpolation:Ad,atlasInterpolationIcon:Ls,isSDF:!0,hasHalo:uh,tile:Fn,labelPlaneMatrixInv:kd}},Ea=wn.icon.segments.get().length,za=wn.text.segments.get().length,ra=Ea&&!A.onlyText?Ur():null,ha=za&&!A.onlyIcons?Mr():null,br=l.paint.get("icon-opacity").constantOr(1),nr=l.paint.get("text-opacity").constantOr(1);if(zt&&wn.canOverlap){Ht=!0;const ea=br&&!A.onlyText?wn.icon.segments.get():[],ta=nr&&!A.onlyIcons?wn.text.segments.get():[];for(const Xa of ea)An.push({segments:new t.b7([Xa]),sortKey:Xa.sortKey,state:ra});for(const Xa of ta)An.push({segments:new t.b7([Xa]),sortKey:Xa.sortKey,state:ha})}else A.onlyText||An.push({segments:br?wn.icon.segments:new t.b7([]),sortKey:0,state:ra}),A.onlyIcons||An.push({segments:nr?wn.text.segments:new t.b7([]),sortKey:0,state:ha})}Ht&&An.sort((Jn,Fn)=>Jn.sortKey-Fn.sortKey);for(const Jn of An){const Fn=Jn.state;if(Fn)if(_.terrain?_.terrain.setupElevationDraw(Fn.tile,Fn.program,{useDepthForOcclusion:_t.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Fn.labelPlaneMatrixInv}):_.setupDepthForOcclusion(_t.depthOcclusionForSymbolsAndCircles,Fn.program),gt.activeTexture.set(vt.TEXTURE0),Fn.atlasTexture&&Fn.atlasTexture.bind(Fn.atlasInterpolation,vt.CLAMP_TO_EDGE,!0),Fn.atlasTextureIcon&&(gt.activeTexture.set(vt.TEXTURE1),Fn.atlasTextureIcon&&Fn.atlasTextureIcon.bind(Fn.atlasInterpolationIcon,vt.CLAMP_TO_EDGE,!0)),_.uploadCommonLightUniforms(_.context,Fn.program),Fn.hasHalo){const wn=Fn.uniformValues;wn.u_is_halo=1,th(Fn.buffers,Jn.segments,l,_,Fn.program,En,w,M,wn,2),wn.u_is_halo=0}else{if(Fn.isSDF){const wn=Fn.uniformValues;Fn.hasHalo&&(wn.u_is_halo=1,th(Fn.buffers,Jn.segments,l,_,Fn.program,En,w,M,wn,1)),wn.u_is_halo=0}th(Fn.buffers,Jn.segments,l,_,Fn.program,En,w,M,Fn.uniformValues,1)}}}function th(_,i,l,y,w,M,A,V,H,K){const ee=[_.dynamicLayoutVertexBuffer,_.opacityVertexBuffer,_.iconTransitioningVertexBuffer,_.globeExtVertexBuffer,_.zOffsetVertexBuffer];w.draw(y,y.context.gl.TRIANGLES,M,A,V,or.disabled,H,l.id,_.layoutVertexBuffer,_.indexBuffer,i,l.paint,y.transform.zoom,_.programConfigurations.get(l.id),ee,K)}function ec(_,i,l,y,w,M,A){const V=_.context.gl,H=l.paint.get("fill-pattern"),K=l.is3D(),ee=K?_.stencilModeFor3D():lr.disabled,se=H&&H.constantOr(1);let le,me,Ee,Se,ke;A?(me=se&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",le=V.LINES):(me=se?"fillPattern":"fill",le=V.TRIANGLES);for(const De of y){const Xe=i.getTile(De);if(se&&!Xe.patternsLoaded())continue;const ut=Xe.getBucket(l);if(!ut)continue;_.prepareDrawTile();const st=ut.programConfigurations.get(l.id),wt=_.isTileAffectedByFog(De),gt=_.getOrCreateProgram(me,{config:st,overrideFog:wt});se&&(_.context.activeTexture.set(V.TEXTURE0),Xe.imageAtlasTexture&&Xe.imageAtlasTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),st.updatePaintBuffers());const vt=H.constantOr(null);if(vt&&Xe.imageAtlas){const Ft=Xe.imageAtlas,cn=t.A.from(vt),en=Ft.patternPositions[cn.getSerializedPrimary()];en&&st.setConstantPatternPositions(en)}const _t=_.translatePosMatrix(De.projMatrix,Xe,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor")),Mt=l.paint.get("fill-emissive-strength");if(A){Se=ut.indexBuffer2,ke=ut.segments2;const Ft=_.terrain&&_.terrain.renderingToTexture?_.terrain.drapeBufferSize:[V.drawingBufferWidth,V.drawingBufferHeight];Ee=me==="fillOutlinePattern"&&se?Dh(_t,Mt,_,Xe,Ft):df(_t,Mt,Ft)}else Se=ut.indexBuffer,ke=ut.segments,Ee=se?hp(_t,Mt,_,Xe):yu(_t,Mt);_.uploadCommonUniforms(_.context,gt,De.toUnwrapped()),gt.draw(_,le,w,K?ee:_.stencilModeForClipping(De),M,or.disabled,Ee,l.id,ut.layoutVertexBuffer,Se,ke,l.paint,_.transform.zoom,st,void 0)}}function Gc(_,i,l,y,w,M,A,V){l.resetLayerRenderingStats(_);const H=_.context,K=H.gl,ee=_.transform,se=l.paint.get("fill-extrusion-pattern"),le=se.constantOr(1),me=l.paint.get("fill-extrusion-opacity"),Ee=_.style.enable3dLights(),Se=l.paint.get(Ee&&!le?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ke=[l.paint.get("fill-extrusion-ambient-occlusion-intensity"),Se],De=l.layout.get("fill-extrusion-edge-radius"),Xe=De>0&&!l.paint.get("fill-extrusion-rounded-roof"),ut=Xe?0:De,st=ee.projection.name==="globe"?t.d3():0,wt=ee.projection.name==="globe",gt=wt?t.ae(ee.zoom):0,vt=[t.at(ee.center.lng),t.aA(ee.center.lat)],_t=l.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Mt=l.paint.get("fill-extrusion-flood-light-color").toRenderColor(_t?null:l.lut).toArray01().slice(0,3),Ft=l.paint.get("fill-extrusion-flood-light-intensity"),cn=l.paint.get("fill-extrusion-vertical-scale"),en=l.paint.get("fill-extrusion-line-width").constantOr(1)!==0,zt=l.paint.get("fill-extrusion-height-alignment"),Ht=l.paint.get("fill-extrusion-base-alignment"),En=Oc(_,l.paint.get("fill-extrusion-cutoff-fade-range")),Vn=[];let ti;wt&&Vn.push("PROJECTION_GLOBE_VIEW"),ke[0]>0&&Vn.push("FAUX_AO"),Xe&&Vn.push("ZERO_ROOF_RADIUS"),V&&Vn.push("HAS_CENTROID"),Ft>0&&Vn.push("FLOOD_LIGHT"),En.shouldRenderCutoff&&Vn.push("RENDER_CUTOFF"),en&&Vn.push("RENDER_WALL_MODE");const Qt=_.renderPass==="shadow",An=_.shadowRenderer,dn=Qt&&!!An;_.shadowRenderer&&(_.shadowRenderer.useNormalOffset=!0);let Jn=[0,0,0];if(An){const Mi=_.style.directionalLight,si=_.style.ambientLight;Mi&&si&&(Jn=cd(_.style,Mi,si)),Qt||(Vn.push("RENDER_SHADOWS","DEPTH_TEXTURE"),An.useNormalOffset&&Vn.push("NORMAL_OFFSET")),ti=Vn.concat(["SHADOWS_SINGLE_CASCADE"])}const Fn=dn?"fillExtrusionDepth":le?"fillExtrusionPattern":"fillExtrusion",wn=l.getLayerRenderingStats();for(const Mi of y){const si=i.getTile(Mi),Ii=si.getBucket(l);if(!Ii||Ii.projection.name!==ee.projection.name)continue;let Ai=!1;An&&(Ai=An.getMaxCascadeForTile(Mi.toUnwrapped())===0);const ur=_.isTileAffectedByFog(Mi),Xi=Ii.programConfigurations.get(l.id),er=_.getOrCreateProgram(Fn,{config:Xi,defines:Ai?ti:Vn,overrideFog:ur});if(_.terrain&&_.terrain.setupElevationDraw(si,er,{useMeterToDem:!0}),!Ii.centroidVertexBuffer){const ha=er.attributes.a_centroid_pos;ha!==void 0&&K.vertexAttrib2f(ha,0,0)}!Qt&&An&&An.setupShadows(si.tileID.toUnwrapped(),er,"vector-tile",si.tileID.overscaledZ),le&&(_.context.activeTexture.set(K.TEXTURE0),si.imageAtlasTexture&&si.imageAtlasTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),Xi.updatePaintBuffers());const dr=se.constantOr(null);if(dr&&si.imageAtlas){const ha=si.imageAtlas,br=t.A.from(dr),nr=ha.patternPositions[br.getSerializedPrimary()];nr&&Xi.setConstantPatternPositions(nr)}const Ur=l.paint.get("fill-extrusion-vertical-gradient"),Mr=1/Ii.tileToMeter;let Ea;if(Qt&&An){if(Xn(si.tileID,Ii,_))continue;const ha=An.calculateShadowPassMatrixFromTile(si.tileID.toUnwrapped());Ea=Uc(ha,ut,Mr,cn,zt,Ht)}else{const ha=_.translatePosMatrix(Mi.expandedProjMatrix,si,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),br=ee.projection.createInversionMatrix(ee,Mi.canonical);Ea=le?up(ha,_,Ur,me,ke,ut,Mr,Mi,si,st,zt,Ht,gt,vt,br,Mt,cn):Qr(ha,_,Ur,me,ke,ut,Mr,Mi,st,zt,Ht,gt,vt,br,Mt,cn,Ft,Jn)}_.uploadCommonUniforms(H,er,Mi.toUnwrapped(),null,En);let za=Ii.segments;if(ee.projection.name==="mercator"&&!Qt&&(za=Ii.getVisibleSegments(si.tileID,_.terrain,_.transform.getFrustum(0)),!za.get().length))continue;if(wn)if(Qt)for(const ha of za.get())wn.numRenderedVerticesInShadowPass+=ha.primitiveLength;else for(const ha of za.get())wn.numRenderedVerticesInTransparentPass+=ha.primitiveLength;const ra=[];(_.terrain||V)&&ra.push(Ii.centroidVertexBuffer),wt&&ra.push(Ii.layoutVertexExtBuffer),en&&ra.push(Ii.wallVertexBuffer),er.draw(_,H.gl.TRIANGLES,w,M,A,or.backCCW,Ea,l.id,Ii.layoutVertexBuffer,Ii.indexBuffer,za,l.paint,_.transform.zoom,Xi,ra)}_.shadowRenderer&&(_.shadowRenderer.useNormalOffset=!1)}function vc(_,i,l,y,w,M,A,V,H,K,ee,se,le,me,Ee,Se,ke,De,Xe){const ut=_.context,st=ut.gl,wt=_.transform,gt=_.transform.zoom,vt=[],_t=Oc(_,l.paint.get("fill-extrusion-cutoff-fade-range"));K==="clear"?(vt.push("CLEAR_SUBPASS"),Xe&&(vt.push("CLEAR_FROM_TEXTURE"),ut.activeTexture.set(st.TEXTURE0),Xe.bind(st.LINEAR,st.CLAMP_TO_EDGE))):K==="sdf"&&vt.push("SDF_SUBPASS"),ke&&vt.push("HAS_CENTROID"),_t.shouldRenderCutoff&&vt.push("RENDER_CUTOFF");const Mt=l.layout.get("fill-extrusion-edge-radius"),Ft=(cn,en,zt,Ht,En)=>{const Vn=en.programConfigurations.get(l.id),ti=_.isTileAffectedByFog(cn),Qt=_.getOrCreateProgram("fillExtrusionGroundEffect",{config:Vn,defines:vt,overrideFog:ti}),An=((Jn,Fn,wn,Mi,si,Ii,Ai,ur,Xi,er,dr)=>({u_matrix:Fn,u_opacity:wn,u_ao_pass:Mi?1:0,u_meter_to_tile:si,u_ao:Ii,u_flood_light_intensity:Ai,u_flood_light_color:ur,u_attenuation:Xi,u_edge_radius:er,u_fb:0,u_fb_size:dr,u_dynamic_offset:1}))(0,Ht,ee,H,En,[se,le*En],me,Ee,Se,gt>=17?0:Mt*En,Xe?Xe.size[0]:0),dn=[];ke&&dn.push(en.hiddenByLandmarkVertexBuffer),_.uploadCommonUniforms(ut,Qt,cn.toUnwrapped(),null,_t),Qt.draw(_,ut.gl.TRIANGLES,w,M,A,V,An,l.id,en.vertexBuffer,en.indexBuffer,zt,l.paint,gt,Vn,dn)};for(const cn of y){const en=i.getTile(cn),zt=en.getBucket(l);if(!zt||zt.projection.name!==wt.projection.name||!zt.groundEffect||zt.groundEffect&&!zt.groundEffect.hasData())continue;const Ht=zt.groundEffect,En=1/zt.tileToMeter;{const Vn=_.translatePosMatrix(cn.projMatrix,en,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),ti=Ht.getDefaultSegment();Ft(cn,Ht,ti,Vn,En)}if(De)for(let Vn=0;Vn<4;Vn++){const ti=t.d4[Vn](cn),Qt=i.getTile(ti);if(!Qt)continue;const An=Qt.getBucket(l);if(!An||An.projection.name!==wt.projection.name||!An.groundEffect||An.groundEffect&&!An.groundEffect.hasData())continue;const dn=An.groundEffect;let Jn,Fn;Vn===0?(Jn=[-t.ag,0,0],Fn=1):Vn===1?(Jn=[t.ag,0,0],Fn=0):Vn===2?(Jn=[0,-t.ag,0],Fn=3):(Jn=[0,t.ag,0],Fn=2);const wn=dn.regionSegments[Fn];if(!wn)continue;const Mi=new Float32Array(16);t.ab.mat4.translate(Mi,cn.projMatrix,Jn),Ft(cn,dn,wn,_.translatePosMatrix(Mi,en,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),En)}}}function gf(_,i,l,y,w,M,A){y.centroidVertexArray.length===0&&y.createCentroidsBuffer();const V=M?M.findDEMTileFor(l):null;if(!(V&&V.dem||A))return;M&&V&&V.dem&&y.selfDEMTileTimestamp!==V.dem._timestamp&&(y.borderDoneWithNeighborZ=[-1,-1,-1,-1],y.selfDEMTileTimestamp=V.dem._timestamp);const H=De=>new t.P(Math.ceil((De+t.d7)*t.d8),0),K=De=>{const Xe=i.getSource().minzoom,ut=wt=>{const gt=i.getTileByID(wt);if(gt&&gt.hasData())return gt.getBucket(w)},st=[0,-1,1];for(const wt of st){if(De.overscaledZ+wt<Xe)continue;const gt=ut(De.calculateScaledKey(De.overscaledZ+wt));if(gt)return gt}},ee=[0,0,0],se=(De,Xe)=>(ee[0]=Math.min(De.min.y,Xe.min.y),ee[1]=Math.max(De.max.y,Xe.max.y),ee[2]=t.ag-Xe.min.x>De.max.x?Xe.min.x-t.ag:De.max.x,ee),le=(De,Xe)=>(ee[0]=Math.min(De.min.x,Xe.min.x),ee[1]=Math.max(De.max.x,Xe.max.x),ee[2]=t.ag-Xe.min.y>De.max.y?Xe.min.y-t.ag:De.max.y,ee),me=[(De,Xe)=>se(De,Xe),(De,Xe)=>se(Xe,De),(De,Xe)=>le(De,Xe),(De,Xe)=>le(Xe,De)],Ee=(De,Xe,ut,st,wt,gt,vt)=>{if(!M)return 0;const _t=[[gt?ut:De,gt?De:ut,0],[gt?ut:Xe,gt?Xe:ut,0]],Mt=vt<0?t.ag+vt:vt,Ft=[gt?Mt:(De+Xe)/2,gt?(De+Xe)/2:Mt,0];return ut===0&&vt<0||ut!==0&&vt>0?M.getForTilePoints(wt,[Ft],!0,st):_t.push(Ft),M.getForTilePoints(l,_t,!0,V),Math.max(_t[0][2],_t[1][2],Ft[2])/M.exaggeration()};for(let De=0;De<4;De++){const Xe=y.borderFeatureIndices[De];if(Xe.length===0)continue;const ut=t.d4[De](l),st=K(ut);if(!(st&&st instanceof t.d5))continue;const wt=M?M.findDEMTileFor(ut):null;if(!(wt&&wt.dem||A)||(M&&wt&&wt.dem&&y.borderDEMTileTimestamp[De]!==wt.dem._timestamp&&(y.borderDoneWithNeighborZ[De]=-1,y.borderDEMTileTimestamp[De]=wt.dem._timestamp),y.borderDoneWithNeighborZ[De]===st.canonical.z))continue;st.centroidVertexArray.length===0&&st.createCentroidsBuffer();const gt=(De<2?1:5)-De,vt=st.borderDoneWithNeighborZ[gt]!==y.canonical.z,_t=st.borderFeatureIndices[gt];let Mt=0;if(y.canonical.z!==st.canonical.z){for(const Ft of Xe)y.showCentroid(y.featuresOnBorder[Ft]);if(vt)for(const Ft of _t)st.showCentroid(st.featuresOnBorder[Ft]);y.borderDoneWithNeighborZ[De]=st.canonical.z,st.borderDoneWithNeighborZ[gt]=y.canonical.z}for(const Ft of Xe){const cn=y.featuresOnBorder[Ft],en=y.centroidData[cn.centroidDataIndex],zt=cn.borders[De];let Ht;for(;Mt<_t.length;){Ht=st.featuresOnBorder[_t[Mt]];const En=Ht.borders[gt];if(En[1]>zt[0]+3||En[0]>zt[0]-3)break;st.showCentroid(Ht),Mt++}if(Ht&&Mt<_t.length){const En=Mt;let Vn=0;for(;!(Ht.borders[gt][0]>zt[1]-3)&&(Vn++,++Mt!==_t.length);)Ht=st.featuresOnBorder[_t[Mt]];Ht=st.featuresOnBorder[_t[En]];let ti=!1;if(Vn>=1){const dn=Ht.borders[gt];Math.abs(zt[0]-dn[0])<3&&Math.abs(zt[1]-dn[1])<3&&(Vn=1,ti=!0,Mt=En+1)}else if(Vn===0){y.showCentroid(cn);continue}const Qt=st.centroidData[Ht.centroidDataIndex];A&&ti&&(((Se=en).flags|(ke=Qt).flags)&t.d6?(Se.flags|=t.d6,ke.flags|=t.d6):(Se.flags&=~t.d6,ke.flags&=~t.d6));const An=cn.intersectsCount()>1||Ht.intersectsCount()>1;if(Vn>1)Mt=En,en.centroidXY=Qt.centroidXY=new t.P(0,0);else if(wt&&wt.dem&&!An){const dn=me[De](en,Qt),Jn=De%2?t.ag-1:0,Fn=Ee(dn[0],Math.min(t.ag-1,dn[1]),Jn,wt,ut,De<2,dn[2]);en.centroidXY=Qt.centroidXY=H(Fn)}else An?en.centroidXY=Qt.centroidXY=new t.P(0,0):(en.centroidXY=y.encodeBorderCentroid(cn),Qt.centroidXY=st.encodeBorderCentroid(Ht));y.writeCentroidToBuffer(en),st.writeCentroidToBuffer(Qt)}else y.showCentroid(cn)}y.borderDoneWithNeighborZ[De]=st.canonical.z,st.borderDoneWithNeighborZ[gt]=y.canonical.z}var Se,ke;(y.needsCentroidUpdate||!y.centroidVertexBuffer&&y.centroidVertexArray.length!==0)&&y.uploadCentroid(_)}const _f=[1,0,0],nh=[0,1,0],xc=[0,0,1];function Xn(_,i,l){const y=l.transform,w=l.shadowRenderer;if(!w)return!0;const M=_.toUnwrapped(),A=y.tileSize*w._cascades[l.currentShadowCascade].scale;let V=i.maxHeight;if(y.elevation){const Se=y.elevation.getMinMaxForTile(_);Se&&(V+=Se.max)}const H=[...w.shadowDirection];H[2]=-H[2];const K=w.computeSimplifiedTileShadowVolume(M,V,A,H);if(!K)return!1;const ee=[_f,nh,xc,H,[H[0],0,H[2]],[0,H[1],H[2]]],se=y.projection.name==="globe",le=y.scaleZoom(A),me=t.bR.fromInvProjectionMatrix(y.invProjMatrix,y.worldSize,le,!se),Ee=w.getCurrentCascadeFrustum();return me.intersectsPrecise(K.vertices,K.planes,ee)===0||Ee.intersectsPrecise(K.vertices,K.planes,ee)===0}function Ei(_){return[_[0]*t.d9,_[1]*t.d9,_[2]*t.d9,0]}function bc(_,i,l,y,w,M,A,V,H){const K=y.getSource(),ee=l.globeSharedBuffers;if(!ee)return;let se,le,me;if(i&&(se=y.getTile(i)),K instanceof t.aJ?(le=K.texture,me=t.cI(0,0,l.transform)):se&&i&&(le=se.texture,me=t.cI(i.canonical.z,i.canonical.x,l.transform)),!le||!me)return;_||(me=t.ab.mat4.scale(t.ab.mat4.create(),me,[1,-1,1]));const Ee=l.context,Se=Ee.gl,ke=w.paint.get("raster-resampling")==="nearest"?Se.NEAREST:Se.LINEAR,De=l.colorModeForDrapableLayerRenderPass(M),Xe=A.defines;Xe.push("GLOBE_POLES");const ut=new Zi(Se.LEQUAL,Zi.ReadWrite,l.depthRangeFor3D),st=Float32Array.from(l.transform.expandedFarZProjMatrix),wt=Float32Array.from(t.bb(t.cH(new t.bT(0,0,0))));l.terrain&&l.terrain.prepareDrawTile(),Ee.activeTexture.set(Se.TEXTURE0),le.bind(ke,Se.CLAMP_TO_EDGE),Ee.activeTexture.set(Se.TEXTURE1),le.bind(ke,Se.CLAMP_TO_EDGE),le.useMipmap&&Ee.extTextureFilterAnisotropic&&l.transform.pitch>20&&Se.texParameterf(Se.TEXTURE_2D,Ee.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Ee.extTextureFilterAnisotropicMax);const[gt,vt,_t,Mt]=i?ee.getPoleBuffers(i.canonical.z,!1):ee.getPoleBuffers(0,!0),Ft=w.paint.get("raster-elevation");let cn;_?(cn=gt,l.renderDefaultNorthPole=Ft!==0):(cn=vt,l.renderDefaultSouthPole=Ft!==0);const en=Ei(A.mix),zt=((En,Vn,ti,Qt,An,dn,Jn,Fn,wn,Mi,si,Ii,Ai)=>yc(En,Vn,ti,new Float32Array(16),new Float32Array(9),[0,0],Qt,[0,0],[0,0,0,0],1,{opacity:1,mix:0},dn,[0,0],Fn,2,Mi,si,Ii,1,0,Ai))(st,wt,me,t.ae(l.transform.zoom),0,w,0,Ft,0,en,A.offset,A.range,M),Ht=l.getOrCreateProgram("raster",{defines:Xe});l.uploadCommonUniforms(Ee,Ht,null),Ht.draw(l,Se.TRIANGLES,ut,H,De,V,zt,w.id,cn,_t,Mt)}function _a(_){const i=_._nearZ,l=_.projection.farthestPixelDistance(_),y=l-i,w=.2*_.height,M=i+w;return[i,l,(M-w-i)/y,(M-i)/y]}function tn(_,i,l,y){if(_)return i instanceof dc&&_ instanceof es?i.getTextureDescriptor(_,l,!0):{texture:_.texture,mix:Ei(y.mix),offset:y.offset,buffer:0,tileSize:1}}var mp=t.da([{name:"a_index",type:"Int16",components:1}]);class ih{constructor(i,l,y,w){const M={width:y[0],height:y[1],data:null},A=i.gl;this.targetColorTexture=new t.T(i,M,A.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new t.T(i,M,A.RGBA8,{useMipmap:!1}),this.context=i,this.updateParticleTexture(l,w),this.lastInvalidatedAt=0}updateParticleTexture(i,l){if(this.particleTextureDimension===l.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const y=this.context.gl,w=l.width*l.height;this.particleTexture0=new t.T(this.context,l,y.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new t.T(this.context,l,y.RGBA8,{premultiply:!1,useMipmap:!1});const M=new t.db;M.reserve(w);for(let A=0;A<w;A++)M.emplaceBack(A);this.particleIndexBuffer=this.context.createVertexBuffer(M,mp.members,!0),this.particleSegment=t.b7.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=l.width}update(i){return!(this.lastInvalidatedAt<i&&(this.lastInvalidatedAt=t.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function yf(_,i,l){if(!_)return null;const y=i.getTextureDescriptor(_,l,!0);if(!y)return null;let{texture:w,mix:M,offset:A,tileSize:V,buffer:H,format:K}=y;if(!w||!K)return null;let ee=!1;return K==="uint32"&&(ee=!0,M[3]=0,M=xd(t.dc,M,[0,l.paint.get("raster-particle-max-speed")]),A=ki(t.dc,A,[0,l.paint.get("raster-particle-max-speed")])),{texture:w,textureOffset:[H/(V+2*H),V/(V+2*H)],tileSize:V,scalarData:ee,scale:M,offset:A,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[K]]}}function B(_){const i=_._nearZ,l=_.projection.farthestPixelDistance(_),y=l-i,w=.2*_.height,M=i+w;return[i,l,(M-w-i)/y,(M-i)/y]}const r=new t.aj(1,0,0,1),p=new t.aj(0,1,0,1),C=new t.aj(0,0,1,1),k=new t.aj(1,0,1,1),j=new t.aj(0,1,1,1);function Z(_,i,l,y,w,M,A){const V=_.context,H=_.transform,K=V.gl,ee=H.projection.name==="globe",se=ee?["PROJECTION_GLOBE_VIEW"]:[];let le=t.ab.mat4.clone(l.projMatrix);if(ee&&t.ae(H.zoom)>0){const en=t.ba(l.canonical,H),zt=t.dd(en);le=t.ab.mat4.multiply(new Float32Array(16),H.globeMatrix,zt),t.ab.mat4.multiply(le,H.projMatrix,le)}const me=t.ab.mat4.create();me[12]+=2*w/(t.q.devicePixelRatio*H.width),me[13]+=2*M/(t.q.devicePixelRatio*H.height),t.ab.mat4.multiply(le,me,le);const Ee=_.getOrCreateProgram("debug",{defines:se}),Se=i.getTileByID(l.key);_.terrain&&_.terrain.setupElevationDraw(Se,Ee);const ke=Zi.disabled,De=lr.disabled,Xe=_.colorModeForRenderPass(),ut="$debug";V.activeTexture.set(K.TEXTURE0),_.emptyTexture.bind(K.LINEAR,K.CLAMP_TO_EDGE),ee?Se._makeGlobeTileDebugBuffers(_.context,H):Se._makeDebugTileBoundsBuffers(_.context,H.projection);const st=Se._tileDebugBuffer||_.debugBuffer,wt=Se._tileDebugIndexBuffer||_.debugIndexBuffer,gt=Se._tileDebugSegments||_.debugSegments;if(Ee.draw(_,K.LINE_STRIP,ke,De,Xe,or.disabled,dp(le,y),ut,st,wt,gt,null,null,null,[Se._globeTileDebugBorderBuffer]),A){const en=Se.latestRawTileData,zt=Math.floor((en&&en.byteLength||0)/1024);let Ht=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(Ht+=` => ${l.overscaledZ}`),Ht+=` ${Se.state}`,Ht+=` ${zt}kb`,function(En,Vn){En.initDebugOverlayCanvas();const ti=En.debugOverlayCanvas,Qt=En.context.gl,An=En.debugOverlayCanvas.getContext("2d");An.clearRect(0,0,ti.width,ti.height),An.shadowColor="white",An.shadowBlur=2,An.lineWidth=1.5,An.strokeStyle="white",An.textBaseline="top",An.font="bold 36px Open Sans, sans-serif",An.fillText(Vn,5,5),An.strokeText(Vn,5,5),En.debugOverlayTexture.update(ti),En.debugOverlayTexture.bind(Qt.LINEAR,Qt.CLAMP_TO_EDGE)}(_,Ht)}const vt=i.getTile(l).tileSize,_t=512/Math.min(vt,512)*(l.overscaledZ/H.zoom)*.5,Mt=Se._tileDebugTextBuffer||_.debugBuffer,Ft=Se._tileDebugTextIndexBuffer||_.quadTriangleIndexBuffer,cn=Se._tileDebugTextSegments||_.debugSegments;Ee.draw(_,K.TRIANGLES,ke,De,Tr.alphaBlended,or.disabled,dp(le,t.aj.transparent,_t),ut,Mt,Ft,cn,null,null,null,[Se._globeTileDebugTextBuffer])}function re(_,i,l,y){ye(_,0,i+l/2,_.transform.width,l,y)}function ue(_,i,l,y){ye(_,i-l/2,0,l,_.transform.height,y)}function ye(_,i,l,y,w,M){const A=_.context,V=A.gl;V.enable(V.SCISSOR_TEST),V.scissor(i*t.q.devicePixelRatio,l*t.q.devicePixelRatio,y*t.q.devicePixelRatio,w*t.q.devicePixelRatio),A.clear({color:M}),V.disable(V.SCISSOR_TEST)}const Me=t.da([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Re}=Me;function ze(_,i,l,y){_.emplaceBack(i,l,y)}class Je{constructor(i){this.vertexArray=new t.de,this.indices=new t.aU,ze(this.vertexArray,-1,-1,1),ze(this.vertexArray,1,-1,1),ze(this.vertexArray,-1,1,1),ze(this.vertexArray,1,1,1),ze(this.vertexArray,-1,-1,-1),ze(this.vertexArray,1,-1,-1),ze(this.vertexArray,-1,1,-1),ze(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,Re),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=t.b7.simpleSegment(0,0,36,12)}}function ot(_,i,l,y,w,M){const A=_.context.gl,V=i.paint.get("sky-atmosphere-color"),H=i.paint.get("sky-atmosphere-halo-color"),K=i.paint.get("sky-atmosphere-sun-intensity"),ee=((se,le,me,Ee,Se)=>({u_matrix_3f:se,u_sun_direction:le,u_sun_intensity:me,u_color_tint_r:[Ee.r,Ee.g,Ee.b,Ee.a],u_color_tint_m:[Se.r,Se.g,Se.b,Se.a],u_luminance:5e-5}))(t.ab.mat3.fromMat4(t.ab.mat3.create(),y),w,K,V,H);A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.TEXTURE_CUBE_MAP_POSITIVE_X+M,i.skyboxTexture,0),l.draw(_,A.TRIANGLES,Zi.disabled,lr.disabled,Tr.unblended,or.frontCW,ee,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const Pt=t.da([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Et{constructor(i){const l=new t.df;l.emplaceBack(-1,1,1,0,0),l.emplaceBack(1,1,1,1,0),l.emplaceBack(1,-1,1,1,1),l.emplaceBack(-1,-1,1,0,1);const y=new t.aU;y.emplaceBack(0,1,2),y.emplaceBack(2,3,0),this.vertexBuffer=i.createVertexBuffer(l,Pt.members),this.indexBuffer=i.createIndexBuffer(y),this.segments=t.b7.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Lt=t.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class jt{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Nt{constructor(i){this.colorModeAlphaBlendedWriteRGB=new Tr([1,Rl,1,Rl],t.aj.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Tr([1,0,1,0],t.aj.transparent,[!1,!1,!1,!0]),this.params=new jt,this.updateNeeded=!0,i.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),i.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),i.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(i){const l=i.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Et(l);const y=this.params.sizeRange,w=this.params.intensityRange,M=function(ee){const se=t.di(30),le=[];for(let me=0;me<ee;++me){const Ee=2*Math.PI*se(),Se=Math.acos(1-2*se())-.5*Math.PI;le.push(t.ab.vec3.fromValues(Math.cos(Se)*Math.cos(Ee),Math.cos(Se)*Math.sin(Ee),Math.sin(Se)))}return le}(this.params.starsCount),A=t.di(300),V=new t.dg,H=new t.aU;let K=0;for(let ee=0;ee<M.length;++ee){const se=t.ab.vec3.scale([],M[ee],200),le=Math.max(0,1+.01*y*(1*A()-.5)),me=Math.max(0,1+.01*w*(1*A()-.5));V.emplaceBack(se[0],se[1],se[2],-1,-1,le,me),V.emplaceBack(se[0],se[1],se[2],1,-1,le,me),V.emplaceBack(se[0],se[1],se[2],1,1,le,me),V.emplaceBack(se[0],se[1],se[2],-1,1,le,me),H.emplaceBack(K+0,K+1,K+2),H.emplaceBack(K+0,K+2,K+3),K+=4}this.starsVx=l.createVertexBuffer(V,Lt.members),this.starsIdx=l.createIndexBuffer(H),this.starsSegments=t.b7.simpleSegment(0,0,V.length,H.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(i,l){const y=i.context,w=y.gl,M=i.transform,A=new Zi(w.LEQUAL,Zi.ReadOnly,[0,1]),V=t.ae(M.zoom),H=i.style.getLut(l.scope),K=l.properties.get("color-use-theme")==="none",ee=l.properties.get("color").toRenderColor(K?null:H).toArray01(),se=l.properties.get("high-color-use-theme")==="none",le=l.properties.get("high-color").toRenderColor(se?null:H).toArray01(),me=l.properties.get("space-color-use-theme")==="none",Ee=l.properties.get("space-color").toRenderColor(me?null:H).toArray01PremultipliedAlpha(),Se=5e-4,ke=t.dh(l.properties.get("horizon-blend"),0,1,Se,.25),De=t.cC(i,y,M)&&ke===Se?M.worldSize/(2*Math.PI*1.025)-1:M.globeRadius,Xe=i.frameCounter/1e3%1,ut=t.ab.vec3.length(M.globeCenterInViewSpace),st=Math.sqrt(Math.pow(ut,2)-Math.pow(De,2)),wt=Math.acos(st/ut),gt=vt=>{const _t=M.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];vt&&_t.push("ALPHA_PASS");const Mt=i.getOrCreateProgram("globeAtmosphere",{defines:_t}),Ft=((en,zt,Ht,En,Vn,ti,Qt,An,dn,Jn,Fn,wn)=>({u_frustum_tl:en,u_frustum_tr:zt,u_frustum_br:Ht,u_frustum_bl:En,u_horizon:Vn,u_transition:ti,u_fadeout_range:Qt,u_color:An,u_high_color:dn,u_space_color:Jn,u_temporal_offset:Fn,u_horizon_angle:wn}))(M.frustumCorners.TL,M.frustumCorners.TR,M.frustumCorners.BR,M.frustumCorners.BL,M.frustumCorners.horizon,V,ke,ee,le,Ee,Xe,wt);i.uploadCommonUniforms(y,Mt);const cn=this.atmosphereBuffer;cn&&Mt.draw(i,w.TRIANGLES,A,lr.disabled,vt?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,or.backCW,Ft,vt?"atmosphere_glow_alpha":"atmosphere_glow",cn.vertexBuffer,cn.indexBuffer,cn.segments)};gt(!1),gt(!0)}drawStars(i,l){const y=t.aw(l.properties.get("star-intensity"),0,1);if(y===0)return;const w=i.context,M=w.gl,A=i.transform,V=i.getOrCreateProgram("stars"),H=t.ab.quat.identity([]);t.ab.quat.rotateX(H,H,-A._pitch),t.ab.quat.rotateZ(H,H,-A.angle),t.ab.quat.rotateX(H,H,t.ai(A._center.lat)),t.ab.quat.rotateY(H,H,-t.ai(A._center.lng));const K=t.ab.mat4.fromQuat(new Float32Array(16),H),ee=t.ab.mat4.multiply([],A.starsProjMatrix,K),se=t.ab.mat3.fromMat4([],K),le=t.ab.mat3.invert([],se),me=[0,1,0];t.ab.vec3.transformMat3(me,me,le),t.ab.vec3.scale(me,me,this.params.sizeMultiplier);const Ee=[1,0,0];t.ab.vec3.transformMat3(Ee,Ee,le),t.ab.vec3.scale(Ee,Ee,this.params.sizeMultiplier);const Se=(ke=me,De=Ee,Xe=y,{u_matrix:Float32Array.from(ee),u_up:ke,u_right:De,u_intensity_multiplier:Xe});var ke,De,Xe;i.uploadCommonUniforms(w,V),this.starsVx&&this.starsIdx&&V.draw(i,M.TRIANGLES,Zi.disabled,lr.disabled,this.colorModeAlphaBlendedWriteRGB,or.disabled,Se,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Bt(_,i){const l=[..._],y=i.cameraWorldSizeForFog/i.worldSize,w=t.ab.mat4.identity([]);return t.ab.mat4.scale(w,w,[y,y,1]),t.ab.mat4.multiply(l,w,l),t.ab.mat4.multiply(l,i.worldToFogMatrix,l),l}function nn(_,i,l,y,w){const M=l.material,A=y.context,{baseColorTexture:V,metallicRoughnessTexture:H}=M.pbrMetallicRoughness,{normalTexture:K,occlusionTexture:ee,emissionTexture:se}=M;function le(Ee,Se,ke){if(Ee&&(_.push(Se),A.activeTexture.set(A.gl.TEXTURE0+ke),Ee.gfxTexture)){const{minFilter:De,magFilter:Xe,wrapS:ut,wrapT:st}=Ee.sampler;Ee.gfxTexture.bindExtraParam(De,Xe,ut,st)}}le(V,"HAS_TEXTURE_u_baseColorTexture",Ds.BaseColor),le(H,"HAS_TEXTURE_u_metallicRoughnessTexture",Ds.MetallicRoughness),le(K,"HAS_TEXTURE_u_normalTexture",Ds.Normal),le(ee,"HAS_TEXTURE_u_occlusionTexture",Ds.Occlusion),le(se,"HAS_TEXTURE_u_emissionTexture",Ds.Emission),w&&(w.texture||(w.texture=new t.dk(y.context,w.image,[w.image.height,w.image.height,w.image.height],A.gl.RGBA8)),A.activeTexture.set(A.gl.TEXTURE0+Ds.LUT),w.texture&&w.texture.bind(A.gl.LINEAR,A.gl.CLAMP_TO_EDGE),_.push("APPLY_LUT_ON_GPU")),l.texcoordBuffer&&(_.push("HAS_ATTRIBUTE_a_uv_2f"),i.push(l.texcoordBuffer)),l.colorBuffer&&(_.push(l.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),i.push(l.colorBuffer)),l.normalBuffer&&(_.push("HAS_ATTRIBUTE_a_normal_3f"),i.push(l.normalBuffer)),l.pbrBuffer&&(_.push("HAS_ATTRIBUTE_a_pbr"),_.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),i.push(l.pbrBuffer)),M.alphaMode!=="OPAQUE"&&M.alphaMode!=="MASK"||_.push("UNPREMULT_TEXTURE_IN_SHADER"),M.defined||_.push("DIFFUSE_SHADED"),_.push("USE_STANDARD_DERIVATIVES");const me=y.shadowRenderer;me&&(_.push("RENDER_SHADOWS","DEPTH_TEXTURE"),me.useNormalOffset&&_.push("NORMAL_OFFSET"))}function rn(_,i,l,y,w,M){const A=l.paint.get("model-opacity").constantOr(1),V=i.context,H=new Zi(i.context.gl.LEQUAL,Zi.ReadWrite,i.depthRangeFor3D),K=i.transform,ee=_.mesh,se=ee.material,le=se.pbrMetallicRoughness,me=i.style.fog;let Ee;Ee=i.transform.projection.zAxisUnit==="pixels"?[..._.nodeModelMatrix]:t.ab.mat4.multiply([],y.zScaleMatrix,_.nodeModelMatrix),t.ab.mat4.multiply(Ee,y.negCameraPosMatrix,Ee);const Se=t.ab.mat4.invert([],Ee);t.ab.mat4.transpose(Se,Se);const ke=l.paint.get("model-color-use-theme").constantOr("default")==="none",De=l.paint.get("model-emissive-strength").constantOr(0),Xe=xr(new Float32Array(_.worldViewProjection),new Float32Array(Ee),new Float32Array(Se),null,i,A,le.baseColorFactor.toRenderColor(null),se.emissiveFactor,le.metallicFactor,le.roughnessFactor,se,De,l),ut={defines:[]},st=[],wt=i.shadowRenderer;wt&&(wt.useNormalOffset=!1),nn(ut.defines,st,ee,i,ke?null:l.lut);let gt=null;if(me){const Mt=Bt(_.nodeModelMatrix,i.transform);if(gt=new Float32Array(Mt),K.projection.name!=="globe"){const Ft=ee.aabb.min,cn=ee.aabb.max,[en,zt]=me.getOpacityForBounds(Mt,Ft[0],Ft[1],cn[0],cn[1]);ut.overrideFog=en>=li||zt>=li}}const vt=Oc(i,l.paint.get("model-cutoff-fade-range"));vt.shouldRenderCutoff&&ut.defines.push("RENDER_CUTOFF");const _t=i.getOrCreateProgram("model",ut);i.uploadCommonUniforms(V,_t,null,gt,vt),i.renderPass!=="shadow"&&wt&&wt.setupShadowsFromMatrix(_.nodeModelMatrix,_t),_t.draw(i,V.gl.TRIANGLES,H,w,M,ee.material.doubleSided?or.disabled:or.backCCW,Xe,l.id,ee.vertexBuffer,ee.indexBuffer,ee.segments,l.paint,i.transform.zoom,void 0,st)}function an(_,i,l,y,w,M,A){let V;V=_.projection.name==="globe"?t.dl(l,_):[...l],t.ab.mat4.multiply(V,V,i.matrix);const H=t.ab.mat4.multiply([],y,V);if(i.meshes)for(const K of i.meshes){if(K.material.alphaMode!=="BLEND"){A.push({mesh:K,depth:0,modelIndex:w,worldViewProjection:H,nodeModelMatrix:V});continue}const ee=t.ab.vec3.transformMat4([],K.centroid,H);ee[2]>0&&M.push({mesh:K,depth:ee[2],modelIndex:w,worldViewProjection:H,nodeModelMatrix:V})}if(i.children)for(const K of i.children)an(_,K,l,y,w,M,A)}function Mn(_,i,l,y){const w=l.shadowRenderer;if(!w)return;const M=w.getShadowPassDepthMode(),A=w.getShadowPassColorMode(),V=w.calculateShadowPassMatrixFromMatrix(i),H=bd(V);l.getOrCreateProgram("modelDepth",{defines:l._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(l,l.context.gl.TRIANGLES,M,lr.disabled,A,or.backCCW,H,y.id,_.vertexBuffer,_.indexBuffer,_.segments,y.paint,l.transform.zoom,void 0,void 0)}function Rn(_,i,l){const y=i.updateZoomBasedPaintProperties(),w=function(M,A,V){let H,K,ee,se=M.terrain?M.terrain.exaggeration():0;if(M.terrain&&se>0){const le=M.terrain,me=le.findDEMTileFor(V);me&&me.dem?H=t.dn.create(le,V,me):se=0}if(se===0&&(A.terrainElevationMin=0,A.terrainElevationMax=0),se===A.validForExaggeration&&(se===0||H&&H._demTile&&H._demTile.tileID===A.validForDEMTile.id&&H._dem._timestamp===A.validForDEMTile.timestamp))return!1;for(const le in A.instancesPerModel){const me=A.instancesPerModel[le];for(let Ee=0;Ee<me.instancedDataArray.length;++Ee){const Se=(H?se*H.getElevationAt(0|me.instancedDataArray.float32[16*Ee],0|me.instancedDataArray.float32[16*Ee+1],!0,!0):0)+me.instancesEvaluatedElevation[Ee];me.instancedDataArray.float32[16*Ee+6]=Se,K=K?Math.min(A.terrainElevationMin,Se):Se,ee=ee?Math.max(A.terrainElevationMax,Se):Se}}return A.terrainElevationMin=K||0,A.terrainElevationMax=ee||0,A.validForExaggeration=se,A.validForDEMTile=H&&H._demTile?{id:H._demTile.tileID,timestamp:H._dem._timestamp}:{id:void 0,timestamp:0},!0}(_,i,l);(y||w)&&(i.uploaded=!1,i.upload(_.context))}const Hn={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new t.cd([0,0,0],[t.ag,t.ag,0])};function ei(_,i){const l=1<<_.canonical.z,y=i.getFreeCameraOptions().position,w=i.elevation,M=_.canonical.x/l,A=(_.canonical.x+1)/l,V=_.canonical.y/l,H=(_.canonical.y+1)/l;let K=i._centerAltitude;if(w){const me=w.getMinMaxForTile(_);me&&me.max>K&&(K=me.max)}const ee=t.aw(y.x,M,A)-y.x,se=t.aw(y.y,V,H)-y.y,le=t.bH(K,i.center.lat)-y.z;return i._zoomFromMercatorZ(Math.sqrt(ee*ee+se*se+le*le))}function jn(_,i,l,y,w,M,A){const V=_.context,H=_.renderPass==="shadow",K=_.shadowRenderer,ee=H&&K?K.getShadowPassDepthMode():new Zi(V.gl.LEQUAL,Zi.ReadWrite,_.depthRangeFor3D),se=_.isTileAffectedByFog(M);if(l.meshes)for(const le of l.meshes){const me=["MODEL_POSITION_ON_GPU"],Ee=[];let Se,ke,De;y.instancedDataArray.length>20&&me.push("INSTANCED_ARRAYS");const Xe=Oc(_,i.paint.get("model-cutoff-fade-range"));if(Xe.shouldRenderCutoff&&me.push("RENDER_CUTOFF"),H&&K)Se=_.getOrCreateProgram("modelDepth",{defines:me}),ke=bd(A.shadowTileMatrix,A.shadowTileMatrix,Float32Array.from(l.matrix)),De=K.getShadowPassColorMode();else{nn(me,Ee,le,_,i.paint.get("model-color-use-theme").constantOr("default")==="none"?null:i.lut),Se=_.getOrCreateProgram("model",{defines:me,overrideFog:se});const st=le.material,wt=st.pbrMetallicRoughness,gt=i.paint.get("model-opacity").constantOr(1),vt=i.paint.get("model-emissive-strength").constantOr(0);ke=xr(M.expandedProjMatrix,Float32Array.from(l.matrix),new Float32Array(16),null,_,gt,wt.baseColorFactor.toRenderColor(null),st.emissiveFactor,wt.metallicFactor,wt.roughnessFactor,st,vt,i,w),K&&(A.shadowUniformsInitialized?Se.setShadowUniformValues(V,K.getShadowUniformValues()):(K.setupShadows(M.toUnwrapped(),Se,"model-tile",M.overscaledZ),A.shadowUniformsInitialized=!0)),De=Xe.shouldRenderCutoff||gt<1||st.alphaMode!=="OPAQUE"?Tr.alphaBlended:Tr.unblended}_.uploadCommonUniforms(V,Se,M.toUnwrapped(),null,Xe);const ut=le.material.doubleSided?or.disabled:or.backCCW;if(y.instancedDataArray.length>20)Ee.push(y.instancedDataBuffer),Se.draw(_,V.gl.TRIANGLES,ee,lr.disabled,De,ut,ke,i.id,le.vertexBuffer,le.indexBuffer,le.segments,i.paint,_.transform.zoom,void 0,Ee,y.instancedDataArray.length);else{const st=H?"u_instance":"u_normal_matrix";for(let wt=0;wt<y.instancedDataArray.length;++wt)ke[st]=new Float32Array(y.instancedDataArray.arrayBuffer,64*wt,16),Se.draw(_,V.gl.TRIANGLES,ee,lr.disabled,De,ut,ke,i.id,le.vertexBuffer,le.indexBuffer,le.segments,i.paint,_.transform.zoom,void 0,Ee)}}if(l.children)for(const le of l.children)jn(_,i,le,y,w,M,A)}const Ri=[1,-1,1];function zi(_,i,l,y){if(!l.modelManager)return!0;const w=l.modelManager;if(!l.shadowRenderer)return!0;const M=l.shadowRenderer,A=i.aabb;let V=!0,H=_.maxHeight;if(H===0){let ee=0;for(const se in _.instancesPerModel){const le=w.getModel(se,y);le?ee=Math.max(ee,Math.max(Math.max(le.aabb.max[0],le.aabb.max[1]),le.aabb.max[2])):V=!1}H=_.maxScale*ee*1.41+_.maxVerticalOffset,V&&(_.maxHeight=H)}A.max[2]=H,A.min[2]+=_.terrainElevationMin,A.max[2]+=_.terrainElevationMax,t.ab.vec3.transformMat4(A.min,A.min,i.tileMatrix),t.ab.vec3.transformMat4(A.max,A.max,i.tileMatrix);const K=A.intersects(M.getCurrentCascadeFrustum());return l.currentShadowCascade===0&&(_.isInsideFirstShadowMapFrustum=K===2),K===0}function xi(_,i){const l=_.uniformValues.u_cutoff_params[0],y=_.uniformValues.u_cutoff_params[1],w=_.uniformValues.u_cutoff_params[2],M=_.uniformValues.u_cutoff_params[3];return y===l||M===w?1:t.aw(((i-l)/(y-l)-w)/(M-w),0,1)}function Gi(_,i,l,y){if(i.pitch<20)return 1;const w=i.getWorldToCameraMatrix();t.ab.mat4.multiply(w,w,_);const M=t.ab.vec4.fromValues(l.min[0],l.min[1],l.min[2],1);let A=t.ab.vec4.transformMat4(t.ab.vec4.create(),M,w),V=A,H=A;M[1]=l.max[1],A=t.ab.vec4.transformMat4(t.ab.vec4.create(),M,w),V=A[1]<V[1]?A:V,H=A[1]>H[1]?A:H,M[0]=l.max[0],A=t.ab.vec4.transformMat4(t.ab.vec4.create(),M,w),V=A[1]<V[1]?A:V,H=A[1]>H[1]?A:H,M[1]=l.min[1],A=t.ab.vec4.transformMat4(t.ab.vec4.create(),M,w),V=A[1]<V[1]?A:V,H=A[1]>H[1]?A:H;const K=t.aw(y[0],0,1),ee=100*i.pixelsPerMeter*t.aw(y[1],0,1),se=t.aw(y[2],0,1),le=t.ab.vec4.lerp(t.ab.vec4.create(),V,H,K),me=Math.tan(.5*i.fovX),Ee=-le[2]*me;if(ee===0)return le[1]<-Math.abs(Ee)?se:1;const Se=(-Math.abs(Ee)-le[1])/ee,ke=(Xe,ut,st)=>(1-st)*Xe+st*ut,De=t.aw(ke(1,se,Se),se,1);return ke(1,De,t.aw((i.pitch-20)/20,0,1))}class Hr{}class ua{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(i,l,y){{const se=this._storage.get(l.id);if(se)return se.lastUsedFrameIdx=i,se.buf}const w=y.gl,M=w.getBufferParameter(w.ELEMENT_ARRAY_BUFFER,w.BUFFER_SIZE),A=new ArrayBuffer(M),V=new Int16Array(A);w.getBufferSubData(w.ELEMENT_ARRAY_BUFFER,0,new Int16Array(A));const H=new t.dq;for(let se=0;se<M/2;se+=3){const le=V[se],me=V[se+1],Ee=V[se+2];H.emplaceBack(le,me),H.emplaceBack(me,Ee),H.emplaceBack(Ee,le)}const K=y.bindVertexArrayOES.current,ee=new Hr;return ee.buf=new Bl(y,H),ee.lastUsedFrameIdx=i,this._storage.set(l.id,ee),y.bindVertexArrayOES.set(K),ee.buf}update(i){for(const[l,y]of this._storage)i-y.lastUsedFrameIdx>30&&(y.buf.destroy(),this._storage.delete(l))}destroy(){for(const[i,l]of this._storage)l.buf.destroy(),this._storage.delete(i)}}class Ma{constructor(i){this.occluderSize=30,this.depthOffset=-1e-4,i.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),i.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const La=t.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Ha{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Ia{constructor(i,l){this.revealStart=11,this.revealRange=2,i.registerParameter(this,[...l,"Reveal"],"revealStart",{min:0,max:17,step:.05}),i.registerParameter(this,[...l,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const Pa=t.da([{type:"Float32",name:"a_pos_2f",components:2}]);class Wr{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(i,l){const y=i.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const A=new t.dr,V=new t.aU;A.emplaceBack(-1,-1),A.emplaceBack(1,-1),A.emplaceBack(1,1),A.emplaceBack(-1,1),V.emplaceBack(0,1,2),V.emplaceBack(0,2,3),this.vignetteVx=i.context.createVertexBuffer(A,Pa.members),this.vignetteIdx=i.context.createIndexBuffer(V)}const w=t.b7.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){i.uploadCommonUniforms(i.context,y);const A={u_vignetteShape:(M={vignetteShape:[l.start,l.range,Math.pow(10,l.fadePower)],vignetteColor:[l.color.r,l.color.g,l.color.b,l.color.a*l.strength]}).vignetteShape,u_vignetteColor:M.vignetteColor};y.draw(i,i.context.gl.TRIANGLES,Zi.disabled,lr.disabled,Tr.alphaBlended,or.disabled,A,"vignette",this.vignetteVx,this.vignetteIdx,w,{})}var M}}class ro{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(i,l){const y=i.getFreeCameraOptions().position,w=y.toAltitude(),M=y.toLngLat(),A=t.ai(M.lng),V=t.ai(M.lat),H=i.pixelsPerMeter/l,K=A*t.ds,ee=t.ds*Math.log(Math.tan(Math.PI/4+V/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const se=-this._offsetYPrev+ee,le=-this._elevationPrev+w;this._accumulatedOffsetX+=(-this._offsetXPrev+K)*H,this._accumulatedOffsetY+=se*H,this._accumulatedElevation+=le*H,this._offsetXPrev=K,this._offsetYPrev=ee,this._elevationPrev=w}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Is(_,i){return[-(_[0]-Math.floor(_[0]/i)*i),-(_[1]-Math.floor(_[1]/i)*i),-(_[2]-Math.floor(_[2]/i)*i)]}function gs(_){const i=t.di(1323123451230),l=[];for(let y=0;y<_;++y){const w=2*i()-1,M=2*i()-1,A=2*i()-1;l.push(t.ab.vec3.fromValues(w,M,A))}return l}function Za(_,i,l,y,w){const M=t.aw((w-l)/(y-l),0,1);return(1-M)*_+M*i}class tc{constructor(i){this._movement=new ro,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Wr,this._ppmScaleFactor=i}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(i,l){const y=i.transform;this._movement.update(y,this._ppmScaleFactor);const w=y.starsProjMatrix,M=t.ab.quat.identity([]);t.ab.quat.rotateX(M,M,t.ai(90)-y._pitch),t.ab.quat.rotateZ(M,M,-y.angle);const A=t.ab.mat4.fromQuat(new Float32Array(16),M),V=t.ab.mat4.fromValues(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),H=t.ab.mat4.transpose([],V),K=t.ab.mat4.multiply([],H,A),ee=Date.now()/1e3;return this._accumulatedTimeFromStart+=(ee-this._prevTime)*l,this._prevTime=ee,{projectionMatrix:w,modelviewMatrix:K}}}class nc extends tc{constructor(i){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Ia(i.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(i){const l=i.context;if(!this.particlesVx){const y=gs(this.particlesCount),w=new t.dt,M=new t.aU;let A=0;const V=t.di(1323123451230);for(let H=0;H<y.length;++H){const K=y[H],ee=[2*V()-1,V(),V(),V()];w.emplaceBack(K[0],K[1],K[2],-1,-1,...ee),w.emplaceBack(K[0],K[1],K[2],1,-1,...ee),w.emplaceBack(K[0],K[1],K[2],1,1,...ee),w.emplaceBack(K[0],K[1],K[2],-1,1,...ee),M.emplaceBack(A+0,A+1,A+2),M.emplaceBack(A+0,A+2,A+3),A+=4}this.particlesVx=l.createVertexBuffer(w,La.members),this.particlesIdx=l.createIndexBuffer(M)}}draw(i){if(!this._params.overrideStyleParameters&&!i.style.rain)return;const l=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},y=i.transform.zoom;if(l.revealStart>y)return;const w=Za(0,1,l.revealStart,l.revealStart+l.revealRange,y);if(!this.particlesVx||!this.particlesIdx)return;const M=structuredClone(this._params);let A=[-M.direction.x,M.direction.y,-100];t.ab.vec3.normalize(A,A);const V=structuredClone(this._vignetteParams);V.strength*=w,M.overrideStyleParameters||(M.intensity=i.style.rain.state.density,M.timeFactor=i.style.rain.state.intensity,M.color=structuredClone(i.style.rain.state.color),A=structuredClone(i.style.rain.state.direction),M.screenThinning.intensity=i.style.rain.state.centerThinning,M.dropletSizeX=i.style.rain.state.dropletSize[0],M.dropletSizeYScale=i.style.rain.state.dropletSize[1]/i.style.rain.state.dropletSize[0],M.distortionStrength=100*i.style.rain.state.distortionStrength,V.strength=1,V.color=structuredClone(i.style.rain.state.vignetteColor));const H=this.updateOnRender(i,M.timeFactor),K=i.context,ee=K.gl,se=i.transform;this.screenTexture&&this.screenTexture.size[0]===i.width&&this.screenTexture.size[1]===i.height||(this.screenTexture=new t.T(K,{width:i.width,height:i.height,data:null},ee.RGBA8)),M.distortionStrength>0&&(K.activeTexture.set(ee.TEXTURE0),this.screenTexture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE),ee.copyTexSubImage2D(ee.TEXTURE_2D,0,0,0,0,0,i.width,i.height));const le=i.getOrCreateProgram("rainParticle");i.uploadCommonUniforms(K,le),K.activeTexture.set(ee.TEXTURE0),this.screenTexture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE);const me=[M.color.r,M.color.g,M.color.b,M.color.a],Ee=(Se,ke)=>{const De=Is(this._movement.getPosition(),Se),Xe=M.dropletSizeX,ut=M.dropletSizeX*M.dropletSizeYScale,st=i.width/2,wt=i.height/2,gt=Za(0,M.screenThinning.start,0,1,M.screenThinning.intensity),vt=Za(.001,M.screenThinning.range,0,1,M.screenThinning.intensity),_t=Za(0,M.screenThinning.particleOffset,0,1,M.screenThinning.intensity),Mt=(Ft={modelview:H.modelviewMatrix,projection:H.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:De,velocityConeAperture:M.velocityConeAperture,velocity:M.velocity,boxSize:Se,rainDropletSize:[Xe,ut],distortionStrength:M.distortionStrength,rainDirection:A,color:me,screenSize:[se.width,se.height],thinningCenterPos:[st,wt],thinningShape:[gt,vt,Math.pow(10,M.screenThinning.fadePower)],thinningAffectedRatio:M.screenThinning.affectedRatio,thinningParticleOffset:_t,shapeDirectionalPower:M.shapeDirPower,shapeNormalPower:M.shapeNormalPower,mode:ke?0:1},{u_modelview:Float32Array.from(Ft.modelview),u_projection:Float32Array.from(Ft.projection),u_time:Ft.time,u_cam_pos:Ft.camPos,u_texScreen:0,u_velocityConeAperture:Ft.velocityConeAperture,u_velocity:Ft.velocity,u_boxSize:Ft.boxSize,u_rainDropletSize:Ft.rainDropletSize,u_distortionStrength:Ft.distortionStrength,u_rainDirection:Ft.rainDirection,u_color:Ft.color,u_screenSize:Ft.screenSize,u_thinningCenterPos:Ft.thinningCenterPos,u_thinningShape:Ft.thinningShape,u_thinningAffectedRatio:Ft.thinningAffectedRatio,u_thinningParticleOffset:Ft.thinningParticleOffset,u_shapeDirectionalPower:Ft.shapeDirectionalPower,u_shapeNormalPower:Ft.shapeNormalPower,u_mode:Ft.mode});var Ft;const cn=Math.round(w*M.intensity*this.particlesCount),en=t.b7.simpleSegment(0,0,4*cn,2*cn);le.draw(i,ee.TRIANGLES,Zi.disabled,lr.disabled,Tr.alphaBlended,or.disabled,Mt,"rain_particles",this.particlesVx,this.particlesIdx,en,{})};M.distortionStrength>0&&Ee(M.boxSize,!0),Ee(M.boxSize,!1),this._vignette.draw(i,V)}}const il=t.da([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class rl extends tc{constructor(i){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Ia(i.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(i){const l=i.context;if(!this.particlesVx){const y=gs(this.particlesCount),w=new t.du,M=new t.aU;let A=0;const V=t.di(1323123451230);for(let H=0;H<y.length;++H){const K=y[H],ee=V(),se=V(),le=V(),me=[H/y.length,ee,se,le],Ee=[V(),V()];w.emplaceBack(K[0],K[1],K[2],-1,-1,...me,...Ee),w.emplaceBack(K[0],K[1],K[2],1,-1,...me,...Ee),w.emplaceBack(K[0],K[1],K[2],1,1,...me,...Ee),w.emplaceBack(K[0],K[1],K[2],-1,1,...me,...Ee),M.emplaceBack(A+0,A+1,A+2),M.emplaceBack(A+0,A+2,A+3),A+=4}this.particlesVx=l.createVertexBuffer(w,il.members),this.particlesIdx=l.createIndexBuffer(M)}}draw(i){if(!this._params.overrideStyleParameters&&!i.style.snow)return;const l=structuredClone(this._params);let y=[-l.direction.x,l.direction.y,-100];t.ab.vec3.normalize(y,y);const w=structuredClone(this._vignetteParams),M=l.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},A=i.transform.zoom;if(M.revealStart>A)return;const V=Za(0,1,M.revealStart,M.revealStart+M.revealRange,A);w.strength*=V,l.overrideStyleParameters||(l.intensity=i.style.snow.state.density,l.timeFactor=i.style.snow.state.intensity,l.color=structuredClone(i.style.snow.state.color),y=structuredClone(i.style.snow.state.direction),l.screenThinning.intensity=i.style.snow.state.centerThinning,l.billboardSize=2.79*i.style.snow.state.flakeSize,w.strength=1,w.color=structuredClone(i.style.snow.state.vignetteColor));const H=this.updateOnRender(i,l.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const K=i.context,ee=K.gl,se=i.transform,le=i.getOrCreateProgram("snowParticle");i.uploadCommonUniforms(K,le),((me,Ee,Se)=>{const ke=Is(this._movement.getPosition(),me),De=se.width/2,Xe=se.height/2,ut=Za(0,Se.screenThinning.start,0,1,Se.screenThinning.intensity),st=Za(.001,Se.screenThinning.range,0,1,Se.screenThinning.intensity),wt=Za(0,Se.screenThinning.particleOffset,0,1,Se.screenThinning.intensity),gt=(vt={modelview:H.modelviewMatrix,projection:H.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:ke,velocityConeAperture:Se.velocityConeAperture,velocity:Se.velocity,horizontalOscillationRadius:Se.horizontalOscillationRadius,horizontalOscillationRate:Se.horizontalOscillationRate,boxSize:me,billboardSize:1*Se.billboardSize,simpleShapeParameters:[Se.shapeFadeStart,Se.shapeFadePower],screenSize:[se.width,se.height],thinningCenterPos:[De,Xe],thinningShape:[ut,st,Math.pow(10,Se.screenThinning.fadePower)],thinningAffectedRatio:Se.screenThinning.affectedRatio,thinningParticleOffset:wt,color:[Se.color.r,Se.color.g,Se.color.b,Se.color.a],direction:y},{u_modelview:Float32Array.from(vt.modelview),u_projection:Float32Array.from(vt.projection),u_time:vt.time,u_cam_pos:vt.camPos,u_velocityConeAperture:vt.velocityConeAperture,u_velocity:vt.velocity,u_horizontalOscillationRadius:vt.horizontalOscillationRadius,u_horizontalOscillationRate:vt.horizontalOscillationRate,u_boxSize:vt.boxSize,u_billboardSize:vt.billboardSize,u_simpleShapeParameters:vt.simpleShapeParameters,u_screenSize:vt.screenSize,u_thinningCenterPos:vt.thinningCenterPos,u_thinningShape:vt.thinningShape,u_thinningAffectedRatio:vt.thinningAffectedRatio,u_thinningParticleOffset:vt.thinningParticleOffset,u_particleColor:vt.color,u_direction:vt.direction});var vt;const _t=Math.round(V*Se.intensity*this.particlesCount),Mt=t.b7.simpleSegment(0,0,4*_t,2*_t);this.particlesVx&&this.particlesIdx&&le.draw(i,ee.TRIANGLES,Zi.disabled,lr.disabled,Tr.alphaBlended,or.disabled,gt,"snow_particles",this.particlesVx,this.particlesIdx,Mt,{})})(l.boxSize,0,l),this._vignette.draw(i,w)}}const xu={symbol:function(_,i,l,y,w){if(_.renderPass!=="translucent")return;const M=lr.disabled,A=_.colorModeForRenderPass(),V=l.layout.get("text-variable-anchor"),H=l.layout.get("text-size-scale-range"),K=t.aw(_.scaleFactor,H[0],H[1]);V&&function(le,me,Ee,Se,ke,De,Xe,ut){const st=me.transform,wt=ke==="map",gt=De==="map";for(const vt of le){const _t=Se.getTile(vt),Mt=_t.getBucket(Ee);if(!Mt||!Mt.text||!Mt.text.segments.get().length)continue;const Ft=t.bp(Mt.textSizeData,st.zoom,ut),cn=ju(vt,Mt.getProjection(),st),en=st.calculatePixelsToTileUnitsMatrix(_t),zt=io(cn,_t.tileID.canonical,gt,wt,st,Mt.getProjection(),en),Ht=Mt.hasIconTextFit()&&Mt.hasIconData();if(Ft){const En=Math.pow(2,st.zoom-_t.tileID.overscaledZ);Go(Mt,wt,gt,Xe,t.cX,st,zt,vt,En,Ft,Ht)}}}(y,_,l,i,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),w,K);const ee=l.paint.get("icon-opacity").constantOr(1)!==0,se=l.paint.get("text-opacity").constantOr(1)!==0;l.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(ee||se)?ba(_,i,l,y,M,A):(ee&&ba(_,i,l,y,M,A,{onlyIcons:!0}),se&&ba(_,i,l,y,M,A,{onlyText:!0})),i.map.showCollisionBoxes&&(Ra(_,i,l,y,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),Ra(_,i,l,y,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(_,i,l,y){if(_.renderPass!=="translucent")return;const w=l.paint.get("circle-opacity"),M=l.paint.get("circle-stroke-width"),A=l.paint.get("circle-stroke-opacity"),V=l.layout.get("circle-sort-key").constantOr(1)!==void 0,H=l.paint.get("circle-emissive-strength");if(w.constantOr(1)===0&&(M.constantOr(1)===0||A.constantOr(1)===0))return;const K=_.context,ee=K.gl,se=_.transform,le=_.depthModeForSublayer(0,Zi.ReadOnly),me=lr.disabled,Ee=_.colorModeForDrapableLayerRenderPass(H),Se=se.projection.name==="globe",ke=[t.at(se.center.lng),t.aA(se.center.lat)],De=[];for(let ut=0;ut<y.length;ut++){const st=y[ut],wt=i.getTile(st),gt=wt.getBucket(l);if(!gt||gt.projection.name!==se.projection.name)continue;const vt=gt.programConfigurations.get(l.id),_t=t.cY(l),Mt=_.isTileAffectedByFog(st);Se&&_t.push("PROJECTION_GLOBE_VIEW"),_t.push("DEPTH_D24"),_.terrain&&se.depthOcclusionForSymbolsAndCircles&&_t.push("DEPTH_OCCLUSION");const Ft=_.getOrCreateProgram("circle",{config:vt,defines:_t,overrideFog:Mt}),cn=gt.layoutVertexBuffer,en=gt.globeExtVertexBuffer,zt=gt.indexBuffer,Ht=se.projection.createInversionMatrix(se,st.canonical),En={programConfiguration:vt,program:Ft,layoutVertexBuffer:cn,globeExtVertexBuffer:en,indexBuffer:zt,uniformValues:t.cZ(_,st,wt,Ht,ke,l),tile:wt};if(V){const Vn=gt.segments.get();for(const ti of Vn)De.push({segments:new t.b7([ti]),sortKey:ti.sortKey,state:En})}else De.push({segments:gt.segments,sortKey:0,state:En})}V&&De.sort((ut,st)=>ut.sortKey-st.sortKey);const Xe={useDepthForOcclusion:se.depthOcclusionForSymbolsAndCircles};for(const ut of De){const{programConfiguration:st,program:wt,layoutVertexBuffer:gt,globeExtVertexBuffer:vt,indexBuffer:_t,uniformValues:Mt,tile:Ft}=ut.state,cn=ut.segments;_.terrain&&_.terrain.setupElevationDraw(Ft,wt,Xe),_.uploadCommonUniforms(K,wt,Ft.tileID.toUnwrapped()),wt.draw(_,ee.TRIANGLES,le,me,Ee,or.disabled,Mt,l.id,gt,_t,cn,l.paint,se.zoom,st,[vt])}},heatmap:function(_,i,l,y){if(l.paint.get("heatmap-opacity")!==0)if(_.renderPass==="offscreen"){const w=_.context,M=w.gl,A=lr.disabled,V=new Tr([M.ONE,M.ONE,M.ONE,M.ONE],t.aj.transparent,[!0,!0,!0,!0]);(function(me,Ee,Se,ke){const De=me.gl,Xe=Ee.width*ke,ut=Ee.height*ke;me.activeTexture.set(De.TEXTURE1),me.viewport.set([0,0,Xe,ut]);let st=Se.heatmapFbo;if(!st||st&&(st.width!==Xe||st.height!==ut)){st&&st.destroy();const wt=De.createTexture();De.bindTexture(De.TEXTURE_2D,wt),De.texParameteri(De.TEXTURE_2D,De.TEXTURE_WRAP_S,De.CLAMP_TO_EDGE),De.texParameteri(De.TEXTURE_2D,De.TEXTURE_WRAP_T,De.CLAMP_TO_EDGE),De.texParameteri(De.TEXTURE_2D,De.TEXTURE_MIN_FILTER,De.LINEAR),De.texParameteri(De.TEXTURE_2D,De.TEXTURE_MAG_FILTER,De.LINEAR),st=Se.heatmapFbo=me.createFramebuffer(Xe,ut,!0,null),function(gt,vt,_t,Mt,Ft,cn){const en=gt.gl;en.texImage2D(en.TEXTURE_2D,0,gt.extRenderToTextureHalfFloat?en.RGBA16F:en.RGBA,Ft,cn,0,en.RGBA,gt.extRenderToTextureHalfFloat?en.HALF_FLOAT:en.UNSIGNED_BYTE,null),Mt.colorAttachment.set(_t)}(me,0,wt,st,Xe,ut)}else De.bindTexture(De.TEXTURE_2D,st.colorAttachment.get()),me.bindFramebuffer.set(st.framebuffer)})(w,_,l,_.transform.projection.name==="globe"?.5:.25),w.clear({color:t.aj.transparent});const H=_.transform,K=H.projection.name==="globe",ee=K?["PROJECTION_GLOBE_VIEW"]:[],se=K?or.frontCCW:or.disabled,le=[t.at(H.center.lng),t.aA(H.center.lat)];for(let me=0;me<y.length;me++){const Ee=y[me];if(i.hasRenderableParent(Ee))continue;const Se=i.getTile(Ee),ke=Se.getBucket(l);if(!ke||ke.projection.name!==H.projection.name)continue;const De=_.isTileAffectedByFog(Ee),Xe=ke.programConfigurations.get(l.id),ut=_.getOrCreateProgram("heatmap",{config:Xe,defines:ee,overrideFog:De}),{zoom:st}=_.transform;_.terrain&&_.terrain.setupElevationDraw(Se,ut),_.uploadCommonUniforms(w,ut,Ee.toUnwrapped());const wt=H.projection.createInversionMatrix(H,Ee.canonical);ut.draw(_,M.TRIANGLES,Zi.disabled,A,V,se,Rh(_,Ee,Se,wt,le,st,l.paint.get("heatmap-intensity")),l.id,ke.layoutVertexBuffer,ke.indexBuffer,ke.segments,l.paint,_.transform.zoom,Xe,K?[ke.globeExtVertexBuffer]:null)}w.viewport.set([0,0,_.width,_.height])}else _.renderPass==="translucent"&&(_.context.setColorMode(_.colorModeForRenderPass()),function(w,M){const A=w.context,V=A.gl,H=M.heatmapFbo;if(!H)return;A.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_2D,H.colorAttachment.get()),A.activeTexture.set(V.TEXTURE1);let K=M.colorRampTexture;K||(K=M.colorRampTexture=new t.T(A,M.colorRamp,V.RGBA8)),K.bind(V.LINEAR,V.CLAMP_TO_EDGE),w.getOrCreateProgram("heatmapTexture").draw(w,V.TRIANGLES,Zi.disabled,lr.disabled,w.colorModeForRenderPass(),or.disabled,((ee,se,le,me)=>({u_image:0,u_color_ramp:1,u_opacity:se.paint.get("heatmap-opacity")}))(0,M),M.id,w.viewportBuffer,w.quadTriangleIndexBuffer,w.viewportSegments,M.paint,w.transform.zoom)}(_,l))},line:function(_,i,l,y){if(_.renderPass!=="translucent")return;const w=l.paint.get("line-opacity"),M=l.paint.get("line-width");if(w.constantOr(1)===0||M.constantOr(1)===0)return;const A=l.paint.get("line-emissive-strength"),V=l.paint.get("line-occlusion-opacity"),H=l.layout.get("line-elevation-reference"),K=l.layout.get("line-width-unit")==="meters",ee=H==="sea",se=_.context,le=se.gl,me=!l.isDraped();if(me&&_.transform.projection.name==="globe")return;const Ee=l.layout.get("line-cross-slope"),Se=Ee!==void 0,ke=Ee<1,De=me?new Zi(_.depthOcclusion?le.GREATER:le.LEQUAL,Zi.ReadOnly,_.depthRangeFor3D):_.depthModeForSublayer(0,Zi.ReadOnly),Xe=_.colorModeForDrapableLayerRenderPass(A),ut=_.terrain&&_.terrain.renderingToTexture,st=ut?1:t.q.devicePixelRatio,wt=l.paint.get("line-dasharray"),gt=wt.constantOr(1),vt=l.layout.get("line-cap"),_t=wt.constantOr(null),Mt=vt.constantOr(null),Ft=l.paint.get("line-pattern"),cn=Ft.constantOr(1),en=Ft.constantOr(null),zt=l.paint.get("line-opacity").constantOr(1);let Ht=!cn&&zt!==1||_.depthOcclusion&&V>0&&V<1;const En=l.paint.get("line-gradient"),Vn=cn?"linePattern":"line",ti=t.c_(l);let Qt;if(ut&&_.terrain&&_.terrain.clipOrMaskOverlapStencilType()&&(Ht=!1),V!==0&&_.depthOcclusion){const dn=l.paint._values["line-opacity"];dn&&dn.value&&dn.value.kind==="constant"?Qt=dn.value:t.w(`Occlusion opacity for layer ${l.id} is supported only when line-opacity isn't data-driven.`)}if(me&&(_.forceTerrainMode=!0),!me&&V!==0&&_.terrain&&!ut)return void t.w(`Occlusion opacity for layer ${l.id} is supported on terrain only if the layer has line-z-offset enabled.`);const An=Ht&&me?_.stencilModeFor3D():lr.disabled;me&&(ti.push("ELEVATED"),Se&&ti.push(ke?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),ee&&ti.push("ELEVATION_REFERENCE_SEA")),M.value.kind!=="constant"&&M.value.isLineProgressConstant===!1&&ti.push("VARIABLE_LINE_WIDTH");for(const dn of y){const Jn=i.getTile(dn);if(cn&&!Jn.patternsLoaded())continue;const Fn=Jn.getBucket(l);if(!Fn)continue;_.prepareDrawTile();const wn=Fn.programConfigurations.get(l.id),Mi=_.isTileAffectedByFog(dn),si=_.getOrCreateProgram(Vn,{config:wn,defines:ti,overrideFog:Mi,overrideRtt:!me&&void 0});if(en&&Jn.imageAtlas){const Mr=t.A.from(en),Ea=Jn.imageAtlas.patternPositions[Mr.getSerializedPrimary()];Ea&&wn.setConstantPatternPositions(Ea)}if(!cn&&_t&&Mt&&Jn.lineAtlas){const Mr=Jn.lineAtlas.getDash(_t,Mt);Mr&&wn.setConstantPatternPositions(Mr)}let[Ii,Ai]=l.paint.get("line-trim-offset");(Mt==="round"||Mt==="square")&&Ii!==Ai&&(Ii===0&&(Ii-=1),Ai===1&&(Ai+=1));const ur=ut?dn.projMatrix:null,Xi=K?1/Fn.tileToMeter/t.ar(Jn,1,_.transform.zoom):1,er=K?1/Fn.tileToMeter/t.ar(Jn,1,Math.floor(_.transform.zoom)):1,dr=cn?t.c$(_,Jn,l,ur,st,Xi,er,[Ii,Ai]):t.d0(_,Jn,l,ur,Fn.lineClipsArray.length,st,Xi,er,[Ii,Ai]);if(En){const Mr=Fn.gradients[l.id];let Ea=Mr.texture;if(l.gradientVersion!==Mr.version){let za=256;if(l.stepInterpolant){const ra=i.getSource().maxzoom,ha=dn.canonical.z===ra?Math.ceil(1<<_.transform.maxZoom-dn.canonical.z):1;za=t.aw(t.d1(Fn.maxLineLength/t.ag*1024*ha),256,se.maxTextureSize)}Mr.gradient=t.d2({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:za,image:Mr.gradient||void 0,clips:Fn.lineClipsArray}),Mr.texture?Mr.texture.update(Mr.gradient):Mr.texture=new t.T(se,Mr.gradient,le.RGBA8),Mr.version=l.gradientVersion,Ea=Mr.texture}se.activeTexture.set(le.TEXTURE1),Ea.bind(l.stepInterpolant?le.NEAREST:le.LINEAR,le.CLAMP_TO_EDGE)}gt&&(se.activeTexture.set(le.TEXTURE0),Jn.lineAtlasTexture&&Jn.lineAtlasTexture.bind(le.LINEAR,le.REPEAT),wn.updatePaintBuffers()),cn&&(se.activeTexture.set(le.TEXTURE0),Jn.imageAtlasTexture&&Jn.imageAtlasTexture.bind(le.LINEAR,le.CLAMP_TO_EDGE),wn.updatePaintBuffers()),me&&!ee&&_.terrain.setupElevationDraw(Jn,si),_.uploadCommonUniforms(se,si,dn.toUnwrapped());const Ur=Mr=>{Qt!=null&&(Qt.value=zt*V),si.draw(_,le.TRIANGLES,De,Mr,Xe,or.disabled,dr,l.id,Fn.layoutVertexBuffer,Fn.indexBuffer,Fn.segments,l.paint,_.transform.zoom,wn,[Fn.layoutVertexBuffer2,Fn.patternVertexBuffer,Fn.zOffsetVertexBuffer]),Qt!=null&&(Qt.value=zt)};if(Ht&&!me){const Mr=_.stencilModeForClipping(dn).ref;Mr===0&&ut&&se.clear({stencil:0});const Ea={func:le.EQUAL,mask:255};dr.u_alpha_discard_threshold=.8,Ur(new lr(Ea,Mr,255,le.KEEP,le.KEEP,le.INVERT)),dr.u_alpha_discard_threshold=0,Ur(new lr(Ea,Mr,255,le.KEEP,le.KEEP,le.KEEP))}else Ht&&me&&(dr.u_alpha_discard_threshold=.001),Ur(me?An:_.stencilModeForClipping(dn))}me&&(_.forceTerrainMode=!1),Ht&&(_.resetStencilClippingMasks(),ut&&se.clear({stencil:0})),V===0||_.depthOcclusion||ut||_.layersWithOcclusionOpacity.push(_.currentLayer)},fill:function(_,i,l,y){const w=l.paint.get("fill-color"),M=l.paint.get("fill-opacity"),A=l.is3D(),V=new Zi(_.context.gl.LEQUAL,Zi.ReadWrite,_.depthRangeFor3D);if(M.constantOr(1)===0)return;const H=l.paint.get("fill-emissive-strength"),K=_.colorModeForDrapableLayerRenderPass(H),ee=l.paint.get("fill-pattern"),se=_.opaquePassEnabledForLayer()&&!ee.constantOr(1)&&w.constantOr(t.aj.transparent).a===1&&M.constantOr(0)===1?"opaque":"translucent";if(_.renderPass===se){const le=A?V:_.depthModeForSublayer(1,_.renderPass==="opaque"?Zi.ReadWrite:Zi.ReadOnly);ec(_,i,l,y,le,K,!1)}if(!A&&_.renderPass==="translucent"&&l.paint.get("fill-antialias")){const le=A?V:_.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,Zi.ReadOnly);ec(_,i,l,y,le,K,!0)}},"fill-extrusion":function(_,i,l,y){const w=l.paint.get("fill-extrusion-opacity"),M=_.context,A=M.gl,V=_.terrain,H=V&&V.renderingToTexture;if(w===0)return;const K=_.conflationActive&&_.style.isLayerClipped(l,i.getSource()),ee=_.style.order.indexOf(l.fqid);if(K&&function(se,le,me,Ee,Se){for(const ke of Ee){const De=le.getTile(ke).getBucket(me);De&&(De.updateReplacement(ke,se.replacementSource,Se),De.uploadCentroid(se.context))}}(_,i,l,y,ee),V||K)for(const se of y){const le=i.getTile(se).getBucket(l);le&&gf(_.context,i,se,le,l,V,K)}if(_.renderPass==="shadow"&&_.shadowRenderer){const se=_.shadowRenderer;if(V&&w<.65&&l._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof t.a9)return;const le=se.getShadowPassDepthMode(),me=se.getShadowPassColorMode();Gc(_,i,l,y,le,lr.disabled,me,K)}else if(_.renderPass==="translucent"){const se=!l.paint.get("fill-extrusion-pattern").constantOr(1),le=l.paint.get("fill-extrusion-color").constantOr(t.aj.white);if(!H&&le.a!==0){const me=new Zi(_.context.gl.LEQUAL,Zi.ReadWrite,_.depthRangeFor3D);w===1&&se?Gc(_,i,l,y,me,lr.disabled,Tr.unblended,K):(Gc(_,i,l,y,me,lr.disabled,Tr.disabled,K),Gc(_,i,l,y,me,_.stencilModeFor3D(),_.colorModeForRenderPass(),K),_.resetStencilClippingMasks())}if(_.style.enable3dLights()&&se&&(!V&&_.transform.projection.name!=="globe"||H)){const me=l.paint.get("fill-extrusion-opacity"),Ee=l.paint.get("fill-extrusion-ambient-occlusion-intensity"),Se=l.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),ke=l.paint.get("fill-extrusion-flood-light-intensity"),De=l.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Xe=l.paint.get("fill-extrusion-flood-light-color").toRenderColor(De?null:l.lut).toArray01().slice(0,3),ut=Ee>0&&Se>0,st=ke>0,wt=(vt,_t,Mt)=>(1-Mt)*vt+Mt*_t,gt=vt=>{const _t=_.depthModeForSublayer(1,Zi.ReadOnly,A.LEQUAL,!0),Mt=l.paint.get(vt?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ft=wt(.1,3,Mt),cn=_._showOverdrawInspector;if(!cn){const en=new lr({func:A.ALWAYS,mask:255},255,255,A.KEEP,A.KEEP,A.REPLACE),zt=new Tr([A.ONE,A.ONE,A.ONE,A.ONE],t.aj.transparent,[!1,!1,!1,!0],A.MIN);vc(_,i,l,y,_t,en,zt,or.disabled,vt,"sdf",me,Ee,Se,ke,Xe,Ft,K,!1)}{const en=cn?lr.disabled:new lr({func:A.EQUAL,mask:255},255,255,A.KEEP,A.DECR,A.DECR),zt=cn?_.colorModeForRenderPass():new Tr([A.ONE_MINUS_DST_ALPHA,A.DST_ALPHA,A.ONE,A.ONE],t.aj.transparent,[!0,!0,!0,!0]);vc(_,i,l,y,_t,en,zt,or.disabled,vt,"color",me,Ee,Se,ke,Xe,Ft,K,!1)}};if(H){const vt=(_t,Mt,Ft)=>{const cn=_.depthModeForSublayer(1,Zi.ReadOnly,A.LEQUAL,!1),en=l.paint.get(_t?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),zt=wt(.1,3,en);{const Ht=new Tr([A.ONE,A.ONE,A.ONE,A.ONE],t.aj.transparent,[!1,!1,!1,!0]);vc(_,i,l,y,cn,lr.disabled,Ht,or.disabled,_t,"clear",me,Ee,Se,ke,Xe,zt,K,Mt)}{const Ht=new lr({func:A.ALWAYS,mask:255},255,255,A.KEEP,A.KEEP,A.REPLACE),En=new Tr([A.ONE,A.ONE,A.ONE,A.ONE],t.aj.transparent,[!1,!1,!1,!0],A.MIN);vc(_,i,l,y,cn,Ht,En,or.disabled,_t,"sdf",me,Ee,Se,ke,Xe,zt,K,Mt)}{const Ht=_t?A.ZERO:A.ONE_MINUS_DST_ALPHA,En=new lr({func:A.EQUAL,mask:255},255,255,A.KEEP,A.DECR,A.DECR),Vn=new Tr([Ht,A.DST_ALPHA,A.ONE_MINUS_DST_ALPHA,A.ZERO],t.aj.transparent,[!0,!0,!0,!0]);vc(_,i,l,y,cn,En,Vn,or.disabled,_t,"color",me,Ee,Se,ke,Xe,zt,K,Mt)}{const Ht=new Tr([A.ONE,A.ONE,A.ONE,_t?A.ZERO:A.ONE],t.aj.transparent,[!1,!1,!1,!0],_t?A.FUNC_ADD:A.MAX);vc(_,i,l,y,cn,lr.disabled,Ht,or.disabled,_t,"clear",me,Ee,Se,ke,Xe,zt,K,Mt,Ft)}};if(ut||st){let _t;if(_.prepareDrawTile(),V){const Mt=V.drapeBufferSize[0],Ft=V.drapeBufferSize[1];_t=V.framebufferCopyTexture,_t&&(!_t||_t.size[0]===Mt&&_t.size[1]===Ft)||(_t&&_t.destroy(),_t=V.framebufferCopyTexture=new t.T(M,new t.r({width:Mt,height:Ft}),A.RGBA8)),_t.bind(A.LINEAR,A.CLAMP_TO_EDGE),A.copyTexSubImage2D(A.TEXTURE_2D,0,0,0,0,0,Mt,Ft)}ut&&vt(!0,!1,_t),st&&vt(!1,!0,_t)}}else ut&&gt(!0),st&&gt(!1),(ut||st)&&_.resetStencilClippingMasks()}}},hillshade:function(_,i,l,y){if(_.renderPass!=="offscreen"&&_.renderPass!=="translucent"||_.style.disableElevatedTerrain)return;const w=_.context,M=_.terrain&&_.terrain.renderingToTexture,[A,V]=_.renderPass!=="translucent"||M?[{},y]:_.stencilConfigForOverlap(y);for(const H of V){const K=i.getTile(H);if(K.needsHillshadePrepare&&_.renderPass==="offscreen")sf(_,K,l);else if(_.renderPass==="translucent"){const ee=_.depthModeForSublayer(0,Zi.ReadOnly),se=l.paint.get("hillshade-emissive-strength"),le=_.colorModeForDrapableLayerRenderPass(se),me=M&&_.terrain?_.terrain.stencilModeForRTTOverlap(H):A[H.overscaledZ];af(_,H,K,l,ee,me,le)}}w.viewport.set([0,0,_.width,_.height]),_.resetStencilClippingMasks()},raster:function(_,i,l,y,w,M){if(_.renderPass!=="translucent"||l.paint.get("raster-opacity")===0)return;const A=_.transform.projection.name==="globe",V=l.paint.get("raster-elevation")!==0,H=V&&A;if(_.renderElevatedRasterBackface&&!H)return;const K=_.context,ee=K.gl,se=i.getSource(),le=function(gt,vt,_t,Mt){const Ft=vt.paint.get("raster-color"),cn=gt.type==="raster-array",en=[],zt=vt.paint.get("raster-resampling"),Ht=vt.paint.get("raster-color-mix");let En=vt.paint.get("raster-color-range");const Vn=[Ht[0],Ht[1],Ht[2],0],ti=Ht[3];let Qt=zt==="nearest"?Mt.NEAREST:Mt.LINEAR;if(cn&&(en.push("RASTER_ARRAY"),Ft||en.push("RASTER_COLOR"),zt==="linear"&&en.push("RASTER_ARRAY_LINEAR"),Qt=Mt.NEAREST,!En&&gt.rasterLayers)){const An=gt.rasterLayers.find(({id:dn})=>dn===vt.sourceLayer);An&&An.fields&&An.fields.range&&(En=An.fields.range)}if(En=En||[0,1],Ft){en.push("RASTER_COLOR"),_t.activeTexture.set(Mt.TEXTURE2),vt.updateColorRamp(En);let An=vt.colorRampTexture;An||(An=vt.colorRampTexture=new t.T(_t,vt.colorRamp,Mt.RGBA8)),An.bind(Mt.LINEAR,Mt.CLAMP_TO_EDGE)}return{mix:Vn,range:En,offset:ti,defines:en,resampling:Qt}}(se,l,K,ee);if(se instanceof t.aJ&&!y.length&&!A)return;const me=l.paint.get("raster-emissive-strength"),Ee=_.colorModeForDrapableLayerRenderPass(me),Se=_.terrain&&_.terrain.renderingToTexture,ke=!_.options.moving,De=l.paint.get("raster-resampling")==="nearest"?ee.NEAREST:ee.LINEAR;if(se instanceof t.aJ&&!y.length&&(se.onNorthPole||se.onSouthPole)){const gt=V?_.stencilModeFor3D():lr.disabled;return void bc(!!se.onNorthPole,null,_,i,l,me,le,or.disabled,gt)}if(!y.length)return;const[Xe,ut]=se instanceof t.aJ||Se?[{},y]:_.stencilConfigForOverlap(y),st=ut[ut.length-1].overscaledZ;H&&le.defines.push("PROJECTION_GLOBE_VIEW"),V&&le.defines.push("RENDER_CUTOFF");const wt=(gt,vt,_t)=>{for(const Mt of gt){const Ft=Mt.toUnwrapped(),cn=i.getTile(Mt);if(Se&&(!cn||!cn.hasData()))continue;K.activeTexture.set(ee.TEXTURE0);const en=tn(cn,se,l,le);if(!en||!en.texture)continue;const{texture:zt,mix:Ht,offset:En,tileSize:Vn,buffer:ti}=en;let Qt,An;Se?(Qt=Zi.disabled,An=Mt.projMatrix):V?(Qt=new Zi(ee.LEQUAL,Zi.ReadWrite,_.depthRangeFor3D),An=A?Float32Array.from(_.transform.expandedFarZProjMatrix):_.transform.calculateProjMatrix(Ft,ke)):(Qt=_.depthModeForSublayer(Mt.overscaledZ-st,l.paint.get("raster-opacity")===1?Zi.ReadWrite:Zi.ReadOnly,ee.LESS),An=_.transform.calculateProjMatrix(Ft,ke));const dn=_.terrain&&Se?_.terrain.stencilModeForRTTOverlap(Mt):Xe[Mt.overscaledZ],Jn=M?0:l.paint.get("raster-fade-duration");cn.registerFadeDuration(Jn);const Fn=i.findLoadedParent(Mt,0),wn=hf(cn,Fn,i,_.transform,Jn);let Mi,si;_.terrain&&_.terrain.prepareDrawTile(),K.activeTexture.set(ee.TEXTURE0),zt.bind(De,ee.CLAMP_TO_EDGE),K.activeTexture.set(ee.TEXTURE1),Fn?(Fn.texture&&Fn.texture.bind(De,ee.CLAMP_TO_EDGE),Mi=Math.pow(2,Fn.tileID.overscaledZ-cn.tileID.overscaledZ),si=[cn.tileID.canonical.x*Mi%1,cn.tileID.canonical.y*Mi%1]):zt.bind(De,ee.CLAMP_TO_EDGE),zt.useMipmap&&K.extTextureFilterAnisotropic&&_.transform.pitch>20&&ee.texParameterf(ee.TEXTURE_2D,K.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,K.extTextureFilterAnisotropicMax);const Ii=_.transform;let Ai;const ur=V?_a(Ii):[0,0,0,0];let Xi,er,dr,Ur,Mr,Ea=0;if(H&&se instanceof t.aJ&&se.coordinates.length>3)Xi=Float32Array.from(t.bb(t.cH(new t.bT(0,0,0)))),er=Float32Array.from(Ii.globeMatrix),dr=Float32Array.from(t.cD(Ii)),Ur=[t.at(Ii.center.lng),t.aA(Ii.center.lat)],Ai=se.elevatedGlobePerspectiveTransform,Mr=se.elevatedGlobeGridMatrix||new Float32Array(9);else if(H){const br=t.cE(Mt.canonical);Ea=t.cF(br.getCenter().lat),Xi=Float32Array.from(t.bb(t.cH(Mt.canonical))),er=Float32Array.from(Ii.globeMatrix),dr=Float32Array.from(t.cD(Ii)),Ur=[t.at(Ii.center.lng),t.aA(Ii.center.lat)],Ai=[0,0],Mr=Float32Array.from(t.cG(Mt.canonical,br,Ea,Ii.worldSize/Ii._pixelsPerMercatorPixel))}else Ai=se instanceof t.aJ?se.perspectiveTransform:[0,0],Xi=new Float32Array(16),er=new Float32Array(9),dr=new Float32Array(16),Ur=[0,0],Mr=new Float32Array(9);const za=yc(An,Xi,er,dr,Mr,si||[0,0],t.ae(_.transform.zoom),Ur,ur,Mi||1,wn,l,Ai,V?l.paint.get("raster-elevation"):0,2,Ht,En,le.range,Vn,ti,me),ra=_.isTileAffectedByFog(Mt),ha=_.getOrCreateProgram("raster",{defines:le.defines,overrideFog:ra});if(_.uploadCommonUniforms(K,ha,Ft),se instanceof t.aJ){const br=se.elevatedGlobeVertexBuffer,nr=se.elevatedGlobeIndexBuffer;if(Se||!A)se.boundsBuffer&&se.boundsSegments&&ha.draw(_,ee.TRIANGLES,Qt,lr.disabled,Ee,or.disabled,za,l.id,se.boundsBuffer,_.quadTriangleIndexBuffer,se.boundsSegments);else if(br&&nr){const ea=Ii.zoom<=t.c6?se.elevatedGlobeSegments:se.getSegmentsForLongitude(Ii.center.lng);ea&&ha.draw(_,ee.TRIANGLES,Qt,lr.disabled,Ee,vt,za,l.id,br,nr,ea)}}else if(H){Qt=new Zi(ee.LEQUAL,Zi.ReadOnly,_.depthRangeFor3D);const br=_.globeSharedBuffers;if(br){const[nr,ea,ta]=br.getGridBuffers(Ea,!1);ha.draw(_,ee.TRIANGLES,Qt,_t||dn,_.colorModeForRenderPass(),vt,za,l.id,nr,ea,ta)}}else{const{tileBoundsBuffer:br,tileBoundsIndexBuffer:nr,tileBoundsSegments:ea}=_.getTileBoundsBuffers(cn);ha.draw(_,ee.TRIANGLES,Qt,dn,Ee,or.disabled,za,l.id,br,nr,ea)}}if(!(se instanceof t.aJ)&&H)for(const Mt of gt){const Ft=Mt.canonical.y===(1<<Mt.canonical.z)-1;Mt.canonical.y===0&&bc(!0,Mt,_,i,l,me,le,vt,_t||lr.disabled),Ft&&bc(!1,Mt,_,i,l,me,le,vt===or.frontCW?or.backCW:or.frontCW,_t||lr.disabled)}};H?wt(ut,_.renderElevatedRasterBackface?or.backCW:or.frontCW,_.stencilModeFor3D()):wt(ut,or.disabled,void 0),_.resetStencilClippingMasks()},"raster-particle":function(_,i,l,y,w,M){_.renderPass==="offscreen"&&function(A,V,H,K){if(!K.length)return;const ee=A.context,se=ee.gl,le=V.getSource();if(!(le instanceof dc))return;const me=Math.ceil(Math.sqrt(H.paint.get("raster-particle-count")));let Ee=H.particlePositionRGBAImage;if(!Ee||Ee.width!==me){const ut=function(st){const wt=st*st,gt=new Uint8Array(4*wt),vt=function(Mt){return Mt|=0,Mt=Math.imul(2747636419^Mt,2654435769),Mt=Math.imul(Mt^Mt>>>16,2654435769),((Mt=Math.imul(Mt^Mt>>>16,2654435769))>>>0)/4294967296},_t=1/1.1;for(let Mt=0;Mt<wt;Mt++){const Ft=_t*(vt(2*Mt+0)+nl),cn=_t*(vt(2*Mt+1)+nl),en=255*Ft%1,zt=255*cn%1,Ht=en,En=cn-zt/255,Vn=zt;gt[4*Mt+0]=255*(Ft-en/255),gt[4*Mt+1]=255*Ht,gt[4*Mt+2]=255*En,gt[4*Mt+3]=255*Vn}return gt}(me);Ee=H.particlePositionRGBAImage=new t.r({width:me,height:me},ut)}let Se=H.particleFramebuffer;Se?Se.width!==me&&(Se.destroy(),Se=H.particleFramebuffer=ee.createFramebuffer(me,me,!0,null)):Se=H.particleFramebuffer=ee.createFramebuffer(me,me,!0,null);const ke=[];for(const ut of K){const st=V.getTile(ut);if(!(st instanceof es))continue;const wt=yf(st,le,H);if(!wt)continue;const gt=[st.tileSize,st.tileSize];let vt=H.tileFramebuffer;vt||(vt=H.tileFramebuffer=ee.createFramebuffer(gt[0],gt[1],!0,null));let _t=st.rasterParticleState;_t||(_t=st.rasterParticleState=new ih(ee,ut,gt,Ee));const Mt=_t.update(H.lastInvalidatedAt);_t.particleTextureDimension!==me&&_t.updateParticleTexture(ut,Ee);const Ft=_t.targetColorTexture;_t.targetColorTexture=_t.backgroundColorTexture,_t.backgroundColorTexture=Ft;const cn=_t.particleTexture0;_t.particleTexture0=_t.particleTexture1,_t.particleTexture1=cn,ke.push([ut,wt,_t,Mt])}if(ke.length===0)return;const De=t.q.now(),Xe=H.previousDrawTimestamp?.001*(De-H.previousDrawTimestamp):.0167;if(H.previousDrawTimestamp=De,H.hasColorMap()){ee.activeTexture.set(se.TEXTURE0+2);let ut=H.colorRampTexture;ut||(ut=H.colorRampTexture=new t.T(ee,H.colorRamp,se.RGBA8)),ut.bind(se.LINEAR,se.CLAMP_TO_EDGE)}ee.bindFramebuffer.set(H.tileFramebuffer.framebuffer),function(ut,st,wt){const gt=ut.context,vt=gt.gl,_t=st.tileFramebuffer;gt.activeTexture.set(vt.TEXTURE0);const Mt={u_texture:0,u_opacity:1.05*(cn=st.paint.get("raster-particle-fade-opacity-factor"))/(cn+.05)},Ft=ut.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var cn;for(const en of wt){const[,,zt,Ht]=en;_t.colorAttachment.set(zt.targetColorTexture.texture),gt.viewport.set([0,0,_t.width,_t.height]),gt.clear({color:t.aj.transparent}),Ht&&(zt.backgroundColorTexture.bind(vt.NEAREST,vt.CLAMP_TO_EDGE),Ft.draw(ut,vt.TRIANGLES,Zi.disabled,lr.disabled,Tr.alphaBlended,or.disabled,Mt,st.id,ut.viewportBuffer,ut.quadTriangleIndexBuffer,ut.viewportSegments))}}(A,H,ke),function(ut,st,wt,gt){const vt=ut.context,_t=vt.gl,Mt=wt.tileFramebuffer,Ft=ut.transform.projection.name==="globe",cn=wt.paint.get("raster-particle-max-speed");for(const en of gt){const[zt,Ht,En]=en;vt.activeTexture.set(_t.TEXTURE0+0),Ht.texture.bind(_t.LINEAR,_t.CLAMP_TO_EDGE),Mt.colorAttachment.set(En.targetColorTexture.texture);const Vn=ut.getOrCreateProgram("rasterParticleDraw",{defines:Ht.defines,overrideFog:!1});vt.activeTexture.set(_t.TEXTURE0+1);const ti=Ht.scalarData?[]:[0,1,2,3].map(dn=>t.d4[dn](zt));ti.push(zt);const Qt=zt.canonical.x,An=zt.canonical.y;for(const dn of ti){const Jn=st.getTile(Ft?dn.wrapped():dn);if(!Jn)continue;const Fn=Jn.rasterParticleState;if(!Fn)continue;const wn=dn.canonical.x+(1<<dn.canonical.z)*(dn.wrap-zt.wrap),Mi=dn.canonical.y;Fn.particleTexture0.bind(_t.NEAREST,_t.CLAMP_TO_EDGE);const si=$i(1,Fn.particleTexture0.size[0],[wn-Qt,Mi-An],0,Ht.texture.size,2,cn,Ht.textureOffset,Ht.scale,Ht.offset);Vn.draw(ut,_t.POINTS,Zi.disabled,lr.disabled,Tr.alphaBlended,or.disabled,si,wt.id,Fn.particleIndexBuffer,void 0,Fn.particleSegment)}}}(A,V,H,ke),ee.bindFramebuffer.set(H.particleFramebuffer.framebuffer),function(ut,st,wt,gt){const vt=ut.context,_t=vt.gl,Mt=st.paint.get("raster-particle-max-speed"),Ft=gt*st.paint.get("raster-particle-speed-factor")*.15,cn=function(zt){return Math.pow(zt,6)}(.01+1*st.paint.get("raster-particle-reset-rate-factor")),en=st.particleFramebuffer;vt.viewport.set([0,0,en.width,en.height]);for(const zt of wt){const[,Ht,En]=zt;vt.activeTexture.set(_t.TEXTURE0+0),Ht.texture.bind(_t.LINEAR,_t.CLAMP_TO_EDGE),vt.activeTexture.set(_t.TEXTURE0+1);const Vn=En.particleTexture0;Vn.bind(_t.NEAREST,_t.CLAMP_TO_EDGE);const ti=ff(1,Vn.size[0],0,Ht.texture.size,Mt,Ft,cn,Ht.textureOffset,Ht.scale,Ht.offset);en.colorAttachment.set(En.particleTexture1.texture),vt.clear({color:t.aj.transparent}),ut.getOrCreateProgram("rasterParticleUpdate",{defines:Ht.defines}).draw(ut,_t.TRIANGLES,Zi.disabled,lr.disabled,Tr.unblended,or.disabled,ti,st.id,ut.viewportBuffer,ut.quadTriangleIndexBuffer,ut.viewportSegments)}}(A,H,ke,Xe)}(_,i,l,y),_.renderPass==="translucent"&&(function(A,V,H,K,ee){const se=A.context,le=se.gl,me=V.getSource().tileSize,Ee=5*(1-t.ac(t.bY,t.bY+1,A.transform.zoom))*me+H.paint.get("raster-particle-elevation"),Se=!A.options.moving,ke=A.transform.projection.name==="globe";if(!K.length)return;const[De,Xe]=A.stencilConfigForOverlap(K),ut=[];ke&&ut.push("PROJECTION_GLOBE_VIEW");const st=A.stencilModeFor3D();for(const wt of Xe){const gt=wt.toUnwrapped(),vt=V.getTile(wt);if(!vt.rasterParticleState)continue;const _t=vt.rasterParticleState,Mt=100;vt.registerFadeDuration(Mt);const Ft=V.findLoadedParent(wt,0),cn=hf(vt,Ft,V,A.transform,Mt);let en,zt;A.terrain&&A.terrain.prepareDrawTile(),se.activeTexture.set(le.TEXTURE0),_t.targetColorTexture.bind(le.LINEAR,le.CLAMP_TO_EDGE),se.activeTexture.set(le.TEXTURE1),Ft&&Ft.rasterParticleState?(Ft.rasterParticleState.targetColorTexture.bind(le.LINEAR,le.CLAMP_TO_EDGE),en=Math.pow(2,Ft.tileID.overscaledZ-vt.tileID.overscaledZ),zt=[vt.tileID.canonical.x*en%1,vt.tileID.canonical.y*en%1]):_t.targetColorTexture.bind(le.LINEAR,le.CLAMP_TO_EDGE);const Ht=ke?Float32Array.from(A.transform.expandedFarZProjMatrix):A.transform.calculateProjMatrix(gt,Se),En=A.transform,Vn=B(En),ti=t.cE(wt.canonical),Qt=t.cF(ti.getCenter().lat);let An,dn,Jn,Fn,wn;ke?(An=Float32Array.from(t.bb(t.cH(wt.canonical))),dn=Float32Array.from(En.globeMatrix),Jn=Float32Array.from(t.cD(En)),Fn=[t.at(En.center.lng),t.aA(En.center.lat)],wn=Float32Array.from(t.cG(wt.canonical,ti,Qt,En.worldSize/En._pixelsPerMercatorPixel))):(An=new Float32Array(16),dn=new Float32Array(9),Jn=new Float32Array(16),Fn=[0,0],wn=new Float32Array(9));const Mi=$c(Ht,An,dn,Jn,wn,zt||[0,0],t.ae(A.transform.zoom),Fn,Vn,en||1,cn,Ee),si=A.isTileAffectedByFog(wt),Ii=A.getOrCreateProgram("rasterParticle",{defines:ut,overrideFog:si});if(A.uploadCommonUniforms(se,Ii,gt),ke){const Ai=new Zi(le.LEQUAL,Zi.ReadOnly,A.depthRangeFor3D),ur=0,Xi=A.globeSharedBuffers;if(Xi){const[er,dr,Ur]=Xi.getGridBuffers(Qt,ur!==0);Ii.draw(A,le.TRIANGLES,Ai,st,Tr.alphaBlended,A.renderElevatedRasterBackface?or.frontCCW:or.backCCW,Mi,H.id,er,dr,Ur)}}else{const Ai=A.depthModeForSublayer(0,Zi.ReadOnly),ur=De[wt.overscaledZ],{tileBoundsBuffer:Xi,tileBoundsIndexBuffer:er,tileBoundsSegments:dr}=A.getTileBoundsBuffers(vt);Ii.draw(A,le.TRIANGLES,Ai,ur,Tr.alphaBlended,or.disabled,Mi,H.id,Xi,er,dr)}}A.resetStencilClippingMasks()}(_,i,l,y),_.style.map.triggerRepaint())},background:function(_,i,l,y){const w=l.paint.get("background-color"),M=l.paint.get("background-color-use-theme").constantOr("default")==="none",A=l.paint.get("background-opacity"),V=l.paint.get("background-emissive-strength"),H=l.paint.get("background-pitch-alignment")==="viewport";if(A===0)return;const K=_.context,ee=K.gl,se=_.transform,le=se.tileSize,me=l.paint.get("background-pattern");let Ee;if(me!==void 0&&(me===null||(Ee=_.imageManager.getPattern(me.toString(),l.scope,_.style.getLut(l.scope)),!Ee)))return;const Se=!me&&w.a===1&&A===1&&_.opaquePassEnabledForLayer()?"opaque":"translucent";if(_.renderPass!==Se)return;const ke=lr.disabled,De=_.depthModeForSublayer(0,Se==="opaque"?Zi.ReadWrite:Zi.ReadOnly),Xe=_.colorModeForDrapableLayerRenderPass(V),ut=me?"backgroundPattern":"background";let st,wt=y;if(wt||(st=_.getBackgroundTiles(),wt=Object.values(st).map(gt=>gt.tileID)),me&&(K.activeTexture.set(ee.TEXTURE0),_.imageManager.bind(_.context,l.scope)),H){const gt=_.getOrCreateProgram(ut,{overrideFog:!1,overrideRtt:!0}),vt=new Float32Array(t.ab.mat4.identity([])),_t=new t.aG(0,0,0,0,0),Mt=me?Qu(vt,V,A,_,0,l.scope,Ee,H,{tileID:_t,tileSize:le}):Fl(vt,V,A,w.toRenderColor(M?null:l.lut));gt.draw(_,ee.TRIANGLES,De,ke,Xe,or.disabled,Mt,l.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments)}else for(const gt of wt){const vt=_.isTileAffectedByFog(gt),_t=_.getOrCreateProgram(ut,{overrideFog:vt}),Mt=gt.toUnwrapped(),Ft=y?gt.projMatrix:_.transform.calculateProjMatrix(Mt);_.prepareDrawTile();const cn=i?i.getTile(gt):st?st[gt.key]:new ss(gt,le,se.zoom,_),en=me?Qu(Ft,V,A,_,0,l.scope,Ee,H,{tileID:gt,tileSize:le}):Fl(Ft,V,A,w.toRenderColor(M?null:l.lut));_.uploadCommonUniforms(K,_t,Mt);const{tileBoundsBuffer:zt,tileBoundsIndexBuffer:Ht,tileBoundsSegments:En}=_.getTileBoundsBuffers(cn);_t.draw(_,ee.TRIANGLES,De,ke,Xe,or.disabled,en,l.id,zt,Ht,En)}},sky:function(_,i,l){const y=_._atmosphere?t.ae(_.transform.zoom):1,w=l.paint.get("sky-opacity")*y;if(w===0)return;const M=_.context,A=l.paint.get("sky-type"),V=new Zi(M.gl.LEQUAL,Zi.ReadOnly,[0,1]),H=_.frameCounter/1e3%1;A==="atmosphere"?_.renderPass==="offscreen"?l.needsSkyboxCapture(_)&&(function(K,ee,se,le){const me=K.context,Ee=me.gl;let Se=ee.skyboxFbo;if(!Se){Se=ee.skyboxFbo=me.createFramebuffer(32,32,!0,null),ee.skyboxGeometry=new Je(me),ee.skyboxTexture=me.gl.createTexture(),Ee.bindTexture(Ee.TEXTURE_CUBE_MAP,ee.skyboxTexture),Ee.texParameteri(Ee.TEXTURE_CUBE_MAP,Ee.TEXTURE_WRAP_S,Ee.CLAMP_TO_EDGE),Ee.texParameteri(Ee.TEXTURE_CUBE_MAP,Ee.TEXTURE_WRAP_T,Ee.CLAMP_TO_EDGE),Ee.texParameteri(Ee.TEXTURE_CUBE_MAP,Ee.TEXTURE_MIN_FILTER,Ee.LINEAR),Ee.texParameteri(Ee.TEXTURE_CUBE_MAP,Ee.TEXTURE_MAG_FILTER,Ee.LINEAR);for(let ut=0;ut<6;++ut)Ee.texImage2D(Ee.TEXTURE_CUBE_MAP_POSITIVE_X+ut,0,Ee.RGBA,32,32,0,Ee.RGBA,Ee.UNSIGNED_BYTE,null)}me.bindFramebuffer.set(Se.framebuffer),me.viewport.set([0,0,32,32]);const ke=ee.getCenter(K,!0),De=K.getOrCreateProgram("skyboxCapture"),Xe=new Float64Array(16);t.ab.mat4.identity(Xe),t.ab.mat4.rotateY(Xe,Xe,.5*-Math.PI),ot(K,ee,De,Xe,ke,0),t.ab.mat4.identity(Xe),t.ab.mat4.rotateY(Xe,Xe,.5*Math.PI),ot(K,ee,De,Xe,ke,1),t.ab.mat4.identity(Xe),t.ab.mat4.rotateX(Xe,Xe,.5*-Math.PI),ot(K,ee,De,Xe,ke,2),t.ab.mat4.identity(Xe),t.ab.mat4.rotateX(Xe,Xe,.5*Math.PI),ot(K,ee,De,Xe,ke,3),t.ab.mat4.identity(Xe),ot(K,ee,De,Xe,ke,4),t.ab.mat4.identity(Xe),t.ab.mat4.rotateY(Xe,Xe,Math.PI),ot(K,ee,De,Xe,ke,5),me.viewport.set([0,0,K.width,K.height])}(_,l),l.markSkyboxValid(_)):_.renderPass==="sky"&&function(K,ee,se,le,me){const Ee=K.context,Se=Ee.gl,ke=K.transform,De=K.getOrCreateProgram("skybox");Ee.activeTexture.set(Se.TEXTURE0),Se.bindTexture(Se.TEXTURE_CUBE_MAP,ee.skyboxTexture);const Xe=((ut,st,wt,gt,vt)=>({u_matrix:ut,u_sun_direction:st,u_cubemap:0,u_opacity:gt,u_temporal_offset:vt}))(ke.skyboxMatrix,ee.getCenter(K,!1),0,le,me);K.uploadCommonUniforms(Ee,De),De.draw(K,Se.TRIANGLES,se,lr.disabled,K.colorModeForRenderPass(),or.backCW,Xe,"skybox",ee.skyboxGeometry.vertexBuffer,ee.skyboxGeometry.indexBuffer,ee.skyboxGeometry.segment)}(_,l,V,w,H):A==="gradient"&&_.renderPass==="sky"&&function(K,ee,se,le,me){const Ee=K.context,Se=Ee.gl,ke=K.transform,De=K.getOrCreateProgram("skyboxGradient");ee.skyboxGeometry||(ee.skyboxGeometry=new Je(Ee)),Ee.activeTexture.set(Se.TEXTURE0);let Xe=ee.colorRampTexture;Xe||(Xe=ee.colorRampTexture=new t.T(Ee,ee.colorRamp,Se.RGBA8)),Xe.bind(Se.LINEAR,Se.CLAMP_TO_EDGE);const ut=((st,wt,gt,vt,_t)=>({u_matrix:st,u_color_ramp:0,u_center_direction:wt,u_radius:t.ai(gt),u_opacity:vt,u_temporal_offset:_t}))(ke.skyboxMatrix,ee.getCenter(K,!1),ee.paint.get("sky-gradient-radius"),le,me);K.uploadCommonUniforms(Ee,De),De.draw(K,Se.TRIANGLES,se,lr.disabled,K.colorModeForRenderPass(),or.backCW,ut,"skyboxGradient",ee.skyboxGeometry.vertexBuffer,ee.skyboxGeometry.indexBuffer,ee.skyboxGeometry.segment)}(_,l,V,w,H)},debug:function(_,i,l,y,w,M){for(let A=0;A<l.length;A++)if(w){const K=new t.aj(y.r*.8,y.g*.8,y.b*.8,1);Z(_,i,l[A],y,-1,-1,M),Z(_,i,l[A],y,-1,1,M),Z(_,i,l[A],y,1,1,M),Z(_,i,l[A],y,1,-1,M),Z(_,i,l[A],K,0,0,M)}else Z(_,i,l[A],y,0,0,M)},custom:function(_,i,l,y){const w=_.context,M=l.implementation;if(!_.transform.projection.unsupportedLayers||!_.transform.projection.unsupportedLayers.includes("custom")||_.terrain&&(_.terrain.renderingToTexture||_.renderPass==="offscreen")&&l.isDraped(i)){if(_.renderPass==="offscreen"){const A=M.prerender;if(A){if(_.setCustomLayerDefaults(),w.setColorMode(_.colorModeForRenderPass()),_.transform.projection.name==="globe"){const V=_.transform.pointMerc;A.call(M,w.gl,_.transform.customLayerMatrix(),_.transform.getProjection(),_.transform.globeToMercatorMatrix(),t.ae(_.transform.zoom),[V.x,V.y],_.transform.pixelsPerMeterRatio)}else A.call(M,w.gl,_.transform.customLayerMatrix());w.setDirty(),_.setBaseState()}}else if(_.renderPass==="translucent"){if(_.terrain&&_.terrain.renderingToTexture){const V=M.renderToTile;if(V){const H=y[0].canonical,K=new t.aa(H.x+y[0].wrap*(1<<H.z),H.y,H.z);w.setDepthMode(Zi.disabled),w.setStencilMode(lr.disabled),w.setColorMode(_.colorModeForRenderPass()),_.setCustomLayerDefaults(),V.call(M,w.gl,K),w.setDirty(),_.setBaseState()}return}_.setCustomLayerDefaults(),w.setColorMode(_.colorModeForRenderPass()),w.setStencilMode(lr.disabled);const A=M.renderingMode==="3d"?new Zi(_.context.gl.LEQUAL,Zi.ReadWrite,_.depthRangeFor3D):_.depthModeForSublayer(0,Zi.ReadOnly);if(w.setDepthMode(A),_.transform.projection.name==="globe"){const V=_.transform.pointMerc;M.render(w.gl,_.transform.customLayerMatrix(),_.transform.getProjection(),_.transform.globeToMercatorMatrix(),t.ae(_.transform.zoom),[V.x,V.y],_.transform.pixelsPerMeterRatio)}else M.render(w.gl,_.transform.customLayerMatrix());w.setDirty(),_.setBaseState(),w.bindFramebuffer.set(null)}}else t.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(_,i,l,y){if(_.renderPass==="opaque")return;const w=l.paint.get("model-opacity").constantOr(1);if(w===0)return;const M=l.paint.get("model-cast-shadows");if(_.renderPass==="shadow"&&(!M||_.terrain&&w<.65&&l._transitionablePaint._values["model-opacity"].value.expression instanceof t.a9))return;const A=_.shadowRenderer,V=l.paint.get("model-receive-shadows");A&&(A.useNormalOffset=!0,V||(A.enabled=!1));const H=()=>{A&&(A.useNormalOffset=!0,V||(A.enabled=!0))},K=i.getSource();if(_.renderPass==="light-beam"&&K.type!=="batched-model")return;if(K.type==="vector"||K.type==="geojson")return function(De,Xe,ut,st,wt){const gt=De.transform;if(gt.projection.name!=="mercator")return void t.w(`Drawing 3D models for ${gt.projection.name} projection is not yet implemented`);const vt=gt.getFreeCameraOptions().position;if(!De.modelManager)return;const _t=De.modelManager;ut.modelManager=_t;const Mt=De.shadowRenderer;if(!ut._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Ft=ut._unevaluatedLayout._values["model-id"],cn={...ut.layout.get("model-id").parameters},en=De.style.order.indexOf(ut.fqid);for(const zt of st){const Ht=Xe.getTile(zt).getBucket(ut);if(!Ht||Ht.projection.name!==gt.projection.name)continue;const En=Ht.getModelUris();En&&!Ht.modelsRequested&&(_t.addModelsFromBucket(En,wt),Ht.modelsRequested=!0);const Vn=ei(zt,gt);cn.zoom=Vn;const ti=Ft.possiblyEvaluate(cn);if(Rn(De,Ht,zt),Hn.shadowUniformsInitialized=!1,Hn.useSingleShadowCascade=!!Mt&&Mt.getMaxCascadeForTile(zt.toUnwrapped())===0,De.renderPass==="shadow"&&Mt){if(De.currentShadowCascade===1&&Ht.isInsideFirstShadowMapFrustum)continue;const dn=gt.calculatePosMatrix(zt.toUnwrapped(),gt.worldSize);if(Hn.tileMatrix.set(dn),Hn.shadowTileMatrix=Float32Array.from(Mt.calculateShadowPassMatrixFromMatrix(dn)),Hn.aabb.min.fill(0),Hn.aabb.max[0]=Hn.aabb.max[1]=t.ag,Hn.aabb.max[2]=0,zi(Ht,Hn,De,ut.scope))continue}const Qt=1<<zt.canonical.z,An=[((vt.x-zt.wrap)*Qt-zt.canonical.x)*t.ag,(vt.y*Qt-zt.canonical.y)*t.ag,vt.z*Qt*t.ag];De.conflationActive&&Object.keys(Ht.instancesPerModel).length>0&&De.style.isLayerClipped(ut,Xe.getSource())&&Ht.updateReplacement(zt,De.replacementSource,en,wt)&&(Ht.uploaded=!1,Ht.upload(De.context));for(let dn in Ht.instancesPerModel){const Jn=Ht.instancesPerModel[dn];Jn.features.length>0&&(dn=ti.evaluate(Jn.features[0].feature,{}));const Fn=_t.getModel(dn,wt);if(Fn&&Fn.uploaded)for(const wn of Fn.nodes)jn(De,ut,wn,Jn,An,zt,Hn)}}}(_,i,l,y,K.type==="vector"?l.scope:""),void H();if(!K.loaded())return;if(K.type==="batched-model")return function(De,Xe,ut,st){ut.resetLayerRenderingStats(De);const wt=De.context,gt=De.transform,vt=De.style.fog,_t=De.shadowRenderer;if(gt.projection.name!=="mercator")return void t.w(`Drawing 3D landmark models for ${gt.projection.name} projection is not yet implemented`);const Mt=De.transform.getFreeCameraOptions().position,Ft=t.ab.vec3.scale([],[Mt.x,Mt.y,Mt.z],De.transform.worldSize),cn=t.ab.vec3.negate([],Ft),en=t.ab.mat4.identity([]),zt=t.dj(gt.center.lat,gt.zoom),Ht=t.ab.mat4.fromScaling([],[1,1,1/zt]);t.ab.mat4.translate(en,en,cn);const En=ut.paint.get("model-opacity").constantOr(1),Vn=new Zi(wt.gl.LEQUAL,Zi.ReadWrite,De.depthRangeFor3D),ti=new Zi(wt.gl.LEQUAL,Zi.ReadOnly,De.depthRangeFor3D),Qt=new t.cd([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),An=De.renderPass==="shadow",dn=An&&_t?_t.getCurrentCascadeFrustum():gt.getFrustum(gt.scaleZoom(gt.worldSize)),Jn=ut.paint.get("model-front-cutoff"),Fn=Jn[2]<1,wn=Oc(De,ut.paint.get("model-cutoff-fade-range")),Mi=ut.getLayerRenderingStats();(function(si,Ii,Ai,ur){const Xi=si.terrain?si.terrain.exaggeration():0,er=si.transform.zoom;for(const dr of ur){const Ur=Ii.getTile(dr).getBucket(Ai);Ur&&(si.conflationActive&&Ur.updateReplacement(dr,si.replacementSource),Ur.evaluateScale(si,Ai),si.terrain&&Xi>0&&Ur.elevationUpdate(si.terrain,Xi,dr,Ai.source),Ur.needsReEvaluation(si,er,Ai)&&Ur.evaluate(Ai))}})(De,Xe,ut,st),function(){let si,Ii,Ai;Fn?(si=st.length-1,Ii=-1,Ai=-1):(si=0,Ii=st.length,Ai=1);const ur=new Float64Array(16),Xi=t.ab.vec3.create(),er=new t.P(0,0);for(let dr=si;dr!==Ii;dr+=Ai){const Ur=st[dr],Mr=Xe.getTile(Ur).getBucket(ut);if(!Mr||!Mr.uploaded)continue;let Ea=!1;_t&&(Ea=_t.getMaxCascadeForTile(Ur.toUnwrapped())===0);const za=gt.calculatePosMatrix(Ur.toUnwrapped(),gt.worldSize),ra=Mr.modelTraits;!An&&Fn&&(t.ab.mat4.invert(ur,za),t.ab.vec3.transformMat4(Xi,Ft,ur),er.x=Xi[0],er.y=Xi[1]);const ha=[];for(const br of Mr.getNodesInfo()){if(br.hiddenByReplacement||!br.node.meshes)continue;const nr=br.node;let ea=0;De.terrain&&nr.elevation&&(ea=nr.elevation*De.terrain.exaggeration());const ta=(()=>{const $r=br.aabb;return Qt.min=[...$r.min],Qt.max=[...$r.max],Qt.min[2]+=ea,Qt.max[2]+=ea,t.ab.vec3.transformMat4(Qt.min,Qt.min,za),t.ab.vec3.transformMat4(Qt.max,Qt.max,za),Qt})(),Xa=br.evaluatedScale;if(Xa[0]<=1&&Xa[1]<=1&&Xa[2]<=1&&ta.intersects(dn)===0)continue;if(!An&&Fn){const $r=.16666666666666666;br.cameraCollisionOpacity=Ft[0]>ta.min[0]&&Ft[0]<ta.max[0]&&Ft[1]>ta.min[1]&&Ft[1]<ta.max[1]&&Ft[2]*zt<ta.max[2]&&nr.footprint&&t.bA(er,nr.footprint)?Math.max(br.cameraCollisionOpacity-$r,0):Math.min(1,br.cameraCollisionOpacity+$r)}const bo=[...za],vl=nr.anchor?nr.anchor[0]:0,Ls=nr.anchor?nr.anchor[1]:0;t.ab.mat4.translate(bo,bo,[vl*(Xa[0]-1),Ls*(Xa[1]-1),ea]),t.ab.vec3.exactEquals(Xa,t.dm)||t.ab.mat4.scale(bo,bo,Xa);const wo=t.ab.mat4.multiply([],bo,nr.matrix),qo=t.ab.mat4.multiply([],gt.expandedFarZProjMatrix,wo),ys=t.ab.mat4.multiply([],gt.expandedFarZProjMatrix,bo),wa=t.ab.vec4.transformMat4([],[vl,Ls,ea,1],qo)[2];nr.hidden=!1;let fa=En;An||(Fn&&(fa*=br.cameraCollisionOpacity,fa*=Gi(bo,gt,br.aabb,Jn)),fa*=xi(wn,wa)),fa!==0?ha.push({nodeInfo:br,depth:wa,opacity:fa,wvpForNode:qo,wvpForTile:ys,nodeModelMatrix:wo,tileModelMatrix:bo}):nr.hidden=!0}An||ha.sort((br,nr)=>!Fn||br.opacity===1&&nr.opacity===1?br.depth<nr.depth?-1:1:br.opacity===1?-1:nr.opacity===1?1:br.depth>nr.depth?-1:1);for(const br of ha){const nr=br.nodeInfo,ea=nr.node;let ta=t.ab.mat4.multiply([],Ht,br.tileModelMatrix);t.ab.mat4.multiply(ta,en,ta);const Xa=t.ab.mat4.invert([],ta);t.ab.mat4.transpose(Xa,Xa),t.ab.mat4.scale(Xa,Xa,Ri),ta=t.ab.mat4.multiply(ta,ta,ea.matrix);const bo=De.renderPass==="light-beam",vl=ut.paint.get("model-color-use-theme").constantOr("default")==="none",Ls=ra&t.dp.HasMapboxMeshFeatures,wo=Ls?0:nr.evaluatedRMEA[0][2];for(let qo=0;qo<ea.meshes.length;++qo){const ys=ea.meshes[qo],wa=qo===ea.lightMeshIndex;let fa=br.wvpForNode;if(wa){if(!bo&&!De.terrain&&De.shadowRenderer){De.currentLayer<De.firstLightBeamLayer&&(De.firstLightBeamLayer=De.currentLayer);continue}fa=br.wvpForTile}else if(bo)continue;const $r={defines:[]},is=[];if(!An&&_t&&(_t.useNormalOffset=!!ys.normalBuffer),nn($r.defines,is,ys,De,vl?null:ut.lut),Ls||$r.defines.push("DIFFUSE_SHADED"),Ea&&$r.defines.push("SHADOWS_SINGLE_CASCADE"),Mi&&(An?Mi.numRenderedVerticesInShadowPass+=ys.vertexArray.length:Mi.numRenderedVerticesInTransparentPass+=ys.vertexArray.length),An){Mn(ys,br.nodeModelMatrix,De,ut);continue}let So=null;if(vt){const Ho=Bt(br.nodeModelMatrix,De.transform);if(So=new Float32Array(Ho),gt.projection.name!=="globe"){const Tu=ys.aabb.min,ac=ys.aabb.max,[Ad,uh]=vt.getOpacityForBounds(Ho,Tu[0],Tu[1],ac[0],ac[1]);$r.overrideFog=Ad>=li||uh>=li}}const Lr=ys.material;let Fo;Lr.occlusionTexture&&Lr.occlusionTexture.offsetScale&&(Fo=Lr.occlusionTexture.offsetScale,$r.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Tc=De.getOrCreateProgram("model",$r);!An&&_t&&_t.setupShadowsFromMatrix(br.tileModelMatrix,Tc,_t.useNormalOffset),De.uploadCommonUniforms(wt,Tc,null,So);const jl=Lr.pbrMetallicRoughness;jl.metallicFactor=.9,jl.roughnessFactor=.5;const Su=xr(new Float32Array(fa),new Float32Array(ta),new Float32Array(Xa),new Float32Array(ea.matrix),De,br.opacity,jl.baseColorFactor.toRenderColor(null),Lr.emissiveFactor,jl.metallicFactor,jl.roughnessFactor,Lr,wo,ut,[0,0,0],Fo);!wa&&(nr.hasTranslucentParts||br.opacity<1)&&Tc.draw(De,wt.gl.TRIANGLES,Vn,lr.disabled,Tr.disabled,or.backCCW,Su,ut.id,ys.vertexBuffer,ys.indexBuffer,ys.segments,ut.paint,De.transform.zoom,void 0,is),Tc.draw(De,wt.gl.TRIANGLES,wa?ti:Vn,lr.disabled,wa||br.opacity<1||nr.hasTranslucentParts?Tr.alphaBlended:Tr.unblended,or.backCCW,Su,ut.id,ys.vertexBuffer,ys.indexBuffer,ys.segments,ut.paint,De.transform.zoom,void 0,is)}}}}()}(_,i,l,y),void H();if(K.type!=="model")return;const ee=K.getModels(),se=[],le=_.transform.getFreeCameraOptions().position,me=t.ab.vec3.scale([],[le.x,le.y,le.z],_.transform.worldSize);t.ab.vec3.negate(me,me);const Ee=[],Se=[];let ke=0;for(const De of ee){const Xe=l.paint.get("model-rotation").constantOr(null),ut=l.paint.get("model-scale").constantOr(null),st=l.paint.get("model-translation").constantOr(null);De.computeModelMatrix(_,Xe,ut,st,!0,!0,!1);const wt=t.ab.mat4.identity([]),gt=t.dj(De.position.lat,_.transform.zoom),vt=t.ab.mat4.fromScaling([],[1,1,1/gt]);t.ab.mat4.translate(wt,wt,me),se.push({zScaleMatrix:vt,negCameraPosMatrix:wt});for(const _t of De.nodes)an(_.transform,_t,De.matrix,_.transform.expandedFarZProjMatrix,ke,Ee,Se);ke++}if(Ee.sort((De,Xe)=>Xe.depth-De.depth),_.renderPass!=="shadow"){if(w===1)for(const De of Se)rn(De,_,l,se[De.modelIndex],lr.disabled,_.colorModeForRenderPass());else{for(const De of Se)rn(De,_,l,se[De.modelIndex],lr.disabled,Tr.disabled);for(const De of Se)rn(De,_,l,se[De.modelIndex],_.stencilModeFor3D(),_.colorModeForRenderPass());_.resetStencilClippingMasks()}for(const De of Ee)rn(De,_,l,se[De.modelIndex],lr.disabled,_.colorModeForRenderPass());H()}else{for(const De of Se)Mn(De.mesh,De.nodeModelMatrix,_,l);for(const De of Ee)Mn(De.mesh,De.nodeModelMatrix,_,l);H()}}},rh={model:function(_,i,l){const y=i.getSource();if(!y.loaded())return;if(y.type==="vector"||y.type==="geojson")return void(l.modelManager&&l.modelManager.upload(l,y.type==="vector"?_.scope:""));if(y.type==="batched-model"||y.type!=="model")return;const w=y.getModels();for(const M of w)M.upload(l.context)},raster:function(_,i,l){const y=i.getSource();if(!(y instanceof dc&&y.loaded()))return;const w=_.sourceLayer||y.rasterLayerIds&&y.rasterLayerIds[0];if(!w)return;const M=_.paint.get("raster-array-band")||y.getInitialBand(w);if(M==null)return;const A=i.getIds().map(V=>i.getTileByID(V));for(const V of A)V.updateNeeded(w,M)&&y.prepareTile(V,w,M)},"raster-particle":function(_,i,l){const y=i.getSource();if(!(y instanceof dc&&y.loaded()))return;const w=_.sourceLayer||y.rasterLayerIds&&y.rasterLayerIds[0];if(!w)return;const M=_.paint.get("raster-particle-array-band")||y.getInitialBand(w);if(M==null)return;const A=i.getIds().map(V=>i.getTileByID(V));for(const V of A)V.updateNeeded(w,M)&&y.prepareTile(V,w,M)}};class ah{constructor(i,l,y,w,M){this.context=new eh(i,l),this.transform=y,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=M,this._timeStamp=t.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const A=["fill","line","symbol","circle","heatmap","fill-extrusion","raster","raster-particle","hillshade","model","background","sky"];for(const H of A)this._debugParams.enabledLayers[H]=!0;M.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),M.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),M.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),M.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),M.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),M.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const H of A)M.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],H);this.occlusionParams=new Ma(M),this.setup(),this.numSublayers=ts.maxUnderzooming+ts.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new t.dv,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new oa(this),this._wireframeDebugCache=new ua,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const V=new t.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new t.T(this.context,V,i.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=w}updateTerrain(i,l){const y=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(y||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new jc(this,i));const w=this._terrain;this.transform.elevation=y?w:null,w.update(i,this.transform,l),this.transform.elevation&&!w.enabled&&(this.transform.elevation=null)}_updateFog(i){const l=i.fog;if(!l||this.transform.projection.name==="globe"||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[y,w]=l.getFovAdjustedRange(this.transform._fov);if(y>w)return void(this.transform.fogCullDistSq=null);const M=y+.78*(w-y);this.transform.fogCullDistSq=M*M}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(i){i&&!this._terrain&&(this._terrain=new jc(this,this.style)),this._forceTerrainMode=i}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(i,l){if(this.width=i*t.q.devicePixelRatio,this.height=l*t.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const y of this.style.order)this.style._mergedLayers[y].resize()}setup(){const i=this.context,l=new t.b4;l.emplaceBack(0,0),l.emplaceBack(t.ag,0),l.emplaceBack(0,t.ag),l.emplaceBack(t.ag,t.ag),this.tileExtentBuffer=i.createVertexBuffer(l,t.b6.members),this.tileExtentSegments=t.b7.simpleSegment(0,0,4,2);const y=new t.b4;y.emplaceBack(0,0),y.emplaceBack(t.ag,0),y.emplaceBack(0,t.ag),y.emplaceBack(t.ag,t.ag),this.debugBuffer=i.createVertexBuffer(y,t.b6.members),this.debugSegments=t.b7.simpleSegment(0,0,4,5);const w=new t.b4;w.emplaceBack(-1,-1),w.emplaceBack(1,-1),w.emplaceBack(-1,1),w.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(w,t.b6.members),this.viewportSegments=t.b7.simpleSegment(0,0,4,2);const M=new t.aT;M.emplaceBack(0,0,0,0),M.emplaceBack(t.ag,0,t.ag,0),M.emplaceBack(0,t.ag,0,t.ag),M.emplaceBack(t.ag,t.ag,t.ag,t.ag),this.mercatorBoundsBuffer=i.createVertexBuffer(M,t.b9.members),this.mercatorBoundsSegments=t.b7.simpleSegment(0,0,4,2);const A=new t.aU;A.emplaceBack(0,1,2),A.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(A);const V=new t.b5;for(const K of[0,1,3,2,0])V.emplaceBack(K);this.debugIndexBuffer=i.createIndexBuffer(V),this.emptyTexture=new t.T(i,new t.r({width:1,height:1},Uint8Array.of(0,0,0,0)),i.gl.RGBA8),this.identityMat=t.ab.mat4.create();const H=this.context.gl;this.stencilClearMode=new lr({func:H.ALWAYS,mask:0},0,255,H.ZERO,H.ZERO,H.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const i=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,i.TRIANGLES,Zi.disabled,this.stencilClearMode,Tr.disabled,or.disabled,Vc(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(i,l,y){if(!l||this.currentStencilSource===l.id||!i.isTileClipped()||!y||y.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let V=!1;for(const H of y)if(this._tileClippingMaskIDs[H.key]===void 0){V=!0;break}if(!V)return}this.currentStencilSource=l.id;const w=this.context,M=w.gl;this.nextStencilID+y.length>256&&this.clearStencil(),w.setColorMode(Tr.disabled),w.setDepthMode(Zi.disabled);const A=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const V of y){const H=l.getTile(V),K=this._tileClippingMaskIDs[V.key]=this.nextStencilID++,{tileBoundsBuffer:ee,tileBoundsIndexBuffer:se,tileBoundsSegments:le}=this.getTileBoundsBuffers(H);A.draw(this,M.TRIANGLES,Zi.disabled,new lr({func:M.ALWAYS,mask:0},K,255,M.KEEP,M.KEEP,M.REPLACE),Tr.disabled,or.disabled,Vc(V.projMatrix),"$clipping",ee,se,le)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,l=this.context.gl;return new lr({func:l.NOTEQUAL,mask:255},i,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);const l=this.context.gl;return new lr({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(i){const l=this.context.gl,y=i.sort((A,V)=>V.overscaledZ-A.overscaledZ),w=y[y.length-1].overscaledZ,M=y[0].overscaledZ-w+1;if(M>1){this.currentStencilSource=void 0,this.nextStencilID+M>256&&this.clearStencil();const A={};for(let V=0;V<M;V++)A[V+w]=new lr({func:l.GEQUAL,mask:255},V+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=M,[A,y]}return[{[w]:lr.disabled},y]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new Tr([i.CONSTANT_COLOR,i.ONE,i.CONSTANT_COLOR,i.ONE],new t.aj(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Tr.unblended:Tr.alphaBlended}colorModeForDrapableLayerRenderPass(i){const l=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Tr([l.ONE,l.ONE_MINUS_SRC_ALPHA,l.CONSTANT_ALPHA,l.ONE_MINUS_SRC_ALPHA],new t.aj(0,0,0,i===void 0?0:i),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(i,l,y,w=!1){if(this.depthOcclusion)return new Zi(this.context.gl.GREATER,Zi.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!w)return Zi.disabled;const M=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new Zi(y||this.context.gl.LEQUAL,l,[M,M])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const i=this.context.gl,l=Math.ceil(this.width),y=Math.ceil(this.height),w=this.context.bindFramebuffer.get(),M=i.getParameter(i.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===l&&this.depthFBO.height===y||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),l!==0&&y!==0&&(this.depthFBO=new Ss(this.context,l,y,!1,"texture"),this.depthTexture=new t.T(this.context,{width:l,height:y,data:null},i.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(w),i.bindTexture(i.TEXTURE_2D,M),this.depthFBO&&(i.bindFramebuffer(i.READ_FRAMEBUFFER,null),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),i.blitFramebuffer(0,0,l,y,0,0,l,y,i.DEPTH_BUFFER_BIT,i.NEAREST),i.bindFramebuffer(i.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((i,l)=>i+l/this._fpsHistory.length,0))}render(i,l){const y=t.q.now();this._dt=y-this._timeStamp,this._timeStamp=y,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=i.map.repaint,this.style=i,this.options=l;const w=this.style._mergedLayers,M=this.style._getOrder(!(!this.terrain||!this.terrain.enabled)).filter(zt=>{const Ht=w[zt];return!(Ht.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Ht.type]});let A=!1,V=!1;for(const zt of M){const Ht=w[zt];Ht.type==="circle"&&(A=!0),Ht.type==="symbol"&&(Ht.hasInitialOcclusionOpacityProperties?V=!0:A=!0)}const H=M.map(zt=>w[zt]),K=this.style._mergedSourceCaches;this.imageManager=i.imageManager,this.modelManager=i.modelManager,this.symbolFadeChange=i.placement.symbolFadeChange(t.q.now()),this.imageManager.beginFrame();let ee=0,se=!1;for(const zt in K){const Ht=K[zt];Ht.used&&(Ht.prepare(this.context),Ht.getSource().usedInConflation&&++ee)}let le=!1;for(const zt of H)zt.isHidden(this.transform.zoom)||(zt.type==="clip"&&(le=!0),this.prepareLayer(zt));const me={},Ee={},Se={},ke={},De={};for(const zt in K){const Ht=K[zt];me[zt]=Ht.getVisibleCoordinates(),Ee[zt]=me[zt].slice().reverse(),Se[zt]=Ht.getVisibleCoordinates(!0).reverse(),ke[zt]=Ht.getShadowCasterCoordinates(),De[zt]=Ht.sortCoordinatesByDistance(me[zt])}const Xe=zt=>{const Ht=this.style.getLayerSourceCache(zt);return Ht&&Ht.used?Ht.getSource():null};if(ee||le||this._clippingActiveLastFrame){const zt=[],Ht=[];let En=0;for(const Vn of H)this.isSourceForClippingOrConflation(Vn,Xe(Vn))&&(zt.push(Vn),Ht.push(En)),En++;if(le||zt.length>1||this._clippingActiveLastFrame){le=!1;const Vn=[];for(let ti=0;ti<zt.length;ti++){const Qt=zt[ti],An=Ht[ti],dn=this.style.getLayerSourceCache(Qt);if(!dn||!dn.used||!dn.getSource().usedInConflation&&Qt.type!=="clip")continue;let Jn=t.dx,Fn=t.by.None;const wn=[];let Mi=!0;if(Qt.type==="clip"){Jn=An;for(const si of Qt.layout.get("clip-layer-types"))Fn|=si==="model"?t.by.Model:si==="symbol"?t.by.Symbol:t.by.FillExtrusion;for(const si of Qt.layout.get("clip-layer-scope"))wn.push(si);Qt.isHidden(this.transform.zoom)?Mi=!1:le=!0}Mi&&Vn.push({layer:Qt.fqid,cache:dn,order:Jn,clipMask:Fn,clipScope:wn})}this.replacementSource.setSources(Vn),se=!0}}this._clippingActiveLastFrame=le,se||this.replacementSource.clear(),this.conflationActive=se,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let zt=0;zt<H.length;zt++){const Ht=H[zt],En=Ht.cutoffRange();if(this.longestCutoffRange=Math.max(En,this.longestCutoffRange),En>0){const Vn=Xe(Ht);Vn&&(this.minCutoffZoom=Math.max(Vn.minzoom,this.minCutoffZoom)),Ht.minzoom&&(this.minCutoffZoom=Math.max(Ht.minzoom,this.minCutoffZoom))}Ht.is3D()&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=zt),this._lastOcclusionLayer=zt)}const ut=this.style&&this.style.fog;ut?(this._fogVisible=ut.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=ut.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(Se),this.opaquePassCutoff=0);const st=this._shadowRenderer;if(st){st.updateShadowParameters(this.transform,this.style.directionalLight);for(const zt in K)for(const Ht of me[zt]){let En={min:0,max:0};this.terrain&&(En=this.terrain.getMinMaxForTile(Ht)||En),st.addShadowReceiver(Ht.toUnwrapped(),En.min,En.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new t.dw(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Nt(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const wt=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),gt=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(wt&&!this._snow&&(this._snow=new rl(this)),!wt&&this._snow&&(this._snow.destroy(),delete this._snow),gt&&!this._rain&&(this._rain=new nc(this)),!gt&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!Zn.has(this.context.gl))return;this.renderPass="offscreen";for(const zt of H){const Ht=i.getLayerSourceCache(zt);if(!zt.hasOffscreenPass()||zt.isHidden(this.transform.zoom))continue;const En=Ht?Ee[Ht.id]:void 0;(zt.type==="custom"||zt.type==="raster"||zt.type==="raster-particle"||zt.isSky()||En&&En.length)&&this.renderLayer(this,Ht,zt,En)}this.depthRangeFor3D=[0,1-(H.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ke)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const vt=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),_t=(()=>{if(l.showOverdrawInspector)return t.aj.black;const zt=this.style.fog;if(zt&&this.transform.projection.supportsFog){const Ht=this.style.getLut(zt.scope);if(!vt){const En=zt.properties.get("color-use-theme")==="none",Vn=zt.properties.get("color").toRenderColor(En?null:Ht).toArray01();return new t.aj(...Vn)}if(vt){const En=zt.properties.get("space-color-use-theme")==="none",Vn=zt.properties.get("space-color").toRenderColor(En?null:Ht).toArray01();return new t.aj(...Vn)}}return t.aj.transparent})();if(this.context.clear({color:_t,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&vt&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=M.length-1;this.currentLayer>=0;this.currentLayer--){const zt=H[this.currentLayer],Ht=i.getLayerSourceCache(zt);if(zt.isSky())continue;const En=Ht?(zt.is3D()?De:Ee)[Ht.id]:void 0;this._renderTileClippingMasks(zt,Ht,En),this.renderLayer(this,Ht,zt,En)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&vt&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||t.ae(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<M.length;this.currentLayer++){const zt=H[this.currentLayer],Ht=i.getLayerSourceCache(zt);zt.isSky()&&this.renderLayer(this,Ht,zt,Ht?Ee[Ht.id]:void 0)}function Mt(zt,Ht){let En;return Ht&&(En=(zt.type==="symbol"?Se:zt.is3D()?De:Ee)[Ht.id]),En}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<M.length;){const zt=H[this.currentLayer];if(zt.type==="raster"||zt.type==="raster-particle"){const Ht=i.getLayerSourceCache(zt);this.renderLayer(this,Ht,zt,Mt(zt,Ht))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Ft=0;st&&(Ft=st.getShadowCastingLayerCount());let cn=!1,en=-1;for(let zt=0;zt<M.length;++zt){const Ht=H[zt];Ht.isHidden(this.transform.zoom)||Ht.is3D()&&(en=zt)}for(V&&en===-1&&(A=!0);this.currentLayer<M.length;){const zt=H[this.currentLayer],Ht=i.getLayerSourceCache(zt);if(zt.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(zt)){if(zt.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(A&&!cn&&this.terrain&&!this.transform.isOrthographic&&(cn=!0,this.blitDepth()),V&&en!==-1&&this.currentLayer===en+1&&!this.transform.isOrthographic&&this.blitDepth(),zt.is3D()||this.terrain||this._renderTileClippingMasks(zt,Ht,Ht?me[Ht.id]:void 0),this.renderLayer(this,Ht,zt,Mt(zt,Ht)),!this.terrain&&st&&Ft>0&&zt.hasShadowPass()&&--Ft==0&&(st.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const En=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=En;this.currentLayer++){const Vn=H[this.currentLayer];if(!Vn.hasLightBeamPass())continue;const ti=i.getLayerSourceCache(Vn);this.renderLayer(this,ti,Vn,ti?Ee[ti.id]:void 0)}this.currentLayer=En,this.renderPass="translucent"}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const En=this.currentLayer;this.depthOcclusion=!0;for(const Vn of this.layersWithOcclusionOpacity){this.currentLayer=Vn;const ti=H[this.currentLayer],Qt=i.getLayerSourceCache(ti),An=Qt?Ee[Qt.id]:void 0;ti.is3D()||this.terrain||this._renderTileClippingMasks(ti,Qt,Qt?me[Qt.id]:void 0),this.renderLayer(this,Qt,ti,An)}this.depthOcclusion=!1,this.currentLayer=En,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let zt=null;H.forEach(Ht=>{const En=i.getLayerSourceCache(Ht);En&&!Ht.isHidden(this.transform.zoom)&&En.getVisibleCoordinates().length&&(!zt||zt.getSource().maxzoom<En.getSource().maxzoom)&&(zt=En)}),zt&&this.options.showTileBoundaries&&xu.debug(this,zt,zt.getVisibleCoordinates(),t.aj.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&xu.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new t.aj(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(zt){const Ht=zt.transform.padding;re(zt,zt.transform.height-(Ht.top||0),3,r),re(zt,Ht.bottom||0,3,p),ue(zt,Ht.left||0,3,C),ue(zt,zt.transform.width-(Ht.right||0),3,k);const En=zt.transform.centerPoint;(function(Vn,ti,Qt,An){ye(Vn,ti-1,Qt-10,2,20,An),ye(Vn,ti-10,Qt-1,20,2,An)})(zt,En.x,zt.transform.height-En.y,j)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),se||(this.conflationActive=!1)}prepareLayer(i){this.gpuTimingStart(i);const{unsupportedLayers:l}=this.transform.projection,y=!l||!l.includes(i.type);if(rh[i.type]&&(y||this.terrain&&i.type==="custom")){const w=this.style.getLayerSourceCache(i);rh[i.type](i,w,this)}this.gpuTimingEnd()}renderLayer(i,l,y,w){y.isHidden(this.transform.zoom)||(y.type==="background"||y.type==="sky"||y.type==="custom"||y.type==="model"||y.type==="raster"||y.type==="raster-particle"||w&&w.length)&&(this.id=y.id,this.gpuTimingStart(y),i.transform.projection.unsupportedLayers&&i.transform.projection.unsupportedLayers.includes(y.type)&&(!i.terrain||y.type!=="custom")||y.type==="clip"||xu[y.type](i,l,y,w,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery,y=this.context.gl;let w=this.gpuTimers[i.id];w||(w=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:y.createQuery()}),w.calls++,y.beginQuery(l.TIME_ELAPSED_EXT,w.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const i=this.context.extTimerQuery,l=this.context.gl,y=l.createQuery();this.deferredRenderGpuTimeQueries.push(y),l.beginQuery(i.TIME_ELAPSED_EXT,y)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}collectDeferredRenderGpuQueries(){const i=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],i}queryGpuTimers(i){const l={};for(const y in i){const w=i[y],M=this.context.extTimerQuery,A=M.getQueryParameter(w.query,this.context.gl.QUERY_RESULT)/1e6;M.deleteQueryEXT(w.query),l[y]=A}return l}queryGpuTimeDeferredRender(i){if(!this.options.gpuTimingDeferredRender)return 0;const l=this.context.gl;let y=0;for(const w of i)y+=l.getQueryParameter(w,l.QUERY_RESULT)/1e6,l.deleteQuery(w);return y}translatePosMatrix(i,l,y,w,M){if(!y[0]&&!y[1])return i;const A=M?w==="map"?this.transform.angle:0:w==="viewport"?-this.transform.angle:0;if(A){const K=Math.sin(A),ee=Math.cos(A);y=[y[0]*ee-y[1]*K,y[0]*K+y[1]*ee]}const V=[M?y[0]:t.ar(l,y[0],this.transform.zoom),M?y[1]:t.ar(l,y[1],this.transform.zoom),0],H=new Float32Array(16);return t.ab.mat4.translate(H,i,V),H}saveTileTexture(i){const l=i.size[0],y=this._tileTextures[l];y?y.push(i):this._tileTextures[l]=[i]}getTileTexture(i){const l=this._tileTextures[i];return l&&l.length>0?l.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(i,l,y){const w=y===void 0?this.terrain&&this.terrain.renderingToTexture:y,M=[];return this.style&&this.style.enable3dLights()&&(i==="globeRaster"||i==="terrainRaster"?(M.push("LIGHTING_3D_MODE"),M.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):w||M.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||M.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(M.push("TERRAIN"),this.linearFloatFilteringSupported()&&M.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&M.push("GLOBE"),!this._fogVisible||w||l!==void 0&&!l||M.push("FOG","FOG_DITHERING"),w&&M.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&M.push("OVERDRAW_INSPECTOR"),M}getOrCreateProgram(i,l){this.cache=this.cache||{};const y=l&&l.defines||[],w=l&&l.config,M=this.currentGlobalDefines(i,l&&l.overrideFog,l&&l.overrideRtt).concat(y),A=im.cacheKey(ep[i],i,M,w);return this.cache[A]||(this.cache[A]=new im(this.context,i,ep[i],w,wd[i],M)),this.cache[A]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new t.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(i,l){if(this.style.enable3dLights()){const y=this.style.directionalLight,w=this.style.ambientLight;if(y&&w){const M=((A,V,H)=>{const K=A.properties.get("direction"),ee=A.properties.get("color-use-theme")==="none",se=A.properties.get("color").toRenderColor(ee?null:H.getLut(A.scope)).toArray01(),le=A.properties.get("intensity"),me=V.properties.get("color-use-theme")==="none",Ee=V.properties.get("color").toRenderColor(me?null:H.getLut(V.scope)).toArray01(),Se=V.properties.get("intensity"),ke=[K.x,K.y,K.z],De=t.cM(Ee,Se),Xe=t.cM(se,le);return{u_lighting_ambient_color:De,u_lighting_directional_dir:ke,u_lighting_directional_color:Xe,u_ground_radiance:Yi(ke,Xe,De)}})(y,w,this.style);l.setLightsUniformValues(i,M)}}}uploadCommonUniforms(i,l,y,w,M){if(this.uploadCommonLightUniforms(i,l),this.terrain&&this.terrain.renderingToTexture)return;const A=this.style.fog;if(A){const V=A.getOpacity(this.transform.pitch),H=((K,ee,se,le,me,Ee,Se,ke,De,Xe,ut,st)=>{const wt=K.transform,gt=ee.properties.get("color-use-theme")==="none",vt=ee.properties.get("color").toRenderColor(gt?null:K.style.getLut(ee.scope)).toArray01();vt[3]=le;const _t=K.frameCounter/1e3%1,[Mt,Ft]=ee.properties.get("vertical-range");return{u_fog_matrix:se?wt.calculateFogTileMatrix(se):st||K.identityMat,u_fog_range:ee.getFovAdjustedRange(wt._fov),u_fog_color:vt,u_fog_horizon_blend:ee.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Mt,Ft),Ft],u_fog_temporal_offset:_t,u_frustum_tl:me,u_frustum_tr:Ee,u_frustum_br:Se,u_frustum_bl:ke,u_globe_pos:De,u_globe_radius:Xe,u_viewport:ut,u_globe_transition:t.ae(wt.zoom),u_is_globe:+(wt.projection.name==="globe")}})(this,A,y,V,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*t.q.devicePixelRatio,this.transform.height*t.q.devicePixelRatio],w);l.setFogUniformValues(i,H)}M&&l.setCutoffUniformValues(i,M.uniformValues)}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){const i=this.canvasCopy();i&&(this.frameCopies.push(i),this.tileLoaded=!1)}canvasCopy(){const i=this.context.gl,l=i.createTexture();return i.bindTexture(i.TEXTURE_2D,l),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const i=this.style&&this.style.fog;return!!i&&i.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const i=this._backgroundTiles,l=this._backgroundTiles={},y=this.transform.coveringTiles({tileSize:512});for(const w of y)l[w.key]=i[w.key]||new ss(w,512,this.transform.tileZoom,this);return l}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(i,l){return!(!i.is3D()||i.type!=="clip"&&(i.minzoom&&i.minzoom>this.transform.zoom||(this.style._clipLayerPresent||i.sourceLayer!=="building")&&(!l||l.type!=="batched-model")))}isTileAffectedByFog(i){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let l=this._cachedTileFogOpacities[i.key];return l||(this._cachedTileFogOpacities[i.key]=l=this.style.fog.getOpacityForTile(i)),l[0]>=li||l[1]>=li}setupDepthForOcclusion(i,l,y){const w=this.context,M=w.gl,A=!!y;var V;y||(y={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),w.activeTexture.set(M.TEXTURE3),i&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE),y.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],y.u_depth_range_unpack=[2/((V=this.depthRangeFor3D)[1]-V[0]),-1-2*V[0]/(V[1]-V[0])],y.u_occluder_half_size=.5*this.occlusionParams.occluderSize,y.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(M.NEAREST,M.CLAMP_TO_EDGE),w.activeTexture.set(M.TEXTURE0),A||l.setTerrainUniformValues(w,y)}}function yo(_,i){let l=!1,y=null;const w=()=>{y=null,l&&(_(),y=setTimeout(w,i),l=!1)};return()=>(l=!0,y||w(),y)}class gl{constructor(i){this._hashName=i&&encodeURIComponent(i),t.aP(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=yo(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,window.addEventListener("hashchange",this._onHashChange,!1),i.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const i=this._map;if(!i)return"";const l=al(i);if(this._hashName){const y=this._hashName;let w=!1;const M=location.hash.slice(1).split("&").map(A=>{const V=A.split("=")[0];return V===y?(w=!0,`${V}=${l}`):A}).filter(A=>A);return w||M.push(`${y}=${l}`),`#${M.join("&")}`}return`#${l}`}_getCurrentHash(){const i=location.hash.replace("#","");if(this._hashName){let l;return i.split("&").map(y=>y.split("=")).forEach(y=>{y[0]===this._hashName&&(l=y)}),(l&&l[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._map;if(!i)return!1;const l=this._getCurrentHash();if(l.length>=3&&!l.some(y=>isNaN(y))){const y=i.dragRotate.isEnabled()&&i.touchZoomRotate.isEnabled()?+(l[3]||0):i.getBearing();return i.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:y,pitch:+(l[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function al(_,i){const l=_.getCenter(),y=Math.round(100*_.getZoom())/100,w=Math.ceil((y*Math.LN2+Math.log(512/360/.5))/Math.LN10),M=Math.pow(10,w),A=Math.round(l.lng*M)/M,V=Math.round(l.lat*M)/M,H=_.getBearing(),K=_.getPitch();let ee=i?`/${A}/${V}/${y}`:`${y}/${V}/${A}`;return(H||K)&&(ee+="/"+Math.round(10*H)/10),K&&(ee+=`/${Math.round(K)}`),ee}const Oo={linearity:.3,easing:t.dy(0,0,.3,1)},Fa=t.l({deceleration:2500,maxSpeed:1400},Oo),us=t.l({deceleration:20,maxSpeed:1400},Oo),_l=t.l({deceleration:1e3,maxSpeed:360},Oo),_s=t.l({deceleration:1e3,maxSpeed:90},Oo);class Zm{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:t.q.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,l=t.q.now();for(;i.length>0&&l-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const l={zoom:0,bearing:0,pitch:0,pan:new t.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:M}of this._inertiaBuffer)l.zoom+=M.zoomDelta||0,l.bearing+=M.bearingDelta||0,l.pitch+=M.pitchDelta||0,M.panDelta&&l.pan._add(M.panDelta),M.around&&(l.around=M.around),M.pinchAround&&(l.pinchAround=M.pinchAround);const y=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,w={};if(l.pan.mag()){const M=Lh(l.pan.mag(),y,t.l({},Fa,i||{}));w.offset=l.pan.mult(M.amount/l.pan.mag()),w.center=this._map.transform.center,Td(w,M)}if(l.zoom){const M=Lh(l.zoom,y,us);w.zoom=this._map.transform.zoom+M.amount,Td(w,M)}if(l.bearing){const M=Lh(l.bearing,y,_l);w.bearing=this._map.transform.bearing+t.aw(M.amount,-179,179),Td(w,M)}if(l.pitch){const M=Lh(l.pitch,y,_s);w.pitch=this._map.transform.pitch+M.amount,Td(w,M)}if(w.zoom||w.bearing){const M=l.pinchAround===void 0?l.around:l.pinchAround;w.around=M?this._map.unproject(M):this._map.getCenter()}return this.clear(),w.noMoveStart=!0,w}}function Td(_,i){(!_.duration||_.duration<i.duration)&&(_.duration=i.duration,_.easing=i.easing)}function Lh(_,i,l){const{maxSpeed:y,linearity:w,deceleration:M}=l,A=t.aw(_*w/(i/1e3),-y,y),V=Math.abs(A)/(M*w);return{easing:l.easing,duration:1e3*V,amount:A*(V/2)}}class sl extends t.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,l,y,w={}){const M=qe(l.getCanvasContainer(),y),A=l.unproject(M);super(i,t.l({point:M,lngLat:A,originalEvent:y},w)),this._defaultPrevented=!1,this.target=l}}class wc extends t.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,l,y){const w=i==="touchend"?y.changedTouches:y.touches,M=He(l.getCanvasContainer(),w),A=M.map(H=>l.unproject(H)),V=M.reduce((H,K,ee,se)=>H.add(K.div(se.length)),new t.P(0,0));super(i,{points:M,point:V,lngLats:A,lngLat:l.unproject(V),originalEvent:y}),this._defaultPrevented=!1}}class sh extends t.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,l){super("wheel",{originalEvent:l}),this._defaultPrevented=!1}}class bu{constructor(i,l){this._map=i,this._clickTolerance=l.clickTolerance}reset(){this._mousedownPos=void 0}wheel(i){return this._firePreventable(new sh(this._map,i))}mousedown(i,l){return this._mousedownPos=l,this._firePreventable(new sl(i.type,this._map,i))}mouseup(i){this._map.fire(new sl(i.type,this._map,i))}preclick(i){const l=t.l({},i);l.type="preclick",this._map.fire(new sl(l.type,this._map,l))}click(i,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(i),this._map.fire(new sl(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new sl(i.type,this._map,i))}mouseover(i){this._map.fire(new sl(i.type,this._map,i))}mouseout(i){this._map.fire(new sl(i.type,this._map,i))}touchstart(i){return this._firePreventable(new wc(i.type,this._map,i))}touchmove(i){this._map.fire(new wc(i.type,this._map,i))}touchend(i){this._map.fire(new wc(i.type,this._map,i))}touchcancel(i){this._map.fire(new wc(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class rm{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(i){this._map.fire(new sl(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new sl("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new sl(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class gp{constructor(i,l){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,l){this.isEnabled()&&i.shiftKey&&i.button===0&&(Le(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(i,l){if(!this._active)return;const y=l,w=this._startPos,M=this._lastPos;if(!w||!M||M.equals(y)||!this._box&&y.dist(w)<this._clickTolerance)return;this._lastPos=y,this._box||(this._box=ie("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const A=Math.min(w.x,y.x),V=Math.max(w.x,y.x),H=Math.min(w.y,y.y),K=Math.max(w.y,y.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${A}px,${H}px)`,this._box.style.width=V-A+"px",this._box.style.height=K-H+"px")})}mouseupWindow(i,l){if(!this._active)return;const y=this._startPos,w=l;if(y&&i.button===0){if(this.reset(),Ue(),y.x!==w.x||y.y!==w.y)return this._map.fire(new t.z("boxzoomend",{originalEvent:i})),{cameraAnimation:M=>M.fitScreenCoordinates(y,w,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Oe(),delete this._startPos,delete this._lastPos}_fireEvent(i,l){return this._map.fire(new t.z(i,{originalEvent:l}))}}function vf(_,i){const l={};for(let y=0;y<_.length;y++)l[_[y].identifier]=i[y];return l}class Wa{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(i,l,y){(this.centroid||y.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=i.timeStamp),y.length===this.numTouches&&(this.centroid=function(w){const M=new t.P(0,0);for(const A of w)M._add(A);return M.div(w.length)}(l),this.touches=vf(y,l)))}touchmove(i,l,y){if(this.aborted||!this.centroid)return;const w=vf(y,l);for(const M in this.touches){const A=w[M];(!A||A.dist(this.touches[M])>30)&&(this.aborted=!0)}}touchend(i,l,y){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),y.length===0){const w=!this.aborted&&this.centroid;if(this.reset(),w)return w}}}class Cd{constructor(i){this.singleTap=new Wa(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(i,l,y){this.singleTap.touchstart(i,l,y)}touchmove(i,l,y){this.singleTap.touchmove(i,l,y)}touchend(i,l,y){const w=this.singleTap.touchend(i,l,y);if(w){const M=i.timeStamp-this.lastTime<500,A=!this.lastTap||this.lastTap.dist(w)<30;if(M&&A||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=w,this.count===this.numTaps)return this.reset(),w}}}class am{constructor(){this._zoomIn=new Cd({numTouches:1,numTaps:2}),this._zoomOut=new Cd({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,l,y){this._zoomIn.touchstart(i,l,y),this._zoomOut.touchstart(i,l,y)}touchmove(i,l,y){this._zoomIn.touchmove(i,l,y),this._zoomOut.touchmove(i,l,y)}touchend(i,l,y){const w=this._zoomIn.touchend(i,l,y),M=this._zoomOut.touchend(i,l,y);return w?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:A.getZoom()+1,around:A.unproject(w)},{originalEvent:i})}):M?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:A.getZoom()-1,around:A.unproject(M)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Ug={0:1,2:2};class xf{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(i,l){return!1}_move(i,l){return{}}mousedown(i,l){if(this._lastPoint)return;const y=nt(i);this._correctButton(i,y)&&(this._lastPoint=l,this._eventButton=y)}mousemoveWindow(i,l){const y=this._lastPoint;if(y){if(i.preventDefault(),this._eventButton!=null&&function(w,M){const A=Ug[M];return w.buttons===void 0||(w.buttons&A)!==A}(i,this._eventButton))this.reset();else if(this._moved||!(l.dist(y)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(y,l)}}mouseupWindow(i){this._lastPoint&&nt(i)===this._eventButton&&(this._moved&&Ue(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Wm extends xf{mousedown(i,l){super.mousedown(i,l),this._lastPoint&&(this._active=!0)}_correctButton(i,l){return l===0&&!i.ctrlKey}_move(i,l){return{around:l,panDelta:l.sub(i)}}}class sm extends xf{_correctButton(i,l){return l===0&&i.ctrlKey||l===2}_move(i,l){const y=.8*(l.x-i.x);if(y)return this._active=!0,{bearingDelta:y}}contextmenu(i){i.preventDefault()}}class _p extends xf{_correctButton(i,l){return l===0&&i.ctrlKey||l===2}_move(i,l){const y=-.5*(l.y-i.y);if(y)return this._active=!0,{pitchDelta:y}}contextmenu(i){i.preventDefault()}}class ic{constructor(i,l){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),t.aP(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new t.P(0,0)}touchstart(i,l,y){return this._calculateTransform(i,l,y)}touchmove(i,l,y){if(this._active&&!(y.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(y.length===1&&!t.dz())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.cancelable&&i.preventDefault(),this._calculateTransform(i,l,y)}}touchend(i,l,y){this._calculateTransform(i,l,y),this._active&&y.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,l,y){y.length>0&&(this._active=!0);const w=vf(y,l),M=new t.P(0,0),A=new t.P(0,0);let V=0;for(const K in w){const ee=w[K],se=this._touches[K];se&&(M._add(ee),A._add(ee.sub(se)),V++,w[K]=ee)}if(this._touches=w,V<this._minTouches||!A.mag())return;const H=A.div(V);return this._sum._add(H),this._sum.mag()<this._clickTolerance?void 0:{around:M.div(V),panDelta:H}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ie("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class yp{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(i){}_move(i,l,y){return{}}touchstart(i,l,y){this._firstTwoTouches||y.length<2||(this._firstTwoTouches=[y[0].identifier,y[1].identifier],this._start([l[0],l[1]]))}touchmove(i,l,y){const w=this._firstTwoTouches;if(!w)return;i.preventDefault();const[M,A]=w,V=Ba(y,l,M),H=Ba(y,l,A);if(!V||!H)return;const K=this._aroundCenter?null:V.add(H).div(2);return this._move([V,H],K,i)}touchend(i,l,y){if(!this._firstTwoTouches)return;const[w,M]=this._firstTwoTouches,A=Ba(y,l,w),V=Ba(y,l,M);A&&V||(this._active&&Ue(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ba(_,i,l){for(let y=0;y<_.length;y++)if(_[y].identifier===l)return i[y]}function rc(_,i){return Math.log(_/i)/Math.LN2}class vp extends yp{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,l){const y=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(rc(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:rc(this._distance,y),pinchAround:l}}}function xp(_,i){return 180*_.angleWith(i)/Math.PI}class $g extends yp{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,l){const y=this._vector;if(this._vector=i[0].sub(i[1]),y&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:xp(this._vector,y),pinchAround:l}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const l=25/(Math.PI*this._minDiameter)*360,y=this._startVector;if(!y)return!1;const w=xp(i,y);return Math.abs(w)<l}}function Gg(_){return Math.abs(_.y)>Math.abs(_.x)}class om extends yp{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(i){this._lastPoints=i,Gg(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,l,y){const w=this._lastPoints;if(!w)return;const M=i[0].sub(w[0]),A=i[1].sub(w[1]);return this._map._cooperativeGestures&&!t.dz()&&y.touches.length<3||(this._valid=this.gestureBeginsVertically(M,A,y.timeStamp),!this._valid)?void 0:(this._lastPoints=i,this._active=!0,{pitchDelta:(M.y+A.y)/2*-.5})}gestureBeginsVertically(i,l,y){if(this._valid!==void 0)return this._valid;const w=i.mag()>=2,M=l.mag()>=2;if(!w&&!M)return;if(!w||!M)return this._firstMove==null&&(this._firstMove=y),y-this._firstMove<100&&void 0;const A=i.y>0==l.y>0;return Gg(i)&&Gg(l)&&A}}const sy={panStep:100,bearingStep:15,pitchStep:10};class oy{constructor(){const i=sy;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let l=0,y=0,w=0,M=0,A=0;switch(i.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:i.shiftKey?y=-1:(i.preventDefault(),M=-1);break;case 39:i.shiftKey?y=1:(i.preventDefault(),M=1);break;case 38:i.shiftKey?w=1:(i.preventDefault(),A=-1);break;case 40:i.shiftKey?w=-1:(i.preventDefault(),A=1);break;default:return}return this._rotationDisabled&&(y=0,w=0),{cameraAnimation:V=>{const H=V.getZoom();V.easeTo({duration:300,easeId:"keyboardHandler",easing:Xm,zoom:l?Math.round(H)+l*(i.shiftKey?2:1):H,bearing:V.getBearing()+y*this._bearingStep,pitch:V.getPitch()+w*this._pitchStep,offset:[-M*this._panStep,-A*this._panStep],center:V.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Xm(_){return _*(2-_)}const Ym=4.000244140625,Ed=1/450;class bf{constructor(i,l){this._map=i,this._el=i.getCanvasContainer(),this._handler=l,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Ed,t.aP(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||t.dz()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const y=t.q.now(),w=y-(this._lastWheelEventTime||0);this._lastWheelEventTime=y,l!==0&&l%Ym==0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":w>400?(this._type=null,this._lastValue=l,this._timeout=window.setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(w*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),i.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=i,this._delta-=l,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=qe(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform;this._type==="wheel"&&i.projection.wrap&&(i._center.lng>=180||i._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const l=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(this._delta!==0){const K=this._type==="wheel"&&Math.abs(this._delta)>Ym?this._wheelZoomRate:this._defaultZoomRate;let ee=2/(1+Math.exp(-Math.abs(this._delta*K)));this._delta<0&&ee!==0&&(ee=1/ee);const se=l(),le=Math.pow(2,se),me=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):le;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(me*ee))),this._type==="wheel"&&(this._startZoom=se,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const y=typeof this._targetZoom=="number"?this._targetZoom:l(),w=this._startZoom,M=this._easing;let A,V=!1;if(this._type==="wheel"&&w&&M){const K=Math.min((t.q.now()-this._lastWheelEventTime)/200,1),ee=M(K);A=t.af(w,y,ee),K<1?this._frameId||(this._frameId=!0):V=!0}else A=y,V=!0;this._active=!0,V&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let H=A-l();return H*this._lastDelta<0&&(H=0),{noInertia:!0,needsRenderFrame:!V,zoomDelta:H,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let l=t.dA;if(this._prevEase){const y=this._prevEase,w=(t.q.now()-y.start)/y.duration,M=y.easing(w+.01)-y.easing(w),A=.27/Math.sqrt(M*M+1e-4)*.01,V=Math.sqrt(.0729-A*A);l=t.dy(A,V,.25,1)}return this._prevEase={start:t.q.now(),duration:i,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ie("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class wu{constructor(i,l){this._clickZoom=i,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Vl{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,l){return i.preventDefault(),{cameraAnimation:y=>{y.easeTo({duration:300,zoom:y.getZoom()+(i.shiftKey?-1:1),around:y.unproject(l)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class vo{constructor(){this._tap=new Cd({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(i,l,y){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?y.length>0&&(this._swipePoint=l[0],this._swipeTouch=y[0].identifier):this._tap.touchstart(i,l,y))}touchmove(i,l,y){if(this._tapTime){if(this._swipePoint){if(y[0].identifier!==this._swipeTouch)return;const w=l[0],M=w.y-this._swipePoint.y;return this._swipePoint=w,i.preventDefault(),this._active=!0,{zoomDelta:M/128}}}else this._tap.touchmove(i,l,y)}touchend(i,l,y){this._tapTime?this._swipePoint&&y.length===0&&this.reset():this._tap.touchend(i,l,y)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Md{constructor(i,l,y){this._el=i,this._mousePan=l,this._touchPan=y}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class oh{constructor(i,l,y){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=l,this._mousePitch=y}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Sv{constructor(i,l,y,w){this._el=i,this._touchZoom=l,this._touchRotate=y,this._tapDragZoom=w,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const lm=_=>_.zoom||_.drag||_.pitch||_.rotate;class Tv extends t.z{}class Cv{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,l){const y=t.ab.vec3.sub([],l,i);this.radius=t.ab.vec3.length(y[2]<0?t.ab.vec3.div([],y,this.constants):[y[0],y[1],0])}projectRay(i){t.ab.vec3.div(i,i,this.constants),t.ab.vec3.normalize(i,i),t.ab.vec3.mul(i,i,this.constants);const l=t.ab.vec3.scale([],i,this.radius);if(l[2]>0){const y=t.ab.vec3.scale([],[0,0,1],t.ab.vec3.dot(l,[0,0,1])),w=t.ab.vec3.scale([],t.ab.vec3.normalize([],[l[0],l[1],0]),this.radius),M=t.ab.vec3.add([],l,t.ab.vec3.scale([],t.ab.vec3.sub([],t.ab.vec3.add([],w,y),l),2));l[0]=M[0],l[1]=M[1]}return l}}function cm(_){return _.panDelta&&_.panDelta.mag()||_.zoomDelta||_.bearingDelta||_.pitchDelta}class yl{constructor(i,l){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Zm(i),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Cv,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),t.aP(["handleEvent","handleWindowEvent"],this);const y=this._el;this._listeners=[[y,"touchstart",{passive:!0}],[y,"touchmove",{passive:!1}],[y,"touchend",void 0],[y,"touchcancel",void 0],[y,"mousedown",void 0],[y,"mousemove",void 0],[y,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[y,"mouseover",void 0],[y,"mouseout",void 0],[y,"dblclick",void 0],[y,"click",void 0],[y,"keydown",{capture:!1}],[y,"keyup",void 0],[y,"wheel",{passive:!1}],[y,"contextmenu",void 0],[window,"blur",void 0]];for(const[w,M,A]of this._listeners){const V=w===document?this.handleWindowEvent:this.handleEvent;w.addEventListener(M,V,A)}}destroy(){for(const[i,l,y]of this._listeners){const w=i===document?this.handleWindowEvent:this.handleEvent;i.removeEventListener(l,w,y)}}_addDefaultHandlers(i){const l=this._map,y=l.getCanvasContainer();this._add("mapEvent",new bu(l,i));const w=l.boxZoom=new gp(l,i);this._add("boxZoom",w);const M=new am,A=new Vl;l.doubleClickZoom=new wu(A,M),this._add("tapZoom",M),this._add("clickZoom",A);const V=new vo;this._add("tapDragZoom",V);const H=l.touchPitch=new om(l);this._add("touchPitch",H);const K=new sm(i),ee=new _p(i);l.dragRotate=new oh(i,K,ee),this._add("mouseRotate",K,["mousePitch"]),this._add("mousePitch",ee,["mouseRotate"]);const se=new Wm(i),le=new ic(l,i);l.dragPan=new Md(y,se,le),this._add("mousePan",se),this._add("touchPan",le,["touchZoom","touchRotate"]);const me=new $g,Ee=new vp;l.touchZoomRotate=new Sv(y,Ee,me,V),this._add("touchRotate",me,["touchPan","touchZoom"]),this._add("touchZoom",Ee,["touchPan","touchRotate"]),this._add("blockableMapEvent",new rm(l));const Se=l.scrollZoom=new bf(l,this);this._add("scrollZoom",Se,["mousePan"]);const ke=l.keyboard=new oy;this._add("keyboard",ke);for(const De of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[De]&&l[De].enable(i[De])}_add(i,l,y){this._handlers.push({handlerName:i,handler:l,allowed:y}),this._handlersById[i]=l}stop(i){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!lm(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(i,l,y){for(const w in i)if(w!==y&&(!l||l.indexOf(w)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const l=[];for(const y of i)this._el.contains(y.target)&&l.push(y);return l}handleEvent(i,l){this._updatingCamera=!0;const y=i.type==="renderFrame",w=y?void 0:i,M={needsRenderFrame:!1},A={},V={},H=i.touches?this._getMapTouches(i.touches):void 0,K=H?He(this._el,H):y?void 0:qe(this._el,i);for(const{handlerName:le,handler:me,allowed:Ee}of this._handlers){if(!me.isEnabled())continue;let Se;this._blockedByActive(V,Ee,le)?me.reset():me[l||i.type]&&(Se=me[l||i.type](i,K,H),this.mergeHandlerResult(M,A,Se,le,w),Se&&Se.needsRenderFrame&&this._triggerRenderFrame()),(Se||me.isActive())&&(V[le]=me)}const ee={};for(const le in this._previousActiveHandlers)V[le]||(ee[le]=w);this._previousActiveHandlers=V,(Object.keys(ee).length||cm(M))&&(this._changes.push([M,A,ee]),this._triggerRenderFrame()),(Object.keys(V).length||cm(M))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:se}=M;se&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],se(this._map))}mergeHandlerResult(i,l,y,w,M){if(!y)return;t.l(i,y);const A={handlerName:w,originalEvent:y.originalEvent||M};y.zoomDelta!==void 0&&(l.zoom=A),y.panDelta!==void 0&&(l.drag=A),y.pitchDelta!==void 0&&(l.pitch=A),y.bearingDelta!==void 0&&(l.rotate=A)}_applyChanges(){const i={},l={},y={};for(const[w,M,A]of this._changes)w.panDelta&&(i.panDelta=(i.panDelta||new t.P(0,0))._add(w.panDelta)),w.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+w.zoomDelta),w.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+w.bearingDelta),w.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+w.pitchDelta),w.around!==void 0&&(i.around=w.around),w.aroundCoord!==void 0&&(i.aroundCoord=w.aroundCoord),w.pinchAround!==void 0&&(i.pinchAround=w.pinchAround),w.noInertia&&(i.noInertia=w.noInertia),t.l(l,M),t.l(y,A);this._updateMapTransform(i,l,y),this._changes=[]}_updateMapTransform(i,l,y){const w=this._map,M=w.transform,A=Xe=>[Xe.x,Xe.y,Xe.z];if((Xe=>{const ut=this._eventsInProgress.drag;return ut&&!this._handlersById[ut.handlerName].isActive()})()&&!cm(i)){const Xe=M.zoom;M.cameraElevationReference="sea",this._originalZoom!=null&&M._orthographicProjectionAtLowPitch&&M.projection.name!=="globe"&&M.pitch===0?(M.cameraElevationReference="ground",M.zoom=this._originalZoom):(M.recenterOnTerrain(),M.cameraElevationReference="ground"),Xe!==M.zoom&&this._map._update(!0)}if(M._isCameraConstrained&&w._stop(!0),!cm(i))return void this._fireEvents(l,y,!0);let{panDelta:V,zoomDelta:H,bearingDelta:K,pitchDelta:ee,around:se,aroundCoord:le,pinchAround:me}=i;M._isCameraConstrained&&(H>0&&(H=0),M._isCameraConstrained=!1),me!==void 0&&(se=me),(H||(Xe=>l[Xe]&&!this._eventsInProgress[Xe])("drag"))&&se&&(this._dragOrigin=A(M.pointCoordinate3D(se)),this._originalZoom=M.zoom,this._trackingEllipsoid.setup(M._camera.position,this._dragOrigin)),M.cameraElevationReference="sea",w._stop(!0),se=se||w.transform.centerPoint,K&&(M.bearing+=K),ee&&(M.pitch+=ee),M._updateCameraState();const Ee=[0,0,0];if(V)if(M.projection.name==="mercator"){const Xe=this._trackingEllipsoid.projectRay(M.screenPointToMercatorRay(se).dir),ut=this._trackingEllipsoid.projectRay(M.screenPointToMercatorRay(se.sub(V)).dir);Ee[0]=ut[0]-Xe[0],Ee[1]=ut[1]-Xe[1]}else{const Xe=M.pointCoordinate(se);if(M.projection.name==="globe"){V=V.rotate(-M.angle);const ut=M._pixelsPerMercatorPixel/M.worldSize;Ee[0]=-V.x*t.dB(t.aS(Xe.y))*ut,Ee[1]=-V.y*t.dB(M.center.lat)*ut}else{const ut=M.pointCoordinate(se.sub(V));Xe&&ut&&(Ee[0]=ut.x-Xe.x,Ee[1]=ut.y-Xe.y)}}const Se=M.zoom,ke=[0,0,0];if(H){const Xe=A(le||M.pointCoordinate3D(se)),ut={dir:t.ab.vec3.normalize([],t.ab.vec3.sub([],Xe,M._camera.position))};if(ut.dir[2]<0){const st=M.zoomDeltaToMovement(Xe,H);t.ab.vec3.scale(ke,ut.dir,st)}}const De=t.ab.vec3.add(Ee,Ee,ke);M._translateCameraConstrained(De),H&&Math.abs(M.zoom-Se)>1e-4&&M.recenterOnTerrain(),M.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(l,y,!0)}_fireEvents(i,l,y){const w=lm(this._eventsInProgress),M=lm(i),A={};for(const ee in i){const{originalEvent:se}=i[ee];this._eventsInProgress[ee]||(A[`${ee}start`]=se),this._eventsInProgress[ee]=i[ee]}!w&&M&&this._fireEvent("movestart",M.originalEvent);for(const ee in A)this._fireEvent(ee,A[ee]);M&&this._fireEvent("move",M.originalEvent);for(const ee in i){const{originalEvent:se}=i[ee];this._fireEvent(ee,se)}const V={};let H;for(const ee in this._eventsInProgress){const{handlerName:se,originalEvent:le}=this._eventsInProgress[ee];this._handlersById[se].isActive()||(delete this._eventsInProgress[ee],H=l[se]||le,V[`${ee}end`]=H)}for(const ee in V)this._fireEvent(ee,V[ee]);const K=lm(this._eventsInProgress);if(y&&(w||M)&&!K){this._updatingCamera=!0;const ee=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),se=le=>le!==0&&-this._bearingSnap<le&&le<this._bearingSnap;ee?(se(ee.bearing||this._map.getBearing())&&(ee.bearing=0),this._map.easeTo(ee,{originalEvent:H})):(this._map.fire(new t.z("moveend",{originalEvent:H})),se(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,l){this._map.fire(new t.z(i,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{this._frameId=void 0,this.handleEvent(new Tv("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const bp="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Km extends t.E{constructor(i,l){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=l.bearingSnap,this._respectPrefersReducedMotion=l.respectPrefersReducedMotion!==!1,t.aP(["_renderFrameCallback"],this)}getCenter(){return new t.bO(this.transform.center.lng,this.transform.center.lat)}setCenter(i,l){return this.jumpTo({center:i},l)}panBy(i,l,y){return i=t.P.convert(i).mult(-1),this.panTo(this.transform.center,t.l({offset:i},l),y)}panTo(i,l,y){return this.easeTo(t.l({center:i},l),y)}getZoom(){return this.transform.zoom}setZoom(i,l){return this.jumpTo({zoom:i},l),this}zoomTo(i,l,y){return this.easeTo(t.l({zoom:i},l),y)}zoomIn(i,l){return this.zoomTo(this.getZoom()+1,i,l),this}zoomOut(i,l){return this.zoomTo(this.getZoom()-1,i,l),this}getBearing(){return this.transform.bearing}setBearing(i,l){return this.jumpTo({bearing:i},l),this}getPadding(){return this.transform.padding}setPadding(i,l){return this.jumpTo({padding:i},l),this}rotateTo(i,l,y){return this.easeTo(t.l({bearing:i},l),y)}resetNorth(i,l){return this.rotateTo(0,t.l({duration:1e3},i),l),this}resetNorthPitch(i,l){return this.easeTo(t.l({bearing:0,pitch:0,duration:1e3},i),l),this}snapToNorth(i,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,l):this}getPitch(){return this.transform.pitch}setPitch(i,l){return this.jumpTo({pitch:i},l),this}cameraForBounds(i,l){i=t.az.convert(i);const y=l&&l.bearing||0,w=l&&l.pitch||0,M=i.getNorthWest(),A=i.getSouthEast();return this._cameraForBounds(this.transform,M,A,y,w,l)}_extendPadding(i){const l={top:0,right:0,bottom:0,left:0};return i==null?t.l({},l,this.transform.padding):typeof i=="number"?{top:i,bottom:i,right:i,left:i}:t.l({},l,i)}_extendCameraOptions(i){return(i=t.l({offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding=this._extendPadding(i.padding),i}_minimumAABBFrustumDistance(i,l){const y=l.max[0]-l.min[0],w=l.max[1]-l.min[1];return y/w>i.aspect?y/(2*Math.tan(.5*i.fovX)*i.aspect):w/(2*Math.tan(.5*i.fovY)*i.aspect)}_cameraForBoundsOnGlobe(i,l,y,w,M,A){const V=i.clone(),H=this._extendCameraOptions(A);V.bearing=w,V.pitch=M;const K=t.bO.convert(l),ee=t.bO.convert(y),se=.5*(K.lat+ee.lat),le=.5*(K.lng+ee.lng),me=t.dC(se,le),Ee=t.ab.vec3.normalize([],me),Se=t.ab.vec3.normalize([],t.ab.vec3.cross([],Ee,[0,1,0])),ke=t.ab.vec3.cross([],Se,Ee),De=[Se[0],Se[1],Se[2],0,ke[0],ke[1],ke[2],0,Ee[0],Ee[1],Ee[2],0,0,0,0,1],Xe=[me,t.dC(K.lat,K.lng),t.dC(ee.lat,K.lng),t.dC(ee.lat,ee.lng),t.dC(K.lat,ee.lng),t.dC(se,K.lng),t.dC(se,ee.lng),t.dC(K.lat,le),t.dC(ee.lat,le)];let ut=t.cd.fromPoints(Xe.map(dn=>[t.ab.vec3.dot(Se,dn),t.ab.vec3.dot(ke,dn),t.ab.vec3.dot(Ee,dn)]));const st=t.ab.vec3.transformMat4([],ut.center,De);t.ab.vec3.squaredLength(st)===0&&t.ab.vec3.set(st,0,0,1),t.ab.vec3.normalize(st,st),t.ab.vec3.scale(st,st,t.ax),V.center=t.dD(st);const wt=V.getWorldToCameraMatrix(),gt=t.ab.mat4.invert(new Float64Array(16),wt);ut=t.cd.applyTransform(ut,t.ab.mat4.multiply([],wt,De));const vt=this._extendAABB(ut,V,H,w);if(!vt)return void t.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ut=vt,t.ab.vec3.transformMat4(st,st,wt);const _t=.5*(ut.max[2]-ut.min[2]),Mt=this._minimumAABBFrustumDistance(V,ut),Ft=t.ab.vec3.scale([],[0,0,1],_t),cn=t.ab.vec3.add(Ft,st,Ft),en=Mt+(V.pitch===0?0:t.ab.vec3.distance(st,cn)),zt=V.globeCenterInViewSpace,Ht=t.ab.vec3.sub([],st,[zt[0],zt[1],zt[2]]);t.ab.vec3.normalize(Ht,Ht),t.ab.vec3.scale(Ht,Ht,en);const En=t.ab.vec3.add([],st,Ht);t.ab.vec3.transformMat4(En,En,gt);const Vn=t.ds/t.ax,ti=t.ab.vec3.length(En),Qt=t.bH(Math.max(ti*Vn-t.ds,Number.EPSILON),0),An=Math.min(V.zoomFromMercatorZAdjusted(Qt),H.maxZoom);return An>.5*(t.c6+t.bY)?(V.setProjection({name:"mercator"}),V.zoom=An,this._cameraForBounds(V,l,y,w,M,A)):{center:V.center,zoom:An,bearing:w,pitch:M}}_extendAABB(i,l,y,w){const M=.5*((y.padding.left||0)+(y.padding.right||0)),A=.5*((y.padding.top||0)+(y.padding.bottom||0)),V=A,H=M,K=M,ee=A,se=l.width-(H+K),le=l.height-(V+ee),me=t.ab.vec3.sub([],i.max,i.min),Ee=Math.min(se/me[0],le/me[1]),Se=Math.min(l.scaleZoom(l.scale*Ee),y.maxZoom);if(isNaN(Se))return null;const ke=l.scale/l.zoomScale(Se),De=new t.cd([i.min[0]-H*ke,i.min[1]-ee*ke,i.min[2]],[i.max[0]+K*ke,i.max[1]+V*ke,i.max[2]]),Xe=(typeof y.offset.x=="number"&&typeof y.offset.y=="number"?new t.P(y.offset.x,y.offset.y):t.P.convert(y.offset)).rotate(-t.ai(w));return De.center[0]-=Xe.x*ke,De.center[1]+=Xe.y*ke,De}queryTerrainElevation(i,l){const y=this.transform.elevation;return y?(l=t.l({},{exaggerated:!0},l),y.getAtPoint(t.aa.fromLngLat(i),null,l.exaggerated)):null}_cameraForBounds(i,l,y,w,M,A){if(i.projection.name==="globe")return this._cameraForBoundsOnGlobe(i,l,y,w,M,A);const V=i.clone(),H=this._extendCameraOptions(A);V.bearing=w,V.pitch=M;const K=t.bO.convert(l),ee=t.bO.convert(y),se=new t.bO(K.lng,ee.lat),le=new t.bO(ee.lng,K.lat),me=V.project(K),Ee=V.project(ee),Se=this.queryTerrainElevation(K),ke=this.queryTerrainElevation(ee),De=this.queryTerrainElevation(se),Xe=this.queryTerrainElevation(le),ut=[[me.x,me.y,Math.min(Se||0,ke||0,De||0,Xe||0)],[Ee.x,Ee.y,Math.max(Se||0,ke||0,De||0,Xe||0)]];let st=t.cd.fromPoints(ut);const wt=V.getWorldToCameraMatrix(),gt=t.ab.mat4.invert(new Float64Array(16),wt);st=t.cd.applyTransform(st,wt);const vt=this._extendAABB(st,V,H,w);if(!vt)return void t.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");st=vt;const _t=.5*t.ab.vec3.sub([],st.max,st.min)[2],Mt=this._minimumAABBFrustumDistance(V,st),Ft=[0,0,1,0];t.ab.vec4.transformMat4(Ft,Ft,wt),t.ab.vec4.normalize(Ft,Ft);const cn=t.ab.vec3.scale([],Ft,Mt+_t),en=t.ab.vec3.add([],st.center,cn);t.ab.vec3.transformMat4(st.center,st.center,gt),t.ab.vec3.transformMat4(en,en,gt);const zt=V.unproject(new t.P(st.center[0],st.center[1])),Ht=t.dE(V.projection,zt),En=Math.pow(2,Ht),Vn=Math.min(V._zoomFromMercatorZ(en[2]*V.pixelsPerMeter*En/V.worldSize),H.maxZoom);return V.mercatorFromTransition&&Vn<.5*(t.c6+t.bY)?(V.setProjection({name:"globe"}),V.zoom=Vn,this._cameraForBounds(V,l,y,w,M,A)):{center:zt,zoom:Vn,bearing:w,pitch:M}}fitBounds(i,l,y){const w=this.cameraForBounds(i,l);return this._fitInternal(w,l,y)}fitScreenCoordinates(i,l,y,w,M){const A=t.P.convert(i),V=t.P.convert(l),H=new t.P(Math.min(A.x,V.x),Math.min(A.y,V.y)),K=new t.P(Math.max(A.x,V.x),Math.max(A.y,V.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(A,V))return this;const ee=this.transform.pointLocation3D(H),se=this.transform.pointLocation3D(K),le=this.transform.pointLocation3D(new t.P(H.x,K.y)),me=this.transform.pointLocation3D(new t.P(K.x,H.y)),Ee=[Math.min(ee.lng,se.lng,le.lng,me.lng),Math.min(ee.lat,se.lat,le.lat,me.lat)],Se=[Math.max(ee.lng,se.lng,le.lng,me.lng),Math.max(ee.lat,se.lat,le.lat,me.lat)],ke=w&&w.pitch?w.pitch:this.getPitch(),De=this._cameraForBounds(this.transform,Ee,Se,y,ke,w);return this._fitInternal(De,w,M)}_fitInternal(i,l,y){return i?(l=t.l(i,l)).linear?this.easeTo(l,y):this.flyTo(l,y):this}jumpTo(i,l){this.stop();const y=i.preloadOnly?this.transform.clone():this.transform;let w=!1,M=!1,A=!1;"zoom"in i&&y.zoom!==+i.zoom&&(w=!0,y.zoom=+i.zoom),i.center!==void 0&&(y.center=t.bO.convert(i.center)),"bearing"in i&&y.bearing!==+i.bearing&&(M=!0,y.bearing=+i.bearing),"pitch"in i&&y.pitch!==+i.pitch&&(A=!0,y.pitch=+i.pitch);const V=typeof i.padding=="number"?this._extendPadding(i.padding):i.padding;if(i.padding!=null&&!y.isPaddingEqual(V))if(i.retainPadding===!1){const H=y.clone();H.padding=V,y.setLocationAtPoint(y.center,H.centerPoint)}else y.padding=V;return i.preloadOnly?(this._preloadTiles(y),this):(this.fire(new t.z("movestart",l)).fire(new t.z("move",l)),w&&this.fire(new t.z("zoomstart",l)).fire(new t.z("zoom",l)).fire(new t.z("zoomend",l)),M&&this.fire(new t.z("rotatestart",l)).fire(new t.z("rotate",l)).fire(new t.z("rotateend",l)),A&&this.fire(new t.z("pitchstart",l)).fire(new t.z("pitch",l)).fire(new t.z("pitchend",l)),this.fire(new t.z("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||t.w(bp),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,l){const y=this.transform;if(!y.projection.supportsFreeCamera)return t.w(bp),this;this.stop();const w=y.zoom,M=y.pitch,A=y.bearing;y.setFreeCameraOptions(i);const V=w!==y.zoom,H=M!==y.pitch,K=A!==y.bearing;return this.fire(new t.z("movestart",l)).fire(new t.z("move",l)),V&&this.fire(new t.z("zoomstart",l)).fire(new t.z("zoom",l)).fire(new t.z("zoomend",l)),K&&this.fire(new t.z("rotatestart",l)).fire(new t.z("rotate",l)).fire(new t.z("rotateend",l)),H&&this.fire(new t.z("pitchstart",l)).fire(new t.z("pitch",l)).fire(new t.z("pitchend",l)),this.fire(new t.z("moveend",l)),this}easeTo(i,l){this._stop(!1,i.easeId),((i=t.l({offset:[0,0],duration:500,easing:t.dA},i)).animate===!1||this._prefersReducedMotion(i))&&(i.duration=0);const y=this.transform,w=this.getZoom(),M=this.getBearing(),A=this.getPitch(),V=this.getPadding(),H="zoom"in i?+i.zoom:w,K="bearing"in i?this._normalizeBearing(i.bearing,M):M,ee="pitch"in i?+i.pitch:A,se=this._extendPadding(i.padding),le=t.P.convert(i.offset);let me,Ee,Se;if(y.projection.name==="globe"){const Ft=t.aa.fromLngLat(y.center),cn=le.rotate(-y.angle);Ft.x+=cn.x/y.worldSize,Ft.y+=cn.y/y.worldSize;const en=Ft.toLngLat(),zt=t.bO.convert(i.center||en);this._normalizeCenter(zt),me=y.centerPoint.add(cn),Ee=new t.P(Ft.x,Ft.y).mult(y.worldSize),Se=new t.P(t.at(zt.lng),t.aA(zt.lat)).mult(y.worldSize).sub(Ee)}else{me=y.centerPoint.add(le);const Ft=y.pointLocation(me),cn=t.bO.convert(i.center||Ft);this._normalizeCenter(cn),Ee=y.project(Ft),Se=y.project(cn).sub(Ee)}const ke=y.zoomScale(H-w);let De,Xe;i.around&&(De=t.bO.convert(i.around),Xe=y.locationPoint(De));const ut=this._zooming||H!==w,st=this._rotating||M!==K,wt=this._pitching||ee!==A,gt=!y.isPaddingEqual(se),vt=i.retainPadding===!1?y.clone():y,_t=Ft=>cn=>{if(ut&&(Ft.zoom=t.af(w,H,cn)),st&&(Ft.bearing=t.af(M,K,cn)),wt&&(Ft.pitch=t.af(A,ee,cn)),gt&&(vt.interpolatePadding(V,se,cn),me=vt.centerPoint.add(le)),De)Ft.setLocationAtPoint(De,Xe);else{const en=Ft.zoomScale(Ft.zoom-w),zt=H>w?Math.min(2,ke):Math.max(.5,ke),Ht=Math.pow(zt,1-cn),En=Ft.unproject(Ee.add(Se.mult(cn*Ht)).mult(en));Ft.setLocationAtPoint(Ft.renderWorldCopies?En.wrap():En,me)}return i.preloadOnly||this._fireMoveEvents(l),Ft};if(i.preloadOnly){const Ft=this._emulate(_t,i.duration,y);return this._preloadTiles(Ft),this}const Mt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ut,this._rotating=st,this._pitching=wt,this._padding=gt,this._easeId=i.easeId,this._prepareEase(l,i.noMoveStart,Mt),this._ease(_t(y),Ft=>{y.cameraElevationReference==="sea"&&y.recenterOnTerrain(),this._afterEase(l,Ft)},i),this}_prepareEase(i,l,y={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),l||y.moving||this.fire(new t.z("movestart",i)),this._zooming&&!y.zooming&&this.fire(new t.z("zoomstart",i)),this._rotating&&!y.rotating&&this.fire(new t.z("rotatestart",i)),this._pitching&&!y.pitching&&this.fire(new t.z("pitchstart",i))}_fireMoveEvents(i){this.fire(new t.z("move",i)),this._zooming&&this.fire(new t.z("zoom",i)),this._rotating&&this.fire(new t.z("rotate",i)),this._pitching&&this.fire(new t.z("pitch",i))}_afterEase(i,l){if(this._easeId&&l&&this._easeId===l)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const y=this._zooming,w=this._rotating,M=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,y&&this.fire(new t.z("zoomend",i)),w&&this.fire(new t.z("rotateend",i)),M&&this.fire(new t.z("pitchend",i)),this.fire(new t.z("moveend",i))}flyTo(i,l){if(this._prefersReducedMotion(i)){const dn=t.ay(i,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(dn,l)}this.stop(),i=t.l({offset:[0,0],speed:1.2,curve:1.42,easing:t.dA},i);const y=this.transform,w=this.getZoom(),M=this.getBearing(),A=this.getPitch(),V=this.getPadding(),H="zoom"in i?t.aw(+i.zoom,y.minZoom,y.maxZoom):w,K="bearing"in i?this._normalizeBearing(i.bearing,M):M,ee="pitch"in i?+i.pitch:A,se=this._extendPadding(i.padding),le=y.zoomScale(H-w),me=t.P.convert(i.offset);let Ee=y.centerPoint.add(me);const Se=y.pointLocation(Ee),ke=t.bO.convert(i.center||Se);this._normalizeCenter(ke);const De=y.project(Se),Xe=y.project(ke).sub(De);let ut=i.curve;const st=Math.max(y.width,y.height),wt=st/le,gt=Xe.mag();if("minZoom"in i){const dn=t.aw(Math.min(i.minZoom,w,H),y.minZoom,y.maxZoom),Jn=st/y.zoomScale(dn-w);ut=Math.sqrt(Jn/gt*2)}const vt=ut*ut;function _t(dn){const Jn=(wt*wt-st*st+(dn?-1:1)*vt*vt*gt*gt)/(2*(dn?wt:st)*vt*gt);return Math.log(Math.sqrt(Jn*Jn+1)-Jn)}function Mt(dn){return(Math.exp(dn)-Math.exp(-dn))/2}function Ft(dn){return(Math.exp(dn)+Math.exp(-dn))/2}const cn=_t(0);let en=function(dn){return Ft(cn)/Ft(cn+ut*dn)},zt=function(dn){return st*((Ft(cn)*(Mt(Jn=cn+ut*dn)/Ft(Jn))-Mt(cn))/vt)/gt;var Jn},Ht=(_t(1)-cn)/ut;if(Math.abs(gt)<1e-6||!isFinite(Ht)){if(Math.abs(st-wt)<1e-6)return this.easeTo(i,l);const dn=wt<st?-1:1;Ht=Math.abs(Math.log(wt/st))/ut,zt=function(){return 0},en=function(Jn){return Math.exp(dn*ut*Jn)}}i.duration="duration"in i?+i.duration:1e3*Ht/("screenSpeed"in i?+i.screenSpeed/ut:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);const En=M!==K,Vn=ee!==A,ti=!y.isPaddingEqual(se),Qt=i.retainPadding===!1?y.clone():y,An=dn=>Jn=>{const Fn=Jn*Ht,wn=1/en(Fn);dn.zoom=Jn===1?H:w+dn.scaleZoom(wn),En&&(dn.bearing=t.af(M,K,Jn)),Vn&&(dn.pitch=t.af(A,ee,Jn)),ti&&(Qt.interpolatePadding(V,se,Jn),Ee=Qt.centerPoint.add(me));const Mi=Jn===1?ke:dn.unproject(De.add(Xe.mult(zt(Fn))).mult(wn));return dn.setLocationAtPoint(dn.renderWorldCopies?Mi.wrap():Mi,Ee),dn._updateCameraOnTerrain(),i.preloadOnly||this._fireMoveEvents(l),dn};if(i.preloadOnly){const dn=this._emulate(An,i.duration,y);return this._preloadTiles(dn),this}return this._zooming=!0,this._rotating=En,this._pitching=Vn,this._padding=ti,this._prepareEase(l,!1),this._ease(An(y),()=>this._afterEase(l),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(i){}_cancelRenderFrame(i){}_stop(i,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const y=this._onEaseEnd;this._onEaseEnd=void 0,y.call(this,l)}if(!i){const y=this.handlers;y&&y.stop(!1)}return this}_ease(i,l,y){y.animate===!1||y.duration===0?(i(1),l()):(this._easeStart=t.q.now(),this._easeOptions=y,this._onEaseFrame=i,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((t.q.now()-this._easeStart)/this._easeOptions.duration,1),l=this._onEaseFrame;l&&l(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,l){i=t.bF(i,-180,180);const y=Math.abs(i-l);return Math.abs(i-360-l)<y&&(i-=360),Math.abs(i+360-l)<y&&(i+=360),i}_normalizeCenter(i){const l=this.transform;if(l.maxBounds||l.projection.name!=="globe"&&!l.renderWorldCopies)return;const y=i.lng-l.center.lng;i.lng+=y>180?-360:y<-180?360:0}_prefersReducedMotion(i){return this._respectPrefersReducedMotion&&t.q.prefersReducedMotion&&!(i&&i.essential)}_emulate(i,l,y){const w=Math.ceil(15*l/1e3),M=[],A=i(y.clone());for(let V=0;V<=w;V++){const H=A(V/w);M.push(H.clone())}return M}_preloadTiles(i,l){}}class qg{constructor(i={}){this.options=i,t.aP(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){const l=this.options&&this.options.compact,y=i._getUIString("AttributionControl.ToggleAttribution");this._map=i,this._container=ie("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ie("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",y);const w=ie("span","mapboxgl-ctrl-icon",this._compactButton);return w.setAttribute("aria-hidden","true"),w.setAttribute("title",y),this._innerContainer=ie("div","mapboxgl-ctrl-attrib-inner",this._container),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),l===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));const l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||t.e.ACCESS_TOKEN}];if(i){const y=l.reduce((w,M,A)=>(M.value&&(w+=`${M.key}=${M.value}${A<l.length-1?"&":""}`),w),"?");i.href=`${t.e.FEEDBACK_URL}/${y}#${al(this._map,!0)}`,i.rel="noopener nofollow"}}_updateData(i){!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){const w=this._map.style.stylesheet;this.styleOwner=w.owner,this.styleId=w.id}const l=this._map.style._mergedSourceCaches;for(const w in l){const M=l[w];if(M.used){const A=M.getSource();A.attribution&&i.indexOf(A.attribution)<0&&i.push(A.attribution)}}i.sort((w,M)=>w.length-M.length),i=i.filter((w,M)=>{for(let A=M+1;A<i.length;A++)if(i[A].indexOf(w)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));const y=i.join(" | ");y!==this._attribHTML&&(this._attribHTML=y,i.length?(this._innerContainer.innerHTML=y,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Sc{constructor(){t.aP(["_updateLogo","_updateCompact"],this)}onAdd(i){this._map=i,this._container=ie("div","mapboxgl-ctrl");const l=ie("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&i.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const i=this._map.style._sourceCaches;if(Object.entries(i).length===0)return!0;for(const l in i){const y=i[l].getSource();if(y.hasOwnProperty("mapbox_logo")&&!y.mapbox_logo)return!1}return!0}_updateCompact(){const i=this._container.children;if(i.length){const l=i[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class Id{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const l=++this._id;return this._queue.push({callback:i,id:l,cancelled:!1}),l}remove(i){const l=this._currentlyRunning,y=l?this._queue.concat(l):this._queue;for(const w of y)if(w.id===i)return void(w.cancelled=!0)}run(i=0){const l=this._currentlyRunning=this._queue;this._queue=[];for(const y of l)if(!y.cancelled&&(y.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class qc{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;const l=t.cB((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,l,y){this._start=this.getValue(l),this._end=i,this._startTime=l,this._endTime=l+y}}const Hc={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},wp=["mouseenter","mouseover","mouseleave","mouseout"];class Pd extends t.z{constructor(i,l,y,w){const{point:M,lngLat:A,originalEvent:V,target:H}=i;super(i.type,{point:M,lngLat:A,originalEvent:V,target:H}),this.preventDefault=()=>{i.preventDefault()},this.id=l,this.interaction=y,this.feature=w}}class Sp{constructor(i){this.map=i,this.interactionsByType=new Map,this.typeById=new Map,this.filters=new Map,this.delegatedHandlers=new Map,this.handleType=this.handleType.bind(this)}add(i,l){if(this.typeById.has(i))throw new Error(`Interaction id "${i}" already exists.`);const{type:y,filter:w}=l;w&&this.filters.set(i,t.aZ(w));const M=this.interactionsByType.get(y)||new Map;if(M.size===0){if(wp.includes(y)){const{mousemove:A,mouseout:V}=this._createDelegatedHandlers(i,l);this.map.on("mousemove",A),this.map.on("mouseout",V),this.delegatedHandlers.set(i,{mousemove:A,mouseout:V})}else this.map.on(y,this.handleType);this.interactionsByType.set(y,M)}M.set(i,l),this.typeById.set(i,y)}get(i){const l=this.typeById.get(i);if(!l)return;const y=this.interactionsByType.get(l);return y?y.get(i):void 0}remove(i){const l=this.typeById.get(i);if(!l)return;this.typeById.delete(i),this.filters.delete(i);const y=this.interactionsByType.get(l);if(y){if(y.delete(i),this.delegatedHandlers.has(i)){const{mousemove:w,mouseout:M}=this.delegatedHandlers.get(i);this.map.off("mousemove",w),this.map.off("mouseout",M),this.delegatedHandlers.delete(i)}y.size===0&&this.map.off(l,this.handleType)}}queryTargets(i,l){const y=[];for(const[w,M]of l)M.target&&y.push({targetId:w,target:M.target,filter:this.filters.get(w)});return this.map.style.queryRenderedTargets(i,y,this.map.transform)}handleType(i,l){const y=this.interactionsByType.get(i.type),w=Array.from(y).reverse();l=l||this.queryTargets(i.point,w);let M=!1;for(const A of l){for(const[V,H]of w){if(!H.target)continue;const K=A.variants?A.variants[V]:null;if(K){for(const ee of K){const se=new t.cw(A,ee);if(H.handler(new Pd(i,V,H,se))!==!1){M=!0;break}}if(M)break}}if(M)break}if(!M)for(const[A,V]of w){const{handler:H,target:K}=V;if(!K&&H(new Pd(i,A,V,null))!==!1)break}}_createDelegatedHandlers(i,l){switch(l.type){case"mouseenter":case"mouseover":{let y=!1,w=new Set;return{mousemove:M=>{const A=this.queryTargets(M.point,[[i,l]]),V=new Set;if(!A.length)return y=!1,void w.clear();const H=[];for(const K of A)w.has(K.id)||(V.add(K.id),H.push(K));y&&!H.length||(y=!0,w=V,M.type=l.type,this.handleType(M,H))},mouseout:()=>{y=!1,w.clear()}}}case"mouseleave":case"mouseout":{let y=[];return{mousemove:w=>{const M=this.queryTargets(w.point,[[i,l]]);if(!M.length)return w.type=l.type,this.handleType(w,y),void(y=M);const A=[],V=new Set(M.map(H=>H.id));for(const H of y)V.has(H.id)||A.push(H);A.length&&(w.type=l.type,this.handleType(w,A)),y=M},mouseout:w=>{y.length&&(w.type=l.type,this.handleType(w,y),y=[])}}}}}}function Hg(_,i){if(Array.isArray(_)&&Array.isArray(i)){const l=new Set(_),y=new Set(i);return l.size===y.size&&_.every(w=>y.has(w))}return t.bn(_,i)}const Kr={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},lh={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ev{constructor(i,l,y=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new sm({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,y&&(this.mousePitch=new _p({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),t.aP(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(i,l){this.mouseRotate.mousedown(i,l),this.mousePitch&&this.mousePitch.mousedown(i,l),Le()}move(i,l){const y=this.map,w=this.mouseRotate.mousemoveWindow(i,l),M=w&&w.bearingDelta;if(M&&y.setBearing(y.getBearing()+M),this.mousePitch){const A=this.mousePitch.mousemoveWindow(i,l),V=A&&A.pitchDelta;V&&y.setPitch(y.getPitch()+V)}}off(){const i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart,{passive:!1}),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Oe(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(t.l({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),qe(this.element,i)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,qe(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=He(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){i.targetTouches.length!==1?this.reset():(this._lastPos=He(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Zg(_,i,l){if(_=new t.bO(_.lng,_.lat),i){const y=new t.bO(_.lng-360,_.lat),w=new t.bO(_.lng+360,_.lat),M=360*Math.ceil(Math.abs(_.lng-l.center.lng)/360),A=l.locationPoint(_).distSqr(i),V=i.x<0||i.y<0||i.x>l.width||i.y>l.height;l.locationPoint(y).distSqr(i)<A&&(V||Math.abs(y.lng-l.center.lng)<M)?_=y:l.locationPoint(w).distSqr(i)<A&&(V||Math.abs(w.lng-l.center.lng)<M)&&(_=w)}for(;Math.abs(_.lng-l.center.lng)>180;){const y=l.locationPoint(_);if(y.x>=0&&y.y>=0&&y.x<=l.width&&y.y<=l.height)break;_.lng>l.center.lng?_.lng-=360:_.lng+=360}return _}const zh={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class ch extends t.E{constructor(i,l){if(super(),(i instanceof HTMLElement||l)&&(i=t.l({element:i},l)),t.aP(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=i&&i.occludedOpacity||.2,i&&i.element)this._element=i.element,this._offset=t.P.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=ie("div");const M=41,A=27,V=pe("svg",{display:"block",height:M*this._scale+"px",width:A*this._scale+"px",viewBox:`0 0 ${A} ${M}`},this._element),H=pe("radialGradient",{id:"shadowGradient"},pe("defs",{},V));pe("stop",{offset:"10%","stop-opacity":.4},H),pe("stop",{offset:"100%","stop-opacity":.05},H),pe("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},V),pe("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},V),pe("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},V),pe("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},V),this._offset=t.P.convert(i&&i.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",M=>{M.preventDefault()}),this._element.addEventListener("mousedown",M=>{M.preventDefault()});const y=this._element.classList;for(const M in zh)y.remove(`mapboxgl-marker-anchor-${M}`);y.add(`mapboxgl-marker-anchor-${this._anchor}`);const w=i&&i.className?i.className.trim().split(/\s+/):[];y.add(...w),this._popup=null}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),i.on("click",this._onMapClick)),this}remove(){const i=this._map;return i&&(i.off("click",this._onMapClick),i.off("move",this._updateMoving),i.off("moveend",this._update),i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler),i.off("mouseup",this._onUp),i.off("touchend",this._onUp),i.off("mousemove",this._onMove),i.off("touchmove",this._onMove),i.off("remove",this._clearFadeTimer),i._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=t.bO.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const w=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[w,-1*(38.1-13.5+w)],"bottom-right":[-w,-1*(38.1-13.5+w)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,i._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){const l=i.code,y=i.charCode||i.keyCode;l!=="Space"&&l!=="Enter"&&y!==32&&y!==13||this.togglePopup()}_onMapClick(i){const l=i.originalEvent.target,y=this._element;this._popup&&(l===y||y.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const i=this._map,l=this._pos;if(!i||!l)return!1;const y=i.unproject(l),w=i.getFreeCameraOptions();if(!w.position)return!1;const M=w.position.toLngLat();return M.distanceTo(y)<.9*M.distanceTo(this._lngLat)}_evaluateOpacity(){const i=this._map;if(!i)return;const l=this._pos;if(!l||l.x<0||l.x>i.transform.width||l.y<0||l.y>i.transform.height)return void this._clearFadeTimer();const y=i.unproject(l);let w;i._showingGlobe()&&t.dH(i.transform,this._lngLat)?w=0:(w=1-i._queryFogOpacity(y),i.transform._terrainEnabled()&&i.getTerrain()&&this._behindTerrain()&&(w*=this._occludedOpacity)),this._element.style.opacity=`${w}`,this._element.style.pointerEvents=w>0?"auto":"none",this._popup&&this._popup._setOpacity(w),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const i=this._pos;if(!i||!this._map)return;const l=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${i.x}px,${i.y}px)
            ${zh[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${l.x}px,${l.y}px)
        `}_calculateXYTransform(){const i=this._pos,l=this._map,y=this.getPitchAlignment();if(!l||!i||y!=="map")return"";if(!l._showingGlobe()){const H=l.getPitch();return H?`rotateX(${H}deg)`:""}const w=t.c4(t.dI(l.transform,this._lngLat)),M=i.sub(t.dJ(l.transform)),A=Math.abs(M.x)+Math.abs(M.y);if(A===0)return"";const V=w/A;return`rotateX(${-M.y*V}deg) rotateY(${M.x*V}deg)`}_calculateZTransform(){const i=this._pos,l=this._map;if(!l||!i)return"";let y=0;const w=this.getRotationAlignment();if(w==="map")if(l._showingGlobe()){const M=l.project(new t.bO(this._lngLat.lng,this._lngLat.lat+.001)),A=l.project(new t.bO(this._lngLat.lng,this._lngLat.lat-.001)).sub(M);y=t.c4(Math.atan2(A.y,A.x))-90}else y=-l.getBearing();else if(w==="horizon"){const M=t.ac(4,6,l.getZoom()),A=t.dJ(l.transform);A.y+=M*l.transform.height;const V=i.sub(A),H=t.c4(Math.atan2(V.y,V.x));y=(H>90?H-270:H+90)*(1-M)}return y+=this._rotation,y?`rotateZ(${y}deg)`:""}_update(i){cancelAnimationFrame(this._updateFrameId);const l=this._map;l&&(l.transform.renderWorldCopies&&(this._lngLat=Zg(this._lngLat,this._pos,l.transform)),this._pos=l.project(this._lngLat),i===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),l._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(l._showingGlobe()||l.getTerrain()||l.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(i){return this._offset=t.P.convert(i),this._update(),this}addClassName(i){return this._element.classList.add(i),this}removeClassName(i){return this._element.classList.remove(i),this}toggleClassName(i){return this._element.classList.toggle(i)}_onMove(i){const l=this._map;if(!l)return;const y=this._pointerdownPos,w=this._positionDelta;if(y&&w){if(!this._isDragging){const M=this._clickTolerance||l._clickTolerance;if(i.point.dist(y)<M)return;this._isDragging=!0}this._pos=i.point.sub(w),this._lngLat=l.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new t.z("dragstart"))),this.fire(new t.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const i=this._map;i&&(i.off("mousemove",this._onMove),i.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new t.z("dragend")),this._state="inactive"}_addDragHandler(i){const l=this._map,y=this._pos;l&&y&&this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(y),this._pointerdownPos=i.point,this._state="pending",l.on("mousemove",this._onMove),l.on("touchmove",this._onMove),l.once("mouseup",this._onUp),l.once("touchend",this._onUp))}setDraggable(i){this._draggable=!!i;const l=this._map;return l&&(i?(l.on("mousedown",this._addDragHandler),l.on("touchstart",this._addDragHandler)):(l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(i){return this._occludedOpacity=i||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Ga={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},ao={maxWidth:100,unit:"metric"},Nl={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Ws={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},um=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function xo(_=new t.P(0,0),i="bottom"){if(typeof _=="number"){const l=Math.round(Math.sqrt(.5*Math.pow(_,2)));switch(i){case"top":return new t.P(0,_);case"top-left":return new t.P(l,l);case"top-right":return new t.P(-l,l);case"bottom":return new t.P(0,-_);case"bottom-left":return new t.P(l,-l);case"bottom-right":return new t.P(-l,-l);case"left":return new t.P(_,0);case"right":return new t.P(-_,0)}return new t.P(0,0)}return _ instanceof t.P||Array.isArray(_)?t.P.convert(_):t.P.convert(_[i]||[0,0])}return{version:G,supported:ce.supported,setRTLTextPlugin:t.dK,getRTLTextPluginStatus:t.dL,Map:class extends Km{constructor(_){Y.mark(W.create);const i=_;if((_=t.l({},Kr,_)).minZoom!=null&&_.maxZoom!=null&&_.minZoom>_.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(_.minPitch!=null&&_.maxPitch!=null&&_.minPitch>_.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(_.minPitch!=null&&_.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(_.maxPitch!=null&&_.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(_.antialias&&t.dF(window)&&(_.antialias=!1,t.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new wh(_.minZoom,_.maxZoom,_.minPitch,_.maxPitch,_.renderWorldCopies),_),this._repaint=!!_.repaint,this._interactive=_.interactive,this._minTileCacheSize=_.minTileCacheSize,this._maxTileCacheSize=_.maxTileCacheSize,this._failIfMajorPerformanceCaveat=_.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=_.preserveDrawingBuffer,this._antialias=_.antialias,this._trackResize=_.trackResize,this._bearingSnap=_.bearingSnap,this._refreshExpiredTiles=_.refreshExpiredTiles,this._fadeDuration=_.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=_.crossSourceCollisions,this._collectResourceTiming=_.collectResourceTiming,this._language=this._parseLanguage(_.language),this._worldview=_.worldview,this._renderTaskQueue=new Id,this._domRenderTaskQueue=new Id,this._controls=[],this._markers=[],this._popups=[],this._mapId=t.aV(),this._locale=t.l({},Hc,_.locale),this._clickTolerance=_.clickTolerance,this._cooperativeGestures=_.cooperativeGestures,this._performanceMetricsCollection=_.performanceMetricsCollection,this._tessellationStep=_.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=_.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new qc(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=_.scaleFactor,this._requestManager=new hn(_.transformRequest,_.accessToken,_.testMode),this._silenceAuthErrors=!!_.testMode,this._contextCreateOptions=_.contextCreateOptions?{..._.contextCreateOptions}:{},typeof _.container=="string"){const l=document.getElementById(_.container);if(!l)throw new Error(`Container '${_.container.toString()}' not found.`);this._container=l}else{if(!(_.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=_.container}if(this._container.childNodes.length>0&&t.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),_.maxBounds&&this.setMaxBounds(_.maxBounds),this._spriteFormat=_.spriteFormat,t.aP(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Ha),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new yl(this,_),this._localFontFamily=_.localFontFamily,this._localIdeographFontFamily=_.localIdeographFontFamily,(_.style||!_.testMode)&&this.setStyle(_.style||t.e.DEFAULT_STYLE,{config:_.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),_.projection&&this.setProjection(_.projection),this.indoor=new Kd(this),_.hash&&(this._hash=new gl(typeof _.hash=="string"&&_.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){i.center==null&&i.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:_.center,zoom:_.zoom,bearing:_.bearing,pitch:_.pitch});const l=_.bounds;l&&(this.resize(),this.fitBounds(l,t.l({},_.fitBoundsOptions,{duration:0})))}this.resize(),_.attributionControl&&this.addControl(new qg({customAttribution:_.customAttribution})),this._logoControl=new Sc,this.addControl(this._logoControl,_.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",l=>{this._update(l.dataType==="style"),this.fire(new t.z(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new t.z(`${l.dataType}dataloading`,l))}),this._interactions=new Sp(this)}_getMapId(){return this._mapId}addControl(_,i){if(i===void 0&&(i=_.getDefaultPosition?_.getDefaultPosition():"top-right"),!_||!_.onAdd)return this.fire(new t.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=_.onAdd(this);this._controls.push(_);const y=this._controlPositions[i];return i.indexOf("bottom")!==-1?y.insertBefore(l,y.firstChild):y.appendChild(l),this}removeControl(_){if(!_||!_.onRemove)return this.fire(new t.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(_);return i>-1&&this._controls.splice(i,1),_.onRemove(this),this}hasControl(_){return this._controls.indexOf(_)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(_){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new t.z("movestart",_)).fire(new t.z("move",_)),this.fire(new t.z("resize",_)),i&&this.fire(new t.z("moveend",_)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(_){return this.transform.setMaxBounds(t.az.convert(_)),this._update()}setMinZoom(_){if((_=_??-2)>=-2&&_<=this.transform.maxZoom)return this.transform.minZoom=_,this._update(),this.getZoom()<_?this.setZoom(_):this.fire(new t.z("zoomstart")).fire(new t.z("zoom")).fire(new t.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(_){if((_=_??22)>=this.transform.minZoom)return this.transform.maxZoom=_,this._update(),this.getZoom()>_?this.setZoom(_):this.fire(new t.z("zoomstart")).fire(new t.z("zoom")).fire(new t.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(_){if((_=_??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(_>=0&&_<=this.transform.maxPitch)return this.transform.minPitch=_,this._update(),this.getPitch()<_?this.setPitch(_):this.fire(new t.z("pitchstart")).fire(new t.z("pitch")).fire(new t.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(_){if((_=_??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(_>=this.transform.minPitch)return this.transform.maxPitch=_,this._update(),this.getPitch()>_?this.setPitch(_):this.fire(new t.z("pitchstart")).fire(new t.z("pitch")).fire(new t.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(_){return this._scaleFactor=_,this.painter.scaleFactor=_,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(i=>i.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(_){return this.transform.renderWorldCopies=_,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(_){return _==="auto"?navigator.language:Array.isArray(_)?_.length===0?void 0:_.map(i=>i==="auto"?navigator.language:i):_}setLanguage(_){const i=this._parseLanguage(_);if(!this.style||i===this._language)return this;this._language=i,this.style.reloadSources();for(const l of this._controls)l._setLanguage&&l._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(_){return this.style&&_!==this._worldview?(this._worldview=_,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(_){return this._lazyInitEmptyStyle(),_?typeof _=="string"&&(_={name:_}):_=null,this._useExplicitProjection=!!_,this._prioritizeAndUpdateProjection(_,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const _=this.transform,i=_.projection.name;let l;i==="globe"&&_.zoom>=t.bY?(_.setMercatorFromTransition(),l=!0):i==="mercator"&&_.zoom<t.bY&&(_.setProjection({name:"globe"}),l=!0),l&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(_,i){return this._updateProjection(_||i||{name:"mercator"})}_updateProjection(_){let i;return i=_.name==="globe"&&this.transform.zoom>=t.bY?this.transform.setMercatorFromTransition():this.transform.setProjection(_),this.style.applyProjectionUpdate(),i&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(_){return this.transform.locationPoint3D(t.bO.convert(_))}unproject(_){return this.transform.pointLocation3D(t.P.convert(_))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(_,i,l){const y=w=>{let M=[];if(Array.isArray(i)){const A=i.filter(V=>this.getLayer(V));M=A.length?this.queryRenderedFeatures(w,{layers:A}):[]}else M=this.queryRenderedFeatures(w,{target:i});return M};if(_==="mouseenter"||_==="mouseover"){let w=!1;return{listener:l,targets:i,delegates:{mousemove:A=>{const V=y(A.point);V.length?w||(w=!0,l.call(this,new sl(_,this,A.originalEvent,{features:V}))):w=!1},mouseout:()=>{w=!1}}}}if(_==="mouseleave"||_==="mouseout"){let w=!1;return{listener:l,targets:i,delegates:{mousemove:V=>{y(V.point).length?w=!0:w&&(w=!1,l.call(this,new sl(_,this,V.originalEvent)))},mouseout:V=>{w&&(w=!1,l.call(this,new sl(_,this,V.originalEvent)))}}}}{const w=M=>{const A=y(M.point);A.length&&(M.features=A,l.call(this,M),delete M.features)};return{listener:l,targets:i,delegates:{[_]:w}}}}on(_,i,l){if(typeof i=="function"||l===void 0)return super.on(_,i);if(typeof i=="string"&&(i=[i]),!this._areTargetsValid(i))return this;const y=this._createDelegatedListener(_,i,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[_]=this._delegatedListeners[_]||[],this._delegatedListeners[_].push(y);for(const w in y.delegates)this.on(w,y.delegates[w]);return this}once(_,i,l){if(typeof i=="function"||l===void 0)return super.once(_,i);if(typeof i=="string"&&(i=[i]),!this._areTargetsValid(i))return this;const y=this._createDelegatedListener(_,i,l);for(const w in y.delegates)this.once(w,y.delegates[w]);return this}off(_,i,l){if(typeof i=="function"||l===void 0)return super.off(_,i);if(typeof i=="string"&&(i=[i]),!this._areTargetsValid(i))return this;const y=this._delegatedListeners?this._delegatedListeners[_]:void 0;return y&&(w=>{for(let M=0;M<w.length;M++){const A=w[M];if(A.listener===l&&Hg(A.targets,i)){for(const V in A.delegates)this.off(V,A.delegates[V]);return w.splice(M,1),this}}})(y),this}queryRenderedFeatures(_,i){if(!this.style)return[];if(_===void 0||_ instanceof t.P||Array.isArray(_)||i!==void 0||(i=_,_=void 0),_=_||[[0,0],[this.transform.width,this.transform.height]],!i){const M=this.style.queryRenderedFeatures(_,void 0,this.transform),A=this.style.queryRenderedFeatureset(_,void 0,this.transform);return M.concat(A)}let l=!0;if(i.target&&(l=this._isTargetValid(i.target),l&&!i.layers))return this.style.queryRenderedFeatureset(_,i,this.transform);let y=!0;if(i.layers&&Array.isArray(i.layers)){for(const M of i.layers)if(!this._isValidId(M)){y=!1;break}if(y&&!i.target)return this.style.queryRenderedFeatures(_,i,this.transform)}let w=[];return y&&(w=w.concat(this.style.queryRenderedFeatures(_,i,this.transform))),l&&(w=w.concat(this.style.queryRenderedFeatureset(_,i,this.transform))),w}querySourceFeatures(_,i){return!_||typeof _=="string"&&!this._isValidId(_)?[]:this.style.querySourceFeatures(_,i)}isPointOnSurface(_){const{name:i}=this.transform.projection;return i!=="globe"&&i!=="mercator"&&t.w(`${i} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(t.P.convert(_))}addInteraction(_,i){return this._interactions.add(_,i),this}removeInteraction(_){return this._interactions.remove(_),this}setStyle(_,i){return i=t.l({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i),this.style&&_&&i.diff!==!1&&i.localFontFamily===this._localFontFamily&&i.localIdeographFontFamily===this._localIdeographFontFamily&&!i.config?(this.style._diffStyle(_,(l,y)=>{l?(t.w(`Unable to perform style diff: ${String(l.message||l.error||l)}. Rebuilding the style from scratch.`),this._updateStyle(_,i)):y&&this._update(!0)},()=>{this._postStyleLoadEvent()}),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(_,i))}_getUIString(_){const i=this._locale[_];if(i==null)throw new Error(`Missing UI string '${_}'`);return i}_updateStyle(_,i){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),_){const l=t.l({},i);i&&i.config&&(l.initialConfig=i.config,delete l.config),this.style=new Do(this,l).load(_),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Do(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(t.w("There is no style added to the map."),!1)}_isValidId(_){return _==null?(this.fire(new t.y(new Error("IDs can't be empty."))),!1):!t.cr(_)||(this.fire(new t.y(new Error(`IDs can't contain special symbols: "${_}".`))),!1)}_isTargetValid(_){return"featuresetId"in _?this._isValidId("importId"in _?_.importId:_.featuresetId):"layerId"in _&&this._isValidId(_.layerId)}_areTargetsValid(_){if(Array.isArray(_)){for(const i of _)if(!this._isValidId(i))return!1;return!0}return this._isTargetValid(_)}addSource(_,i){return this._isValidId(_)?(this._lazyInitEmptyStyle(),this.style.addSource(_,i),this._update(!0)):this}isSourceLoaded(_){return!!this._isValidId(_)&&!!this.style&&this.style._isSourceCacheLoaded(_)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(_,i,l){this._lazyInitEmptyStyle(),this.style.addSourceType(_,i,l)}removeSource(_){return this._isValidId(_)?(this.style.removeSource(_),this._updateTerrain(),this._update(!0)):this}getSource(_){return this._isValidId(_)?this.style.getOwnSource(_):null}addImage(_,i,{pixelRatio:l=1,sdf:y=!1,stretchX:w,stretchY:M,content:A}={}){if(this._lazyInitEmptyStyle(),i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap){const{width:V,height:H,data:K}=t.q.getImageData(i);this.style.addImage(_,{data:new t.r({width:V,height:H},K),pixelRatio:l,stretchX:w,stretchY:M,content:A,sdf:y,version:0,usvg:!1})}else if(i.width===void 0||i.height===void 0)this.fire(new t.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:V,height:H}=i,K=i;this.style.addImage(_,{data:new t.r({width:V,height:H},new Uint8Array(K.data)),pixelRatio:l,stretchX:w,stretchY:M,content:A,sdf:y,usvg:!1,version:0,userImage:K}),K.onAdd&&K.onAdd(this,_)}}updateImage(_,i){this._lazyInitEmptyStyle();const l=this.style.getImage(_);if(!l)return void this.fire(new t.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap?t.q.getImageData(i):i,{width:w,height:M,data:A}=y;if(w===void 0||M===void 0)return void this.fire(new t.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(w!==(l.usvg?l.icon.usvg_tree.width:l.data.width)||M!==(l.usvg?l.icon.usvg_tree.height:l.data.height))return void this.fire(new t.y(new Error(`The width and height of the updated image (${w}, ${M})
                must be that same as the previous version of the image
                (${l.data.width}, ${l.data.height})`)));const V=!(i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap);let H=!1;l.usvg?(l.data=new t.r({width:w,height:M},new Uint8Array(A)),l.usvg=!1,l.icon=void 0,H=!0):l.data.replace(A,V),this.style.updateImage(_,l,H)}hasImage(_){return _?!!this.style&&!!this.style.getImage(_):(this.fire(new t.y(new Error("Missing required image id"))),!1)}removeImage(_){this.style.removeImage(_)}loadImage(_,i){t.o(this._requestManager.transformRequest(_,t.R.Image),(l,y)=>{i(l,y instanceof HTMLImageElement?t.q.getImageData(y):y)})}listImages(){return this.style.listImages()}addModel(_,i){this._lazyInitEmptyStyle(),this.style.addModel(_,i)}hasModel(_){return _?this.style.hasModel(_):(this.fire(new t.y(new Error("Missing required model id"))),!1)}removeModel(_){this.style.removeModel(_)}listModels(){return this.style.listModels()}addLayer(_,i){return this._isValidId(_.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(_,i),this._update(!0)):this}getSlot(_){const i=this.getLayer(_);return i&&i.slot||null}setSlot(_,i){return this.style.setSlot(_,i),this.style.mergeLayers(),this._update(!0)}addImport(_,i){return this.style.addImport(_,i),this}updateImport(_,i){return typeof i!="string"&&i.id!==_?(this.removeImport(_),this.addImport(i)):(this.style.updateImport(_,i),this._update(!0))}removeImport(_){return this.style.removeImport(_),this}moveImport(_,i){return this.style.moveImport(_,i),this._update(!0)}moveLayer(_,i){return this._isValidId(_)?(this.style.moveLayer(_,i),this._update(!0)):this}removeLayer(_){return this._isValidId(_)?(this.style.removeLayer(_),this._update(!0)):this}getLayer(_){if(!this._isValidId(_))return null;const i=this.style.getOwnLayer(_);return i?i.type==="custom"?i.implementation:i.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(_,i,l){return this._isValidId(_)?(this.style.setLayerZoomRange(_,i,l),this._update(!0)):this}setFilter(_,i,l={}){return this._isValidId(_)?(this.style.setFilter(_,i,l),this._update(!0)):this}getFilter(_){return this._isValidId(_)?this.style.getFilter(_):null}setPaintProperty(_,i,l,y={}){return this._isValidId(_)?(this.style.setPaintProperty(_,i,l,y),this._update(!0)):this}getPaintProperty(_,i){return this._isValidId(_)?this.style.getPaintProperty(_,i):null}setLayoutProperty(_,i,l,y={}){return this._isValidId(_)?(this.style.setLayoutProperty(_,i,l,y),this._update(!0)):this}getLayoutProperty(_,i){return this._isValidId(_)?this.style.getLayoutProperty(_,i):null}getSchema(_){return this.style.getSchema(_)}setSchema(_,i){return this.style.setSchema(_,i),this._update(!0)}getConfig(_){return this.style.getConfig(_)}setConfig(_,i){return this.style.setConfig(_,i),this._update(!0)}getConfigProperty(_,i){return this.style.getConfigProperty(_,i)}setConfigProperty(_,i,l){return this.style.setConfigProperty(_,i,l),this._update(!0)}getFeaturesetDescriptors(_){return this.style.getFeaturesetDescriptors(_)}setLights(_){if(this._lazyInitEmptyStyle(),_&&_.length===1&&_[0].type==="flat"){const i=_[0];i.properties?this.style.setFlatLight(i.properties,i.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(_),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const _=this.style.getLights()||[];return _.length===0&&_.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),_}setLight(_,i={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:_}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(_){return this._lazyInitEmptyStyle(),!_&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(_),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(_){return this._lazyInitEmptyStyle(),this.style.setFog(_),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(_){return this._lazyInitEmptyStyle(),this.style.setSnow(_),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(_){return this._lazyInitEmptyStyle(),this.style.setRain(_),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(_){return this._lazyInitEmptyStyle(),this.style.setColorTheme(_),this._update(!0)}setImportColorTheme(_,i){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(_,i),this._update(!0)}setCamera(_){return this.style.setCamera(_),this._triggerCameraUpdate(_)}_triggerCameraUpdate(_){return this._update(this.transform.setOrthographicProjectionAtLowPitch(_["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(_){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(t.bO.convert(_),this.transform):0}setFeatureState(_,i){return _.source&&!this._isValidId(_.source)?this:(this.style.setFeatureState(_,i),this._update())}removeFeatureState(_,i){return _.source&&!this._isValidId(_.source)?this:(this.style.removeFeatureState(_,i),this._update())}getFeatureState(_){return _.source&&!this._isValidId(_.source)?null:this.style.getFeatureState(_)}_updateContainerDimensions(){if(!this._container)return;const _=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let l,y,w,M=this._container;for(;M&&(!y||!w);){const A=window.getComputedStyle(M).transform;A&&A!=="none"&&(l=A.match(/matrix.*\((.+)\)/)[1].split(", "),l[0]&&l[0]!=="0"&&l[0]!=="1"&&(y=l[0]),l[3]&&l[3]!=="0"&&l[3]!=="1"&&(w=l[3])),M=M.parentElement}this._containerWidth=y?Math.abs(_/y):_,this._containerHeight=w?Math.abs(i/w):i}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&t.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const _=this._container;_.classList.add("mapboxgl-map"),(this._missingCSSCanary=ie("div","mapboxgl-canary",_)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=ie("div","mapboxgl-canvas-container",_);this._canvas=ie("canvas","mapboxgl-canvas",i),this._interactive&&(i.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const l=this._controlContainer=ie("div","mapboxgl-control-container",_),y=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(w=>{y[w]=ie("div",`mapboxgl-ctrl-${w}`,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(_,i){const l=t.q.devicePixelRatio||1;this._canvas.width=l*Math.ceil(_),this._canvas.height=l*Math.ceil(i),this._canvas.style.width=`${_}px`,this._canvas.style.height=`${i}px`}_addMarker(_){this._markers.push(_)}_removeMarker(_){const i=this._markers.indexOf(_);i!==-1&&this._markers.splice(i,1)}_addPopup(_){this._popups.push(_)}_removePopup(_){const i=this._popups.indexOf(_);i!==-1&&this._popups.splice(i,1)}_setupPainter(){const _=t.l({},ce.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl2",_);i?(St(i,!0),this.painter=new ah(i,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp),this.on("data",l=>{l.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),t.m.testSupport(i)):this.fire(new t.y(new Error("Failed to initialize WebGL")))}_contextLost(_){_.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.z("webglcontextlost",{originalEvent:_}))}_contextRestored(_){this._setupPainter(),this.resize(),this._update(),this.fire(new t.z("webglcontextrestored",{originalEvent:_}))}_onMapScroll(_){if(_.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(_){return this.style?(this._styleDirty=this._styleDirty||_,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(_){return this._update(),this._renderTaskQueue.add(_)}_cancelRenderFrame(_){this._renderTaskQueue.remove(_)}_requestDomTask(_){!this.loaded()||this.loaded()&&!this.isMoving()?_():this._domRenderTaskQueue.add(_)}_render(_){let i;this.fire(new t.z("renderstart")),++this._frameId;const l=this.painter.context.extTimerQuery,y=t.q.now(),w=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(i=w.createQuery(),w.beginQuery(l.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(_),this._domRenderTaskQueue.run(_),this._removed)return;this._updateProjectionTransition();const M=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const K=this.transform.zoom,ee=this.transform.pitch,se=t.q.now(),le=new t.a8(K,{now:se,fadeDuration:M,pitch:ee,transition:this.style.transition});this.style.update(le)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let A=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),A=this._updateAverageElevation(y),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):A=this._updateAverageElevation(y);const V=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,M,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),V&&(this._placementDirty=V.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:M,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new t.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,Y.mark(W.load),this.fire(new t.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const K=t.q.now()-y;w.endQuery(l.TIME_ELAPSED_EXT),setTimeout(()=>{const ee=w.getQueryParameter(i,w.QUERY_RESULT)/1e6;w.deleteQuery(i),this.fire(new t.z("gpu-timing-frame",{cpuTime:K,gpuTime:ee}))},50)}if(this.listens("gpu-timing-layer")){const K=this.painter.collectGpuTimers();setTimeout(()=>{const ee=this.painter.queryGpuTimers(K);this.fire(new t.z("gpu-timing-layer",{layerTimes:ee}))},50)}if(this.listens("gpu-timing-deferred-render")){const K=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const ee=this.painter.queryGpuTimeDeferredRender(K);this.fire(new t.z("gpu-timing-deferred-render",{gpuTime:ee}))},50)}const H=this._sourcesDirty||this._styleDirty||this._placementDirty||A;if(H||this._repaint)this.triggerRepaint();else{const K=this.idle();if(K&&(A=this._updateAverageElevation(y,!0)),A)this.triggerRepaint();else if(this._triggerFrame(!1),K&&(this.fire(new t.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const ee=this._calculateSpeedIndex();this.fire(new t.z("speedindexcompleted",{speedIndex:ee})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||H||(this._fullyLoaded=!0,Y.mark(W.fullLoad),this._performanceMetricsCollection&&qn(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(_){for(const i of this._markers)_&&!this.getRenderWorldCopies()&&(i._lngLat=i._lngLat.wrap()),i._update();for(const i of this._popups)!_||this.getRenderWorldCopies()||i._trackPointer||(i._lngLat=i._lngLat.wrap()),i._update()}_updateAverageElevation(_,i=!1){const l=w=>(this.transform.averageElevation=w,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&l(0);const y=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(y||(i||_-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(_)){const w=this.transform.averageElevation;let M=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(M)?M=0:this._averageElevationLastSampledAt=_;const A=Math.abs(w-M);if(A>1){if(this._isInitialLoad||y)return this._averageElevation.jumpTo(M),l(M);this._averageElevation.easeTo(M,_,300)}else if(A>1e-4)return this._averageElevation.jumpTo(M),l(M)}return!!this._averageElevation.isEasing(_)&&l(this._averageElevation.getValue(_))}_authenticate(){ht(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,_=>{if(_&&(_.message===$t||_.status===401)){const i=this.painter.context.gl;St(i,!1),this._logoControl instanceof Sc&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new t.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Ci(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Ln(this._requestManager._customAccessToken,{map:this,skuToken:this._requestManager._skuToken,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const _=this._isDragging();this.painter.updateTerrain(this.style,_)}_calculateSpeedIndex(){const _=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());const l=this.painter.context.gl,y=l.createFramebuffer();function w(M){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,M,0);const A=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,A),A}return l.bindFramebuffer(l.FRAMEBUFFER,y),this._canvasPixelComparison(w(_),i.canvasCopies.map(w),i.timeStamps)}_canvasPixelComparison(_,i,l){let y=l[1]-l[0];const w=_.length/4;for(let M=0;M<i.length;M++){const A=i[M];let V=0;for(let H=0;H<A.length;H+=4)A[H]===_[H]&&A[H+1]===_[H+1]&&A[H+2]===_[H+2]&&A[H+3]===_[H+3]&&(V+=1);y+=(l[M+2]-l[M+1])*(1-V/w)}return y}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const _=this.painter.context.gl.getExtension("WEBGL_lose_context");_&&_.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Zn.delete(this.painter.context.gl),pi.remove(),Pn.remove(),this._removed=!0,this.fire(new t.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(_){this._renderNextFrame=this._renderNextFrame||_,this.style&&!this._frame&&(this._frame=t.q.frame(i=>{const l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(i)}))}_preloadTiles(_){const i=this.style?this.style.getSourceCaches():[];return t.bl(i,(l,y)=>l._preloadTiles(_,y),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(_){this._trackResize&&this.resize({originalEvent:_})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(_){this._showTileBoundaries!==_&&(this._showTileBoundaries=_,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(_){this._showParseStatus!==_&&(this._showParseStatus=_,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(_){this._showTerrainWireframe!==_&&(this._showTerrainWireframe=_,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(_){this._showLayers2DWireframe!==_&&(this._showLayers2DWireframe=_,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(_){this._showLayers3DWireframe!==_&&(this._showLayers3DWireframe=_,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(_){this._speedIndexTiming!==_&&(this._speedIndexTiming=_,this._update())}get showPadding(){return!!this._showPadding}set showPadding(_){this._showPadding!==_&&(this._showPadding=_,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(_){this._showCollisionBoxes!==_&&(this._showCollisionBoxes=_,this._tp.refreshUI(),_?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(_){this._showOverdrawInspector!==_&&(this._showOverdrawInspector=_,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(_){this._repaint!==_&&(this._repaint=_,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(_){this._vertices=_,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(_){this._showTileAABBs!==_&&(this._showTileAABBs=_,this._tp.refreshUI(),_&&this._update())}_setCacheLimits(_,i){t.dG(_,i)}get version(){return G}},NavigationControl:class{constructor(_={}){this.options=t.l({},lh,_),this._container=ie("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(t.aP(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>{this._map&&this._map.zoomIn({},{originalEvent:i})}),ie("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>{this._map&&this._map.zoomOut({},{originalEvent:i})}),ie("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(t.aP(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{const l=this._map;l&&(this.options.visualizePitch?l.resetNorthPitch({},{originalEvent:i}):l.resetNorth({},{originalEvent:i}))}),this._compassIcon=ie("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const _=this._map;if(!_)return;const i=_.getZoom(),l=i===_.getMaxZoom(),y=i===_.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=y,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",y.toString())}_rotateCompassArrow(){const _=this._map;if(!_)return;const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(_.transform.pitch*(Math.PI/180)),.5)}) rotateX(${_.transform.pitch}deg) rotateZ(${_.transform.angle*(180/Math.PI)}deg)`:`rotate(${_.transform.angle*(180/Math.PI)}deg)`;_._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=i)})}onAdd(_){return this._map=_,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),_.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&_.on("pitch",this._rotateCompassArrow),_.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ev(_,this._compass,this.options.visualizePitch)),this._container}onRemove(){const _=this._map;_&&(this._container.remove(),this.options.showZoom&&_.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&_.off("pitch",this._rotateCompassArrow),_.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(_,i){const l=ie("button",_,this._container);return l.type="button",l.addEventListener("click",i),l}_setButtonTitle(_,i){if(!this._map)return;const l=this._map._getUIString(`NavigationControl.${i}`);_.setAttribute("aria-label",l),_.firstElementChild&&_.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends t.E{constructor(_={}){super();const i=navigator.geolocation;this.options=t.l({geolocation:i},Ga,_),t.aP(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=yo(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(_){return this._map=_,this._container=ie("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(_){const i=(l=!!this.options.geolocation)=>{this._supportsGeolocation=l,_(l)};this._supportsGeolocation!==void 0?_(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(l=>i(l.state!=="denied")).catch(()=>i()):i()}_isOutOfMapMaxBounds(_){const i=this._map.getMaxBounds(),l=_.coords;return!!i&&(l.longitude<i.getWest()||l.longitude>i.getEast()||l.latitude<i.getSouth()||l.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(_){if(this._map){if(this._isOutOfMapMaxBounds(_))return this._setErrorState(),this.fire(new t.z("outofmaxbounds",_)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=_,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(_),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(_),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new t.z("geolocate",_)),this._finish()}}_updateCamera(_){const i=new t.bO(_.coords.longitude,_.coords.latitude),l=_.coords.accuracy,y=this._map.getBearing(),w=t.l({bearing:y},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(l),w,{geolocateSource:!0})}_updateMarker(_){if(_){const i=new t.bO(_.coords.longitude,_.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=_.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const _=this._map.transform,i=t.bH(1,_._center.lat)*_.worldSize,l=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(_){if(this._map){if(this.options.trackUserLocation)if(_.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(_.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new t.z("error",_)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(_){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=ie("button","mapboxgl-ctrl-geolocate",this._container),ie("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",_===!1){t.w("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ie("div","mapboxgl-user-location"),this._dotElement.appendChild(ie("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ie("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ch({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ie("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ch({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new t.z("trackuserlocationend")))})}}_onDeviceOrientation(_){this._userLocationDotMarker&&(_.webkitCompassHeading?this._heading=_.webkitCompassHeading:_.absolute===!0&&(this._heading=-1*_.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return t.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let _;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(_={maximumAge:6e5,timeout:0},this._noTimeout=!0):(_=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,_),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const _=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(i=>{i==="granted"&&_()}).catch(console.error):_()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:qg,ScaleControl:class{constructor(_={}){this.options=t.l({},ao,_),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),t.aP(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const _=this.options.maxWidth||100,i=this._map,l=i._containerHeight/2,y=i._containerWidth/2-_/2,w=i.unproject([y,l]),M=i.unproject([y+_,l]),A=w.distanceTo(M);if(this.options.unit==="imperial"){const V=3.2808*A;V>5280?this._setScale(_,V/5280,"mile"):this._setScale(_,V,"foot")}else this.options.unit==="nautical"?this._setScale(_,A/1852,"nautical-mile"):A>=1e3?this._setScale(_,A/1e3,"kilometer"):this._setScale(_,A,"meter")}_setScale(_,i,l){this._map._requestDomTask(()=>{const y=function(M){const A=Math.pow(10,`${Math.floor(M)}`.length-1);let V=M/A;return V=V>=10?10:V>=5?5:V>=3?3:V>=2?2:V>=1?1:function(H){const K=Math.pow(10,Math.ceil(-Math.log(H)/Math.LN10));return Math.round(H*K)/K}(V),A*V}(i),w=y/i;this._container.innerHTML=this._isNumberFormatSupported&&l!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:l}).format(y):`${y}&nbsp;${Nl[l]}`,this._container.style.width=_*w+"px"})}onAdd(_){return this._map=_,this._language=_.getLanguage(),this._container=ie("div","mapboxgl-ctrl mapboxgl-ctrl-scale",_.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(_){this._language=_,this._update()}setUnit(_){this.options.unit=_,this._update()}},FullscreenControl:class{constructor(_={}){this._fullscreen=!1,_&&_.container&&(_.container instanceof HTMLElement?this._container=_.container:t.w("Full screen control 'container' must be a DOM element.")),t.aP(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(_){return this._map=_,this._container||(this._container=this._map.getContainer()),this._controlContainer=ie("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",t.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const _=this._fullscreenButton=ie("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ie("span","mapboxgl-ctrl-icon",_).setAttribute("aria-hidden","true"),_.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const _=this._getTitle();this._fullscreenButton.setAttribute("aria-label",_),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",_)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends t.E{constructor(_){super(),this.options=t.l(Object.create(Ws),_),t.aP(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(_&&_.className?_.className.trim().split(/\s+/):[])}addTo(_){return this._map&&this.remove(),this._map=_,this.options.closeOnClick&&_.on("preclick",this._onClose),this.options.closeOnMove&&_.on("move",this._onClose),_.on("remove",this.remove),this._update(),_._addPopup(this),this._focusFirstElement(),this._trackPointer?(_.on("mousemove",this._onMouseEvent),_.on("mouseup",this._onMouseEvent),_._canvasContainer.classList.add("mapboxgl-track-pointer")):_.on("move",this._update),this.fire(new t.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const _=this._map;return _&&(_.off("move",this._update),_.off("move",this._onClose),_.off("preclick",this._onClose),_.off("click",this._onClose),_.off("remove",this.remove),_.off("mousemove",this._onMouseEvent),_.off("mouseup",this._onMouseEvent),_.off("drag",this._onMouseEvent),_._canvasContainer&&_._canvasContainer.classList.remove("mapboxgl-track-pointer"),_._removePopup(this),this._map=void 0),this.fire(new t.z("close")),this}getLngLat(){return this._lngLat}setLngLat(_){this._lngLat=t.bO.convert(_),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const _=this._map;return _&&(_.off("move",this._update),_.on("mousemove",this._onMouseEvent),_.on("drag",this._onMouseEvent),_._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(_){return this.setDOMContent(document.createTextNode(_))}setHTML(_){const i=document.createDocumentFragment(),l=document.createElement("body");let y;for(l.innerHTML=_;y=l.firstChild,y;)i.appendChild(y);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(_){return this.options.maxWidth=_,this._update(),this}setDOMContent(_){let i=this._content;if(i)for(;i.hasChildNodes();)i.firstChild&&i.removeChild(i.firstChild);else i=this._content=ie("div","mapboxgl-popup-content",this._container||void 0);if(i.appendChild(_),this.options.closeButton){const l=this._closeButton=ie("button","mapboxgl-popup-close-button",i);l.type="button",l.setAttribute("aria-label","Close popup"),l.setAttribute("aria-hidden","true"),l.innerHTML="&#215;",l.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(_){return this._classList.add(_),this._updateClassList(),this}removeClassName(_){return this._classList.delete(_),this._updateClassList(),this}setOffset(_){return this.options.offset=_,this._update(),this}toggleClassName(_){let i;return this._classList.delete(_)?i=!1:(this._classList.add(_),i=!0),this._updateClassList(),i}_onMouseEvent(_){this._update(_.point)}_getAnchor(_){if(this.options.anchor)return this.options.anchor;const i=this._map,l=this._container,y=this._pos;if(!i||!l||!y)return"bottom";const w=l.offsetWidth,M=l.offsetHeight,A=y.x<w/2,V=y.x>i.transform.width-w/2;if(y.y+_<M)return A?"top-left":V?"top-right":"top";if(y.y>i.transform.height-M){if(A)return"bottom-left";if(V)return"bottom-right"}return A?"left":V?"right":"bottom"}_updateClassList(){const _=this._container;if(!_)return;const i=[...this._classList];i.push("mapboxgl-popup"),this._anchor&&i.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&i.push("mapboxgl-popup-track-pointer"),_.className=i.join(" ")}_update(_){const i=this._map,l=this._content;if(!i||!this._lngLat&&!this._trackPointer||!l)return;let y=this._container;if(y||(y=this._container=ie("div","mapboxgl-popup",i.getContainer()),this._tip=ie("div","mapboxgl-popup-tip",y),y.appendChild(l)),this.options.maxWidth&&y.style.maxWidth!==this.options.maxWidth&&(y.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Zg(this._lngLat,this._pos,i.transform)),!this._trackPointer||_){const w=this._pos=this._trackPointer&&_ instanceof t.P?_:i.project(this._lngLat),M=xo(this.options.offset),A=this._anchor=this._getAnchor(M.y),V=xo(this.options.offset,A),H=w.add(V).round();i._requestDomTask(()=>{this._container&&A&&(this._container.style.transform=`${zh[A]} translate(${H.x}px,${H.y}px)`)})}if(!this._marker&&i._showingGlobe()){const w=t.dH(i.transform,this._lngLat)?0:1;this._setOpacity(w)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const _=this._container.querySelector(um);_&&_.focus()}_onClose(){this.remove()}_setOpacity(_){this._container&&(this._container.style.opacity=`${_}`),this._content&&(this._content.style.pointerEvents=_?"auto":"none")}},Marker:ch,Style:Do,LngLat:t.bO,LngLatBounds:t.az,Point:t.P,MercatorCoordinate:t.aa,FreeCameraOptions:$u,Evented:t.E,config:t.e,prewarm:t.dM,clearPrewarmedResources:t.dN,get accessToken(){return t.e.ACCESS_TOKEN},set accessToken(_){t.e.ACCESS_TOKEN=_},get baseApiUrl(){return t.e.API_URL},set baseApiUrl(_){t.e.API_URL=_},get workerCount(){return t.dO.workerCount},set workerCount(_){t.dO.workerCount=_},get maxParallelImageRequests(){return t.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(_){t.e.MAX_PARALLEL_IMAGE_REQUESTS=_},clearStorage(_){t.dP(_)},get workerUrl(){return t.dQ.workerUrl},set workerUrl(_){t.dQ.workerUrl=_},get workerClass(){return t.dQ.workerClass},set workerClass(_){t.dQ.workerClass=_},get workerParams(){return t.dQ.workerParams},set workerParams(_){t.dQ.workerParams=_},get dracoUrl(){return t.dR()},set dracoUrl(_){t.dS(_)},get meshoptUrl(){return t.dT()},set meshoptUrl(_){t.dU(_)},setNow:t.q.setNow,restoreNow:t.q.restoreNow}});var T=b;return T})}(o1)),o1.exports}var gC=eN();const kc=Z_(gC);var XS,CP;function mv(){if(CP)return XS;CP=1,XS=s;var e=Object.prototype.hasOwnProperty;function s(){for(var u={},d=0;d<arguments.length;d++){var b=arguments[d];for(var E in b)e.call(b,E)&&(u[E]=b[E])}return u}return XS}var YS={exports:{}},EP;function tN(){return EP||(EP=1,function(e,s){(function(){var u={};e.exports=u,u.simpleFilter=function(d,b){return b.filter(function(E){return u.test(d,E)})},u.test=function(d,b){return u.match(d,b)!==null},u.match=function(d,b,E){E=E||{};var T=0,t=[],G=b.length,W=0,Y=0,ne=E.pre||"",J=E.post||"",Q=E.caseSensitive&&b||b.toLowerCase(),ce;d=E.caseSensitive&&d||d.toLowerCase();for(var ie=0;ie<G;ie++)ce=b[ie],Q[ie]===d[T]?(ce=ne+ce+J,T+=1,Y+=1+Y):Y=0,W+=Y,t[t.length]=ce;return T===d.length?(W=Q===d?1/0:W,{rendered:t.join(""),score:W}):null},u.filter=function(d,b,E){return!b||b.length===0?[]:typeof d!="string"?b:(E=E||{},b.reduce(function(T,t,G,W){var Y=t;E.extract&&(Y=E.extract(t));var ne=u.match(d,Y,E);return ne!=null&&(T[T.length]={string:ne.rendered,score:ne.score,index:G,original:t}),T},[]).sort(function(T,t){var G=t.score-T.score;return G||T.index-t.index}))}})()}(YS)),YS.exports}var KS,MP;function nN(){if(MP)return KS;MP=1;var e=function(s){return this.component=s,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,s.el.parentNode.insertBefore(this.wrapper,s.el.nextSibling),this};return e.prototype.show=function(){this.element.style.display="block"},e.prototype.hide=function(){this.element.style.display="none"},e.prototype.add=function(s){this.items.push(s)},e.prototype.clear=function(){this.items=[],this.active=0},e.prototype.isEmpty=function(){return!this.items.length},e.prototype.isVisible=function(){return this.element.style.display==="block"},e.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var s=0;s<this.items.length;s++)this.drawItem(this.items[s],this.active===s);this.show()},e.prototype.drawItem=function(s,u){var d=document.createElement("li"),b=document.createElement("a");u&&(d.className+=" active"),b.innerHTML=s.string,d.appendChild(b),this.element.appendChild(d),d.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),d.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,s)}).bind(this))},e.prototype.handleMouseUp=function(s){this.selectingListItem=!1,this.component.value(s.original),this.clear(),this.draw()},e.prototype.move=function(s){this.active=s,this.draw()},e.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)},e.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)},e.prototype.drawError=function(s){var u=document.createElement("li");u.innerHTML=s,this.element.appendChild(u),this.show()},KS=e,KS}var JS,IP;function iN(){if(IP)return JS;IP=1;var e=mv(),s=tN(),u=nN(),d=function(b,E,T){return T=T||{},this.options=e({minLength:2,limit:5,filter:!0,hideOnBlur:!0},T),this.el=b,this.data=E||[],this.list=new u(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(t){this.handleKeyUp(t.keyCode)}).bind(this),!1),this.el.addEventListener("keydown",(function(t){this.handleKeyDown(t)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(t){this.handlePaste(t)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};return d.prototype.handleKeyUp=function(b){b===40||b===38||b===27||b===13||b===9||this.handleInputChange(this.el.value)},d.prototype.handleKeyDown=function(b){switch(b.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&b.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}},d.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},d.prototype.handlePaste=function(b){if(b.clipboardData)this.handleInputChange(b.clipboardData.getData("Text"));else{var E=this;setTimeout(function(){E.handleInputChange(b.target.value)},100)}},d.prototype.handleInputChange=function(b){if(this.query=this.normalize(b),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(E){for(var T=0;T<E.length&&(this.list.add(E[T]),T!==this.options.limit-1);T++);this.list.draw()}).bind(this))},d.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},d.prototype.update=function(b){this.data=b,this.handleKeyUp()},d.prototype.clear=function(){this.data=[],this.list.clear()},d.prototype.normalize=function(b){return b=b.toLowerCase(),b},d.prototype.match=function(b,E){return b.indexOf(E)>-1},d.prototype.value=function(b){if(this.selected=b,this.el.value=this.getItemValue(b),document.createEvent){var E=document.createEvent("HTMLEvents");E.initEvent("change",!0,!1),this.el.dispatchEvent(E)}else this.el.fireEvent("onchange")},d.prototype.getCandidates=function(b){var E={pre:"<strong>",post:"</strong>",extract:(function(t){return this.getItemValue(t)}).bind(this)},T;this.options.filter?(T=s.filter(this.query,this.data,E),T=T.map((function(t){return{original:t.original,string:this.render(t.original,t.string)}}).bind(this))):T=this.data.map((function(t){var G=this.render(t);return{original:t,string:G}}).bind(this)),b(T)},d.prototype.getItemValue=function(b){return b},d.prototype.render=function(b,E){if(E)return E;for(var T=b.original?this.getItemValue(b.original):this.getItemValue(b),t=this.normalize(T),G=t.lastIndexOf(this.query);G>-1;){var W=G+this.query.length;T=T.slice(0,G)+"<strong>"+T.slice(G,W)+"</strong>"+T.slice(W),G=t.slice(0,G).lastIndexOf(this.query)}return T},d.prototype.renderError=function(b){this.list.drawError(b)},JS=d,JS}var QS,PP;function rN(){if(PP)return QS;PP=1;var e=iN();return QS=e,typeof window<"u"&&(window.Suggestions=e),QS}var e2,AP;function aN(){if(AP)return e2;AP=1;var e="Expected a function",s=NaN,u="[object Symbol]",d=/^\s+|\s+$/g,b=/^[-+]0x[0-9a-f]+$/i,E=/^0b[01]+$/i,T=/^0o[0-7]+$/i,t=parseInt,G=typeof Ig=="object"&&Ig&&Ig.Object===Object&&Ig,W=typeof self=="object"&&self&&self.Object===Object&&self,Y=G||W||Function("return this")(),ne=Object.prototype,J=ne.toString,Q=Math.max,ce=Math.min,ie=function(){return Y.Date.now()};function pe(Oe,Ve,Ue){var qe,He,nt,rt,ft,$t,hn=0,gn=!1,pn=!1,ri=!0;if(typeof Oe!="function")throw new TypeError(e);Ve=Le(Ve)||0,be(Ue)&&(gn=!!Ue.leading,pn="maxWait"in Ue,nt=pn?Q(Le(Ue.maxWait)||0,Ve):nt,ri="trailing"in Ue?!!Ue.trailing:ri);function ai(sn){var qn=qe,pi=He;return qe=He=void 0,hn=sn,rt=Oe.apply(pi,qn),rt}function _n(sn){return hn=sn,ft=setTimeout(Nn,Ve),gn?ai(sn):rt}function Bn(sn){var qn=sn-$t,pi=sn-hn,ht=Ve-qn;return pn?ce(ht,nt-pi):ht}function mn(sn){var qn=sn-$t,pi=sn-hn;return $t===void 0||qn>=Ve||qn<0||pn&&pi>=nt}function Nn(){var sn=ie();if(mn(sn))return Pn(sn);ft=setTimeout(Nn,Bn(sn))}function Pn(sn){return ft=void 0,ri&&qe?ai(sn):(qe=He=void 0,rt)}function Ci(){ft!==void 0&&clearTimeout(ft),hn=0,qe=$t=He=ft=void 0}function Fi(){return ft===void 0?rt:Pn(ie())}function Ln(){var sn=ie(),qn=mn(sn);if(qe=arguments,He=this,$t=sn,qn){if(ft===void 0)return _n($t);if(pn)return ft=setTimeout(Nn,Ve),ai($t)}return ft===void 0&&(ft=setTimeout(Nn,Ve)),rt}return Ln.cancel=Ci,Ln.flush=Fi,Ln}function be(Oe){var Ve=typeof Oe;return!!Oe&&(Ve=="object"||Ve=="function")}function Ie(Oe){return!!Oe&&typeof Oe=="object"}function $e(Oe){return typeof Oe=="symbol"||Ie(Oe)&&J.call(Oe)==u}function Le(Oe){if(typeof Oe=="number")return Oe;if($e(Oe))return s;if(be(Oe)){var Ve=typeof Oe.valueOf=="function"?Oe.valueOf():Oe;Oe=be(Ve)?Ve+"":Ve}if(typeof Oe!="string")return Oe===0?Oe:+Oe;Oe=Oe.replace(d,"");var Ue=E.test(Oe);return Ue||T.test(Oe)?t(Oe.slice(2),Ue?2:8):b.test(Oe)?s:+Oe}return e2=pe,e2}var G0={exports:{}},kP;function sN(){if(kP)return G0.exports;kP=1;var e=typeof Reflect=="object"?Reflect:null,s=e&&typeof e.apply=="function"?e.apply:function(Oe,Ve,Ue){return Function.prototype.apply.call(Oe,Ve,Ue)},u;e&&typeof e.ownKeys=="function"?u=e.ownKeys:Object.getOwnPropertySymbols?u=function(Oe){return Object.getOwnPropertyNames(Oe).concat(Object.getOwnPropertySymbols(Oe))}:u=function(Oe){return Object.getOwnPropertyNames(Oe)};function d(Le){console&&console.warn&&console.warn(Le)}var b=Number.isNaN||function(Oe){return Oe!==Oe};function E(){E.init.call(this)}G0.exports=E,G0.exports.once=be,E.EventEmitter=E,E.prototype._events=void 0,E.prototype._eventsCount=0,E.prototype._maxListeners=void 0;var T=10;function t(Le){if(typeof Le!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof Le)}Object.defineProperty(E,"defaultMaxListeners",{enumerable:!0,get:function(){return T},set:function(Le){if(typeof Le!="number"||Le<0||b(Le))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+Le+".");T=Le}}),E.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},E.prototype.setMaxListeners=function(Oe){if(typeof Oe!="number"||Oe<0||b(Oe))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+Oe+".");return this._maxListeners=Oe,this};function G(Le){return Le._maxListeners===void 0?E.defaultMaxListeners:Le._maxListeners}E.prototype.getMaxListeners=function(){return G(this)},E.prototype.emit=function(Oe){for(var Ve=[],Ue=1;Ue<arguments.length;Ue++)Ve.push(arguments[Ue]);var qe=Oe==="error",He=this._events;if(He!==void 0)qe=qe&&He.error===void 0;else if(!qe)return!1;if(qe){var nt;if(Ve.length>0&&(nt=Ve[0]),nt instanceof Error)throw nt;var rt=new Error("Unhandled error."+(nt?" ("+nt.message+")":""));throw rt.context=nt,rt}var ft=He[Oe];if(ft===void 0)return!1;if(typeof ft=="function")s(ft,this,Ve);else for(var $t=ft.length,hn=ce(ft,$t),Ue=0;Ue<$t;++Ue)s(hn[Ue],this,Ve);return!0};function W(Le,Oe,Ve,Ue){var qe,He,nt;if(t(Ve),He=Le._events,He===void 0?(He=Le._events=Object.create(null),Le._eventsCount=0):(He.newListener!==void 0&&(Le.emit("newListener",Oe,Ve.listener?Ve.listener:Ve),He=Le._events),nt=He[Oe]),nt===void 0)nt=He[Oe]=Ve,++Le._eventsCount;else if(typeof nt=="function"?nt=He[Oe]=Ue?[Ve,nt]:[nt,Ve]:Ue?nt.unshift(Ve):nt.push(Ve),qe=G(Le),qe>0&&nt.length>qe&&!nt.warned){nt.warned=!0;var rt=new Error("Possible EventEmitter memory leak detected. "+nt.length+" "+String(Oe)+" listeners added. Use emitter.setMaxListeners() to increase limit");rt.name="MaxListenersExceededWarning",rt.emitter=Le,rt.type=Oe,rt.count=nt.length,d(rt)}return Le}E.prototype.addListener=function(Oe,Ve){return W(this,Oe,Ve,!1)},E.prototype.on=E.prototype.addListener,E.prototype.prependListener=function(Oe,Ve){return W(this,Oe,Ve,!0)};function Y(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function ne(Le,Oe,Ve){var Ue={fired:!1,wrapFn:void 0,target:Le,type:Oe,listener:Ve},qe=Y.bind(Ue);return qe.listener=Ve,Ue.wrapFn=qe,qe}E.prototype.once=function(Oe,Ve){return t(Ve),this.on(Oe,ne(this,Oe,Ve)),this},E.prototype.prependOnceListener=function(Oe,Ve){return t(Ve),this.prependListener(Oe,ne(this,Oe,Ve)),this},E.prototype.removeListener=function(Oe,Ve){var Ue,qe,He,nt,rt;if(t(Ve),qe=this._events,qe===void 0)return this;if(Ue=qe[Oe],Ue===void 0)return this;if(Ue===Ve||Ue.listener===Ve)--this._eventsCount===0?this._events=Object.create(null):(delete qe[Oe],qe.removeListener&&this.emit("removeListener",Oe,Ue.listener||Ve));else if(typeof Ue!="function"){for(He=-1,nt=Ue.length-1;nt>=0;nt--)if(Ue[nt]===Ve||Ue[nt].listener===Ve){rt=Ue[nt].listener,He=nt;break}if(He<0)return this;He===0?Ue.shift():ie(Ue,He),Ue.length===1&&(qe[Oe]=Ue[0]),qe.removeListener!==void 0&&this.emit("removeListener",Oe,rt||Ve)}return this},E.prototype.off=E.prototype.removeListener,E.prototype.removeAllListeners=function(Oe){var Ve,Ue,qe;if(Ue=this._events,Ue===void 0)return this;if(Ue.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):Ue[Oe]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete Ue[Oe]),this;if(arguments.length===0){var He=Object.keys(Ue),nt;for(qe=0;qe<He.length;++qe)nt=He[qe],nt!=="removeListener"&&this.removeAllListeners(nt);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(Ve=Ue[Oe],typeof Ve=="function")this.removeListener(Oe,Ve);else if(Ve!==void 0)for(qe=Ve.length-1;qe>=0;qe--)this.removeListener(Oe,Ve[qe]);return this};function J(Le,Oe,Ve){var Ue=Le._events;if(Ue===void 0)return[];var qe=Ue[Oe];return qe===void 0?[]:typeof qe=="function"?Ve?[qe.listener||qe]:[qe]:Ve?pe(qe):ce(qe,qe.length)}E.prototype.listeners=function(Oe){return J(this,Oe,!0)},E.prototype.rawListeners=function(Oe){return J(this,Oe,!1)},E.listenerCount=function(Le,Oe){return typeof Le.listenerCount=="function"?Le.listenerCount(Oe):Q.call(Le,Oe)},E.prototype.listenerCount=Q;function Q(Le){var Oe=this._events;if(Oe!==void 0){var Ve=Oe[Le];if(typeof Ve=="function")return 1;if(Ve!==void 0)return Ve.length}return 0}E.prototype.eventNames=function(){return this._eventsCount>0?u(this._events):[]};function ce(Le,Oe){for(var Ve=new Array(Oe),Ue=0;Ue<Oe;++Ue)Ve[Ue]=Le[Ue];return Ve}function ie(Le,Oe){for(;Oe+1<Le.length;Oe++)Le[Oe]=Le[Oe+1];Le.pop()}function pe(Le){for(var Oe=new Array(Le.length),Ve=0;Ve<Oe.length;++Ve)Oe[Ve]=Le[Ve].listener||Le[Ve];return Oe}function be(Le,Oe){return new Promise(function(Ve,Ue){function qe(nt){Le.removeListener(Oe,He),Ue(nt)}function He(){typeof Le.removeListener=="function"&&Le.removeListener("error",qe),Ve([].slice.call(arguments))}$e(Le,Oe,He,{once:!0}),Oe!=="error"&&Ie(Le,qe,{once:!0})})}function Ie(Le,Oe,Ve){typeof Le.on=="function"&&$e(Le,"error",Oe,Ve)}function $e(Le,Oe,Ve,Ue){if(typeof Le.on=="function")Ue.once?Le.once(Oe,Ve):Le.on(Oe,Ve);else if(typeof Le.addEventListener=="function")Le.addEventListener(Oe,function qe(He){Ue.once&&Le.removeEventListener(Oe,qe),Ve(He)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof Le)}return G0.exports}var t2,DP;function oN(){return DP||(DP=1,t2={fr:{name:"France",bbox:[[-4.59235,41.380007],[9.560016,51.148506]]},us:{name:"United States",bbox:[[-171.791111,18.91619],[-66.96466,71.357764]]},ru:{name:"Russia",bbox:[[19.66064,41.151416],[190.10042,81.2504]]},ca:{name:"Canada",bbox:[[-140.99778,41.675105],[-52.648099,83.23324]]}}),t2}var n2,RP;function lN(){if(RP)return n2;RP=1;function e(d){var b=d.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return b?{key:b[1],value:b[2]}:null}function s(d){var b=d.match(/<?([^>]*)>(.*)/);if(!b)return null;var E=b[1],T=b[2].split(";"),t=null,G=T.reduce(function(W,Y){var ne=e(Y);return ne?ne.key==="rel"?(t||(t=ne.value),W):(W[ne.key]=ne.value,W):W},{});return t?{url:E,rel:t,params:G}:null}function u(d){return d?d.split(/,\s*</).reduce(function(b,E){var T=s(E);if(!T)return b;var t=T.rel.split(/\s+/);return t.forEach(function(G){b[G]||(b[G]={url:T.url,params:T.params})}),b},{}):{}}return n2=u,n2}var i2,LP;function cN(){if(LP)return i2;LP=1;var e=lN();function s(u,d){this.request=u,this.headers=d.headers,this.rawBody=d.body,this.statusCode=d.statusCode;try{this.body=JSON.parse(d.body||"{}")}catch{this.body=d.body}this.links=e(this.headers.link)}return s.prototype.hasNextPage=function(){return!!this.links.next},s.prototype.nextPage=function(){return this.hasNextPage()?this.request._extend({path:this.links.next.url}):null},i2=s,i2}var r2,zP;function G1(){return zP||(zP=1,r2={API_ORIGIN:"https://api.mapbox.com",EVENT_PROGRESS_DOWNLOAD:"downloadProgress",EVENT_PROGRESS_UPLOAD:"uploadProgress",EVENT_ERROR:"error",EVENT_RESPONSE:"response",ERROR_HTTP:"HttpError",ERROR_REQUEST_ABORTED:"RequestAbortedError"}),r2}var a2,OP;function uN(){if(OP)return a2;OP=1;var e=G1();function s(u){var d=u.type||e.ERROR_HTTP,b;if(u.body)try{b=JSON.parse(u.body)}catch{b=u.body}else b=null;var E=u.message||null;E||(typeof b=="string"?E=b:b&&typeof b.message=="string"?E=b.message:d===e.ERROR_REQUEST_ABORTED&&(E="Request aborted")),this.message=E,this.type=d,this.statusCode=u.statusCode||null,this.request=u.request,this.body=b}return a2=s,a2}var s2,FP;function hN(){if(FP)return s2;FP=1;function e(u){var d=u.indexOf(":"),b=u.substring(0,d).trim().toLowerCase(),E=u.substring(d+1).trim();return{name:b,value:E}}function s(u){var d={};return u&&u.trim().split(/[\r|\n]+/).forEach(function(b){var E=e(b);d[E.name]=E.value}),d}return s2=s,s2}var o2,BP;function dN(){if(BP)return o2;BP=1;var e=cN(),s=uN(),u=G1(),d=hN(),b={};function E(ne){var J=b[ne.id];J&&(J.abort(),delete b[ne.id])}function T(ne,J){return new e(ne,{body:J.response,headers:d(J.getAllResponseHeaders()),statusCode:J.status})}function t(ne){var J=ne.total,Q=ne.loaded,ce=100*Q/J;return{total:J,transferred:Q,percent:ce}}function G(ne,J){return new Promise(function(Q,ce){J.onprogress=function(be){ne.emitter.emit(u.EVENT_PROGRESS_DOWNLOAD,t(be))};var ie=ne.file;ie&&(J.upload.onprogress=function(be){ne.emitter.emit(u.EVENT_PROGRESS_UPLOAD,t(be))}),J.onerror=function(be){ce(be)},J.onabort=function(){var be=new s({request:ne,type:u.ERROR_REQUEST_ABORTED});ce(be)},J.onload=function(){if(delete b[ne.id],J.status<200||J.status>=400){var be=new s({request:ne,body:J.response,statusCode:J.status});ce(be);return}Q(J)};var pe=ne.body;typeof pe=="string"?J.send(pe):pe?J.send(JSON.stringify(pe)):ie?J.send(ie):J.send(),b[ne.id]=J}).then(function(Q){return T(ne,Q)})}function W(ne,J){var Q=ne.url(J),ce=new window.XMLHttpRequest;return ce.open(ne.method,Q),Object.keys(ne.headers).forEach(function(ie){ce.setRequestHeader(ie,ne.headers[ie])}),ce}function Y(ne){return Promise.resolve().then(function(){var J=W(ne,ne.client.accessToken);return G(ne,J)})}return o2={browserAbort:E,sendRequestXhr:G,browserSend:Y,createRequestXhr:W},o2}var kx={exports:{}};/*! http://mths.be/base64 v0.1.0 by @mathias | MIT license */var fN=kx.exports,VP;function pN(){return VP||(VP=1,function(e,s){(function(u){var d=s,b=e.exports==d&&e,E=typeof Ig=="object"&&Ig;(E.global===E||E.window===E)&&(u=E);var T=function(ce){this.message=ce};T.prototype=new Error,T.prototype.name="InvalidCharacterError";var t=function(ce){throw new T(ce)},G="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",W=/[\t\n\f\r ]/g,Y=function(ce){ce=String(ce).replace(W,"");var ie=ce.length;ie%4==0&&(ce=ce.replace(/==?$/,""),ie=ce.length),(ie%4==1||/[^+a-zA-Z0-9/]/.test(ce))&&t("Invalid character: the string to be decoded is not correctly encoded.");for(var pe=0,be,Ie,$e="",Le=-1;++Le<ie;)Ie=G.indexOf(ce.charAt(Le)),be=pe%4?be*64+Ie:Ie,pe++%4&&($e+=String.fromCharCode(255&be>>(-2*pe&6)));return $e},ne=function(ce){ce=String(ce),/[^\0-\xFF]/.test(ce)&&t("The string to be encoded contains characters outside of the Latin1 range.");for(var ie=ce.length%3,pe="",be=-1,Ie,$e,Le,Oe,Ve=ce.length-ie;++be<Ve;)Ie=ce.charCodeAt(be)<<16,$e=ce.charCodeAt(++be)<<8,Le=ce.charCodeAt(++be),Oe=Ie+$e+Le,pe+=G.charAt(Oe>>18&63)+G.charAt(Oe>>12&63)+G.charAt(Oe>>6&63)+G.charAt(Oe&63);return ie==2?(Ie=ce.charCodeAt(be)<<8,$e=ce.charCodeAt(++be),Oe=Ie+$e,pe+=G.charAt(Oe>>10)+G.charAt(Oe>>4&63)+G.charAt(Oe<<2&63)+"="):ie==1&&(Oe=ce.charCodeAt(be),pe+=G.charAt(Oe>>2)+G.charAt(Oe<<4&63)+"=="),pe},J={encode:ne,decode:Y,version:"0.1.0"};if(d&&!d.nodeType)if(b)b.exports=J;else for(var Q in J)J.hasOwnProperty(Q)&&(d[Q]=J[Q]);else u.base64=J})(fN)}(kx,kx.exports)),kx.exports}var l2,NP;function yR(){if(NP)return l2;NP=1;var e=pN(),s={};function u(E){if(s[E])return s[E];var T=E.split("."),t=T[0],G=T[1];if(!G)throw new Error("Invalid token");var W=d(G),Y={usage:t,user:W.u};return b(W,"a")&&(Y.authorization=W.a),b(W,"exp")&&(Y.expires=W.exp*1e3),b(W,"iat")&&(Y.created=W.iat*1e3),b(W,"scopes")&&(Y.scopes=W.scopes),b(W,"client")&&(Y.client=W.client),b(W,"ll")&&(Y.lastLogin=W.ll),b(W,"iu")&&(Y.impersonator=W.iu),s[E]=Y,Y}function d(E){try{return JSON.parse(e.decode(E))}catch{throw new Error("Invalid token")}}function b(E,T){return Object.prototype.hasOwnProperty.call(E,T)}return l2=u,l2}var c2={exports:{}},jP;function mN(){return jP||(jP=1,function(e){var s=Object.prototype.hasOwnProperty,u="~";function d(){}Object.create&&(d.prototype=Object.create(null),new d().__proto__||(u=!1));function b(G,W,Y){this.fn=G,this.context=W,this.once=Y||!1}function E(G,W,Y,ne,J){if(typeof Y!="function")throw new TypeError("The listener must be a function");var Q=new b(Y,ne||G,J),ce=u?u+W:W;return G._events[ce]?G._events[ce].fn?G._events[ce]=[G._events[ce],Q]:G._events[ce].push(Q):(G._events[ce]=Q,G._eventsCount++),G}function T(G,W){--G._eventsCount===0?G._events=new d:delete G._events[W]}function t(){this._events=new d,this._eventsCount=0}t.prototype.eventNames=function(){var W=[],Y,ne;if(this._eventsCount===0)return W;for(ne in Y=this._events)s.call(Y,ne)&&W.push(u?ne.slice(1):ne);return Object.getOwnPropertySymbols?W.concat(Object.getOwnPropertySymbols(Y)):W},t.prototype.listeners=function(W){var Y=u?u+W:W,ne=this._events[Y];if(!ne)return[];if(ne.fn)return[ne.fn];for(var J=0,Q=ne.length,ce=new Array(Q);J<Q;J++)ce[J]=ne[J].fn;return ce},t.prototype.listenerCount=function(W){var Y=u?u+W:W,ne=this._events[Y];return ne?ne.fn?1:ne.length:0},t.prototype.emit=function(W,Y,ne,J,Q,ce){var ie=u?u+W:W;if(!this._events[ie])return!1;var pe=this._events[ie],be=arguments.length,Ie,$e;if(pe.fn){switch(pe.once&&this.removeListener(W,pe.fn,void 0,!0),be){case 1:return pe.fn.call(pe.context),!0;case 2:return pe.fn.call(pe.context,Y),!0;case 3:return pe.fn.call(pe.context,Y,ne),!0;case 4:return pe.fn.call(pe.context,Y,ne,J),!0;case 5:return pe.fn.call(pe.context,Y,ne,J,Q),!0;case 6:return pe.fn.call(pe.context,Y,ne,J,Q,ce),!0}for($e=1,Ie=new Array(be-1);$e<be;$e++)Ie[$e-1]=arguments[$e];pe.fn.apply(pe.context,Ie)}else{var Le=pe.length,Oe;for($e=0;$e<Le;$e++)switch(pe[$e].once&&this.removeListener(W,pe[$e].fn,void 0,!0),be){case 1:pe[$e].fn.call(pe[$e].context);break;case 2:pe[$e].fn.call(pe[$e].context,Y);break;case 3:pe[$e].fn.call(pe[$e].context,Y,ne);break;case 4:pe[$e].fn.call(pe[$e].context,Y,ne,J);break;default:if(!Ie)for(Oe=1,Ie=new Array(be-1);Oe<be;Oe++)Ie[Oe-1]=arguments[Oe];pe[$e].fn.apply(pe[$e].context,Ie)}}return!0},t.prototype.on=function(W,Y,ne){return E(this,W,Y,ne,!1)},t.prototype.once=function(W,Y,ne){return E(this,W,Y,ne,!0)},t.prototype.removeListener=function(W,Y,ne,J){var Q=u?u+W:W;if(!this._events[Q])return this;if(!Y)return T(this,Q),this;var ce=this._events[Q];if(ce.fn)ce.fn===Y&&(!J||ce.once)&&(!ne||ce.context===ne)&&T(this,Q);else{for(var ie=0,pe=[],be=ce.length;ie<be;ie++)(ce[ie].fn!==Y||J&&!ce[ie].once||ne&&ce[ie].context!==ne)&&pe.push(ce[ie]);pe.length?this._events[Q]=pe.length===1?pe[0]:pe:T(this,Q)}return this},t.prototype.removeAllListeners=function(W){var Y;return W?(Y=u?u+W:W,this._events[Y]&&T(this,Y)):(this._events=new d,this._eventsCount=0),this},t.prototype.off=t.prototype.removeListener,t.prototype.addListener=t.prototype.on,t.prefixed=u,t.EventEmitter=t,e.exports=t}(c2)),c2.exports}var u2,UP;function gN(){if(UP)return u2;UP=1;function e(T){return T.map(encodeURIComponent).join(",")}function s(T){return Array.isArray(T)?e(T):encodeURIComponent(String(T))}function u(T,t,G){if(G===!1||G===null)return T;var W=/\?/.test(T)?"&":"?",Y=encodeURIComponent(t);return G!==void 0&&G!==""&&G!==!0&&(Y+="="+s(G)),""+T+W+Y}function d(T,t){if(!t)return T;var G=T;return Object.keys(t).forEach(function(W){var Y=t[W];Y!==void 0&&(Array.isArray(Y)&&(Y=Y.filter(function(ne){return ne!=null}).join(",")),G=u(G,W,Y))}),G}function b(T,t){if(!t||T.slice(0,4)==="http")return T;var G=T[0]==="/"?"":"/";return""+t.replace(/\/$/,"")+G+T}function E(T,t){return t?T.replace(/\/:([a-zA-Z0-9]+)/g,function(G,W){var Y=t[W];if(Y===void 0)throw new Error("Unspecified route parameter "+W);var ne=s(Y);return"/"+ne}):T}return u2={appendQueryObject:d,appendQueryParam:u,prependOrigin:b,interpolateRouteParams:E},u2}var h2,$P;function _N(){if($P)return h2;$P=1;var e=yR(),s=mv(),u=mN(),d=gN(),b=G1(),E=1;function T(t,G){if(!t)throw new Error("MapiRequest requires a client");if(!G||!G.path||!G.method)throw new Error("MapiRequest requires an options object with path and method properties");var W={};G.body&&(W["content-type"]="application/json");var Y=s(W,G.headers),ne=Object.keys(Y).reduce(function(J,Q){return J[Q.toLowerCase()]=Y[Q],J},{});this.id=E++,this._options=G,this.emitter=new u,this.client=t,this.response=null,this.error=null,this.sent=!1,this.aborted=!1,this.path=G.path,this.method=G.method,this.origin=G.origin||t.origin,this.query=G.query||{},this.params=G.params||{},this.body=G.body||null,this.file=G.file||null,this.encoding=G.encoding||"utf8",this.sendFileAs=G.sendFileAs||null,this.headers=ne}return T.prototype.url=function(G){var W=d.prependOrigin(this.path,this.origin);W=d.appendQueryObject(W,this.query);var Y=this.params,ne=G??this.client.accessToken;if(ne){W=d.appendQueryParam(W,"access_token",ne);var J=e(ne).user;Y=s({ownerId:J},Y)}return W=d.interpolateRouteParams(W,Y),W},T.prototype.send=function(){var G=this;if(G.sent)throw new Error("This request has already been sent. Check the response and error properties. Create a new request with clone().");return G.sent=!0,G.client.sendRequest(G).then(function(W){return G.response=W,G.emitter.emit(b.EVENT_RESPONSE,W),W},function(W){throw G.error=W,G.emitter.emit(b.EVENT_ERROR,W),W})},T.prototype.abort=function(){this._nextPageRequest&&(this._nextPageRequest.abort(),delete this._nextPageRequest),!(this.response||this.error||this.aborted)&&(this.aborted=!0,this.client.abortRequest(this))},T.prototype.eachPage=function(G){var W=this;function Y(Q){function ce(){delete W._nextPageRequest;var ie=Q.nextPage();ie&&(W._nextPageRequest=ie,J(ie))}G(null,Q,ce)}function ne(Q){G(Q,null,function(){})}function J(Q){Q.send().then(Y,ne)}J(this)},T.prototype.clone=function(){return this._extend()},T.prototype._extend=function(G){var W=s(this._options,G);return new T(this.client,W)},h2=T,h2}var d2,GP;function vR(){if(GP)return d2;GP=1;var e=yR(),s=_N(),u=G1();function d(b){if(!b||!b.accessToken)throw new Error("Cannot create a client without an access token");e(b.accessToken),this.accessToken=b.accessToken,this.origin=b.origin||u.API_ORIGIN}return d.prototype.createRequest=function(E){return new s(this,E)},d2=d,d2}var f2,qP;function xR(){if(qP)return f2;qP=1;var e=dN(),s=vR();function u(b){s.call(this,b)}u.prototype=Object.create(s.prototype),u.prototype.constructor=u,u.prototype.sendRequest=e.browserSend,u.prototype.abortRequest=e.browserAbort;function d(b){return new u(b)}return f2=d,f2}var p2,HP;function yN(){if(HP)return p2;HP=1;var e=xR();return p2=e,p2}var m2,ZP;function vN(){if(ZP)return m2;ZP=1;var e=Object.prototype.toString;return m2=function(s){var u;return e.call(s)==="[object Object]"&&(u=Object.getPrototypeOf(s),u===null||u===Object.getPrototypeOf({}))},m2}var g2,WP;function xN(){if(WP)return g2;WP=1;var e=vN(),s=mv(),u="value",d=`
  `,b={};b.assert=function(ce,ie){return ie=ie||{},function(pe){var be=T(ce,pe);if(be){var Ie=t(be,ie);throw ie.apiName&&(Ie=ie.apiName+": "+Ie),new Error(Ie)}}},b.shape=function(ie){var pe=Q(ie);return function(Ie){var $e=T(b.plainObject,Ie);if($e)return $e;for(var Le,Oe,Ve=[],Ue=0;Ue<pe.length;Ue++)Le=pe[Ue].key,Oe=pe[Ue].value,$e=T(Oe,Ie[Le]),$e&&Ve.push([Le].concat($e));return Ve.length<2?Ve[0]:function(qe){Ve=Ve.map(function(rt){var ft=rt[0],$t=t(rt,qe).split(`
`).join(d);return"- "+ft+": "+$t});var He=qe.path.join("."),nt=He===u?"":" of "+He;return"The following properties"+nt+" have invalid values:"+d+Ve.join(d)}}},b.strictShape=function(ie){var pe=b.shape(ie);return function(Ie){var $e=pe(Ie);if($e)return $e;var Le=Object.keys(Ie).reduce(function(Oe,Ve){return ie[Ve]===void 0&&Oe.push(Ve),Oe},[]);if(Le.length!==0)return function(){return"The following keys are invalid: "+Le.join(", ")}}},b.arrayOf=function(ie){return E(ie)},b.tuple=function(){var ie=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return E(ie)};function E(ce){var ie=Array.isArray(ce),pe=function(be){return ie?ce[be]:ce};return function(Ie){var $e=T(b.plainArray,Ie);if($e)return $e;if(ie&&Ie.length!==ce.length)return"an array with "+ce.length+" items";for(var Le=0;Le<Ie.length;Le++)if($e=T(pe(Le),Ie[Le]),$e)return[Le].concat($e)}}b.required=function(ie){function pe(be){return be==null?function(Ie){return ne(Ie,J(Ie.path)?"cannot be undefined/null.":"is required.")}:ie.apply(this,arguments)}return pe.__required=!0,pe},b.oneOfType=function(){var ie=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments);return function(be){var Ie=ie.map(function($e){return T($e,be)}).filter(Boolean);if(Ie.length===ie.length)return Ie.every(function($e){return $e.length===1&&typeof $e[0]=="string"})?G(Ie.map(function($e){return $e[0]})):Ie.reduce(function($e,Le){return Le.length>$e.length?Le:$e})}},b.equal=function(ie){return function(be){if(be!==ie)return JSON.stringify(ie)}},b.oneOf=function(){var ie=Array.isArray(arguments[0])?arguments[0]:Array.prototype.slice.call(arguments),pe=ie.map(function(be){return b.equal(be)});return b.oneOfType.apply(this,pe)},b.range=function(ie){var pe=ie[0],be=ie[1];return function($e){var Le=T(b.number,$e);if(Le||$e<pe||$e>be)return"number between "+pe+" & "+be+" (inclusive)"}},b.any=function(){},b.boolean=function(ie){if(typeof ie!="boolean")return"boolean"},b.number=function(ie){if(typeof ie!="number")return"number"},b.plainArray=function(ie){if(!Array.isArray(ie))return"array"},b.plainObject=function(ie){if(!e(ie))return"object"},b.string=function(ie){if(typeof ie!="string")return"string"},b.func=function(ie){if(typeof ie!="function")return"function"};function T(ce,ie){if(!(ie==null&&!ce.hasOwnProperty("__required"))){var pe=ce(ie);if(pe)return Array.isArray(pe)?pe:[pe]}}function t(ce,ie){var pe=ce.length,be=ce[pe-1],Ie=ce.slice(0,pe-1);return Ie.length===0&&(Ie=[u]),ie=s(ie,{path:Ie}),typeof be=="function"?be(ie):ne(ie,W(be))}function G(ce){return ce.length<2?ce[0]:ce.length===2?ce.join(" or "):ce.slice(0,-1).join(", ")+", or "+ce.slice(-1)}function W(ce){return"must be "+Y(ce)+"."}function Y(ce){return/^an? /.test(ce)?ce:/^[aeiou]/i.test(ce)?"an "+ce:/^[a-z]/i.test(ce)?"a "+ce:ce}function ne(ce,ie){var pe=J(ce.path),be=ce.path.join(".")+" "+ie,Ie=pe?"Item at position ":"";return Ie+be}function J(ce){return typeof ce[ce.length-1]=="number"||typeof ce[0]=="number"}function Q(ce){return Object.keys(ce||{}).map(function(ie){return{key:ie,value:ce[ie]}})}return b.validate=T,b.processMessage=t,g2=b,g2}var _2,XP;function bN(){if(XP)return _2;XP=1;var e=mv(),s=xN();function u(T){if(typeof window<"u")return T instanceof Ig.Blob||T instanceof Ig.ArrayBuffer?void 0:"Blob or ArrayBuffer";if(!(typeof T=="string"||T.pipe!==void 0))return"Filename or Readable stream"}function d(T,t){return s.assert(s.strictShape(T),t)}function b(T){var t="date";if(typeof T=="boolean")return t;try{var G=new Date(T);if(G.getTime&&isNaN(G.getTime()))return t}catch{return t}}function E(T){return s.tuple(s.number,s.number)(T)}return _2=e(s,{file:u,date:b,coordinates:E,assertShape:d}),_2}var y2,YP;function wN(){if(YP)return y2;YP=1;function e(s,u){var d=function(b,E){return u.indexOf(b)!==-1&&E!==void 0};return typeof u=="function"&&(d=u),Object.keys(s).filter(function(b){return d(b,s[b])}).reduce(function(b,E){return b[E]=s[E],b},{})}return y2=e,y2}var v2,KP;function SN(){if(KP)return v2;KP=1;function e(s,u){return Object.keys(s).reduce(function(d,b){return d[b]=u(b,s[b]),d},{})}return v2=e,v2}var x2,JP;function TN(){if(JP)return x2;JP=1;var e=SN();function s(u){return e(u,function(d,b){return typeof b=="boolean"?JSON.stringify(b):b})}return x2=s,x2}var b2,QP;function CN(){if(QP)return b2;QP=1;var e=vR(),s=xR();function u(d){return function(b){var E;e.prototype.isPrototypeOf(b)?E=b:E=s(b);var T=Object.create(d);return T.client=E,T}}return b2=u,b2}var w2,eA;function EN(){if(eA)return w2;eA=1;var e=mv(),s=bN(),u=wN(),d=TN(),b=CN(),E={},T=["country","region","postcode","district","place","locality","neighborhood","address","poi","poi.landmark"];return E.forwardGeocode=function(t){s.assertShape({query:s.required(s.string),mode:s.oneOf("mapbox.places","mapbox.places-permanent"),countries:s.arrayOf(s.string),proximity:s.oneOf(s.coordinates,"ip"),types:s.arrayOf(s.oneOf(T)),autocomplete:s.boolean,bbox:s.arrayOf(s.number),limit:s.number,language:s.arrayOf(s.string),routing:s.boolean,fuzzyMatch:s.boolean,worldview:s.string,session_token:s.string})(t),t.mode=t.mode||"mapbox.places";var G=d(e({country:t.countries},u(t,["proximity","types","autocomplete","bbox","limit","language","routing","fuzzyMatch","worldview","session_token"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:u(t,["mode","query"]),query:G})},E.reverseGeocode=function(t){s.assertShape({query:s.required(s.coordinates),mode:s.oneOf("mapbox.places","mapbox.places-permanent"),countries:s.arrayOf(s.string),types:s.arrayOf(s.oneOf(T)),bbox:s.arrayOf(s.number),limit:s.number,language:s.arrayOf(s.string),reverseMode:s.oneOf("distance","score"),routing:s.boolean,worldview:s.string,session_token:s.string})(t),t.mode=t.mode||"mapbox.places";var G=d(e({country:t.countries},u(t,["country","types","bbox","limit","language","reverseMode","routing","worldview","session_token"])));return this.client.createRequest({method:"GET",path:"/geocoding/v5/:mode/:query.json",params:u(t,["mode","query"]),query:G})},w2=b(E),w2}let MN="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",bR=e=>crypto.getRandomValues(new Uint8Array(e)),wR=(e,s,u)=>{let d=(2<<Math.log(e.length-1)/Math.LN2)-1,b=-~(1.6*d*s/e.length);return(E=s)=>{let T="";for(;;){let t=u(b),G=b|0;for(;G--;)if(T+=e[t[G]&d]||"",T.length===E)return T}}},IN=(e,s=21)=>wR(e,s,bR),PN=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((s,u)=>(u&=63,u<36?s+=u.toString(36):u<62?s+=(u-26).toString(36).toUpperCase():u>62?s+="-":s+="_",s),"");const AN=Object.freeze(Object.defineProperty({__proto__:null,customAlphabet:IN,customRandom:wR,nanoid:PN,random:bR,urlAlphabet:MN},Symbol.toStringTag,{value:"Module"})),kN=NV(AN);var S2,tA;function DN(){if(tA)return S2;tA=1;var e=kN.nanoid;function s(u){this.origin=u.origin||"https://api.mapbox.com",this.endpoint="events/v2",this.access_token=u.accessToken,this.version="0.3.0",this.pluginSessionID=this.generateSessionID(),this.sessionIncrementer=0,this.userAgent=this.getUserAgent(),this.options=u,this.send=this.send.bind(this),this.countries=u.countries?u.countries.split(","):null,this.types=u.types?u.types.split(","):null,this.bbox=u.bbox?u.bbox:null,this.language=u.language?u.language.split(","):null,this.limit=u.limit?+u.limit:null,this.locale=navigator.language||null,this.enableEventLogging=this.shouldEnableLogging(u),this.eventQueue=new Array,this.flushInterval=u.flushInterval||1e3,this.maxQueueSize=u.maxQueueSize||100,this.timer=this.flushInterval?setTimeout(this.flush.bind(this),this.flushInterval):null,this.lastSentInput="",this.lastSentIndex=0}return s.prototype={select:function(u,d){var b=this.getEventPayload("search.select",d,{selectedFeature:u});if(b&&!(b.resultIndex===this.lastSentIndex&&b.queryString===this.lastSentInput||b.resultIndex==-1))return this.lastSentIndex=b.resultIndex,this.lastSentInput=b.queryString,this.push(b)},start:function(u){var d=this.getEventPayload("search.start",u);if(d)return this.push(d)},keyevent:function(u,d){if(u.key&&!(u.metaKey||[9,27,37,39,13,38,40].indexOf(u.keyCode)!==-1)){var b=this.getEventPayload("search.keystroke",d,{key:u.key});if(b)return this.push(b)}},send:function(u,d){if(!this.enableEventLogging)return d?d():void 0;var b=this.getRequestOptions(u);this.request(b,(function(E){if(E)return this.handleError(E,d);if(d)return d()}).bind(this))},getRequestOptions:function(u){Array.isArray(u)||(u=[u]);var d={method:"POST",host:this.origin,path:this.endpoint+"?access_token="+this.access_token,headers:{"Content-Type":"application/json"},body:JSON.stringify(u)};return d},getEventPayload:function(u,d,b={}){if(u==="search.select"&&!b.selectedFeature||u==="search.keystroke"&&!b.key)return null;var E;if(!d.options.proximity)E=null;else if(typeof d.options.proximity=="object")E=[d.options.proximity.longitude,d.options.proximity.latitude];else if(d.options.proximity==="ip"){var T=d._headers?d._headers["ip-proximity"]:null;T&&typeof T=="string"?E=T.split(",").map(parseFloat):E=[999,999]}else E=d.options.proximity;var t=d._map?d._map.getZoom():void 0,G={event:u,version:this.getEventSchemaVersion(u),created:+new Date,sessionIdentifier:this.getSessionId(),country:this.countries,userAgent:this.userAgent,language:this.language,bbox:this.bbox,types:this.types,endpoint:"mapbox.places",autocomplete:d.options.autocomplete,fuzzyMatch:d.options.fuzzyMatch,proximity:E,limit:d.options.limit,routing:d.options.routing,worldview:d.options.worldview,mapZoom:t,keyboardLocale:this.locale};if(u==="search.select"?G.queryString=d.inputString:u!="search.select"&&d._inputEl?G.queryString=d._inputEl.value:G.queryString=d.inputString,["search.keystroke","search.select"].includes(u)&&(G.path="geocoding/v5/mapbox.places"),u==="search.keystroke"&&b.key)G.lastAction=b.key;else if(u==="search.select"&&b.selectedFeature){var W=b.selectedFeature,Y=this.getSelectedIndex(W,d);if(G.resultIndex=Y,G.resultPlaceName=W.place_name,G.resultId=W.id,W.properties&&(G.resultMapboxId=W.properties.mapbox_id),d._typeahead){var ne=d._typeahead.data;ne&&ne.length>0&&(G.suggestionIds=this.getSuggestionIds(ne),G.suggestionNames=this.getSuggestionNames(ne),G.suggestionTypes=this.getSuggestionTypes(ne),G.suggestionSources=this.getSuggestionSources(ne))}}return this.validatePayload(G)?G:null},request:function(u,d){var b=new XMLHttpRequest;b.onreadystatechange=function(){if(this.readyState==4)return this.status==204?d(null):d(this.statusText)},b.open(u.method,u.host+"/"+u.path,!0);for(var E in u.headers){var T=u.headers[E];b.setRequestHeader(E,T)}b.send(u.body)},handleError:function(u,d){if(d)return d(u)},generateSessionID:function(){return e()},getSessionId:function(){return this.pluginSessionID+"."+this.sessionIncrementer},getUserAgent:function(){return"mapbox-gl-geocoder."+this.version+"."+navigator.userAgent},getSelectedIndex:function(u,d){if(d._typeahead){var b=d._typeahead.data,E=u.id,T=b.map(function(G){return G.id}),t=T.indexOf(E);return t}},getSuggestionIds:function(u){return u.map(function(d){return d.properties?d.properties.mapbox_id||"":d.id||""})},getSuggestionNames:function(u){return u.map(function(d){return d.place_name||""})},getSuggestionTypes:function(u){return u.map(function(d){return d.place_type&&Array.isArray(d.place_type)&&d.place_type[0]||""})},getSuggestionSources:function(u){return u.map(function(d){return d._source||""})},getEventSchemaVersion:function(u){return["search.keystroke","search.select"].includes(u)?"2.2":"2.0"},validatePayload:function(u){if(!u||!u.event)return!1;var d=["event","created","sessionIdentifier","queryString"],b=["event","created","sessionIdentifier","queryString","lastAction"],E=["event","created","sessionIdentifier","queryString","resultIndex","path","suggestionIds"],T=u.event;return T==="search.start"?this.objectHasRequiredProps(u,d):T==="search.keystroke"?this.objectHasRequiredProps(u,b):T==="search.select"?this.objectHasRequiredProps(u,E):!0},objectHasRequiredProps:function(u,d){return d.every(function(b){return b==="queryString"?typeof u[b]=="string"&&u[b].length>0:u[b]!==void 0})},shouldEnableLogging:function(u){return!(u.enableEventLogging===!1||u.origin&&u.origin!=="https://api.mapbox.com")},flush:function(){this.eventQueue.length>0&&(this.send(this.eventQueue),this.eventQueue=new Array),this.timer&&clearTimeout(this.timer),this.flushInterval&&(this.timer=setTimeout(this.flush.bind(this),this.flushInterval))},push:function(u,d){this.eventQueue.push(u),(this.eventQueue.length>=this.maxQueueSize||d)&&this.flush()},remove:function(){this.flush()}},S2=s,S2}var T2,nA;function RN(){if(nA)return T2;nA=1;var e={de:"Suche",it:"Ricerca",en:"Search",nl:"Zoeken",fr:"Chercher",ca:"Cerca",he:"לחפש",ja:"サーチ",lv:"Meklēt",pt:"Procurar",sr:"Претрага",zh:"搜索",cs:"Vyhledávání",hu:"Keresés",ka:"ძიება",nb:"Søke",sk:"Vyhľadávanie",th:"ค้นหา",fi:"Hae",is:"Leita",ko:"수색",pl:"Szukaj",sl:"Iskanje",fa:"جستجو",ru:"Поиск"};return T2={placeholder:e},T2}var l1={exports:{}},LN=l1.exports,iA;function zN(){return iA||(iA=1,function(e){(function(s,u,d){e.exports?e.exports=d():s[u]=d()})(LN,"subtag",function(){var s="",u=/^([a-zA-Z]{2,3})(?:[_-]+([a-zA-Z]{3})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{4})(?=$|[_-]+))?(?:[_-]+([a-zA-Z]{2}|[0-9]{3})(?=$|[_-]+))?/;function d(G){return G.match(u)||[]}function b(G){return d(G).filter(function(W,Y){return W&&Y})}function E(G){return G=d(G),{language:G[1]||s,extlang:G[2]||s,script:G[3]||s,region:G[4]||s}}function T(G,W,Y){Object.defineProperty(G,W,{value:Y,enumerable:!0})}function t(G,W,Y){function ne(J){return d(J)[G]||s}T(ne,"pattern",W),T(E,Y,ne)}return t(1,/^[a-zA-Z]{2,3}$/,"language"),t(2,/^[a-zA-Z]{3}$/,"extlang"),t(3,/^[a-zA-Z]{4}$/,"script"),t(4,/^[a-zA-Z]{2}$|^[0-9]{3}$/,"region"),T(E,"split",b),E})}(l1)),l1.exports}var C2,rA;function ON(){if(rA)return C2;rA=1;function e(){}return e.prototype={isSupport:function(){return!!window.navigator.geolocation},getCurrentPosition:function(){const s={enableHighAccuracy:!0};return new Promise(function(u,d){window.navigator.geolocation.getCurrentPosition(u,d,s)})}},C2=e,C2}var E2,aA;function FN(){if(aA)return E2;aA=1;function e(d,b){const E=s(d),T=["address","street","place","country"];var t;if(typeof b=="function")return b(E);const G=T.indexOf(b);return G===-1?t=T:t=T.slice(G),t.reduce(function(W,Y){return E[Y]?(W!==""&&(W=W+", "),W+E[Y]):W},"")}function s(d){const b=d.address||"",E=d.text||"",T=d.place_name||"",G={address:T.split(",")[0],houseNumber:b,street:E,placeName:T};return d.context.forEach(function(W){const Y=W.id.split(".")[0];G[Y]=W.text}),G}return E2={transformFeatureToGeolocationText:e,getAddressInfo:s,REVERSE_GEOCODE_COORD_RGX:/^[ ]*(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)[ ]*$/},E2}var M2,sA;function BN(){if(sA)return M2;sA=1;var e=rN(),s=aN(),u=mv(),d=sN().EventEmitter,b=oN(),E=yN(),T=EN(),t=DN(),G=RN(),W=zN(),Y=ON(),ne=FN();const J={FORWARD:0,LOCAL:1,REVERSE:2};function Q(){var ie=document.createElement("div");return ie.className="mapboxgl-ctrl-geocoder--powered-by",ie.innerHTML='<a href="https://www.mapbox.com/search-service" target="_blank">Powered by Mapbox</a>',ie}function ce(ie){this._eventEmitter=new d,this.options=u({},this.options,ie),this.inputString="",this.fresh=!0,this.lastSelected=null,this.geolocation=new Y}return ce.prototype={options:{zoom:16,flyTo:!0,trackProximity:!0,minLength:2,reverseGeocode:!1,flipCoordinates:!1,limit:5,origin:"https://api.mapbox.com",enableEventLogging:!0,marker:!0,mapboxgl:null,collapsed:!1,clearAndBlurOnEsc:!1,clearOnBlur:!1,enableGeolocation:!1,addressAccuracy:"street",getItemValue:function(ie){return ie.place_name},render:function(ie){var pe=ie.place_name.split(",");return'<div class="mapboxgl-ctrl-geocoder--suggestion"><div class="mapboxgl-ctrl-geocoder--suggestion-title">'+pe[0]+'</div><div class="mapboxgl-ctrl-geocoder--suggestion-address">'+pe.splice(1,pe.length).join(",")+"</div></div>"}},_headers:{},addTo:function(ie){function pe(be,Ie){if(!document.body.contains(Ie))throw new Error("Element provided to #addTo() exists, but is not in the DOM");const $e=be.onAdd();Ie.appendChild($e)}if(ie._controlContainer)ie.addControl(this);else if(ie instanceof HTMLElement)pe(this,ie);else if(typeof ie=="string"){const be=document.querySelectorAll(ie);if(be.length===0)throw new Error("Element ",ie,"not found.");if(be.length>1)throw new Error("Geocoder can only be added to a single html element");pe(this,be[0])}else throw new Error("Error: addTo must be a mapbox-gl-js map, an html element, or a CSS selector query for a single html element")},onAdd:function(ie){if(ie&&typeof ie!="string"&&(this._map=ie),this.setLanguage(),this.options.localGeocoderOnly||(this.geocoderService=T(E({accessToken:this.options.accessToken,origin:this.options.origin}))),this.options.localGeocoderOnly&&!this.options.localGeocoder)throw new Error("A localGeocoder function must be specified to use localGeocoderOnly mode");this.eventManager=new t(this.options),this._onChange=this._onChange.bind(this),this._onKeyDown=this._onKeyDown.bind(this),this._onPaste=this._onPaste.bind(this),this._onBlur=this._onBlur.bind(this),this._showButton=this._showButton.bind(this),this._hideButton=this._hideButton.bind(this),this._onQueryResult=this._onQueryResult.bind(this),this.clear=this.clear.bind(this),this._updateProximity=this._updateProximity.bind(this),this._collapse=this._collapse.bind(this),this._unCollapse=this._unCollapse.bind(this),this._clear=this._clear.bind(this),this._clearOnBlur=this._clearOnBlur.bind(this),this._geolocateUser=this._geolocateUser.bind(this);var pe=this.container=document.createElement("div");pe.className="mapboxgl-ctrl-geocoder mapboxgl-ctrl";var be=this.createIcon("search",'<path d="M7.4 2.5c-2.7 0-4.9 2.2-4.9 4.9s2.2 4.9 4.9 4.9c1 0 1.8-.2 2.5-.8l3.7 3.7c.2.2.4.3.8.3.7 0 1.1-.4 1.1-1.1 0-.3-.1-.5-.3-.8L11.4 10c.4-.8.8-1.6.8-2.5.1-2.8-2.1-5-4.8-5zm0 1.6c1.8 0 3.2 1.4 3.2 3.2s-1.4 3.2-3.2 3.2-3.3-1.3-3.3-3.1 1.4-3.3 3.3-3.3z"/>');this._inputEl=document.createElement("input"),this._inputEl.type="text",this._inputEl.className="mapboxgl-ctrl-geocoder--input",this.setPlaceholder(),this.options.collapsed&&(this._collapse(),this.container.addEventListener("mouseenter",this._unCollapse),this.container.addEventListener("mouseleave",this._collapse),this._inputEl.addEventListener("focus",this._unCollapse)),(this.options.collapsed||this.options.clearOnBlur)&&this._inputEl.addEventListener("blur",this._onBlur),this._inputEl.addEventListener("keydown",s(this._onKeyDown,200)),this._inputEl.addEventListener("paste",this._onPaste),this._inputEl.addEventListener("change",this._onChange),this.container.addEventListener("mouseenter",this._showButton),this.container.addEventListener("mouseleave",this._hideButton),this._inputEl.addEventListener("keyup",(function(qe){this.eventManager.keyevent(qe,this)}).bind(this));var Ie=document.createElement("div");Ie.classList.add("mapboxgl-ctrl-geocoder--pin-right"),this._clearEl=document.createElement("button"),this._clearEl.setAttribute("aria-label","Clear"),this._clearEl.addEventListener("click",this.clear),this._clearEl.className="mapboxgl-ctrl-geocoder--button";var $e=this.createIcon("close",'<path d="M3.8 2.5c-.6 0-1.3.7-1.3 1.3 0 .3.2.7.5.8L7.2 9 3 13.2c-.3.3-.5.7-.5 1 0 .6.7 1.3 1.3 1.3.3 0 .7-.2 1-.5L9 10.8l4.2 4.2c.2.3.7.3 1 .3.6 0 1.3-.7 1.3-1.3 0-.3-.2-.7-.3-1l-4.4-4L15 4.6c.3-.2.5-.5.5-.8 0-.7-.7-1.3-1.3-1.3-.3 0-.7.2-1 .3L9 7.1 4.8 2.8c-.3-.1-.7-.3-1-.3z"/>');if(this._clearEl.appendChild($e),this._loadingEl=this.createIcon("loading",'<path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"/><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"/>'),Ie.appendChild(this._clearEl),Ie.appendChild(this._loadingEl),pe.appendChild(be),pe.appendChild(this._inputEl),pe.appendChild(Ie),this.options.enableGeolocation&&this.geolocation.isSupport()){this._geolocateEl=document.createElement("button"),this._geolocateEl.setAttribute("aria-label","Geolocate"),this._geolocateEl.addEventListener("click",this._geolocateUser),this._geolocateEl.className="mapboxgl-ctrl-geocoder--button";var Le=this.createIcon("geolocate",'<path d="M12.999 3.677L2.042 8.269c-.962.403-.747 1.823.29 1.912l5.032.431.431 5.033c.089 1.037 1.509 1.252 1.912.29l4.592-10.957c.345-.822-.477-1.644-1.299-1.299z" fill="#4264fb"/>');this._geolocateEl.appendChild(Le),Ie.appendChild(this._geolocateEl),this._showGeolocateButton()}var Oe=this._typeahead=new e(this._inputEl,[],{filter:!1,minLength:this.options.minLength,limit:this.options.limit});this.setRenderFunction(this.options.render),Oe.getItemValue=this.options.getItemValue;var Ve=Oe.list.draw,Ue=this._footerNode=Q();return Oe.list.draw=function(){Ve.call(this),Ue.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),Ue.addEventListener("mouseup",(function(){this.selectingListItem=!1}).bind(this)),this.element.appendChild(Ue)},this.mapMarker=null,this._handleMarker=this._handleMarker.bind(this),this._map&&(this.options.trackProximity&&(this._updateProximity(),this._map.on("moveend",this._updateProximity)),this._mapboxgl=this.options.mapboxgl,!this._mapboxgl&&this.options.marker&&(console.error("No mapboxgl detected in options. Map markers are disabled. Please set options.mapboxgl."),this.options.marker=!1)),pe},_geolocateUser:function(){this._hideGeolocateButton(),this._showLoadingIcon(),this.geolocation.getCurrentPosition().then((function(ie){this._hideLoadingIcon();const pe={geometry:{type:"Point",coordinates:[ie.coords.longitude,ie.coords.latitude]}};this._handleMarker(pe),this._fly(pe),this._typeahead.clear(),this._typeahead.selected=!0,this.lastSelected=JSON.stringify(pe),this._showClearButton(),this.fresh=!1;const be={limit:1,language:[this.options.language],query:pe.geometry.coordinates,types:["address"]};if(this.options.localGeocoderOnly){const Ie=pe.geometry.coordinates[0]+","+pe.geometry.coordinates[1];this._setInputValue(Ie),this._eventEmitter.emit("result",{result:pe})}else this.geocoderService.reverseGeocode(be).send().then((function(Ie){const $e=Ie.body.features[0];if($e){const Le=ne.transformFeatureToGeolocationText($e,this.options.addressAccuracy);this._setInputValue(Le),$e.user_coordinates=pe.geometry.coordinates,this._eventEmitter.emit("result",{result:$e})}else this._eventEmitter.emit("result",{result:{user_coordinates:pe.geometry.coordinates}})}).bind(this))}).bind(this)).catch((function(ie){ie.code===1?this._renderUserDeniedGeolocationError():this._renderLocationError(),this._hideLoadingIcon(),this._showGeolocateButton(),this._hideAttribution()}).bind(this))},createIcon:function(ie,pe){var be=document.createElementNS("http://www.w3.org/2000/svg","svg");return be.setAttribute("class","mapboxgl-ctrl-geocoder--icon mapboxgl-ctrl-geocoder--icon-"+ie),be.setAttribute("viewBox","0 0 18 18"),be.setAttribute("xml:space","preserve"),be.setAttribute("width",18),be.setAttribute("height",18),be.innerHTML=pe,be},onRemove:function(){return this.container.parentNode.removeChild(this.container),this.options.trackProximity&&this._map&&this._map.off("moveend",this._updateProximity),this._removeMarker(),this._map=null,this},_setInputValue:function(ie){this._inputEl.value=ie,setTimeout((function(){this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0)}).bind(this),1)},_onPaste:function(ie){var pe=(ie.clipboardData||window.clipboardData).getData("text");pe.length>=this.options.minLength&&this._geocode(pe)},_onKeyDown:function(ie){var pe=27,be=9;if(ie.keyCode===pe&&this.options.clearAndBlurOnEsc)return this._clear(ie),this._inputEl.blur();var Ie=ie.target&&ie.target.shadowRoot?ie.target.shadowRoot.activeElement:ie.target,$e=Ie?Ie.value:"";if(!$e)return this.fresh=!0,ie.keyCode!==be&&this.clear(ie),this._showGeolocateButton(),this._hideClearButton();this._hideGeolocateButton(),!(ie.metaKey||[be,pe,37,39,13,38,40].indexOf(ie.keyCode)!==-1)&&Ie.value.length>=this.options.minLength&&this._geocode(Ie.value)},_showButton:function(){this._typeahead.selected&&this._showClearButton()},_hideButton:function(){this._typeahead.selected&&this._hideClearButton()},_showClearButton:function(){this._clearEl.style.display="block"},_hideClearButton:function(){this._clearEl.style.display="none"},_showGeolocateButton:function(){this._geolocateEl&&this.geolocation.isSupport()&&(this._geolocateEl.style.display="block")},_hideGeolocateButton:function(){this._geolocateEl&&(this._geolocateEl.style.display="none")},_showLoadingIcon:function(){this._loadingEl.style.display="block"},_hideLoadingIcon:function(){this._loadingEl.style.display="none"},_showAttribution:function(){this._footerNode.style.display="block"},_hideAttribution:function(){this._footerNode.style.display="none"},_onBlur:function(ie){this.options.clearOnBlur&&this._clearOnBlur(ie),this.options.collapsed&&this._collapse()},_onChange:function(){var ie=this._typeahead.selected;ie&&JSON.stringify(ie)!==this.lastSelected&&(this._hideClearButton(),this.options.flyTo&&this._fly(ie),this.options.marker&&this._mapboxgl&&this._handleMarker(ie),this._inputEl.focus(),this._inputEl.scrollLeft=0,this._inputEl.setSelectionRange(0,0),this.lastSelected=JSON.stringify(ie),this._eventEmitter.emit("result",{result:ie}),this.eventManager.select(ie,this))},_fly:function(ie){var pe;if(ie.properties&&b[ie.properties.short_code])pe=u({},this.options.flyTo),this._map&&this._map.fitBounds(b[ie.properties.short_code].bbox,pe);else if(ie.bbox){var be=ie.bbox;pe=u({},this.options.flyTo),this._map&&this._map.fitBounds([[be[0],be[1]],[be[2],be[3]]],pe)}else{var Ie={zoom:this.options.zoom};pe=u({},Ie,this.options.flyTo),ie.center?pe.center=ie.center:ie.geometry&&ie.geometry.type&&ie.geometry.type==="Point"&&ie.geometry.coordinates&&(pe.center=ie.geometry.coordinates),this._map&&this._map.flyTo(pe)}},_requestType:function(ie,pe){var be;return ie.localGeocoderOnly?be=J.LOCAL:ie.reverseGeocode&&ne.REVERSE_GEOCODE_COORD_RGX.test(pe)?be=J.REVERSE:be=J.FORWARD,be},_setupConfig:function(ie,pe){const be=["bbox","limit","proximity","countries","types","language","reverseMode","mode","autocomplete","fuzzyMatch","routing","worldview"],Ie=/[\s,]+/;var $e=this,Le=be.reduce(function(Ve,Ue){if($e.options[Ue]===void 0||$e.options[Ue]===null)return Ve;["countries","types","language"].indexOf(Ue)>-1?Ve[Ue]=$e.options[Ue].split(Ie):Ve[Ue]=$e.options[Ue];const qe=typeof $e.options[Ue].longitude=="number"&&typeof $e.options[Ue].latitude=="number";if(Ue==="proximity"&&qe){const He=$e.options[Ue].longitude,nt=$e.options[Ue].latitude;Ve[Ue]=[He,nt]}return Ve},{});switch(ie){case J.REVERSE:{var Oe=pe.split(Ie).map(function(Ve){return parseFloat(Ve,10)});$e.options.flipCoordinates||Oe.reverse(),Le.types&&Le.types[0],Le=u(Le,{query:Oe,limit:1}),["proximity","autocomplete","fuzzyMatch","bbox"].forEach(function(Ve){Ve in Le&&delete Le[Ve]})}break;case J.FORWARD:{const Ve=pe.trim();/^(-?\d{1,3}(\.\d{0,256})?)[, ]+(-?\d{1,3}(\.\d{0,256})?)?$/.test(Ve)&&(pe=pe.replace(/,/g," ")),Le=u(Le,{query:pe})}break}return Le.session_token=this.eventManager.getSessionId(),Le},_geocode:function(ie){this.inputString=ie,this._showLoadingIcon(),this._eventEmitter.emit("loading",{query:ie});const pe=this._requestType(this.options,ie),be=this._setupConfig(pe,ie);var Ie;switch(pe){case J.LOCAL:Ie=Promise.resolve();break;case J.FORWARD:Ie=this.geocoderService.forwardGeocode(be).send();break;case J.REVERSE:Ie=this.geocoderService.reverseGeocode(be).send();break}var $e=this.options.localGeocoder?this.options.localGeocoder(ie)||[]:[],Le=[],Oe=null;return Ie.catch((function(Ve){Oe=Ve}).bind(this)).then((function(Ve){this._hideLoadingIcon();var Ue={};return Ve?Ve.statusCode=="200"&&(Ue=Ve.body,Ue.request=Ve.request,Ue.headers=Ve.headers,this._headers=Ve.headers):Ue={type:"FeatureCollection",features:[]},Ue.config=be,this.fresh&&(this.eventManager.start(this),this.fresh=!1),Ue.features&&Ue.features.length&&Ue.features.map(function(qe){qe._source="mapbox"}),Ue.features=Ue.features?$e.concat(Ue.features):$e,this.options.externalGeocoder?(Le=this.options.externalGeocoder(ie,Ue.features)||Promise.resolve([]),Le.then(function(qe){return Ue.features=Ue.features?qe.concat(Ue.features):qe,Ue},function(){return Ue})):Ue}).bind(this)).then((function(Ve){if(Oe)throw Oe;this.options.filter&&Ve.features.length&&(Ve.features=Ve.features.filter(this.options.filter)),Ve.features.length?(this._showClearButton(),this._hideGeolocateButton(),this._showAttribution(),this._eventEmitter.emit("results",Ve),this._typeahead.update(Ve.features)):(this._hideClearButton(),this._hideAttribution(),this._typeahead.selected=null,this._renderNoResults(),this._eventEmitter.emit("results",Ve))}).bind(this)).catch((function(Ve){this._hideLoadingIcon(),this._hideAttribution(),$e.length&&this.options.localGeocoder||Le.length&&this.options.externalGeocoder?(this._showClearButton(),this._hideGeolocateButton(),this._typeahead.update($e)):(this._hideClearButton(),this._typeahead.selected=null,this._renderError()),this._eventEmitter.emit("results",{features:$e}),this._eventEmitter.emit("error",{error:Ve})}).bind(this)),Ie},_clear:function(ie){ie&&ie.preventDefault(),this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this.eventManager.sessionIncrementer++,this._onChange(),this._hideClearButton(),this._showGeolocateButton(),this._removeMarker(),this.lastSelected=null,this._eventEmitter.emit("clear"),this.fresh=!0},clear:function(ie){this._clear(ie),this._inputEl.focus()},_clearOnBlur:function(ie){var pe=this;ie.relatedTarget&&pe._clear(ie)},_onQueryResult:function(ie){var pe=ie.body;if(pe.features.length){var be=pe.features[0];this._typeahead.selected=be,this._inputEl.value=be.place_name,this._onChange()}},_updateProximity:function(){if(!(!this._map||!this.options.trackProximity))if(this._map.getZoom()>9){var ie=this._map.getCenter().wrap();this.setProximity({longitude:ie.lng,latitude:ie.lat},!1)}else this.setProximity(null,!1)},_collapse:function(){!this._inputEl.value&&this._inputEl!==document.activeElement&&this.container.classList.add("mapboxgl-ctrl-geocoder--collapsed")},_unCollapse:function(){this.container.classList.remove("mapboxgl-ctrl-geocoder--collapsed")},query:function(ie){return this._geocode(ie).then(this._onQueryResult),this},_renderError:function(){var ie="<div class='mapbox-gl-geocoder--error'>There was an error reaching the server</div>";this._renderMessage(ie)},_renderLocationError:function(){var ie="<div class='mapbox-gl-geocoder--error'>A location error has occurred</div>";this._renderMessage(ie)},_renderNoResults:function(){var ie="<div class='mapbox-gl-geocoder--error mapbox-gl-geocoder--no-results'>No results found</div>";this._renderMessage(ie)},_renderUserDeniedGeolocationError:function(){var ie="<div class='mapbox-gl-geocoder--error'>Geolocation permission denied</div>";this._renderMessage(ie)},_renderMessage:function(ie){this._typeahead.update([]),this._typeahead.selected=null,this._typeahead.clear(),this._typeahead.renderError(ie)},_getPlaceholderText:function(){if(this.options.placeholder)return this.options.placeholder;if(this.options.language){var ie=this.options.language.split(",")[0],pe=W.language(ie),be=G.placeholder[pe];if(be)return be}return"Search"},setInput:function(ie,pe){return pe===void 0&&(pe=!1),this._inputEl.value=ie,this._typeahead.selected=null,this._typeahead.clear(),ie.length>=this.options.minLength&&(pe?this._geocode(ie):this._onChange()),this},setProximity:function(ie,pe=!0){return this.options.proximity=ie,pe&&(this.options.trackProximity=!1),this},getProximity:function(){return this.options.proximity},setRenderFunction:function(ie){return ie&&typeof ie=="function"&&(this._typeahead.render=ie),this},getRenderFunction:function(){return this._typeahead.render},setLanguage:function(ie){var pe=navigator.language||navigator.userLanguage||navigator.browserLanguage;return this.options.language=ie||this.options.language||pe,this},getLanguage:function(){return this.options.language},getZoom:function(){return this.options.zoom},setZoom:function(ie){return this.options.zoom=ie,this},getFlyTo:function(){return this.options.flyTo},setFlyTo:function(ie){return this.options.flyTo=ie,this},getPlaceholder:function(){return this.options.placeholder},setPlaceholder:function(ie){return this.options.placeholder=ie||this._getPlaceholderText(),this._inputEl.placeholder=this.options.placeholder,this._inputEl.setAttribute("aria-label",this.options.placeholder),this},getBbox:function(){return this.options.bbox},setBbox:function(ie){return this.options.bbox=ie,this},getCountries:function(){return this.options.countries},setCountries:function(ie){return this.options.countries=ie,this},getTypes:function(){return this.options.types},setTypes:function(ie){return this.options.types=ie,this},getMinLength:function(){return this.options.minLength},setMinLength:function(ie){return this.options.minLength=ie,this._typeahead&&(this._typeahead.options.minLength=ie),this},getLimit:function(){return this.options.limit},setLimit:function(ie){return this.options.limit=ie,this._typeahead&&(this._typeahead.options.limit=ie),this},getFilter:function(){return this.options.filter},setFilter:function(ie){return this.options.filter=ie,this},setOrigin:function(ie){return this.options.origin=ie,this.geocoderService=T(E({accessToken:this.options.accessToken,origin:this.options.origin})),this},getOrigin:function(){return this.options.origin},setAccessToken:function(ie){return this.options.accessToken=ie,this.geocoderService=T(E({accessToken:this.options.accessToken,origin:this.options.origin})),this},setAutocomplete:function(ie){return this.options.autocomplete=ie,this},getAutocomplete:function(){return this.options.autocomplete},setFuzzyMatch:function(ie){return this.options.fuzzyMatch=ie,this},getFuzzyMatch:function(){return this.options.fuzzyMatch},setRouting:function(ie){return this.options.routing=ie,this},getRouting:function(){return this.options.routing},setWorldview:function(ie){return this.options.worldview=ie,this},getWorldview:function(){return this.options.worldview},_handleMarker:function(ie){if(this._map){this._removeMarker();var pe={color:"#4668F2"},be=u({},pe,this.options.marker);return this.mapMarker=new this._mapboxgl.Marker(be),ie.center?this.mapMarker.setLngLat(ie.center).addTo(this._map):ie.geometry&&ie.geometry.type&&ie.geometry.type==="Point"&&ie.geometry.coordinates&&this.mapMarker.setLngLat(ie.geometry.coordinates).addTo(this._map),this}},_removeMarker:function(){this.mapMarker&&(this.mapMarker.remove(),this.mapMarker=null)},on:function(ie,pe){return this._eventEmitter.on(ie,pe),this},off:function(ie,pe){return this._eventEmitter.removeListener(ie,pe),this.eventManager.remove(),this}},M2=ce,M2}var VN=BN();const SR=Z_(VN),I2=new Map,NN=/onMb([A-Z])(.+)/;function jN(e){return I2.has(e)||I2.set(e,e.replace(NN,(s,u,d)=>u.toLowerCase()+d)),I2.get(e)}function UN(e,s,u=[],d=null){const b=s5(),E=Fe(()=>Object.entries(b).filter(([W,Y])=>W.startsWith("on")&&typeof Y=="function").map(([W])=>W)),T=new Map;function t(W){Array.isArray(W)&&W.forEach(Y=>{const ne=T.get(Y);typeof ne=="function"&&ne()})}function G(W){Array.isArray(W)&&W.forEach(Y=>{const ne=jN(Y);if(!u.includes(ne))return;const J=(...Q)=>{e(`mb-${ne}`,...Q)};d?(Ps(s).on(ne,d,J),T.set(Y,()=>{Ps(s).off(ne,d,J)})):(Ps(s).on(ne,J),T.set(Y,()=>{Ps(s).off(ne,J)}))})}Pi(E,(W,Y)=>{const ne=Array.isArray(W)?(Y??[]).filter(Q=>!W.includes(Q)):Y??[],J=Array.isArray(Y)?(W??[]).filter(Q=>!Y.includes(Q)):W??[];if(Ps(s))t(ne),G(J);else{const Q=Pi(s,ce=>{ce&&(t(ne),G(J),Q())})}},{immediate:!0})}function $N(e){return e.charAt(0).toUpperCase()+e.slice(1)}function GN(e,s,u){function d(b){Object.keys(e).filter(E=>e[E]!==void 0&&e[E]!==null).forEach(E=>{var T;const t=E==="mapStyle"?"setStyle":`set${$N(E)}`,G=typeof b[t]=="function",W=typeof u[E]>"u"||"bind"in u[E]?((T=u[E])==null?void 0:T.bind)??!1:!0;if(!G||!W)return;const{type:Y}=u[E],ne={deep:Y===Object||Array.isArray(Y)&&Y.includes(Object)};Pi(()=>e[E],J=>{b[t](J)},ne)})}if(Ps(s))d(Ps(s));else{const b=Pi(s,E=>{E&&(d(E),b())})}}if(!kc)throw new Error("mapboxgl is not installed.");if(!SR)throw new Error("MapboxGeocoder is not installed.");const qN={key:0},HN={key:1};if(!kc)throw new Error("mapboxgl is not installed.");const{LngLatBounds:oA,LngLat:ZN}=kc,lA={accessToken:{type:String,default:"no-token"},container:{type:[typeof HTMLElement<"u"&&HTMLElement,String],default:void 0},minZoom:{type:Number,default:0},maxZoom:{type:Number,default:22},minPitch:{type:Number,default:0},maxPitch:{type:Number,default:60},mapStyle:{type:[Object,String],required:!0},hash:{type:Boolean,default:!1},interactive:{type:Boolean,default:!0},bearingSnap:{type:Number,default:7},pitchWithRotate:{type:Boolean,default:!0},clickTolerance:{type:Number,default:3},attributionControl:{type:Boolean,default:!0},customAttribution:{type:[String,Array],default:null},logoPosition:{type:String,default:"bottom-left"},failIfMajorPerformanceCaveat:{type:Boolean,default:!1},preserveDrawingBuffer:{type:Boolean,default:!1},antialias:{type:Boolean,default:!1},refreshExpiredTiles:{type:Boolean,default:!0},maxBounds:{type:[oA,Array],default:void 0},scrollZoom:{type:[Boolean,Object],default:!0},boxZoom:{type:Boolean,default:!0},dragRotate:{type:Boolean,default:!0},dragPan:{type:[Boolean,Object],default:!0},keyboard:{type:Boolean,default:!0},doubleClickZoom:{type:Boolean,default:!0},touchZoomRotate:{type:[Boolean,Object],default:!0},trackResize:{type:Boolean,default:!0},center:{type:[ZN,Array,Object],default:()=>[0,0]},zoom:{type:Number,default:0},bearing:{type:Number,default:0},pitch:{type:Number,default:0},bounds:{type:[oA,Array],default:void 0},fitBoundsOptions:{type:Object,default:null},renderWorldCopies:{type:Boolean,default:!0},maxTileCacheSize:{type:Number,default:null},localIdeographFontFamily:{type:String,default:"sans-serif"},transformRequest:{type:Function,default:null},collectResourceTiming:{type:Boolean,default:!1},fadeDuration:{type:Number,default:300},crossSourceCollisions:{type:Boolean,default:!0},cooperativeGestures:{type:Boolean},language:{type:[String,Array],default:null},locale:{type:Object,default:null},localFontFamily:{type:[Boolean,String],default:!1},minTileCacheSize:{type:Number,default:null},optimizeForTerrain:{type:Boolean,default:!0},performanceMetricsCollection:{type:Boolean,default:!0},projection:{type:[String,Object],default:"mercator"},testMode:{type:Boolean,default:!1},touchPitch:{type:[Boolean,Object],default:!0},useWebGL2:{type:Boolean,default:!1},worldview:{type:String,default:null}},WN=["boxzoomcancel","boxzoomend","boxzoomstart","click","contextmenu","data","dataloading","dblclick","drag","dragend","dragstart","error","idle","load","mousedown","mouseenter","mouseleave","mousemove","mouseout","mouseover","mouseup","move","moveend","movestart","pitch","pitchend","pitchstart","remove","render","resize","rotate","rotateend","rotatestart","sourcedata","sourcedataloading","styledata","styledataloading","styleimagemissing","touchcancel","touchend","touchmove","touchstart","webglcontextlost","webglcontextrestored","wheel","zoom","zoomend","zoomstart"],XN={inheritAttrs:!1},YN=mo({...XN,__name:"MapboxMap",props:lA,setup(e,{expose:s,emit:u}){const d=e,b=u,E=Bi(null);xa("mapbox-map",E);const T=yi(),t=yi(!1),G=Fe(()=>{const{accessToken:W,mapStyle:Y,...ne}=d;return!ne.container&&T.value&&(ne.container=T.value),{style:Y,...ne}});return UN(b,E,WN),GN(d,E,lA),Ua(()=>{kc.accessToken=d.accessToken,E.value=new kc.Map(G.value),E.value.on("load",()=>{t.value=!0}),b("mb-created",E.value);const W=new ResizeObserver(()=>{E.value.resize()});W.observe(G.value.container),Tl(()=>{W.disconnect(),E.value.remove()})}),s({map:E}),(W,Y)=>(ja(),Gs(sr,null,[Ys("div",oi({ref_key:"root",ref:T},W.$attrs),null,16),t.value?(ja(),Gs("div",qN,[Ac(W.$slots,"default")])):(ja(),Gs("div",HN,[Ac(W.$slots,"loader")]))],64))}});if(!kc)throw new Error("mapboxgl is not installed.");if(!kc)throw new Error("mapboxgl is not installed.");const KN="pk.eyJ1Ijoia2NsZXdpcyIsImEiOiJ0MkF4dTV3In0.x4ialkeBLyILvKlWOLxNzQ",JN="mapbox://styles/mapbox/streets-v11",QN=yi();Fe(()=>{var e;return(e=QN.value)==null?void 0:e.map});const e6={components:{MapboxMap:YN},props:{accessToken:{type:String,default:KN},style:{type:String,default:JN}}};function t6(e,s,u,d,b,E){const T=Ul("MapboxMap");return ja(),Em(T,{ref:"mbMap",class:"censusMap","access-Token":u.accessToken,"map-style":u.style,center:[-95.9872222,36.1619444],zoom:16},null,8,["access-Token","map-style"])}const n6=H_(e6,[["render",t6]]),i6={name:"current",components:{GLMap:n6}};function r6(e,s,u,d,b,E){const T=Ul("GLMap");return ja(),Em(T)}const a6=H_(i6,[["render",r6]]),s6=[{path:"/",name:"Home",component:VV},{path:"/maps/1910",name:"1910",component:XV},{path:"/maps/1920",name:"1920",component:JV},{path:"/maps/current",name:"current",component:a6}],o6=IV({history:rV(),routes:s6});function Du(e,s){let u;function d(){u=XT(),u.run(()=>s.length?s(()=>{u==null||u.stop(),d()}):s())}Pi(e,b=>{b&&!u?d():b||(u==null||u.stop(),u=void 0)},{immediate:!0}),nu(()=>{u==null||u.stop()})}const qa=typeof window<"u",_C=qa&&"IntersectionObserver"in window,l6=qa&&("ontouchstart"in window||window.navigator.maxTouchPoints>0),cA=qa&&"EyeDropper"in window;function uA(e,s,u){c6(e,s),s.set(e,u)}function c6(e,s){if(s.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function u6(e,s,u){return e.set(TR(e,s),u),u}function T_(e,s){return e.get(TR(e,s))}function TR(e,s,u){if(typeof e=="function"?e===s:e.has(s))return arguments.length<3?s:u;throw new TypeError("Private element is not present on this object")}function CR(e,s,u){const d=s.length-1;if(d<0)return e===void 0?u:e;for(let b=0;b<d;b++){if(e==null)return u;e=e[s[b]]}return e==null||e[s[d]]===void 0?u:e[s[d]]}function Gp(e,s){if(e===s)return!0;if(e instanceof Date&&s instanceof Date&&e.getTime()!==s.getTime()||e!==Object(e)||s!==Object(s))return!1;const u=Object.keys(e);return u.length!==Object.keys(s).length?!1:u.every(d=>Gp(e[d],s[d]))}function F_(e,s,u){return e==null||!s||typeof s!="string"?u:e[s]!==void 0?e[s]:(s=s.replace(/\[(\w+)\]/g,".$1"),s=s.replace(/^\./,""),CR(e,s.split("."),u))}function Sl(e,s,u){if(s===!0)return e===void 0?u:e;if(s==null||typeof s=="boolean")return u;if(e!==Object(e)){if(typeof s!="function")return u;const b=s(e,u);return typeof b>"u"?u:b}if(typeof s=="string")return F_(e,s,u);if(Array.isArray(s))return CR(e,s,u);if(typeof s!="function")return u;const d=s(e,u);return typeof d>"u"?u:d}function Vp(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return Array.from({length:e},(u,d)=>s+d)}function Ji(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"px";if(!(e==null||e===""))return isNaN(+e)?String(e):isFinite(+e)?`${Number(e)}${s}`:void 0}function q1(e){return e!==null&&typeof e=="object"&&!Array.isArray(e)}function hA(e){let s;return e!==null&&typeof e=="object"&&((s=Object.getPrototypeOf(e))===Object.prototype||s===null)}function yC(e){if(e&&"$el"in e){const s=e.$el;return(s==null?void 0:s.nodeType)===Node.TEXT_NODE?s.nextElementSibling:s}return e}const dA=Object.freeze({enter:13,tab:9,delete:46,esc:27,space:32,up:38,down:40,left:37,right:39,end:35,home:36,del:46,backspace:8,insert:45,pageup:33,pagedown:34,shift:16}),rT=Object.freeze({enter:"Enter",tab:"Tab",delete:"Delete",esc:"Escape",space:"Space",up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight",end:"End",home:"Home",del:"Delete",backspace:"Backspace",insert:"Insert",pageup:"PageUp",pagedown:"PageDown",shift:"Shift"});function ER(e){return Object.keys(e)}function I_(e,s){return s.every(u=>e.hasOwnProperty(u))}function vC(e,s){const u={},d=new Set(Object.keys(e));for(const b of s)d.has(b)&&(u[b]=e[b]);return u}function aT(e,s,u){const d=Object.create(null),b=Object.create(null);for(const E in e)s.some(T=>T instanceof RegExp?T.test(E):T===E)?d[E]=e[E]:b[E]=e[E];return[d,b]}function ul(e,s){const u={...e};return s.forEach(d=>delete u[d]),u}function H1(e,s){const u={};return s.forEach(d=>u[d]=e[d]),u}const MR=/^on[^a-z]/,Z1=e=>MR.test(e),h6=["onAfterscriptexecute","onAnimationcancel","onAnimationend","onAnimationiteration","onAnimationstart","onAuxclick","onBeforeinput","onBeforescriptexecute","onChange","onClick","onCompositionend","onCompositionstart","onCompositionupdate","onContextmenu","onCopy","onCut","onDblclick","onFocusin","onFocusout","onFullscreenchange","onFullscreenerror","onGesturechange","onGestureend","onGesturestart","onGotpointercapture","onInput","onKeydown","onKeypress","onKeyup","onLostpointercapture","onMousedown","onMousemove","onMouseout","onMouseover","onMouseup","onMousewheel","onPaste","onPointercancel","onPointerdown","onPointerenter","onPointerleave","onPointermove","onPointerout","onPointerover","onPointerup","onReset","onSelect","onSubmit","onTouchcancel","onTouchend","onTouchmove","onTouchstart","onTransitioncancel","onTransitionend","onTransitionrun","onTransitionstart","onWheel"],d6=["ArrowUp","ArrowDown","ArrowRight","ArrowLeft","Enter","Escape","Tab"," "];function f6(e){return e.isComposing&&d6.includes(e.key)}function Og(e){const[s,u]=aT(e,[MR]),d=ul(s,h6),[b,E]=aT(u,["class","style","id",/^data-/]);return Object.assign(b,s),Object.assign(E,d),[b,E]}function po(e){return e==null?[]:Array.isArray(e)?e:[e]}function p6(e,s){let u=0;const d=function(){for(var b=arguments.length,E=new Array(b),T=0;T<b;T++)E[T]=arguments[T];clearTimeout(u),u=setTimeout(()=>e(...E),Ps(s))};return d.clear=()=>{clearTimeout(u)},d.immediate=e,d}function Ko(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1;return Math.max(s,Math.min(u,e))}function fA(e){const s=e.toString().trim();return s.includes(".")?s.length-s.indexOf(".")-1:0}function pA(e,s){let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"0";return e+u.repeat(Math.max(0,s-e.length))}function mA(e,s){return(arguments.length>2&&arguments[2]!==void 0?arguments[2]:"0").repeat(Math.max(0,s-e.length))+e}function m6(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const u=[];let d=0;for(;d<e.length;)u.push(e.substr(d,s)),d+=s;return u}function gA(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1e3;if(e<s)return`${e} B`;const u=s===1024?["Ki","Mi","Gi"]:["k","M","G"];let d=-1;for(;Math.abs(e)>=s&&d<u.length-1;)e/=s,++d;return`${e.toFixed(1)} ${u[d]}B`}function Qc(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},u=arguments.length>2?arguments[2]:void 0;const d={};for(const b in e)d[b]=e[b];for(const b in s){const E=e[b],T=s[b];if(hA(E)&&hA(T)){d[b]=Qc(E,T,u);continue}if(u&&Array.isArray(E)&&Array.isArray(T)){d[b]=u(E,T);continue}d[b]=T}return d}function IR(e){return e.map(s=>s.type===sr?IR(s.children):s).flat()}function k_(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";if(k_.cache.has(e))return k_.cache.get(e);const s=e.replace(/[^a-z]/gi,"-").replace(/\B([A-Z])/g,"-$1").toLowerCase();return k_.cache.set(e,s),s}k_.cache=new Map;function Zy(e,s){if(!s||typeof s!="object")return[];if(Array.isArray(s))return s.map(u=>Zy(e,u)).flat(1);if(s.suspense)return Zy(e,s.ssContent);if(Array.isArray(s.children))return s.children.map(u=>Zy(e,u)).flat(1);if(s.component){if(Object.getOwnPropertySymbols(s.component.provides).includes(e))return[s.component];if(s.component.subTree)return Zy(e,s.component.subTree).flat(1)}return[]}var q0=new WeakMap,Ny=new WeakMap;class g6{constructor(s){uA(this,q0,[]),uA(this,Ny,0),this.size=s}push(s){T_(q0,this)[T_(Ny,this)]=s,u6(Ny,this,(T_(Ny,this)+1)%this.size)}values(){return T_(q0,this).slice(T_(Ny,this)).concat(T_(q0,this).slice(0,T_(Ny,this)))}}function _6(e){return"touches"in e?{clientX:e.touches[0].clientX,clientY:e.touches[0].clientY}:{clientX:e.clientX,clientY:e.clientY}}function xC(e){const s=$l({}),u=Fe(e);return Jo(()=>{for(const d in u.value)s[d]=u.value[d]},{flush:"sync"}),zg(s)}function w1(e,s){return e.includes(s)}function PR(e){return e[2].toLowerCase()+e.slice(3)}const lc=()=>[Function,Array];function _A(e,s){return s="on"+$p(s),!!(e[s]||e[`${s}Once`]||e[`${s}Capture`]||e[`${s}OnceCapture`]||e[`${s}CaptureOnce`])}function W1(e){for(var s=arguments.length,u=new Array(s>1?s-1:0),d=1;d<s;d++)u[d-1]=arguments[d];if(Array.isArray(e))for(const b of e)b(...u);else typeof e=="function"&&e(...u)}function Jx(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;const u=["button","[href]",'input:not([type="hidden"])',"select","textarea","[tabindex]"].map(d=>`${d}${s?':not([tabindex="-1"])':""}:not([disabled])`).join(", ");return[...e.querySelectorAll(u)]}function AR(e,s,u){let d,b=e.indexOf(document.activeElement);const E=s==="next"?1:-1;do b+=E,d=e[b];while((!d||d.offsetParent==null||!((u==null?void 0:u(d))??!0))&&b<e.length&&b>=0);return d}function D_(e,s){var d,b,E,T;const u=Jx(e);if(!s)(e===document.activeElement||!e.contains(document.activeElement))&&((d=u[0])==null||d.focus());else if(s==="first")(b=u[0])==null||b.focus();else if(s==="last")(E=u.at(-1))==null||E.focus();else if(typeof s=="number")(T=u[s])==null||T.focus();else{const t=AR(u,s);t?t.focus():D_(e,s==="next"?"first":"last")}}function H0(e){return e==null||typeof e=="string"&&e.trim()===""}function kR(){}function sv(e,s){if(!(qa&&typeof CSS<"u"&&typeof CSS.supports<"u"&&CSS.supports(`selector(${s})`)))return null;try{return!!e&&e.matches(s)}catch{return null}}function X1(e){return e.some(s=>nv(s)?s.type===Jc?!1:s.type!==sr||X1(s.children):!0)?e:null}function y6(e,s){if(!qa||e===0)return s(),()=>{};const u=window.setTimeout(s,e);return()=>window.clearTimeout(u)}function v6(e,s){const u=e.clientX,d=e.clientY,b=s.getBoundingClientRect(),E=b.left,T=b.top,t=b.right,G=b.bottom;return u>=E&&u<=t&&d>=T&&d<=G}function S1(){const e=Bi(),s=u=>{e.value=u};return Object.defineProperty(s,"value",{enumerable:!0,get:()=>e.value,set:u=>e.value=u}),Object.defineProperty(s,"el",{enumerable:!0,get:()=>yC(e.value)}),s}function ov(e){const s=e.key.length===1,u=!e.ctrlKey&&!e.metaKey&&!e.altKey;return s&&u}const DR=["top","bottom"],x6=["start","end","left","right"];function sT(e,s){let[u,d]=e.split(" ");return d||(d=w1(DR,u)?"start":w1(x6,u)?"top":"center"),{side:oT(u,s),align:oT(d,s)}}function oT(e,s){return e==="start"?s?"right":"left":e==="end"?s?"left":"right":e}function P2(e){return{side:{center:"center",top:"bottom",bottom:"top",left:"right",right:"left"}[e.side],align:e.align}}function A2(e){return{side:e.side,align:{center:"center",top:"bottom",bottom:"top",left:"right",right:"left"}[e.align]}}function yA(e){return{side:e.align,align:e.side}}function vA(e){return w1(DR,e.side)?"y":"x"}class R_{constructor(s){let{x:u,y:d,width:b,height:E}=s;this.x=u,this.y=d,this.width=b,this.height=E}get top(){return this.y}get bottom(){return this.y+this.height}get left(){return this.x}get right(){return this.x+this.width}}function xA(e,s){return{x:{before:Math.max(0,s.left-e.left),after:Math.max(0,e.right-s.right)},y:{before:Math.max(0,s.top-e.top),after:Math.max(0,e.bottom-s.bottom)}}}function RR(e){return Array.isArray(e)?new R_({x:e[0],y:e[1],width:0,height:0}):e.getBoundingClientRect()}function bC(e){const s=e.getBoundingClientRect(),u=getComputedStyle(e),d=u.transform;if(d){let b,E,T,t,G;if(d.startsWith("matrix3d("))b=d.slice(9,-1).split(/, /),E=+b[0],T=+b[5],t=+b[12],G=+b[13];else if(d.startsWith("matrix("))b=d.slice(7,-1).split(/, /),E=+b[0],T=+b[3],t=+b[4],G=+b[5];else return new R_(s);const W=u.transformOrigin,Y=s.x-t-(1-E)*parseFloat(W),ne=s.y-G-(1-T)*parseFloat(W.slice(W.indexOf(" ")+1)),J=E?s.width/E:e.offsetWidth+1,Q=T?s.height/T:e.offsetHeight+1;return new R_({x:Y,y:ne,width:J,height:Q})}else return new R_(s)}function P_(e,s,u){if(typeof e.animate>"u")return{finished:Promise.resolve()};let d;try{d=e.animate(s,u)}catch{return{finished:Promise.resolve()}}return typeof d.finished>"u"&&(d.finished=new Promise(b=>{d.onfinish=()=>{b(d)}})),d}const c1=new WeakMap;function b6(e,s){Object.keys(s).forEach(u=>{if(Z1(u)){const d=PR(u),b=c1.get(e);if(s[u]==null)b==null||b.forEach(E=>{const[T,t]=E;T===d&&(e.removeEventListener(d,t),b.delete(E))});else if(!b||![...b].some(E=>E[0]===d&&E[1]===s[u])){e.addEventListener(d,s[u]);const E=b||new Set;E.add([d,s[u]]),c1.has(e)||c1.set(e,E)}}else s[u]==null?e.removeAttribute(u):e.setAttribute(u,s[u])})}function w6(e,s){Object.keys(s).forEach(u=>{if(Z1(u)){const d=PR(u),b=c1.get(e);b==null||b.forEach(E=>{const[T,t]=E;T===d&&(e.removeEventListener(d,t),b.delete(E))})}else e.removeAttribute(u)})}const jy=2.4,bA=.2126729,wA=.7151522,SA=.072175,S6=.55,T6=.58,C6=.57,E6=.62,Z0=.03,TA=1.45,M6=5e-4,I6=1.25,P6=1.25,A6=.078,CA=12.82051282051282,W0=.06,k6=.001;function EA(e,s){const u=(e.r/255)**jy,d=(e.g/255)**jy,b=(e.b/255)**jy,E=(s.r/255)**jy,T=(s.g/255)**jy,t=(s.b/255)**jy;let G=u*bA+d*wA+b*SA,W=E*bA+T*wA+t*SA;if(G<=Z0&&(G+=(Z0-G)**TA),W<=Z0&&(W+=(Z0-W)**TA),Math.abs(W-G)<M6)return 0;let Y;if(W>G){const ne=(W**S6-G**T6)*I6;Y=ne<k6?0:ne<A6?ne-ne*CA*W0:ne-W0}else{const ne=(W**E6-G**C6)*P6;Y=ne>-.001?0:ne>-.078?ne-ne*CA*W0:ne+W0}return Y*100}function D6(e,s){s=Array.isArray(s)?s.slice(0,-1).map(u=>`'${u}'`).join(", ")+` or '${s.at(-1)}'`:`'${s}'`}const T1=.20689655172413793,R6=e=>e>T1**3?Math.cbrt(e):e/(3*T1**2)+4/29,L6=e=>e>T1?e**3:3*T1**2*(e-4/29);function LR(e){const s=R6,u=s(e[1]);return[116*u-16,500*(s(e[0]/.95047)-u),200*(u-s(e[2]/1.08883))]}function zR(e){const s=L6,u=(e[0]+16)/116;return[s(u+e[1]/500)*.95047,s(u),s(u-e[2]/200)*1.08883]}const z6=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]],O6=e=>e<=.0031308?e*12.92:1.055*e**(1/2.4)-.055,F6=[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],B6=e=>e<=.04045?e/12.92:((e+.055)/1.055)**2.4;function OR(e){const s=Array(3),u=O6,d=z6;for(let b=0;b<3;++b)s[b]=Math.round(Ko(u(d[b][0]*e[0]+d[b][1]*e[1]+d[b][2]*e[2]))*255);return{r:s[0],g:s[1],b:s[2]}}function wC(e){let{r:s,g:u,b:d}=e;const b=[0,0,0],E=B6,T=F6;s=E(s/255),u=E(u/255),d=E(d/255);for(let t=0;t<3;++t)b[t]=T[t][0]*s+T[t][1]*u+T[t][2]*d;return b}function lT(e){return!!e&&/^(#|var\(--|(rgb|hsl)a?\()/.test(e)}function V6(e){return lT(e)&&!/^((rgb|hsl)a?\()?var\(--/.test(e)}const MA=/^(?<fn>(?:rgb|hsl)a?)\((?<values>.+)\)/,N6={rgb:(e,s,u,d)=>({r:e,g:s,b:u,a:d}),rgba:(e,s,u,d)=>({r:e,g:s,b:u,a:d}),hsl:(e,s,u,d)=>IA({h:e,s,l:u,a:d}),hsla:(e,s,u,d)=>IA({h:e,s,l:u,a:d}),hsv:(e,s,u,d)=>Im({h:e,s,v:u,a:d}),hsva:(e,s,u,d)=>Im({h:e,s,v:u,a:d})};function Gh(e){if(typeof e=="number")return{r:(e&16711680)>>16,g:(e&65280)>>8,b:e&255};if(typeof e=="string"&&MA.test(e)){const{groups:s}=e.match(MA),{fn:u,values:d}=s,b=d.split(/,\s*/).map(E=>E.endsWith("%")&&["hsl","hsla","hsv","hsva"].includes(u)?parseFloat(E)/100:parseFloat(E));return N6[u](...b)}else if(typeof e=="string"){let s=e.startsWith("#")?e.slice(1):e;return[3,4].includes(s.length)?s=s.split("").map(u=>u+u).join(""):[6,8].includes(s.length),jR(s)}else if(typeof e=="object"){if(I_(e,["r","g","b"]))return e;if(I_(e,["h","s","l"]))return Im(SC(e));if(I_(e,["h","s","v"]))return Im(e)}throw new TypeError(`Invalid color: ${e==null?e:String(e)||e.constructor.name}
Expected #hex, #hexa, rgb(), rgba(), hsl(), hsla(), object or number`)}function Im(e){const{h:s,s:u,v:d,a:b}=e,E=t=>{const G=(t+s/60)%6;return d-d*u*Math.max(Math.min(G,4-G,1),0)},T=[E(5),E(3),E(1)].map(t=>Math.round(t*255));return{r:T[0],g:T[1],b:T[2],a:b}}function IA(e){return Im(SC(e))}function pb(e){if(!e)return{h:0,s:1,v:1,a:1};const s=e.r/255,u=e.g/255,d=e.b/255,b=Math.max(s,u,d),E=Math.min(s,u,d);let T=0;b!==E&&(b===s?T=60*(0+(u-d)/(b-E)):b===u?T=60*(2+(d-s)/(b-E)):b===d&&(T=60*(4+(s-u)/(b-E)))),T<0&&(T=T+360);const t=b===0?0:(b-E)/b,G=[T,t,b];return{h:G[0],s:G[1],v:G[2],a:e.a}}function FR(e){const{h:s,s:u,v:d,a:b}=e,E=d-d*u/2,T=E===1||E===0?0:(d-E)/Math.min(E,1-E);return{h:s,s:T,l:E,a:b}}function SC(e){const{h:s,s:u,l:d,a:b}=e,E=d+u*Math.min(d,1-d),T=E===0?0:2-2*d/E;return{h:s,s:T,v:E,a:b}}function BR(e){let{r:s,g:u,b:d,a:b}=e;return b===void 0?`rgb(${s}, ${u}, ${d})`:`rgba(${s}, ${u}, ${d}, ${b})`}function VR(e){return BR(Im(e))}function X0(e){const s=Math.round(e).toString(16);return("00".substr(0,2-s.length)+s).toUpperCase()}function NR(e){let{r:s,g:u,b:d,a:b}=e;return`#${[X0(s),X0(u),X0(d),b!==void 0?X0(Math.round(b*255)):""].join("")}`}function jR(e){e=U6(e);let[s,u,d,b]=m6(e,2).map(E=>parseInt(E,16));return b=b===void 0?b:b/255,{r:s,g:u,b:d,a:b}}function j6(e){const s=jR(e);return pb(s)}function UR(e){return NR(Im(e))}function U6(e){return e.startsWith("#")&&(e=e.slice(1)),e=e.replace(/([^0-9a-f])/gi,"F"),(e.length===3||e.length===4)&&(e=e.split("").map(s=>s+s).join("")),e.length!==6&&(e=pA(pA(e,6),8,"F")),e}function $6(e,s){const u=LR(wC(e));return u[0]=u[0]+s*10,OR(zR(u))}function G6(e,s){const u=LR(wC(e));return u[0]=u[0]-s*10,OR(zR(u))}function cT(e){const s=Gh(e);return wC(s)[1]}function q6(e,s){const u=cT(e),d=cT(s),b=Math.max(u,d),E=Math.min(u,d);return(b+.05)/(E+.05)}function $R(e){const s=Math.abs(EA(Gh(0),Gh(e)));return Math.abs(EA(Gh(16777215),Gh(e)))>Math.min(s,50)?"#fff":"#000"}function vn(e,s){return u=>Object.keys(e).reduce((d,b)=>{const T=typeof e[b]=="object"&&e[b]!=null&&!Array.isArray(e[b])?e[b]:{type:e[b]};return u&&b in u?d[b]={...T,default:u[b]}:d[b]=T,s&&!d[b].source&&(d[b].source=s),d},{})}const tr=vn({class:[String,Array,Object],style:{type:[String,Array,Object],default:null}},"component");function Po(e,s){const u=jf();if(!u)throw new Error(`[Vuetify] ${e} must be called from inside a setup function`);return u}function qp(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"composables";const s=Po(e).type;return k_((s==null?void 0:s.aliasName)||(s==null?void 0:s.name))}let GR=0,u1=new WeakMap;function uc(){const e=Po("getUid");if(u1.has(e))return u1.get(e);{const s=GR++;return u1.set(e,s),s}}uc.reset=()=>{GR=0,u1=new WeakMap};function H6(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Po("injectSelf");const{provides:u}=s;if(u&&e in u)return u[e]}const lv=Symbol.for("vuetify:defaults");function Z6(e){return yi(e)}function TC(){const e=vr(lv);if(!e)throw new Error("[Vuetify] Could not find defaults instance");return e}function Io(e,s){const u=TC(),d=yi(e),b=Fe(()=>{if(Ps(s==null?void 0:s.disabled))return u.value;const T=Ps(s==null?void 0:s.scoped),t=Ps(s==null?void 0:s.reset),G=Ps(s==null?void 0:s.root);if(d.value==null&&!(T||t||G))return u.value;let W=Qc(d.value,{prev:u.value});if(T)return W;if(t||G){const Y=Number(t||1/0);for(let ne=0;ne<=Y&&!(!W||!("prev"in W));ne++)W=W.prev;return W&&typeof G=="string"&&G in W&&(W=Qc(Qc(W,{prev:W}),W[G])),W}return W.prev?Qc(W.prev,W):W});return xa(lv,b),b}function W6(e,s){var u,d;return typeof((u=e.props)==null?void 0:u[s])<"u"||typeof((d=e.props)==null?void 0:d[k_(s)])<"u"}function X6(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=arguments.length>1?arguments[1]:void 0,u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:TC();const d=Po("useDefaults");if(s=s??d.type.name??d.type.__name,!s)throw new Error("[Vuetify] Could not determine component name");const b=Fe(()=>{var G;return(G=u.value)==null?void 0:G[e._as??s]}),E=new Proxy(e,{get(G,W){var ne,J,Q,ce,ie,pe,be;const Y=Reflect.get(G,W);return W==="class"||W==="style"?[(ne=b.value)==null?void 0:ne[W],Y].filter(Ie=>Ie!=null):typeof W=="string"&&!W6(d.vnode,W)?((J=b.value)==null?void 0:J[W])!==void 0?(Q=b.value)==null?void 0:Q[W]:((ie=(ce=u.value)==null?void 0:ce.global)==null?void 0:ie[W])!==void 0?(be=(pe=u.value)==null?void 0:pe.global)==null?void 0:be[W]:Y:Y}}),T=Bi();Jo(()=>{if(b.value){const G=Object.entries(b.value).filter(W=>{let[Y]=W;return Y.startsWith(Y[0].toUpperCase())});T.value=G.length?Object.fromEntries(G):void 0}else T.value=void 0});function t(){const G=H6(lv,d);xa(lv,Fe(()=>T.value?Qc((G==null?void 0:G.value)??{},T.value):G==null?void 0:G.value))}return{props:E,provideSubDefaults:t}}function Hh(e){if(e._setup=e._setup??e.setup,!e.name)return e;if(e._setup){e.props=vn(e.props??{},e.name)();const s=Object.keys(e.props).filter(u=>u!=="class"&&u!=="style");e.filterProps=function(d){return vC(d,s)},e.props._as=String,e.setup=function(d,b){const E=TC();if(!E.value)return e._setup(d,b);const{props:T,provideSubDefaults:t}=X6(d,d._as??e.name,E),G=e._setup(T,b);return t(),G}}return e}function Qn(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return s=>(e?Hh:mo)(s)}function Y6(e,s){return s.props=e,s}function Hp(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"div",u=arguments.length>2?arguments[2]:void 0;return Qn()({name:u??$p(mh(e.replace(/__/g,"-"))),props:{tag:{type:String,default:s},...tr()},setup(d,b){let{slots:E}=b;return()=>{var T;return Uf(d.tag,{class:[e,d.class],style:d.style},(T=E.default)==null?void 0:T.call(E))}}})}function qR(e){if(typeof e.getRootNode!="function"){for(;e.parentNode;)e=e.parentNode;return e!==document?null:document}const s=e.getRootNode();return s!==document&&s.getRootNode({composed:!0})!==document?null:s}const Qx="cubic-bezier(0.4, 0, 0.2, 1)",K6="cubic-bezier(0.0, 0, 0.2, 1)",J6="cubic-bezier(0.4, 0, 1, 1)";function PA(e,s,u){return Object.keys(e).filter(d=>Z1(d)&&d.endsWith(s)).reduce((d,b)=>(d[b.slice(0,-s.length)]=E=>e[b](E,u(E)),d),{})}function CC(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;for(;e;){if(s?Q6(e):EC(e))return e;e=e.parentElement}return document.scrollingElement}function C1(e,s){const u=[];if(s&&e&&!s.contains(e))return u;for(;e&&(EC(e)&&u.push(e),e!==s);)e=e.parentElement;return u}function EC(e){if(!e||e.nodeType!==Node.ELEMENT_NODE)return!1;const s=window.getComputedStyle(e);return s.overflowY==="scroll"||s.overflowY==="auto"&&e.scrollHeight>e.clientHeight}function Q6(e){if(!e||e.nodeType!==Node.ELEMENT_NODE)return!1;const s=window.getComputedStyle(e);return["scroll","auto"].includes(s.overflowY)}function ej(e){for(;e;){if(window.getComputedStyle(e).position==="fixed")return!0;e=e.offsetParent}return!1}function fi(e){const s=Po("useRender");s.render=e}function mr(e,s,u){let d=arguments.length>3&&arguments[3]!==void 0?arguments[3]:ne=>ne,b=arguments.length>4&&arguments[4]!==void 0?arguments[4]:ne=>ne;const E=Po("useProxiedModel"),T=yi(e[s]!==void 0?e[s]:u),t=k_(s),W=Fe(t!==s?()=>{var ne,J,Q,ce;return e[s],!!(((ne=E.vnode.props)!=null&&ne.hasOwnProperty(s)||(J=E.vnode.props)!=null&&J.hasOwnProperty(t))&&((Q=E.vnode.props)!=null&&Q.hasOwnProperty(`onUpdate:${s}`)||(ce=E.vnode.props)!=null&&ce.hasOwnProperty(`onUpdate:${t}`)))}:()=>{var ne,J;return e[s],!!((ne=E.vnode.props)!=null&&ne.hasOwnProperty(s)&&((J=E.vnode.props)!=null&&J.hasOwnProperty(`onUpdate:${s}`)))});Du(()=>!W.value,()=>{Pi(()=>e[s],ne=>{T.value=ne})});const Y=Fe({get(){const ne=e[s];return d(W.value?ne:T.value)},set(ne){const J=b(ne),Q=Gr(W.value?e[s]:T.value);Q===J||d(Q)===ne||(T.value=J,E==null||E.emit(`update:${s}`,J))}});return Object.defineProperty(Y,"externalValue",{get:()=>W.value?e[s]:T.value}),Y}const tj={badge:"Badge",open:"Open",close:"Close",dismiss:"Dismiss",confirmEdit:{ok:"OK",cancel:"Cancel"},dataIterator:{noResultsText:"No matching records found",loadingText:"Loading items..."},dataTable:{itemsPerPageText:"Rows per page:",ariaLabel:{sortDescending:"Sorted descending.",sortAscending:"Sorted ascending.",sortNone:"Not sorted.",activateNone:"Activate to remove sorting.",activateDescending:"Activate to sort descending.",activateAscending:"Activate to sort ascending."},sortBy:"Sort by"},dataFooter:{itemsPerPageText:"Items per page:",itemsPerPageAll:"All",nextPage:"Next page",prevPage:"Previous page",firstPage:"First page",lastPage:"Last page",pageText:"{0}-{1} of {2}"},dateRangeInput:{divider:"to"},datePicker:{itemsSelected:"{0} selected",range:{title:"Select dates",header:"Enter dates"},title:"Select date",header:"Enter date",input:{placeholder:"Enter date"}},noDataText:"No data available",carousel:{prev:"Previous visual",next:"Next visual",ariaLabel:{delimiter:"Carousel slide {0} of {1}"}},calendar:{moreEvents:"{0} more",today:"Today"},input:{clear:"Clear {0}",prependAction:"{0} prepended action",appendAction:"{0} appended action",otp:"Please enter OTP character {0}"},fileInput:{counter:"{0} files",counterSize:"{0} files ({1} in total)"},fileUpload:{title:"Drag and drop files here",divider:"or",browse:"Browse Files"},timePicker:{am:"AM",pm:"PM",title:"Select Time"},pagination:{ariaLabel:{root:"Pagination Navigation",next:"Next page",previous:"Previous page",page:"Go to page {0}",currentPage:"Page {0}, Current page",first:"First page",last:"Last page"}},stepper:{next:"Next",prev:"Previous"},rating:{ariaLabel:{item:"Rating {0} of {1}"}},loading:"Loading...",infiniteScroll:{loadMore:"Load more",empty:"No more"}},AA="$vuetify.",kA=(e,s)=>e.replace(/\{(\d+)\}/g,(u,d)=>String(s[+d])),HR=(e,s,u)=>function(d){for(var b=arguments.length,E=new Array(b>1?b-1:0),T=1;T<b;T++)E[T-1]=arguments[T];if(!d.startsWith(AA))return kA(d,E);const t=d.replace(AA,""),G=e.value&&u.value[e.value],W=s.value&&u.value[s.value];let Y=F_(G,t,null);return Y||(`${d}${e.value}`,Y=F_(W,t,null)),Y||(Y=d),typeof Y!="string"&&(Y=d),kA(Y,E)};function ZR(e,s){return(u,d)=>new Intl.NumberFormat([e.value,s.value],d).format(u)}function k2(e,s,u){const d=mr(e,s,e[s]??u.value);return d.value=e[s]??u.value,Pi(u,b=>{e[s]==null&&(d.value=u.value)}),d}function WR(e){return s=>{const u=k2(s,"locale",e.current),d=k2(s,"fallback",e.fallback),b=k2(s,"messages",e.messages);return{name:"vuetify",current:u,fallback:d,messages:b,t:HR(u,d,b),n:ZR(u,d),provide:WR({current:u,fallback:d,messages:b})}}}function nj(e){const s=Bi((e==null?void 0:e.locale)??"en"),u=Bi((e==null?void 0:e.fallback)??"en"),d=yi({en:tj,...e==null?void 0:e.messages});return{name:"vuetify",current:s,fallback:u,messages:d,t:HR(s,u,d),n:ZR(s,u),provide:WR({current:s,fallback:u,messages:d})}}const cv=Symbol.for("vuetify:locale");function ij(e){return e.name!=null}function rj(e){const s=e!=null&&e.adapter&&ij(e==null?void 0:e.adapter)?e==null?void 0:e.adapter:nj(e),u=oj(s,e);return{...s,...u}}function Uo(){const e=vr(cv);if(!e)throw new Error("[Vuetify] Could not find injected locale instance");return e}function aj(e){const s=vr(cv);if(!s)throw new Error("[Vuetify] Could not find injected locale instance");const u=s.provide(e),d=lj(u,s.rtl,e),b={...u,...d};return xa(cv,b),b}function sj(){return{af:!1,ar:!0,bg:!1,ca:!1,ckb:!1,cs:!1,de:!1,el:!1,en:!1,es:!1,et:!1,fa:!0,fi:!1,fr:!1,hr:!1,hu:!1,he:!0,id:!1,it:!1,ja:!1,km:!1,ko:!1,lv:!1,lt:!1,nl:!1,no:!1,pl:!1,pt:!1,ro:!1,ru:!1,sk:!1,sl:!1,srCyrl:!1,srLatn:!1,sv:!1,th:!1,tr:!1,az:!1,uk:!1,vi:!1,zhHans:!1,zhHant:!1}}function oj(e,s){const u=yi((s==null?void 0:s.rtl)??sj()),d=Fe(()=>u.value[e.current.value]??!1);return{isRtl:d,rtl:u,rtlClasses:Fe(()=>`v-locale--is-${d.value?"rtl":"ltr"}`)}}function lj(e,s,u){const d=Fe(()=>u.rtl??s.value[e.current.value]??!1);return{isRtl:d,rtl:s,rtlClasses:Fe(()=>`v-locale--is-${d.value?"rtl":"ltr"}`)}}function Cl(){const e=vr(cv);if(!e)throw new Error("[Vuetify] Could not find injected rtl instance");return{isRtl:e.isRtl,rtlClasses:e.rtlClasses}}const Y1={"001":1,AD:1,AE:6,AF:6,AG:0,AI:1,AL:1,AM:1,AN:1,AR:1,AS:0,AT:1,AU:1,AX:1,AZ:1,BA:1,BD:0,BE:1,BG:1,BH:6,BM:1,BN:1,BR:0,BS:0,BT:0,BW:0,BY:1,BZ:0,CA:0,CH:1,CL:1,CM:1,CN:1,CO:0,CR:1,CY:1,CZ:1,DE:1,DJ:6,DK:1,DM:0,DO:0,DZ:6,EC:1,EE:1,EG:6,ES:1,ET:0,FI:1,FJ:1,FO:1,FR:1,GB:1,"GB-alt-variant":0,GE:1,GF:1,GP:1,GR:1,GT:0,GU:0,HK:0,HN:0,HR:1,HU:1,ID:0,IE:1,IL:0,IN:0,IQ:6,IR:6,IS:1,IT:1,JM:0,JO:6,JP:0,KE:0,KG:1,KH:0,KR:0,KW:6,KZ:1,LA:0,LB:1,LI:1,LK:1,LT:1,LU:1,LV:1,LY:6,MC:1,MD:1,ME:1,MH:0,MK:1,MM:0,MN:1,MO:0,MQ:1,MT:0,MV:5,MX:0,MY:1,MZ:0,NI:0,NL:1,NO:1,NP:0,NZ:1,OM:6,PA:0,PE:0,PH:0,PK:0,PL:1,PR:0,PT:0,PY:0,QA:6,RE:1,RO:1,RS:1,RU:1,SA:0,SD:6,SE:1,SG:0,SI:1,SK:1,SM:1,SV:0,SY:6,TH:0,TJ:1,TM:1,TR:1,TT:0,TW:0,UA:1,UM:0,US:0,UY:1,UZ:1,VA:1,VE:0,VI:0,VN:1,WS:0,XK:1,YE:0,ZA:0,ZW:0};function cj(e,s,u){const d=[];let b=[];const E=XR(e),T=YR(e),t=u??Y1[s.slice(-2).toUpperCase()]??0,G=(E.getDay()-t+7)%7,W=(T.getDay()-t+7)%7;for(let Y=0;Y<G;Y++){const ne=new Date(E);ne.setDate(ne.getDate()-(G-Y)),b.push(ne)}for(let Y=1;Y<=T.getDate();Y++){const ne=new Date(e.getFullYear(),e.getMonth(),Y);b.push(ne),b.length===7&&(d.push(b),b=[])}for(let Y=1;Y<7-W;Y++){const ne=new Date(T);ne.setDate(ne.getDate()+Y),b.push(ne)}return b.length>0&&d.push(b),d}function uj(e,s,u){const d=u??Y1[s.slice(-2).toUpperCase()]??0,b=new Date(e);for(;b.getDay()!==d;)b.setDate(b.getDate()-1);return b}function hj(e,s){const u=new Date(e),d=((Y1[s.slice(-2).toUpperCase()]??0)+6)%7;for(;u.getDay()!==d;)u.setDate(u.getDate()+1);return u}function XR(e){return new Date(e.getFullYear(),e.getMonth(),1)}function YR(e){return new Date(e.getFullYear(),e.getMonth()+1,0)}function dj(e){const s=e.split("-").map(Number);return new Date(s[0],s[1]-1,s[2])}const fj=/^([12]\d{3}-([1-9]|0[1-9]|1[0-2])-([1-9]|0[1-9]|[12]\d|3[01]))$/;function KR(e){if(e==null)return new Date;if(e instanceof Date)return e;if(typeof e=="string"){let s;if(fj.test(e))return dj(e);if(s=Date.parse(e),!isNaN(s))return new Date(s)}return null}const DA=new Date(2e3,0,2);function pj(e,s){const u=s??Y1[e.slice(-2).toUpperCase()]??0;return Vp(7).map(d=>{const b=new Date(DA);return b.setDate(DA.getDate()+u+d),new Intl.DateTimeFormat(e,{weekday:"narrow"}).format(b)})}function mj(e,s,u,d){const b=KR(e)??new Date,E=d==null?void 0:d[s];if(typeof E=="function")return E(b,s,u);let T={};switch(s){case"fullDate":T={year:"numeric",month:"long",day:"numeric"};break;case"fullDateWithWeekday":T={weekday:"long",year:"numeric",month:"long",day:"numeric"};break;case"normalDate":const t=b.getDate(),G=new Intl.DateTimeFormat(u,{month:"long"}).format(b);return`${t} ${G}`;case"normalDateWithWeekday":T={weekday:"short",day:"numeric",month:"short"};break;case"shortDate":T={month:"short",day:"numeric"};break;case"year":T={year:"numeric"};break;case"month":T={month:"long"};break;case"monthShort":T={month:"short"};break;case"monthAndYear":T={month:"long",year:"numeric"};break;case"monthAndDate":T={month:"long",day:"numeric"};break;case"weekday":T={weekday:"long"};break;case"weekdayShort":T={weekday:"short"};break;case"dayOfMonth":return new Intl.NumberFormat(u).format(b.getDate());case"hours12h":T={hour:"numeric",hour12:!0};break;case"hours24h":T={hour:"numeric",hour12:!1};break;case"minutes":T={minute:"numeric"};break;case"seconds":T={second:"numeric"};break;case"fullTime":T={hour:"numeric",minute:"numeric",second:"numeric",hour12:!0};break;case"fullTime12h":T={hour:"numeric",minute:"numeric",second:"numeric",hour12:!0};break;case"fullTime24h":T={hour:"numeric",minute:"numeric",second:"numeric",hour12:!1};break;case"fullDateTime":T={year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!0};break;case"fullDateTime12h":T={year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!0};break;case"fullDateTime24h":T={year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!1};break;case"keyboardDate":T={year:"numeric",month:"2-digit",day:"2-digit"};break;case"keyboardDateTime":T={year:"numeric",month:"2-digit",day:"2-digit",hour:"numeric",minute:"numeric",second:"numeric",hour12:!1};break;case"keyboardDateTime12h":T={year:"numeric",month:"2-digit",day:"2-digit",hour:"numeric",minute:"numeric",second:"numeric",hour12:!0};break;case"keyboardDateTime24h":T={year:"numeric",month:"2-digit",day:"2-digit",hour:"numeric",minute:"numeric",second:"numeric",hour12:!1};break;default:T=E??{timeZone:"UTC",timeZoneName:"short"}}return new Intl.DateTimeFormat(u,T).format(b)}function gj(e,s){const u=e.toJsDate(s),d=u.getFullYear(),b=mA(String(u.getMonth()+1),2,"0"),E=mA(String(u.getDate()),2,"0");return`${d}-${b}-${E}`}function _j(e){const[s,u,d]=e.split("-").map(Number);return new Date(s,u-1,d)}function yj(e,s){const u=new Date(e);return u.setMinutes(u.getMinutes()+s),u}function vj(e,s){const u=new Date(e);return u.setHours(u.getHours()+s),u}function xj(e,s){const u=new Date(e);return u.setDate(u.getDate()+s),u}function bj(e,s){const u=new Date(e);return u.setDate(u.getDate()+s*7),u}function wj(e,s){const u=new Date(e);return u.setDate(1),u.setMonth(u.getMonth()+s),u}function Sj(e){return e.getFullYear()}function Tj(e){return e.getMonth()}function Cj(e){return e.getDate()}function Ej(e){return new Date(e.getFullYear(),e.getMonth()+1,1)}function Mj(e){return new Date(e.getFullYear(),e.getMonth()-1,1)}function Ij(e){return e.getHours()}function Pj(e){return e.getMinutes()}function Aj(e){return new Date(e.getFullYear(),0,1)}function kj(e){return new Date(e.getFullYear(),11,31)}function Dj(e,s){return E1(e,s[0])&&zj(e,s[1])}function Rj(e){const s=new Date(e);return s instanceof Date&&!isNaN(s.getTime())}function E1(e,s){return e.getTime()>s.getTime()}function Lj(e,s){return E1(uT(e),uT(s))}function zj(e,s){return e.getTime()<s.getTime()}function RA(e,s){return e.getTime()===s.getTime()}function Oj(e,s){return e.getDate()===s.getDate()&&e.getMonth()===s.getMonth()&&e.getFullYear()===s.getFullYear()}function Fj(e,s){return e.getMonth()===s.getMonth()&&e.getFullYear()===s.getFullYear()}function Bj(e,s){return e.getFullYear()===s.getFullYear()}function Vj(e,s,u){const d=new Date(e),b=new Date(s);switch(u){case"years":return d.getFullYear()-b.getFullYear();case"quarters":return Math.floor((d.getMonth()-b.getMonth()+(d.getFullYear()-b.getFullYear())*12)/4);case"months":return d.getMonth()-b.getMonth()+(d.getFullYear()-b.getFullYear())*12;case"weeks":return Math.floor((d.getTime()-b.getTime())/(1e3*60*60*24*7));case"days":return Math.floor((d.getTime()-b.getTime())/(1e3*60*60*24));case"hours":return Math.floor((d.getTime()-b.getTime())/(1e3*60*60));case"minutes":return Math.floor((d.getTime()-b.getTime())/(1e3*60));case"seconds":return Math.floor((d.getTime()-b.getTime())/1e3);default:return d.getTime()-b.getTime()}}function Nj(e,s){const u=new Date(e);return u.setHours(s),u}function jj(e,s){const u=new Date(e);return u.setMinutes(s),u}function Uj(e,s){const u=new Date(e);return u.setMonth(s),u}function $j(e,s){const u=new Date(e);return u.setDate(s),u}function Gj(e,s){const u=new Date(e);return u.setFullYear(s),u}function uT(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0,0)}function qj(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate(),23,59,59,999)}class Hj{constructor(s){this.locale=s.locale,this.formats=s.formats}date(s){return KR(s)}toJsDate(s){return s}toISO(s){return gj(this,s)}parseISO(s){return _j(s)}addMinutes(s,u){return yj(s,u)}addHours(s,u){return vj(s,u)}addDays(s,u){return xj(s,u)}addWeeks(s,u){return bj(s,u)}addMonths(s,u){return wj(s,u)}getWeekArray(s,u){return cj(s,this.locale,u?Number(u):void 0)}startOfWeek(s,u){return uj(s,this.locale,u?Number(u):void 0)}endOfWeek(s){return hj(s,this.locale)}startOfMonth(s){return XR(s)}endOfMonth(s){return YR(s)}format(s,u){return mj(s,u,this.locale,this.formats)}isEqual(s,u){return RA(s,u)}isValid(s){return Rj(s)}isWithinRange(s,u){return Dj(s,u)}isAfter(s,u){return E1(s,u)}isAfterDay(s,u){return Lj(s,u)}isBefore(s,u){return!E1(s,u)&&!RA(s,u)}isSameDay(s,u){return Oj(s,u)}isSameMonth(s,u){return Fj(s,u)}isSameYear(s,u){return Bj(s,u)}setMinutes(s,u){return jj(s,u)}setHours(s,u){return Nj(s,u)}setMonth(s,u){return Uj(s,u)}setDate(s,u){return $j(s,u)}setYear(s,u){return Gj(s,u)}getDiff(s,u,d){return Vj(s,u,d)}getWeekdays(s){return pj(this.locale,s?Number(s):void 0)}getYear(s){return Sj(s)}getMonth(s){return Tj(s)}getDate(s){return Cj(s)}getNextMonth(s){return Ej(s)}getPreviousMonth(s){return Mj(s)}getHours(s){return Ij(s)}getMinutes(s){return Pj(s)}startOfDay(s){return uT(s)}endOfDay(s){return qj(s)}startOfYear(s){return Aj(s)}endOfYear(s){return kj(s)}}const JR=Symbol.for("vuetify:date-options"),LA=Symbol.for("vuetify:date-adapter");function Zj(e,s){const u=Qc({adapter:Hj,locale:{af:"af-ZA",bg:"bg-BG",ca:"ca-ES",ckb:"",cs:"cs-CZ",de:"de-DE",el:"el-GR",en:"en-US",et:"et-EE",fa:"fa-IR",fi:"fi-FI",hr:"hr-HR",hu:"hu-HU",he:"he-IL",id:"id-ID",it:"it-IT",ja:"ja-JP",ko:"ko-KR",lv:"lv-LV",lt:"lt-LT",nl:"nl-NL",no:"no-NO",pl:"pl-PL",pt:"pt-PT",ro:"ro-RO",ru:"ru-RU",sk:"sk-SK",sl:"sl-SI",srCyrl:"sr-SP",srLatn:"sr-SP",sv:"sv-SE",th:"th-TH",tr:"tr-TR",az:"az-AZ",uk:"uk-UA",vi:"vi-VN",zhHans:"zh-CN",zhHant:"zh-TW"}},e);return{options:u,instance:QR(u,s)}}function QR(e,s){const u=$l(typeof e.adapter=="function"?new e.adapter({locale:e.locale[s.current.value]??s.current.value,formats:e.formats}):e.adapter);return Pi(s.current,d=>{u.locale=e.locale[d]??d??u.locale}),u}function mb(){const e=vr(JR);if(!e)throw new Error("[Vuetify] Could not find injected date options");const s=Uo();return QR(e,s)}function Wj(e,s){const u=e.toJsDate(s);let d=u.getFullYear(),b=new Date(d,0,1);if(u<b)d=d-1,b=new Date(d,0,1);else{const t=new Date(d+1,0,1);u>=t&&(d=d+1,b=t)}const E=Math.abs(u.getTime()-b.getTime()),T=Math.ceil(E/(1e3*60*60*24));return Math.floor(T/7)+1}const K1=["sm","md","lg","xl","xxl"],hT=Symbol.for("vuetify:display"),zA={mobileBreakpoint:"lg",thresholds:{xs:0,sm:600,md:960,lg:1280,xl:1920,xxl:2560}},Xj=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:zA;return Qc(zA,e)};function OA(e){return qa&&!e?window.innerWidth:typeof e=="object"&&e.clientWidth||0}function FA(e){return qa&&!e?window.innerHeight:typeof e=="object"&&e.clientHeight||0}function BA(e){const s=qa&&!e?window.navigator.userAgent:"ssr";function u(ce){return!!s.match(ce)}const d=u(/android/i),b=u(/iphone|ipad|ipod/i),E=u(/cordova/i),T=u(/electron/i),t=u(/chrome/i),G=u(/edge/i),W=u(/firefox/i),Y=u(/opera/i),ne=u(/win/i),J=u(/mac/i),Q=u(/linux/i);return{android:d,ios:b,cordova:E,electron:T,chrome:t,edge:G,firefox:W,opera:Y,win:ne,mac:J,linux:Q,touch:l6,ssr:s==="ssr"}}function Yj(e,s){const{thresholds:u,mobileBreakpoint:d}=Xj(e),b=Bi(FA(s)),E=Bi(BA(s)),T=$l({}),t=Bi(OA(s));function G(){b.value=FA(),t.value=OA()}function W(){G(),E.value=BA()}return Jo(()=>{const Y=t.value<u.sm,ne=t.value<u.md&&!Y,J=t.value<u.lg&&!(ne||Y),Q=t.value<u.xl&&!(J||ne||Y),ce=t.value<u.xxl&&!(Q||J||ne||Y),ie=t.value>=u.xxl,pe=Y?"xs":ne?"sm":J?"md":Q?"lg":ce?"xl":"xxl",be=typeof d=="number"?d:u[d],Ie=t.value<be;T.xs=Y,T.sm=ne,T.md=J,T.lg=Q,T.xl=ce,T.xxl=ie,T.smAndUp=!Y,T.mdAndUp=!(Y||ne),T.lgAndUp=!(Y||ne||J),T.xlAndUp=!(Y||ne||J||Q),T.smAndDown=!(J||Q||ce||ie),T.mdAndDown=!(Q||ce||ie),T.lgAndDown=!(ce||ie),T.xlAndDown=!ie,T.name=pe,T.height=b.value,T.width=t.value,T.mobile=Ie,T.mobileBreakpoint=d,T.platform=E.value,T.thresholds=u}),qa&&window.addEventListener("resize",G,{passive:!0}),{...zg(T),update:W,ssr:!!s}}const W_=vn({mobile:{type:Boolean,default:!1},mobileBreakpoint:[Number,String]},"display");function jd(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{mobile:null},s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:qp();const u=vr(hT);if(!u)throw new Error("Could not find Vuetify display injection");const d=Fe(()=>e.mobile?!0:typeof e.mobileBreakpoint=="number"?u.width.value<e.mobileBreakpoint:e.mobileBreakpoint?u.width.value<u.thresholds.value[e.mobileBreakpoint]:e.mobile===null?u.mobile.value:!1),b=Fe(()=>s?{[`${s}--mobile`]:d.value}:{});return{...u,displayClasses:b,mobile:d}}const eL=Symbol.for("vuetify:goto");function tL(){return{container:void 0,duration:300,layout:!1,offset:0,easing:"easeInOutCubic",patterns:{linear:e=>e,easeInQuad:e=>e**2,easeOutQuad:e=>e*(2-e),easeInOutQuad:e=>e<.5?2*e**2:-1+(4-2*e)*e,easeInCubic:e=>e**3,easeOutCubic:e=>--e**3+1,easeInOutCubic:e=>e<.5?4*e**3:(e-1)*(2*e-2)*(2*e-2)+1,easeInQuart:e=>e**4,easeOutQuart:e=>1- --e**4,easeInOutQuart:e=>e<.5?8*e**4:1-8*--e**4,easeInQuint:e=>e**5,easeOutQuint:e=>1+--e**5,easeInOutQuint:e=>e<.5?16*e**5:1+16*--e**5}}}function Kj(e){return MC(e)??(document.scrollingElement||document.body)}function MC(e){return typeof e=="string"?document.querySelector(e):yC(e)}function D2(e,s,u){if(typeof e=="number")return s&&u?-e:e;let d=MC(e),b=0;for(;d;)b+=s?d.offsetLeft:d.offsetTop,d=d.offsetParent;return b}function Jj(e,s){return{rtl:s.isRtl,options:Qc(tL(),e)}}async function VA(e,s,u,d){const b=u?"scrollLeft":"scrollTop",E=Qc((d==null?void 0:d.options)??tL(),s),T=d==null?void 0:d.rtl.value,t=(typeof e=="number"?e:MC(e))??0,G=E.container==="parent"&&t instanceof HTMLElement?t.parentElement:Kj(E.container),W=typeof E.easing=="function"?E.easing:E.patterns[E.easing];if(!W)throw new TypeError(`Easing function "${E.easing}" not found.`);let Y;if(typeof t=="number")Y=D2(t,u,T);else if(Y=D2(t,u,T)-D2(G,u,T),E.layout){const ce=window.getComputedStyle(t).getPropertyValue("--v-layout-top");ce&&(Y-=parseInt(ce,10))}Y+=E.offset,Y=eU(G,Y,!!T,!!u);const ne=G[b]??0;if(Y===ne)return Promise.resolve(Y);const J=performance.now();return new Promise(Q=>requestAnimationFrame(function ce(ie){const be=(ie-J)/E.duration,Ie=Math.floor(ne+(Y-ne)*W(Ko(be,0,1)));if(G[b]=Ie,be>=1&&Math.abs(Ie-G[b])<10)return Q(Y);if(be>2)return Q(G[b]);requestAnimationFrame(ce)}))}function Qj(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const s=vr(eL),{isRtl:u}=Cl();if(!s)throw new Error("[Vuetify] Could not find injected goto instance");const d={...s,rtl:Fe(()=>s.rtl.value||u.value)};async function b(E,T){return VA(E,Qc(e,T),!1,d)}return b.horizontal=async(E,T)=>VA(E,Qc(e,T),!0,d),b}function eU(e,s,u,d){const{scrollWidth:b,scrollHeight:E}=e,[T,t]=e===document.scrollingElement?[window.innerWidth,window.innerHeight]:[e.offsetWidth,e.offsetHeight];let G,W;return d?u?(G=-(b-T),W=0):(G=0,W=b-T):(G=0,W=E+-t),Math.max(Math.min(s,W),G)}const tU={collapse:"mdi-chevron-up",complete:"mdi-check",cancel:"mdi-close-circle",close:"mdi-close",delete:"mdi-close-circle",clear:"mdi-close-circle",success:"mdi-check-circle",info:"mdi-information",warning:"mdi-alert-circle",error:"mdi-close-circle",prev:"mdi-chevron-left",next:"mdi-chevron-right",checkboxOn:"mdi-checkbox-marked",checkboxOff:"mdi-checkbox-blank-outline",checkboxIndeterminate:"mdi-minus-box",delimiter:"mdi-circle",sortAsc:"mdi-arrow-up",sortDesc:"mdi-arrow-down",expand:"mdi-chevron-down",menu:"mdi-menu",subgroup:"mdi-menu-down",dropdown:"mdi-menu-down",radioOn:"mdi-radiobox-marked",radioOff:"mdi-radiobox-blank",edit:"mdi-pencil",ratingEmpty:"mdi-star-outline",ratingFull:"mdi-star",ratingHalf:"mdi-star-half-full",loading:"mdi-cached",first:"mdi-page-first",last:"mdi-page-last",unfold:"mdi-unfold-more-horizontal",file:"mdi-paperclip",plus:"mdi-plus",minus:"mdi-minus",calendar:"mdi-calendar",treeviewCollapse:"mdi-menu-down",treeviewExpand:"mdi-menu-right",eyeDropper:"mdi-eyedropper",upload:"mdi-cloud-upload"},nU={component:e=>Uf(PC,{...e,class:"mdi"})},_r=[String,Function,Object,Array],dT=Symbol.for("vuetify:icons"),J1=vn({icon:{type:_r},tag:{type:String,required:!0}},"icon"),fT=Qn()({name:"VComponentIcon",props:J1(),setup(e,s){let{slots:u}=s;return()=>{const d=e.icon;return de(e.tag,null,{default:()=>{var b;return[e.icon?de(d,null,null):(b=u.default)==null?void 0:b.call(u)]}})}}}),IC=Hh({name:"VSvgIcon",inheritAttrs:!1,props:J1(),setup(e,s){let{attrs:u}=s;return()=>de(e.tag,oi(u,{style:null}),{default:()=>[de("svg",{class:"v-icon__svg",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",role:"img","aria-hidden":"true"},[Array.isArray(e.icon)?e.icon.map(d=>Array.isArray(d)?de("path",{d:d[0],"fill-opacity":d[1]},null):de("path",{d},null)):de("path",{d:e.icon},null)])]})}}),iU=Hh({name:"VLigatureIcon",props:J1(),setup(e){return()=>de(e.tag,null,{default:()=>[e.icon]})}}),PC=Hh({name:"VClassIcon",props:J1(),setup(e){return()=>de(e.tag,{class:e.icon},null)}});function rU(){return{svg:{component:IC},class:{component:PC}}}function aU(e){const s=rU(),u=(e==null?void 0:e.defaultSet)??"mdi";return u==="mdi"&&!s.mdi&&(s.mdi=nU),Qc({defaultSet:u,sets:s,aliases:{...tU,vuetify:["M8.2241 14.2009L12 21L22 3H14.4459L8.2241 14.2009Z",["M7.26303 12.4733L7.00113 12L2 3H12.5261C12.5261 3 12.5261 3 12.5261 3L7.26303 12.4733Z",.6]],"vuetify-outline":"svg:M7.26 12.47 12.53 3H2L7.26 12.47ZM14.45 3 8.22 14.2 12 21 22 3H14.45ZM18.6 5 12 16.88 10.51 14.2 15.62 5ZM7.26 8.35 5.4 5H9.13L7.26 8.35Z","vuetify-play":["m6.376 13.184-4.11-7.192C1.505 4.66 2.467 3 4.003 3h8.532l-.953 1.576-.006.01-.396.677c-.429.732-.214 1.507.194 2.015.404.503 1.092.878 1.869.806a3.72 3.72 0 0 1 1.005.022c.276.053.434.143.523.237.138.146.38.635-.25 2.09-.893 1.63-1.553 1.722-1.847 1.677-.213-.033-.468-.158-.756-.406a4.95 4.95 0 0 1-.8-.927c-.39-.564-1.04-.84-1.66-.846-.625-.006-1.316.27-1.693.921l-.478.826-.911 1.506Z",["M9.093 11.552c.046-.079.144-.15.32-.148a.53.53 0 0 1 .43.207c.285.414.636.847 1.046 1.2.405.35.914.662 1.516.754 1.334.205 2.502-.698 3.48-2.495l.014-.028.013-.03c.687-1.574.774-2.852-.005-3.675-.37-.391-.861-.586-1.333-.676a5.243 5.243 0 0 0-1.447-.044c-.173.016-.393-.073-.54-.257-.145-.18-.127-.316-.082-.392l.393-.672L14.287 3h5.71c1.536 0 2.499 1.659 1.737 2.992l-7.997 13.996c-.768 1.344-2.706 1.344-3.473 0l-3.037-5.314 1.377-2.278.004-.006.004-.007.481-.831Z",.6]]}},e)}const sU=e=>{const s=vr(dT);if(!s)throw new Error("Missing Vuetify Icons provide!");return{iconData:Fe(()=>{var G;const d=Ps(e);if(!d)return{component:fT};let b=d;if(typeof b=="string"&&(b=b.trim(),b.startsWith("$")&&(b=(G=s.aliases)==null?void 0:G[b.slice(1)])),Array.isArray(b))return{component:IC,icon:b};if(typeof b!="string")return{component:fT,icon:b};const E=Object.keys(s.sets).find(W=>typeof b=="string"&&b.startsWith(`${W}:`)),T=E?b.slice(E.length+1):b;return{component:s.sets[E??s.defaultSet].component,icon:T}})}},eb=Symbol.for("vuetify:theme"),Da=vn({theme:String},"theme");function NA(){return{defaultTheme:"light",variations:{colors:[],lighten:0,darken:0},themes:{light:{dark:!1,colors:{background:"#FFFFFF",surface:"#FFFFFF","surface-bright":"#FFFFFF","surface-light":"#EEEEEE","surface-variant":"#424242","on-surface-variant":"#EEEEEE",primary:"#1867C0","primary-darken-1":"#1F5592",secondary:"#48A9A6","secondary-darken-1":"#018786",error:"#B00020",info:"#2196F3",success:"#4CAF50",warning:"#FB8C00"},variables:{"border-color":"#000000","border-opacity":.12,"high-emphasis-opacity":.87,"medium-emphasis-opacity":.6,"disabled-opacity":.38,"idle-opacity":.04,"hover-opacity":.04,"focus-opacity":.12,"selected-opacity":.08,"activated-opacity":.12,"pressed-opacity":.12,"dragged-opacity":.08,"theme-kbd":"#212529","theme-on-kbd":"#FFFFFF","theme-code":"#F5F5F5","theme-on-code":"#000000"}},dark:{dark:!0,colors:{background:"#121212",surface:"#212121","surface-bright":"#ccbfd6","surface-light":"#424242","surface-variant":"#a3a3a3","on-surface-variant":"#424242",primary:"#2196F3","primary-darken-1":"#277CC1",secondary:"#54B6B2","secondary-darken-1":"#48A9A6",error:"#CF6679",info:"#2196F3",success:"#4CAF50",warning:"#FB8C00"},variables:{"border-color":"#FFFFFF","border-opacity":.12,"high-emphasis-opacity":1,"medium-emphasis-opacity":.7,"disabled-opacity":.5,"idle-opacity":.1,"hover-opacity":.04,"focus-opacity":.12,"selected-opacity":.08,"activated-opacity":.12,"pressed-opacity":.16,"dragged-opacity":.08,"theme-kbd":"#212529","theme-on-kbd":"#FFFFFF","theme-code":"#343434","theme-on-code":"#CCCCCC"}}}}}function oU(){var d,b;let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:NA();const s=NA();if(!e)return{...s,isDisabled:!0};const u={};for(const[E,T]of Object.entries(e.themes??{})){const t=T.dark||E==="dark"?(d=s.themes)==null?void 0:d.dark:(b=s.themes)==null?void 0:b.light;u[E]=Qc(t,T)}return Qc(s,{...e,themes:u})}function lU(e){const s=oU(e),u=yi(s.defaultTheme),d=yi(s.themes),b=Fe(()=>{const Y={};for(const[ne,J]of Object.entries(d.value)){const Q=Y[ne]={...J,colors:{...J.colors}};if(s.variations)for(const ce of s.variations.colors){const ie=Q.colors[ce];if(ie)for(const pe of["lighten","darken"]){const be=pe==="lighten"?$6:G6;for(const Ie of Vp(s.variations[pe],1))Q.colors[`${ce}-${pe}-${Ie}`]=NR(be(Gh(ie),Ie))}}for(const ce of Object.keys(Q.colors)){if(/^on-[a-z]/.test(ce)||Q.colors[`on-${ce}`])continue;const ie=`on-${ce}`,pe=Gh(Q.colors[ce]);Q.colors[ie]=$R(pe)}}return Y}),E=Fe(()=>b.value[u.value]),T=Fe(()=>{var ce;const Y=[];(ce=E.value)!=null&&ce.dark&&C_(Y,":root",["color-scheme: dark"]),C_(Y,":root",jA(E.value));for(const[ie,pe]of Object.entries(b.value))C_(Y,`.v-theme--${ie}`,[`color-scheme: ${pe.dark?"dark":"normal"}`,...jA(pe)]);const ne=[],J=[],Q=new Set(Object.values(b.value).flatMap(ie=>Object.keys(ie.colors)));for(const ie of Q)/^on-[a-z]/.test(ie)?C_(J,`.${ie}`,[`color: rgb(var(--v-theme-${ie})) !important`]):(C_(ne,`.bg-${ie}`,[`--v-theme-overlay-multiplier: var(--v-theme-${ie}-overlay-multiplier)`,`background-color: rgb(var(--v-theme-${ie})) !important`,`color: rgb(var(--v-theme-on-${ie})) !important`]),C_(J,`.text-${ie}`,[`color: rgb(var(--v-theme-${ie})) !important`]),C_(J,`.border-${ie}`,[`--v-border-color: var(--v-theme-${ie})`]));return Y.push(...ne,...J),Y.map((ie,pe)=>pe===0?ie:`    ${ie}`).join("")});function t(){return{style:[{children:T.value,id:"vuetify-theme-stylesheet",nonce:s.cspNonce||!1}]}}function G(Y){if(s.isDisabled)return;const ne=Y._context.provides.usehead;if(ne)if(ne.push){const Q=ne.push(t);qa&&Pi(T,()=>{Q.patch(t)})}else qa?(ne.addHeadObjs(Fe(t)),Jo(()=>ne.updateDOM())):ne.addHeadObjs(t());else{let ce=function(){if(typeof document<"u"&&!Q){const ie=document.createElement("style");ie.type="text/css",ie.id="vuetify-theme-stylesheet",s.cspNonce&&ie.setAttribute("nonce",s.cspNonce),Q=ie,document.head.appendChild(Q)}Q&&(Q.innerHTML=T.value)};var J=ce;let Q=qa?document.getElementById("vuetify-theme-stylesheet"):null;qa?Pi(T,ce,{immediate:!0}):ce()}}const W=Fe(()=>s.isDisabled?void 0:`v-theme--${u.value}`);return{install:G,isDisabled:s.isDisabled,name:u,themes:d,current:E,computedThemes:b,themeClasses:W,styles:T,global:{name:u,current:E}}}function Ja(e){Po("provideTheme");const s=vr(eb,null);if(!s)throw new Error("Could not find Vuetify theme injection");const u=Fe(()=>e.theme??s.name.value),d=Fe(()=>s.themes.value[u.value]),b=Fe(()=>s.isDisabled?void 0:`v-theme--${u.value}`),E={...s,name:u,current:d,themeClasses:b};return xa(eb,E),E}function nL(){Po("useTheme");const e=vr(eb,null);if(!e)throw new Error("Could not find Vuetify theme injection");return e}function C_(e,s,u){e.push(`${s} {
`,...u.map(d=>`  ${d};
`),`}
`)}function jA(e){const s=e.dark?2:1,u=e.dark?1:2,d=[];for(const[b,E]of Object.entries(e.colors)){const T=Gh(E);d.push(`--v-theme-${b}: ${T.r},${T.g},${T.b}`),b.startsWith("on-")||d.push(`--v-theme-${b}-overlay-multiplier: ${cT(E)>.18?s:u}`)}for(const[b,E]of Object.entries(e.variables)){const T=typeof E=="string"&&E.startsWith("#")?Gh(E):void 0,t=T?`${T.r}, ${T.g}, ${T.b}`:void 0;d.push(`--v-${b}: ${t??E}`)}return d}function Ff(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"content";const u=S1(),d=yi();if(qa){const b=new ResizeObserver(E=>{e==null||e(E,b),E.length&&(s==="content"?d.value=E[0].contentRect:d.value=E[0].target.getBoundingClientRect())});ql(()=>{b.disconnect()}),Pi(()=>u.el,(E,T)=>{T&&(b.unobserve(T),d.value=void 0),E&&b.observe(E)},{flush:"post"})}return{resizeRef:u,contentRect:ub(d)}}const tb=Symbol.for("vuetify:layout"),iL=Symbol.for("vuetify:layout-item"),UA=1e3,rL=vn({overlaps:{type:Array,default:()=>[]},fullHeight:Boolean},"layout"),X_=vn({name:{type:String},order:{type:[Number,String],default:0},absolute:Boolean},"layout-item");function aL(){const e=vr(tb);if(!e)throw new Error("[Vuetify] Could not find injected layout");return{getLayoutItem:e.getLayoutItem,mainRect:e.mainRect,mainStyles:e.mainStyles}}function Y_(e){const s=vr(tb);if(!s)throw new Error("[Vuetify] Could not find injected layout");const u=e.id??`layout-item-${uc()}`,d=Po("useLayoutItem");xa(iL,{id:u});const b=Bi(!1);aC(()=>b.value=!0),vD(()=>b.value=!1);const{layoutItemStyles:E,layoutItemScrimStyles:T}=s.register(d,{...e,active:Fe(()=>b.value?!1:e.active.value),id:u});return ql(()=>s.unregister(u)),{layoutItemStyles:E,layoutRect:s.layoutRect,layoutItemScrimStyles:T}}const cU=(e,s,u,d)=>{let b={top:0,left:0,right:0,bottom:0};const E=[{id:"",layer:{...b}}];for(const T of e){const t=s.get(T),G=u.get(T),W=d.get(T);if(!t||!G||!W)continue;const Y={...b,[t.value]:parseInt(b[t.value],10)+(W.value?parseInt(G.value,10):0)};E.push({id:T,layer:Y}),b=Y}return E};function sL(e){const s=vr(tb,null),u=Fe(()=>s?s.rootZIndex.value-100:UA),d=yi([]),b=$l(new Map),E=$l(new Map),T=$l(new Map),t=$l(new Map),G=$l(new Map),{resizeRef:W,contentRect:Y}=Ff(),ne=Fe(()=>{const Ve=new Map,Ue=e.overlaps??[];for(const qe of Ue.filter(He=>He.includes(":"))){const[He,nt]=qe.split(":");if(!d.value.includes(He)||!d.value.includes(nt))continue;const rt=b.get(He),ft=b.get(nt),$t=E.get(He),hn=E.get(nt);!rt||!ft||!$t||!hn||(Ve.set(nt,{position:rt.value,amount:parseInt($t.value,10)}),Ve.set(He,{position:ft.value,amount:-parseInt(hn.value,10)}))}return Ve}),J=Fe(()=>{const Ve=[...new Set([...T.values()].map(qe=>qe.value))].sort((qe,He)=>qe-He),Ue=[];for(const qe of Ve){const He=d.value.filter(nt=>{var rt;return((rt=T.get(nt))==null?void 0:rt.value)===qe});Ue.push(...He)}return cU(Ue,b,E,t)}),Q=Fe(()=>!Array.from(G.values()).some(Ve=>Ve.value)),ce=Fe(()=>J.value[J.value.length-1].layer),ie=Fe(()=>({"--v-layout-left":Ji(ce.value.left),"--v-layout-right":Ji(ce.value.right),"--v-layout-top":Ji(ce.value.top),"--v-layout-bottom":Ji(ce.value.bottom),...Q.value?void 0:{transition:"none"}})),pe=Fe(()=>J.value.slice(1).map((Ve,Ue)=>{let{id:qe}=Ve;const{layer:He}=J.value[Ue],nt=E.get(qe),rt=b.get(qe);return{id:qe,...He,size:Number(nt.value),position:rt.value}})),be=Ve=>pe.value.find(Ue=>Ue.id===Ve),Ie=Po("createLayout"),$e=Bi(!1);Ua(()=>{$e.value=!0}),xa(tb,{register:(Ve,Ue)=>{let{id:qe,order:He,position:nt,layoutSize:rt,elementSize:ft,active:$t,disableTransitions:hn,absolute:gn}=Ue;T.set(qe,He),b.set(qe,nt),E.set(qe,rt),t.set(qe,$t),hn&&G.set(qe,hn);const ri=Zy(iL,Ie==null?void 0:Ie.vnode).indexOf(Ve);ri>-1?d.value.splice(ri,0,qe):d.value.push(qe);const ai=Fe(()=>pe.value.findIndex(Nn=>Nn.id===qe)),_n=Fe(()=>u.value+J.value.length*2-ai.value*2),Bn=Fe(()=>{const Nn=nt.value==="left"||nt.value==="right",Pn=nt.value==="right",Ci=nt.value==="bottom",Fi=ft.value??rt.value,Ln=Fi===0?"%":"px",sn={[nt.value]:0,zIndex:_n.value,transform:`translate${Nn?"X":"Y"}(${($t.value?0:-(Fi===0?100:Fi))*(Pn||Ci?-1:1)}${Ln})`,position:gn.value||u.value!==UA?"absolute":"fixed",...Q.value?void 0:{transition:"none"}};if(!$e.value)return sn;const qn=pe.value[ai.value];if(!qn)throw new Error(`[Vuetify] Could not find layout item "${qe}"`);const pi=ne.value.get(qe);return pi&&(qn[pi.position]+=pi.amount),{...sn,height:Nn?`calc(100% - ${qn.top}px - ${qn.bottom}px)`:ft.value?`${ft.value}px`:void 0,left:Pn?void 0:`${qn.left}px`,right:Pn?`${qn.right}px`:void 0,top:nt.value!=="bottom"?`${qn.top}px`:void 0,bottom:nt.value!=="top"?`${qn.bottom}px`:void 0,width:Nn?ft.value?`${ft.value}px`:void 0:`calc(100% - ${qn.left}px - ${qn.right}px)`}}),mn=Fe(()=>({zIndex:_n.value-1}));return{layoutItemStyles:Bn,layoutItemScrimStyles:mn,zIndex:_n}},unregister:Ve=>{T.delete(Ve),b.delete(Ve),E.delete(Ve),t.delete(Ve),G.delete(Ve),d.value=d.value.filter(Ue=>Ue!==Ve)},mainRect:ce,mainStyles:ie,getLayoutItem:be,items:pe,layoutRect:Y,rootZIndex:u});const Le=Fe(()=>["v-layout",{"v-layout--full-height":e.fullHeight}]),Oe=Fe(()=>({zIndex:s?u.value:void 0,position:s?"relative":void 0,overflow:s?"hidden":void 0}));return{layoutClasses:Le,layoutStyles:Oe,getLayoutItem:be,items:pe,layoutRect:Y,layoutRef:W}}function oL(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const{blueprint:s,...u}=e,d=Qc(s,u),{aliases:b={},components:E={},directives:T={}}=d,t=Z6(d.defaults),G=Yj(d.display,d.ssr),W=lU(d.theme),Y=aU(d.icons),ne=rj(d.locale),J=Zj(d.date,ne),Q=Jj(d.goTo,ne);return{install:ie=>{for(const pe in T)ie.directive(pe,T[pe]);for(const pe in E)ie.component(pe,E[pe]);for(const pe in b)ie.component(pe,Hh({...b[pe],name:pe,aliasName:b[pe].name}));if(W.install(ie),ie.provide(lv,t),ie.provide(hT,G),ie.provide(eb,W),ie.provide(dT,Y),ie.provide(cv,ne),ie.provide(JR,J.options),ie.provide(LA,J.instance),ie.provide(eL,Q),qa&&d.ssr)if(ie.$nuxt)ie.$nuxt.hook("app:suspense:resolve",()=>{G.update()});else{const{mount:pe}=ie;ie.mount=function(){const be=pe(...arguments);return Na(()=>G.update()),ie.mount=pe,be}}uc.reset(),ie.mixin({computed:{$vuetify(){return $l({defaults:Uy.call(this,lv),display:Uy.call(this,hT),theme:Uy.call(this,eb),icons:Uy.call(this,dT),locale:Uy.call(this,cv),date:Uy.call(this,LA)})}}})},defaults:t,display:G,theme:W,icons:Y,locale:ne,date:J,goTo:Q}}const uU="3.7.9";oL.version=uU;function Uy(e){var d,b;const s=this.$,u=((d=s.parent)==null?void 0:d.provides)??((b=s.vnode.appContext)==null?void 0:b.provides);if(u&&e in u)return u[e]}const hU=vn({...tr(),...rL({fullHeight:!0}),...Da()},"VApp"),dU=Qn()({name:"VApp",props:hU(),setup(e,s){let{slots:u}=s;const d=Ja(e),{layoutClasses:b,getLayoutItem:E,items:T,layoutRef:t}=sL(e),{rtlClasses:G}=Cl();return fi(()=>{var W;return de("div",{ref:t,class:["v-application",d.themeClasses.value,b.value,G.value,e.class],style:[e.style]},[de("div",{class:"v-application__wrap"},[(W=u.default)==null?void 0:W.call(u)])])}),{getLayoutItem:E,items:T,theme:d}}}),ia=vn({tag:{type:String,default:"div"}},"tag"),lL=vn({text:String,...tr(),...ia()},"VToolbarTitle"),AC=Qn()({name:"VToolbarTitle",props:lL(),setup(e,s){let{slots:u}=s;return fi(()=>{const d=!!(u.default||u.text||e.text);return de(e.tag,{class:["v-toolbar-title",e.class],style:e.style},{default:()=>{var b;return[d&&de("div",{class:"v-toolbar-title__placeholder"},[u.text?u.text():e.text,(b=u.default)==null?void 0:b.call(u)])]}})}),{}}}),fU=vn({disabled:Boolean,group:Boolean,hideOnLeave:Boolean,leaveAbsolute:Boolean,mode:String,origin:String},"transition");function Zh(e,s,u){return Qn()({name:e,props:fU({mode:u,origin:s}),setup(d,b){let{slots:E}=b;const T={onBeforeEnter(t){d.origin&&(t.style.transformOrigin=d.origin)},onLeave(t){if(d.leaveAbsolute){const{offsetTop:G,offsetLeft:W,offsetWidth:Y,offsetHeight:ne}=t;t._transitionInitialStyles={position:t.style.position,top:t.style.top,left:t.style.left,width:t.style.width,height:t.style.height},t.style.position="absolute",t.style.top=`${G}px`,t.style.left=`${W}px`,t.style.width=`${Y}px`,t.style.height=`${ne}px`}d.hideOnLeave&&t.style.setProperty("display","none","important")},onAfterLeave(t){if(d.leaveAbsolute&&(t!=null&&t._transitionInitialStyles)){const{position:G,top:W,left:Y,width:ne,height:J}=t._transitionInitialStyles;delete t._transitionInitialStyles,t.style.position=G||"",t.style.top=W||"",t.style.left=Y||"",t.style.width=ne||"",t.style.height=J||""}}};return()=>{const t=d.group?fC:kg;return Uf(t,{name:d.disabled?"":e,css:!d.disabled,...d.group?void 0:{mode:d.mode},...d.disabled?{}:T},E.default)}}})}function cL(e,s){let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"in-out";return Qn()({name:e,props:{mode:{type:String,default:u},disabled:Boolean,group:Boolean},setup(d,b){let{slots:E}=b;const T=d.group?fC:kg;return()=>Uf(T,{name:d.disabled?"":e,css:!d.disabled,...d.disabled?{}:s},E.default)}})}function uL(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";const u=(arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1)?"width":"height",d=mh(`offset-${u}`);return{onBeforeEnter(T){T._parent=T.parentNode,T._initialStyle={transition:T.style.transition,overflow:T.style.overflow,[u]:T.style[u]}},onEnter(T){const t=T._initialStyle;T.style.setProperty("transition","none","important"),T.style.overflow="hidden";const G=`${T[d]}px`;T.style[u]="0",T.offsetHeight,T.style.transition=t.transition,e&&T._parent&&T._parent.classList.add(e),requestAnimationFrame(()=>{T.style[u]=G})},onAfterEnter:E,onEnterCancelled:E,onLeave(T){T._initialStyle={transition:"",overflow:T.style.overflow,[u]:T.style[u]},T.style.overflow="hidden",T.style[u]=`${T[d]}px`,T.offsetHeight,requestAnimationFrame(()=>T.style[u]="0")},onAfterLeave:b,onLeaveCancelled:b};function b(T){e&&T._parent&&T._parent.classList.remove(e),E(T)}function E(T){const t=T._initialStyle[u];T.style.overflow=T._initialStyle.overflow,t!=null&&(T.style[u]=t),delete T._initialStyle}}const pU=vn({target:[Object,Array]},"v-dialog-transition"),Q1=Qn()({name:"VDialogTransition",props:pU(),setup(e,s){let{slots:u}=s;const d={onBeforeEnter(b){b.style.pointerEvents="none",b.style.visibility="hidden"},async onEnter(b,E){var J;await new Promise(Q=>requestAnimationFrame(Q)),await new Promise(Q=>requestAnimationFrame(Q)),b.style.visibility="";const{x:T,y:t,sx:G,sy:W,speed:Y}=GA(e.target,b),ne=P_(b,[{transform:`translate(${T}px, ${t}px) scale(${G}, ${W})`,opacity:0},{}],{duration:225*Y,easing:K6});(J=$A(b))==null||J.forEach(Q=>{P_(Q,[{opacity:0},{opacity:0,offset:.33},{}],{duration:225*2*Y,easing:Qx})}),ne.finished.then(()=>E())},onAfterEnter(b){b.style.removeProperty("pointer-events")},onBeforeLeave(b){b.style.pointerEvents="none"},async onLeave(b,E){var J;await new Promise(Q=>requestAnimationFrame(Q));const{x:T,y:t,sx:G,sy:W,speed:Y}=GA(e.target,b);P_(b,[{},{transform:`translate(${T}px, ${t}px) scale(${G}, ${W})`,opacity:0}],{duration:125*Y,easing:J6}).finished.then(()=>E()),(J=$A(b))==null||J.forEach(Q=>{P_(Q,[{},{opacity:0,offset:.2},{opacity:0}],{duration:125*2*Y,easing:Qx})})},onAfterLeave(b){b.style.removeProperty("pointer-events")}};return()=>e.target?de(kg,oi({name:"dialog-transition"},d,{css:!1}),u):de(kg,{name:"dialog-transition"},u)}});function $A(e){var u;const s=(u=e.querySelector(":scope > .v-card, :scope > .v-sheet, :scope > .v-list"))==null?void 0:u.children;return s&&[...s]}function GA(e,s){const u=RR(e),d=bC(s),[b,E]=getComputedStyle(s).transformOrigin.split(" ").map(be=>parseFloat(be)),[T,t]=getComputedStyle(s).getPropertyValue("--v-overlay-anchor-origin").split(" ");let G=u.left+u.width/2;T==="left"||t==="left"?G-=u.width/2:(T==="right"||t==="right")&&(G+=u.width/2);let W=u.top+u.height/2;T==="top"||t==="top"?W-=u.height/2:(T==="bottom"||t==="bottom")&&(W+=u.height/2);const Y=u.width/d.width,ne=u.height/d.height,J=Math.max(1,Y,ne),Q=Y/J||0,ce=ne/J||0,ie=d.width*d.height/(window.innerWidth*window.innerHeight),pe=ie>.12?Math.min(1.5,(ie-.12)*10+1):1;return{x:G-(b+d.left),y:W-(E+d.top),sx:Q,sy:ce,speed:pe}}const mU=Zh("fab-transition","center center","out-in"),gU=Zh("dialog-bottom-transition"),_U=Zh("dialog-top-transition"),nb=Zh("fade-transition"),kC=Zh("scale-transition"),yU=Zh("scroll-x-transition"),vU=Zh("scroll-x-reverse-transition"),xU=Zh("scroll-y-transition"),bU=Zh("scroll-y-reverse-transition"),wU=Zh("slide-x-transition"),SU=Zh("slide-x-reverse-transition"),DC=Zh("slide-y-transition"),TU=Zh("slide-y-reverse-transition"),ew=cL("expand-transition",uL()),RC=cL("expand-x-transition",uL("",!0)),CU=vn({defaults:Object,disabled:Boolean,reset:[Number,String],root:[Boolean,String],scoped:Boolean},"VDefaultsProvider"),da=Qn(!1)({name:"VDefaultsProvider",props:CU(),setup(e,s){let{slots:u}=s;const{defaults:d,disabled:b,reset:E,root:T,scoped:t}=zg(e);return Io(d,{reset:E,root:T,scoped:t,disabled:b}),()=>{var G;return(G=u.default)==null?void 0:G.call(u)}}}),hl=vn({height:[Number,String],maxHeight:[Number,String],maxWidth:[Number,String],minHeight:[Number,String],minWidth:[Number,String],width:[Number,String]},"dimension");function dl(e){return{dimensionStyles:Fe(()=>{const u={},d=Ji(e.height),b=Ji(e.maxHeight),E=Ji(e.maxWidth),T=Ji(e.minHeight),t=Ji(e.minWidth),G=Ji(e.width);return d!=null&&(u.height=d),b!=null&&(u.maxHeight=b),E!=null&&(u.maxWidth=E),T!=null&&(u.minHeight=T),t!=null&&(u.minWidth=t),G!=null&&(u.width=G),u})}}function EU(e){return{aspectStyles:Fe(()=>{const s=Number(e.aspectRatio);return s?{paddingBottom:String(1/s*100)+"%"}:void 0})}}const hL=vn({aspectRatio:[String,Number],contentClass:null,inline:Boolean,...tr(),...hl()},"VResponsive"),pT=Qn()({name:"VResponsive",props:hL(),setup(e,s){let{slots:u}=s;const{aspectStyles:d}=EU(e),{dimensionStyles:b}=dl(e);return fi(()=>{var E;return de("div",{class:["v-responsive",{"v-responsive--inline":e.inline},e.class],style:[b.value,e.style]},[de("div",{class:"v-responsive__sizer",style:d.value},null),(E=u.additional)==null?void 0:E.call(u),u.default&&de("div",{class:["v-responsive__content",e.contentClass]},[u.default()])])}),{}}});function LC(e){return xC(()=>{const s=[],u={};if(e.value.background)if(lT(e.value.background)){if(u.backgroundColor=e.value.background,!e.value.text&&V6(e.value.background)){const d=Gh(e.value.background);if(d.a==null||d.a===1){const b=$R(d);u.color=b,u.caretColor=b}}}else s.push(`bg-${e.value.background}`);return e.value.text&&(lT(e.value.text)?(u.color=e.value.text,u.caretColor=e.value.text):s.push(`text-${e.value.text}`)),{colorClasses:s,colorStyles:u}})}function Dc(e,s){const u=Fe(()=>({text:Mo(e)?e.value:s?e[s]:null})),{colorClasses:d,colorStyles:b}=LC(u);return{textColorClasses:d,textColorStyles:b}}function Ms(e,s){const u=Fe(()=>({background:Mo(e)?e.value:s?e[s]:null})),{colorClasses:d,colorStyles:b}=LC(u);return{backgroundColorClasses:d,backgroundColorStyles:b}}const Qs=vn({rounded:{type:[Boolean,Number,String],default:void 0},tile:Boolean},"rounded");function Ao(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:qp();return{roundedClasses:Fe(()=>{const d=Mo(e)?e.value:e.rounded,b=Mo(e)?e.value:e.tile,E=[];if(d===!0||d==="")E.push(`${s}--rounded`);else if(typeof d=="string"||d===0)for(const T of String(d).split(" "))E.push(`rounded-${T}`);else(b||d===!1)&&E.push("rounded-0");return E})}}const $f=vn({transition:{type:[Boolean,String,Object],default:"fade-transition",validator:e=>e!==!0}},"transition"),eu=(e,s)=>{let{slots:u}=s;const{transition:d,disabled:b,group:E,...T}=e,{component:t=E?fC:kg,...G}=typeof d=="object"?d:{};return Uf(t,oi(typeof d=="string"?{name:b?"":d}:G,typeof d=="string"?{}:Object.fromEntries(Object.entries({disabled:b,group:E}).filter(W=>{let[Y,ne]=W;return ne!==void 0})),T),u)};function MU(e,s){if(!_C)return;const u=s.modifiers||{},d=s.value,{handler:b,options:E}=typeof d=="object"?d:{handler:d,options:{}},T=new IntersectionObserver(function(){var ne;let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],G=arguments.length>1?arguments[1]:void 0;const W=(ne=e._observe)==null?void 0:ne[s.instance.$.uid];if(!W)return;const Y=t.some(J=>J.isIntersecting);b&&(!u.quiet||W.init)&&(!u.once||Y||W.init)&&b(Y,t,G),Y&&u.once?dL(e,s):W.init=!0},E);e._observe=Object(e._observe),e._observe[s.instance.$.uid]={init:!1,observer:T},T.observe(e)}function dL(e,s){var d;const u=(d=e._observe)==null?void 0:d[s.instance.$.uid];u&&(u.observer.unobserve(e),delete e._observe[s.instance.$.uid])}const gb={mounted:MU,unmounted:dL},fL=vn({absolute:Boolean,alt:String,cover:Boolean,color:String,draggable:{type:[Boolean,String],default:void 0},eager:Boolean,gradient:String,lazySrc:String,options:{type:Object,default:()=>({root:void 0,rootMargin:void 0,threshold:void 0})},sizes:String,src:{type:[String,Object],default:""},crossorigin:String,referrerpolicy:String,srcset:String,position:String,...hL(),...tr(),...Qs(),...$f()},"VImg"),Pm=Qn()({name:"VImg",directives:{intersect:gb},props:fL(),emits:{loadstart:e=>!0,load:e=>!0,error:e=>!0},setup(e,s){let{emit:u,slots:d}=s;const{backgroundColorClasses:b,backgroundColorStyles:E}=Ms($n(e,"color")),{roundedClasses:T}=Ao(e),t=Po("VImg"),G=Bi(""),W=yi(),Y=Bi(e.eager?"loading":"idle"),ne=Bi(),J=Bi(),Q=Fe(()=>e.src&&typeof e.src=="object"?{src:e.src.src,srcset:e.srcset||e.src.srcset,lazySrc:e.lazySrc||e.src.lazySrc,aspect:Number(e.aspectRatio||e.src.aspect||0)}:{src:e.src,srcset:e.srcset,lazySrc:e.lazySrc,aspect:Number(e.aspectRatio||0)}),ce=Fe(()=>Q.value.aspect||ne.value/J.value||0);Pi(()=>e.src,()=>{ie(Y.value!=="idle")}),Pi(ce,(ft,$t)=>{!ft&&$t&&W.value&&Le(W.value)}),pv(()=>ie());function ie(ft){if(!(e.eager&&ft)&&!(_C&&!ft&&!e.eager)){if(Y.value="loading",Q.value.lazySrc){const $t=new Image;$t.src=Q.value.lazySrc,Le($t,null)}Q.value.src&&Na(()=>{var $t;u("loadstart",(($t=W.value)==null?void 0:$t.currentSrc)||Q.value.src),setTimeout(()=>{var hn;if(!t.isUnmounted)if((hn=W.value)!=null&&hn.complete){if(W.value.naturalWidth||be(),Y.value==="error")return;ce.value||Le(W.value,null),Y.value==="loading"&&pe()}else ce.value||Le(W.value),Ie()})})}}function pe(){var ft;t.isUnmounted||(Ie(),Le(W.value),Y.value="loaded",u("load",((ft=W.value)==null?void 0:ft.currentSrc)||Q.value.src))}function be(){var ft;t.isUnmounted||(Y.value="error",u("error",((ft=W.value)==null?void 0:ft.currentSrc)||Q.value.src))}function Ie(){const ft=W.value;ft&&(G.value=ft.currentSrc||ft.src)}let $e=-1;ql(()=>{clearTimeout($e)});function Le(ft){let $t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;const hn=()=>{if(clearTimeout($e),t.isUnmounted)return;const{naturalHeight:gn,naturalWidth:pn}=ft;gn||pn?(ne.value=pn,J.value=gn):!ft.complete&&Y.value==="loading"&&$t!=null?$e=window.setTimeout(hn,$t):(ft.currentSrc.endsWith(".svg")||ft.currentSrc.startsWith("data:image/svg+xml"))&&(ne.value=1,J.value=1)};hn()}const Oe=Fe(()=>({"v-img__img--cover":e.cover,"v-img__img--contain":!e.cover})),Ve=()=>{var hn;if(!Q.value.src||Y.value==="idle")return null;const ft=de("img",{class:["v-img__img",Oe.value],style:{objectPosition:e.position},crossorigin:e.crossorigin,src:Q.value.src,srcset:Q.value.srcset,alt:e.alt,referrerpolicy:e.referrerpolicy,draggable:e.draggable,sizes:e.sizes,ref:W,onLoad:pe,onError:be},null),$t=(hn=d.sources)==null?void 0:hn.call(d);return de(eu,{transition:e.transition,appear:!0},{default:()=>[Js($t?de("picture",{class:"v-img__picture"},[$t,ft]):ft,[[Nd,Y.value==="loaded"]])]})},Ue=()=>de(eu,{transition:e.transition},{default:()=>[Q.value.lazySrc&&Y.value!=="loaded"&&de("img",{class:["v-img__img","v-img__img--preload",Oe.value],style:{objectPosition:e.position},crossorigin:e.crossorigin,src:Q.value.lazySrc,alt:e.alt,referrerpolicy:e.referrerpolicy,draggable:e.draggable},null)]}),qe=()=>d.placeholder?de(eu,{transition:e.transition,appear:!0},{default:()=>[(Y.value==="loading"||Y.value==="error"&&!d.error)&&de("div",{class:"v-img__placeholder"},[d.placeholder()])]}):null,He=()=>d.error?de(eu,{transition:e.transition,appear:!0},{default:()=>[Y.value==="error"&&de("div",{class:"v-img__error"},[d.error()])]}):null,nt=()=>e.gradient?de("div",{class:"v-img__gradient",style:{backgroundImage:`linear-gradient(${e.gradient})`}},null):null,rt=Bi(!1);{const ft=Pi(ce,$t=>{$t&&(requestAnimationFrame(()=>{requestAnimationFrame(()=>{rt.value=!0})}),ft())})}return fi(()=>{const ft=pT.filterProps(e);return Js(de(pT,oi({class:["v-img",{"v-img--absolute":e.absolute,"v-img--booting":!rt.value},b.value,T.value,e.class],style:[{width:Ji(e.width==="auto"?ne.value:e.width)},E.value,e.style]},ft,{aspectRatio:ce.value,"aria-label":e.alt,role:e.alt?"img":void 0}),{additional:()=>de(sr,null,[de(Ve,null,null),de(Ue,null,null),de(nt,null,null),de(qe,null,null),de(He,null,null)]),default:d.default}),[[qh("intersect"),{handler:ie,options:e.options},null,{once:!0}]])}),{currentSrc:G,image:W,state:Y,naturalWidth:ne,naturalHeight:J}}}),gh=vn({border:[Boolean,Number,String]},"border");function Wh(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:qp();return{borderClasses:Fe(()=>{const d=Mo(e)?e.value:e.border,b=[];if(d===!0||d==="")b.push(`${s}--border`);else if(typeof d=="string"||d===0)for(const E of String(d).split(" "))b.push(`border-${E}`);return b})}}const El=vn({elevation:{type:[Number,String],validator(e){const s=parseInt(e);return!isNaN(s)&&s>=0&&s<=24}}},"elevation");function hc(e){return{elevationClasses:Fe(()=>{const u=Mo(e)?e.value:e.elevation,d=[];return u==null||d.push(`elevation-${u}`),d})}}const IU=[null,"prominent","default","comfortable","compact"],pL=vn({absolute:Boolean,collapse:Boolean,color:String,density:{type:String,default:"default",validator:e=>IU.includes(e)},extended:Boolean,extensionHeight:{type:[Number,String],default:48},flat:Boolean,floating:Boolean,height:{type:[Number,String],default:64},image:String,title:String,...gh(),...tr(),...El(),...Qs(),...ia({tag:"header"}),...Da()},"VToolbar"),mT=Qn()({name:"VToolbar",props:pL(),setup(e,s){var Q;let{slots:u}=s;const{backgroundColorClasses:d,backgroundColorStyles:b}=Ms($n(e,"color")),{borderClasses:E}=Wh(e),{elevationClasses:T}=hc(e),{roundedClasses:t}=Ao(e),{themeClasses:G}=Ja(e),{rtlClasses:W}=Cl(),Y=Bi(!!(e.extended||(Q=u.extension)!=null&&Q.call(u))),ne=Fe(()=>parseInt(Number(e.height)+(e.density==="prominent"?Number(e.height):0)-(e.density==="comfortable"?8:0)-(e.density==="compact"?16:0),10)),J=Fe(()=>Y.value?parseInt(Number(e.extensionHeight)+(e.density==="prominent"?Number(e.extensionHeight):0)-(e.density==="comfortable"?4:0)-(e.density==="compact"?8:0),10):0);return Io({VBtn:{variant:"text"}}),fi(()=>{var be;const ce=!!(e.title||u.title),ie=!!(u.image||e.image),pe=(be=u.extension)==null?void 0:be.call(u);return Y.value=!!(e.extended||pe),de(e.tag,{class:["v-toolbar",{"v-toolbar--absolute":e.absolute,"v-toolbar--collapse":e.collapse,"v-toolbar--flat":e.flat,"v-toolbar--floating":e.floating,[`v-toolbar--density-${e.density}`]:!0},d.value,E.value,T.value,t.value,G.value,W.value,e.class],style:[b.value,e.style]},{default:()=>[ie&&de("div",{key:"image",class:"v-toolbar__image"},[u.image?de(da,{key:"image-defaults",disabled:!e.image,defaults:{VImg:{cover:!0,src:e.image}}},u.image):de(Pm,{key:"image-img",cover:!0,src:e.image},null)]),de(da,{defaults:{VTabs:{height:Ji(ne.value)}}},{default:()=>{var Ie,$e,Le;return[de("div",{class:"v-toolbar__content",style:{height:Ji(ne.value)}},[u.prepend&&de("div",{class:"v-toolbar__prepend"},[(Ie=u.prepend)==null?void 0:Ie.call(u)]),ce&&de(AC,{key:"title",text:e.title},{text:u.title}),($e=u.default)==null?void 0:$e.call(u),u.append&&de("div",{class:"v-toolbar__append"},[(Le=u.append)==null?void 0:Le.call(u)])])]}}),de(da,{defaults:{VTabs:{height:Ji(J.value)}}},{default:()=>[de(ew,null,{default:()=>[Y.value&&de("div",{class:"v-toolbar__extension",style:{height:Ji(J.value)}},[pe])]})]})]})}),{contentHeight:ne,extensionHeight:J}}}),PU=vn({scrollTarget:{type:String},scrollThreshold:{type:[String,Number],default:300}},"scroll");function AU(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{canScroll:u}=s;let d=0,b=0;const E=yi(null),T=Bi(0),t=Bi(0),G=Bi(0),W=Bi(!1),Y=Bi(!1),ne=Fe(()=>Number(e.scrollThreshold)),J=Fe(()=>Ko((ne.value-T.value)/ne.value||0)),Q=()=>{const ce=E.value;if(!ce||u&&!u.value)return;d=T.value,T.value="window"in ce?ce.pageYOffset:ce.scrollTop;const ie=ce instanceof Window?document.documentElement.scrollHeight:ce.scrollHeight;if(b!==ie){b=ie;return}Y.value=T.value<d,G.value=Math.abs(T.value-ne.value)};return Pi(Y,()=>{t.value=t.value||T.value}),Pi(W,()=>{t.value=0}),Ua(()=>{Pi(()=>e.scrollTarget,ce=>{var pe;const ie=ce?document.querySelector(ce):window;ie&&ie!==E.value&&((pe=E.value)==null||pe.removeEventListener("scroll",Q),E.value=ie,E.value.addEventListener("scroll",Q,{passive:!0}))},{immediate:!0})}),ql(()=>{var ce;(ce=E.value)==null||ce.removeEventListener("scroll",Q)}),u&&Pi(u,Q,{immediate:!0}),{scrollThreshold:ne,currentScroll:T,currentThreshold:G,isScrollActive:W,scrollRatio:J,isScrollingUp:Y,savedScroll:t}}function K_(){const e=Bi(!1);return Ua(()=>{window.requestAnimationFrame(()=>{e.value=!0})}),{ssrBootStyles:Fe(()=>e.value?void 0:{transition:"none !important"}),isBooted:ub(e)}}const kU=vn({scrollBehavior:String,modelValue:{type:Boolean,default:!0},location:{type:String,default:"top",validator:e=>["top","bottom"].includes(e)},...pL(),...X_(),...PU(),height:{type:[Number,String],default:64}},"VAppBar"),DU=Qn()({name:"VAppBar",props:kU(),emits:{"update:modelValue":e=>!0},setup(e,s){let{slots:u}=s;const d=yi(),b=mr(e,"modelValue"),E=Fe(()=>{var $e;const Ie=new Set((($e=e.scrollBehavior)==null?void 0:$e.split(" "))??[]);return{hide:Ie.has("hide"),fullyHide:Ie.has("fully-hide"),inverted:Ie.has("inverted"),collapse:Ie.has("collapse"),elevate:Ie.has("elevate"),fadeImage:Ie.has("fade-image")}}),T=Fe(()=>{const Ie=E.value;return Ie.hide||Ie.fullyHide||Ie.inverted||Ie.collapse||Ie.elevate||Ie.fadeImage||!b.value}),{currentScroll:t,scrollThreshold:G,isScrollingUp:W,scrollRatio:Y}=AU(e,{canScroll:T}),ne=Fe(()=>E.value.hide||E.value.fullyHide),J=Fe(()=>e.collapse||E.value.collapse&&(E.value.inverted?Y.value>0:Y.value===0)),Q=Fe(()=>e.flat||E.value.fullyHide&&!b.value||E.value.elevate&&(E.value.inverted?t.value>0:t.value===0)),ce=Fe(()=>E.value.fadeImage?E.value.inverted?1-Y.value:Y.value:void 0),ie=Fe(()=>{var Le,Oe;if(E.value.hide&&E.value.inverted)return 0;const Ie=((Le=d.value)==null?void 0:Le.contentHeight)??0,$e=((Oe=d.value)==null?void 0:Oe.extensionHeight)??0;return ne.value?t.value<G.value||E.value.fullyHide?Ie+$e:Ie:Ie+$e});Du(Fe(()=>!!e.scrollBehavior),()=>{Jo(()=>{ne.value?E.value.inverted?b.value=t.value>G.value:b.value=W.value||t.value<G.value:b.value=!0})});const{ssrBootStyles:pe}=K_(),{layoutItemStyles:be}=Y_({id:e.name,order:Fe(()=>parseInt(e.order,10)),position:$n(e,"location"),layoutSize:ie,elementSize:Bi(void 0),active:b,absolute:$n(e,"absolute")});return fi(()=>{const Ie=mT.filterProps(e);return de(mT,oi({ref:d,class:["v-app-bar",{"v-app-bar--bottom":e.location==="bottom"},e.class],style:[{...be.value,"--v-toolbar-image-opacity":ce.value,height:void 0,...pe.value},e.style]},Ie,{collapse:J.value,flat:Q.value}),u)}),{}}}),RU=[null,"default","comfortable","compact"],Hl=vn({density:{type:String,default:"default",validator:e=>RU.includes(e)}},"density");function iu(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:qp();return{densityClasses:Fe(()=>`${s}--density-${e.density}`)}}const LU=["elevated","flat","tonal","outlined","text","plain"];function Fg(e,s){return de(sr,null,[e&&de("span",{key:"overlay",class:`${s}__overlay`},null),de("span",{key:"underlay",class:`${s}__underlay`},null)])}const Ud=vn({color:String,variant:{type:String,default:"elevated",validator:e=>LU.includes(e)}},"variant");function J_(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:qp();const u=Fe(()=>{const{variant:E}=Ps(e);return`${s}--variant-${E}`}),{colorClasses:d,colorStyles:b}=LC(Fe(()=>{const{variant:E,color:T}=Ps(e);return{[["elevated","flat"].includes(E)?"background":"text"]:T}}));return{colorClasses:d,colorStyles:b,variantClasses:u}}const mL=vn({baseColor:String,divided:Boolean,...gh(),...tr(),...Hl(),...El(),...Qs(),...ia(),...Da(),...Ud()},"VBtnGroup"),gT=Qn()({name:"VBtnGroup",props:mL(),setup(e,s){let{slots:u}=s;const{themeClasses:d}=Ja(e),{densityClasses:b}=iu(e),{borderClasses:E}=Wh(e),{elevationClasses:T}=hc(e),{roundedClasses:t}=Ao(e);Io({VBtn:{height:"auto",baseColor:$n(e,"baseColor"),color:$n(e,"color"),density:$n(e,"density"),flat:!0,variant:$n(e,"variant")}}),fi(()=>de(e.tag,{class:["v-btn-group",{"v-btn-group--divided":e.divided},d.value,E.value,b.value,T.value,t.value,e.class],style:e.style},u))}}),Q_=vn({modelValue:{type:null,default:void 0},multiple:Boolean,mandatory:[Boolean,String],max:Number,selectedClass:String,disabled:Boolean},"group"),ey=vn({value:null,disabled:Boolean,selectedClass:String},"group-item");function ty(e,s){let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;const d=Po("useGroupItem");if(!d)throw new Error("[Vuetify] useGroupItem composable must be used inside a component setup function");const b=uc();xa(Symbol.for(`${s.description}:id`),b);const E=vr(s,null);if(!E){if(!u)return E;throw new Error(`[Vuetify] Could not find useGroup injection with symbol ${s.description}`)}const T=$n(e,"value"),t=Fe(()=>!!(E.disabled.value||e.disabled));E.register({id:b,value:T,disabled:t},d),ql(()=>{E.unregister(b)});const G=Fe(()=>E.isSelected(b)),W=Fe(()=>E.items.value[0].id===b),Y=Fe(()=>E.items.value[E.items.value.length-1].id===b),ne=Fe(()=>G.value&&[E.selectedClass.value,e.selectedClass]);return Pi(G,J=>{d.emit("group:selected",{value:J})},{flush:"sync"}),{id:b,isSelected:G,isFirst:W,isLast:Y,toggle:()=>E.select(b,!G.value),select:J=>E.select(b,J),selectedClass:ne,value:T,disabled:t,group:E}}function Bg(e,s){let u=!1;const d=$l([]),b=mr(e,"modelValue",[],J=>J==null?[]:gL(d,po(J)),J=>{const Q=OU(d,J);return e.multiple?Q:Q[0]}),E=Po("useGroup");function T(J,Q){const ce=J,ie=Symbol.for(`${s.description}:id`),be=Zy(ie,E==null?void 0:E.vnode).indexOf(Q);Ps(ce.value)==null&&(ce.value=be,ce.useIndexAsValue=!0),be>-1?d.splice(be,0,ce):d.push(ce)}function t(J){if(u)return;G();const Q=d.findIndex(ce=>ce.id===J);d.splice(Q,1)}function G(){const J=d.find(Q=>!Q.disabled);J&&e.mandatory==="force"&&!b.value.length&&(b.value=[J.id])}Ua(()=>{G()}),ql(()=>{u=!0}),sC(()=>{for(let J=0;J<d.length;J++)d[J].useIndexAsValue&&(d[J].value=J)});function W(J,Q){const ce=d.find(ie=>ie.id===J);if(!(Q&&(ce!=null&&ce.disabled)))if(e.multiple){const ie=b.value.slice(),pe=ie.findIndex(Ie=>Ie===J),be=~pe;if(Q=Q??!be,be&&e.mandatory&&ie.length<=1||!be&&e.max!=null&&ie.length+1>e.max)return;pe<0&&Q?ie.push(J):pe>=0&&!Q&&ie.splice(pe,1),b.value=ie}else{const ie=b.value.includes(J);if(e.mandatory&&ie)return;b.value=Q??!ie?[J]:[]}}function Y(J){if(e.multiple,b.value.length){const Q=b.value[0],ce=d.findIndex(be=>be.id===Q);let ie=(ce+J)%d.length,pe=d[ie];for(;pe.disabled&&ie!==ce;)ie=(ie+J)%d.length,pe=d[ie];if(pe.disabled)return;b.value=[d[ie].id]}else{const Q=d.find(ce=>!ce.disabled);Q&&(b.value=[Q.id])}}const ne={register:T,unregister:t,selected:b,select:W,disabled:$n(e,"disabled"),prev:()=>Y(d.length-1),next:()=>Y(1),isSelected:J=>b.value.includes(J),selectedClass:Fe(()=>e.selectedClass),items:Fe(()=>d),getItemIndex:J=>zU(d,J)};return xa(s,ne),ne}function zU(e,s){const u=gL(e,[s]);return u.length?e.findIndex(d=>d.id===u[0]):-1}function gL(e,s){const u=[];return s.forEach(d=>{const b=e.find(T=>Gp(d,T.value)),E=e[d];(b==null?void 0:b.value)!=null?u.push(b.id):E!=null&&u.push(E.id)}),u}function OU(e,s){const u=[];return s.forEach(d=>{const b=e.findIndex(E=>E.id===d);if(~b){const E=e[b];u.push(E.value!=null?E.value:b)}}),u}const zC=Symbol.for("vuetify:v-btn-toggle"),FU=vn({...mL(),...Q_()},"VBtnToggle"),BU=Qn()({name:"VBtnToggle",props:FU(),emits:{"update:modelValue":e=>!0},setup(e,s){let{slots:u}=s;const{isSelected:d,next:b,prev:E,select:T,selected:t}=Bg(e,zC);return fi(()=>{const G=gT.filterProps(e);return de(gT,oi({class:["v-btn-toggle",e.class]},G,{style:e.style}),{default:()=>{var W;return[(W=u.default)==null?void 0:W.call(u,{isSelected:d,next:b,prev:E,select:T,selected:t})]}})}),{next:b,prev:E,select:T}}}),VU=["x-small","small","default","large","x-large"],Zp=vn({size:{type:[String,Number],default:"default"}},"size");function gv(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:qp();return xC(()=>{let u,d;return w1(VU,e.size)?u=`${s}--size-${e.size}`:e.size&&(d={width:Ji(e.size),height:Ji(e.size)}),{sizeClasses:u,sizeStyles:d}})}const NU=vn({color:String,disabled:Boolean,start:Boolean,end:Boolean,icon:_r,...tr(),...Zp(),...ia({tag:"i"}),...Da()},"VIcon"),Ka=Qn()({name:"VIcon",props:NU(),setup(e,s){let{attrs:u,slots:d}=s;const b=yi(),{themeClasses:E}=Ja(e),{iconData:T}=sU(Fe(()=>b.value||e.icon)),{sizeClasses:t}=gv(e),{textColorClasses:G,textColorStyles:W}=Dc($n(e,"color"));return fi(()=>{var J,Q;const Y=(J=d.default)==null?void 0:J.call(d);Y&&(b.value=(Q=IR(Y).filter(ce=>ce.type===db&&ce.children&&typeof ce.children=="string")[0])==null?void 0:Q.children);const ne=!!(u.onClick||u.onClickOnce);return de(T.value.component,{tag:e.tag,icon:T.value.icon,class:["v-icon","notranslate",E.value,t.value,G.value,{"v-icon--clickable":ne,"v-icon--disabled":e.disabled,"v-icon--start":e.start,"v-icon--end":e.end},e.class],style:[t.value?void 0:{fontSize:Ji(e.size),height:Ji(e.size),width:Ji(e.size)},W.value,e.style],role:ne?"button":void 0,"aria-hidden":!ne,tabindex:ne?e.disabled?-1:0:void 0},{default:()=>[Y]})}),{}}});function tw(e,s){const u=yi(),d=Bi(!1);if(_C){const b=new IntersectionObserver(E=>{d.value=!!E.find(T=>T.isIntersecting)},s);ql(()=>{b.disconnect()}),Pi(u,(E,T)=>{T&&(b.unobserve(T),d.value=!1),E&&b.observe(E)},{flush:"post"})}return{intersectionRef:u,isIntersecting:d}}const jU=vn({bgColor:String,color:String,indeterminate:[Boolean,String],modelValue:{type:[Number,String],default:0},rotate:{type:[Number,String],default:0},width:{type:[Number,String],default:4},...tr(),...Zp(),...ia({tag:"div"}),...Da()},"VProgressCircular"),uv=Qn()({name:"VProgressCircular",props:jU(),setup(e,s){let{slots:u}=s;const d=20,b=2*Math.PI*d,E=yi(),{themeClasses:T}=Ja(e),{sizeClasses:t,sizeStyles:G}=gv(e),{textColorClasses:W,textColorStyles:Y}=Dc($n(e,"color")),{textColorClasses:ne,textColorStyles:J}=Dc($n(e,"bgColor")),{intersectionRef:Q,isIntersecting:ce}=tw(),{resizeRef:ie,contentRect:pe}=Ff(),be=Fe(()=>Math.max(0,Math.min(100,parseFloat(e.modelValue)))),Ie=Fe(()=>Number(e.width)),$e=Fe(()=>G.value?Number(e.size):pe.value?pe.value.width:Math.max(Ie.value,32)),Le=Fe(()=>d/(1-Ie.value/$e.value)*2),Oe=Fe(()=>Ie.value/$e.value*Le.value),Ve=Fe(()=>Ji((100-be.value)/100*b));return Jo(()=>{Q.value=E.value,ie.value=E.value}),fi(()=>de(e.tag,{ref:E,class:["v-progress-circular",{"v-progress-circular--indeterminate":!!e.indeterminate,"v-progress-circular--visible":ce.value,"v-progress-circular--disable-shrink":e.indeterminate==="disable-shrink"},T.value,t.value,W.value,e.class],style:[G.value,Y.value,e.style],role:"progressbar","aria-valuemin":"0","aria-valuemax":"100","aria-valuenow":e.indeterminate?void 0:be.value},{default:()=>[de("svg",{style:{transform:`rotate(calc(-90deg + ${Number(e.rotate)}deg))`},xmlns:"http://www.w3.org/2000/svg",viewBox:`0 0 ${Le.value} ${Le.value}`},[de("circle",{class:["v-progress-circular__underlay",ne.value],style:J.value,fill:"transparent",cx:"50%",cy:"50%",r:d,"stroke-width":Oe.value,"stroke-dasharray":b,"stroke-dashoffset":0},null),de("circle",{class:"v-progress-circular__overlay",fill:"transparent",cx:"50%",cy:"50%",r:d,"stroke-width":Oe.value,"stroke-dasharray":b,"stroke-dashoffset":Ve.value},null)]),u.default&&de("div",{class:"v-progress-circular__content"},[u.default({value:be.value})])]})),{}}}),qA={center:"center",top:"bottom",bottom:"top",left:"right",right:"left"},Lm=vn({location:String},"location");function ny(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,u=arguments.length>2?arguments[2]:void 0;const{isRtl:d}=Cl();return{locationStyles:Fe(()=>{if(!e.location)return{};const{side:E,align:T}=sT(e.location.split(" ").length>1?e.location:`${e.location} center`,d.value);function t(W){return u?u(W):0}const G={};return E!=="center"&&(s?G[qA[E]]=`calc(100% - ${t(E)}px)`:G[E]=0),T!=="center"?s?G[qA[T]]=`calc(100% - ${t(T)}px)`:G[T]=0:(E==="center"?G.top=G.left="50%":G[{top:"left",bottom:"left",left:"top",right:"top"}[E]]="50%",G.transform={top:"translateX(-50%)",bottom:"translateX(-50%)",left:"translateY(-50%)",right:"translateY(-50%)",center:"translate(-50%, -50%)"}[E]),G})}}const UU=vn({absolute:Boolean,active:{type:Boolean,default:!0},bgColor:String,bgOpacity:[Number,String],bufferValue:{type:[Number,String],default:0},bufferColor:String,bufferOpacity:[Number,String],clickable:Boolean,color:String,height:{type:[Number,String],default:4},indeterminate:Boolean,max:{type:[Number,String],default:100},modelValue:{type:[Number,String],default:0},opacity:[Number,String],reverse:Boolean,stream:Boolean,striped:Boolean,roundedBar:Boolean,...tr(),...Lm({location:"top"}),...Qs(),...ia(),...Da()},"VProgressLinear"),nw=Qn()({name:"VProgressLinear",props:UU(),emits:{"update:modelValue":e=>!0},setup(e,s){var rt;let{slots:u}=s;const d=mr(e,"modelValue"),{isRtl:b,rtlClasses:E}=Cl(),{themeClasses:T}=Ja(e),{locationStyles:t}=ny(e),{textColorClasses:G,textColorStyles:W}=Dc(e,"color"),{backgroundColorClasses:Y,backgroundColorStyles:ne}=Ms(Fe(()=>e.bgColor||e.color)),{backgroundColorClasses:J,backgroundColorStyles:Q}=Ms(Fe(()=>e.bufferColor||e.bgColor||e.color)),{backgroundColorClasses:ce,backgroundColorStyles:ie}=Ms(e,"color"),{roundedClasses:pe}=Ao(e),{intersectionRef:be,isIntersecting:Ie}=tw(),$e=Fe(()=>parseFloat(e.max)),Le=Fe(()=>parseFloat(e.height)),Oe=Fe(()=>Ko(parseFloat(e.bufferValue)/$e.value*100,0,100)),Ve=Fe(()=>Ko(parseFloat(d.value)/$e.value*100,0,100)),Ue=Fe(()=>b.value!==e.reverse),qe=Fe(()=>e.indeterminate?"fade-transition":"slide-x-transition"),He=qa&&((rt=window.matchMedia)==null?void 0:rt.call(window,"(forced-colors: active)").matches);function nt(ft){if(!be.value)return;const{left:$t,right:hn,width:gn}=be.value.getBoundingClientRect(),pn=Ue.value?gn-ft.clientX+(hn-gn):ft.clientX-$t;d.value=Math.round(pn/gn*$e.value)}return fi(()=>de(e.tag,{ref:be,class:["v-progress-linear",{"v-progress-linear--absolute":e.absolute,"v-progress-linear--active":e.active&&Ie.value,"v-progress-linear--reverse":Ue.value,"v-progress-linear--rounded":e.rounded,"v-progress-linear--rounded-bar":e.roundedBar,"v-progress-linear--striped":e.striped},pe.value,T.value,E.value,e.class],style:[{bottom:e.location==="bottom"?0:void 0,top:e.location==="top"?0:void 0,height:e.active?Ji(Le.value):0,"--v-progress-linear-height":Ji(Le.value),...e.absolute?t.value:{}},e.style],role:"progressbar","aria-hidden":e.active?"false":"true","aria-valuemin":"0","aria-valuemax":e.max,"aria-valuenow":e.indeterminate?void 0:Math.min(parseFloat(d.value),$e.value),onClick:e.clickable&&nt},{default:()=>[e.stream&&de("div",{key:"stream",class:["v-progress-linear__stream",G.value],style:{...W.value,[Ue.value?"left":"right"]:Ji(-Le.value),borderTop:`${Ji(Le.value/2)} dotted`,opacity:parseFloat(e.bufferOpacity),top:`calc(50% - ${Ji(Le.value/4)})`,width:Ji(100-Oe.value,"%"),"--v-progress-linear-stream-to":Ji(Le.value*(Ue.value?1:-1))}},null),de("div",{class:["v-progress-linear__background",He?void 0:Y.value],style:[ne.value,{opacity:parseFloat(e.bgOpacity),width:e.stream?0:void 0}]},null),de("div",{class:["v-progress-linear__buffer",He?void 0:J.value],style:[Q.value,{opacity:parseFloat(e.bufferOpacity),width:Ji(Oe.value,"%")}]},null),de(kg,{name:qe.value},{default:()=>[e.indeterminate?de("div",{class:"v-progress-linear__indeterminate"},[["long","short"].map(ft=>de("div",{key:ft,class:["v-progress-linear__indeterminate",ft,He?void 0:ce.value],style:ie.value},null))]):de("div",{class:["v-progress-linear__determinate",He?void 0:ce.value],style:[ie.value,{width:Ji(Ve.value,"%")}]},null)]}),u.default&&de("div",{class:"v-progress-linear__content"},[u.default({value:Ve.value,buffer:Oe.value})])]})),{}}}),iw=vn({loading:[Boolean,String]},"loader");function _b(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:qp();return{loaderClasses:Fe(()=>({[`${s}--loading`]:e.loading}))}}function yb(e,s){var d;let{slots:u}=s;return de("div",{class:`${e.name}__loader`},[((d=u.default)==null?void 0:d.call(u,{color:e.color,isActive:e.active}))||de(nw,{absolute:e.absolute,active:e.active,color:e.color,height:"2",indeterminate:!0},null)])}const $U=["static","relative","fixed","absolute","sticky"],_v=vn({position:{type:String,validator:e=>$U.includes(e)}},"position");function yv(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:qp();return{positionClasses:Fe(()=>e.position?`${s}--${e.position}`:void 0)}}function GU(){const e=Po("useRoute");return Fe(()=>{var s;return(s=e==null?void 0:e.proxy)==null?void 0:s.$route})}function _L(){var e,s;return(s=(e=Po("useRouter"))==null?void 0:e.proxy)==null?void 0:s.$router}function vb(e,s){var ne,J;const u=i5("RouterLink"),d=Fe(()=>!!(e.href||e.to)),b=Fe(()=>(d==null?void 0:d.value)||_A(s,"click")||_A(e,"click"));if(typeof u=="string"||!("useLink"in u)){const Q=$n(e,"href");return{isLink:d,isClickable:b,href:Q,linkProps:$l({href:Q})}}const E=Fe(()=>({...e,to:$n(()=>e.to||"")})),T=u.useLink(E.value),t=Fe(()=>e.to?T:void 0),G=GU(),W=Fe(()=>{var Q,ce,ie;return t.value?e.exact?G.value?((ie=t.value.isExactActive)==null?void 0:ie.value)&&Gp(t.value.route.value.query,G.value.query):((ce=t.value.isExactActive)==null?void 0:ce.value)??!1:((Q=t.value.isActive)==null?void 0:Q.value)??!1:!1}),Y=Fe(()=>{var Q;return e.to?(Q=t.value)==null?void 0:Q.route.value.href:e.href});return{isLink:d,isClickable:b,isActive:W,route:(ne=t.value)==null?void 0:ne.route,navigate:(J=t.value)==null?void 0:J.navigate,href:Y,linkProps:$l({href:Y,"aria-current":Fe(()=>W.value?"page":void 0)})}}const xb=vn({href:String,replace:Boolean,to:[String,Object],exact:Boolean},"router");let R2=!1;function qU(e,s){let u=!1,d,b;qa&&(e!=null&&e.beforeEach)&&(Na(()=>{window.addEventListener("popstate",E),d=e.beforeEach((T,t,G)=>{R2?u?s(G):G():setTimeout(()=>u?s(G):G()),R2=!0}),b=e==null?void 0:e.afterEach(()=>{R2=!1})}),nu(()=>{window.removeEventListener("popstate",E),d==null||d(),b==null||b()}));function E(T){var t;(t=T.state)!=null&&t.replaced||(u=!0,setTimeout(()=>u=!1))}}function HU(e,s){Pi(()=>{var u;return(u=e.isActive)==null?void 0:u.value},u=>{e.isLink.value&&u&&s&&Na(()=>{s(!0)})},{immediate:!0})}const _T=Symbol("rippleStop"),ZU=80;function HA(e,s){e.style.transform=s,e.style.webkitTransform=s}function yT(e){return e.constructor.name==="TouchEvent"}function yL(e){return e.constructor.name==="KeyboardEvent"}const WU=function(e,s){var ne;let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},d=0,b=0;if(!yL(e)){const J=s.getBoundingClientRect(),Q=yT(e)?e.touches[e.touches.length-1]:e;d=Q.clientX-J.left,b=Q.clientY-J.top}let E=0,T=.3;(ne=s._ripple)!=null&&ne.circle?(T=.15,E=s.clientWidth/2,E=u.center?E:E+Math.sqrt((d-E)**2+(b-E)**2)/4):E=Math.sqrt(s.clientWidth**2+s.clientHeight**2)/2;const t=`${(s.clientWidth-E*2)/2}px`,G=`${(s.clientHeight-E*2)/2}px`,W=u.center?t:`${d-E}px`,Y=u.center?G:`${b-E}px`;return{radius:E,scale:T,x:W,y:Y,centerX:t,centerY:G}},M1={show(e,s){var Q;let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(!((Q=s==null?void 0:s._ripple)!=null&&Q.enabled))return;const d=document.createElement("span"),b=document.createElement("span");d.appendChild(b),d.className="v-ripple__container",u.class&&(d.className+=` ${u.class}`);const{radius:E,scale:T,x:t,y:G,centerX:W,centerY:Y}=WU(e,s,u),ne=`${E*2}px`;b.className="v-ripple__animation",b.style.width=ne,b.style.height=ne,s.appendChild(d);const J=window.getComputedStyle(s);J&&J.position==="static"&&(s.style.position="relative",s.dataset.previousPosition="static"),b.classList.add("v-ripple__animation--enter"),b.classList.add("v-ripple__animation--visible"),HA(b,`translate(${t}, ${G}) scale3d(${T},${T},${T})`),b.dataset.activated=String(performance.now()),setTimeout(()=>{b.classList.remove("v-ripple__animation--enter"),b.classList.add("v-ripple__animation--in"),HA(b,`translate(${W}, ${Y}) scale3d(1,1,1)`)},0)},hide(e){var E;if(!((E=e==null?void 0:e._ripple)!=null&&E.enabled))return;const s=e.getElementsByClassName("v-ripple__animation");if(s.length===0)return;const u=s[s.length-1];if(u.dataset.isHiding)return;u.dataset.isHiding="true";const d=performance.now()-Number(u.dataset.activated),b=Math.max(250-d,0);setTimeout(()=>{u.classList.remove("v-ripple__animation--in"),u.classList.add("v-ripple__animation--out"),setTimeout(()=>{var t;e.getElementsByClassName("v-ripple__animation").length===1&&e.dataset.previousPosition&&(e.style.position=e.dataset.previousPosition,delete e.dataset.previousPosition),((t=u.parentNode)==null?void 0:t.parentNode)===e&&e.removeChild(u.parentNode)},300)},b)}};function vL(e){return typeof e>"u"||!!e}function ib(e){const s={},u=e.currentTarget;if(!(!(u!=null&&u._ripple)||u._ripple.touched||e[_T])){if(e[_T]=!0,yT(e))u._ripple.touched=!0,u._ripple.isTouch=!0;else if(u._ripple.isTouch)return;if(s.center=u._ripple.centered||yL(e),u._ripple.class&&(s.class=u._ripple.class),yT(e)){if(u._ripple.showTimerCommit)return;u._ripple.showTimerCommit=()=>{M1.show(e,u,s)},u._ripple.showTimer=window.setTimeout(()=>{var d;(d=u==null?void 0:u._ripple)!=null&&d.showTimerCommit&&(u._ripple.showTimerCommit(),u._ripple.showTimerCommit=null)},ZU)}else M1.show(e,u,s)}}function ZA(e){e[_T]=!0}function Uh(e){const s=e.currentTarget;if(s!=null&&s._ripple){if(window.clearTimeout(s._ripple.showTimer),e.type==="touchend"&&s._ripple.showTimerCommit){s._ripple.showTimerCommit(),s._ripple.showTimerCommit=null,s._ripple.showTimer=window.setTimeout(()=>{Uh(e)});return}window.setTimeout(()=>{s._ripple&&(s._ripple.touched=!1)}),M1.hide(s)}}function xL(e){const s=e.currentTarget;s!=null&&s._ripple&&(s._ripple.showTimerCommit&&(s._ripple.showTimerCommit=null),window.clearTimeout(s._ripple.showTimer))}let rb=!1;function bL(e){!rb&&(e.keyCode===dA.enter||e.keyCode===dA.space)&&(rb=!0,ib(e))}function wL(e){rb=!1,Uh(e)}function SL(e){rb&&(rb=!1,Uh(e))}function TL(e,s,u){const{value:d,modifiers:b}=s,E=vL(d);if(E||M1.hide(e),e._ripple=e._ripple??{},e._ripple.enabled=E,e._ripple.centered=b.center,e._ripple.circle=b.circle,q1(d)&&d.class&&(e._ripple.class=d.class),E&&!u){if(b.stop){e.addEventListener("touchstart",ZA,{passive:!0}),e.addEventListener("mousedown",ZA);return}e.addEventListener("touchstart",ib,{passive:!0}),e.addEventListener("touchend",Uh,{passive:!0}),e.addEventListener("touchmove",xL,{passive:!0}),e.addEventListener("touchcancel",Uh),e.addEventListener("mousedown",ib),e.addEventListener("mouseup",Uh),e.addEventListener("mouseleave",Uh),e.addEventListener("keydown",bL),e.addEventListener("keyup",wL),e.addEventListener("blur",SL),e.addEventListener("dragstart",Uh,{passive:!0})}else!E&&u&&CL(e)}function CL(e){e.removeEventListener("mousedown",ib),e.removeEventListener("touchstart",ib),e.removeEventListener("touchend",Uh),e.removeEventListener("touchmove",xL),e.removeEventListener("touchcancel",Uh),e.removeEventListener("mouseup",Uh),e.removeEventListener("mouseleave",Uh),e.removeEventListener("keydown",bL),e.removeEventListener("keyup",wL),e.removeEventListener("dragstart",Uh),e.removeEventListener("blur",SL)}function XU(e,s){TL(e,s,!1)}function YU(e){delete e._ripple,CL(e)}function KU(e,s){if(s.value===s.oldValue)return;const u=vL(s.oldValue);TL(e,s,u)}const zm={mounted:XU,unmounted:YU,updated:KU},rw=vn({active:{type:Boolean,default:void 0},activeColor:String,baseColor:String,symbol:{type:null,default:zC},flat:Boolean,icon:[Boolean,String,Function,Object],prependIcon:_r,appendIcon:_r,block:Boolean,readonly:Boolean,slim:Boolean,stacked:Boolean,ripple:{type:[Boolean,Object],default:!0},text:String,...gh(),...tr(),...Hl(),...hl(),...El(),...ey(),...iw(),...Lm(),..._v(),...Qs(),...xb(),...Zp(),...ia({tag:"button"}),...Da(),...Ud({variant:"elevated"})},"VBtn"),Ya=Qn()({name:"VBtn",props:rw(),emits:{"group:selected":e=>!0},setup(e,s){let{attrs:u,slots:d}=s;const{themeClasses:b}=Ja(e),{borderClasses:E}=Wh(e),{densityClasses:T}=iu(e),{dimensionStyles:t}=dl(e),{elevationClasses:G}=hc(e),{loaderClasses:W}=_b(e),{locationStyles:Y}=ny(e),{positionClasses:ne}=yv(e),{roundedClasses:J}=Ao(e),{sizeClasses:Q,sizeStyles:ce}=gv(e),ie=ty(e,e.symbol,!1),pe=vb(e,u),be=Fe(()=>{var rt;return e.active!==void 0?e.active:pe.isLink.value?(rt=pe.isActive)==null?void 0:rt.value:ie==null?void 0:ie.isSelected.value}),Ie=Fe(()=>be.value?e.activeColor??e.color:e.color),$e=Fe(()=>{var ft,$t;return{color:(ie==null?void 0:ie.isSelected.value)&&(!pe.isLink.value||((ft=pe.isActive)==null?void 0:ft.value))||!ie||(($t=pe.isActive)==null?void 0:$t.value)?Ie.value??e.baseColor:e.baseColor,variant:e.variant}}),{colorClasses:Le,colorStyles:Oe,variantClasses:Ve}=J_($e),Ue=Fe(()=>(ie==null?void 0:ie.disabled.value)||e.disabled),qe=Fe(()=>e.variant==="elevated"&&!(e.disabled||e.flat||e.border)),He=Fe(()=>{if(!(e.value===void 0||typeof e.value=="symbol"))return Object(e.value)===e.value?JSON.stringify(e.value,null,0):e.value});function nt(rt){var ft;Ue.value||pe.isLink.value&&(rt.metaKey||rt.ctrlKey||rt.shiftKey||rt.button!==0||u.target==="_blank")||((ft=pe.navigate)==null||ft.call(pe,rt),ie==null||ie.toggle())}return HU(pe,ie==null?void 0:ie.select),fi(()=>{const rt=pe.isLink.value?"a":e.tag,ft=!!(e.prependIcon||d.prepend),$t=!!(e.appendIcon||d.append),hn=!!(e.icon&&e.icon!==!0);return Js(de(rt,oi({type:rt==="a"?void 0:"button",class:["v-btn",ie==null?void 0:ie.selectedClass.value,{"v-btn--active":be.value,"v-btn--block":e.block,"v-btn--disabled":Ue.value,"v-btn--elevated":qe.value,"v-btn--flat":e.flat,"v-btn--icon":!!e.icon,"v-btn--loading":e.loading,"v-btn--readonly":e.readonly,"v-btn--slim":e.slim,"v-btn--stacked":e.stacked},b.value,E.value,Le.value,T.value,G.value,W.value,ne.value,J.value,Q.value,Ve.value,e.class],style:[Oe.value,t.value,Y.value,ce.value,e.style],"aria-busy":e.loading?!0:void 0,disabled:Ue.value||void 0,tabindex:e.loading||e.readonly?-1:void 0,onClick:nt,value:He.value},pe.linkProps),{default:()=>{var gn;return[Fg(!0,"v-btn"),!e.icon&&ft&&de("span",{key:"prepend",class:"v-btn__prepend"},[d.prepend?de(da,{key:"prepend-defaults",disabled:!e.prependIcon,defaults:{VIcon:{icon:e.prependIcon}}},d.prepend):de(Ka,{key:"prepend-icon",icon:e.prependIcon},null)]),de("span",{class:"v-btn__content","data-no-activator":""},[!d.default&&hn?de(Ka,{key:"content-icon",icon:e.icon},null):de(da,{key:"content-defaults",disabled:!hn,defaults:{VIcon:{icon:e.icon}}},{default:()=>{var pn;return[((pn=d.default)==null?void 0:pn.call(d))??e.text]}})]),!e.icon&&$t&&de("span",{key:"append",class:"v-btn__append"},[d.append?de(da,{key:"append-defaults",disabled:!e.appendIcon,defaults:{VIcon:{icon:e.appendIcon}}},d.append):de(Ka,{key:"append-icon",icon:e.appendIcon},null)]),!!e.loading&&de("span",{key:"loader",class:"v-btn__loader"},[((gn=d.loader)==null?void 0:gn.call(d))??de(uv,{color:typeof e.loading=="boolean"?void 0:e.loading,indeterminate:!0,width:"2"},null)])]}}),[[zm,!Ue.value&&e.ripple,"",{center:!!e.icon}]])}),{group:ie}}}),JU=vn({...rw({icon:"$menu",variant:"text"})},"VAppBarNavIcon"),QU=Qn()({name:"VAppBarNavIcon",props:JU(),setup(e,s){let{slots:u}=s;return fi(()=>de(Ya,oi(e,{class:["v-app-bar-nav-icon"]}),u)),{}}}),e$=Qn()({name:"VAppBarTitle",props:lL(),setup(e,s){let{slots:u}=s;return fi(()=>de(AC,oi(e,{class:"v-app-bar-title"}),u)),{}}}),EL=Hp("v-alert-title"),t$=["success","info","warning","error"],n$=vn({border:{type:[Boolean,String],validator:e=>typeof e=="boolean"||["top","end","bottom","start"].includes(e)},borderColor:String,closable:Boolean,closeIcon:{type:_r,default:"$close"},closeLabel:{type:String,default:"$vuetify.close"},icon:{type:[Boolean,String,Function,Object],default:null},modelValue:{type:Boolean,default:!0},prominent:Boolean,title:String,text:String,type:{type:String,validator:e=>t$.includes(e)},...tr(),...Hl(),...hl(),...El(),...Lm(),..._v(),...Qs(),...ia(),...Da(),...Ud({variant:"flat"})},"VAlert"),i$=Qn()({name:"VAlert",props:n$(),emits:{"click:close":e=>!0,"update:modelValue":e=>!0},setup(e,s){let{emit:u,slots:d}=s;const b=mr(e,"modelValue"),E=Fe(()=>{if(e.icon!==!1)return e.type?e.icon??`$${e.type}`:e.icon}),T=Fe(()=>({color:e.color??e.type,variant:e.variant})),{themeClasses:t}=Ja(e),{colorClasses:G,colorStyles:W,variantClasses:Y}=J_(T),{densityClasses:ne}=iu(e),{dimensionStyles:J}=dl(e),{elevationClasses:Q}=hc(e),{locationStyles:ce}=ny(e),{positionClasses:ie}=yv(e),{roundedClasses:pe}=Ao(e),{textColorClasses:be,textColorStyles:Ie}=Dc($n(e,"borderColor")),{t:$e}=Uo(),Le=Fe(()=>({"aria-label":$e(e.closeLabel),onClick(Oe){b.value=!1,u("click:close",Oe)}}));return()=>{const Oe=!!(d.prepend||E.value),Ve=!!(d.title||e.title),Ue=!!(d.close||e.closable);return b.value&&de(e.tag,{class:["v-alert",e.border&&{"v-alert--border":!!e.border,[`v-alert--border-${e.border===!0?"start":e.border}`]:!0},{"v-alert--prominent":e.prominent},t.value,G.value,ne.value,Q.value,ie.value,pe.value,Y.value,e.class],style:[W.value,J.value,ce.value,e.style],role:"alert"},{default:()=>{var qe,He;return[Fg(!1,"v-alert"),e.border&&de("div",{key:"border",class:["v-alert__border",be.value],style:Ie.value},null),Oe&&de("div",{key:"prepend",class:"v-alert__prepend"},[d.prepend?de(da,{key:"prepend-defaults",disabled:!E.value,defaults:{VIcon:{density:e.density,icon:E.value,size:e.prominent?44:28}}},d.prepend):de(Ka,{key:"prepend-icon",density:e.density,icon:E.value,size:e.prominent?44:28},null)]),de("div",{class:"v-alert__content"},[Ve&&de(EL,{key:"title"},{default:()=>{var nt;return[((nt=d.title)==null?void 0:nt.call(d))??e.title]}}),((qe=d.text)==null?void 0:qe.call(d))??e.text,(He=d.default)==null?void 0:He.call(d)]),d.append&&de("div",{key:"append",class:"v-alert__append"},[d.append()]),Ue&&de("div",{key:"close",class:"v-alert__close"},[d.close?de(da,{key:"close-defaults",defaults:{VBtn:{icon:e.closeIcon,size:"x-small",variant:"text"}}},{default:()=>{var nt;return[(nt=d.close)==null?void 0:nt.call(d,{props:Le.value})]}}):de(Ya,oi({key:"close-btn",icon:e.closeIcon,size:"x-small",variant:"text"},Le.value),null)])]}})}}}),r$=vn({start:Boolean,end:Boolean,icon:_r,image:String,text:String,...gh(),...tr(),...Hl(),...Qs(),...Zp(),...ia(),...Da(),...Ud({variant:"flat"})},"VAvatar"),Vd=Qn()({name:"VAvatar",props:r$(),setup(e,s){let{slots:u}=s;const{themeClasses:d}=Ja(e),{borderClasses:b}=Wh(e),{colorClasses:E,colorStyles:T,variantClasses:t}=J_(e),{densityClasses:G}=iu(e),{roundedClasses:W}=Ao(e),{sizeClasses:Y,sizeStyles:ne}=gv(e);return fi(()=>de(e.tag,{class:["v-avatar",{"v-avatar--start":e.start,"v-avatar--end":e.end},d.value,b.value,E.value,G.value,W.value,Y.value,t.value,e.class],style:[T.value,ne.value,e.style]},{default:()=>[u.default?de(da,{key:"content-defaults",defaults:{VImg:{cover:!0,src:e.image},VIcon:{icon:e.icon}}},{default:()=>[u.default()]}):e.image?de(Pm,{key:"image",src:e.image,alt:"",cover:!0},null):e.icon?de(Ka,{key:"icon",icon:e.icon},null):e.text,Fg(!1,"v-avatar")]})),{}}}),a$=vn({text:String,onClick:lc(),...tr(),...Da()},"VLabel"),vv=Qn()({name:"VLabel",props:a$(),setup(e,s){let{slots:u}=s;return fi(()=>{var d;return de("label",{class:["v-label",{"v-label--clickable":!!e.onClick},e.class],style:e.style,onClick:e.onClick},[e.text,(d=u.default)==null?void 0:d.call(u)])}),{}}}),ML=Symbol.for("vuetify:selection-control-group"),OC=vn({color:String,disabled:{type:Boolean,default:null},defaultsTarget:String,error:Boolean,id:String,inline:Boolean,falseIcon:_r,trueIcon:_r,ripple:{type:[Boolean,Object],default:!0},multiple:{type:Boolean,default:null},name:String,readonly:{type:Boolean,default:null},modelValue:null,type:String,valueComparator:{type:Function,default:Gp},...tr(),...Hl(),...Da()},"SelectionControlGroup"),s$=vn({...OC({defaultsTarget:"VSelectionControl"})},"VSelectionControlGroup"),IL=Qn()({name:"VSelectionControlGroup",props:s$(),emits:{"update:modelValue":e=>!0},setup(e,s){let{slots:u}=s;const d=mr(e,"modelValue"),b=uc(),E=Fe(()=>e.id||`v-selection-control-group-${b}`),T=Fe(()=>e.name||E.value),t=new Set;return xa(ML,{modelValue:d,forceUpdate:()=>{t.forEach(G=>G())},onForceUpdate:G=>{t.add(G),nu(()=>{t.delete(G)})}}),Io({[e.defaultsTarget]:{color:$n(e,"color"),disabled:$n(e,"disabled"),density:$n(e,"density"),error:$n(e,"error"),inline:$n(e,"inline"),modelValue:d,multiple:Fe(()=>!!e.multiple||e.multiple==null&&Array.isArray(d.value)),name:T,falseIcon:$n(e,"falseIcon"),trueIcon:$n(e,"trueIcon"),readonly:$n(e,"readonly"),ripple:$n(e,"ripple"),type:$n(e,"type"),valueComparator:$n(e,"valueComparator")}}),fi(()=>{var G;return de("div",{class:["v-selection-control-group",{"v-selection-control-group--inline":e.inline},e.class],style:e.style,role:e.type==="radio"?"radiogroup":void 0},[(G=u.default)==null?void 0:G.call(u)])}),{}}}),aw=vn({label:String,baseColor:String,trueValue:null,falseValue:null,value:null,...tr(),...OC()},"VSelectionControl");function o$(e){const s=vr(ML,void 0),{densityClasses:u}=iu(e),d=mr(e,"modelValue"),b=Fe(()=>e.trueValue!==void 0?e.trueValue:e.value!==void 0?e.value:!0),E=Fe(()=>e.falseValue!==void 0?e.falseValue:!1),T=Fe(()=>!!e.multiple||e.multiple==null&&Array.isArray(d.value)),t=Fe({get(){const Q=s?s.modelValue.value:d.value;return T.value?po(Q).some(ce=>e.valueComparator(ce,b.value)):e.valueComparator(Q,b.value)},set(Q){if(e.readonly)return;const ce=Q?b.value:E.value;let ie=ce;T.value&&(ie=Q?[...po(d.value),ce]:po(d.value).filter(pe=>!e.valueComparator(pe,b.value))),s?s.modelValue.value=ie:d.value=ie}}),{textColorClasses:G,textColorStyles:W}=Dc(Fe(()=>{if(!(e.error||e.disabled))return t.value?e.color:e.baseColor})),{backgroundColorClasses:Y,backgroundColorStyles:ne}=Ms(Fe(()=>t.value&&!e.error&&!e.disabled?e.color:e.baseColor)),J=Fe(()=>t.value?e.trueIcon:e.falseIcon);return{group:s,densityClasses:u,trueValue:b,falseValue:E,model:t,textColorClasses:G,textColorStyles:W,backgroundColorClasses:Y,backgroundColorStyles:ne,icon:J}}const Dg=Qn()({name:"VSelectionControl",directives:{Ripple:zm},inheritAttrs:!1,props:aw(),emits:{"update:modelValue":e=>!0},setup(e,s){let{attrs:u,slots:d}=s;const{group:b,densityClasses:E,icon:T,model:t,textColorClasses:G,textColorStyles:W,backgroundColorClasses:Y,backgroundColorStyles:ne,trueValue:J}=o$(e),Q=uc(),ce=Bi(!1),ie=Bi(!1),pe=yi(),be=Fe(()=>e.id||`input-${Q}`),Ie=Fe(()=>!e.disabled&&!e.readonly);b==null||b.onForceUpdate(()=>{pe.value&&(pe.value.checked=t.value)});function $e(Ue){Ie.value&&(ce.value=!0,sv(Ue.target,":focus-visible")!==!1&&(ie.value=!0))}function Le(){ce.value=!1,ie.value=!1}function Oe(Ue){Ue.stopPropagation()}function Ve(Ue){if(!Ie.value){pe.value&&(pe.value.checked=t.value);return}e.readonly&&b&&Na(()=>b.forceUpdate()),t.value=Ue.target.checked}return fi(()=>{var rt,ft;const Ue=d.label?d.label({label:e.label,props:{for:be.value}}):e.label,[qe,He]=Og(u),nt=de("input",oi({ref:pe,checked:t.value,disabled:!!e.disabled,id:be.value,onBlur:Le,onFocus:$e,onInput:Ve,"aria-disabled":!!e.disabled,"aria-label":e.label,type:e.type,value:J.value,name:e.name,"aria-checked":e.type==="checkbox"?t.value:void 0},He),null);return de("div",oi({class:["v-selection-control",{"v-selection-control--dirty":t.value,"v-selection-control--disabled":e.disabled,"v-selection-control--error":e.error,"v-selection-control--focused":ce.value,"v-selection-control--focus-visible":ie.value,"v-selection-control--inline":e.inline},E.value,e.class]},qe,{style:e.style}),[de("div",{class:["v-selection-control__wrapper",G.value],style:W.value},[(rt=d.default)==null?void 0:rt.call(d,{backgroundColorClasses:Y,backgroundColorStyles:ne}),Js(de("div",{class:["v-selection-control__input"]},[((ft=d.input)==null?void 0:ft.call(d,{model:t,textColorClasses:G,textColorStyles:W,backgroundColorClasses:Y,backgroundColorStyles:ne,inputNode:nt,icon:T.value,props:{onFocus:$e,onBlur:Le,id:be.value}}))??de(sr,null,[T.value&&de(Ka,{key:"icon",icon:T.value},null),nt])]),[[qh("ripple"),e.ripple&&[!e.disabled&&!e.readonly,null,["center","circle"]]]])]),Ue&&de(vv,{for:be.value,onClick:Oe},{default:()=>[Ue]})])}),{isFocused:ce,input:pe}}}),PL=vn({indeterminate:Boolean,indeterminateIcon:{type:_r,default:"$checkboxIndeterminate"},...aw({falseIcon:"$checkboxOff",trueIcon:"$checkboxOn"})},"VCheckboxBtn"),Am=Qn()({name:"VCheckboxBtn",props:PL(),emits:{"update:modelValue":e=>!0,"update:indeterminate":e=>!0},setup(e,s){let{slots:u}=s;const d=mr(e,"indeterminate"),b=mr(e,"modelValue");function E(G){d.value&&(d.value=!1)}const T=Fe(()=>d.value?e.indeterminateIcon:e.falseIcon),t=Fe(()=>d.value?e.indeterminateIcon:e.trueIcon);return fi(()=>{const G=ul(Dg.filterProps(e),["modelValue"]);return de(Dg,oi(G,{modelValue:b.value,"onUpdate:modelValue":[W=>b.value=W,E],class:["v-checkbox-btn",e.class],style:e.style,type:"checkbox",falseIcon:T.value,trueIcon:t.value,"aria-checked":d.value?"mixed":void 0}),u)}),{}}});function AL(e){const{t:s}=Uo();function u(d){let{name:b}=d;const E={prepend:"prependAction",prependInner:"prependAction",append:"appendAction",appendInner:"appendAction",clear:"clear"}[b],T=e[`onClick:${b}`];function t(W){W.key!=="Enter"&&W.key!==" "||(W.preventDefault(),W.stopPropagation(),W1(T,new PointerEvent("click",W)))}const G=T&&E?s(`$vuetify.input.${E}`,e.label??""):void 0;return de(Ka,{icon:e[`${b}Icon`],"aria-label":G,onClick:T,onKeydown:t},null)}return{InputIcon:u}}const l$=vn({active:Boolean,color:String,messages:{type:[Array,String],default:()=>[]},...tr(),...$f({transition:{component:DC,leaveAbsolute:!0,group:!0}})},"VMessages"),kL=Qn()({name:"VMessages",props:l$(),setup(e,s){let{slots:u}=s;const d=Fe(()=>po(e.messages)),{textColorClasses:b,textColorStyles:E}=Dc(Fe(()=>e.color));return fi(()=>de(eu,{transition:e.transition,tag:"div",class:["v-messages",b.value,e.class],style:[E.value,e.style]},{default:()=>[e.active&&d.value.map((T,t)=>de("div",{class:"v-messages__message",key:`${t}-${d.value}`},[u.message?u.message({message:T}):T]))]})),{}}}),bb=vn({focused:Boolean,"onUpdate:focused":lc()},"focus");function Om(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:qp();const u=mr(e,"focused"),d=Fe(()=>({[`${s}--focused`]:u.value}));function b(){u.value=!0}function E(){u.value=!1}return{focusClasses:d,isFocused:u,focus:b,blur:E}}const DL=Symbol.for("vuetify:form"),c$=vn({disabled:Boolean,fastFail:Boolean,readonly:Boolean,modelValue:{type:Boolean,default:null},validateOn:{type:String,default:"input"}},"form");function u$(e){const s=mr(e,"modelValue"),u=Fe(()=>e.disabled),d=Fe(()=>e.readonly),b=Bi(!1),E=yi([]),T=yi([]);async function t(){const Y=[];let ne=!0;T.value=[],b.value=!0;for(const J of E.value){const Q=await J.validate();if(Q.length>0&&(ne=!1,Y.push({id:J.id,errorMessages:Q})),!ne&&e.fastFail)break}return T.value=Y,b.value=!1,{valid:ne,errors:T.value}}function G(){E.value.forEach(Y=>Y.reset())}function W(){E.value.forEach(Y=>Y.resetValidation())}return Pi(E,()=>{let Y=0,ne=0;const J=[];for(const Q of E.value)Q.isValid===!1?(ne++,J.push({id:Q.id,errorMessages:Q.errorMessages})):Q.isValid===!0&&Y++;T.value=J,s.value=ne>0?!1:Y===E.value.length?!0:null},{deep:!0,flush:"post"}),xa(DL,{register:Y=>{let{id:ne,vm:J,validate:Q,reset:ce,resetValidation:ie}=Y;E.value.some(pe=>pe.id===ne),E.value.push({id:ne,validate:Q,reset:ce,resetValidation:ie,vm:eD(J),isValid:null,errorMessages:[]})},unregister:Y=>{E.value=E.value.filter(ne=>ne.id!==Y)},update:(Y,ne,J)=>{const Q=E.value.find(ce=>ce.id===Y);Q&&(Q.isValid=ne,Q.errorMessages=J)},isDisabled:u,isReadonly:d,isValidating:b,isValid:s,items:E,validateOn:$n(e,"validateOn")}),{errors:T,isDisabled:u,isReadonly:d,isValidating:b,isValid:s,items:E,validate:t,reset:G,resetValidation:W}}function sw(e){const s=vr(DL,null);return{...s,isReadonly:Fe(()=>!!((e==null?void 0:e.readonly)??(s==null?void 0:s.isReadonly.value))),isDisabled:Fe(()=>!!((e==null?void 0:e.disabled)??(s==null?void 0:s.isDisabled.value)))}}const RL=vn({disabled:{type:Boolean,default:null},error:Boolean,errorMessages:{type:[Array,String],default:()=>[]},maxErrors:{type:[Number,String],default:1},name:String,label:String,readonly:{type:Boolean,default:null},rules:{type:Array,default:()=>[]},modelValue:null,validateOn:String,validationValue:null,...bb()},"validation");function LL(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:qp(),u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:uc();const d=mr(e,"modelValue"),b=Fe(()=>e.validationValue===void 0?d.value:e.validationValue),E=sw(e),T=yi([]),t=Bi(!0),G=Fe(()=>!!(po(d.value===""?null:d.value).length||po(b.value===""?null:b.value).length)),W=Fe(()=>{var $e;return($e=e.errorMessages)!=null&&$e.length?po(e.errorMessages).concat(T.value).slice(0,Math.max(0,+e.maxErrors)):T.value}),Y=Fe(()=>{var Oe;let $e=(e.validateOn??((Oe=E.validateOn)==null?void 0:Oe.value))||"input";$e==="lazy"&&($e="input lazy"),$e==="eager"&&($e="input eager");const Le=new Set(($e==null?void 0:$e.split(" "))??[]);return{input:Le.has("input"),blur:Le.has("blur")||Le.has("input")||Le.has("invalid-input"),invalidInput:Le.has("invalid-input"),lazy:Le.has("lazy"),eager:Le.has("eager")}}),ne=Fe(()=>{var $e;return e.error||($e=e.errorMessages)!=null&&$e.length?!1:e.rules.length?t.value?T.value.length||Y.value.lazy?null:!0:!T.value.length:!0}),J=Bi(!1),Q=Fe(()=>({[`${s}--error`]:ne.value===!1,[`${s}--dirty`]:G.value,[`${s}--disabled`]:E.isDisabled.value,[`${s}--readonly`]:E.isReadonly.value})),ce=Po("validation"),ie=Fe(()=>e.name??Ps(u));pv(()=>{var $e;($e=E.register)==null||$e.call(E,{id:ie.value,vm:ce,validate:Ie,reset:pe,resetValidation:be})}),ql(()=>{var $e;($e=E.unregister)==null||$e.call(E,ie.value)}),Ua(async()=>{var $e;Y.value.lazy||await Ie(!Y.value.eager),($e=E.update)==null||$e.call(E,ie.value,ne.value,W.value)}),Du(()=>Y.value.input||Y.value.invalidInput&&ne.value===!1,()=>{Pi(b,()=>{if(b.value!=null)Ie();else if(e.focused){const $e=Pi(()=>e.focused,Le=>{Le||Ie(),$e()})}})}),Du(()=>Y.value.blur,()=>{Pi(()=>e.focused,$e=>{$e||Ie()})}),Pi([ne,W],()=>{var $e;($e=E.update)==null||$e.call(E,ie.value,ne.value,W.value)});async function pe(){d.value=null,await Na(),await be()}async function be(){t.value=!0,Y.value.lazy?T.value=[]:await Ie(!Y.value.eager)}async function Ie(){let $e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;const Le=[];J.value=!0;for(const Oe of e.rules){if(Le.length>=+(e.maxErrors??1))break;const Ue=await(typeof Oe=="function"?Oe:()=>Oe)(b.value);if(Ue!==!0){if(Ue!==!1&&typeof Ue!="string"){console.warn(`${Ue} is not a valid value. Rule functions must return boolean true or a string.`);continue}Le.push(Ue||"")}}return T.value=Le,J.value=!1,t.value=$e,T.value}return{errorMessages:W,isDirty:G,isDisabled:E.isDisabled,isReadonly:E.isReadonly,isPristine:t,isValid:ne,isValidating:J,reset:pe,resetValidation:be,validate:Ie,validationClasses:Q}}const Fm=vn({id:String,appendIcon:_r,centerAffix:{type:Boolean,default:!0},prependIcon:_r,hideDetails:[Boolean,String],hideSpinButtons:Boolean,hint:String,persistentHint:Boolean,messages:{type:[Array,String],default:()=>[]},direction:{type:String,default:"horizontal",validator:e=>["horizontal","vertical"].includes(e)},"onClick:prepend":lc(),"onClick:append":lc(),...tr(),...Hl(),...H1(hl(),["maxWidth","minWidth","width"]),...Da(),...RL()},"VInput"),Rc=Qn()({name:"VInput",props:{...Fm()},emits:{"update:modelValue":e=>!0},setup(e,s){let{attrs:u,slots:d,emit:b}=s;const{densityClasses:E}=iu(e),{dimensionStyles:T}=dl(e),{themeClasses:t}=Ja(e),{rtlClasses:G}=Cl(),{InputIcon:W}=AL(e),Y=uc(),ne=Fe(()=>e.id||`input-${Y}`),J=Fe(()=>`${ne.value}-messages`),{errorMessages:Q,isDirty:ce,isDisabled:ie,isReadonly:pe,isPristine:be,isValid:Ie,isValidating:$e,reset:Le,resetValidation:Oe,validate:Ve,validationClasses:Ue}=LL(e,"v-input",ne),qe=Fe(()=>({id:ne,messagesId:J,isDirty:ce,isDisabled:ie,isReadonly:pe,isPristine:be,isValid:Ie,isValidating:$e,reset:Le,resetValidation:Oe,validate:Ve})),He=Fe(()=>{var nt;return(nt=e.errorMessages)!=null&&nt.length||!be.value&&Q.value.length?Q.value:e.hint&&(e.persistentHint||e.focused)?e.hint:e.messages});return fi(()=>{var hn,gn,pn,ri;const nt=!!(d.prepend||e.prependIcon),rt=!!(d.append||e.appendIcon),ft=He.value.length>0,$t=!e.hideDetails||e.hideDetails==="auto"&&(ft||!!d.details);return de("div",{class:["v-input",`v-input--${e.direction}`,{"v-input--center-affix":e.centerAffix,"v-input--hide-spin-buttons":e.hideSpinButtons},E.value,t.value,G.value,Ue.value,e.class],style:[T.value,e.style]},[nt&&de("div",{key:"prepend",class:"v-input__prepend"},[(hn=d.prepend)==null?void 0:hn.call(d,qe.value),e.prependIcon&&de(W,{key:"prepend-icon",name:"prepend"},null)]),d.default&&de("div",{class:"v-input__control"},[(gn=d.default)==null?void 0:gn.call(d,qe.value)]),rt&&de("div",{key:"append",class:"v-input__append"},[e.appendIcon&&de(W,{key:"append-icon",name:"append"},null),(pn=d.append)==null?void 0:pn.call(d,qe.value)]),$t&&de("div",{id:J.value,class:"v-input__details",role:"alert","aria-live":"polite"},[de(kL,{active:ft,messages:He.value},{message:d.message}),(ri=d.details)==null?void 0:ri.call(d,qe.value)])])}),{reset:Le,resetValidation:Oe,validate:Ve,isValid:Ie,errorMessages:Q}}}),h$=vn({...Fm(),...ul(PL(),["inline"])},"VCheckbox"),d$=Qn()({name:"VCheckbox",inheritAttrs:!1,props:h$(),emits:{"update:modelValue":e=>!0,"update:focused":e=>!0},setup(e,s){let{attrs:u,slots:d}=s;const b=mr(e,"modelValue"),{isFocused:E,focus:T,blur:t}=Om(e),G=uc(),W=Fe(()=>e.id||`checkbox-${G}`);return fi(()=>{const[Y,ne]=Og(u),J=Rc.filterProps(e),Q=Am.filterProps(e);return de(Rc,oi({class:["v-checkbox",e.class]},Y,J,{modelValue:b.value,"onUpdate:modelValue":ce=>b.value=ce,id:W.value,focused:E.value,style:e.style}),{...d,default:ce=>{let{id:ie,messagesId:pe,isDisabled:be,isReadonly:Ie,isValid:$e}=ce;return de(Am,oi(Q,{id:ie.value,"aria-describedby":pe.value,disabled:be.value,readonly:Ie.value},ne,{error:$e.value===!1,modelValue:b.value,"onUpdate:modelValue":Le=>b.value=Le,onFocus:T,onBlur:t}),d)}})}),{}}});function f$(e){let{selectedElement:s,containerElement:u,isRtl:d,isHorizontal:b}=e;const E=ab(b,u),T=zL(b,d,u),t=ab(b,s),G=OL(b,s),W=t*.4;return T>G?G-W:T+E<G+t?G-E+t+W:T}function p$(e){let{selectedElement:s,containerElement:u,isHorizontal:d}=e;const b=ab(d,u),E=OL(d,s),T=ab(d,s);return E-b/2+T/2}function WA(e,s){const u=e?"scrollWidth":"scrollHeight";return(s==null?void 0:s[u])||0}function m$(e,s){const u=e?"clientWidth":"clientHeight";return(s==null?void 0:s[u])||0}function zL(e,s,u){if(!u)return 0;const{scrollLeft:d,offsetWidth:b,scrollWidth:E}=u;return e?s?E-b+d:d:u.scrollTop}function ab(e,s){const u=e?"offsetWidth":"offsetHeight";return(s==null?void 0:s[u])||0}function OL(e,s){const u=e?"offsetLeft":"offsetTop";return(s==null?void 0:s[u])||0}const FL=Symbol.for("vuetify:v-slide-group"),FC=vn({centerActive:Boolean,direction:{type:String,default:"horizontal"},symbol:{type:null,default:FL},nextIcon:{type:_r,default:"$next"},prevIcon:{type:_r,default:"$prev"},showArrows:{type:[Boolean,String],validator:e=>typeof e=="boolean"||["always","desktop","mobile"].includes(e)},...tr(),...W_({mobile:null}),...ia(),...Q_({selectedClass:"v-slide-group-item--active"})},"VSlideGroup"),sb=Qn()({name:"VSlideGroup",props:FC(),emits:{"update:modelValue":e=>!0},setup(e,s){let{slots:u}=s;const{isRtl:d}=Cl(),{displayClasses:b,mobile:E}=jd(e),T=Bg(e,e.symbol),t=Bi(!1),G=Bi(0),W=Bi(0),Y=Bi(0),ne=Fe(()=>e.direction==="horizontal"),{resizeRef:J,contentRect:Q}=Ff(),{resizeRef:ce,contentRect:ie}=Ff(),pe=Qj(),be=Fe(()=>({container:J.el,duration:200,easing:"easeOutQuart"})),Ie=Fe(()=>T.selected.value.length?T.items.value.findIndex(mn=>mn.id===T.selected.value[0]):-1),$e=Fe(()=>T.selected.value.length?T.items.value.findIndex(mn=>mn.id===T.selected.value[T.selected.value.length-1]):-1);if(qa){let mn=-1;Pi(()=>[T.selected.value,Q.value,ie.value,ne.value],()=>{cancelAnimationFrame(mn),mn=requestAnimationFrame(()=>{if(Q.value&&ie.value){const Nn=ne.value?"width":"height";W.value=Q.value[Nn],Y.value=ie.value[Nn],t.value=W.value+1<Y.value}if(Ie.value>=0&&ce.el){const Nn=ce.el.children[$e.value];Oe(Nn,e.centerActive)}})})}const Le=Bi(!1);function Oe(mn,Nn){let Pn=0;Nn?Pn=p$({containerElement:J.el,isHorizontal:ne.value,selectedElement:mn}):Pn=f$({containerElement:J.el,isHorizontal:ne.value,isRtl:d.value,selectedElement:mn}),Ve(Pn)}function Ve(mn){if(!qa||!J.el)return;const Nn=ab(ne.value,J.el),Pn=zL(ne.value,d.value,J.el);if(!(WA(ne.value,J.el)<=Nn||Math.abs(mn-Pn)<16)){if(ne.value&&d.value&&J.el){const{scrollWidth:Fi,offsetWidth:Ln}=J.el;mn=Fi-Ln-mn}ne.value?pe.horizontal(mn,be.value):pe(mn,be.value)}}function Ue(mn){const{scrollTop:Nn,scrollLeft:Pn}=mn.target;G.value=ne.value?Pn:Nn}function qe(mn){if(Le.value=!0,!(!t.value||!ce.el)){for(const Nn of mn.composedPath())for(const Pn of ce.el.children)if(Pn===Nn){Oe(Pn);return}}}function He(mn){Le.value=!1}let nt=!1;function rt(mn){var Nn;!nt&&!Le.value&&!(mn.relatedTarget&&((Nn=ce.el)!=null&&Nn.contains(mn.relatedTarget)))&&gn(),nt=!1}function ft(){nt=!0}function $t(mn){if(!ce.el)return;function Nn(Pn){mn.preventDefault(),gn(Pn)}ne.value?mn.key==="ArrowRight"?Nn(d.value?"prev":"next"):mn.key==="ArrowLeft"&&Nn(d.value?"next":"prev"):mn.key==="ArrowDown"?Nn("next"):mn.key==="ArrowUp"&&Nn("prev"),mn.key==="Home"?Nn("first"):mn.key==="End"&&Nn("last")}function hn(mn,Nn){if(!mn)return;let Pn=mn;do Pn=Pn==null?void 0:Pn[Nn==="next"?"nextElementSibling":"previousElementSibling"];while(Pn!=null&&Pn.hasAttribute("disabled"));return Pn}function gn(mn){if(!ce.el)return;let Nn;if(!mn)Nn=Jx(ce.el)[0];else if(mn==="next"){if(Nn=hn(ce.el.querySelector(":focus"),mn),!Nn)return gn("first")}else if(mn==="prev"){if(Nn=hn(ce.el.querySelector(":focus"),mn),!Nn)return gn("last")}else mn==="first"?(Nn=ce.el.firstElementChild,Nn!=null&&Nn.hasAttribute("disabled")&&(Nn=hn(Nn,"next"))):mn==="last"&&(Nn=ce.el.lastElementChild,Nn!=null&&Nn.hasAttribute("disabled")&&(Nn=hn(Nn,"prev")));Nn&&Nn.focus({preventScroll:!0})}function pn(mn){const Nn=ne.value&&d.value?-1:1,Pn=(mn==="prev"?-Nn:Nn)*W.value;let Ci=G.value+Pn;if(ne.value&&d.value&&J.el){const{scrollWidth:Fi,offsetWidth:Ln}=J.el;Ci+=Fi-Ln}Ve(Ci)}const ri=Fe(()=>({next:T.next,prev:T.prev,select:T.select,isSelected:T.isSelected})),ai=Fe(()=>{switch(e.showArrows){case"always":return!0;case"desktop":return!E.value;case!0:return t.value||Math.abs(G.value)>0;case"mobile":return E.value||t.value||Math.abs(G.value)>0;default:return!E.value&&(t.value||Math.abs(G.value)>0)}}),_n=Fe(()=>Math.abs(G.value)>1),Bn=Fe(()=>{if(!J.value)return!1;const mn=WA(ne.value,J.el),Nn=m$(ne.value,J.el);return mn-Nn-Math.abs(G.value)>1});return fi(()=>de(e.tag,{class:["v-slide-group",{"v-slide-group--vertical":!ne.value,"v-slide-group--has-affixes":ai.value,"v-slide-group--is-overflowing":t.value},b.value,e.class],style:e.style,tabindex:Le.value||T.selected.value.length?-1:0,onFocus:rt},{default:()=>{var mn,Nn,Pn;return[ai.value&&de("div",{key:"prev",class:["v-slide-group__prev",{"v-slide-group__prev--disabled":!_n.value}],onMousedown:ft,onClick:()=>_n.value&&pn("prev")},[((mn=u.prev)==null?void 0:mn.call(u,ri.value))??de(nb,null,{default:()=>[de(Ka,{icon:d.value?e.nextIcon:e.prevIcon},null)]})]),de("div",{key:"container",ref:J,class:"v-slide-group__container",onScroll:Ue},[de("div",{ref:ce,class:"v-slide-group__content",onFocusin:qe,onFocusout:He,onKeydown:$t},[(Nn=u.default)==null?void 0:Nn.call(u,ri.value)])]),ai.value&&de("div",{key:"next",class:["v-slide-group__next",{"v-slide-group__next--disabled":!Bn.value}],onMousedown:ft,onClick:()=>Bn.value&&pn("next")},[((Pn=u.next)==null?void 0:Pn.call(u,ri.value))??de(nb,null,{default:()=>[de(Ka,{icon:d.value?e.prevIcon:e.nextIcon},null)]})])]}})),{selected:T.selected,scrollTo:pn,scrollOffset:G,focus:gn,hasPrev:_n,hasNext:Bn}}}),BL=Symbol.for("vuetify:v-chip-group"),g$=vn({column:Boolean,filter:Boolean,valueComparator:{type:Function,default:Gp},...FC(),...tr(),...Q_({selectedClass:"v-chip--selected"}),...ia(),...Da(),...Ud({variant:"tonal"})},"VChipGroup"),_$=Qn()({name:"VChipGroup",props:g$(),emits:{"update:modelValue":e=>!0},setup(e,s){let{slots:u}=s;const{themeClasses:d}=Ja(e),{isSelected:b,select:E,next:T,prev:t,selected:G}=Bg(e,BL);return Io({VChip:{color:$n(e,"color"),disabled:$n(e,"disabled"),filter:$n(e,"filter"),variant:$n(e,"variant")}}),fi(()=>{const W=sb.filterProps(e);return de(sb,oi(W,{class:["v-chip-group",{"v-chip-group--column":e.column},d.value,e.class],style:e.style}),{default:()=>{var Y;return[(Y=u.default)==null?void 0:Y.call(u,{isSelected:b,select:E,next:T,prev:t,selected:G.value})]}})}),{}}}),y$=vn({activeClass:String,appendAvatar:String,appendIcon:_r,closable:Boolean,closeIcon:{type:_r,default:"$delete"},closeLabel:{type:String,default:"$vuetify.close"},draggable:Boolean,filter:Boolean,filterIcon:{type:_r,default:"$complete"},label:Boolean,link:{type:Boolean,default:void 0},pill:Boolean,prependAvatar:String,prependIcon:_r,ripple:{type:[Boolean,Object],default:!0},text:String,modelValue:{type:Boolean,default:!0},onClick:lc(),onClickOnce:lc(),...gh(),...tr(),...Hl(),...El(),...ey(),...Qs(),...xb(),...Zp(),...ia({tag:"span"}),...Da(),...Ud({variant:"tonal"})},"VChip"),xv=Qn()({name:"VChip",directives:{Ripple:zm},props:y$(),emits:{"click:close":e=>!0,"update:modelValue":e=>!0,"group:selected":e=>!0,click:e=>!0},setup(e,s){let{attrs:u,emit:d,slots:b}=s;const{t:E}=Uo(),{borderClasses:T}=Wh(e),{colorClasses:t,colorStyles:G,variantClasses:W}=J_(e),{densityClasses:Y}=iu(e),{elevationClasses:ne}=hc(e),{roundedClasses:J}=Ao(e),{sizeClasses:Q}=gv(e),{themeClasses:ce}=Ja(e),ie=mr(e,"modelValue"),pe=ty(e,BL,!1),be=vb(e,u),Ie=Fe(()=>e.link!==!1&&be.isLink.value),$e=Fe(()=>!e.disabled&&e.link!==!1&&(!!pe||e.link||be.isClickable.value)),Le=Fe(()=>({"aria-label":E(e.closeLabel),onClick(Ue){Ue.preventDefault(),Ue.stopPropagation(),ie.value=!1,d("click:close",Ue)}}));function Oe(Ue){var qe;d("click",Ue),$e.value&&((qe=be.navigate)==null||qe.call(be,Ue),pe==null||pe.toggle())}function Ve(Ue){(Ue.key==="Enter"||Ue.key===" ")&&(Ue.preventDefault(),Oe(Ue))}return()=>{var gn;const Ue=be.isLink.value?"a":e.tag,qe=!!(e.appendIcon||e.appendAvatar),He=!!(qe||b.append),nt=!!(b.close||e.closable),rt=!!(b.filter||e.filter)&&pe,ft=!!(e.prependIcon||e.prependAvatar),$t=!!(ft||b.prepend),hn=!pe||pe.isSelected.value;return ie.value&&Js(de(Ue,oi({class:["v-chip",{"v-chip--disabled":e.disabled,"v-chip--label":e.label,"v-chip--link":$e.value,"v-chip--filter":rt,"v-chip--pill":e.pill,[`${e.activeClass}`]:e.activeClass&&((gn=be.isActive)==null?void 0:gn.value)},ce.value,T.value,hn?t.value:void 0,Y.value,ne.value,J.value,Q.value,W.value,pe==null?void 0:pe.selectedClass.value,e.class],style:[hn?G.value:void 0,e.style],disabled:e.disabled||void 0,draggable:e.draggable,tabindex:$e.value?0:void 0,onClick:Oe,onKeydown:$e.value&&!Ie.value&&Ve},be.linkProps),{default:()=>{var pn;return[Fg($e.value,"v-chip"),rt&&de(RC,{key:"filter"},{default:()=>[Js(de("div",{class:"v-chip__filter"},[b.filter?de(da,{key:"filter-defaults",disabled:!e.filterIcon,defaults:{VIcon:{icon:e.filterIcon}}},b.filter):de(Ka,{key:"filter-icon",icon:e.filterIcon},null)]),[[Nd,pe.isSelected.value]])]}),$t&&de("div",{key:"prepend",class:"v-chip__prepend"},[b.prepend?de(da,{key:"prepend-defaults",disabled:!ft,defaults:{VAvatar:{image:e.prependAvatar,start:!0},VIcon:{icon:e.prependIcon,start:!0}}},b.prepend):de(sr,null,[e.prependIcon&&de(Ka,{key:"prepend-icon",icon:e.prependIcon,start:!0},null),e.prependAvatar&&de(Vd,{key:"prepend-avatar",image:e.prependAvatar,start:!0},null)])]),de("div",{class:"v-chip__content","data-no-activator":""},[((pn=b.default)==null?void 0:pn.call(b,{isSelected:pe==null?void 0:pe.isSelected.value,selectedClass:pe==null?void 0:pe.selectedClass.value,select:pe==null?void 0:pe.select,toggle:pe==null?void 0:pe.toggle,value:pe==null?void 0:pe.value.value,disabled:e.disabled}))??e.text]),He&&de("div",{key:"append",class:"v-chip__append"},[b.append?de(da,{key:"append-defaults",disabled:!qe,defaults:{VAvatar:{end:!0,image:e.appendAvatar},VIcon:{end:!0,icon:e.appendIcon}}},b.append):de(sr,null,[e.appendIcon&&de(Ka,{key:"append-icon",end:!0,icon:e.appendIcon},null),e.appendAvatar&&de(Vd,{key:"append-avatar",end:!0,image:e.appendAvatar},null)])]),nt&&de("button",oi({key:"close",class:"v-chip__close",type:"button","data-testid":"close-chip"},Le.value),[b.close?de(da,{key:"close-defaults",defaults:{VIcon:{icon:e.closeIcon,size:"x-small"}}},b.close):de(Ka,{key:"close-icon",icon:e.closeIcon,size:"x-small"},null)])]}}),[[qh("ripple"),$e.value&&e.ripple,null]])}}}),vT=Symbol.for("vuetify:list");function VL(){const e=vr(vT,{hasPrepend:Bi(!1),updateHasPrepend:()=>null}),s={hasPrepend:Bi(!1),updateHasPrepend:u=>{u&&(s.hasPrepend.value=u)}};return xa(vT,s),e}function NL(){return vr(vT,null)}const BC=e=>{const s={activate:u=>{let{id:d,value:b,activated:E}=u;return d=Gr(d),e&&!b&&E.size===1&&E.has(d)||(b?E.add(d):E.delete(d)),E},in:(u,d,b)=>{let E=new Set;if(u!=null)for(const T of po(u))E=s.activate({id:T,value:!0,activated:new Set(E),children:d,parents:b});return E},out:u=>Array.from(u)};return s},jL=e=>{const s=BC(e);return{activate:d=>{let{activated:b,id:E,...T}=d;E=Gr(E);const t=b.has(E)?new Set([E]):new Set;return s.activate({...T,id:E,activated:t})},in:(d,b,E)=>{let T=new Set;if(d!=null){const t=po(d);t.length&&(T=s.in(t.slice(0,1),b,E))}return T},out:(d,b,E)=>s.out(d,b,E)}},v$=e=>{const s=BC(e);return{activate:d=>{let{id:b,activated:E,children:T,...t}=d;return b=Gr(b),T.has(b)?E:s.activate({id:b,activated:E,children:T,...t})},in:s.in,out:s.out}},x$=e=>{const s=jL(e);return{activate:d=>{let{id:b,activated:E,children:T,...t}=d;return b=Gr(b),T.has(b)?E:s.activate({id:b,activated:E,children:T,...t})},in:s.in,out:s.out}},b$={open:e=>{let{id:s,value:u,opened:d,parents:b}=e;if(u){const E=new Set;E.add(s);let T=b.get(s);for(;T!=null;)E.add(T),T=b.get(T);return E}else return d.delete(s),d},select:()=>null},UL={open:e=>{let{id:s,value:u,opened:d,parents:b}=e;if(u){let E=b.get(s);for(d.add(s);E!=null&&E!==s;)d.add(E),E=b.get(E);return d}else d.delete(s);return d},select:()=>null},w$={open:UL.open,select:e=>{let{id:s,value:u,opened:d,parents:b}=e;if(!u)return d;const E=[];let T=b.get(s);for(;T!=null;)E.push(T),T=b.get(T);return new Set(E)}},VC=e=>{const s={select:u=>{let{id:d,value:b,selected:E}=u;if(d=Gr(d),e&&!b){const T=Array.from(E.entries()).reduce((t,G)=>{let[W,Y]=G;return Y==="on"&&t.push(W),t},[]);if(T.length===1&&T[0]===d)return E}return E.set(d,b?"on":"off"),E},in:(u,d,b)=>{let E=new Map;for(const T of u||[])E=s.select({id:T,value:!0,selected:new Map(E),children:d,parents:b});return E},out:u=>{const d=[];for(const[b,E]of u.entries())E==="on"&&d.push(b);return d}};return s},$L=e=>{const s=VC(e);return{select:d=>{let{selected:b,id:E,...T}=d;E=Gr(E);const t=b.has(E)?new Map([[E,b.get(E)]]):new Map;return s.select({...T,id:E,selected:t})},in:(d,b,E)=>{let T=new Map;return d!=null&&d.length&&(T=s.in(d.slice(0,1),b,E)),T},out:(d,b,E)=>s.out(d,b,E)}},S$=e=>{const s=VC(e);return{select:d=>{let{id:b,selected:E,children:T,...t}=d;return b=Gr(b),T.has(b)?E:s.select({id:b,selected:E,children:T,...t})},in:s.in,out:s.out}},T$=e=>{const s=$L(e);return{select:d=>{let{id:b,selected:E,children:T,...t}=d;return b=Gr(b),T.has(b)?E:s.select({id:b,selected:E,children:T,...t})},in:s.in,out:s.out}},C$=e=>{const s={select:u=>{let{id:d,value:b,selected:E,children:T,parents:t}=u;d=Gr(d);const G=new Map(E),W=[d];for(;W.length;){const ne=W.shift();E.set(Gr(ne),b?"on":"off"),T.has(ne)&&W.push(...T.get(ne))}let Y=Gr(t.get(d));for(;Y;){const ne=T.get(Y),J=ne.every(ce=>E.get(Gr(ce))==="on"),Q=ne.every(ce=>!E.has(Gr(ce))||E.get(Gr(ce))==="off");E.set(Y,J?"on":Q?"off":"indeterminate"),Y=Gr(t.get(Y))}return e&&!b&&Array.from(E.entries()).reduce((J,Q)=>{let[ce,ie]=Q;return ie==="on"&&J.push(ce),J},[]).length===0?G:E},in:(u,d,b)=>{let E=new Map;for(const T of u||[])E=s.select({id:T,value:!0,selected:new Map(E),children:d,parents:b});return E},out:(u,d)=>{const b=[];for(const[E,T]of u.entries())T==="on"&&!d.has(E)&&b.push(E);return b}};return s},ob=Symbol.for("vuetify:nested"),GL={id:Bi(),root:{register:()=>null,unregister:()=>null,parents:yi(new Map),children:yi(new Map),open:()=>null,openOnSelect:()=>null,activate:()=>null,select:()=>null,activatable:yi(!1),selectable:yi(!1),opened:yi(new Set),activated:yi(new Set),selected:yi(new Map),selectedValues:yi([]),getPath:()=>[]}},E$=vn({activatable:Boolean,selectable:Boolean,activeStrategy:[String,Function,Object],selectStrategy:[String,Function,Object],openStrategy:[String,Object],opened:null,activated:null,selected:null,mandatory:Boolean},"nested"),M$=e=>{let s=!1;const u=yi(new Map),d=yi(new Map),b=mr(e,"opened",e.opened,ce=>new Set(ce),ce=>[...ce.values()]),E=Fe(()=>{if(typeof e.activeStrategy=="object")return e.activeStrategy;if(typeof e.activeStrategy=="function")return e.activeStrategy(e.mandatory);switch(e.activeStrategy){case"leaf":return v$(e.mandatory);case"single-leaf":return x$(e.mandatory);case"independent":return BC(e.mandatory);case"single-independent":default:return jL(e.mandatory)}}),T=Fe(()=>{if(typeof e.selectStrategy=="object")return e.selectStrategy;if(typeof e.selectStrategy=="function")return e.selectStrategy(e.mandatory);switch(e.selectStrategy){case"single-leaf":return T$(e.mandatory);case"leaf":return S$(e.mandatory);case"independent":return VC(e.mandatory);case"single-independent":return $L(e.mandatory);case"classic":default:return C$(e.mandatory)}}),t=Fe(()=>{if(typeof e.openStrategy=="object")return e.openStrategy;switch(e.openStrategy){case"list":return w$;case"single":return b$;case"multiple":default:return UL}}),G=mr(e,"activated",e.activated,ce=>E.value.in(ce,u.value,d.value),ce=>E.value.out(ce,u.value,d.value)),W=mr(e,"selected",e.selected,ce=>T.value.in(ce,u.value,d.value),ce=>T.value.out(ce,u.value,d.value));ql(()=>{s=!0});function Y(ce){const ie=[];let pe=ce;for(;pe!=null;)ie.unshift(pe),pe=d.value.get(pe);return ie}const ne=Po("nested"),J=new Set,Q={id:Bi(),root:{opened:b,activatable:$n(e,"activatable"),selectable:$n(e,"selectable"),activated:G,selected:W,selectedValues:Fe(()=>{const ce=[];for(const[ie,pe]of W.value.entries())pe==="on"&&ce.push(ie);return ce}),register:(ce,ie,pe)=>{if(J.has(ce)){Y(ce).map(String).join(" -> "),Y(ie).concat(ce).map(String).join(" -> ");return}else J.add(ce);ie&&ce!==ie&&d.value.set(ce,ie),pe&&u.value.set(ce,[]),ie!=null&&u.value.set(ie,[...u.value.get(ie)||[],ce])},unregister:ce=>{if(s)return;J.delete(ce),u.value.delete(ce);const ie=d.value.get(ce);if(ie){const pe=u.value.get(ie)??[];u.value.set(ie,pe.filter(be=>be!==ce))}d.value.delete(ce)},open:(ce,ie,pe)=>{ne.emit("click:open",{id:ce,value:ie,path:Y(ce),event:pe});const be=t.value.open({id:ce,value:ie,opened:new Set(b.value),children:u.value,parents:d.value,event:pe});be&&(b.value=be)},openOnSelect:(ce,ie,pe)=>{const be=t.value.select({id:ce,value:ie,selected:new Map(W.value),opened:new Set(b.value),children:u.value,parents:d.value,event:pe});be&&(b.value=be)},select:(ce,ie,pe)=>{ne.emit("click:select",{id:ce,value:ie,path:Y(ce),event:pe});const be=T.value.select({id:ce,value:ie,selected:new Map(W.value),children:u.value,parents:d.value,event:pe});be&&(W.value=be),Q.root.openOnSelect(ce,ie,pe)},activate:(ce,ie,pe)=>{if(!e.activatable)return Q.root.select(ce,!0,pe);ne.emit("click:activate",{id:ce,value:ie,path:Y(ce),event:pe});const be=E.value.activate({id:ce,value:ie,activated:new Set(G.value),children:u.value,parents:d.value,event:pe});be&&(G.value=be)},children:u,parents:d,getPath:Y}};return xa(ob,Q),Q.root},qL=(e,s)=>{const u=vr(ob,GL),d=Symbol(uc()),b=Fe(()=>e.value!==void 0?e.value:d),E={...u,id:b,open:(T,t)=>u.root.open(b.value,T,t),openOnSelect:(T,t)=>u.root.openOnSelect(b.value,T,t),isOpen:Fe(()=>u.root.opened.value.has(b.value)),parent:Fe(()=>u.root.parents.value.get(b.value)),activate:(T,t)=>u.root.activate(b.value,T,t),isActivated:Fe(()=>u.root.activated.value.has(Gr(b.value))),select:(T,t)=>u.root.select(b.value,T,t),isSelected:Fe(()=>u.root.selected.value.get(Gr(b.value))==="on"),isIndeterminate:Fe(()=>u.root.selected.value.get(Gr(b.value))==="indeterminate"),isLeaf:Fe(()=>!u.root.children.value.get(b.value)),isGroupActivator:u.isGroupActivator};return pv(()=>{!u.isGroupActivator&&u.root.register(b.value,u.id.value,s)}),ql(()=>{!u.isGroupActivator&&u.root.unregister(b.value)}),s&&xa(ob,E),E},I$=()=>{const e=vr(ob,GL);xa(ob,{...e,isGroupActivator:!0})},P$=Hh({name:"VListGroupActivator",setup(e,s){let{slots:u}=s;return I$(),()=>{var d;return(d=u.default)==null?void 0:d.call(u)}}}),A$=vn({activeColor:String,baseColor:String,color:String,collapseIcon:{type:_r,default:"$collapse"},expandIcon:{type:_r,default:"$expand"},prependIcon:_r,appendIcon:_r,fluid:Boolean,subgroup:Boolean,title:String,value:null,...tr(),...ia()},"VListGroup"),xT=Qn()({name:"VListGroup",props:A$(),setup(e,s){let{slots:u}=s;const{isOpen:d,open:b,id:E}=qL($n(e,"value"),!0),T=Fe(()=>`v-list-group--id-${String(E.value)}`),t=NL(),{isBooted:G}=K_();function W(Q){Q.stopPropagation(),b(!d.value,Q)}const Y=Fe(()=>({onClick:W,class:"v-list-group__header",id:T.value})),ne=Fe(()=>d.value?e.collapseIcon:e.expandIcon),J=Fe(()=>({VListItem:{active:d.value,activeColor:e.activeColor,baseColor:e.baseColor,color:e.color,prependIcon:e.prependIcon||e.subgroup&&ne.value,appendIcon:e.appendIcon||!e.subgroup&&ne.value,title:e.title,value:e.value}}));return fi(()=>de(e.tag,{class:["v-list-group",{"v-list-group--prepend":t==null?void 0:t.hasPrepend.value,"v-list-group--fluid":e.fluid,"v-list-group--subgroup":e.subgroup,"v-list-group--open":d.value},e.class],style:e.style},{default:()=>[u.activator&&de(da,{defaults:J.value},{default:()=>[de(P$,null,{default:()=>[u.activator({props:Y.value,isOpen:d.value})]})]}),de(eu,{transition:{component:ew},disabled:!G.value},{default:()=>{var Q;return[Js(de("div",{class:"v-list-group__items",role:"group","aria-labelledby":T.value},[(Q=u.default)==null?void 0:Q.call(u)]),[[Nd,d.value]])]}})]})),{isOpen:d}}}),k$=vn({opacity:[Number,String],...tr(),...ia()},"VListItemSubtitle"),HL=Qn()({name:"VListItemSubtitle",props:k$(),setup(e,s){let{slots:u}=s;return fi(()=>de(e.tag,{class:["v-list-item-subtitle",e.class],style:[{"--v-list-item-subtitle-opacity":e.opacity},e.style]},u)),{}}}),ZL=Hp("v-list-item-title"),D$=vn({active:{type:Boolean,default:void 0},activeClass:String,activeColor:String,appendAvatar:String,appendIcon:_r,baseColor:String,disabled:Boolean,lines:[Boolean,String],link:{type:Boolean,default:void 0},nav:Boolean,prependAvatar:String,prependIcon:_r,ripple:{type:[Boolean,Object],default:!0},slim:Boolean,subtitle:[String,Number],title:[String,Number],value:null,onClick:lc(),onClickOnce:lc(),...gh(),...tr(),...Hl(),...hl(),...El(),...Qs(),...xb(),...ia(),...Da(),...Ud({variant:"text"})},"VListItem"),km=Qn()({name:"VListItem",directives:{Ripple:zm},props:D$(),emits:{click:e=>!0},setup(e,s){let{attrs:u,slots:d,emit:b}=s;const E=vb(e,u),T=Fe(()=>e.value===void 0?E.href.value:e.value),{activate:t,isActivated:G,select:W,isOpen:Y,isSelected:ne,isIndeterminate:J,isGroupActivator:Q,root:ce,parent:ie,openOnSelect:pe,id:be}=qL(T,!1),Ie=NL(),$e=Fe(()=>{var Ci;return e.active!==!1&&(e.active||((Ci=E.isActive)==null?void 0:Ci.value)||(ce.activatable.value?G.value:ne.value))}),Le=Fe(()=>e.link!==!1&&E.isLink.value),Oe=Fe(()=>!!Ie&&(ce.selectable.value||ce.activatable.value||e.value!=null)),Ve=Fe(()=>!e.disabled&&e.link!==!1&&(e.link||E.isClickable.value||Oe.value)),Ue=Fe(()=>e.rounded||e.nav),qe=Fe(()=>e.color??e.activeColor),He=Fe(()=>({color:$e.value?qe.value??e.baseColor:e.baseColor,variant:e.variant}));Pi(()=>{var Ci;return(Ci=E.isActive)==null?void 0:Ci.value},Ci=>{Ci&&nt()}),pv(()=>{var Ci;(Ci=E.isActive)!=null&&Ci.value&&nt()});function nt(){ie.value!=null&&ce.open(ie.value,!0),pe(!0)}const{themeClasses:rt}=Ja(e),{borderClasses:ft}=Wh(e),{colorClasses:$t,colorStyles:hn,variantClasses:gn}=J_(He),{densityClasses:pn}=iu(e),{dimensionStyles:ri}=dl(e),{elevationClasses:ai}=hc(e),{roundedClasses:_n}=Ao(Ue),Bn=Fe(()=>e.lines?`v-list-item--${e.lines}-line`:void 0),mn=Fe(()=>({isActive:$e.value,select:W,isOpen:Y.value,isSelected:ne.value,isIndeterminate:J.value}));function Nn(Ci){var Fi;b("click",Ci),Ve.value&&((Fi=E.navigate)==null||Fi.call(E,Ci),!Q&&(ce.activatable.value?t(!G.value,Ci):(ce.selectable.value||e.value!=null)&&W(!ne.value,Ci)))}function Pn(Ci){(Ci.key==="Enter"||Ci.key===" ")&&(Ci.preventDefault(),Ci.target.dispatchEvent(new MouseEvent("click",Ci)))}return fi(()=>{const Ci=Le.value?"a":e.tag,Fi=d.title||e.title!=null,Ln=d.subtitle||e.subtitle!=null,sn=!!(e.appendAvatar||e.appendIcon),qn=!!(sn||d.append),pi=!!(e.prependAvatar||e.prependIcon),ht=!!(pi||d.prepend);return Ie==null||Ie.updateHasPrepend(ht),e.activeColor&&D6("active-color",["color","base-color"]),Js(de(Ci,oi({class:["v-list-item",{"v-list-item--active":$e.value,"v-list-item--disabled":e.disabled,"v-list-item--link":Ve.value,"v-list-item--nav":e.nav,"v-list-item--prepend":!ht&&(Ie==null?void 0:Ie.hasPrepend.value),"v-list-item--slim":e.slim,[`${e.activeClass}`]:e.activeClass&&$e.value},rt.value,ft.value,$t.value,pn.value,ai.value,Bn.value,_n.value,gn.value,e.class],style:[hn.value,ri.value,e.style],tabindex:Ve.value?Ie?-2:0:void 0,"aria-selected":Oe.value?ce.activatable.value?G.value:ce.selectable.value?ne.value:$e.value:void 0,onClick:Nn,onKeydown:Ve.value&&!Le.value&&Pn},E.linkProps),{default:()=>{var Zn;return[Fg(Ve.value||$e.value,"v-list-item"),ht&&de("div",{key:"prepend",class:"v-list-item__prepend"},[d.prepend?de(da,{key:"prepend-defaults",disabled:!pi,defaults:{VAvatar:{density:e.density,image:e.prependAvatar},VIcon:{density:e.density,icon:e.prependIcon},VListItemAction:{start:!0}}},{default:()=>{var St;return[(St=d.prepend)==null?void 0:St.call(d,mn.value)]}}):de(sr,null,[e.prependAvatar&&de(Vd,{key:"prepend-avatar",density:e.density,image:e.prependAvatar},null),e.prependIcon&&de(Ka,{key:"prepend-icon",density:e.density,icon:e.prependIcon},null)]),de("div",{class:"v-list-item__spacer"},null)]),de("div",{class:"v-list-item__content","data-no-activator":""},[Fi&&de(ZL,{key:"title"},{default:()=>{var St;return[((St=d.title)==null?void 0:St.call(d,{title:e.title}))??e.title]}}),Ln&&de(HL,{key:"subtitle"},{default:()=>{var St;return[((St=d.subtitle)==null?void 0:St.call(d,{subtitle:e.subtitle}))??e.subtitle]}}),(Zn=d.default)==null?void 0:Zn.call(d,mn.value)]),qn&&de("div",{key:"append",class:"v-list-item__append"},[d.append?de(da,{key:"append-defaults",disabled:!sn,defaults:{VAvatar:{density:e.density,image:e.appendAvatar},VIcon:{density:e.density,icon:e.appendIcon},VListItemAction:{end:!0}}},{default:()=>{var St;return[(St=d.append)==null?void 0:St.call(d,mn.value)]}}):de(sr,null,[e.appendIcon&&de(Ka,{key:"append-icon",density:e.density,icon:e.appendIcon},null),e.appendAvatar&&de(Vd,{key:"append-avatar",density:e.density,image:e.appendAvatar},null)]),de("div",{class:"v-list-item__spacer"},null)])]}}),[[qh("ripple"),Ve.value&&e.ripple]])}),{activate:t,isActivated:G,isGroupActivator:Q,isSelected:ne,list:Ie,select:W,root:ce,id:be}}}),R$=vn({color:String,inset:Boolean,sticky:Boolean,title:String,...tr(),...ia()},"VListSubheader"),WL=Qn()({name:"VListSubheader",props:R$(),setup(e,s){let{slots:u}=s;const{textColorClasses:d,textColorStyles:b}=Dc($n(e,"color"));return fi(()=>{const E=!!(u.default||e.title);return de(e.tag,{class:["v-list-subheader",{"v-list-subheader--inset":e.inset,"v-list-subheader--sticky":e.sticky},d.value,e.class],style:[{textColorStyles:b},e.style]},{default:()=>{var T;return[E&&de("div",{class:"v-list-subheader__text"},[((T=u.default)==null?void 0:T.call(u))??e.title])]}})}),{}}}),L$=vn({color:String,inset:Boolean,length:[Number,String],opacity:[Number,String],thickness:[Number,String],vertical:Boolean,...tr(),...Da()},"VDivider"),wb=Qn()({name:"VDivider",props:L$(),setup(e,s){let{attrs:u,slots:d}=s;const{themeClasses:b}=Ja(e),{textColorClasses:E,textColorStyles:T}=Dc($n(e,"color")),t=Fe(()=>{const G={};return e.length&&(G[e.vertical?"height":"width"]=Ji(e.length)),e.thickness&&(G[e.vertical?"borderRightWidth":"borderTopWidth"]=Ji(e.thickness)),G});return fi(()=>{const G=de("hr",{class:[{"v-divider":!0,"v-divider--inset":e.inset,"v-divider--vertical":e.vertical},b.value,E.value,e.class],style:[t.value,T.value,{"--v-border-opacity":e.opacity},e.style],"aria-orientation":!u.role||u.role==="separator"?e.vertical?"vertical":"horizontal":void 0,role:`${u.role||"separator"}`},null);return d.default?de("div",{class:["v-divider__wrapper",{"v-divider__wrapper--vertical":e.vertical,"v-divider__wrapper--inset":e.inset}]},[G,de("div",{class:"v-divider__content"},[d.default()]),G]):G}),{}}}),z$=vn({items:Array,returnObject:Boolean},"VListChildren"),XL=Qn()({name:"VListChildren",props:z$(),setup(e,s){let{slots:u}=s;return VL(),()=>{var d,b;return((d=u.default)==null?void 0:d.call(u))??((b=e.items)==null?void 0:b.map(E=>{var J,Q;let{children:T,props:t,type:G,raw:W}=E;if(G==="divider")return((J=u.divider)==null?void 0:J.call(u,{props:t}))??de(wb,t,null);if(G==="subheader")return((Q=u.subheader)==null?void 0:Q.call(u,{props:t}))??de(WL,t,null);const Y={subtitle:u.subtitle?ce=>{var ie;return(ie=u.subtitle)==null?void 0:ie.call(u,{...ce,item:W})}:void 0,prepend:u.prepend?ce=>{var ie;return(ie=u.prepend)==null?void 0:ie.call(u,{...ce,item:W})}:void 0,append:u.append?ce=>{var ie;return(ie=u.append)==null?void 0:ie.call(u,{...ce,item:W})}:void 0,title:u.title?ce=>{var ie;return(ie=u.title)==null?void 0:ie.call(u,{...ce,item:W})}:void 0},ne=xT.filterProps(t);return T?de(xT,oi({value:t==null?void 0:t.value},ne),{activator:ce=>{let{props:ie}=ce;const pe={...t,...ie,value:e.returnObject?W:t.value};return u.header?u.header({props:pe}):de(km,pe,Y)},default:()=>de(XL,{items:T,returnObject:e.returnObject},u)}):u.item?u.item({props:t}):de(km,oi(t,{value:e.returnObject?W:t.value}),Y)}))}}}),YL=vn({items:{type:Array,default:()=>[]},itemTitle:{type:[String,Array,Function],default:"title"},itemValue:{type:[String,Array,Function],default:"value"},itemChildren:{type:[Boolean,String,Array,Function],default:"children"},itemProps:{type:[Boolean,String,Array,Function],default:"props"},returnObject:Boolean,valueComparator:{type:Function,default:Gp}},"list-items");function Mg(e,s){const u=Sl(s,e.itemTitle,s),d=Sl(s,e.itemValue,u),b=Sl(s,e.itemChildren),E=e.itemProps===!0?typeof s=="object"&&s!=null&&!Array.isArray(s)?"children"in s?ul(s,["children"]):s:void 0:Sl(s,e.itemProps),T={title:u,value:d,...E};return{title:String(T.title??""),value:T.value,props:T,children:Array.isArray(b)?KL(e,b):void 0,raw:s}}function KL(e,s){const u=[];for(const d of s)u.push(Mg(e,d));return u}function NC(e){const s=Fe(()=>KL(e,e.items)),u=Fe(()=>s.value.some(E=>E.value===null));function d(E){return u.value||(E=E.filter(T=>T!==null)),E.map(T=>e.returnObject&&typeof T=="string"?Mg(e,T):s.value.find(t=>e.valueComparator(T,t.value))||Mg(e,T))}function b(E){return e.returnObject?E.map(T=>{let{raw:t}=T;return t}):E.map(T=>{let{value:t}=T;return t})}return{items:s,transformIn:d,transformOut:b}}function O$(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"}function F$(e,s){const u=Sl(s,e.itemType,"item"),d=O$(s)?s:Sl(s,e.itemTitle),b=Sl(s,e.itemValue,void 0),E=Sl(s,e.itemChildren),T=e.itemProps===!0?ul(s,["children"]):Sl(s,e.itemProps),t={title:d,value:b,...T};return{type:u,title:t.title,value:t.value,props:t,children:u==="item"&&E?JL(e,E):void 0,raw:s}}function JL(e,s){const u=[];for(const d of s)u.push(F$(e,d));return u}function B$(e){return{items:Fe(()=>JL(e,e.items))}}const V$=vn({baseColor:String,activeColor:String,activeClass:String,bgColor:String,disabled:Boolean,expandIcon:_r,collapseIcon:_r,lines:{type:[Boolean,String],default:"one"},slim:Boolean,nav:Boolean,"onClick:open":lc(),"onClick:select":lc(),"onUpdate:opened":lc(),...E$({selectStrategy:"single-leaf",openStrategy:"list"}),...gh(),...tr(),...Hl(),...hl(),...El(),itemType:{type:String,default:"type"},...YL(),...Qs(),...ia(),...Da(),...Ud({variant:"text"})},"VList"),ow=Qn()({name:"VList",props:V$(),emits:{"update:selected":e=>!0,"update:activated":e=>!0,"update:opened":e=>!0,"click:open":e=>!0,"click:activate":e=>!0,"click:select":e=>!0},setup(e,s){let{slots:u}=s;const{items:d}=B$(e),{themeClasses:b}=Ja(e),{backgroundColorClasses:E,backgroundColorStyles:T}=Ms($n(e,"bgColor")),{borderClasses:t}=Wh(e),{densityClasses:G}=iu(e),{dimensionStyles:W}=dl(e),{elevationClasses:Y}=hc(e),{roundedClasses:ne}=Ao(e),{children:J,open:Q,parents:ce,select:ie,getPath:pe}=M$(e),be=Fe(()=>e.lines?`v-list--${e.lines}-line`:void 0),Ie=$n(e,"activeColor"),$e=$n(e,"baseColor"),Le=$n(e,"color");VL(),Io({VListGroup:{activeColor:Ie,baseColor:$e,color:Le,expandIcon:$n(e,"expandIcon"),collapseIcon:$n(e,"collapseIcon")},VListItem:{activeClass:$n(e,"activeClass"),activeColor:Ie,baseColor:$e,color:Le,density:$n(e,"density"),disabled:$n(e,"disabled"),lines:$n(e,"lines"),nav:$n(e,"nav"),slim:$n(e,"slim"),variant:$n(e,"variant")}});const Oe=Bi(!1),Ve=yi();function Ue($t){Oe.value=!0}function qe($t){Oe.value=!1}function He($t){var hn;!Oe.value&&!($t.relatedTarget&&((hn=Ve.value)!=null&&hn.contains($t.relatedTarget)))&&ft()}function nt($t){const hn=$t.target;if(!(!Ve.value||["INPUT","TEXTAREA"].includes(hn.tagName))){if($t.key==="ArrowDown")ft("next");else if($t.key==="ArrowUp")ft("prev");else if($t.key==="Home")ft("first");else if($t.key==="End")ft("last");else return;$t.preventDefault()}}function rt($t){Oe.value=!0}function ft($t){if(Ve.value)return D_(Ve.value,$t)}return fi(()=>de(e.tag,{ref:Ve,class:["v-list",{"v-list--disabled":e.disabled,"v-list--nav":e.nav,"v-list--slim":e.slim},b.value,E.value,t.value,G.value,Y.value,be.value,ne.value,e.class],style:[T.value,W.value,e.style],tabindex:e.disabled||Oe.value?-1:0,role:"listbox","aria-activedescendant":void 0,onFocusin:Ue,onFocusout:qe,onFocus:He,onKeydown:nt,onMousedown:rt},{default:()=>[de(XL,{items:d.value,returnObject:e.returnObject},u)]})),{open:Q,select:ie,focus:ft,children:J,parents:ce,getPath:pe}}}),N$=Hp("v-list-img"),j$=vn({start:Boolean,end:Boolean,...tr(),...ia()},"VListItemAction"),U$=Qn()({name:"VListItemAction",props:j$(),setup(e,s){let{slots:u}=s;return fi(()=>de(e.tag,{class:["v-list-item-action",{"v-list-item-action--start":e.start,"v-list-item-action--end":e.end},e.class],style:e.style},u)),{}}}),$$=vn({start:Boolean,end:Boolean,...tr(),...ia()},"VListItemMedia"),G$=Qn()({name:"VListItemMedia",props:$$(),setup(e,s){let{slots:u}=s;return fi(()=>de(e.tag,{class:["v-list-item-media",{"v-list-item-media--start":e.start,"v-list-item-media--end":e.end},e.class],style:e.style},u)),{}}});function L2(e,s){return{x:e.x+s.x,y:e.y+s.y}}function q$(e,s){return{x:e.x-s.x,y:e.y-s.y}}function XA(e,s){if(e.side==="top"||e.side==="bottom"){const{side:u,align:d}=e,b=d==="left"?0:d==="center"?s.width/2:d==="right"?s.width:d,E=u==="top"?0:u==="bottom"?s.height:u;return L2({x:b,y:E},s)}else if(e.side==="left"||e.side==="right"){const{side:u,align:d}=e,b=u==="left"?0:u==="right"?s.width:u,E=d==="top"?0:d==="center"?s.height/2:d==="bottom"?s.height:d;return L2({x:b,y:E},s)}return L2({x:s.width/2,y:s.height/2},s)}const QL={static:W$,connected:Y$},H$=vn({locationStrategy:{type:[String,Function],default:"static",validator:e=>typeof e=="function"||e in QL},location:{type:String,default:"bottom"},origin:{type:String,default:"auto"},offset:[Number,String,Array]},"VOverlay-location-strategies");function Z$(e,s){const u=yi({}),d=yi();qa&&Du(()=>!!(s.isActive.value&&e.locationStrategy),E=>{var T,t;Pi(()=>e.locationStrategy,E),nu(()=>{window.removeEventListener("resize",b),d.value=void 0}),window.addEventListener("resize",b,{passive:!0}),typeof e.locationStrategy=="function"?d.value=(T=e.locationStrategy(s,e,u))==null?void 0:T.updateLocation:d.value=(t=QL[e.locationStrategy](s,e,u))==null?void 0:t.updateLocation});function b(E){var T;(T=d.value)==null||T.call(d,E)}return{contentStyles:u,updateLocation:d}}function W$(){}function X$(e,s){const u=bC(e);return s?u.x+=parseFloat(e.style.right||0):u.x-=parseFloat(e.style.left||0),u.y-=parseFloat(e.style.top||0),u}function Y$(e,s,u){(Array.isArray(e.target.value)||ej(e.target.value))&&Object.assign(u.value,{position:"fixed",top:0,[e.isRtl.value?"right":"left"]:0});const{preferredAnchor:b,preferredOrigin:E}=xC(()=>{const ce=sT(s.location,e.isRtl.value),ie=s.origin==="overlap"?ce:s.origin==="auto"?P2(ce):sT(s.origin,e.isRtl.value);return ce.side===ie.side&&ce.align===A2(ie).align?{preferredAnchor:yA(ce),preferredOrigin:yA(ie)}:{preferredAnchor:ce,preferredOrigin:ie}}),[T,t,G,W]=["minWidth","minHeight","maxWidth","maxHeight"].map(ce=>Fe(()=>{const ie=parseFloat(s[ce]);return isNaN(ie)?1/0:ie})),Y=Fe(()=>{if(Array.isArray(s.offset))return s.offset;if(typeof s.offset=="string"){const ce=s.offset.split(" ").map(parseFloat);return ce.length<2&&ce.push(0),ce}return typeof s.offset=="number"?[s.offset,0]:[0,0]});let ne=!1;const J=new ResizeObserver(()=>{ne&&Q()});Pi([e.target,e.contentEl],(ce,ie)=>{let[pe,be]=ce,[Ie,$e]=ie;Ie&&!Array.isArray(Ie)&&J.unobserve(Ie),pe&&!Array.isArray(pe)&&J.observe(pe),$e&&J.unobserve($e),be&&J.observe(be)},{immediate:!0}),nu(()=>{J.disconnect()});function Q(){if(ne=!1,requestAnimationFrame(()=>ne=!0),!e.target.value||!e.contentEl.value)return;const ce=RR(e.target.value),ie=X$(e.contentEl.value,e.isRtl.value),pe=C1(e.contentEl.value),be=12;pe.length||(pe.push(document.documentElement),e.contentEl.value.style.top&&e.contentEl.value.style.left||(ie.x-=parseFloat(document.documentElement.style.getPropertyValue("--v-body-scroll-x")||0),ie.y-=parseFloat(document.documentElement.style.getPropertyValue("--v-body-scroll-y")||0)));const Ie=pe.reduce((rt,ft)=>{const $t=ft.getBoundingClientRect(),hn=new R_({x:ft===document.documentElement?0:$t.x,y:ft===document.documentElement?0:$t.y,width:ft.clientWidth,height:ft.clientHeight});return rt?new R_({x:Math.max(rt.left,hn.left),y:Math.max(rt.top,hn.top),width:Math.min(rt.right,hn.right)-Math.max(rt.left,hn.left),height:Math.min(rt.bottom,hn.bottom)-Math.max(rt.top,hn.top)}):hn},void 0);Ie.x+=be,Ie.y+=be,Ie.width-=be*2,Ie.height-=be*2;let $e={anchor:b.value,origin:E.value};function Le(rt){const ft=new R_(ie),$t=XA(rt.anchor,ce),hn=XA(rt.origin,ft);let{x:gn,y:pn}=q$($t,hn);switch(rt.anchor.side){case"top":pn-=Y.value[0];break;case"bottom":pn+=Y.value[0];break;case"left":gn-=Y.value[0];break;case"right":gn+=Y.value[0];break}switch(rt.anchor.align){case"top":pn-=Y.value[1];break;case"bottom":pn+=Y.value[1];break;case"left":gn-=Y.value[1];break;case"right":gn+=Y.value[1];break}return ft.x+=gn,ft.y+=pn,ft.width=Math.min(ft.width,G.value),ft.height=Math.min(ft.height,W.value),{overflows:xA(ft,Ie),x:gn,y:pn}}let Oe=0,Ve=0;const Ue={x:0,y:0},qe={x:!1,y:!1};let He=-1;for(;!(He++>10);){const{x:rt,y:ft,overflows:$t}=Le($e);Oe+=rt,Ve+=ft,ie.x+=rt,ie.y+=ft;{const hn=vA($e.anchor),gn=$t.x.before||$t.x.after,pn=$t.y.before||$t.y.after;let ri=!1;if(["x","y"].forEach(ai=>{if(ai==="x"&&gn&&!qe.x||ai==="y"&&pn&&!qe.y){const _n={anchor:{...$e.anchor},origin:{...$e.origin}},Bn=ai==="x"?hn==="y"?A2:P2:hn==="y"?P2:A2;_n.anchor=Bn(_n.anchor),_n.origin=Bn(_n.origin);const{overflows:mn}=Le(_n);(mn[ai].before<=$t[ai].before&&mn[ai].after<=$t[ai].after||mn[ai].before+mn[ai].after<($t[ai].before+$t[ai].after)/2)&&($e=_n,ri=qe[ai]=!0)}}),ri)continue}$t.x.before&&(Oe+=$t.x.before,ie.x+=$t.x.before),$t.x.after&&(Oe-=$t.x.after,ie.x-=$t.x.after),$t.y.before&&(Ve+=$t.y.before,ie.y+=$t.y.before),$t.y.after&&(Ve-=$t.y.after,ie.y-=$t.y.after);{const hn=xA(ie,Ie);Ue.x=Ie.width-hn.x.before-hn.x.after,Ue.y=Ie.height-hn.y.before-hn.y.after,Oe+=hn.x.before,ie.x+=hn.x.before,Ve+=hn.y.before,ie.y+=hn.y.before}break}const nt=vA($e.anchor);return Object.assign(u.value,{"--v-overlay-anchor-origin":`${$e.anchor.side} ${$e.anchor.align}`,transformOrigin:`${$e.origin.side} ${$e.origin.align}`,top:Ji(z2(Ve)),left:e.isRtl.value?void 0:Ji(z2(Oe)),right:e.isRtl.value?Ji(z2(-Oe)):void 0,minWidth:Ji(nt==="y"?Math.min(T.value,ce.width):T.value),maxWidth:Ji(YA(Ko(Ue.x,T.value===1/0?0:T.value,G.value))),maxHeight:Ji(YA(Ko(Ue.y,t.value===1/0?0:t.value,W.value)))}),{available:Ue,contentBox:ie}}return Pi(()=>[b.value,E.value,s.offset,s.minWidth,s.minHeight,s.maxWidth,s.maxHeight],()=>Q()),Na(()=>{const ce=Q();if(!ce)return;const{available:ie,contentBox:pe}=ce;pe.height>ie.y&&requestAnimationFrame(()=>{Q(),requestAnimationFrame(()=>{Q()})})}),{updateLocation:Q}}function z2(e){return Math.round(e*devicePixelRatio)/devicePixelRatio}function YA(e){return Math.ceil(e*devicePixelRatio)/devicePixelRatio}let bT=!0;const I1=[];function K$(e){!bT||I1.length?(I1.push(e),wT()):(bT=!1,e(),wT())}let KA=-1;function wT(){cancelAnimationFrame(KA),KA=requestAnimationFrame(()=>{const e=I1.shift();e&&e(),I1.length?wT():bT=!0})}const h1={none:null,close:e8,block:t8,reposition:n8},J$=vn({scrollStrategy:{type:[String,Function],default:"block",validator:e=>typeof e=="function"||e in h1}},"VOverlay-scroll-strategies");function Q$(e,s){if(!qa)return;let u;Jo(async()=>{u==null||u.stop(),s.isActive.value&&e.scrollStrategy&&(u=XT(),await new Promise(d=>setTimeout(d)),u.active&&u.run(()=>{var d;typeof e.scrollStrategy=="function"?e.scrollStrategy(s,e,u):(d=h1[e.scrollStrategy])==null||d.call(h1,s,e,u)}))}),nu(()=>{u==null||u.stop()})}function e8(e){function s(u){e.isActive.value=!1}ez(e.targetEl.value??e.contentEl.value,s)}function t8(e,s){var T;const u=(T=e.root.value)==null?void 0:T.offsetParent,d=[...new Set([...C1(e.targetEl.value,s.contained?u:void 0),...C1(e.contentEl.value,s.contained?u:void 0)])].filter(t=>!t.classList.contains("v-overlay-scroll-blocked")),b=window.innerWidth-document.documentElement.offsetWidth,E=(t=>EC(t)&&t)(u||document.documentElement);E&&e.root.value.classList.add("v-overlay--scroll-blocked"),d.forEach((t,G)=>{t.style.setProperty("--v-body-scroll-x",Ji(-t.scrollLeft)),t.style.setProperty("--v-body-scroll-y",Ji(-t.scrollTop)),t!==document.documentElement&&t.style.setProperty("--v-scrollbar-offset",Ji(b)),t.classList.add("v-overlay-scroll-blocked")}),nu(()=>{d.forEach((t,G)=>{const W=parseFloat(t.style.getPropertyValue("--v-body-scroll-x")),Y=parseFloat(t.style.getPropertyValue("--v-body-scroll-y")),ne=t.style.scrollBehavior;t.style.scrollBehavior="auto",t.style.removeProperty("--v-body-scroll-x"),t.style.removeProperty("--v-body-scroll-y"),t.style.removeProperty("--v-scrollbar-offset"),t.classList.remove("v-overlay-scroll-blocked"),t.scrollLeft=-W,t.scrollTop=-Y,t.style.scrollBehavior=ne}),E&&e.root.value.classList.remove("v-overlay--scroll-blocked")})}function n8(e,s,u){let d=!1,b=-1,E=-1;function T(t){K$(()=>{var Y,ne;const G=performance.now();(ne=(Y=e.updateLocation).value)==null||ne.call(Y,t),d=(performance.now()-G)/(1e3/60)>2})}E=(typeof requestIdleCallback>"u"?t=>t():requestIdleCallback)(()=>{u.run(()=>{ez(e.targetEl.value??e.contentEl.value,t=>{d?(cancelAnimationFrame(b),b=requestAnimationFrame(()=>{b=requestAnimationFrame(()=>{T(t)})})):T(t)})})}),nu(()=>{typeof cancelIdleCallback<"u"&&cancelIdleCallback(E),cancelAnimationFrame(b)})}function ez(e,s){const u=[document,...C1(e)];u.forEach(d=>{d.addEventListener("scroll",s,{passive:!0})}),nu(()=>{u.forEach(d=>{d.removeEventListener("scroll",s)})})}const ST=Symbol.for("vuetify:v-menu"),jC=vn({closeDelay:[Number,String],openDelay:[Number,String]},"delay");function UC(e,s){let u=()=>{};function d(T){u==null||u();const t=Number(T?e.openDelay:e.closeDelay);return new Promise(G=>{u=y6(t,()=>{s==null||s(T),G(T)})})}function b(){return d(!0)}function E(){return d(!1)}return{clearDelay:u,runOpenDelay:b,runCloseDelay:E}}const i8=vn({target:[String,Object],activator:[String,Object],activatorProps:{type:Object,default:()=>({})},openOnClick:{type:Boolean,default:void 0},openOnHover:Boolean,openOnFocus:{type:Boolean,default:void 0},closeOnContentClick:Boolean,...jC()},"VOverlay-activator");function r8(e,s){let{isActive:u,isTop:d,contentEl:b}=s;const E=Po("useActivator"),T=yi();let t=!1,G=!1,W=!0;const Y=Fe(()=>e.openOnFocus||e.openOnFocus==null&&e.openOnHover),ne=Fe(()=>e.openOnClick||e.openOnClick==null&&!e.openOnHover&&!Y.value),{runOpenDelay:J,runCloseDelay:Q}=UC(e,qe=>{qe===(e.openOnHover&&t||Y.value&&G)&&!(e.openOnHover&&u.value&&!d.value)&&(u.value!==qe&&(W=!0),u.value=qe)}),ce=yi(),ie={onClick:qe=>{qe.stopPropagation(),T.value=qe.currentTarget||qe.target,u.value||(ce.value=[qe.clientX,qe.clientY]),u.value=!u.value},onMouseenter:qe=>{var He;(He=qe.sourceCapabilities)!=null&&He.firesTouchEvents||(t=!0,T.value=qe.currentTarget||qe.target,J())},onMouseleave:qe=>{t=!1,Q()},onFocus:qe=>{sv(qe.target,":focus-visible")!==!1&&(G=!0,qe.stopPropagation(),T.value=qe.currentTarget||qe.target,J())},onBlur:qe=>{G=!1,qe.stopPropagation(),Q()}},pe=Fe(()=>{const qe={};return ne.value&&(qe.onClick=ie.onClick),e.openOnHover&&(qe.onMouseenter=ie.onMouseenter,qe.onMouseleave=ie.onMouseleave),Y.value&&(qe.onFocus=ie.onFocus,qe.onBlur=ie.onBlur),qe}),be=Fe(()=>{const qe={};if(e.openOnHover&&(qe.onMouseenter=()=>{t=!0,J()},qe.onMouseleave=()=>{t=!1,Q()}),Y.value&&(qe.onFocusin=()=>{G=!0,J()},qe.onFocusout=()=>{G=!1,Q()}),e.closeOnContentClick){const He=vr(ST,null);qe.onClick=()=>{u.value=!1,He==null||He.closeParents()}}return qe}),Ie=Fe(()=>{const qe={};return e.openOnHover&&(qe.onMouseenter=()=>{W&&(t=!0,W=!1,J())},qe.onMouseleave=()=>{t=!1,Q()}),qe});Pi(d,qe=>{var He;qe&&(e.openOnHover&&!t&&(!Y.value||!G)||Y.value&&!G&&(!e.openOnHover||!t))&&!((He=b.value)!=null&&He.contains(document.activeElement))&&(u.value=!1)}),Pi(u,qe=>{qe||setTimeout(()=>{ce.value=void 0})},{flush:"post"});const $e=S1();Jo(()=>{$e.value&&Na(()=>{T.value=$e.el})});const Le=S1(),Oe=Fe(()=>e.target==="cursor"&&ce.value?ce.value:Le.value?Le.el:tz(e.target,E)||T.value),Ve=Fe(()=>Array.isArray(Oe.value)?void 0:Oe.value);let Ue;return Pi(()=>!!e.activator,qe=>{qe&&qa?(Ue=XT(),Ue.run(()=>{a8(e,E,{activatorEl:T,activatorEvents:pe})})):Ue&&Ue.stop()},{flush:"post",immediate:!0}),nu(()=>{Ue==null||Ue.stop()}),{activatorEl:T,activatorRef:$e,target:Oe,targetEl:Ve,targetRef:Le,activatorEvents:pe,contentEvents:be,scrimEvents:Ie}}function a8(e,s,u){let{activatorEl:d,activatorEvents:b}=u;Pi(()=>e.activator,(G,W)=>{if(W&&G!==W){const Y=t(W);Y&&T(Y)}G&&Na(()=>E())},{immediate:!0}),Pi(()=>e.activatorProps,()=>{E()}),nu(()=>{T()});function E(){let G=arguments.length>0&&arguments[0]!==void 0?arguments[0]:t(),W=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e.activatorProps;G&&b6(G,oi(b.value,W))}function T(){let G=arguments.length>0&&arguments[0]!==void 0?arguments[0]:t(),W=arguments.length>1&&arguments[1]!==void 0?arguments[1]:e.activatorProps;G&&w6(G,oi(b.value,W))}function t(){let G=arguments.length>0&&arguments[0]!==void 0?arguments[0]:e.activator;const W=tz(G,s);return d.value=(W==null?void 0:W.nodeType)===Node.ELEMENT_NODE?W:void 0,d.value}}function tz(e,s){var d,b;if(!e)return;let u;if(e==="parent"){let E=(b=(d=s==null?void 0:s.proxy)==null?void 0:d.$el)==null?void 0:b.parentNode;for(;E!=null&&E.hasAttribute("data-no-activator");)E=E.parentNode;u=E}else typeof e=="string"?u=document.querySelector(e):"$el"in e?u=e.$el:u=e;return u}function nz(){if(!qa)return Bi(!1);const{ssr:e}=jd();if(e){const s=Bi(!1);return Ua(()=>{s.value=!0}),s}else return Bi(!0)}const $C=vn({eager:Boolean},"lazy");function GC(e,s){const u=Bi(!1),d=Fe(()=>u.value||e.eager||s.value);Pi(s,()=>u.value=!0);function b(){e.eager||(u.value=!1)}return{isBooted:u,hasContent:d,onAfterLeave:b}}function iy(){const s=Po("useScopeId").vnode.scopeId;return{scopeId:s?{[s]:""}:void 0}}const JA=Symbol.for("vuetify:stack"),Tx=$l([]);function s8(e,s,u){const d=Po("useStack"),b=!u,E=vr(JA,void 0),T=$l({activeChildren:new Set});xa(JA,T);const t=Bi(+s.value);Du(e,()=>{var ne;const Y=(ne=Tx.at(-1))==null?void 0:ne[1];t.value=Y?Y+10:+s.value,b&&Tx.push([d.uid,t.value]),E==null||E.activeChildren.add(d.uid),nu(()=>{if(b){const J=Gr(Tx).findIndex(Q=>Q[0]===d.uid);Tx.splice(J,1)}E==null||E.activeChildren.delete(d.uid)})});const G=Bi(!0);b&&Jo(()=>{var ne;const Y=((ne=Tx.at(-1))==null?void 0:ne[0])===d.uid;setTimeout(()=>G.value=Y)});const W=Fe(()=>!T.activeChildren.size);return{globalTop:ub(G),localTop:W,stackStyles:Fe(()=>({zIndex:t.value}))}}function o8(e){return{teleportTarget:Fe(()=>{const u=e();if(u===!0||!qa)return;const d=u===!1?document.body:typeof u=="string"?document.querySelector(u):u;if(d==null)return;let b=[...d.children].find(E=>E.matches(".v-overlay-container"));return b||(b=document.createElement("div"),b.className="v-overlay-container",d.appendChild(b)),b})}}function l8(){return!0}function iz(e,s,u){if(!e||rz(e,u)===!1)return!1;const d=qR(s);if(typeof ShadowRoot<"u"&&d instanceof ShadowRoot&&d.host===e.target)return!1;const b=(typeof u.value=="object"&&u.value.include||(()=>[]))();return b.push(s),!b.some(E=>E==null?void 0:E.contains(e.target))}function rz(e,s){return(typeof s.value=="object"&&s.value.closeConditional||l8)(e)}function c8(e,s,u){const d=typeof u.value=="function"?u.value:u.value.handler;e.shadowTarget=e.target,s._clickOutside.lastMousedownWasOutside&&iz(e,s,u)&&setTimeout(()=>{rz(e,u)&&d&&d(e)},0)}function QA(e,s){const u=qR(e);s(document),typeof ShadowRoot<"u"&&u instanceof ShadowRoot&&s(u)}const az={mounted(e,s){const u=b=>c8(b,e,s),d=b=>{e._clickOutside.lastMousedownWasOutside=iz(b,e,s)};QA(e,b=>{b.addEventListener("click",u,!0),b.addEventListener("mousedown",d,!0)}),e._clickOutside||(e._clickOutside={lastMousedownWasOutside:!1}),e._clickOutside[s.instance.$.uid]={onClick:u,onMousedown:d}},beforeUnmount(e,s){e._clickOutside&&(QA(e,u=>{var E;if(!u||!((E=e._clickOutside)!=null&&E[s.instance.$.uid]))return;const{onClick:d,onMousedown:b}=e._clickOutside[s.instance.$.uid];u.removeEventListener("click",d,!0),u.removeEventListener("mousedown",b,!0)}),delete e._clickOutside[s.instance.$.uid])}};function u8(e){const{modelValue:s,color:u,...d}=e;return de(kg,{name:"fade-transition",appear:!0},{default:()=>[e.modelValue&&de("div",oi({class:["v-overlay__scrim",e.color.backgroundColorClasses.value],style:e.color.backgroundColorStyles.value},d),null)]})}const Sb=vn({absolute:Boolean,attach:[Boolean,String,Object],closeOnBack:{type:Boolean,default:!0},contained:Boolean,contentClass:null,contentProps:null,disabled:Boolean,opacity:[Number,String],noClickAnimation:Boolean,modelValue:Boolean,persistent:Boolean,scrim:{type:[Boolean,String],default:!0},zIndex:{type:[Number,String],default:2e3},...i8(),...tr(),...hl(),...$C(),...H$(),...J$(),...Da(),...$f()},"VOverlay"),jp=Qn()({name:"VOverlay",directives:{ClickOutside:az},inheritAttrs:!1,props:{_disableGlobalStack:Boolean,...Sb()},emits:{"click:outside":e=>!0,"update:modelValue":e=>!0,afterEnter:()=>!0,afterLeave:()=>!0},setup(e,s){let{slots:u,attrs:d,emit:b}=s;const E=Po("VOverlay"),T=yi(),t=yi(),G=yi(),W=mr(e,"modelValue"),Y=Fe({get:()=>W.value,set:Ln=>{Ln&&e.disabled||(W.value=Ln)}}),{themeClasses:ne}=Ja(e),{rtlClasses:J,isRtl:Q}=Cl(),{hasContent:ce,onAfterLeave:ie}=GC(e,Y),pe=Ms(Fe(()=>typeof e.scrim=="string"?e.scrim:null)),{globalTop:be,localTop:Ie,stackStyles:$e}=s8(Y,$n(e,"zIndex"),e._disableGlobalStack),{activatorEl:Le,activatorRef:Oe,target:Ve,targetEl:Ue,targetRef:qe,activatorEvents:He,contentEvents:nt,scrimEvents:rt}=r8(e,{isActive:Y,isTop:Ie,contentEl:G}),{teleportTarget:ft}=o8(()=>{var qn,pi,ht;const Ln=e.attach||e.contained;if(Ln)return Ln;const sn=((qn=Le==null?void 0:Le.value)==null?void 0:qn.getRootNode())||((ht=(pi=E.proxy)==null?void 0:pi.$el)==null?void 0:ht.getRootNode());return sn instanceof ShadowRoot?sn:!1}),{dimensionStyles:$t}=dl(e),hn=nz(),{scopeId:gn}=iy();Pi(()=>e.disabled,Ln=>{Ln&&(Y.value=!1)});const{contentStyles:pn,updateLocation:ri}=Z$(e,{isRtl:Q,contentEl:G,target:Ve,isActive:Y});Q$(e,{root:T,contentEl:G,targetEl:Ue,isActive:Y,updateLocation:ri});function ai(Ln){b("click:outside",Ln),e.persistent?Pn():Y.value=!1}function _n(Ln){return Y.value&&be.value&&(!e.scrim||Ln.target===t.value||Ln instanceof MouseEvent&&Ln.shadowTarget===t.value)}qa&&Pi(Y,Ln=>{Ln?window.addEventListener("keydown",Bn):window.removeEventListener("keydown",Bn)},{immediate:!0}),ql(()=>{qa&&window.removeEventListener("keydown",Bn)});function Bn(Ln){var sn,qn;Ln.key==="Escape"&&be.value&&(e.persistent?Pn():(Y.value=!1,(sn=G.value)!=null&&sn.contains(document.activeElement)&&((qn=Le.value)==null||qn.focus())))}const mn=_L();Du(()=>e.closeOnBack,()=>{qU(mn,Ln=>{be.value&&Y.value?(Ln(!1),e.persistent?Pn():Y.value=!1):Ln()})});const Nn=yi();Pi(()=>Y.value&&(e.absolute||e.contained)&&ft.value==null,Ln=>{if(Ln){const sn=CC(T.value);sn&&sn!==document.scrollingElement&&(Nn.value=sn.scrollTop)}});function Pn(){e.noClickAnimation||G.value&&P_(G.value,[{transformOrigin:"center"},{transform:"scale(1.03)"},{transformOrigin:"center"}],{duration:150,easing:Qx})}function Ci(){b("afterEnter")}function Fi(){ie(),b("afterLeave")}return fi(()=>{var Ln;return de(sr,null,[(Ln=u.activator)==null?void 0:Ln.call(u,{isActive:Y.value,targetRef:qe,props:oi({ref:Oe},He.value,e.activatorProps)}),hn.value&&ce.value&&de(ZB,{disabled:!ft.value,to:ft.value},{default:()=>[de("div",oi({class:["v-overlay",{"v-overlay--absolute":e.absolute||e.contained,"v-overlay--active":Y.value,"v-overlay--contained":e.contained},ne.value,J.value,e.class],style:[$e.value,{"--v-overlay-opacity":e.opacity,top:Ji(Nn.value)},e.style],ref:T},gn,d),[de(u8,oi({color:pe,modelValue:Y.value&&!!e.scrim,ref:t},rt.value),null),de(eu,{appear:!0,persisted:!0,transition:e.transition,target:Ve.value,onAfterEnter:Ci,onAfterLeave:Fi},{default:()=>{var sn;return[Js(de("div",oi({ref:G,class:["v-overlay__content",e.contentClass],style:[$t.value,pn.value]},nt.value,e.contentProps),[(sn=u.default)==null?void 0:sn.call(u,{isActive:Y})]),[[Nd,Y.value],[qh("click-outside"),{handler:ai,closeConditional:_n,include:()=>[Le.value]}]])]}})])]})])}),{activatorEl:Le,scrimEl:t,target:Ve,animateClick:Pn,contentEl:G,globalTop:be,localTop:Ie,updateLocation:ri}}}),O2=Symbol("Forwarded refs");function F2(e,s){let u=e;for(;u;){const d=Reflect.getOwnPropertyDescriptor(u,s);if(d)return d;u=Object.getPrototypeOf(u)}}function $d(e){for(var s=arguments.length,u=new Array(s>1?s-1:0),d=1;d<s;d++)u[d-1]=arguments[d];return e[O2]=u,new Proxy(e,{get(b,E){if(Reflect.has(b,E))return Reflect.get(b,E);if(!(typeof E=="symbol"||E.startsWith("$")||E.startsWith("__"))){for(const T of u)if(T.value&&Reflect.has(T.value,E)){const t=Reflect.get(T.value,E);return typeof t=="function"?t.bind(T.value):t}}},has(b,E){if(Reflect.has(b,E))return!0;if(typeof E=="symbol"||E.startsWith("$")||E.startsWith("__"))return!1;for(const T of u)if(T.value&&Reflect.has(T.value,E))return!0;return!1},set(b,E,T){if(Reflect.has(b,E))return Reflect.set(b,E,T);if(typeof E=="symbol"||E.startsWith("$")||E.startsWith("__"))return!1;for(const t of u)if(t.value&&Reflect.has(t.value,E))return Reflect.set(t.value,E,T);return!1},getOwnPropertyDescriptor(b,E){var t;const T=Reflect.getOwnPropertyDescriptor(b,E);if(T)return T;if(!(typeof E=="symbol"||E.startsWith("$")||E.startsWith("__"))){for(const G of u){if(!G.value)continue;const W=F2(G.value,E)??("_"in G.value?F2((t=G.value._)==null?void 0:t.setupState,E):void 0);if(W)return W}for(const G of u){const W=G.value&&G.value[O2];if(!W)continue;const Y=W.slice();for(;Y.length;){const ne=Y.shift(),J=F2(ne.value,E);if(J)return J;const Q=ne.value&&ne.value[O2];Q&&Y.push(...Q)}}}}})}const sz=vn({id:String,submenu:Boolean,...ul(Sb({closeDelay:250,closeOnContentClick:!0,locationStrategy:"connected",location:void 0,openDelay:300,scrim:!1,scrollStrategy:"reposition",transition:{component:Q1}}),["absolute"])},"VMenu"),hv=Qn()({name:"VMenu",props:sz(),emits:{"update:modelValue":e=>!0},setup(e,s){let{slots:u}=s;const d=mr(e,"modelValue"),{scopeId:b}=iy(),{isRtl:E}=Cl(),T=uc(),t=Fe(()=>e.id||`v-menu-${T}`),G=yi(),W=vr(ST,null),Y=Bi(new Set);xa(ST,{register(){Y.value.add(T)},unregister(){Y.value.delete(T)},closeParents(pe){setTimeout(()=>{var be;!Y.value.size&&!e.persistent&&(pe==null||(be=G.value)!=null&&be.contentEl&&!v6(pe,G.value.contentEl))&&(d.value=!1,W==null||W.closeParents())},40)}}),ql(()=>{W==null||W.unregister(),document.removeEventListener("focusin",ne)}),aC(()=>d.value=!1);async function ne(pe){var $e,Le,Oe;const be=pe.relatedTarget,Ie=pe.target;await Na(),d.value&&be!==Ie&&(($e=G.value)!=null&&$e.contentEl)&&((Le=G.value)!=null&&Le.globalTop)&&![document,G.value.contentEl].includes(Ie)&&!G.value.contentEl.contains(Ie)&&((Oe=Jx(G.value.contentEl)[0])==null||Oe.focus())}Pi(d,pe=>{pe?(W==null||W.register(),qa&&document.addEventListener("focusin",ne,{once:!0})):(W==null||W.unregister(),qa&&document.removeEventListener("focusin",ne))},{immediate:!0});function J(pe){W==null||W.closeParents(pe)}function Q(pe){var be,Ie,$e,Le,Oe;if(!e.disabled)if(pe.key==="Tab"||pe.key==="Enter"&&!e.closeOnContentClick){if(pe.key==="Enter"&&(pe.target instanceof HTMLTextAreaElement||pe.target instanceof HTMLInputElement&&pe.target.closest("form")))return;pe.key==="Enter"&&pe.preventDefault(),AR(Jx((be=G.value)==null?void 0:be.contentEl,!1),pe.shiftKey?"prev":"next",Ue=>Ue.tabIndex>=0)||(d.value=!1,($e=(Ie=G.value)==null?void 0:Ie.activatorEl)==null||$e.focus())}else e.submenu&&pe.key===(E.value?"ArrowRight":"ArrowLeft")&&(d.value=!1,(Oe=(Le=G.value)==null?void 0:Le.activatorEl)==null||Oe.focus())}function ce(pe){var Ie;if(e.disabled)return;const be=(Ie=G.value)==null?void 0:Ie.contentEl;be&&d.value?pe.key==="ArrowDown"?(pe.preventDefault(),pe.stopImmediatePropagation(),D_(be,"next")):pe.key==="ArrowUp"?(pe.preventDefault(),pe.stopImmediatePropagation(),D_(be,"prev")):e.submenu&&(pe.key===(E.value?"ArrowRight":"ArrowLeft")?d.value=!1:pe.key===(E.value?"ArrowLeft":"ArrowRight")&&(pe.preventDefault(),D_(be,"first"))):(e.submenu?pe.key===(E.value?"ArrowLeft":"ArrowRight"):["ArrowDown","ArrowUp"].includes(pe.key))&&(d.value=!0,pe.preventDefault(),setTimeout(()=>setTimeout(()=>ce(pe))))}const ie=Fe(()=>oi({"aria-haspopup":"menu","aria-expanded":String(d.value),"aria-controls":t.value,onKeydown:ce},e.activatorProps));return fi(()=>{const pe=jp.filterProps(e);return de(jp,oi({ref:G,id:t.value,class:["v-menu",e.class],style:e.style},pe,{modelValue:d.value,"onUpdate:modelValue":be=>d.value=be,absolute:!0,activatorProps:ie.value,location:e.location??(e.submenu?"end":"bottom"),"onClick:outside":J,onKeydown:Q},b),{activator:u.activator,default:function(){for(var be=arguments.length,Ie=new Array(be),$e=0;$e<be;$e++)Ie[$e]=arguments[$e];return de(da,{root:"VMenu"},{default:()=>{var Le;return[(Le=u.default)==null?void 0:Le.call(u,...Ie)]}})}})}),$d({id:t,ΨopenChildren:Y},G)}}),h8=vn({active:Boolean,disabled:Boolean,max:[Number,String],value:{type:[Number,String],default:0},...tr(),...$f({transition:{component:DC}})},"VCounter"),lw=Qn()({name:"VCounter",functional:!0,props:h8(),setup(e,s){let{slots:u}=s;const d=Fe(()=>e.max?`${e.value} / ${e.max}`:String(e.value));return fi(()=>de(eu,{transition:e.transition},{default:()=>[Js(de("div",{class:["v-counter",{"text-error":e.max&&!e.disabled&&parseFloat(e.value)>parseFloat(e.max)},e.class],style:e.style},[u.default?u.default({counter:d.value,max:e.max,value:e.value}):d.value]),[[Nd,e.active]])]})),{}}}),d8=vn({floating:Boolean,...tr()},"VFieldLabel"),Dx=Qn()({name:"VFieldLabel",props:d8(),setup(e,s){let{slots:u}=s;return fi(()=>de(vv,{class:["v-field-label",{"v-field-label--floating":e.floating},e.class],style:e.style,"aria-hidden":e.floating||void 0},u)),{}}}),f8=["underlined","outlined","filled","solo","solo-inverted","solo-filled","plain"],Tb=vn({appendInnerIcon:_r,bgColor:String,clearable:Boolean,clearIcon:{type:_r,default:"$clear"},active:Boolean,centerAffix:{type:Boolean,default:void 0},color:String,baseColor:String,dirty:Boolean,disabled:{type:Boolean,default:null},error:Boolean,flat:Boolean,label:String,persistentClear:Boolean,prependInnerIcon:_r,reverse:Boolean,singleLine:Boolean,variant:{type:String,default:"filled",validator:e=>f8.includes(e)},"onClick:clear":lc(),"onClick:appendInner":lc(),"onClick:prependInner":lc(),...tr(),...iw(),...Qs(),...Da()},"VField"),bv=Qn()({name:"VField",inheritAttrs:!1,props:{id:String,...bb(),...Tb()},emits:{"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,s){let{attrs:u,emit:d,slots:b}=s;const{themeClasses:E}=Ja(e),{loaderClasses:T}=_b(e),{focusClasses:t,isFocused:G,focus:W,blur:Y}=Om(e),{InputIcon:ne}=AL(e),{roundedClasses:J}=Ao(e),{rtlClasses:Q}=Cl(),ce=Fe(()=>e.dirty||e.active),ie=Fe(()=>!!(e.label||b.label)),pe=Fe(()=>!e.singleLine&&ie.value),be=uc(),Ie=Fe(()=>e.id||`input-${be}`),$e=Fe(()=>`${Ie.value}-messages`),Le=yi(),Oe=yi(),Ve=yi(),Ue=Fe(()=>["plain","underlined"].includes(e.variant)),{backgroundColorClasses:qe,backgroundColorStyles:He}=Ms($n(e,"bgColor")),{textColorClasses:nt,textColorStyles:rt}=Dc(Fe(()=>e.error||e.disabled?void 0:ce.value&&G.value?e.color:e.baseColor));Pi(ce,hn=>{if(pe.value){const gn=Le.value.$el,pn=Oe.value.$el;requestAnimationFrame(()=>{const ri=bC(gn),ai=pn.getBoundingClientRect(),_n=ai.x-ri.x,Bn=ai.y-ri.y-(ri.height/2-ai.height/2),mn=ai.width/.75,Nn=Math.abs(mn-ri.width)>1?{maxWidth:Ji(mn)}:void 0,Pn=getComputedStyle(gn),Ci=getComputedStyle(pn),Fi=parseFloat(Pn.transitionDuration)*1e3||150,Ln=parseFloat(Ci.getPropertyValue("--v-field-label-scale")),sn=Ci.getPropertyValue("color");gn.style.visibility="visible",pn.style.visibility="hidden",P_(gn,{transform:`translate(${_n}px, ${Bn}px) scale(${Ln})`,color:sn,...Nn},{duration:Fi,easing:Qx,direction:hn?"normal":"reverse"}).finished.then(()=>{gn.style.removeProperty("visibility"),pn.style.removeProperty("visibility")})})}},{flush:"post"});const ft=Fe(()=>({isActive:ce,isFocused:G,controlRef:Ve,blur:Y,focus:W}));function $t(hn){hn.target!==document.activeElement&&hn.preventDefault()}return fi(()=>{var _n,Bn,mn;const hn=e.variant==="outlined",gn=!!(b["prepend-inner"]||e.prependInnerIcon),pn=!!(e.clearable||b.clear)&&!e.disabled,ri=!!(b["append-inner"]||e.appendInnerIcon||pn),ai=()=>b.label?b.label({...ft.value,label:e.label,props:{for:Ie.value}}):e.label;return de("div",oi({class:["v-field",{"v-field--active":ce.value,"v-field--appended":ri,"v-field--center-affix":e.centerAffix??!Ue.value,"v-field--disabled":e.disabled,"v-field--dirty":e.dirty,"v-field--error":e.error,"v-field--flat":e.flat,"v-field--has-background":!!e.bgColor,"v-field--persistent-clear":e.persistentClear,"v-field--prepended":gn,"v-field--reverse":e.reverse,"v-field--single-line":e.singleLine,"v-field--no-label":!ai(),[`v-field--variant-${e.variant}`]:!0},E.value,qe.value,t.value,T.value,J.value,Q.value,e.class],style:[He.value,e.style],onClick:$t},u),[de("div",{class:"v-field__overlay"},null),de(yb,{name:"v-field",active:!!e.loading,color:e.error?"error":typeof e.loading=="string"?e.loading:e.color},{default:b.loader}),gn&&de("div",{key:"prepend",class:"v-field__prepend-inner"},[e.prependInnerIcon&&de(ne,{key:"prepend-icon",name:"prependInner"},null),(_n=b["prepend-inner"])==null?void 0:_n.call(b,ft.value)]),de("div",{class:"v-field__field","data-no-activator":""},[["filled","solo","solo-inverted","solo-filled"].includes(e.variant)&&pe.value&&de(Dx,{key:"floating-label",ref:Oe,class:[nt.value],floating:!0,for:Ie.value,style:rt.value},{default:()=>[ai()]}),ie.value&&de(Dx,{key:"label",ref:Le,for:Ie.value},{default:()=>[ai()]}),(Bn=b.default)==null?void 0:Bn.call(b,{...ft.value,props:{id:Ie.value,class:"v-field__input","aria-describedby":$e.value},focus:W,blur:Y})]),pn&&de(RC,{key:"clear"},{default:()=>[Js(de("div",{class:"v-field__clearable",onMousedown:Nn=>{Nn.preventDefault(),Nn.stopPropagation()}},[de(da,{defaults:{VIcon:{icon:e.clearIcon}}},{default:()=>[b.clear?b.clear({...ft.value,props:{onFocus:W,onBlur:Y,onClick:e["onClick:clear"]}}):de(ne,{name:"clear",onFocus:W,onBlur:Y},null)]})]),[[Nd,e.dirty]])]}),ri&&de("div",{key:"append",class:"v-field__append-inner"},[(mn=b["append-inner"])==null?void 0:mn.call(b,ft.value),e.appendInnerIcon&&de(ne,{key:"append-icon",name:"appendInner"},null)]),de("div",{class:["v-field__outline",nt.value],style:rt.value},[hn&&de(sr,null,[de("div",{class:"v-field__outline__start"},null),pe.value&&de("div",{class:"v-field__outline__notch"},[de(Dx,{ref:Oe,floating:!0,for:Ie.value},{default:()=>[ai()]})]),de("div",{class:"v-field__outline__end"},null)]),Ue.value&&pe.value&&de(Dx,{ref:Oe,floating:!0,for:Ie.value},{default:()=>[ai()]})])])}),{controlRef:Ve}}});function qC(e){const s=Object.keys(bv.props).filter(u=>!Z1(u)&&u!=="class"&&u!=="style");return vC(e,s)}const p8=["color","file","time","date","datetime-local","week","month"],cw=vn({autofocus:Boolean,counter:[Boolean,Number,String],counterValue:[Number,Function],prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,suffix:String,role:String,type:{type:String,default:"text"},modelModifiers:Object,...Fm(),...Tb()},"VTextField"),B_=Qn()({name:"VTextField",directives:{Intersect:gb},inheritAttrs:!1,props:cw(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,s){let{attrs:u,emit:d,slots:b}=s;const E=mr(e,"modelValue"),{isFocused:T,focus:t,blur:G}=Om(e),W=Fe(()=>typeof e.counterValue=="function"?e.counterValue(E.value):typeof e.counterValue=="number"?e.counterValue:(E.value??"").toString().length),Y=Fe(()=>{if(u.maxlength)return u.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter}),ne=Fe(()=>["plain","underlined"].includes(e.variant));function J(Ve,Ue){var qe,He;!e.autofocus||!Ve||(He=(qe=Ue[0].target)==null?void 0:qe.focus)==null||He.call(qe)}const Q=yi(),ce=yi(),ie=yi(),pe=Fe(()=>p8.includes(e.type)||e.persistentPlaceholder||T.value||e.active);function be(){var Ve;ie.value!==document.activeElement&&((Ve=ie.value)==null||Ve.focus()),T.value||t()}function Ie(Ve){d("mousedown:control",Ve),Ve.target!==ie.value&&(be(),Ve.preventDefault())}function $e(Ve){be(),d("click:control",Ve)}function Le(Ve){Ve.stopPropagation(),be(),Na(()=>{E.value=null,W1(e["onClick:clear"],Ve)})}function Oe(Ve){var qe;const Ue=Ve.target;if(E.value=Ue.value,(qe=e.modelModifiers)!=null&&qe.trim&&["text","search","password","tel","url"].includes(e.type)){const He=[Ue.selectionStart,Ue.selectionEnd];Na(()=>{Ue.selectionStart=He[0],Ue.selectionEnd=He[1]})}}return fi(()=>{const Ve=!!(b.counter||e.counter!==!1&&e.counter!=null),Ue=!!(Ve||b.details),[qe,He]=Og(u),{modelValue:nt,...rt}=Rc.filterProps(e),ft=qC(e);return de(Rc,oi({ref:Q,modelValue:E.value,"onUpdate:modelValue":$t=>E.value=$t,class:["v-text-field",{"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-input--plain-underlined":ne.value},e.class],style:e.style},qe,rt,{centerAffix:!ne.value,focused:T.value}),{...b,default:$t=>{let{id:hn,isDisabled:gn,isDirty:pn,isReadonly:ri,isValid:ai}=$t;return de(bv,oi({ref:ce,onMousedown:Ie,onClick:$e,"onClick:clear":Le,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"],role:e.role},ft,{id:hn.value,active:pe.value||pn.value,dirty:pn.value||e.dirty,disabled:gn.value,focused:T.value,error:ai.value===!1}),{...b,default:_n=>{let{props:{class:Bn,...mn}}=_n;const Nn=Js(de("input",oi({ref:ie,value:E.value,onInput:Oe,autofocus:e.autofocus,readonly:ri.value,disabled:gn.value,name:e.name,placeholder:e.placeholder,size:1,type:e.type,onFocus:be,onBlur:G},mn,He),null),[[qh("intersect"),{handler:J},null,{once:!0}]]);return de(sr,null,[e.prefix&&de("span",{class:"v-text-field__prefix"},[de("span",{class:"v-text-field__prefix__text"},[e.prefix])]),b.default?de("div",{class:Bn,"data-no-activator":""},[b.default(),Nn]):Mm(Nn,{class:Bn}),e.suffix&&de("span",{class:"v-text-field__suffix"},[de("span",{class:"v-text-field__suffix__text"},[e.suffix])])])}})},details:Ue?$t=>{var hn;return de(sr,null,[(hn=b.details)==null?void 0:hn.call(b,$t),Ve&&de(sr,null,[de("span",null,null),de(lw,{active:e.persistentCounter||T.value,value:W.value,max:Y.value,disabled:e.disabled},b.counter)])])}:void 0})}),$d({},Q,ce,ie)}}),m8=vn({renderless:Boolean,...tr()},"VVirtualScrollItem"),oz=Qn()({name:"VVirtualScrollItem",inheritAttrs:!1,props:m8(),emits:{"update:height":e=>!0},setup(e,s){let{attrs:u,emit:d,slots:b}=s;const{resizeRef:E,contentRect:T}=Ff(void 0,"border");Pi(()=>{var t;return(t=T.value)==null?void 0:t.height},t=>{t!=null&&d("update:height",t)}),fi(()=>{var t,G;return e.renderless?de(sr,null,[(t=b.default)==null?void 0:t.call(b,{itemRef:E})]):de("div",oi({ref:E,class:["v-virtual-scroll__item",e.class],style:e.style},u),[(G=b.default)==null?void 0:G.call(b)])})}}),g8=-1,_8=1,B2=100,lz=vn({itemHeight:{type:[Number,String],default:null},height:[Number,String]},"virtual");function cz(e,s){const u=jd(),d=Bi(0);Jo(()=>{d.value=parseFloat(e.itemHeight||0)});const b=Bi(0),E=Bi(Math.ceil((parseInt(e.height)||u.height.value)/(d.value||16))||1),T=Bi(0),t=Bi(0),G=yi(),W=yi();let Y=0;const{resizeRef:ne,contentRect:J}=Ff();Jo(()=>{ne.value=G.value});const Q=Fe(()=>{var Bn;return G.value===document.documentElement?u.height.value:((Bn=J.value)==null?void 0:Bn.height)||parseInt(e.height)||0}),ce=Fe(()=>!!(G.value&&W.value&&Q.value&&d.value));let ie=Array.from({length:s.value.length}),pe=Array.from({length:s.value.length});const be=Bi(0);let Ie=-1;function $e(Bn){return ie[Bn]||d.value}const Le=p6(()=>{const Bn=performance.now();pe[0]=0;const mn=s.value.length;for(let Nn=1;Nn<=mn-1;Nn++)pe[Nn]=(pe[Nn-1]||0)+$e(Nn-1);be.value=Math.max(be.value,performance.now()-Bn)},be),Oe=Pi(ce,Bn=>{Bn&&(Oe(),Y=W.value.offsetTop,Le.immediate(),pn(),~Ie&&Na(()=>{qa&&window.requestAnimationFrame(()=>{ai(Ie),Ie=-1})}))});nu(()=>{Le.clear()});function Ve(Bn,mn){const Nn=ie[Bn],Pn=d.value;d.value=Pn?Math.min(d.value,mn):mn,(Nn!==mn||Pn!==d.value)&&(ie[Bn]=mn,Le())}function Ue(Bn){return Bn=Ko(Bn,0,s.value.length-1),pe[Bn]||0}function qe(Bn){return y8(pe,Bn)}let He=0,nt=0,rt=0;Pi(Q,(Bn,mn)=>{mn&&(pn(),Bn<mn&&requestAnimationFrame(()=>{nt=0,pn()}))});let ft=-1;function $t(){if(!G.value||!W.value)return;const Bn=G.value.scrollTop,mn=performance.now();mn-rt>500?(nt=Math.sign(Bn-He),Y=W.value.offsetTop):nt=Bn-He,He=Bn,rt=mn,window.clearTimeout(ft),ft=window.setTimeout(hn,500),pn()}function hn(){!G.value||!W.value||(nt=0,rt=0,window.clearTimeout(ft),pn())}let gn=-1;function pn(){cancelAnimationFrame(gn),gn=requestAnimationFrame(ri)}function ri(){if(!G.value||!Q.value)return;const Bn=He-Y,mn=Math.sign(nt),Nn=Math.max(0,Bn-B2),Pn=Ko(qe(Nn),0,s.value.length),Ci=Bn+Q.value+B2,Fi=Ko(qe(Ci)+1,Pn+1,s.value.length);if((mn!==g8||Pn<b.value)&&(mn!==_8||Fi>E.value)){const Ln=Ue(b.value)-Ue(Pn),sn=Ue(Fi)-Ue(E.value);Math.max(Ln,sn)>B2?(b.value=Pn,E.value=Fi):(Pn<=0&&(b.value=Pn),Fi>=s.value.length&&(E.value=Fi))}T.value=Ue(b.value),t.value=Ue(s.value.length)-Ue(E.value)}function ai(Bn){const mn=Ue(Bn);!G.value||Bn&&!mn?Ie=Bn:G.value.scrollTop=mn}const _n=Fe(()=>s.value.slice(b.value,E.value).map((Bn,mn)=>({raw:Bn,index:mn+b.value,key:q1(Bn)&&"value"in Bn?Bn.value:mn+b.value})));return Pi(s,()=>{ie=Array.from({length:s.value.length}),pe=Array.from({length:s.value.length}),Le.immediate(),pn()},{deep:!0}),{calculateVisibleItems:pn,containerRef:G,markerRef:W,computedItems:_n,paddingTop:T,paddingBottom:t,scrollToIndex:ai,handleScroll:$t,handleScrollend:hn,handleItemResize:Ve}}function y8(e,s){let u=e.length-1,d=0,b=0,E=null,T=-1;if(e[u]<s)return u;for(;d<=u;)if(b=d+u>>1,E=e[b],E>s)u=b-1;else if(E<s)T=b,d=b+1;else return E===s?b:d;return T}const v8=vn({items:{type:Array,default:()=>[]},renderless:Boolean,...lz(),...tr(),...hl()},"VVirtualScroll"),uw=Qn()({name:"VVirtualScroll",props:v8(),setup(e,s){let{slots:u}=s;const d=Po("VVirtualScroll"),{dimensionStyles:b}=dl(e),{calculateVisibleItems:E,containerRef:T,markerRef:t,handleScroll:G,handleScrollend:W,handleItemResize:Y,scrollToIndex:ne,paddingTop:J,paddingBottom:Q,computedItems:ce}=cz(e,$n(e,"items"));return Du(()=>e.renderless,()=>{function ie(){var Ie,$e;const be=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1)?"addEventListener":"removeEventListener";T.value===document.documentElement?(document[be]("scroll",G,{passive:!0}),document[be]("scrollend",W)):((Ie=T.value)==null||Ie[be]("scroll",G,{passive:!0}),($e=T.value)==null||$e[be]("scrollend",W))}Ua(()=>{T.value=CC(d.vnode.el,!0),ie(!0)}),nu(ie)}),fi(()=>{const ie=ce.value.map(pe=>de(oz,{key:pe.key,renderless:e.renderless,"onUpdate:height":be=>Y(pe.index,be)},{default:be=>{var Ie;return(Ie=u.default)==null?void 0:Ie.call(u,{item:pe.raw,index:pe.index,...be})}}));return e.renderless?de(sr,null,[de("div",{ref:t,class:"v-virtual-scroll__spacer",style:{paddingTop:Ji(J.value)}},null),ie,de("div",{class:"v-virtual-scroll__spacer",style:{paddingBottom:Ji(Q.value)}},null)]):de("div",{ref:T,class:["v-virtual-scroll",e.class],onScrollPassive:G,onScrollend:W,style:[b.value,e.style]},[de("div",{ref:t,class:"v-virtual-scroll__container",style:{paddingTop:Ji(J.value),paddingBottom:Ji(Q.value)}},[ie])])}),{calculateVisibleItems:E,scrollToIndex:ne}}});function HC(e,s){const u=Bi(!1);let d;function b(t){cancelAnimationFrame(d),u.value=!0,d=requestAnimationFrame(()=>{d=requestAnimationFrame(()=>{u.value=!1})})}async function E(){await new Promise(t=>requestAnimationFrame(t)),await new Promise(t=>requestAnimationFrame(t)),await new Promise(t=>requestAnimationFrame(t)),await new Promise(t=>{if(u.value){const G=Pi(u,()=>{G(),t()})}else t()})}async function T(t){var Y,ne;if(t.key==="Tab"&&((Y=s.value)==null||Y.focus()),!["PageDown","PageUp","Home","End"].includes(t.key))return;const G=(ne=e.value)==null?void 0:ne.$el;if(!G)return;(t.key==="Home"||t.key==="End")&&G.scrollTo({top:t.key==="Home"?0:G.scrollHeight,behavior:"smooth"}),await E();const W=G.querySelectorAll(":scope > :not(.v-virtual-scroll__spacer)");if(t.key==="PageDown"||t.key==="Home"){const J=G.getBoundingClientRect().top;for(const Q of W)if(Q.getBoundingClientRect().top>=J){Q.focus();break}}else{const J=G.getBoundingClientRect().bottom;for(const Q of[...W].reverse())if(Q.getBoundingClientRect().bottom<=J){Q.focus();break}}}return{onScrollPassive:b,onKeydown:T}}const ZC=vn({chips:Boolean,closableChips:Boolean,closeText:{type:String,default:"$vuetify.close"},openText:{type:String,default:"$vuetify.open"},eager:Boolean,hideNoData:Boolean,hideSelected:Boolean,listProps:{type:Object},menu:Boolean,menuIcon:{type:_r,default:"$dropdown"},menuProps:{type:Object},multiple:Boolean,noDataText:{type:String,default:"$vuetify.noDataText"},openOnClear:Boolean,itemColor:String,...YL({itemChildren:!1})},"Select"),x8=vn({...ZC(),...ul(cw({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...$f({transition:{component:Q1}})},"VSelect"),WC=Qn()({name:"VSelect",props:x8(),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,"update:menu":e=>!0},setup(e,s){let{slots:u}=s;const{t:d}=Uo(),b=yi(),E=yi(),T=yi(),t=mr(e,"menu"),G=Fe({get:()=>t.value,set:_n=>{var Bn;t.value&&!_n&&((Bn=E.value)!=null&&Bn.ΨopenChildren.size)||(t.value=_n)}}),{items:W,transformIn:Y,transformOut:ne}=NC(e),J=mr(e,"modelValue",[],_n=>Y(_n===null?[null]:po(_n)),_n=>{const Bn=ne(_n);return e.multiple?Bn:Bn[0]??null}),Q=Fe(()=>typeof e.counterValue=="function"?e.counterValue(J.value):typeof e.counterValue=="number"?e.counterValue:J.value.length),ce=sw(e),ie=Fe(()=>J.value.map(_n=>_n.value)),pe=Bi(!1),be=Fe(()=>G.value?e.closeText:e.openText);let Ie="",$e;const Le=Fe(()=>e.hideSelected?W.value.filter(_n=>!J.value.some(Bn=>e.valueComparator(Bn,_n))):W.value),Oe=Fe(()=>e.hideNoData&&!Le.value.length||ce.isReadonly.value||ce.isDisabled.value),Ve=Fe(()=>{var _n;return{...e.menuProps,activatorProps:{...((_n=e.menuProps)==null?void 0:_n.activatorProps)||{},"aria-haspopup":"listbox"}}}),Ue=yi(),qe=HC(Ue,b);function He(_n){e.openOnClear&&(G.value=!0)}function nt(){Oe.value||(G.value=!G.value)}function rt(_n){ov(_n)&&ft(_n)}function ft(_n){var Pn,Ci;if(!_n.key||ce.isReadonly.value)return;["Enter"," ","ArrowDown","ArrowUp","Home","End"].includes(_n.key)&&_n.preventDefault(),["Enter","ArrowDown"," "].includes(_n.key)&&(G.value=!0),["Escape","Tab"].includes(_n.key)&&(G.value=!1),_n.key==="Home"?(Pn=Ue.value)==null||Pn.focus("first"):_n.key==="End"&&((Ci=Ue.value)==null||Ci.focus("last"));const Bn=1e3;if(!ov(_n))return;const mn=performance.now();mn-$e>Bn&&(Ie=""),Ie+=_n.key.toLowerCase(),$e=mn;const Nn=W.value.find(Fi=>Fi.title.toLowerCase().startsWith(Ie));if(Nn!==void 0){J.value=[Nn];const Fi=Le.value.indexOf(Nn);qa&&window.requestAnimationFrame(()=>{var Ln;Fi>=0&&((Ln=T.value)==null||Ln.scrollToIndex(Fi))})}}function $t(_n){let Bn=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!_n.props.disabled)if(e.multiple){const mn=J.value.findIndex(Pn=>e.valueComparator(Pn.value,_n.value)),Nn=Bn??!~mn;if(~mn){const Pn=Nn?[...J.value,_n]:[...J.value];Pn.splice(mn,1),J.value=Pn}else Nn&&(J.value=[...J.value,_n])}else{const mn=Bn!==!1;J.value=mn?[_n]:[],Na(()=>{G.value=!1})}}function hn(_n){var Bn;(Bn=Ue.value)!=null&&Bn.$el.contains(_n.relatedTarget)||(G.value=!1)}function gn(){var _n;e.eager&&((_n=T.value)==null||_n.calculateVisibleItems())}function pn(){var _n;pe.value&&((_n=b.value)==null||_n.focus())}function ri(_n){pe.value=!0}function ai(_n){if(_n==null)J.value=[];else if(sv(b.value,":autofill")||sv(b.value,":-webkit-autofill")){const Bn=W.value.find(mn=>mn.title===_n);Bn&&$t(Bn)}else b.value&&(b.value.value="")}return Pi(G,()=>{if(!e.hideSelected&&G.value&&J.value.length){const _n=Le.value.findIndex(Bn=>J.value.some(mn=>e.valueComparator(mn.value,Bn.value)));qa&&window.requestAnimationFrame(()=>{var Bn;_n>=0&&((Bn=T.value)==null||Bn.scrollToIndex(_n))})}}),Pi(()=>e.items,(_n,Bn)=>{G.value||pe.value&&!Bn.length&&_n.length&&(G.value=!0)}),fi(()=>{const _n=!!(e.chips||u.chip),Bn=!!(!e.hideNoData||Le.value.length||u["prepend-item"]||u["append-item"]||u["no-data"]),mn=J.value.length>0,Nn=B_.filterProps(e),Pn=mn||!pe.value&&e.label&&!e.persistentPlaceholder?void 0:e.placeholder;return de(B_,oi({ref:b},Nn,{modelValue:J.value.map(Ci=>Ci.props.value).join(", "),"onUpdate:modelValue":ai,focused:pe.value,"onUpdate:focused":Ci=>pe.value=Ci,validationValue:J.externalValue,counterValue:Q.value,dirty:mn,class:["v-select",{"v-select--active-menu":G.value,"v-select--chips":!!e.chips,[`v-select--${e.multiple?"multiple":"single"}`]:!0,"v-select--selected":J.value.length,"v-select--selection-slot":!!u.selection},e.class],style:e.style,inputmode:"none",placeholder:Pn,"onClick:clear":He,"onMousedown:control":nt,onBlur:hn,onKeydown:ft,"aria-label":d(be.value),title:d(be.value)}),{...u,default:()=>de(sr,null,[de(hv,oi({ref:E,modelValue:G.value,"onUpdate:modelValue":Ci=>G.value=Ci,activator:"parent",contentClass:"v-select__content",disabled:Oe.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterEnter:gn,onAfterLeave:pn},Ve.value),{default:()=>[Bn&&de(ow,oi({ref:Ue,selected:ie.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:Ci=>Ci.preventDefault(),onKeydown:rt,onFocusin:ri,tabindex:"-1","aria-live":"polite",color:e.itemColor??e.color},qe,e.listProps),{default:()=>{var Ci,Fi,Ln;return[(Ci=u["prepend-item"])==null?void 0:Ci.call(u),!Le.value.length&&!e.hideNoData&&(((Fi=u["no-data"])==null?void 0:Fi.call(u))??de(km,{key:"no-data",title:d(e.noDataText)},null)),de(uw,{ref:T,renderless:!0,items:Le.value},{default:sn=>{var St;let{item:qn,index:pi,itemRef:ht}=sn;const Zn=oi(qn.props,{ref:ht,key:qn.value,onClick:()=>$t(qn,null)});return((St=u.item)==null?void 0:St.call(u,{item:qn,index:pi,props:Zn}))??de(km,oi(Zn,{role:"option"}),{prepend:mt=>{let{isSelected:at}=mt;return de(sr,null,[e.multiple&&!e.hideSelected?de(Am,{key:qn.value,modelValue:at,ripple:!1,tabindex:"-1"},null):void 0,qn.props.prependAvatar&&de(Vd,{image:qn.props.prependAvatar},null),qn.props.prependIcon&&de(Ka,{icon:qn.props.prependIcon},null)])}})}}),(Ln=u["append-item"])==null?void 0:Ln.call(u)]}})]}),J.value.map((Ci,Fi)=>{function Ln(ht){ht.stopPropagation(),ht.preventDefault(),$t(Ci,!1)}const sn={"onClick:close":Ln,onKeydown(ht){ht.key!=="Enter"&&ht.key!==" "||(ht.preventDefault(),ht.stopPropagation(),Ln(ht))},onMousedown(ht){ht.preventDefault(),ht.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},qn=_n?!!u.chip:!!u.selection,pi=qn?X1(_n?u.chip({item:Ci,index:Fi,props:sn}):u.selection({item:Ci,index:Fi})):void 0;if(!(qn&&!pi))return de("div",{key:Ci.value,class:"v-select__selection"},[_n?u.chip?de(da,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:Ci.title}}},{default:()=>[pi]}):de(xv,oi({key:"chip",closable:e.closableChips,size:"small",text:Ci.title,disabled:Ci.props.disabled},sn),null):pi??de("span",{class:"v-select__selection-text"},[Ci.title,e.multiple&&Fi<J.value.length-1&&de("span",{class:"v-select__selection-comma"},[Kc(",")])])])})]),"append-inner":function(){var sn;for(var Ci=arguments.length,Fi=new Array(Ci),Ln=0;Ln<Ci;Ln++)Fi[Ln]=arguments[Ln];return de(sr,null,[(sn=u["append-inner"])==null?void 0:sn.call(u,...Fi),e.menuIcon?de(Ka,{class:"v-select__menu-icon",icon:e.menuIcon},null):void 0])}})}),$d({isFocused:pe,menu:G,select:$t},b)}}),b8=(e,s,u)=>e==null||s==null?-1:e.toString().toLocaleLowerCase().indexOf(s.toString().toLocaleLowerCase()),Cb=vn({customFilter:Function,customKeyFilter:Object,filterKeys:[Array,String],filterMode:{type:String,default:"intersection"},noFilter:Boolean},"filter");function w8(e,s,u){var t;const d=[],b=(u==null?void 0:u.default)??b8,E=u!=null&&u.filterKeys?po(u.filterKeys):!1,T=Object.keys((u==null?void 0:u.customKeyFilter)??{}).length;if(!(e!=null&&e.length))return d;e:for(let G=0;G<e.length;G++){const[W,Y=W]=po(e[G]),ne={},J={};let Q=-1;if((s||T>0)&&!(u!=null&&u.noFilter)){if(typeof W=="object"){const pe=E||Object.keys(Y);for(const be of pe){const Ie=Sl(Y,be),$e=(t=u==null?void 0:u.customKeyFilter)==null?void 0:t[be];if(Q=$e?$e(Ie,s,W):b(Ie,s,W),Q!==-1&&Q!==!1)$e?ne[be]=Q:J[be]=Q;else if((u==null?void 0:u.filterMode)==="every")continue e}}else Q=b(W,s,W),Q!==-1&&Q!==!1&&(J.title=Q);const ce=Object.keys(J).length,ie=Object.keys(ne).length;if(!ce&&!ie||(u==null?void 0:u.filterMode)==="union"&&ie!==T&&!ce||(u==null?void 0:u.filterMode)==="intersection"&&(ie!==T||!ce))continue}d.push({index:G,matches:{...J,...ne}})}return d}function Eb(e,s,u,d){const b=Bi([]),E=Bi(new Map),T=Fe(()=>d!=null&&d.transform?Ps(s).map(G=>[G,d.transform(G)]):Ps(s));Jo(()=>{const G=typeof u=="function"?u():Ps(u),W=typeof G!="string"&&typeof G!="number"?"":String(G),Y=w8(T.value,W,{customKeyFilter:{...e.customKeyFilter,...Ps(d==null?void 0:d.customKeyFilter)},default:e.customFilter,filterKeys:e.filterKeys,filterMode:e.filterMode,noFilter:e.noFilter}),ne=Ps(s),J=[],Q=new Map;Y.forEach(ce=>{let{index:ie,matches:pe}=ce;const be=ne[ie];J.push(be),Q.set(be.value,pe)}),b.value=J,E.value=Q});function t(G){return E.value.get(G.value)}return{filteredItems:b,filteredMatches:E,getMatches:t}}function S8(e,s,u){if(s==null)return e;if(Array.isArray(s))throw new Error("Multiple matches is not implemented");return typeof s=="number"&&~s?de(sr,null,[de("span",{class:"v-autocomplete__unmask"},[e.substr(0,s)]),de("span",{class:"v-autocomplete__mask"},[e.substr(s,u)]),de("span",{class:"v-autocomplete__unmask"},[e.substr(s+u)])]):e}const T8=vn({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:Boolean,search:String,...Cb({filterKeys:["title"]}),...ZC(),...ul(cw({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...$f({transition:!1})},"VAutocomplete"),C8=Qn()({name:"VAutocomplete",props:T8(),emits:{"update:focused":e=>!0,"update:search":e=>!0,"update:modelValue":e=>!0,"update:menu":e=>!0},setup(e,s){let{slots:u}=s;const{t:d}=Uo(),b=yi(),E=Bi(!1),T=Bi(!0),t=Bi(!1),G=yi(),W=yi(),Y=mr(e,"menu"),ne=Fe({get:()=>Y.value,set:Zn=>{var St;Y.value&&!Zn&&((St=G.value)!=null&&St.ΨopenChildren.size)||(Y.value=Zn)}}),J=Bi(-1),Q=Fe(()=>{var Zn;return(Zn=b.value)==null?void 0:Zn.color}),ce=Fe(()=>ne.value?e.closeText:e.openText),{items:ie,transformIn:pe,transformOut:be}=NC(e),{textColorClasses:Ie,textColorStyles:$e}=Dc(Q),Le=mr(e,"search",""),Oe=mr(e,"modelValue",[],Zn=>pe(Zn===null?[null]:po(Zn)),Zn=>{const St=be(Zn);return e.multiple?St:St[0]??null}),Ve=Fe(()=>typeof e.counterValue=="function"?e.counterValue(Oe.value):typeof e.counterValue=="number"?e.counterValue:Oe.value.length),Ue=sw(e),{filteredItems:qe,getMatches:He}=Eb(e,ie,()=>T.value?"":Le.value),nt=Fe(()=>e.hideSelected?qe.value.filter(Zn=>!Oe.value.some(St=>St.value===Zn.value)):qe.value),rt=Fe(()=>!!(e.chips||u.chip)),ft=Fe(()=>rt.value||!!u.selection),$t=Fe(()=>Oe.value.map(Zn=>Zn.props.value)),hn=Fe(()=>{var St;return(e.autoSelectFirst===!0||e.autoSelectFirst==="exact"&&Le.value===((St=nt.value[0])==null?void 0:St.title))&&nt.value.length>0&&!T.value&&!t.value}),gn=Fe(()=>e.hideNoData&&!nt.value.length||Ue.isReadonly.value||Ue.isDisabled.value),pn=yi(),ri=HC(pn,b);function ai(Zn){e.openOnClear&&(ne.value=!0),Le.value=""}function _n(){gn.value||(ne.value=!0)}function Bn(Zn){gn.value||(E.value&&(Zn.preventDefault(),Zn.stopPropagation()),ne.value=!ne.value)}function mn(Zn){var St;Zn.key!==" "&&ov(Zn)&&((St=b.value)==null||St.focus())}function Nn(Zn){var at,Tn,bn;if(Ue.isReadonly.value)return;const St=b.value.selectionStart,mt=Oe.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(Zn.key)&&Zn.preventDefault(),["Enter","ArrowDown"].includes(Zn.key)&&(ne.value=!0),["Escape"].includes(Zn.key)&&(ne.value=!1),hn.value&&["Enter","Tab"].includes(Zn.key)&&!Oe.value.some(Cn=>{let{value:zn}=Cn;return zn===nt.value[0].value})&&ht(nt.value[0]),Zn.key==="ArrowDown"&&hn.value&&((at=pn.value)==null||at.focus("next")),["Backspace","Delete"].includes(Zn.key)){if(!e.multiple&&ft.value&&Oe.value.length>0&&!Le.value)return ht(Oe.value[0],!1);if(~J.value){Zn.preventDefault();const Cn=J.value;ht(Oe.value[J.value],!1),J.value=Cn>=mt-1?mt-2:Cn}else Zn.key==="Backspace"&&!Le.value&&(J.value=mt-1);return}if(e.multiple)if(Zn.key==="ArrowLeft"){if(J.value<0&&St>0)return;const Cn=J.value>-1?J.value-1:mt-1;Oe.value[Cn]?J.value=Cn:(J.value=-1,b.value.setSelectionRange((Tn=Le.value)==null?void 0:Tn.length,(bn=Le.value)==null?void 0:bn.length))}else if(Zn.key==="ArrowRight"){if(J.value<0)return;const Cn=J.value+1;Oe.value[Cn]?J.value=Cn:(J.value=-1,b.value.setSelectionRange(0,0))}else~J.value&&ov(Zn)&&(J.value=-1)}function Pn(Zn){if(sv(b.value,":autofill")||sv(b.value,":-webkit-autofill")){const St=ie.value.find(mt=>mt.title===Zn.target.value);St&&ht(St)}}function Ci(){var Zn;e.eager&&((Zn=W.value)==null||Zn.calculateVisibleItems())}function Fi(){var Zn;E.value&&(T.value=!0,(Zn=b.value)==null||Zn.focus())}function Ln(Zn){E.value=!0,setTimeout(()=>{t.value=!0})}function sn(Zn){t.value=!1}function qn(Zn){(Zn==null||Zn===""&&!e.multiple&&!ft.value)&&(Oe.value=[])}const pi=Bi(!1);function ht(Zn){let St=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!Zn||Zn.props.disabled))if(e.multiple){const mt=Oe.value.findIndex(Tn=>e.valueComparator(Tn.value,Zn.value)),at=St??!~mt;if(~mt){const Tn=at?[...Oe.value,Zn]:[...Oe.value];Tn.splice(mt,1),Oe.value=Tn}else at&&(Oe.value=[...Oe.value,Zn]);e.clearOnSelect&&(Le.value="")}else{const mt=St!==!1;Oe.value=mt?[Zn]:[],Le.value=mt&&!ft.value?Zn.title:"",Na(()=>{ne.value=!1,T.value=!0})}}return Pi(E,(Zn,St)=>{var mt;Zn!==St&&(Zn?(pi.value=!0,Le.value=e.multiple||ft.value?"":String(((mt=Oe.value.at(-1))==null?void 0:mt.props.title)??""),T.value=!0,Na(()=>pi.value=!1)):(!e.multiple&&Le.value==null&&(Oe.value=[]),ne.value=!1,Oe.value.some(at=>{let{title:Tn}=at;return Tn===Le.value})||(Le.value=""),J.value=-1))}),Pi(Le,Zn=>{!E.value||pi.value||(Zn&&(ne.value=!0),T.value=!Zn)}),Pi(ne,()=>{if(!e.hideSelected&&ne.value&&Oe.value.length){const Zn=nt.value.findIndex(St=>Oe.value.some(mt=>St.value===mt.value));qa&&window.requestAnimationFrame(()=>{var St;Zn>=0&&((St=W.value)==null||St.scrollToIndex(Zn))})}}),Pi(()=>e.items,(Zn,St)=>{ne.value||E.value&&!St.length&&Zn.length&&(ne.value=!0)}),fi(()=>{const Zn=!!(!e.hideNoData||nt.value.length||u["prepend-item"]||u["append-item"]||u["no-data"]),St=Oe.value.length>0,mt=B_.filterProps(e);return de(B_,oi({ref:b},mt,{modelValue:Le.value,"onUpdate:modelValue":[at=>Le.value=at,qn],focused:E.value,"onUpdate:focused":at=>E.value=at,validationValue:Oe.externalValue,counterValue:Ve.value,dirty:St,onChange:Pn,class:["v-autocomplete",`v-autocomplete--${e.multiple?"multiple":"single"}`,{"v-autocomplete--active-menu":ne.value,"v-autocomplete--chips":!!e.chips,"v-autocomplete--selection-slot":!!ft.value,"v-autocomplete--selecting-index":J.value>-1},e.class],style:e.style,readonly:Ue.isReadonly.value,placeholder:St?void 0:e.placeholder,"onClick:clear":ai,"onMousedown:control":_n,onKeydown:Nn}),{...u,default:()=>de(sr,null,[de(hv,oi({ref:G,modelValue:ne.value,"onUpdate:modelValue":at=>ne.value=at,activator:"parent",contentClass:"v-autocomplete__content",disabled:gn.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterEnter:Ci,onAfterLeave:Fi},e.menuProps),{default:()=>[Zn&&de(ow,oi({ref:pn,selected:$t.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:at=>at.preventDefault(),onKeydown:mn,onFocusin:Ln,onFocusout:sn,tabindex:"-1","aria-live":"polite",color:e.itemColor??e.color},ri,e.listProps),{default:()=>{var at,Tn,bn;return[(at=u["prepend-item"])==null?void 0:at.call(u),!nt.value.length&&!e.hideNoData&&(((Tn=u["no-data"])==null?void 0:Tn.call(u))??de(km,{key:"no-data",title:d(e.noDataText)},null)),de(uw,{ref:W,renderless:!0,items:nt.value},{default:Cn=>{var Ki;let{item:zn,index:vi,itemRef:ii}=Cn;const wi=oi(zn.props,{ref:ii,key:zn.value,active:hn.value&&vi===0?!0:void 0,onClick:()=>ht(zn,null)});return((Ki=u.item)==null?void 0:Ki.call(u,{item:zn,index:vi,props:wi}))??de(km,oi(wi,{role:"option"}),{prepend:Vi=>{let{isSelected:ui}=Vi;return de(sr,null,[e.multiple&&!e.hideSelected?de(Am,{key:zn.value,modelValue:ui,ripple:!1,tabindex:"-1"},null):void 0,zn.props.prependAvatar&&de(Vd,{image:zn.props.prependAvatar},null),zn.props.prependIcon&&de(Ka,{icon:zn.props.prependIcon},null)])},title:()=>{var Vi,ui;return T.value?zn.title:S8(zn.title,(Vi=He(zn))==null?void 0:Vi.title,((ui=Le.value)==null?void 0:ui.length)??0)}})}}),(bn=u["append-item"])==null?void 0:bn.call(u)]}})]}),Oe.value.map((at,Tn)=>{function bn(ii){ii.stopPropagation(),ii.preventDefault(),ht(at,!1)}const Cn={"onClick:close":bn,onKeydown(ii){ii.key!=="Enter"&&ii.key!==" "||(ii.preventDefault(),ii.stopPropagation(),bn(ii))},onMousedown(ii){ii.preventDefault(),ii.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},zn=rt.value?!!u.chip:!!u.selection,vi=zn?X1(rt.value?u.chip({item:at,index:Tn,props:Cn}):u.selection({item:at,index:Tn})):void 0;if(!(zn&&!vi))return de("div",{key:at.value,class:["v-autocomplete__selection",Tn===J.value&&["v-autocomplete__selection--selected",Ie.value]],style:Tn===J.value?$e.value:{}},[rt.value?u.chip?de(da,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:at.title}}},{default:()=>[vi]}):de(xv,oi({key:"chip",closable:e.closableChips,size:"small",text:at.title,disabled:at.props.disabled},Cn),null):vi??de("span",{class:"v-autocomplete__selection-text"},[at.title,e.multiple&&Tn<Oe.value.length-1&&de("span",{class:"v-autocomplete__selection-comma"},[Kc(",")])])])})]),"append-inner":function(){var Cn;for(var at=arguments.length,Tn=new Array(at),bn=0;bn<at;bn++)Tn[bn]=arguments[bn];return de(sr,null,[(Cn=u["append-inner"])==null?void 0:Cn.call(u,...Tn),e.menuIcon?de(Ka,{class:"v-autocomplete__menu-icon",icon:e.menuIcon,onMousedown:Bn,onClick:kR,"aria-label":d(ce.value),title:d(ce.value),tabindex:"-1"},null):void 0])}})}),$d({isFocused:E,isPristine:T,menu:ne,search:Le,filteredItems:qe,select:ht},b)}}),E8=vn({bordered:Boolean,color:String,content:[Number,String],dot:Boolean,floating:Boolean,icon:_r,inline:Boolean,label:{type:String,default:"$vuetify.badge"},max:[Number,String],modelValue:{type:Boolean,default:!0},offsetX:[Number,String],offsetY:[Number,String],textColor:String,...tr(),...Lm({location:"top end"}),...Qs(),...ia(),...Da(),...$f({transition:"scale-rotate-transition"})},"VBadge"),M8=Qn()({name:"VBadge",inheritAttrs:!1,props:E8(),setup(e,s){const{backgroundColorClasses:u,backgroundColorStyles:d}=Ms($n(e,"color")),{roundedClasses:b}=Ao(e),{t:E}=Uo(),{textColorClasses:T,textColorStyles:t}=Dc($n(e,"textColor")),{themeClasses:G}=nL(),{locationStyles:W}=ny(e,!0,Y=>(e.floating?e.dot?2:4:e.dot?8:12)+(["top","bottom"].includes(Y)?+(e.offsetY??0):["left","right"].includes(Y)?+(e.offsetX??0):0));return fi(()=>{const Y=Number(e.content),ne=!e.max||isNaN(Y)?e.content:Y<=+e.max?Y:`${e.max}+`,[J,Q]=aT(s.attrs,["aria-atomic","aria-label","aria-live","role","title"]);return de(e.tag,oi({class:["v-badge",{"v-badge--bordered":e.bordered,"v-badge--dot":e.dot,"v-badge--floating":e.floating,"v-badge--inline":e.inline},e.class]},Q,{style:e.style}),{default:()=>{var ce,ie;return[de("div",{class:"v-badge__wrapper"},[(ie=(ce=s.slots).default)==null?void 0:ie.call(ce),de(eu,{transition:e.transition},{default:()=>{var pe,be;return[Js(de("span",oi({class:["v-badge__badge",G.value,u.value,b.value,T.value],style:[d.value,t.value,e.inline?{}:W.value],"aria-atomic":"true","aria-label":E(e.label,Y),"aria-live":"polite",role:"status"},J),[e.dot?void 0:s.slots.badge?(be=(pe=s.slots).badge)==null?void 0:be.call(pe):e.icon?de(Ka,{icon:e.icon},null):ne]),[[Nd,e.modelValue]])]}})])]}})}),{}}}),I8=vn({color:String,density:String,...tr()},"VBannerActions"),uz=Qn()({name:"VBannerActions",props:I8(),setup(e,s){let{slots:u}=s;return Io({VBtn:{color:e.color,density:e.density,slim:!0,variant:"text"}}),fi(()=>{var d;return de("div",{class:["v-banner-actions",e.class],style:e.style},[(d=u.default)==null?void 0:d.call(u)])}),{}}}),hz=Hp("v-banner-text"),P8=vn({avatar:String,bgColor:String,color:String,icon:_r,lines:String,stacked:Boolean,sticky:Boolean,text:String,...gh(),...tr(),...Hl(),...hl(),...W_({mobile:null}),...El(),...Lm(),..._v(),...Qs(),...ia(),...Da()},"VBanner"),A8=Qn()({name:"VBanner",props:P8(),setup(e,s){let{slots:u}=s;const{backgroundColorClasses:d,backgroundColorStyles:b}=Ms(e,"bgColor"),{borderClasses:E}=Wh(e),{densityClasses:T}=iu(e),{displayClasses:t,mobile:G}=jd(e),{dimensionStyles:W}=dl(e),{elevationClasses:Y}=hc(e),{locationStyles:ne}=ny(e),{positionClasses:J}=yv(e),{roundedClasses:Q}=Ao(e),{themeClasses:ce}=Ja(e),ie=$n(e,"color"),pe=$n(e,"density");Io({VBannerActions:{color:ie,density:pe}}),fi(()=>{const be=!!(e.text||u.text),Ie=!!(e.avatar||e.icon),$e=!!(Ie||u.prepend);return de(e.tag,{class:["v-banner",{"v-banner--stacked":e.stacked||G.value,"v-banner--sticky":e.sticky,[`v-banner--${e.lines}-line`]:!!e.lines},ce.value,d.value,E.value,T.value,t.value,Y.value,J.value,Q.value,e.class],style:[b.value,W.value,ne.value,e.style],role:"banner"},{default:()=>{var Le;return[$e&&de("div",{key:"prepend",class:"v-banner__prepend"},[u.prepend?de(da,{key:"prepend-defaults",disabled:!Ie,defaults:{VAvatar:{color:ie.value,density:pe.value,icon:e.icon,image:e.avatar}}},u.prepend):de(Vd,{key:"prepend-avatar",color:ie.value,density:pe.value,icon:e.icon,image:e.avatar},null)]),de("div",{class:"v-banner__content"},[be&&de(hz,{key:"text"},{default:()=>{var Oe;return[((Oe=u.text)==null?void 0:Oe.call(u))??e.text]}}),(Le=u.default)==null?void 0:Le.call(u)]),u.actions&&de(uz,{key:"actions"},u.actions)]}})})}}),k8=vn({baseColor:String,bgColor:String,color:String,grow:Boolean,mode:{type:String,validator:e=>!e||["horizontal","shift"].includes(e)},height:{type:[Number,String],default:56},active:{type:Boolean,default:!0},...gh(),...tr(),...Hl(),...El(),...Qs(),...X_({name:"bottom-navigation"}),...ia({tag:"header"}),...Q_({selectedClass:"v-btn--selected"}),...Da()},"VBottomNavigation"),D8=Qn()({name:"VBottomNavigation",props:k8(),emits:{"update:active":e=>!0,"update:modelValue":e=>!0},setup(e,s){let{slots:u}=s;const{themeClasses:d}=nL(),{borderClasses:b}=Wh(e),{backgroundColorClasses:E,backgroundColorStyles:T}=Ms($n(e,"bgColor")),{densityClasses:t}=iu(e),{elevationClasses:G}=hc(e),{roundedClasses:W}=Ao(e),{ssrBootStyles:Y}=K_(),ne=Fe(()=>Number(e.height)-(e.density==="comfortable"?8:0)-(e.density==="compact"?16:0)),J=mr(e,"active",e.active),{layoutItemStyles:Q}=Y_({id:e.name,order:Fe(()=>parseInt(e.order,10)),position:Fe(()=>"bottom"),layoutSize:Fe(()=>J.value?ne.value:0),elementSize:ne,active:J,absolute:$n(e,"absolute")});return Bg(e,zC),Io({VBtn:{baseColor:$n(e,"baseColor"),color:$n(e,"color"),density:$n(e,"density"),stacked:Fe(()=>e.mode!=="horizontal"),variant:"text"}},{scoped:!0}),fi(()=>de(e.tag,{class:["v-bottom-navigation",{"v-bottom-navigation--active":J.value,"v-bottom-navigation--grow":e.grow,"v-bottom-navigation--shift":e.mode==="shift"},d.value,E.value,b.value,t.value,G.value,W.value,e.class],style:[T.value,Q.value,{height:Ji(ne.value)},Y.value,e.style]},{default:()=>[u.default&&de("div",{class:"v-bottom-navigation__content"},[u.default()])]})),{}}}),dz=vn({fullscreen:Boolean,retainFocus:{type:Boolean,default:!0},scrollable:Boolean,...Sb({origin:"center center",scrollStrategy:"block",transition:{component:Q1},zIndex:2400})},"VDialog"),TT=Qn()({name:"VDialog",props:dz(),emits:{"update:modelValue":e=>!0,afterEnter:()=>!0,afterLeave:()=>!0},setup(e,s){let{emit:u,slots:d}=s;const b=mr(e,"modelValue"),{scopeId:E}=iy(),T=yi();function t(Y){var Q,ce;const ne=Y.relatedTarget,J=Y.target;if(ne!==J&&((Q=T.value)!=null&&Q.contentEl)&&((ce=T.value)!=null&&ce.globalTop)&&![document,T.value.contentEl].includes(J)&&!T.value.contentEl.contains(J)){const ie=Jx(T.value.contentEl);if(!ie.length)return;const pe=ie[0],be=ie[ie.length-1];ne===pe?be.focus():pe.focus()}}ql(()=>{document.removeEventListener("focusin",t)}),qa&&Pi(()=>b.value&&e.retainFocus,Y=>{Y?document.addEventListener("focusin",t):document.removeEventListener("focusin",t)},{immediate:!0});function G(){var Y;u("afterEnter"),(Y=T.value)!=null&&Y.contentEl&&!T.value.contentEl.contains(document.activeElement)&&T.value.contentEl.focus({preventScroll:!0})}function W(){u("afterLeave")}return Pi(b,async Y=>{var ne;Y||(await Na(),(ne=T.value.activatorEl)==null||ne.focus({preventScroll:!0}))}),fi(()=>{const Y=jp.filterProps(e),ne=oi({"aria-haspopup":"dialog"},e.activatorProps),J=oi({tabindex:-1},e.contentProps);return de(jp,oi({ref:T,class:["v-dialog",{"v-dialog--fullscreen":e.fullscreen,"v-dialog--scrollable":e.scrollable},e.class],style:e.style},Y,{modelValue:b.value,"onUpdate:modelValue":Q=>b.value=Q,"aria-modal":"true",activatorProps:ne,contentProps:J,height:e.fullscreen?void 0:e.height,width:e.fullscreen?void 0:e.width,maxHeight:e.fullscreen?void 0:e.maxHeight,maxWidth:e.fullscreen?void 0:e.maxWidth,role:"dialog",onAfterEnter:G,onAfterLeave:W},E),{activator:d.activator,default:function(){for(var Q=arguments.length,ce=new Array(Q),ie=0;ie<Q;ie++)ce[ie]=arguments[ie];return de(da,{root:"VDialog"},{default:()=>{var pe;return[(pe=d.default)==null?void 0:pe.call(d,...ce)]}})}})}),$d({},T)}}),R8=vn({inset:Boolean,...dz({transition:"bottom-sheet-transition"})},"VBottomSheet"),L8=Qn()({name:"VBottomSheet",props:R8(),emits:{"update:modelValue":e=>!0},setup(e,s){let{slots:u}=s;const d=mr(e,"modelValue");return fi(()=>{const b=TT.filterProps(e);return de(TT,oi(b,{contentClass:["v-bottom-sheet__content",e.contentClass],modelValue:d.value,"onUpdate:modelValue":E=>d.value=E,class:["v-bottom-sheet",{"v-bottom-sheet--inset":e.inset},e.class],style:e.style}),u)}),{}}}),z8=vn({divider:[Number,String],...tr()},"VBreadcrumbsDivider"),fz=Qn()({name:"VBreadcrumbsDivider",props:z8(),setup(e,s){let{slots:u}=s;return fi(()=>{var d;return de("li",{"aria-hidden":"true",class:["v-breadcrumbs-divider",e.class],style:e.style},[((d=u==null?void 0:u.default)==null?void 0:d.call(u))??e.divider])}),{}}}),O8=vn({active:Boolean,activeClass:String,activeColor:String,color:String,disabled:Boolean,title:String,...tr(),...xb(),...ia({tag:"li"})},"VBreadcrumbsItem"),pz=Qn()({name:"VBreadcrumbsItem",props:O8(),setup(e,s){let{slots:u,attrs:d}=s;const b=vb(e,d),E=Fe(()=>{var W;return e.active||((W=b.isActive)==null?void 0:W.value)}),T=Fe(()=>E.value?e.activeColor:e.color),{textColorClasses:t,textColorStyles:G}=Dc(T);return fi(()=>de(e.tag,{class:["v-breadcrumbs-item",{"v-breadcrumbs-item--active":E.value,"v-breadcrumbs-item--disabled":e.disabled,[`${e.activeClass}`]:E.value&&e.activeClass},t.value,e.class],style:[G.value,e.style],"aria-current":E.value?"page":void 0},{default:()=>{var W,Y;return[b.isLink.value?de("a",oi({class:"v-breadcrumbs-item--link",onClick:b.navigate},b.linkProps),[((Y=u.default)==null?void 0:Y.call(u))??e.title]):((W=u.default)==null?void 0:W.call(u))??e.title]}})),{}}}),F8=vn({activeClass:String,activeColor:String,bgColor:String,color:String,disabled:Boolean,divider:{type:String,default:"/"},icon:_r,items:{type:Array,default:()=>[]},...tr(),...Hl(),...Qs(),...ia({tag:"ul"})},"VBreadcrumbs"),B8=Qn()({name:"VBreadcrumbs",props:F8(),setup(e,s){let{slots:u}=s;const{backgroundColorClasses:d,backgroundColorStyles:b}=Ms($n(e,"bgColor")),{densityClasses:E}=iu(e),{roundedClasses:T}=Ao(e);Io({VBreadcrumbsDivider:{divider:$n(e,"divider")},VBreadcrumbsItem:{activeClass:$n(e,"activeClass"),activeColor:$n(e,"activeColor"),color:$n(e,"color"),disabled:$n(e,"disabled")}});const t=Fe(()=>e.items.map(G=>typeof G=="string"?{item:{title:G},raw:G}:{item:G,raw:G}));return fi(()=>{const G=!!(u.prepend||e.icon);return de(e.tag,{class:["v-breadcrumbs",d.value,E.value,T.value,e.class],style:[b.value,e.style]},{default:()=>{var W;return[G&&de("li",{key:"prepend",class:"v-breadcrumbs__prepend"},[u.prepend?de(da,{key:"prepend-defaults",disabled:!e.icon,defaults:{VIcon:{icon:e.icon,start:!0}}},u.prepend):de(Ka,{key:"prepend-icon",start:!0,icon:e.icon},null)]),t.value.map((Y,ne,J)=>{var ie;let{item:Q,raw:ce}=Y;return de(sr,null,[((ie=u.item)==null?void 0:ie.call(u,{item:Q,index:ne}))??de(pz,oi({key:ne,disabled:ne>=J.length-1},typeof Q=="string"?{title:Q}:Q),{default:u.title?()=>{var pe;return(pe=u.title)==null?void 0:pe.call(u,{item:Q,index:ne})}:void 0}),ne<J.length-1&&de(fz,null,{default:u.divider?()=>{var pe;return(pe=u.divider)==null?void 0:pe.call(u,{item:ce,index:ne})}:void 0})])}),(W=u.default)==null?void 0:W.call(u)]}})}),{}}}),mz=Qn()({name:"VCardActions",props:tr(),setup(e,s){let{slots:u}=s;return Io({VBtn:{slim:!0,variant:"text"}}),fi(()=>{var d;return de("div",{class:["v-card-actions",e.class],style:e.style},[(d=u.default)==null?void 0:d.call(u)])}),{}}}),V8=vn({opacity:[Number,String],...tr(),...ia()},"VCardSubtitle"),gz=Qn()({name:"VCardSubtitle",props:V8(),setup(e,s){let{slots:u}=s;return fi(()=>de(e.tag,{class:["v-card-subtitle",e.class],style:[{"--v-card-subtitle-opacity":e.opacity},e.style]},u)),{}}}),_z=Hp("v-card-title"),N8=vn({appendAvatar:String,appendIcon:_r,prependAvatar:String,prependIcon:_r,subtitle:[String,Number],title:[String,Number],...tr(),...Hl()},"VCardItem"),yz=Qn()({name:"VCardItem",props:N8(),setup(e,s){let{slots:u}=s;return fi(()=>{var W;const d=!!(e.prependAvatar||e.prependIcon),b=!!(d||u.prepend),E=!!(e.appendAvatar||e.appendIcon),T=!!(E||u.append),t=!!(e.title!=null||u.title),G=!!(e.subtitle!=null||u.subtitle);return de("div",{class:["v-card-item",e.class],style:e.style},[b&&de("div",{key:"prepend",class:"v-card-item__prepend"},[u.prepend?de(da,{key:"prepend-defaults",disabled:!d,defaults:{VAvatar:{density:e.density,image:e.prependAvatar},VIcon:{density:e.density,icon:e.prependIcon}}},u.prepend):de(sr,null,[e.prependAvatar&&de(Vd,{key:"prepend-avatar",density:e.density,image:e.prependAvatar},null),e.prependIcon&&de(Ka,{key:"prepend-icon",density:e.density,icon:e.prependIcon},null)])]),de("div",{class:"v-card-item__content"},[t&&de(_z,{key:"title"},{default:()=>{var Y;return[((Y=u.title)==null?void 0:Y.call(u))??e.title]}}),G&&de(gz,{key:"subtitle"},{default:()=>{var Y;return[((Y=u.subtitle)==null?void 0:Y.call(u))??e.subtitle]}}),(W=u.default)==null?void 0:W.call(u)]),T&&de("div",{key:"append",class:"v-card-item__append"},[u.append?de(da,{key:"append-defaults",disabled:!E,defaults:{VAvatar:{density:e.density,image:e.appendAvatar},VIcon:{density:e.density,icon:e.appendIcon}}},u.append):de(sr,null,[e.appendIcon&&de(Ka,{key:"append-icon",density:e.density,icon:e.appendIcon},null),e.appendAvatar&&de(Vd,{key:"append-avatar",density:e.density,image:e.appendAvatar},null)])])])}),{}}}),j8=vn({opacity:[Number,String],...tr(),...ia()},"VCardText"),vz=Qn()({name:"VCardText",props:j8(),setup(e,s){let{slots:u}=s;return fi(()=>de(e.tag,{class:["v-card-text",e.class],style:[{"--v-card-text-opacity":e.opacity},e.style]},u)),{}}}),U8=vn({appendAvatar:String,appendIcon:_r,disabled:Boolean,flat:Boolean,hover:Boolean,image:String,link:{type:Boolean,default:void 0},prependAvatar:String,prependIcon:_r,ripple:{type:[Boolean,Object],default:!0},subtitle:[String,Number],text:[String,Number],title:[String,Number],...gh(),...tr(),...Hl(),...hl(),...El(),...iw(),...Lm(),..._v(),...Qs(),...xb(),...ia(),...Da(),...Ud({variant:"elevated"})},"VCard"),$8=Qn()({name:"VCard",directives:{Ripple:zm},props:U8(),setup(e,s){let{attrs:u,slots:d}=s;const{themeClasses:b}=Ja(e),{borderClasses:E}=Wh(e),{colorClasses:T,colorStyles:t,variantClasses:G}=J_(e),{densityClasses:W}=iu(e),{dimensionStyles:Y}=dl(e),{elevationClasses:ne}=hc(e),{loaderClasses:J}=_b(e),{locationStyles:Q}=ny(e),{positionClasses:ce}=yv(e),{roundedClasses:ie}=Ao(e),pe=vb(e,u),be=Fe(()=>e.link!==!1&&pe.isLink.value),Ie=Fe(()=>!e.disabled&&e.link!==!1&&(e.link||pe.isClickable.value));return fi(()=>{const $e=be.value?"a":e.tag,Le=!!(d.title||e.title!=null),Oe=!!(d.subtitle||e.subtitle!=null),Ve=Le||Oe,Ue=!!(d.append||e.appendAvatar||e.appendIcon),qe=!!(d.prepend||e.prependAvatar||e.prependIcon),He=!!(d.image||e.image),nt=Ve||qe||Ue,rt=!!(d.text||e.text!=null);return Js(de($e,oi({class:["v-card",{"v-card--disabled":e.disabled,"v-card--flat":e.flat,"v-card--hover":e.hover&&!(e.disabled||e.flat),"v-card--link":Ie.value},b.value,E.value,T.value,W.value,ne.value,J.value,ce.value,ie.value,G.value,e.class],style:[t.value,Y.value,Q.value,e.style],onClick:Ie.value&&pe.navigate,tabindex:e.disabled?-1:void 0},pe.linkProps),{default:()=>{var ft;return[He&&de("div",{key:"image",class:"v-card__image"},[d.image?de(da,{key:"image-defaults",disabled:!e.image,defaults:{VImg:{cover:!0,src:e.image}}},d.image):de(Pm,{key:"image-img",cover:!0,src:e.image},null)]),de(yb,{name:"v-card",active:!!e.loading,color:typeof e.loading=="boolean"?void 0:e.loading},{default:d.loader}),nt&&de(yz,{key:"item",prependAvatar:e.prependAvatar,prependIcon:e.prependIcon,title:e.title,subtitle:e.subtitle,appendAvatar:e.appendAvatar,appendIcon:e.appendIcon},{default:d.item,prepend:d.prepend,title:d.title,subtitle:d.subtitle,append:d.append}),rt&&de(vz,{key:"text"},{default:()=>{var $t;return[(($t=d.text)==null?void 0:$t.call(d))??e.text]}}),(ft=d.default)==null?void 0:ft.call(d),d.actions&&de(mz,null,{default:d.actions}),Fg(Ie.value,"v-card")]}}),[[qh("ripple"),Ie.value&&e.ripple]])}),{}}}),G8=e=>{const{touchstartX:s,touchendX:u,touchstartY:d,touchendY:b}=e,E=.5,T=16;e.offsetX=u-s,e.offsetY=b-d,Math.abs(e.offsetY)<E*Math.abs(e.offsetX)&&(e.left&&u<s-T&&e.left(e),e.right&&u>s+T&&e.right(e)),Math.abs(e.offsetX)<E*Math.abs(e.offsetY)&&(e.up&&b<d-T&&e.up(e),e.down&&b>d+T&&e.down(e))};function q8(e,s){var d;const u=e.changedTouches[0];s.touchstartX=u.clientX,s.touchstartY=u.clientY,(d=s.start)==null||d.call(s,{originalEvent:e,...s})}function H8(e,s){var d;const u=e.changedTouches[0];s.touchendX=u.clientX,s.touchendY=u.clientY,(d=s.end)==null||d.call(s,{originalEvent:e,...s}),G8(s)}function Z8(e,s){var d;const u=e.changedTouches[0];s.touchmoveX=u.clientX,s.touchmoveY=u.clientY,(d=s.move)==null||d.call(s,{originalEvent:e,...s})}function W8(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const s={touchstartX:0,touchstartY:0,touchendX:0,touchendY:0,touchmoveX:0,touchmoveY:0,offsetX:0,offsetY:0,left:e.left,right:e.right,up:e.up,down:e.down,start:e.start,move:e.move,end:e.end};return{touchstart:u=>q8(u,s),touchend:u=>H8(u,s),touchmove:u=>Z8(u,s)}}function X8(e,s){var t;const u=s.value,d=u!=null&&u.parent?e.parentElement:e,b=(u==null?void 0:u.options)??{passive:!0},E=(t=s.instance)==null?void 0:t.$.uid;if(!d||!E)return;const T=W8(s.value);d._touchHandlers=d._touchHandlers??Object.create(null),d._touchHandlers[E]=T,ER(T).forEach(G=>{d.addEventListener(G,T[G],b)})}function Y8(e,s){var E,T;const u=(E=s.value)!=null&&E.parent?e.parentElement:e,d=(T=s.instance)==null?void 0:T.$.uid;if(!(u!=null&&u._touchHandlers)||!d)return;const b=u._touchHandlers[d];ER(b).forEach(t=>{u.removeEventListener(t,b[t])}),delete u._touchHandlers[d]}const XC={mounted:X8,unmounted:Y8},xz=Symbol.for("vuetify:v-window"),bz=Symbol.for("vuetify:v-window-group"),hw=vn({continuous:Boolean,nextIcon:{type:[Boolean,String,Function,Object],default:"$next"},prevIcon:{type:[Boolean,String,Function,Object],default:"$prev"},reverse:Boolean,showArrows:{type:[Boolean,String],validator:e=>typeof e=="boolean"||e==="hover"},touch:{type:[Object,Boolean],default:void 0},direction:{type:String,default:"horizontal"},modelValue:null,disabled:Boolean,selectedClass:{type:String,default:"v-window-item--active"},mandatory:{type:[Boolean,String],default:"force"},...tr(),...ia(),...Da()},"VWindow"),V_=Qn()({name:"VWindow",directives:{Touch:XC},props:hw(),emits:{"update:modelValue":e=>!0},setup(e,s){let{slots:u}=s;const{themeClasses:d}=Ja(e),{isRtl:b}=Cl(),{t:E}=Uo(),T=Bg(e,bz),t=yi(),G=Fe(()=>b.value?!e.reverse:e.reverse),W=Bi(!1),Y=Fe(()=>{const Le=e.direction==="vertical"?"y":"x",Ve=(G.value?!W.value:W.value)?"-reverse":"";return`v-window-${Le}${Ve}-transition`}),ne=Bi(0),J=yi(void 0),Q=Fe(()=>T.items.value.findIndex(Le=>T.selected.value.includes(Le.id)));Pi(Q,(Le,Oe)=>{const Ve=T.items.value.length,Ue=Ve-1;Ve<=2?W.value=Le<Oe:Le===Ue&&Oe===0?W.value=!0:Le===0&&Oe===Ue?W.value=!1:W.value=Le<Oe}),xa(xz,{transition:Y,isReversed:W,transitionCount:ne,transitionHeight:J,rootRef:t});const ce=Fe(()=>e.continuous||Q.value!==0),ie=Fe(()=>e.continuous||Q.value!==T.items.value.length-1);function pe(){ce.value&&T.prev()}function be(){ie.value&&T.next()}const Ie=Fe(()=>{const Le=[],Oe={icon:b.value?e.nextIcon:e.prevIcon,class:`v-window__${G.value?"right":"left"}`,onClick:T.prev,"aria-label":E("$vuetify.carousel.prev")};Le.push(ce.value?u.prev?u.prev({props:Oe}):de(Ya,Oe,null):de("div",null,null));const Ve={icon:b.value?e.prevIcon:e.nextIcon,class:`v-window__${G.value?"left":"right"}`,onClick:T.next,"aria-label":E("$vuetify.carousel.next")};return Le.push(ie.value?u.next?u.next({props:Ve}):de(Ya,Ve,null):de("div",null,null)),Le}),$e=Fe(()=>e.touch===!1?e.touch:{...{left:()=>{G.value?pe():be()},right:()=>{G.value?be():pe()},start:Oe=>{let{originalEvent:Ve}=Oe;Ve.stopPropagation()}},...e.touch===!0?{}:e.touch});return fi(()=>Js(de(e.tag,{ref:t,class:["v-window",{"v-window--show-arrows-on-hover":e.showArrows==="hover"},d.value,e.class],style:e.style},{default:()=>{var Le,Oe;return[de("div",{class:"v-window__container",style:{height:J.value}},[(Le=u.default)==null?void 0:Le.call(u,{group:T}),e.showArrows!==!1&&de("div",{class:"v-window__controls"},[Ie.value])]),(Oe=u.additional)==null?void 0:Oe.call(u,{group:T})]}}),[[qh("touch"),$e.value]])),{group:T}}}),K8=vn({color:String,cycle:Boolean,delimiterIcon:{type:_r,default:"$delimiter"},height:{type:[Number,String],default:500},hideDelimiters:Boolean,hideDelimiterBackground:Boolean,interval:{type:[Number,String],default:6e3,validator:e=>Number(e)>0},progress:[Boolean,String],verticalDelimiters:[Boolean,String],...hw({continuous:!0,mandatory:"force",showArrows:!0})},"VCarousel"),J8=Qn()({name:"VCarousel",props:K8(),emits:{"update:modelValue":e=>!0},setup(e,s){let{slots:u}=s;const d=mr(e,"modelValue"),{t:b}=Uo(),E=yi();let T=-1;Pi(d,G),Pi(()=>e.interval,G),Pi(()=>e.cycle,W=>{W?G():window.clearTimeout(T)}),Ua(t);function t(){!e.cycle||!E.value||(T=window.setTimeout(E.value.group.next,+e.interval>0?+e.interval:6e3))}function G(){window.clearTimeout(T),window.requestAnimationFrame(t)}return fi(()=>{const W=V_.filterProps(e);return de(V_,oi({ref:E},W,{modelValue:d.value,"onUpdate:modelValue":Y=>d.value=Y,class:["v-carousel",{"v-carousel--hide-delimiter-background":e.hideDelimiterBackground,"v-carousel--vertical-delimiters":e.verticalDelimiters},e.class],style:[{height:Ji(e.height)},e.style]}),{default:u.default,additional:Y=>{let{group:ne}=Y;return de(sr,null,[!e.hideDelimiters&&de("div",{class:"v-carousel__controls",style:{left:e.verticalDelimiters==="left"&&e.verticalDelimiters?0:"auto",right:e.verticalDelimiters==="right"?0:"auto"}},[ne.items.value.length>0&&de(da,{defaults:{VBtn:{color:e.color,icon:e.delimiterIcon,size:"x-small",variant:"text"}},scoped:!0},{default:()=>[ne.items.value.map((J,Q)=>{const ce={id:`carousel-item-${J.id}`,"aria-label":b("$vuetify.carousel.ariaLabel.delimiter",Q+1,ne.items.value.length),class:["v-carousel__controls__item",ne.isSelected(J.id)&&"v-btn--active"],onClick:()=>ne.select(J.id,!0)};return u.item?u.item({props:ce,item:J}):de(Ya,oi(J,ce),null)})]})]),e.progress&&de(nw,{class:"v-carousel__progress",color:typeof e.progress=="string"?e.progress:void 0,modelValue:(ne.getItemIndex(d.value)+1)/ne.items.value.length*100},null)])},prev:u.prev,next:u.next})}),{}}}),dw=vn({reverseTransition:{type:[Boolean,String],default:void 0},transition:{type:[Boolean,String],default:void 0},...tr(),...ey(),...$C()},"VWindowItem"),N_=Qn()({name:"VWindowItem",directives:{Touch:XC},props:dw(),emits:{"group:selected":e=>!0},setup(e,s){let{slots:u}=s;const d=vr(xz),b=ty(e,bz),{isBooted:E}=K_();if(!d||!b)throw new Error("[Vuetify] VWindowItem must be used inside VWindow");const T=Bi(!1),t=Fe(()=>E.value&&(d.isReversed.value?e.reverseTransition!==!1:e.transition!==!1));function G(){!T.value||!d||(T.value=!1,d.transitionCount.value>0&&(d.transitionCount.value-=1,d.transitionCount.value===0&&(d.transitionHeight.value=void 0)))}function W(){var ce;T.value||!d||(T.value=!0,d.transitionCount.value===0&&(d.transitionHeight.value=Ji((ce=d.rootRef.value)==null?void 0:ce.clientHeight)),d.transitionCount.value+=1)}function Y(){G()}function ne(ce){T.value&&Na(()=>{!t.value||!T.value||!d||(d.transitionHeight.value=Ji(ce.clientHeight))})}const J=Fe(()=>{const ce=d.isReversed.value?e.reverseTransition:e.transition;return t.value?{name:typeof ce!="string"?d.transition.value:ce,onBeforeEnter:W,onAfterEnter:G,onEnterCancelled:Y,onBeforeLeave:W,onAfterLeave:G,onLeaveCancelled:Y,onEnter:ne}:!1}),{hasContent:Q}=GC(e,b.isSelected);return fi(()=>de(eu,{transition:J.value,disabled:!E.value},{default:()=>{var ce;return[Js(de("div",{class:["v-window-item",b.selectedClass.value,e.class],style:e.style},[Q.value&&((ce=u.default)==null?void 0:ce.call(u))]),[[Nd,b.isSelected.value]])]}})),{groupItem:b}}}),Q8=vn({...fL(),...dw()},"VCarouselItem"),eG=Qn()({name:"VCarouselItem",inheritAttrs:!1,props:Q8(),setup(e,s){let{slots:u,attrs:d}=s;fi(()=>{const b=Pm.filterProps(e),E=N_.filterProps(e);return de(N_,oi({class:["v-carousel-item",e.class]},E),{default:()=>[de(Pm,oi(d,b),u)]})})}}),tG=Hp("v-code","code"),nG=vn({color:{type:Object},disabled:Boolean,dotSize:{type:[Number,String],default:10},height:{type:[Number,String],default:150},width:{type:[Number,String],default:300},...tr()},"VColorPickerCanvas"),iG=Hh({name:"VColorPickerCanvas",props:nG(),emits:{"update:color":e=>!0,"update:position":e=>!0},setup(e,s){let{emit:u}=s;const d=Bi(!1),b=yi(),E=Bi(parseFloat(e.width)),T=Bi(parseFloat(e.height)),t=yi({x:0,y:0}),G=Fe({get:()=>t.value,set(pe){var $e,Le;if(!b.value)return;const{x:be,y:Ie}=pe;t.value=pe,u("update:color",{h:(($e=e.color)==null?void 0:$e.h)??0,s:Ko(be,0,E.value)/E.value,v:1-Ko(Ie,0,T.value)/T.value,a:((Le=e.color)==null?void 0:Le.a)??1})}}),W=Fe(()=>{const{x:pe,y:be}=G.value,Ie=parseInt(e.dotSize,10)/2;return{width:Ji(e.dotSize),height:Ji(e.dotSize),transform:`translate(${Ji(pe-Ie)}, ${Ji(be-Ie)})`}}),{resizeRef:Y}=Ff(pe=>{var $e;if(!(($e=Y.el)!=null&&$e.offsetParent))return;const{width:be,height:Ie}=pe[0].contentRect;E.value=be,T.value=Ie});function ne(pe,be,Ie){const{left:$e,top:Le,width:Oe,height:Ve}=Ie;G.value={x:Ko(pe-$e,0,Oe),y:Ko(be-Le,0,Ve)}}function J(pe){pe.type==="mousedown"&&pe.preventDefault(),!e.disabled&&(Q(pe),window.addEventListener("mousemove",Q),window.addEventListener("mouseup",ce),window.addEventListener("touchmove",Q),window.addEventListener("touchend",ce))}function Q(pe){if(e.disabled||!b.value)return;d.value=!0;const be=_6(pe);ne(be.clientX,be.clientY,b.value.getBoundingClientRect())}function ce(){window.removeEventListener("mousemove",Q),window.removeEventListener("mouseup",ce),window.removeEventListener("touchmove",Q),window.removeEventListener("touchend",ce)}function ie(){var Le;if(!b.value)return;const pe=b.value,be=pe.getContext("2d");if(!be)return;const Ie=be.createLinearGradient(0,0,pe.width,0);Ie.addColorStop(0,"hsla(0, 0%, 100%, 1)"),Ie.addColorStop(1,`hsla(${((Le=e.color)==null?void 0:Le.h)??0}, 100%, 50%, 1)`),be.fillStyle=Ie,be.fillRect(0,0,pe.width,pe.height);const $e=be.createLinearGradient(0,0,0,pe.height);$e.addColorStop(0,"hsla(0, 0%, 0%, 0)"),$e.addColorStop(1,"hsla(0, 0%, 0%, 1)"),be.fillStyle=$e,be.fillRect(0,0,pe.width,pe.height)}return Pi(()=>{var pe;return(pe=e.color)==null?void 0:pe.h},ie,{immediate:!0}),Pi(()=>[E.value,T.value],(pe,be)=>{ie(),t.value={x:G.value.x*pe[0]/be[0],y:G.value.y*pe[1]/be[1]}},{flush:"post"}),Pi(()=>e.color,()=>{if(d.value){d.value=!1;return}t.value=e.color?{x:e.color.s*E.value,y:(1-e.color.v)*T.value}:{x:0,y:0}},{deep:!0,immediate:!0}),Ua(()=>ie()),fi(()=>de("div",{ref:Y,class:["v-color-picker-canvas",e.class],style:e.style,onMousedown:J,onTouchstartPassive:J},[de("canvas",{ref:b,width:E.value,height:T.value},null),e.color&&de("div",{class:["v-color-picker-canvas__dot",{"v-color-picker-canvas__dot--disabled":e.disabled}],style:W.value},null)])),{}}});function rG(e,s){if(s){const{a:u,...d}=e;return d}return e}function aG(e,s){if(s==null||typeof s=="string"){const u=UR(e);return e.a===1?u.slice(0,7):u}if(typeof s=="object"){let u;return I_(s,["r","g","b"])?u=Im(e):I_(s,["h","s","l"])?u=FR(e):I_(s,["h","s","v"])&&(u=e),rG(u,!I_(s,["a"])&&e.a===1)}return e}const Wy={h:0,s:0,v:0,a:1},CT={inputProps:{type:"number",min:0},inputs:[{label:"R",max:255,step:1,getValue:e=>Math.round(e.r),getColor:(e,s)=>({...e,r:Number(s)})},{label:"G",max:255,step:1,getValue:e=>Math.round(e.g),getColor:(e,s)=>({...e,g:Number(s)})},{label:"B",max:255,step:1,getValue:e=>Math.round(e.b),getColor:(e,s)=>({...e,b:Number(s)})},{label:"A",max:1,step:.01,getValue:e=>{let{a:s}=e;return s!=null?Math.round(s*100)/100:1},getColor:(e,s)=>({...e,a:Number(s)})}],to:Im,from:pb};var Pk;const sG={...CT,inputs:(Pk=CT.inputs)==null?void 0:Pk.slice(0,3)},ET={inputProps:{type:"number",min:0},inputs:[{label:"H",max:360,step:1,getValue:e=>Math.round(e.h),getColor:(e,s)=>({...e,h:Number(s)})},{label:"S",max:1,step:.01,getValue:e=>Math.round(e.s*100)/100,getColor:(e,s)=>({...e,s:Number(s)})},{label:"L",max:1,step:.01,getValue:e=>Math.round(e.l*100)/100,getColor:(e,s)=>({...e,l:Number(s)})},{label:"A",max:1,step:.01,getValue:e=>{let{a:s}=e;return s!=null?Math.round(s*100)/100:1},getColor:(e,s)=>({...e,a:Number(s)})}],to:FR,from:SC},oG={...ET,inputs:ET.inputs.slice(0,3)},wz={inputProps:{type:"text"},inputs:[{label:"HEXA",getValue:e=>e,getColor:(e,s)=>s}],to:UR,from:j6},lG={...wz,inputs:[{label:"HEX",getValue:e=>e.slice(0,7),getColor:(e,s)=>s}]},L_={rgb:sG,rgba:CT,hsl:oG,hsla:ET,hex:lG,hexa:wz},cG=e=>{let{label:s,...u}=e;return de("div",{class:"v-color-picker-edit__input"},[de("input",u,null),de("span",null,[s])])},uG=vn({color:Object,disabled:Boolean,mode:{type:String,default:"rgba",validator:e=>Object.keys(L_).includes(e)},modes:{type:Array,default:()=>Object.keys(L_),validator:e=>Array.isArray(e)&&e.every(s=>Object.keys(L_).includes(s))},...tr()},"VColorPickerEdit"),hG=Hh({name:"VColorPickerEdit",props:uG(),emits:{"update:color":e=>!0,"update:mode":e=>!0},setup(e,s){let{emit:u}=s;const d=Fe(()=>e.modes.map(E=>({...L_[E],name:E}))),b=Fe(()=>{var t;const E=d.value.find(G=>G.name===e.mode);if(!E)return[];const T=e.color?E.to(e.color):null;return(t=E.inputs)==null?void 0:t.map(G=>{let{getValue:W,getColor:Y,...ne}=G;return{...E.inputProps,...ne,disabled:e.disabled,value:T&&W(T),onChange:J=>{const Q=J.target;Q&&u("update:color",E.from(Y(T??E.to(Wy),Q.value)))}}})});return fi(()=>{var E;return de("div",{class:["v-color-picker-edit",e.class],style:e.style},[(E=b.value)==null?void 0:E.map(T=>de(cG,T,null)),d.value.length>1&&de(Ya,{icon:"$unfold",size:"x-small",variant:"plain",onClick:()=>{const T=d.value.findIndex(t=>t.name===e.mode);u("update:mode",d.value[(T+1)%d.value.length].name)}},null)])}),{}}}),YC=Symbol.for("vuetify:v-slider");function MT(e,s,u){const d=u==="vertical",b=s.getBoundingClientRect(),E="touches"in e?e.touches[0]:e;return d?E.clientY-(b.top+b.height/2):E.clientX-(b.left+b.width/2)}function dG(e,s){return"touches"in e&&e.touches.length?e.touches[0][s]:"changedTouches"in e&&e.changedTouches.length?e.changedTouches[0][s]:e[s]}const Sz=vn({disabled:{type:Boolean,default:null},error:Boolean,readonly:{type:Boolean,default:null},max:{type:[Number,String],default:100},min:{type:[Number,String],default:0},step:{type:[Number,String],default:0},thumbColor:String,thumbLabel:{type:[Boolean,String],default:void 0,validator:e=>typeof e=="boolean"||e==="always"},thumbSize:{type:[Number,String],default:20},showTicks:{type:[Boolean,String],default:!1,validator:e=>typeof e=="boolean"||e==="always"},ticks:{type:[Array,Object]},tickSize:{type:[Number,String],default:2},color:String,trackColor:String,trackFillColor:String,trackSize:{type:[Number,String],default:4},direction:{type:String,default:"horizontal",validator:e=>["vertical","horizontal"].includes(e)},reverse:Boolean,...Qs(),...El({elevation:2}),ripple:{type:Boolean,default:!0}},"Slider"),Tz=e=>{const s=Fe(()=>parseFloat(e.min)),u=Fe(()=>parseFloat(e.max)),d=Fe(()=>+e.step>0?parseFloat(e.step):0),b=Fe(()=>Math.max(fA(d.value),fA(s.value)));function E(T){if(T=parseFloat(T),d.value<=0)return T;const t=Ko(T,s.value,u.value),G=s.value%d.value,W=Math.round((t-G)/d.value)*d.value+G;return parseFloat(Math.min(W,u.value).toFixed(b.value))}return{min:s,max:u,step:d,decimals:b,roundValue:E}},Cz=e=>{let{props:s,steps:u,onSliderStart:d,onSliderMove:b,onSliderEnd:E,getActiveThumb:T}=e;const{isRtl:t}=Cl(),G=$n(s,"reverse"),W=Fe(()=>s.direction==="vertical"),Y=Fe(()=>W.value!==G.value),{min:ne,max:J,step:Q,decimals:ce,roundValue:ie}=u,pe=Fe(()=>parseInt(s.thumbSize,10)),be=Fe(()=>parseInt(s.tickSize,10)),Ie=Fe(()=>parseInt(s.trackSize,10)),$e=Fe(()=>(J.value-ne.value)/Q.value),Le=$n(s,"disabled"),Oe=Fe(()=>s.error||s.disabled?void 0:s.thumbColor??s.color),Ve=Fe(()=>s.error||s.disabled?void 0:s.trackColor??s.color),Ue=Fe(()=>s.error||s.disabled?void 0:s.trackFillColor??s.color),qe=Bi(!1),He=Bi(0),nt=yi(),rt=yi();function ft(Ln){var Tn;const sn=s.direction==="vertical",qn=sn?"top":"left",pi=sn?"height":"width",ht=sn?"clientY":"clientX",{[qn]:Zn,[pi]:St}=(Tn=nt.value)==null?void 0:Tn.$el.getBoundingClientRect(),mt=dG(Ln,ht);let at=Math.min(Math.max((mt-Zn-He.value)/St,0),1)||0;return(sn?Y.value:Y.value!==t.value)&&(at=1-at),ie(ne.value+at*(J.value-ne.value))}const $t=Ln=>{E({value:ft(Ln)}),qe.value=!1,He.value=0},hn=Ln=>{rt.value=T(Ln),rt.value&&(qe.value=!0,rt.value.contains(Ln.target)?He.value=MT(Ln,rt.value,s.direction):(He.value=0,b({value:ft(Ln)})),d({value:ft(Ln)}),Na(()=>{var sn;return(sn=rt.value)==null?void 0:sn.focus()}))},gn={passive:!0,capture:!0};function pn(Ln){b({value:ft(Ln)})}function ri(Ln){Ln.stopPropagation(),Ln.preventDefault(),$t(Ln),window.removeEventListener("mousemove",pn,gn),window.removeEventListener("mouseup",ri)}function ai(Ln){var sn;$t(Ln),window.removeEventListener("touchmove",pn,gn),(sn=Ln.target)==null||sn.removeEventListener("touchend",ai)}function _n(Ln){var sn;hn(Ln),window.addEventListener("touchmove",pn,gn),(sn=Ln.target)==null||sn.addEventListener("touchend",ai,{passive:!1})}function Bn(Ln){Ln.preventDefault(),hn(Ln),window.addEventListener("mousemove",pn,gn),window.addEventListener("mouseup",ri,{passive:!1})}const mn=Ln=>{const sn=(Ln-ne.value)/(J.value-ne.value)*100;return Ko(isNaN(sn)?0:sn,0,100)},Nn=$n(s,"showTicks"),Pn=Fe(()=>Nn.value?s.ticks?Array.isArray(s.ticks)?s.ticks.map(Ln=>({value:Ln,position:mn(Ln),label:Ln.toString()})):Object.keys(s.ticks).map(Ln=>({value:parseFloat(Ln),position:mn(parseFloat(Ln)),label:s.ticks[Ln]})):$e.value!==1/0?Vp($e.value+1).map(Ln=>{const sn=ne.value+Ln*Q.value;return{value:sn,position:mn(sn)}}):[]:[]),Ci=Fe(()=>Pn.value.some(Ln=>{let{label:sn}=Ln;return!!sn})),Fi={activeThumbRef:rt,color:$n(s,"color"),decimals:ce,disabled:Le,direction:$n(s,"direction"),elevation:$n(s,"elevation"),hasLabels:Ci,isReversed:G,indexFromEnd:Y,min:ne,max:J,mousePressed:qe,numTicks:$e,onSliderMousedown:Bn,onSliderTouchstart:_n,parsedTicks:Pn,parseMouseMove:ft,position:mn,readonly:$n(s,"readonly"),rounded:$n(s,"rounded"),roundValue:ie,showTicks:Nn,startOffset:He,step:Q,thumbSize:pe,thumbColor:Oe,thumbLabel:$n(s,"thumbLabel"),ticks:$n(s,"ticks"),tickSize:be,trackColor:Ve,trackContainerRef:nt,trackFillColor:Ue,trackSize:Ie,vertical:W};return xa(YC,Fi),Fi},fG=vn({focused:Boolean,max:{type:Number,required:!0},min:{type:Number,required:!0},modelValue:{type:Number,required:!0},position:{type:Number,required:!0},ripple:{type:[Boolean,Object],default:!0},name:String,...tr()},"VSliderThumb"),IT=Qn()({name:"VSliderThumb",directives:{Ripple:zm},props:fG(),emits:{"update:modelValue":e=>!0},setup(e,s){let{slots:u,emit:d}=s;const b=vr(YC),{isRtl:E,rtlClasses:T}=Cl();if(!b)throw new Error("[Vuetify] v-slider-thumb must be used inside v-slider or v-range-slider");const{thumbColor:t,step:G,disabled:W,thumbSize:Y,thumbLabel:ne,direction:J,isReversed:Q,vertical:ce,readonly:ie,elevation:pe,mousePressed:be,decimals:Ie,indexFromEnd:$e}=b,Le=Fe(()=>W.value?void 0:pe.value),{elevationClasses:Oe}=hc(Le),{textColorClasses:Ve,textColorStyles:Ue}=Dc(t),{pageup:qe,pagedown:He,end:nt,home:rt,left:ft,right:$t,down:hn,up:gn}=rT,pn=[qe,He,nt,rt,ft,$t,hn,gn],ri=Fe(()=>G.value?[1,2,3]:[1,5,10]);function ai(Bn,mn){if(!pn.includes(Bn.key))return;Bn.preventDefault();const Nn=G.value||.1,Pn=(e.max-e.min)/Nn;if([ft,$t,hn,gn].includes(Bn.key)){const Fi=(ce.value?[E.value?ft:$t,Q.value?hn:gn]:$e.value!==E.value?[ft,gn]:[$t,gn]).includes(Bn.key)?1:-1,Ln=Bn.shiftKey?2:Bn.ctrlKey?1:0;mn=mn+Fi*Nn*ri.value[Ln]}else if(Bn.key===rt)mn=e.min;else if(Bn.key===nt)mn=e.max;else{const Ci=Bn.key===He?1:-1;mn=mn-Ci*Nn*(Pn>100?Pn/10:10)}return Math.max(e.min,Math.min(e.max,mn))}function _n(Bn){const mn=ai(Bn,e.modelValue);mn!=null&&d("update:modelValue",mn)}return fi(()=>{const Bn=Ji($e.value?100-e.position:e.position,"%");return de("div",{class:["v-slider-thumb",{"v-slider-thumb--focused":e.focused,"v-slider-thumb--pressed":e.focused&&be.value},e.class,T.value],style:[{"--v-slider-thumb-position":Bn,"--v-slider-thumb-size":Ji(Y.value)},e.style],role:"slider",tabindex:W.value?-1:0,"aria-label":e.name,"aria-valuemin":e.min,"aria-valuemax":e.max,"aria-valuenow":e.modelValue,"aria-readonly":!!ie.value,"aria-orientation":J.value,onKeydown:ie.value?void 0:_n},[de("div",{class:["v-slider-thumb__surface",Ve.value,Oe.value],style:{...Ue.value}},null),Js(de("div",{class:["v-slider-thumb__ripple",Ve.value],style:Ue.value},null),[[qh("ripple"),e.ripple,null,{circle:!0,center:!0}]]),de(kC,{origin:"bottom center"},{default:()=>{var mn;return[Js(de("div",{class:"v-slider-thumb__label-container"},[de("div",{class:["v-slider-thumb__label"]},[de("div",null,[((mn=u["thumb-label"])==null?void 0:mn.call(u,{modelValue:e.modelValue}))??e.modelValue.toFixed(G.value?Ie.value:1)])])]),[[Nd,ne.value&&e.focused||ne.value==="always"]])]}})])}),{}}}),pG=vn({start:{type:Number,required:!0},stop:{type:Number,required:!0},...tr()},"VSliderTrack"),Ez=Qn()({name:"VSliderTrack",props:pG(),emits:{},setup(e,s){let{slots:u}=s;const d=vr(YC);if(!d)throw new Error("[Vuetify] v-slider-track must be inside v-slider or v-range-slider");const{color:b,parsedTicks:E,rounded:T,showTicks:t,tickSize:G,trackColor:W,trackFillColor:Y,trackSize:ne,vertical:J,min:Q,max:ce,indexFromEnd:ie}=d,{roundedClasses:pe}=Ao(T),{backgroundColorClasses:be,backgroundColorStyles:Ie}=Ms(Y),{backgroundColorClasses:$e,backgroundColorStyles:Le}=Ms(W),Oe=Fe(()=>`inset-${J.value?"block":"inline"}-${ie.value?"end":"start"}`),Ve=Fe(()=>J.value?"height":"width"),Ue=Fe(()=>({[Oe.value]:"0%",[Ve.value]:"100%"})),qe=Fe(()=>e.stop-e.start),He=Fe(()=>({[Oe.value]:Ji(e.start,"%"),[Ve.value]:Ji(qe.value,"%")})),nt=Fe(()=>t.value?(J.value?E.value.slice().reverse():E.value).map((ft,$t)=>{var gn;const hn=ft.value!==Q.value&&ft.value!==ce.value?Ji(ft.position,"%"):void 0;return de("div",{key:ft.value,class:["v-slider-track__tick",{"v-slider-track__tick--filled":ft.position>=e.start&&ft.position<=e.stop,"v-slider-track__tick--first":ft.value===Q.value,"v-slider-track__tick--last":ft.value===ce.value}],style:{[Oe.value]:hn}},[(ft.label||u["tick-label"])&&de("div",{class:"v-slider-track__tick-label"},[((gn=u["tick-label"])==null?void 0:gn.call(u,{tick:ft,index:$t}))??ft.label])])}):[]);return fi(()=>de("div",{class:["v-slider-track",pe.value,e.class],style:[{"--v-slider-track-size":Ji(ne.value),"--v-slider-tick-size":Ji(G.value)},e.style]},[de("div",{class:["v-slider-track__background",$e.value,{"v-slider-track__background--opacity":!!b.value||!Y.value}],style:{...Ue.value,...Le.value}},null),de("div",{class:["v-slider-track__fill",be.value],style:{...He.value,...Ie.value}},null),t.value&&de("div",{class:["v-slider-track__ticks",{"v-slider-track__ticks--always-show":t.value==="always"}]},[nt.value])])),{}}}),mG=vn({...bb(),...Sz(),...Fm(),modelValue:{type:[Number,String],default:0}},"VSlider"),PT=Qn()({name:"VSlider",props:mG(),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,start:e=>!0,end:e=>!0},setup(e,s){let{slots:u,emit:d}=s;const b=yi(),{rtlClasses:E}=Cl(),T=Tz(e),t=mr(e,"modelValue",void 0,Ve=>T.roundValue(Ve??T.min.value)),{min:G,max:W,mousePressed:Y,roundValue:ne,onSliderMousedown:J,onSliderTouchstart:Q,trackContainerRef:ce,position:ie,hasLabels:pe,readonly:be}=Cz({props:e,steps:T,onSliderStart:()=>{d("start",t.value)},onSliderEnd:Ve=>{let{value:Ue}=Ve;const qe=ne(Ue);t.value=qe,d("end",qe)},onSliderMove:Ve=>{let{value:Ue}=Ve;return t.value=ne(Ue)},getActiveThumb:()=>{var Ve;return(Ve=b.value)==null?void 0:Ve.$el}}),{isFocused:Ie,focus:$e,blur:Le}=Om(e),Oe=Fe(()=>ie(t.value));return fi(()=>{const Ve=Rc.filterProps(e),Ue=!!(e.label||u.label||u.prepend);return de(Rc,oi({class:["v-slider",{"v-slider--has-labels":!!u["tick-label"]||pe.value,"v-slider--focused":Ie.value,"v-slider--pressed":Y.value,"v-slider--disabled":e.disabled},E.value,e.class],style:e.style},Ve,{focused:Ie.value}),{...u,prepend:Ue?qe=>{var He,nt;return de(sr,null,[((He=u.label)==null?void 0:He.call(u,qe))??(e.label?de(vv,{id:qe.id.value,class:"v-slider__label",text:e.label},null):void 0),(nt=u.prepend)==null?void 0:nt.call(u,qe)])}:void 0,default:qe=>{let{id:He,messagesId:nt}=qe;return de("div",{class:"v-slider__container",onMousedown:be.value?void 0:J,onTouchstartPassive:be.value?void 0:Q},[de("input",{id:He.value,name:e.name||He.value,disabled:!!e.disabled,readonly:!!e.readonly,tabindex:"-1",value:t.value},null),de(Ez,{ref:ce,start:0,stop:Oe.value},{"tick-label":u["tick-label"]}),de(IT,{ref:b,"aria-describedby":nt.value,focused:Ie.value,min:G.value,max:W.value,modelValue:t.value,"onUpdate:modelValue":rt=>t.value=rt,position:Oe.value,elevation:e.elevation,onFocus:$e,onBlur:Le,ripple:e.ripple,name:e.name},{"thumb-label":u["thumb-label"]})])}})}),{}}}),gG=vn({color:{type:Object},disabled:Boolean,hideAlpha:Boolean,...tr()},"VColorPickerPreview"),_G=Hh({name:"VColorPickerPreview",props:gG(),emits:{"update:color":e=>!0},setup(e,s){let{emit:u}=s;const d=new AbortController;Tl(()=>d.abort());async function b(){if(!cA)return;const E=new window.EyeDropper;try{const T=await E.open({signal:d.signal}),t=pb(Gh(T.sRGBHex));u("update:color",{...e.color??Wy,...t})}catch{}}return fi(()=>{var E,T;return de("div",{class:["v-color-picker-preview",{"v-color-picker-preview--hide-alpha":e.hideAlpha},e.class],style:e.style},[cA&&de("div",{class:"v-color-picker-preview__eye-dropper",key:"eyeDropper"},[de(Ya,{onClick:b,icon:"$eyeDropper",variant:"plain",density:"comfortable"},null)]),de("div",{class:"v-color-picker-preview__dot"},[de("div",{style:{background:VR(e.color??Wy)}},null)]),de("div",{class:"v-color-picker-preview__sliders"},[de(PT,{class:"v-color-picker-preview__track v-color-picker-preview__hue",modelValue:(E=e.color)==null?void 0:E.h,"onUpdate:modelValue":t=>u("update:color",{...e.color??Wy,h:t}),step:0,min:0,max:360,disabled:e.disabled,thumbSize:14,trackSize:8,trackFillColor:"white",hideDetails:!0},null),!e.hideAlpha&&de(PT,{class:"v-color-picker-preview__track v-color-picker-preview__alpha",modelValue:((T=e.color)==null?void 0:T.a)??1,"onUpdate:modelValue":t=>u("update:color",{...e.color??Wy,a:t}),step:1/256,min:0,max:1,disabled:e.disabled,thumbSize:14,trackSize:8,trackFillColor:"white",hideDetails:!0},null)])])}),{}}}),yG={base:"#f44336",lighten5:"#ffebee",lighten4:"#ffcdd2",lighten3:"#ef9a9a",lighten2:"#e57373",lighten1:"#ef5350",darken1:"#e53935",darken2:"#d32f2f",darken3:"#c62828",darken4:"#b71c1c",accent1:"#ff8a80",accent2:"#ff5252",accent3:"#ff1744",accent4:"#d50000"},vG={base:"#e91e63",lighten5:"#fce4ec",lighten4:"#f8bbd0",lighten3:"#f48fb1",lighten2:"#f06292",lighten1:"#ec407a",darken1:"#d81b60",darken2:"#c2185b",darken3:"#ad1457",darken4:"#880e4f",accent1:"#ff80ab",accent2:"#ff4081",accent3:"#f50057",accent4:"#c51162"},xG={base:"#9c27b0",lighten5:"#f3e5f5",lighten4:"#e1bee7",lighten3:"#ce93d8",lighten2:"#ba68c8",lighten1:"#ab47bc",darken1:"#8e24aa",darken2:"#7b1fa2",darken3:"#6a1b9a",darken4:"#4a148c",accent1:"#ea80fc",accent2:"#e040fb",accent3:"#d500f9",accent4:"#aa00ff"},bG={base:"#673ab7",lighten5:"#ede7f6",lighten4:"#d1c4e9",lighten3:"#b39ddb",lighten2:"#9575cd",lighten1:"#7e57c2",darken1:"#5e35b1",darken2:"#512da8",darken3:"#4527a0",darken4:"#311b92",accent1:"#b388ff",accent2:"#7c4dff",accent3:"#651fff",accent4:"#6200ea"},wG={base:"#3f51b5",lighten5:"#e8eaf6",lighten4:"#c5cae9",lighten3:"#9fa8da",lighten2:"#7986cb",lighten1:"#5c6bc0",darken1:"#3949ab",darken2:"#303f9f",darken3:"#283593",darken4:"#1a237e",accent1:"#8c9eff",accent2:"#536dfe",accent3:"#3d5afe",accent4:"#304ffe"},SG={base:"#2196f3",lighten5:"#e3f2fd",lighten4:"#bbdefb",lighten3:"#90caf9",lighten2:"#64b5f6",lighten1:"#42a5f5",darken1:"#1e88e5",darken2:"#1976d2",darken3:"#1565c0",darken4:"#0d47a1",accent1:"#82b1ff",accent2:"#448aff",accent3:"#2979ff",accent4:"#2962ff"},TG={base:"#03a9f4",lighten5:"#e1f5fe",lighten4:"#b3e5fc",lighten3:"#81d4fa",lighten2:"#4fc3f7",lighten1:"#29b6f6",darken1:"#039be5",darken2:"#0288d1",darken3:"#0277bd",darken4:"#01579b",accent1:"#80d8ff",accent2:"#40c4ff",accent3:"#00b0ff",accent4:"#0091ea"},CG={base:"#00bcd4",lighten5:"#e0f7fa",lighten4:"#b2ebf2",lighten3:"#80deea",lighten2:"#4dd0e1",lighten1:"#26c6da",darken1:"#00acc1",darken2:"#0097a7",darken3:"#00838f",darken4:"#006064",accent1:"#84ffff",accent2:"#18ffff",accent3:"#00e5ff",accent4:"#00b8d4"},EG={base:"#009688",lighten5:"#e0f2f1",lighten4:"#b2dfdb",lighten3:"#80cbc4",lighten2:"#4db6ac",lighten1:"#26a69a",darken1:"#00897b",darken2:"#00796b",darken3:"#00695c",darken4:"#004d40",accent1:"#a7ffeb",accent2:"#64ffda",accent3:"#1de9b6",accent4:"#00bfa5"},MG={base:"#4caf50",lighten5:"#e8f5e9",lighten4:"#c8e6c9",lighten3:"#a5d6a7",lighten2:"#81c784",lighten1:"#66bb6a",darken1:"#43a047",darken2:"#388e3c",darken3:"#2e7d32",darken4:"#1b5e20",accent1:"#b9f6ca",accent2:"#69f0ae",accent3:"#00e676",accent4:"#00c853"},IG={base:"#8bc34a",lighten5:"#f1f8e9",lighten4:"#dcedc8",lighten3:"#c5e1a5",lighten2:"#aed581",lighten1:"#9ccc65",darken1:"#7cb342",darken2:"#689f38",darken3:"#558b2f",darken4:"#33691e",accent1:"#ccff90",accent2:"#b2ff59",accent3:"#76ff03",accent4:"#64dd17"},PG={base:"#cddc39",lighten5:"#f9fbe7",lighten4:"#f0f4c3",lighten3:"#e6ee9c",lighten2:"#dce775",lighten1:"#d4e157",darken1:"#c0ca33",darken2:"#afb42b",darken3:"#9e9d24",darken4:"#827717",accent1:"#f4ff81",accent2:"#eeff41",accent3:"#c6ff00",accent4:"#aeea00"},AG={base:"#ffeb3b",lighten5:"#fffde7",lighten4:"#fff9c4",lighten3:"#fff59d",lighten2:"#fff176",lighten1:"#ffee58",darken1:"#fdd835",darken2:"#fbc02d",darken3:"#f9a825",darken4:"#f57f17",accent1:"#ffff8d",accent2:"#ffff00",accent3:"#ffea00",accent4:"#ffd600"},kG={base:"#ffc107",lighten5:"#fff8e1",lighten4:"#ffecb3",lighten3:"#ffe082",lighten2:"#ffd54f",lighten1:"#ffca28",darken1:"#ffb300",darken2:"#ffa000",darken3:"#ff8f00",darken4:"#ff6f00",accent1:"#ffe57f",accent2:"#ffd740",accent3:"#ffc400",accent4:"#ffab00"},DG={base:"#ff9800",lighten5:"#fff3e0",lighten4:"#ffe0b2",lighten3:"#ffcc80",lighten2:"#ffb74d",lighten1:"#ffa726",darken1:"#fb8c00",darken2:"#f57c00",darken3:"#ef6c00",darken4:"#e65100",accent1:"#ffd180",accent2:"#ffab40",accent3:"#ff9100",accent4:"#ff6d00"},RG={base:"#ff5722",lighten5:"#fbe9e7",lighten4:"#ffccbc",lighten3:"#ffab91",lighten2:"#ff8a65",lighten1:"#ff7043",darken1:"#f4511e",darken2:"#e64a19",darken3:"#d84315",darken4:"#bf360c",accent1:"#ff9e80",accent2:"#ff6e40",accent3:"#ff3d00",accent4:"#dd2c00"},LG={base:"#795548",lighten5:"#efebe9",lighten4:"#d7ccc8",lighten3:"#bcaaa4",lighten2:"#a1887f",lighten1:"#8d6e63",darken1:"#6d4c41",darken2:"#5d4037",darken3:"#4e342e",darken4:"#3e2723"},zG={base:"#607d8b",lighten5:"#eceff1",lighten4:"#cfd8dc",lighten3:"#b0bec5",lighten2:"#90a4ae",lighten1:"#78909c",darken1:"#546e7a",darken2:"#455a64",darken3:"#37474f",darken4:"#263238"},OG={base:"#9e9e9e",lighten5:"#fafafa",lighten4:"#f5f5f5",lighten3:"#eeeeee",lighten2:"#e0e0e0",lighten1:"#bdbdbd",darken1:"#757575",darken2:"#616161",darken3:"#424242",darken4:"#212121"},FG={black:"#000000",white:"#ffffff",transparent:"#ffffff00"},BG={red:yG,pink:vG,purple:xG,deepPurple:bG,indigo:wG,blue:SG,lightBlue:TG,cyan:CG,teal:EG,green:MG,lightGreen:IG,lime:PG,yellow:AG,amber:kG,orange:DG,deepOrange:RG,brown:LG,blueGrey:zG,grey:OG,shades:FG},VG=vn({swatches:{type:Array,default:()=>NG(BG)},disabled:Boolean,color:Object,maxHeight:[Number,String],...tr()},"VColorPickerSwatches");function NG(e){return Object.keys(e).map(s=>{const u=e[s];return u.base?[u.base,u.darken4,u.darken3,u.darken2,u.darken1,u.lighten1,u.lighten2,u.lighten3,u.lighten4,u.lighten5]:[u.black,u.white,u.transparent]})}const jG=Hh({name:"VColorPickerSwatches",props:VG(),emits:{"update:color":e=>!0},setup(e,s){let{emit:u}=s;return fi(()=>de("div",{class:["v-color-picker-swatches",e.class],style:[{maxHeight:Ji(e.maxHeight)},e.style]},[de("div",null,[e.swatches.map(d=>de("div",{class:"v-color-picker-swatches__swatch"},[d.map(b=>{const E=Gh(b),T=pb(E),t=BR(E);return de("div",{class:"v-color-picker-swatches__color",onClick:()=>T&&u("update:color",T)},[de("div",{style:{background:t}},[e.color&&Gp(e.color,T)?de(Ka,{size:"x-small",icon:"$success",color:q6(b,"#FFFFFF")>2?"white":"black"},null):void 0])])})]))])])),{}}}),fw=vn({color:String,...gh(),...tr(),...hl(),...El(),...Lm(),..._v(),...Qs(),...ia(),...Da()},"VSheet"),j_=Qn()({name:"VSheet",props:fw(),setup(e,s){let{slots:u}=s;const{themeClasses:d}=Ja(e),{backgroundColorClasses:b,backgroundColorStyles:E}=Ms($n(e,"color")),{borderClasses:T}=Wh(e),{dimensionStyles:t}=dl(e),{elevationClasses:G}=hc(e),{locationStyles:W}=ny(e),{positionClasses:Y}=yv(e),{roundedClasses:ne}=Ao(e);return fi(()=>de(e.tag,{class:["v-sheet",d.value,b.value,T.value,G.value,Y.value,ne.value,e.class],style:[E.value,t.value,W.value,e.style]},u)),{}}}),UG=vn({canvasHeight:{type:[String,Number],default:150},disabled:Boolean,dotSize:{type:[Number,String],default:10},hideCanvas:Boolean,hideSliders:Boolean,hideInputs:Boolean,mode:{type:String,default:"rgba",validator:e=>Object.keys(L_).includes(e)},modes:{type:Array,default:()=>Object.keys(L_),validator:e=>Array.isArray(e)&&e.every(s=>Object.keys(L_).includes(s))},showSwatches:Boolean,swatches:Array,swatchesMaxHeight:{type:[Number,String],default:150},modelValue:{type:[Object,String]},...ul(fw({width:300}),["height","location","minHeight","maxHeight","minWidth","maxWidth"])},"VColorPicker"),$G=Hh({name:"VColorPicker",props:UG(),emits:{"update:modelValue":e=>!0,"update:mode":e=>!0},setup(e){const s=mr(e,"mode"),u=yi(null),d=mr(e,"modelValue",void 0,G=>{if(G==null||G==="")return null;let W;try{W=pb(Gh(G))}catch{return null}return W},G=>G?aG(G,e.modelValue):null),b=Fe(()=>d.value?{...d.value,h:u.value??d.value.h}:null),{rtlClasses:E}=Cl();let T=!0;Pi(d,G=>{if(!T){T=!0;return}G&&(u.value=G.h)},{immediate:!0});const t=G=>{T=!1,u.value=G.h,d.value=G};return pv(()=>{e.modes.includes(s.value)||(s.value=e.modes[0])}),Io({VSlider:{color:void 0,trackColor:void 0,trackFillColor:void 0}}),fi(()=>{const G=j_.filterProps(e);return de(j_,oi({rounded:e.rounded,elevation:e.elevation,theme:e.theme,class:["v-color-picker",E.value,e.class],style:[{"--v-color-picker-color-hsv":VR({...b.value??Wy,a:1})},e.style]},G,{maxWidth:e.width}),{default:()=>[!e.hideCanvas&&de(iG,{key:"canvas",color:b.value,"onUpdate:color":t,disabled:e.disabled,dotSize:e.dotSize,width:e.width,height:e.canvasHeight},null),(!e.hideSliders||!e.hideInputs)&&de("div",{key:"controls",class:"v-color-picker__controls"},[!e.hideSliders&&de(_G,{key:"preview",color:b.value,"onUpdate:color":t,hideAlpha:!s.value.endsWith("a"),disabled:e.disabled},null),!e.hideInputs&&de(hG,{key:"edit",modes:e.modes,mode:s.value,"onUpdate:mode":W=>s.value=W,color:b.value,"onUpdate:color":t,disabled:e.disabled},null)]),e.showSwatches&&de(jG,{key:"swatches",color:b.value,"onUpdate:color":t,maxHeight:e.swatchesMaxHeight,swatches:e.swatches,disabled:e.disabled},null)]})}),{}}});function GG(e,s,u){if(s==null)return e;if(Array.isArray(s))throw new Error("Multiple matches is not implemented");return typeof s=="number"&&~s?de(sr,null,[de("span",{class:"v-combobox__unmask"},[e.substr(0,s)]),de("span",{class:"v-combobox__mask"},[e.substr(s,u)]),de("span",{class:"v-combobox__unmask"},[e.substr(s+u)])]):e}const qG=vn({autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,...Cb({filterKeys:["title"]}),...ZC({hideNoData:!0,returnObject:!0}),...ul(cw({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...$f({transition:!1})},"VCombobox"),HG=Qn()({name:"VCombobox",props:qG(),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,"update:search":e=>!0,"update:menu":e=>!0},setup(e,s){var St;let{emit:u,slots:d}=s;const{t:b}=Uo(),E=yi(),T=Bi(!1),t=Bi(!0),G=Bi(!1),W=yi(),Y=yi(),ne=mr(e,"menu"),J=Fe({get:()=>ne.value,set:mt=>{var at;ne.value&&!mt&&((at=W.value)!=null&&at.ΨopenChildren.size)||(ne.value=mt)}}),Q=Bi(-1);let ce=!1;const ie=Fe(()=>{var mt;return(mt=E.value)==null?void 0:mt.color}),pe=Fe(()=>J.value?e.closeText:e.openText),{items:be,transformIn:Ie,transformOut:$e}=NC(e),{textColorClasses:Le,textColorStyles:Oe}=Dc(ie),Ve=mr(e,"modelValue",[],mt=>Ie(po(mt)),mt=>{const at=$e(mt);return e.multiple?at:at[0]??null}),Ue=sw(e),qe=Fe(()=>!!(e.chips||d.chip)),He=Fe(()=>qe.value||!!d.selection),nt=Bi(!e.multiple&&!He.value?((St=Ve.value[0])==null?void 0:St.title)??"":""),rt=Fe({get:()=>nt.value,set:mt=>{var at;if(nt.value=mt??"",!e.multiple&&!He.value&&(Ve.value=[Mg(e,mt)]),mt&&e.multiple&&((at=e.delimiters)!=null&&at.length)){const Tn=mt.split(new RegExp(`(?:${e.delimiters.join("|")})+`));Tn.length>1&&(Tn.forEach(bn=>{bn=bn.trim(),bn&&qn(Mg(e,bn))}),nt.value="")}mt||(Q.value=-1),t.value=!mt}}),ft=Fe(()=>typeof e.counterValue=="function"?e.counterValue(Ve.value):typeof e.counterValue=="number"?e.counterValue:e.multiple?Ve.value.length:rt.value.length);Pi(nt,mt=>{ce?Na(()=>ce=!1):T.value&&!J.value&&(J.value=!0),u("update:search",mt)}),Pi(Ve,mt=>{var at;!e.multiple&&!He.value&&(nt.value=((at=mt[0])==null?void 0:at.title)??"")});const{filteredItems:$t,getMatches:hn}=Eb(e,be,()=>t.value?"":rt.value),gn=Fe(()=>e.hideSelected?$t.value.filter(mt=>!Ve.value.some(at=>at.value===mt.value)):$t.value),pn=Fe(()=>Ve.value.map(mt=>mt.value)),ri=Fe(()=>{var at;return(e.autoSelectFirst===!0||e.autoSelectFirst==="exact"&&rt.value===((at=gn.value[0])==null?void 0:at.title))&&gn.value.length>0&&!t.value&&!G.value}),ai=Fe(()=>e.hideNoData&&!gn.value.length||Ue.isReadonly.value||Ue.isDisabled.value),_n=yi(),Bn=HC(_n,E);function mn(mt){ce=!0,e.openOnClear&&(J.value=!0)}function Nn(){ai.value||(J.value=!0)}function Pn(mt){ai.value||(T.value&&(mt.preventDefault(),mt.stopPropagation()),J.value=!J.value)}function Ci(mt){var at;mt.key!==" "&&ov(mt)&&((at=E.value)==null||at.focus())}function Fi(mt){var bn;if(f6(mt)||Ue.isReadonly.value)return;const at=E.value.selectionStart,Tn=Ve.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(mt.key)&&mt.preventDefault(),["Enter","ArrowDown"].includes(mt.key)&&(J.value=!0),["Escape"].includes(mt.key)&&(J.value=!1),["Enter","Escape","Tab"].includes(mt.key)&&(ri.value&&["Enter","Tab"].includes(mt.key)&&!Ve.value.some(Cn=>{let{value:zn}=Cn;return zn===gn.value[0].value})&&qn($t.value[0]),t.value=!0),mt.key==="ArrowDown"&&ri.value&&((bn=_n.value)==null||bn.focus("next")),mt.key==="Enter"&&rt.value&&(qn(Mg(e,rt.value)),He.value&&(nt.value="")),["Backspace","Delete"].includes(mt.key)){if(!e.multiple&&He.value&&Ve.value.length>0&&!rt.value)return qn(Ve.value[0],!1);if(~Q.value){mt.preventDefault();const Cn=Q.value;qn(Ve.value[Q.value],!1),Q.value=Cn>=Tn-1?Tn-2:Cn}else mt.key==="Backspace"&&!rt.value&&(Q.value=Tn-1);return}if(e.multiple)if(mt.key==="ArrowLeft"){if(Q.value<0&&at>0)return;const Cn=Q.value>-1?Q.value-1:Tn-1;Ve.value[Cn]?Q.value=Cn:(Q.value=-1,E.value.setSelectionRange(rt.value.length,rt.value.length))}else if(mt.key==="ArrowRight"){if(Q.value<0)return;const Cn=Q.value+1;Ve.value[Cn]?Q.value=Cn:(Q.value=-1,E.value.setSelectionRange(0,0))}else~Q.value&&ov(mt)&&(Q.value=-1)}function Ln(){var mt;e.eager&&((mt=Y.value)==null||mt.calculateVisibleItems())}function sn(){var mt;T.value&&(t.value=!0,(mt=E.value)==null||mt.focus())}function qn(mt){let at=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!mt||mt.props.disabled))if(e.multiple){const Tn=Ve.value.findIndex(Cn=>e.valueComparator(Cn.value,mt.value)),bn=at??!~Tn;if(~Tn){const Cn=bn?[...Ve.value,mt]:[...Ve.value];Cn.splice(Tn,1),Ve.value=Cn}else bn&&(Ve.value=[...Ve.value,mt]);e.clearOnSelect&&(rt.value="")}else{const Tn=at!==!1;Ve.value=Tn?[mt]:[],nt.value=Tn&&!He.value?mt.title:"",Na(()=>{J.value=!1,t.value=!0})}}function pi(mt){T.value=!0,setTimeout(()=>{G.value=!0})}function ht(mt){G.value=!1}function Zn(mt){(mt==null||mt===""&&!e.multiple&&!He.value)&&(Ve.value=[])}return Pi(T,(mt,at)=>{if(!(mt||mt===at)&&(Q.value=-1,J.value=!1,rt.value)){if(e.multiple){qn(Mg(e,rt.value));return}if(!He.value)return;Ve.value.some(Tn=>{let{title:bn}=Tn;return bn===rt.value})?nt.value="":qn(Mg(e,rt.value))}}),Pi(J,()=>{if(!e.hideSelected&&J.value&&Ve.value.length){const mt=gn.value.findIndex(at=>Ve.value.some(Tn=>e.valueComparator(Tn.value,at.value)));qa&&window.requestAnimationFrame(()=>{var at;mt>=0&&((at=Y.value)==null||at.scrollToIndex(mt))})}}),Pi(()=>e.items,(mt,at)=>{J.value||T.value&&!at.length&&mt.length&&(J.value=!0)}),fi(()=>{const mt=!!(!e.hideNoData||gn.value.length||d["prepend-item"]||d["append-item"]||d["no-data"]),at=Ve.value.length>0,Tn=B_.filterProps(e);return de(B_,oi({ref:E},Tn,{modelValue:rt.value,"onUpdate:modelValue":[bn=>rt.value=bn,Zn],focused:T.value,"onUpdate:focused":bn=>T.value=bn,validationValue:Ve.externalValue,counterValue:ft.value,dirty:at,class:["v-combobox",{"v-combobox--active-menu":J.value,"v-combobox--chips":!!e.chips,"v-combobox--selection-slot":!!He.value,"v-combobox--selecting-index":Q.value>-1,[`v-combobox--${e.multiple?"multiple":"single"}`]:!0},e.class],style:e.style,readonly:Ue.isReadonly.value,placeholder:at?void 0:e.placeholder,"onClick:clear":mn,"onMousedown:control":Nn,onKeydown:Fi}),{...d,default:()=>de(sr,null,[de(hv,oi({ref:W,modelValue:J.value,"onUpdate:modelValue":bn=>J.value=bn,activator:"parent",contentClass:"v-combobox__content",disabled:ai.value,eager:e.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:e.transition,onAfterEnter:Ln,onAfterLeave:sn},e.menuProps),{default:()=>[mt&&de(ow,oi({ref:_n,selected:pn.value,selectStrategy:e.multiple?"independent":"single-independent",onMousedown:bn=>bn.preventDefault(),onKeydown:Ci,onFocusin:pi,onFocusout:ht,tabindex:"-1","aria-live":"polite",color:e.itemColor??e.color},Bn,e.listProps),{default:()=>{var bn,Cn,zn;return[(bn=d["prepend-item"])==null?void 0:bn.call(d),!gn.value.length&&!e.hideNoData&&(((Cn=d["no-data"])==null?void 0:Cn.call(d))??de(km,{key:"no-data",title:b(e.noDataText)},null)),de(uw,{ref:Y,renderless:!0,items:gn.value},{default:vi=>{var ui;let{item:ii,index:wi,itemRef:Ki}=vi;const Vi=oi(ii.props,{ref:Ki,key:ii.value,active:ri.value&&wi===0?!0:void 0,onClick:()=>qn(ii,null)});return((ui=d.item)==null?void 0:ui.call(d,{item:ii,index:wi,props:Vi}))??de(km,oi(Vi,{role:"option"}),{prepend:pr=>{let{isSelected:Er}=pr;return de(sr,null,[e.multiple&&!e.hideSelected?de(Am,{key:ii.value,modelValue:Er,ripple:!1,tabindex:"-1"},null):void 0,ii.props.prependAvatar&&de(Vd,{image:ii.props.prependAvatar},null),ii.props.prependIcon&&de(Ka,{icon:ii.props.prependIcon},null)])},title:()=>{var pr,Er;return t.value?ii.title:GG(ii.title,(pr=hn(ii))==null?void 0:pr.title,((Er=rt.value)==null?void 0:Er.length)??0)}})}}),(zn=d["append-item"])==null?void 0:zn.call(d)]}})]}),Ve.value.map((bn,Cn)=>{function zn(Ki){Ki.stopPropagation(),Ki.preventDefault(),qn(bn,!1)}const vi={"onClick:close":zn,onKeydown(Ki){Ki.key!=="Enter"&&Ki.key!==" "||(Ki.preventDefault(),Ki.stopPropagation(),zn(Ki))},onMousedown(Ki){Ki.preventDefault(),Ki.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},ii=qe.value?!!d.chip:!!d.selection,wi=ii?X1(qe.value?d.chip({item:bn,index:Cn,props:vi}):d.selection({item:bn,index:Cn})):void 0;if(!(ii&&!wi))return de("div",{key:bn.value,class:["v-combobox__selection",Cn===Q.value&&["v-combobox__selection--selected",Le.value]],style:Cn===Q.value?Oe.value:{}},[qe.value?d.chip?de(da,{key:"chip-defaults",defaults:{VChip:{closable:e.closableChips,size:"small",text:bn.title}}},{default:()=>[wi]}):de(xv,oi({key:"chip",closable:e.closableChips,size:"small",text:bn.title,disabled:bn.props.disabled},vi),null):wi??de("span",{class:"v-combobox__selection-text"},[bn.title,e.multiple&&Cn<Ve.value.length-1&&de("span",{class:"v-combobox__selection-comma"},[Kc(",")])])])})]),"append-inner":function(){var vi;for(var bn=arguments.length,Cn=new Array(bn),zn=0;zn<bn;zn++)Cn[zn]=arguments[zn];return de(sr,null,[(vi=d["append-inner"])==null?void 0:vi.call(d,...Cn),(!e.hideNoData||e.items.length)&&e.menuIcon?de(Ka,{class:"v-combobox__menu-icon",icon:e.menuIcon,onMousedown:Pn,onClick:kR,"aria-label":b(pe.value),title:b(pe.value),tabindex:"-1"},null):void 0])}})}),$d({isFocused:T,isPristine:t,menu:J,search:rt,selectionIndex:Q,filteredItems:$t,select:qn},E)}}),ZG=vn({modelValue:null,color:String,cancelText:{type:String,default:"$vuetify.confirmEdit.cancel"},okText:{type:String,default:"$vuetify.confirmEdit.ok"}},"VConfirmEdit"),WG=Qn()({name:"VConfirmEdit",props:ZG(),emits:{cancel:()=>!0,save:e=>!0,"update:modelValue":e=>!0},setup(e,s){let{emit:u,slots:d}=s;const b=mr(e,"modelValue"),E=yi();Jo(()=>{E.value=structuredClone(Gr(b.value))});const{t:T}=Uo(),t=Fe(()=>Gp(b.value,E.value));function G(){b.value=E.value,u("save",E.value)}function W(){E.value=structuredClone(Gr(b.value)),u("cancel")}function Y(J){return de(sr,null,[de(Ya,oi({disabled:t.value,variant:"text",color:e.color,onClick:W,text:T(e.cancelText)},J),null),de(Ya,oi({disabled:t.value,variant:"text",color:e.color,onClick:G,text:T(e.okText)},J),null)])}let ne=!1;return fi(()=>{var J;return de(sr,null,[(J=d.default)==null?void 0:J.call(d,{model:E,save:G,cancel:W,isPristine:t.value,get actions(){return ne=!0,Y}}),!ne&&Y()])}),{save:G,cancel:W,isPristine:t}}}),Mz=vn({expandOnClick:Boolean,showExpand:Boolean,expanded:{type:Array,default:()=>[]}},"DataTable-expand"),Iz=Symbol.for("vuetify:datatable:expanded");function pw(e){const s=$n(e,"expandOnClick"),u=mr(e,"expanded",e.expanded,t=>new Set(t),t=>[...t.values()]);function d(t,G){const W=new Set(u.value);G?W.add(t.value):W.delete(t.value),u.value=W}function b(t){return u.value.has(t.value)}function E(t){d(t,!b(t))}const T={expand:d,expanded:u,expandOnClick:s,isExpanded:b,toggleExpand:E};return xa(Iz,T),T}function Pz(){const e=vr(Iz);if(!e)throw new Error("foo");return e}const KC=vn({groupBy:{type:Array,default:()=>[]}},"DataTable-group"),Az=Symbol.for("vuetify:data-table-group");function JC(e){return{groupBy:mr(e,"groupBy")}}function mw(e){const{disableSort:s,groupBy:u,sortBy:d}=e,b=yi(new Set),E=Fe(()=>u.value.map(Y=>({...Y,order:Y.order??!1})).concat(s!=null&&s.value?[]:d.value));function T(Y){return b.value.has(Y.id)}function t(Y){const ne=new Set(b.value);T(Y)?ne.delete(Y.id):ne.add(Y.id),b.value=ne}function G(Y){function ne(J){const Q=[];for(const ce of J.items)"type"in ce&&ce.type==="group"?Q.push(...ne(ce)):Q.push(ce);return[...new Set(Q)]}return ne({type:"group",items:Y,id:"dummy",key:"dummy",value:"dummy",depth:0})}const W={sortByWithGroups:E,toggleGroup:t,opened:b,groupBy:u,extractRows:G,isGroupOpen:T};return xa(Az,W),W}function kz(){const e=vr(Az);if(!e)throw new Error("Missing group!");return e}function XG(e,s){if(!e.length)return[];const u=new Map;for(const d of e){const b=F_(d.raw,s);u.has(b)||u.set(b,[]),u.get(b).push(d)}return u}function Dz(e,s){let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,d=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"root";if(!s.length)return[];const b=XG(e,s[0]),E=[],T=s.slice(1);return b.forEach((t,G)=>{const W=s[0],Y=`${d}_${W}_${G}`;E.push({depth:u,id:Y,key:W,value:G,items:T.length?Dz(t,T,u+1,Y):t,type:"group"})}),E}function Rz(e,s){const u=[];for(const d of e)"type"in d&&d.type==="group"?(d.value!=null&&u.push(d),(s.has(d.id)||d.value==null)&&u.push(...Rz(d.items,s))):u.push(d);return u}function gw(e,s,u){return{flatItems:Fe(()=>{if(!s.value.length)return e.value;const b=Dz(e.value,s.value.map(E=>E.key));return Rz(b,u.value)})}}function _w(e){let{page:s,itemsPerPage:u,sortBy:d,groupBy:b,search:E}=e;const T=Po("VDataTable"),t=Fe(()=>({page:s.value,itemsPerPage:u.value,sortBy:d.value,groupBy:b.value,search:E.value}));let G=null;Pi(t,()=>{Gp(G,t.value)||(G&&G.search!==t.value.search&&(s.value=1),T.emit("update:options",t.value),G=t.value)},{deep:!0,immediate:!0})}const QC=vn({page:{type:[Number,String],default:1},itemsPerPage:{type:[Number,String],default:10}},"DataTable-paginate"),Lz=Symbol.for("vuetify:data-table-pagination");function eE(e){const s=mr(e,"page",void 0,d=>+(d??1)),u=mr(e,"itemsPerPage",void 0,d=>+(d??10));return{page:s,itemsPerPage:u}}function tE(e){const{page:s,itemsPerPage:u,itemsLength:d}=e,b=Fe(()=>u.value===-1?0:u.value*(s.value-1)),E=Fe(()=>u.value===-1?d.value:Math.min(d.value,b.value+u.value)),T=Fe(()=>u.value===-1||d.value===0?1:Math.ceil(d.value/u.value));Pi([s,T],()=>{s.value>T.value&&(s.value=T.value)});function t(J){u.value=J,s.value=1}function G(){s.value=Ko(s.value+1,1,T.value)}function W(){s.value=Ko(s.value-1,1,T.value)}function Y(J){s.value=Ko(J,1,T.value)}const ne={page:s,itemsPerPage:u,startIndex:b,stopIndex:E,pageCount:T,itemsLength:d,nextPage:G,prevPage:W,setPage:Y,setItemsPerPage:t};return xa(Lz,ne),ne}function YG(){const e=vr(Lz);if(!e)throw new Error("Missing pagination!");return e}function zz(e){const s=Po("usePaginatedItems"),{items:u,startIndex:d,stopIndex:b,itemsPerPage:E}=e,T=Fe(()=>E.value<=0?u.value:u.value.slice(d.value,b.value));return Pi(T,t=>{s.emit("update:currentItems",t)},{immediate:!0}),{paginatedItems:T}}const KG={showSelectAll:!1,allSelected:()=>[],select:e=>{var d;let{items:s,value:u}=e;return new Set(u?[(d=s[0])==null?void 0:d.value]:[])},selectAll:e=>{let{selected:s}=e;return s}},Oz={showSelectAll:!0,allSelected:e=>{let{currentPage:s}=e;return s},select:e=>{let{items:s,value:u,selected:d}=e;for(const b of s)u?d.add(b.value):d.delete(b.value);return d},selectAll:e=>{let{value:s,currentPage:u,selected:d}=e;return Oz.select({items:u,value:s,selected:d})}},Fz={showSelectAll:!0,allSelected:e=>{let{allItems:s}=e;return s},select:e=>{let{items:s,value:u,selected:d}=e;for(const b of s)u?d.add(b.value):d.delete(b.value);return d},selectAll:e=>{let{value:s,allItems:u,selected:d}=e;return Fz.select({items:u,value:s,selected:d})}},Bz=vn({showSelect:Boolean,selectStrategy:{type:[String,Object],default:"page"},modelValue:{type:Array,default:()=>[]},valueComparator:{type:Function,default:Gp}},"DataTable-select"),Vz=Symbol.for("vuetify:data-table-selection");function yw(e,s){let{allItems:u,currentPage:d}=s;const b=mr(e,"modelValue",e.modelValue,be=>new Set(po(be).map(Ie=>{var $e;return(($e=u.value.find(Le=>e.valueComparator(Ie,Le.value)))==null?void 0:$e.value)??Ie})),be=>[...be.values()]),E=Fe(()=>u.value.filter(be=>be.selectable)),T=Fe(()=>d.value.filter(be=>be.selectable)),t=Fe(()=>{if(typeof e.selectStrategy=="object")return e.selectStrategy;switch(e.selectStrategy){case"single":return KG;case"all":return Fz;case"page":default:return Oz}});function G(be){return po(be).every(Ie=>b.value.has(Ie.value))}function W(be){return po(be).some(Ie=>b.value.has(Ie.value))}function Y(be,Ie){const $e=t.value.select({items:be,value:Ie,selected:new Set(b.value)});b.value=$e}function ne(be){Y([be],!G([be]))}function J(be){const Ie=t.value.selectAll({value:be,allItems:E.value,currentPage:T.value,selected:new Set(b.value)});b.value=Ie}const Q=Fe(()=>b.value.size>0),ce=Fe(()=>{const be=t.value.allSelected({allItems:E.value,currentPage:T.value});return!!be.length&&G(be)}),ie=Fe(()=>t.value.showSelectAll),pe={toggleSelect:ne,select:Y,selectAll:J,isSelected:G,isSomeSelected:W,someSelected:Q,allSelected:ce,showSelectAll:ie};return xa(Vz,pe),pe}function vw(){const e=vr(Vz);if(!e)throw new Error("Missing selection!");return e}const Nz=vn({sortBy:{type:Array,default:()=>[]},customKeySort:Object,multiSort:Boolean,mustSort:Boolean},"DataTable-sort"),jz=Symbol.for("vuetify:data-table-sort");function xw(e){const s=mr(e,"sortBy"),u=$n(e,"mustSort"),d=$n(e,"multiSort");return{sortBy:s,mustSort:u,multiSort:d}}function bw(e){const{sortBy:s,mustSort:u,multiSort:d,page:b}=e,E=G=>{if(G.key==null)return;let W=s.value.map(ne=>({...ne}))??[];const Y=W.find(ne=>ne.key===G.key);Y?Y.order==="desc"?u.value?Y.order="asc":W=W.filter(ne=>ne.key!==G.key):Y.order="desc":d.value?W=[...W,{key:G.key,order:"asc"}]:W=[{key:G.key,order:"asc"}],s.value=W,b&&(b.value=1)};function T(G){return!!s.value.find(W=>W.key===G.key)}const t={sortBy:s,toggleSort:E,isSorted:T};return xa(jz,t),t}function Uz(){const e=vr(jz);if(!e)throw new Error("Missing sort!");return e}function nE(e,s,u,d){const b=Uo();return{sortedItems:Fe(()=>{var T,t;return u.value.length?JG(s.value,u.value,b.current.value,{transform:d==null?void 0:d.transform,sortFunctions:{...e.customKeySort,...(T=d==null?void 0:d.sortFunctions)==null?void 0:T.value},sortRawFunctions:(t=d==null?void 0:d.sortRawFunctions)==null?void 0:t.value}):s.value})}}function JG(e,s,u,d){const b=new Intl.Collator(u,{sensitivity:"accent",usage:"sort"});return e.map(T=>[T,d!=null&&d.transform?d.transform(T):T]).sort((T,t)=>{var G,W;for(let Y=0;Y<s.length;Y++){let ne=!1;const J=s[Y].key,Q=s[Y].order??"asc";if(Q===!1)continue;let ce=F_(T[1],J),ie=F_(t[1],J),pe=T[0].raw,be=t[0].raw;if(Q==="desc"&&([ce,ie]=[ie,ce],[pe,be]=[be,pe]),(G=d==null?void 0:d.sortRawFunctions)!=null&&G[J]){const Ie=d.sortRawFunctions[J](pe,be);if(Ie==null)continue;if(ne=!0,Ie)return Ie}if((W=d==null?void 0:d.sortFunctions)!=null&&W[J]){const Ie=d.sortFunctions[J](ce,ie);if(Ie==null)continue;if(ne=!0,Ie)return Ie}if(!ne){if(ce instanceof Date&&ie instanceof Date)return ce.getTime()-ie.getTime();if([ce,ie]=[ce,ie].map(Ie=>Ie!=null?Ie.toString().toLocaleLowerCase():Ie),ce!==ie)return H0(ce)&&H0(ie)?0:H0(ce)?-1:H0(ie)?1:!isNaN(ce)&&!isNaN(ie)?Number(ce)-Number(ie):b.compare(ce,ie)}}return 0}).map(T=>{let[t]=T;return t})}const QG=vn({items:{type:Array,default:()=>[]},itemValue:{type:[String,Array,Function],default:"id"},itemSelectable:{type:[String,Array,Function],default:null},returnObject:Boolean},"DataIterator-items");function eq(e,s){const u=e.returnObject?s:Sl(s,e.itemValue),d=Sl(s,e.itemSelectable,!0);return{type:"item",value:u,selectable:d,raw:s}}function tq(e,s){const u=[];for(const d of s)u.push(eq(e,d));return u}function nq(e){return{items:Fe(()=>tq(e,e.items))}}const iq=vn({search:String,loading:Boolean,...tr(),...QG(),...Bz(),...Nz(),...QC({itemsPerPage:5}),...Mz(),...KC(),...Cb(),...ia(),...$f({transition:{component:nb,hideOnLeave:!0}})},"VDataIterator"),rq=Qn()({name:"VDataIterator",props:iq(),emits:{"update:modelValue":e=>!0,"update:groupBy":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:currentItems":e=>!0},setup(e,s){let{slots:u}=s;const d=mr(e,"groupBy"),b=$n(e,"search"),{items:E}=nq(e),{filteredItems:T}=Eb(e,E,b,{transform:mn=>mn.raw}),{sortBy:t,multiSort:G,mustSort:W}=xw(e),{page:Y,itemsPerPage:ne}=eE(e),{toggleSort:J}=bw({sortBy:t,multiSort:G,mustSort:W,page:Y}),{sortByWithGroups:Q,opened:ce,extractRows:ie,isGroupOpen:pe,toggleGroup:be}=mw({groupBy:d,sortBy:t}),{sortedItems:Ie}=nE(e,T,Q,{transform:mn=>mn.raw}),{flatItems:$e}=gw(Ie,d,ce),Le=Fe(()=>$e.value.length),{startIndex:Oe,stopIndex:Ve,pageCount:Ue,prevPage:qe,nextPage:He,setItemsPerPage:nt,setPage:rt}=tE({page:Y,itemsPerPage:ne,itemsLength:Le}),{paginatedItems:ft}=zz({items:$e,startIndex:Oe,stopIndex:Ve,itemsPerPage:ne}),$t=Fe(()=>ie(ft.value)),{isSelected:hn,select:gn,selectAll:pn,toggleSelect:ri}=yw(e,{allItems:E,currentPage:$t}),{isExpanded:ai,toggleExpand:_n}=pw(e);_w({page:Y,itemsPerPage:ne,sortBy:t,groupBy:d,search:b});const Bn=Fe(()=>({page:Y.value,itemsPerPage:ne.value,sortBy:t.value,pageCount:Ue.value,toggleSort:J,prevPage:qe,nextPage:He,setPage:rt,setItemsPerPage:nt,isSelected:hn,select:gn,selectAll:pn,toggleSelect:ri,isExpanded:ai,toggleExpand:_n,isGroupOpen:pe,toggleGroup:be,items:$t.value,groupedItems:ft.value}));return fi(()=>de(e.tag,{class:["v-data-iterator",{"v-data-iterator--loading":e.loading},e.class],style:e.style},{default:()=>{var mn,Nn;return[(mn=u.header)==null?void 0:mn.call(u,Bn.value),de(eu,{transition:e.transition},{default:()=>{var Pn,Ci;return[e.loading?de(yb,{key:"loader",name:"v-data-iterator",active:!0},{default:Fi=>{var Ln;return(Ln=u.loader)==null?void 0:Ln.call(u,Fi)}}):de("div",{key:"items"},[ft.value.length?(Ci=u.default)==null?void 0:Ci.call(u,Bn.value):(Pn=u["no-data"])==null?void 0:Pn.call(u)])]}}),(Nn=u.footer)==null?void 0:Nn.call(u,Bn.value)]}})),{}}});function aq(){const e=yi([]);bD(()=>e.value=[]);function s(u,d){e.value[d]=u}return{refs:e,updateRef:s}}const sq=vn({activeColor:String,start:{type:[Number,String],default:1},modelValue:{type:Number,default:e=>e.start},disabled:Boolean,length:{type:[Number,String],default:1,validator:e=>e%1===0},totalVisible:[Number,String],firstIcon:{type:_r,default:"$first"},prevIcon:{type:_r,default:"$prev"},nextIcon:{type:_r,default:"$next"},lastIcon:{type:_r,default:"$last"},ariaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.root"},pageAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.page"},currentPageAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.currentPage"},firstAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.first"},previousAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.previous"},nextAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.next"},lastAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.last"},ellipsis:{type:String,default:"..."},showFirstLastPage:Boolean,...gh(),...tr(),...Hl(),...El(),...Qs(),...Zp(),...ia({tag:"nav"}),...Da(),...Ud({variant:"text"})},"VPagination"),AT=Qn()({name:"VPagination",props:sq(),emits:{"update:modelValue":e=>!0,first:e=>!0,prev:e=>!0,next:e=>!0,last:e=>!0},setup(e,s){let{slots:u,emit:d}=s;const b=mr(e,"modelValue"),{t:E,n:T}=Uo(),{isRtl:t}=Cl(),{themeClasses:G}=Ja(e),{width:W}=jd(),Y=Bi(-1);Io(void 0,{scoped:!0});const{resizeRef:ne}=Ff(qe=>{if(!qe.length)return;const{target:He,contentRect:nt}=qe[0],rt=He.querySelector(".v-pagination__list > *");if(!rt)return;const ft=nt.width,$t=rt.offsetWidth+parseFloat(getComputedStyle(rt).marginRight)*2;Y.value=ie(ft,$t)}),J=Fe(()=>parseInt(e.length,10)),Q=Fe(()=>parseInt(e.start,10)),ce=Fe(()=>e.totalVisible!=null?parseInt(e.totalVisible,10):Y.value>=0?Y.value:ie(W.value,58));function ie(qe,He){const nt=e.showFirstLastPage?5:3;return Math.max(0,Math.floor(+((qe-He*nt)/He).toFixed(2)))}const pe=Fe(()=>{if(J.value<=0||isNaN(J.value)||J.value>Number.MAX_SAFE_INTEGER)return[];if(ce.value<=0)return[];if(ce.value===1)return[b.value];if(J.value<=ce.value)return Vp(J.value,Q.value);const qe=ce.value%2===0,He=qe?ce.value/2:Math.floor(ce.value/2),nt=qe?He:He+1,rt=J.value-He;if(nt-b.value>=0)return[...Vp(Math.max(1,ce.value-1),Q.value),e.ellipsis,J.value];if(b.value-rt>=(qe?1:0)){const ft=ce.value-1,$t=J.value-ft+Q.value;return[Q.value,e.ellipsis,...Vp(ft,$t)]}else{const ft=Math.max(1,ce.value-2),$t=ft===1?b.value:b.value-Math.ceil(ft/2)+Q.value;return[Q.value,e.ellipsis,...Vp(ft,$t),e.ellipsis,J.value]}});function be(qe,He,nt){qe.preventDefault(),b.value=He,nt&&d(nt,He)}const{refs:Ie,updateRef:$e}=aq();Io({VPaginationBtn:{color:$n(e,"color"),border:$n(e,"border"),density:$n(e,"density"),size:$n(e,"size"),variant:$n(e,"variant"),rounded:$n(e,"rounded"),elevation:$n(e,"elevation")}});const Le=Fe(()=>pe.value.map((qe,He)=>{const nt=rt=>$e(rt,He);if(typeof qe=="string")return{isActive:!1,key:`ellipsis-${He}`,page:qe,props:{ref:nt,ellipsis:!0,icon:!0,disabled:!0}};{const rt=qe===b.value;return{isActive:rt,key:qe,page:T(qe),props:{ref:nt,ellipsis:!1,icon:!0,disabled:!!e.disabled||+e.length<2,color:rt?e.activeColor:e.color,"aria-current":rt,"aria-label":E(rt?e.currentPageAriaLabel:e.pageAriaLabel,qe),onClick:ft=>be(ft,qe)}}}})),Oe=Fe(()=>{const qe=!!e.disabled||b.value<=Q.value,He=!!e.disabled||b.value>=Q.value+J.value-1;return{first:e.showFirstLastPage?{icon:t.value?e.lastIcon:e.firstIcon,onClick:nt=>be(nt,Q.value,"first"),disabled:qe,"aria-label":E(e.firstAriaLabel),"aria-disabled":qe}:void 0,prev:{icon:t.value?e.nextIcon:e.prevIcon,onClick:nt=>be(nt,b.value-1,"prev"),disabled:qe,"aria-label":E(e.previousAriaLabel),"aria-disabled":qe},next:{icon:t.value?e.prevIcon:e.nextIcon,onClick:nt=>be(nt,b.value+1,"next"),disabled:He,"aria-label":E(e.nextAriaLabel),"aria-disabled":He},last:e.showFirstLastPage?{icon:t.value?e.firstIcon:e.lastIcon,onClick:nt=>be(nt,Q.value+J.value-1,"last"),disabled:He,"aria-label":E(e.lastAriaLabel),"aria-disabled":He}:void 0}});function Ve(){var He;const qe=b.value-Q.value;(He=Ie.value[qe])==null||He.$el.focus()}function Ue(qe){qe.key===rT.left&&!e.disabled&&b.value>+e.start?(b.value=b.value-1,Na(Ve)):qe.key===rT.right&&!e.disabled&&b.value<Q.value+J.value-1&&(b.value=b.value+1,Na(Ve))}return fi(()=>de(e.tag,{ref:ne,class:["v-pagination",G.value,e.class],style:e.style,role:"navigation","aria-label":E(e.ariaLabel),onKeydown:Ue,"data-test":"v-pagination-root"},{default:()=>[de("ul",{class:"v-pagination__list"},[e.showFirstLastPage&&de("li",{key:"first",class:"v-pagination__first","data-test":"v-pagination-first"},[u.first?u.first(Oe.value.first):de(Ya,oi({_as:"VPaginationBtn"},Oe.value.first),null)]),de("li",{key:"prev",class:"v-pagination__prev","data-test":"v-pagination-prev"},[u.prev?u.prev(Oe.value.prev):de(Ya,oi({_as:"VPaginationBtn"},Oe.value.prev),null)]),Le.value.map((qe,He)=>de("li",{key:qe.key,class:["v-pagination__item",{"v-pagination__item--is-active":qe.isActive}],"data-test":"v-pagination-item"},[u.item?u.item(qe):de(Ya,oi({_as:"VPaginationBtn"},qe.props),{default:()=>[qe.page]})])),de("li",{key:"next",class:"v-pagination__next","data-test":"v-pagination-next"},[u.next?u.next(Oe.value.next):de(Ya,oi({_as:"VPaginationBtn"},Oe.value.next),null)]),e.showFirstLastPage&&de("li",{key:"last",class:"v-pagination__last","data-test":"v-pagination-last"},[u.last?u.last(Oe.value.last):de(Ya,oi({_as:"VPaginationBtn"},Oe.value.last),null)])])]})),{}}}),iE=vn({prevIcon:{type:_r,default:"$prev"},nextIcon:{type:_r,default:"$next"},firstIcon:{type:_r,default:"$first"},lastIcon:{type:_r,default:"$last"},itemsPerPageText:{type:String,default:"$vuetify.dataFooter.itemsPerPageText"},pageText:{type:String,default:"$vuetify.dataFooter.pageText"},firstPageLabel:{type:String,default:"$vuetify.dataFooter.firstPage"},prevPageLabel:{type:String,default:"$vuetify.dataFooter.prevPage"},nextPageLabel:{type:String,default:"$vuetify.dataFooter.nextPage"},lastPageLabel:{type:String,default:"$vuetify.dataFooter.lastPage"},itemsPerPageOptions:{type:Array,default:()=>[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"},{value:-1,title:"$vuetify.dataFooter.itemsPerPageAll"}]},showCurrentPage:Boolean},"VDataTableFooter"),lb=Qn()({name:"VDataTableFooter",props:iE(),setup(e,s){let{slots:u}=s;const{t:d}=Uo(),{page:b,pageCount:E,startIndex:T,stopIndex:t,itemsLength:G,itemsPerPage:W,setItemsPerPage:Y}=YG(),ne=Fe(()=>e.itemsPerPageOptions.map(J=>typeof J=="number"?{value:J,title:J===-1?d("$vuetify.dataFooter.itemsPerPageAll"):String(J)}:{...J,title:isNaN(Number(J.title))?d(J.title):J.title}));return fi(()=>{var Q;const J=AT.filterProps(e);return de("div",{class:"v-data-table-footer"},[(Q=u.prepend)==null?void 0:Q.call(u),de("div",{class:"v-data-table-footer__items-per-page"},[de("span",null,[d(e.itemsPerPageText)]),de(WC,{items:ne.value,modelValue:W.value,"onUpdate:modelValue":ce=>Y(Number(ce)),density:"compact",variant:"outlined","hide-details":!0},null)]),de("div",{class:"v-data-table-footer__info"},[de("div",null,[d(e.pageText,G.value?T.value+1:0,t.value,G.value)])]),de("div",{class:"v-data-table-footer__pagination"},[de(AT,oi({modelValue:b.value,"onUpdate:modelValue":ce=>b.value=ce,density:"comfortable","first-aria-label":e.firstPageLabel,"last-aria-label":e.lastPageLabel,length:E.value,"next-aria-label":e.nextPageLabel,"previous-aria-label":e.prevPageLabel,rounded:!0,"show-first-last-page":!0,"total-visible":e.showCurrentPage?1:0,variant:"plain"},J),null)])])}),{}}}),P1=Y6({align:{type:String,default:"start"},fixed:Boolean,fixedOffset:[Number,String],height:[Number,String],lastFixed:Boolean,noPadding:Boolean,tag:String,width:[Number,String],maxWidth:[Number,String],nowrap:Boolean},(e,s)=>{let{slots:u}=s;const d=e.tag??"td";return de(d,{class:["v-data-table__td",{"v-data-table-column--fixed":e.fixed,"v-data-table-column--last-fixed":e.lastFixed,"v-data-table-column--no-padding":e.noPadding,"v-data-table-column--nowrap":e.nowrap},`v-data-table-column--align-${e.align}`],style:{height:Ji(e.height),width:Ji(e.width),maxWidth:Ji(e.maxWidth),left:Ji(e.fixedOffset||null)}},{default:()=>{var b;return[(b=u.default)==null?void 0:b.call(u)]}})}),oq=vn({headers:Array},"DataTable-header"),$z=Symbol.for("vuetify:data-table-headers"),Gz={title:"",sortable:!1},lq={...Gz,width:48};function cq(){const s=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:[]).map(u=>({element:u,priority:0}));return{enqueue:(u,d)=>{let b=!1;for(let E=0;E<s.length;E++)if(s[E].priority>d){s.splice(E,0,{element:u,priority:d}),b=!0;break}b||s.push({element:u,priority:d})},size:()=>s.length,count:()=>{let u=0;if(!s.length)return 0;const d=Math.floor(s[0].priority);for(let b=0;b<s.length;b++)Math.floor(s[b].priority)===d&&(u+=1);return u},dequeue:()=>s.shift()}}function kT(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];if(!e.children)s.push(e);else for(const u of e.children)kT(u,s);return s}function qz(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:new Set;for(const u of e)u.key&&s.add(u.key),u.children&&qz(u.children,s);return s}function uq(e){if(e.key){if(e.key==="data-table-group")return Gz;if(["data-table-expand","data-table-select"].includes(e.key))return lq}}function rE(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return e.children?Math.max(s,...e.children.map(u=>rE(u,s+1))):s}function hq(e){let s=!1;function u(E){let T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(E)if(T&&(E.fixed=!0),E.fixed)if(E.children)for(let t=E.children.length-1;t>=0;t--)u(E.children[t],!0);else s?isNaN(+E.width)&&(`${E.key}`,void 0):E.lastFixed=!0,s=!0;else if(E.children)for(let t=E.children.length-1;t>=0;t--)u(E.children[t]);else s=!1}for(let E=e.length-1;E>=0;E--)u(e[E]);function d(E){let T=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;if(!E)return T;if(E.children){E.fixedOffset=T;for(const t of E.children)T=d(t,T)}else E.fixed&&(E.fixedOffset=T,T+=parseFloat(E.width||"0")||0);return T}let b=0;for(const E of e)b=d(E,b)}function dq(e,s){const u=[];let d=0;const b=cq(e);for(;b.size()>0;){let T=b.count();const t=[];let G=1;for(;T>0;){const{element:W,priority:Y}=b.dequeue(),ne=s-d-rE(W);if(t.push({...W,rowspan:ne??1,colspan:W.children?kT(W).length:1}),W.children)for(const J of W.children){const Q=Y%1+G/Math.pow(10,d+2);b.enqueue(J,d+ne+Q)}G+=1,T-=1}d+=1,u.push(t)}return{columns:e.map(T=>kT(T)).flat(),headers:u}}function Hz(e){const s=[];for(const u of e){const d={...uq(u),...u},b=d.key??(typeof d.value=="string"?d.value:null),E=d.value??b??null,T={...d,key:b,value:E,sortable:d.sortable??(d.key!=null||!!d.sort),children:d.children?Hz(d.children):void 0};s.push(T)}return s}function aE(e,s){const u=yi([]),d=yi([]),b=yi({}),E=yi({}),T=yi({});Jo(()=>{var ie,pe,be;const W=(e.headers||Object.keys(e.items[0]??{}).map(Ie=>({key:Ie,title:$p(Ie)}))).slice(),Y=qz(W);(ie=s==null?void 0:s.groupBy)!=null&&ie.value.length&&!Y.has("data-table-group")&&W.unshift({key:"data-table-group",title:"Group"}),(pe=s==null?void 0:s.showSelect)!=null&&pe.value&&!Y.has("data-table-select")&&W.unshift({key:"data-table-select"}),(be=s==null?void 0:s.showExpand)!=null&&be.value&&!Y.has("data-table-expand")&&W.push({key:"data-table-expand"});const ne=Hz(W);hq(ne);const J=Math.max(...ne.map(Ie=>rE(Ie)))+1,Q=dq(ne,J);u.value=Q.headers,d.value=Q.columns;const ce=Q.headers.flat(1);for(const Ie of ce)Ie.key&&(Ie.sortable&&(Ie.sort&&(b.value[Ie.key]=Ie.sort),Ie.sortRaw&&(E.value[Ie.key]=Ie.sortRaw)),Ie.filter&&(T.value[Ie.key]=Ie.filter))});const t={headers:u,columns:d,sortFunctions:b,sortRawFunctions:E,filterFunctions:T};return xa($z,t),t}function ww(){const e=vr($z);if(!e)throw new Error("Missing headers!");return e}const Zz=vn({color:String,disableSort:Boolean,fixedHeader:Boolean,multiSort:Boolean,sortAscIcon:{type:_r,default:"$sortAsc"},sortDescIcon:{type:_r,default:"$sortDesc"},headerProps:{type:Object},sticky:Boolean,...W_(),...iw()},"VDataTableHeaders"),U_=Qn()({name:"VDataTableHeaders",props:Zz(),setup(e,s){let{slots:u}=s;const{t:d}=Uo(),{toggleSort:b,sortBy:E,isSorted:T}=Uz(),{someSelected:t,allSelected:G,selectAll:W,showSelectAll:Y}=vw(),{columns:ne,headers:J}=ww(),{loaderClasses:Q}=_b(e);function ce(qe,He){if(!(!(e.sticky||e.fixedHeader)&&!qe.fixed))return{position:"sticky",left:qe.fixed?Ji(qe.fixedOffset):void 0,top:e.sticky||e.fixedHeader?`calc(var(--v-table-header-height) * ${He})`:void 0}}function ie(qe){const He=E.value.find(nt=>nt.key===qe.key);return He?He.order==="asc"?e.sortAscIcon:e.sortDescIcon:e.sortAscIcon}const{backgroundColorClasses:pe,backgroundColorStyles:be}=Ms(e,"color"),{displayClasses:Ie,mobile:$e}=jd(e),Le=Fe(()=>({headers:J.value,columns:ne.value,toggleSort:b,isSorted:T,sortBy:E.value,someSelected:t.value,allSelected:G.value,selectAll:W,getSortIcon:ie})),Oe=Fe(()=>["v-data-table__th",{"v-data-table__th--sticky":e.sticky||e.fixedHeader},Ie.value,Q.value]),Ve=qe=>{let{column:He,x:nt,y:rt}=qe;const ft=He.key==="data-table-select"||He.key==="data-table-expand",$t=oi(e.headerProps??{},He.headerProps??{});return de(P1,oi({tag:"th",align:He.align,class:[{"v-data-table__th--sortable":He.sortable&&!e.disableSort,"v-data-table__th--sorted":T(He),"v-data-table__th--fixed":He.fixed},...Oe.value],style:{width:Ji(He.width),minWidth:Ji(He.minWidth),maxWidth:Ji(He.maxWidth),...ce(He,rt)},colspan:He.colspan,rowspan:He.rowspan,onClick:He.sortable?()=>b(He):void 0,fixed:He.fixed,nowrap:He.nowrap,lastFixed:He.lastFixed,noPadding:ft},$t),{default:()=>{var pn;const hn=`header.${He.key}`,gn={column:He,selectAll:W,isSorted:T,toggleSort:b,sortBy:E.value,someSelected:t.value,allSelected:G.value,getSortIcon:ie};return u[hn]?u[hn](gn):He.key==="data-table-select"?((pn=u["header.data-table-select"])==null?void 0:pn.call(u,gn))??(Y.value&&de(Am,{modelValue:G.value,indeterminate:t.value&&!G.value,"onUpdate:modelValue":W},null)):de("div",{class:"v-data-table-header__content"},[de("span",null,[He.title]),He.sortable&&!e.disableSort&&de(Ka,{key:"icon",class:"v-data-table-header__sort-icon",icon:ie(He)},null),e.multiSort&&T(He)&&de("div",{key:"badge",class:["v-data-table-header__sort-badge",...pe.value],style:be.value},[E.value.findIndex(ri=>ri.key===He.key)+1])])}})},Ue=()=>{const qe=oi(e.headerProps??{}??{}),He=Fe(()=>ne.value.filter(rt=>(rt==null?void 0:rt.sortable)&&!e.disableSort)),nt=Fe(()=>{if(ne.value.find(ft=>ft.key==="data-table-select")!=null)return G.value?"$checkboxOn":t.value?"$checkboxIndeterminate":"$checkboxOff"});return de(P1,oi({tag:"th",class:[...Oe.value],colspan:J.value.length+1},qe),{default:()=>[de("div",{class:"v-data-table-header__content"},[de(WC,{chips:!0,class:"v-data-table__td-sort-select",clearable:!0,density:"default",items:He.value,label:d("$vuetify.dataTable.sortBy"),multiple:e.multiSort,variant:"underlined","onClick:clear":()=>E.value=[],appendIcon:nt.value,"onClick:append":()=>W(!G.value)},{...u,chip:rt=>{var ft;return de(xv,{onClick:(ft=rt.item.raw)!=null&&ft.sortable?()=>b(rt.item.raw):void 0,onMousedown:$t=>{$t.preventDefault(),$t.stopPropagation()}},{default:()=>[rt.item.title,de(Ka,{class:["v-data-table__td-sort-icon",T(rt.item.raw)&&"v-data-table__td-sort-icon-active"],icon:ie(rt.item.raw),size:"small"},null)]})}})])]})};fi(()=>$e.value?de("tr",null,[de(Ue,null,null)]):de(sr,null,[u.headers?u.headers(Le.value):J.value.map((qe,He)=>de("tr",null,[qe.map((nt,rt)=>de(Ve,{column:nt,x:rt,y:He},null))])),e.loading&&de("tr",{class:"v-data-table-progress"},[de("th",{colspan:ne.value.length},[de(yb,{name:"v-data-table-progress",absolute:!0,active:!0,color:typeof e.loading=="boolean"?void 0:e.loading,indeterminate:!0},{default:u.loader})])])]))}}),fq=vn({item:{type:Object,required:!0}},"VDataTableGroupHeaderRow"),pq=Qn()({name:"VDataTableGroupHeaderRow",props:fq(),setup(e,s){let{slots:u}=s;const{isGroupOpen:d,toggleGroup:b,extractRows:E}=kz(),{isSelected:T,isSomeSelected:t,select:G}=vw(),{columns:W}=ww(),Y=Fe(()=>E([e.item]));return()=>de("tr",{class:"v-data-table-group-header-row",style:{"--v-data-table-group-header-row-depth":e.item.depth}},[W.value.map(ne=>{var J,Q;if(ne.key==="data-table-group"){const ce=d(e.item)?"$expand":"$next",ie=()=>b(e.item);return((J=u["data-table-group"])==null?void 0:J.call(u,{item:e.item,count:Y.value.length,props:{icon:ce,onClick:ie}}))??de(P1,{class:"v-data-table-group-header-row__column"},{default:()=>[de(Ya,{size:"small",variant:"text",icon:ce,onClick:ie},null),de("span",null,[e.item.value]),de("span",null,[Kc("("),Y.value.length,Kc(")")])]})}if(ne.key==="data-table-select"){const ce=T(Y.value),ie=t(Y.value)&&!ce,pe=be=>G(Y.value,be);return((Q=u["data-table-select"])==null?void 0:Q.call(u,{props:{modelValue:ce,indeterminate:ie,"onUpdate:modelValue":pe}}))??de("td",null,[de(Am,{modelValue:ce,indeterminate:ie,"onUpdate:modelValue":pe},null)])}return de("td",null,null)})])}}),mq=vn({index:Number,item:Object,cellProps:[Object,Function],onClick:lc(),onContextmenu:lc(),onDblclick:lc(),...W_()},"VDataTableRow"),sE=Qn()({name:"VDataTableRow",props:mq(),setup(e,s){let{slots:u}=s;const{displayClasses:d,mobile:b}=jd(e,"v-data-table__tr"),{isSelected:E,toggleSelect:T,someSelected:t,allSelected:G,selectAll:W}=vw(),{isExpanded:Y,toggleExpand:ne}=Pz(),{toggleSort:J,sortBy:Q,isSorted:ce}=Uz(),{columns:ie}=ww();fi(()=>de("tr",{class:["v-data-table__tr",{"v-data-table__tr--clickable":!!(e.onClick||e.onContextmenu||e.onDblclick)},d.value],onClick:e.onClick,onContextmenu:e.onContextmenu,onDblclick:e.onDblclick},[e.item&&ie.value.map((pe,be)=>{const Ie=e.item,$e=`item.${pe.key}`,Le=`header.${pe.key}`,Oe={index:e.index,item:Ie.raw,internalItem:Ie,value:F_(Ie.columns,pe.key),column:pe,isSelected:E,toggleSelect:T,isExpanded:Y,toggleExpand:ne},Ve={column:pe,selectAll:W,isSorted:ce,toggleSort:J,sortBy:Q.value,someSelected:t.value,allSelected:G.value,getSortIcon:()=>""},Ue=typeof e.cellProps=="function"?e.cellProps({index:Oe.index,item:Oe.item,internalItem:Oe.internalItem,value:Oe.value,column:pe}):e.cellProps,qe=typeof pe.cellProps=="function"?pe.cellProps({index:Oe.index,item:Oe.item,internalItem:Oe.internalItem,value:Oe.value}):pe.cellProps;return de(P1,oi({align:pe.align,class:{"v-data-table__td--expanded-row":pe.key==="data-table-expand","v-data-table__td--select-row":pe.key==="data-table-select"},fixed:pe.fixed,fixedOffset:pe.fixedOffset,lastFixed:pe.lastFixed,maxWidth:b.value?void 0:pe.maxWidth,noPadding:pe.key==="data-table-select"||pe.key==="data-table-expand",nowrap:pe.nowrap,width:b.value?void 0:pe.width},Ue,qe),{default:()=>{var nt,rt,ft,$t,hn;if(u[$e]&&!b.value)return(nt=u[$e])==null?void 0:nt.call(u,Oe);if(pe.key==="data-table-select")return((rt=u["item.data-table-select"])==null?void 0:rt.call(u,Oe))??de(Am,{disabled:!Ie.selectable,modelValue:E([Ie]),onClick:iP(()=>T(Ie),["stop"])},null);if(pe.key==="data-table-expand")return((ft=u["item.data-table-expand"])==null?void 0:ft.call(u,Oe))??de(Ya,{icon:Y(Ie)?"$collapse":"$expand",size:"small",variant:"text",onClick:iP(()=>ne(Ie),["stop"])},null);const He=$x(Oe.value);return b.value?de(sr,null,[de("div",{class:"v-data-table__td-title"},[(($t=u[Le])==null?void 0:$t.call(u,Ve))??pe.title]),de("div",{class:"v-data-table__td-value"},[((hn=u[$e])==null?void 0:hn.call(u,Oe))??He])]):He}})})]))}}),Wz=vn({loading:[Boolean,String],loadingText:{type:String,default:"$vuetify.dataIterator.loadingText"},hideNoData:Boolean,items:{type:Array,default:()=>[]},noDataText:{type:String,default:"$vuetify.noDataText"},rowProps:[Object,Function],cellProps:[Object,Function],...W_()},"VDataTableRows"),$_=Qn()({name:"VDataTableRows",inheritAttrs:!1,props:Wz(),setup(e,s){let{attrs:u,slots:d}=s;const{columns:b}=ww(),{expandOnClick:E,toggleExpand:T,isExpanded:t}=Pz(),{isSelected:G,toggleSelect:W}=vw(),{toggleGroup:Y,isGroupOpen:ne}=kz(),{t:J}=Uo(),{mobile:Q}=jd(e);return fi(()=>{var ce,ie;return e.loading&&(!e.items.length||d.loading)?de("tr",{class:"v-data-table-rows-loading",key:"loading"},[de("td",{colspan:b.value.length},[((ce=d.loading)==null?void 0:ce.call(d))??J(e.loadingText)])]):!e.loading&&!e.items.length&&!e.hideNoData?de("tr",{class:"v-data-table-rows-no-data",key:"no-data"},[de("td",{colspan:b.value.length},[((ie=d["no-data"])==null?void 0:ie.call(d))??J(e.noDataText)])]):de(sr,null,[e.items.map((pe,be)=>{var Le;if(pe.type==="group"){const Oe={index:be,item:pe,columns:b.value,isExpanded:t,toggleExpand:T,isSelected:G,toggleSelect:W,toggleGroup:Y,isGroupOpen:ne};return d["group-header"]?d["group-header"](Oe):de(pq,oi({key:`group-header_${pe.id}`,item:pe},PA(u,":group-header",()=>Oe)),d)}const Ie={index:be,item:pe.raw,internalItem:pe,columns:b.value,isExpanded:t,toggleExpand:T,isSelected:G,toggleSelect:W},$e={...Ie,props:oi({key:`item_${pe.key??pe.index}`,onClick:E.value?()=>{T(pe)}:void 0,index:be,item:pe,cellProps:e.cellProps,mobile:Q.value},PA(u,":row",()=>Ie),typeof e.rowProps=="function"?e.rowProps({item:Ie.item,index:Ie.index,internalItem:Ie.internalItem}):e.rowProps)};return de(sr,{key:$e.props.key},[d.item?d.item($e):de(sE,$e.props,d),t(pe)&&((Le=d["expanded-row"])==null?void 0:Le.call(d,Ie))])})])}),{}}}),Xz=vn({fixedHeader:Boolean,fixedFooter:Boolean,height:[Number,String],hover:Boolean,...tr(),...Hl(),...ia(),...Da()},"VTable"),G_=Qn()({name:"VTable",props:Xz(),setup(e,s){let{slots:u,emit:d}=s;const{themeClasses:b}=Ja(e),{densityClasses:E}=iu(e);return fi(()=>de(e.tag,{class:["v-table",{"v-table--fixed-height":!!e.height,"v-table--fixed-header":e.fixedHeader,"v-table--fixed-footer":e.fixedFooter,"v-table--has-top":!!u.top,"v-table--has-bottom":!!u.bottom,"v-table--hover":e.hover},b.value,E.value,e.class],style:e.style},{default:()=>{var T,t,G;return[(T=u.top)==null?void 0:T.call(u),u.default?de("div",{class:"v-table__wrapper",style:{height:Ji(e.height)}},[de("table",null,[u.default()])]):(t=u.wrapper)==null?void 0:t.call(u),(G=u.bottom)==null?void 0:G.call(u)]}})),{}}}),gq=vn({items:{type:Array,default:()=>[]},itemValue:{type:[String,Array,Function],default:"id"},itemSelectable:{type:[String,Array,Function],default:null},rowProps:[Object,Function],cellProps:[Object,Function],returnObject:Boolean},"DataTable-items");function _q(e,s,u,d){const b=e.returnObject?s:Sl(s,e.itemValue),E=Sl(s,e.itemSelectable,!0),T=d.reduce((t,G)=>(G.key!=null&&(t[G.key]=Sl(s,G.value)),t),{});return{type:"item",key:e.returnObject?Sl(s,e.itemValue):b,index:u,value:b,selectable:E,columns:T,raw:s}}function yq(e,s,u){return s.map((d,b)=>_q(e,d,b,u))}function oE(e,s){return{items:Fe(()=>yq(e,e.items,s.value))}}const lE=vn({...Wz(),hideDefaultBody:Boolean,hideDefaultFooter:Boolean,hideDefaultHeader:Boolean,width:[String,Number],search:String,...Mz(),...KC(),...oq(),...gq(),...Bz(),...Nz(),...Zz(),...Xz()},"DataTable"),vq=vn({...QC(),...lE(),...Cb(),...iE()},"VDataTable"),xq=Qn()({name:"VDataTable",props:vq(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:groupBy":e=>!0,"update:expanded":e=>!0,"update:currentItems":e=>!0},setup(e,s){let{attrs:u,slots:d}=s;const{groupBy:b}=JC(e),{sortBy:E,multiSort:T,mustSort:t}=xw(e),{page:G,itemsPerPage:W}=eE(e),{disableSort:Y}=zg(e),{columns:ne,headers:J,sortFunctions:Q,sortRawFunctions:ce,filterFunctions:ie}=aE(e,{groupBy:b,showSelect:$n(e,"showSelect"),showExpand:$n(e,"showExpand")}),{items:pe}=oE(e,ne),be=$n(e,"search"),{filteredItems:Ie}=Eb(e,pe,be,{transform:sn=>sn.columns,customKeyFilter:ie}),{toggleSort:$e}=bw({sortBy:E,multiSort:T,mustSort:t,page:G}),{sortByWithGroups:Le,opened:Oe,extractRows:Ve,isGroupOpen:Ue,toggleGroup:qe}=mw({groupBy:b,sortBy:E,disableSort:Y}),{sortedItems:He}=nE(e,Ie,Le,{transform:sn=>({...sn.raw,...sn.columns}),sortFunctions:Q,sortRawFunctions:ce}),{flatItems:nt}=gw(He,b,Oe),rt=Fe(()=>nt.value.length),{startIndex:ft,stopIndex:$t,pageCount:hn,setItemsPerPage:gn}=tE({page:G,itemsPerPage:W,itemsLength:rt}),{paginatedItems:pn}=zz({items:nt,startIndex:ft,stopIndex:$t,itemsPerPage:W}),ri=Fe(()=>Ve(pn.value)),{isSelected:ai,select:_n,selectAll:Bn,toggleSelect:mn,someSelected:Nn,allSelected:Pn}=yw(e,{allItems:pe,currentPage:ri}),{isExpanded:Ci,toggleExpand:Fi}=pw(e);_w({page:G,itemsPerPage:W,sortBy:E,groupBy:b,search:be}),Io({VDataTableRows:{hideNoData:$n(e,"hideNoData"),noDataText:$n(e,"noDataText"),loading:$n(e,"loading"),loadingText:$n(e,"loadingText")}});const Ln=Fe(()=>({page:G.value,itemsPerPage:W.value,sortBy:E.value,pageCount:hn.value,toggleSort:$e,setItemsPerPage:gn,someSelected:Nn.value,allSelected:Pn.value,isSelected:ai,select:_n,selectAll:Bn,toggleSelect:mn,isExpanded:Ci,toggleExpand:Fi,isGroupOpen:Ue,toggleGroup:qe,items:ri.value.map(sn=>sn.raw),internalItems:ri.value,groupedItems:pn.value,columns:ne.value,headers:J.value}));return fi(()=>{const sn=lb.filterProps(e),qn=U_.filterProps(e),pi=$_.filterProps(e),ht=G_.filterProps(e);return de(G_,oi({class:["v-data-table",{"v-data-table--show-select":e.showSelect,"v-data-table--loading":e.loading},e.class],style:e.style},ht,{fixedHeader:e.fixedHeader||e.sticky}),{top:()=>{var Zn;return(Zn=d.top)==null?void 0:Zn.call(d,Ln.value)},default:()=>{var Zn,St,mt,at,Tn,bn;return d.default?d.default(Ln.value):de(sr,null,[(Zn=d.colgroup)==null?void 0:Zn.call(d,Ln.value),!e.hideDefaultHeader&&de("thead",{key:"thead"},[de(U_,qn,d)]),(St=d.thead)==null?void 0:St.call(d,Ln.value),!e.hideDefaultBody&&de("tbody",null,[(mt=d["body.prepend"])==null?void 0:mt.call(d,Ln.value),d.body?d.body(Ln.value):de($_,oi(u,pi,{items:pn.value}),d),(at=d["body.append"])==null?void 0:at.call(d,Ln.value)]),(Tn=d.tbody)==null?void 0:Tn.call(d,Ln.value),(bn=d.tfoot)==null?void 0:bn.call(d,Ln.value)])},bottom:()=>d.bottom?d.bottom(Ln.value):!e.hideDefaultFooter&&de(sr,null,[de(wb,null,null),de(lb,sn,{prepend:d["footer.prepend"]})])})}),{}}}),bq=vn({...lE(),...KC(),...lz(),...Cb()},"VDataTableVirtual"),wq=Qn()({name:"VDataTableVirtual",props:bq(),emits:{"update:modelValue":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:groupBy":e=>!0,"update:expanded":e=>!0},setup(e,s){let{attrs:u,slots:d}=s;const{groupBy:b}=JC(e),{sortBy:E,multiSort:T,mustSort:t}=xw(e),{disableSort:G}=zg(e),{columns:W,headers:Y,filterFunctions:ne,sortFunctions:J,sortRawFunctions:Q}=aE(e,{groupBy:b,showSelect:$n(e,"showSelect"),showExpand:$n(e,"showExpand")}),{items:ce}=oE(e,W),ie=$n(e,"search"),{filteredItems:pe}=Eb(e,ce,ie,{transform:qn=>qn.columns,customKeyFilter:ne}),{toggleSort:be}=bw({sortBy:E,multiSort:T,mustSort:t}),{sortByWithGroups:Ie,opened:$e,extractRows:Le,isGroupOpen:Oe,toggleGroup:Ve}=mw({groupBy:b,sortBy:E,disableSort:G}),{sortedItems:Ue}=nE(e,pe,Ie,{transform:qn=>({...qn.raw,...qn.columns}),sortFunctions:J,sortRawFunctions:Q}),{flatItems:qe}=gw(Ue,b,$e),He=Fe(()=>Le(qe.value)),{isSelected:nt,select:rt,selectAll:ft,toggleSelect:$t,someSelected:hn,allSelected:gn}=yw(e,{allItems:He,currentPage:He}),{isExpanded:pn,toggleExpand:ri}=pw(e),{containerRef:ai,markerRef:_n,paddingTop:Bn,paddingBottom:mn,computedItems:Nn,handleItemResize:Pn,handleScroll:Ci,handleScrollend:Fi}=cz(e,qe),Ln=Fe(()=>Nn.value.map(qn=>qn.raw));_w({sortBy:E,page:Bi(1),itemsPerPage:Bi(-1),groupBy:b,search:ie}),Io({VDataTableRows:{hideNoData:$n(e,"hideNoData"),noDataText:$n(e,"noDataText"),loading:$n(e,"loading"),loadingText:$n(e,"loadingText")}});const sn=Fe(()=>({sortBy:E.value,toggleSort:be,someSelected:hn.value,allSelected:gn.value,isSelected:nt,select:rt,selectAll:ft,toggleSelect:$t,isExpanded:pn,toggleExpand:ri,isGroupOpen:Oe,toggleGroup:Ve,items:He.value.map(qn=>qn.raw),internalItems:He.value,groupedItems:qe.value,columns:W.value,headers:Y.value}));fi(()=>{const qn=U_.filterProps(e),pi=$_.filterProps(e),ht=G_.filterProps(e);return de(G_,oi({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},ht,{fixedHeader:e.fixedHeader||e.sticky}),{top:()=>{var Zn;return(Zn=d.top)==null?void 0:Zn.call(d,sn.value)},wrapper:()=>{var Zn,St,mt;return de("div",{ref:ai,onScrollPassive:Ci,onScrollend:Fi,class:"v-table__wrapper",style:{height:Ji(e.height)}},[de("table",null,[(Zn=d.colgroup)==null?void 0:Zn.call(d,sn.value),!e.hideDefaultHeader&&de("thead",{key:"thead"},[de(U_,qn,d)]),!e.hideDefaultBody&&de("tbody",null,[de("tr",{ref:_n,style:{height:Ji(Bn.value),border:0}},[de("td",{colspan:W.value.length,style:{height:0,border:0}},null)]),(St=d["body.prepend"])==null?void 0:St.call(d,sn.value),de($_,oi(u,pi,{items:Ln.value}),{...d,item:at=>de(oz,{key:at.internalItem.index,renderless:!0,"onUpdate:height":Tn=>Pn(at.internalItem.index,Tn)},{default:Tn=>{var Cn;let{itemRef:bn}=Tn;return((Cn=d.item)==null?void 0:Cn.call(d,{...at,itemRef:bn}))??de(sE,oi(at.props,{ref:bn,key:at.internalItem.index,index:at.internalItem.index}),d)}})}),(mt=d["body.append"])==null?void 0:mt.call(d,sn.value),de("tr",{style:{height:Ji(mn.value),border:0}},[de("td",{colspan:W.value.length,style:{height:0,border:0}},null)])])])])},bottom:()=>{var Zn;return(Zn=d.bottom)==null?void 0:Zn.call(d,sn.value)}})})}}),Sq=vn({itemsLength:{type:[Number,String],required:!0},...QC(),...lE(),...iE()},"VDataTableServer"),Tq=Qn()({name:"VDataTableServer",props:Sq(),emits:{"update:modelValue":e=>!0,"update:page":e=>!0,"update:itemsPerPage":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:expanded":e=>!0,"update:groupBy":e=>!0},setup(e,s){let{attrs:u,slots:d}=s;const{groupBy:b}=JC(e),{sortBy:E,multiSort:T,mustSort:t}=xw(e),{page:G,itemsPerPage:W}=eE(e),{disableSort:Y}=zg(e),ne=Fe(()=>parseInt(e.itemsLength,10)),{columns:J,headers:Q}=aE(e,{groupBy:b,showSelect:$n(e,"showSelect"),showExpand:$n(e,"showExpand")}),{items:ce}=oE(e,J),{toggleSort:ie}=bw({sortBy:E,multiSort:T,mustSort:t,page:G}),{opened:pe,isGroupOpen:be,toggleGroup:Ie,extractRows:$e}=mw({groupBy:b,sortBy:E,disableSort:Y}),{pageCount:Le,setItemsPerPage:Oe}=tE({page:G,itemsPerPage:W,itemsLength:ne}),{flatItems:Ve}=gw(ce,b,pe),{isSelected:Ue,select:qe,selectAll:He,toggleSelect:nt,someSelected:rt,allSelected:ft}=yw(e,{allItems:ce,currentPage:ce}),{isExpanded:$t,toggleExpand:hn}=pw(e),gn=Fe(()=>$e(ce.value));_w({page:G,itemsPerPage:W,sortBy:E,groupBy:b,search:$n(e,"search")}),xa("v-data-table",{toggleSort:ie,sortBy:E}),Io({VDataTableRows:{hideNoData:$n(e,"hideNoData"),noDataText:$n(e,"noDataText"),loading:$n(e,"loading"),loadingText:$n(e,"loadingText")}});const pn=Fe(()=>({page:G.value,itemsPerPage:W.value,sortBy:E.value,pageCount:Le.value,toggleSort:ie,setItemsPerPage:Oe,someSelected:rt.value,allSelected:ft.value,isSelected:Ue,select:qe,selectAll:He,toggleSelect:nt,isExpanded:$t,toggleExpand:hn,isGroupOpen:be,toggleGroup:Ie,items:gn.value.map(ri=>ri.raw),internalItems:gn.value,groupedItems:Ve.value,columns:J.value,headers:Q.value}));fi(()=>{const ri=lb.filterProps(e),ai=U_.filterProps(e),_n=$_.filterProps(e),Bn=G_.filterProps(e);return de(G_,oi({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},Bn,{fixedHeader:e.fixedHeader||e.sticky}),{top:()=>{var mn;return(mn=d.top)==null?void 0:mn.call(d,pn.value)},default:()=>{var mn,Nn,Pn,Ci,Fi,Ln;return d.default?d.default(pn.value):de(sr,null,[(mn=d.colgroup)==null?void 0:mn.call(d,pn.value),!e.hideDefaultHeader&&de("thead",{key:"thead",class:"v-data-table__thead",role:"rowgroup"},[de(U_,ai,d)]),(Nn=d.thead)==null?void 0:Nn.call(d,pn.value),!e.hideDefaultBody&&de("tbody",{class:"v-data-table__tbody",role:"rowgroup"},[(Pn=d["body.prepend"])==null?void 0:Pn.call(d,pn.value),d.body?d.body(pn.value):de($_,oi(u,_n,{items:Ve.value}),d),(Ci=d["body.append"])==null?void 0:Ci.call(d,pn.value)]),(Fi=d.tbody)==null?void 0:Fi.call(d,pn.value),(Ln=d.tfoot)==null?void 0:Ln.call(d,pn.value)])},bottom:()=>d.bottom?d.bottom(pn.value):!e.hideDefaultFooter&&de(sr,null,[de(wb,null,null),de(lb,ri,{prepend:d["footer.prepend"]})])})})}}),Cq=vn({fluid:{type:Boolean,default:!1},...tr(),...hl(),...ia()},"VContainer"),Eq=Qn()({name:"VContainer",props:Cq(),setup(e,s){let{slots:u}=s;const{rtlClasses:d}=Cl(),{dimensionStyles:b}=dl(e);return fi(()=>de(e.tag,{class:["v-container",{"v-container--fluid":e.fluid},d.value,e.class],style:[b.value,e.style]},u)),{}}}),Yz=K1.reduce((e,s)=>(e[s]={type:[Boolean,String,Number],default:!1},e),{}),Kz=K1.reduce((e,s)=>{const u="offset"+$p(s);return e[u]={type:[String,Number],default:null},e},{}),Jz=K1.reduce((e,s)=>{const u="order"+$p(s);return e[u]={type:[String,Number],default:null},e},{}),ek={col:Object.keys(Yz),offset:Object.keys(Kz),order:Object.keys(Jz)};function Mq(e,s,u){let d=e;if(!(u==null||u===!1)){if(s){const b=s.replace(e,"");d+=`-${b}`}return e==="col"&&(d="v-"+d),e==="col"&&(u===""||u===!0)||(d+=`-${u}`),d.toLowerCase()}}const Iq=["auto","start","end","center","baseline","stretch"],Pq=vn({cols:{type:[Boolean,String,Number],default:!1},...Yz,offset:{type:[String,Number],default:null},...Kz,order:{type:[String,Number],default:null},...Jz,alignSelf:{type:String,default:null,validator:e=>Iq.includes(e)},...tr(),...ia()},"VCol"),Aq=Qn()({name:"VCol",props:Pq(),setup(e,s){let{slots:u}=s;const d=Fe(()=>{const b=[];let E;for(E in ek)ek[E].forEach(t=>{const G=e[t],W=Mq(E,t,G);W&&b.push(W)});const T=b.some(t=>t.startsWith("v-col-"));return b.push({"v-col":!T||!e.cols,[`v-col-${e.cols}`]:e.cols,[`offset-${e.offset}`]:e.offset,[`order-${e.order}`]:e.order,[`align-self-${e.alignSelf}`]:e.alignSelf}),b});return()=>{var b;return Uf(e.tag,{class:[d.value,e.class],style:e.style},(b=u.default)==null?void 0:b.call(u))}}}),cE=["start","end","center"],Qz=["space-between","space-around","space-evenly"];function uE(e,s){return K1.reduce((u,d)=>{const b=e+$p(d);return u[b]=s(),u},{})}const kq=[...cE,"baseline","stretch"],e3=e=>kq.includes(e),t3=uE("align",()=>({type:String,default:null,validator:e3})),Dq=[...cE,...Qz],n3=e=>Dq.includes(e),i3=uE("justify",()=>({type:String,default:null,validator:n3})),Rq=[...cE,...Qz,"stretch"],r3=e=>Rq.includes(e),a3=uE("alignContent",()=>({type:String,default:null,validator:r3})),tk={align:Object.keys(t3),justify:Object.keys(i3),alignContent:Object.keys(a3)},Lq={align:"align",justify:"justify",alignContent:"align-content"};function zq(e,s,u){let d=Lq[e];if(u!=null){if(s){const b=s.replace(e,"");d+=`-${b}`}return d+=`-${u}`,d.toLowerCase()}}const Oq=vn({dense:Boolean,noGutters:Boolean,align:{type:String,default:null,validator:e3},...t3,justify:{type:String,default:null,validator:n3},...i3,alignContent:{type:String,default:null,validator:r3},...a3,...tr(),...ia()},"VRow"),Fq=Qn()({name:"VRow",props:Oq(),setup(e,s){let{slots:u}=s;const d=Fe(()=>{const b=[];let E;for(E in tk)tk[E].forEach(T=>{const t=e[T],G=zq(E,T,t);G&&b.push(G)});return b.push({"v-row--no-gutters":e.noGutters,"v-row--dense":e.dense,[`align-${e.align}`]:e.align,[`justify-${e.justify}`]:e.justify,[`align-content-${e.alignContent}`]:e.alignContent}),b});return()=>{var b;return Uf(e.tag,{class:["v-row",d.value,e.class],style:e.style},(b=u.default)==null?void 0:b.call(u))}}}),s3=Hp("v-spacer","div","VSpacer"),o3=vn({active:{type:[String,Array],default:void 0},disabled:{type:[Boolean,String,Array],default:!1},nextIcon:{type:_r,default:"$next"},prevIcon:{type:_r,default:"$prev"},modeIcon:{type:_r,default:"$subgroup"},text:String,viewMode:{type:String,default:"month"}},"VDatePickerControls"),DT=Qn()({name:"VDatePickerControls",props:o3(),emits:{"click:year":()=>!0,"click:month":()=>!0,"click:prev":()=>!0,"click:next":()=>!0,"click:text":()=>!0},setup(e,s){let{emit:u}=s;const d=Fe(()=>Array.isArray(e.disabled)?e.disabled.includes("text"):!!e.disabled),b=Fe(()=>Array.isArray(e.disabled)?e.disabled.includes("mode"):!!e.disabled),E=Fe(()=>Array.isArray(e.disabled)?e.disabled.includes("prev"):!!e.disabled),T=Fe(()=>Array.isArray(e.disabled)?e.disabled.includes("next"):!!e.disabled);function t(){u("click:prev")}function G(){u("click:next")}function W(){u("click:year")}function Y(){u("click:month")}return fi(()=>de("div",{class:["v-date-picker-controls"]},[de(Ya,{class:"v-date-picker-controls__month-btn",disabled:d.value,text:e.text,variant:"text",rounded:!0,onClick:Y},null),de(Ya,{key:"mode-btn",class:"v-date-picker-controls__mode-btn",disabled:b.value,density:"comfortable",icon:e.modeIcon,variant:"text",onClick:W},null),de(s3,{key:"mode-spacer"},null),de("div",{key:"month-buttons",class:"v-date-picker-controls__month"},[de(Ya,{disabled:E.value,icon:e.prevIcon,variant:"text",onClick:t},null),de(Ya,{disabled:T.value,icon:e.nextIcon,variant:"text",onClick:G},null)])])),{}}}),Bq=vn({appendIcon:_r,color:String,header:String,transition:String,onClick:lc()},"VDatePickerHeader"),RT=Qn()({name:"VDatePickerHeader",props:Bq(),emits:{click:()=>!0,"click:append":()=>!0},setup(e,s){let{emit:u,slots:d}=s;const{backgroundColorClasses:b,backgroundColorStyles:E}=Ms(e,"color");function T(){u("click")}function t(){u("click:append")}return fi(()=>{const G=!!(d.default||e.header),W=!!(d.append||e.appendIcon);return de("div",{class:["v-date-picker-header",{"v-date-picker-header--clickable":!!e.onClick},b.value],style:E.value,onClick:T},[d.prepend&&de("div",{key:"prepend",class:"v-date-picker-header__prepend"},[d.prepend()]),G&&de(eu,{key:"content",name:e.transition},{default:()=>{var Y;return[de("div",{key:e.header,class:"v-date-picker-header__content"},[((Y=d.default)==null?void 0:Y.call(d))??e.header])]}}),W&&de("div",{class:"v-date-picker-header__append"},[d.append?de(da,{key:"append-defaults",disabled:!e.appendIcon,defaults:{VBtn:{icon:e.appendIcon,variant:"text"}}},{default:()=>{var Y;return[(Y=d.append)==null?void 0:Y.call(d)]}}):de(Ya,{key:"append-btn",icon:e.appendIcon,variant:"text",onClick:t},null)])])}),{}}}),Vq=vn({allowedDates:[Array,Function],disabled:Boolean,displayValue:null,modelValue:Array,month:[Number,String],max:null,min:null,showAdjacentMonths:Boolean,year:[Number,String],weekdays:{type:Array,default:()=>[0,1,2,3,4,5,6]},weeksInMonth:{type:String,default:"dynamic"},firstDayOfWeek:[Number,String]},"calendar");function Nq(e){const s=mb(),u=mr(e,"modelValue",[],ce=>po(ce)),d=Fe(()=>e.displayValue?s.date(e.displayValue):u.value.length>0?s.date(u.value[0]):e.min?s.date(e.min):Array.isArray(e.allowedDates)?s.date(e.allowedDates[0]):s.date()),b=mr(e,"year",void 0,ce=>{const ie=ce!=null?Number(ce):s.getYear(d.value);return s.startOfYear(s.setYear(s.date(),ie))},ce=>s.getYear(ce)),E=mr(e,"month",void 0,ce=>{const ie=ce!=null?Number(ce):s.getMonth(d.value),pe=s.setYear(s.startOfMonth(s.date()),s.getYear(b.value));return s.setMonth(pe,ie)},ce=>s.getMonth(ce)),T=Fe(()=>e.firstDayOfWeek??e.weekdays[0]),t=Fe(()=>{const ce=Number(e.firstDayOfWeek??0);return e.weekdays.map(ie=>(ie+ce)%7)}),G=Fe(()=>{const ce=s.getWeekArray(E.value,T.value),ie=ce.flat(),pe=6*7;if(e.weeksInMonth==="static"&&ie.length<pe){const be=ie[ie.length-1];let Ie=[];for(let $e=1;$e<=pe-ie.length;$e++)Ie.push(s.addDays(be,$e)),$e%7===0&&(ce.push(Ie),Ie=[])}return ce});function W(ce,ie){return ce.filter(pe=>t.value.includes(s.toJsDate(pe).getDay())).map((pe,be)=>{const Ie=s.toISO(pe),$e=!s.isSameMonth(pe,E.value),Le=s.isSameDay(pe,s.startOfMonth(E.value)),Oe=s.isSameDay(pe,s.endOfMonth(E.value)),Ve=s.isSameDay(pe,E.value);return{date:pe,isoDate:Ie,formatted:s.format(pe,"keyboardDate"),year:s.getYear(pe),month:s.getMonth(pe),isDisabled:Q(pe),isWeekStart:be%7===0,isWeekEnd:be%7===6,isToday:s.isSameDay(pe,ie),isAdjacent:$e,isHidden:$e&&!e.showAdjacentMonths,isStart:Le,isSelected:u.value.some(Ue=>s.isSameDay(pe,Ue)),isEnd:Oe,isSame:Ve,localized:s.format(pe,"dayOfMonth")}})}const Y=Fe(()=>{const ce=s.startOfWeek(d.value,e.firstDayOfWeek),ie=[];for(let be=0;be<=6;be++)ie.push(s.addDays(ce,be));const pe=s.date();return W(ie,pe)}),ne=Fe(()=>{const ce=G.value.flat(),ie=s.date();return W(ce,ie)}),J=Fe(()=>G.value.map(ce=>ce.length?Wj(s,ce[0]):null));function Q(ce){if(e.disabled)return!0;const ie=s.date(ce);return e.min&&s.isAfter(s.date(e.min),ie)||e.max&&s.isAfter(ie,s.date(e.max))?!0:Array.isArray(e.allowedDates)&&e.allowedDates.length>0?!e.allowedDates.some(pe=>s.isSameDay(s.date(pe),ie)):typeof e.allowedDates=="function"?!e.allowedDates(ie):!1}return{displayValue:d,daysInMonth:ne,daysInWeek:Y,genDays:W,model:u,weeksInMonth:G,weekDays:t,weekNumbers:J}}const l3=vn({color:String,hideWeekdays:Boolean,multiple:[Boolean,Number,String],showWeek:Boolean,transition:{type:String,default:"picker-transition"},reverseTransition:{type:String,default:"picker-reverse-transition"},...Vq()},"VDatePickerMonth"),LT=Qn()({name:"VDatePickerMonth",props:l3(),emits:{"update:modelValue":e=>!0,"update:month":e=>!0,"update:year":e=>!0},setup(e,s){let{emit:u,slots:d}=s;const b=yi(),{daysInMonth:E,model:T,weekNumbers:t}=Nq(e),G=mb(),W=Bi(),Y=Bi(),ne=Bi(!1),J=Fe(()=>ne.value?e.reverseTransition:e.transition);e.multiple==="range"&&T.value.length>0&&(W.value=T.value[0],T.value.length>1&&(Y.value=T.value[T.value.length-1]));const Q=Fe(()=>{const be=["number","string"].includes(typeof e.multiple)?Number(e.multiple):1/0;return T.value.length>=be});Pi(E,(be,Ie)=>{Ie&&(ne.value=G.isBefore(be[0].date,Ie[0].date))});function ce(be){const Ie=G.startOfDay(be);if(T.value.length===0?W.value=void 0:T.value.length===1&&(W.value=T.value[0],Y.value=void 0),!W.value)W.value=Ie,T.value=[W.value];else if(Y.value)W.value=be,Y.value=void 0,T.value=[W.value];else{if(G.isSameDay(Ie,W.value)){W.value=void 0,T.value=[];return}else G.isBefore(Ie,W.value)?(Y.value=G.endOfDay(W.value),W.value=Ie):Y.value=G.endOfDay(Ie);const $e=G.getDiff(Y.value,W.value,"days"),Le=[W.value];for(let Oe=1;Oe<$e;Oe++){const Ve=G.addDays(W.value,Oe);Le.push(Ve)}Le.push(Y.value),T.value=Le}}function ie(be){const Ie=T.value.findIndex($e=>G.isSameDay($e,be));if(Ie===-1)T.value=[...T.value,be];else{const $e=[...T.value];$e.splice(Ie,1),T.value=$e}}function pe(be){e.multiple==="range"?ce(be):e.multiple?ie(be):T.value=[be]}return()=>de("div",{class:"v-date-picker-month"},[e.showWeek&&de("div",{key:"weeks",class:"v-date-picker-month__weeks"},[!e.hideWeekdays&&de("div",{key:"hide-week-days",class:"v-date-picker-month__day"},[Kc(" ")]),t.value.map(be=>de("div",{class:["v-date-picker-month__day","v-date-picker-month__day--adjacent"]},[be]))]),de(eu,{name:J.value},{default:()=>{var be;return[de("div",{ref:b,key:(be=E.value[0].date)==null?void 0:be.toString(),class:"v-date-picker-month__days"},[!e.hideWeekdays&&G.getWeekdays(e.firstDayOfWeek).map(Ie=>de("div",{class:["v-date-picker-month__day","v-date-picker-month__weekday"]},[Ie])),E.value.map((Ie,$e)=>{const Le={props:{onClick:()=>pe(Ie.date)},item:Ie,i:$e};return Q.value&&!Ie.isSelected&&(Ie.isDisabled=!0),de("div",{class:["v-date-picker-month__day",{"v-date-picker-month__day--adjacent":Ie.isAdjacent,"v-date-picker-month__day--hide-adjacent":Ie.isHidden,"v-date-picker-month__day--selected":Ie.isSelected,"v-date-picker-month__day--week-end":Ie.isWeekEnd,"v-date-picker-month__day--week-start":Ie.isWeekStart}],"data-v-date":Ie.isDisabled?void 0:Ie.isoDate},[(e.showAdjacentMonths||!Ie.isAdjacent)&&de(da,{defaults:{VBtn:{class:"v-date-picker-month__day-btn",color:(Ie.isSelected||Ie.isToday)&&!Ie.isDisabled?e.color:void 0,disabled:Ie.isDisabled,icon:!0,ripple:!1,text:Ie.localized,variant:Ie.isDisabled?Ie.isToday?"outlined":"text":Ie.isToday&&!Ie.isSelected?"outlined":"flat",onClick:()=>pe(Ie.date)}}},{default:()=>{var Oe;return[((Oe=d.day)==null?void 0:Oe.call(d,Le))??de(Ya,Le.props,null)]}})])})])]}})])}}),c3=vn({color:String,height:[String,Number],min:null,max:null,modelValue:Number,year:Number},"VDatePickerMonths"),zT=Qn()({name:"VDatePickerMonths",props:c3(),emits:{"update:modelValue":e=>!0},setup(e,s){let{emit:u,slots:d}=s;const b=mb(),E=mr(e,"modelValue"),T=Fe(()=>{let t=b.startOfYear(b.date());return e.year&&(t=b.setYear(t,e.year)),Vp(12).map(G=>{const W=b.format(t,"monthShort"),Y=!!(e.min&&b.isAfter(b.startOfMonth(b.date(e.min)),t)||e.max&&b.isAfter(t,b.startOfMonth(b.date(e.max))));return t=b.getNextMonth(t),{isDisabled:Y,text:W,value:G}})});return Jo(()=>{E.value=E.value??b.getMonth(b.date())}),fi(()=>de("div",{class:"v-date-picker-months",style:{height:Ji(e.height)}},[de("div",{class:"v-date-picker-months__content"},[T.value.map((t,G)=>{var ne;const W={active:E.value===G,color:E.value===G?e.color:void 0,disabled:t.isDisabled,rounded:!0,text:t.text,variant:E.value===t.value?"flat":"text",onClick:()=>Y(G)};function Y(J){if(E.value===J){u("update:modelValue",E.value);return}E.value=J}return((ne=d.month)==null?void 0:ne.call(d,{month:t,i:G,props:W}))??de(Ya,oi({key:"month"},W),null)})])])),{}}}),u3=vn({color:String,height:[String,Number],min:null,max:null,modelValue:Number},"VDatePickerYears"),OT=Qn()({name:"VDatePickerYears",props:u3(),emits:{"update:modelValue":e=>!0},setup(e,s){let{emit:u,slots:d}=s;const b=mb(),E=mr(e,"modelValue"),T=Fe(()=>{const G=b.getYear(b.date());let W=G-100,Y=G+52;e.min&&(W=b.getYear(b.date(e.min))),e.max&&(Y=b.getYear(b.date(e.max)));let ne=b.startOfYear(b.date());return ne=b.setYear(ne,W),Vp(Y-W+1,W).map(J=>{const Q=b.format(ne,"year");return ne=b.setYear(ne,b.getYear(ne)+1),{text:Q,value:J}})});Jo(()=>{E.value=E.value??b.getYear(b.date())});const t=S1();return Ua(async()=>{var G;await Na(),(G=t.el)==null||G.scrollIntoView({block:"center"})}),fi(()=>de("div",{class:"v-date-picker-years",style:{height:Ji(e.height)}},[de("div",{class:"v-date-picker-years__content"},[T.value.map((G,W)=>{var ne;const Y={ref:E.value===G.value?t:void 0,active:E.value===G.value,color:E.value===G.value?e.color:void 0,rounded:!0,text:G.text,variant:E.value===G.value?"flat":"text",onClick:()=>{if(E.value===G.value){u("update:modelValue",E.value);return}E.value=G.value}};return((ne=d.year)==null?void 0:ne.call(d,{year:G,i:W,props:Y}))??de(Ya,oi({key:"month"},Y),null)})])])),{}}}),jq=Hp("v-picker-title"),h3=vn({bgColor:String,landscape:Boolean,title:String,hideHeader:Boolean,...fw()},"VPicker"),nk=Qn()({name:"VPicker",props:h3(),setup(e,s){let{slots:u}=s;const{backgroundColorClasses:d,backgroundColorStyles:b}=Ms($n(e,"color"));return fi(()=>{const E=j_.filterProps(e),T=!!(e.title||u.title);return de(j_,oi(E,{color:e.bgColor,class:["v-picker",{"v-picker--landscape":e.landscape,"v-picker--with-actions":!!u.actions},e.class],style:e.style}),{default:()=>{var t;return[!e.hideHeader&&de("div",{key:"header",class:[d.value],style:[b.value]},[T&&de(jq,{key:"picker-title"},{default:()=>{var G;return[((G=u.title)==null?void 0:G.call(u))??e.title]}}),u.header&&de("div",{class:"v-picker__header"},[u.header()])]),de("div",{class:"v-picker__body"},[(t=u.default)==null?void 0:t.call(u)]),u.actions&&de(da,{defaults:{VBtn:{slim:!0,variant:"text"}}},{default:()=>[de("div",{class:"v-picker__actions"},[u.actions()])]})]}})}),{}}}),Uq=vn({header:{type:String,default:"$vuetify.datePicker.header"},...o3(),...l3({weeksInMonth:"static"}),...ul(c3(),["modelValue"]),...ul(u3(),["modelValue"]),...h3({title:"$vuetify.datePicker.title"}),modelValue:null},"VDatePicker"),$q=Qn()({name:"VDatePicker",props:Uq(),emits:{"update:modelValue":e=>!0,"update:month":e=>!0,"update:year":e=>!0,"update:viewMode":e=>!0},setup(e,s){let{emit:u,slots:d}=s;const b=mb(),{t:E}=Uo(),T=mr(e,"modelValue",void 0,He=>po(He),He=>e.multiple?He:He[0]),t=mr(e,"viewMode"),G=Fe(()=>{var nt;const He=b.date((nt=T.value)==null?void 0:nt[0]);return He&&b.isValid(He)?He:b.date()}),W=yi(Number(e.month??b.getMonth(b.startOfMonth(G.value)))),Y=yi(Number(e.year??b.getYear(b.startOfYear(b.setMonth(G.value,W.value))))),ne=Bi(!1),J=Fe(()=>e.multiple&&T.value.length>1?E("$vuetify.datePicker.itemsSelected",T.value.length):T.value[0]&&b.isValid(T.value[0])?b.format(b.date(T.value[0]),"normalDateWithWeekday"):E(e.header)),Q=Fe(()=>{let He=b.date();return He=b.setDate(He,1),He=b.setMonth(He,W.value),He=b.setYear(He,Y.value),b.format(He,"monthAndYear")}),ce=Fe(()=>`date-picker-header${ne.value?"-reverse":""}-transition`),ie=Fe(()=>{const He=b.date(e.min);return e.min&&b.isValid(He)?He:null}),pe=Fe(()=>{const He=b.date(e.max);return e.max&&b.isValid(He)?He:null}),be=Fe(()=>{if(e.disabled)return!0;const He=[];if(t.value!=="month")He.push("prev","next");else{let nt=b.date();if(nt=b.setYear(nt,Y.value),nt=b.setMonth(nt,W.value),ie.value){const rt=b.addDays(b.startOfMonth(nt),-1);b.isAfter(ie.value,rt)&&He.push("prev")}if(pe.value){const rt=b.addDays(b.endOfMonth(nt),1);b.isAfter(rt,pe.value)&&He.push("next")}}return He});function Ie(){W.value<11?W.value++:(Y.value++,W.value=0,qe(Y.value)),Ue(W.value)}function $e(){W.value>0?W.value--:(Y.value--,W.value=11,qe(Y.value)),Ue(W.value)}function Le(){t.value="month"}function Oe(){t.value=t.value==="months"?"month":"months"}function Ve(){t.value=t.value==="year"?"month":"year"}function Ue(He){t.value==="months"&&Oe(),u("update:month",He)}function qe(He){t.value==="year"&&Ve(),u("update:year",He)}return Pi(T,(He,nt)=>{const rt=po(nt),ft=po(He);if(!ft.length)return;const $t=b.date(rt[rt.length-1]),hn=b.date(ft[ft.length-1]),gn=b.getMonth(hn),pn=b.getYear(hn);gn!==W.value&&(W.value=gn,Ue(W.value)),pn!==Y.value&&(Y.value=pn,qe(Y.value)),ne.value=b.isBefore($t,hn)}),fi(()=>{const He=nk.filterProps(e),nt=DT.filterProps(e),rt=RT.filterProps(e),ft=LT.filterProps(e),$t=ul(zT.filterProps(e),["modelValue"]),hn=ul(OT.filterProps(e),["modelValue"]),gn={header:J.value,transition:ce.value};return de(nk,oi(He,{class:["v-date-picker",`v-date-picker--${t.value}`,{"v-date-picker--show-week":e.showWeek},e.class],style:e.style}),{title:()=>{var pn;return((pn=d.title)==null?void 0:pn.call(d))??de("div",{class:"v-date-picker__title"},[E(e.title)])},header:()=>d.header?de(da,{defaults:{VDatePickerHeader:{...gn}}},{default:()=>{var pn;return[(pn=d.header)==null?void 0:pn.call(d,gn)]}}):de(RT,oi({key:"header"},rt,gn,{onClick:t.value!=="month"?Le:void 0}),{...d,default:void 0}),default:()=>de(sr,null,[de(DT,oi(nt,{disabled:be.value,text:Q.value,"onClick:next":Ie,"onClick:prev":$e,"onClick:month":Oe,"onClick:year":Ve}),null),de(nb,{hideOnLeave:!0},{default:()=>[t.value==="months"?de(zT,oi({key:"date-picker-months"},$t,{modelValue:W.value,"onUpdate:modelValue":[pn=>W.value=pn,Ue],min:ie.value,max:pe.value,year:Y.value}),null):t.value==="year"?de(OT,oi({key:"date-picker-years"},hn,{modelValue:Y.value,"onUpdate:modelValue":[pn=>Y.value=pn,qe],min:ie.value,max:pe.value}),null):de(LT,oi({key:"date-picker-month"},ft,{modelValue:T.value,"onUpdate:modelValue":pn=>T.value=pn,month:W.value,"onUpdate:month":[pn=>W.value=pn,Ue],year:Y.value,"onUpdate:year":[pn=>Y.value=pn,qe],min:ie.value,max:pe.value}),null)]})]),actions:d.actions})}),{}}}),Gq=vn({actionText:String,bgColor:String,color:String,icon:_r,image:String,justify:{type:String,default:"center"},headline:String,title:String,text:String,textWidth:{type:[Number,String],default:500},href:String,to:String,...tr(),...hl(),...Zp({size:void 0}),...Da()},"VEmptyState"),qq=Qn()({name:"VEmptyState",props:Gq(),emits:{"click:action":e=>!0},setup(e,s){let{emit:u,slots:d}=s;const{themeClasses:b}=Ja(e),{backgroundColorClasses:E,backgroundColorStyles:T}=Ms($n(e,"bgColor")),{dimensionStyles:t}=dl(e),{displayClasses:G}=jd();function W(Y){u("click:action",Y)}return fi(()=>{var pe,be,Ie;const Y=!!(d.actions||e.actionText),ne=!!(d.headline||e.headline),J=!!(d.title||e.title),Q=!!(d.text||e.text),ce=!!(d.media||e.image||e.icon),ie=e.size||(e.image?200:96);return de("div",{class:["v-empty-state",{[`v-empty-state--${e.justify}`]:!0},b.value,E.value,G.value,e.class],style:[T.value,t.value,e.style]},[ce&&de("div",{key:"media",class:"v-empty-state__media"},[d.media?de(da,{key:"media-defaults",defaults:{VImg:{src:e.image,height:ie},VIcon:{size:ie,icon:e.icon}}},{default:()=>[d.media()]}):de(sr,null,[e.image?de(Pm,{key:"image",src:e.image,height:ie},null):e.icon?de(Ka,{key:"icon",color:e.color,size:ie,icon:e.icon},null):void 0])]),ne&&de("div",{key:"headline",class:"v-empty-state__headline"},[((pe=d.headline)==null?void 0:pe.call(d))??e.headline]),J&&de("div",{key:"title",class:"v-empty-state__title"},[((be=d.title)==null?void 0:be.call(d))??e.title]),Q&&de("div",{key:"text",class:"v-empty-state__text",style:{maxWidth:Ji(e.textWidth)}},[((Ie=d.text)==null?void 0:Ie.call(d))??e.text]),d.default&&de("div",{key:"content",class:"v-empty-state__content"},[d.default()]),Y&&de("div",{key:"actions",class:"v-empty-state__actions"},[de(da,{defaults:{VBtn:{class:"v-empty-state__action-btn",color:e.color??"surface-variant",text:e.actionText}}},{default:()=>{var $e;return[(($e=d.actions)==null?void 0:$e.call(d,{props:{onClick:W}}))??de(Ya,{onClick:W},null)]}})])])}),{}}}),cb=Symbol.for("vuetify:v-expansion-panel"),d3=vn({...tr(),...$C()},"VExpansionPanelText"),FT=Qn()({name:"VExpansionPanelText",props:d3(),setup(e,s){let{slots:u}=s;const d=vr(cb);if(!d)throw new Error("[Vuetify] v-expansion-panel-text needs to be placed inside v-expansion-panel");const{hasContent:b,onAfterLeave:E}=GC(e,d.isSelected);return fi(()=>de(ew,{onAfterLeave:E},{default:()=>{var T;return[Js(de("div",{class:["v-expansion-panel-text",e.class],style:e.style},[u.default&&b.value&&de("div",{class:"v-expansion-panel-text__wrapper"},[(T=u.default)==null?void 0:T.call(u)])]),[[Nd,d.isSelected.value]])]}})),{}}}),f3=vn({color:String,expandIcon:{type:_r,default:"$expand"},collapseIcon:{type:_r,default:"$collapse"},hideActions:Boolean,focusable:Boolean,static:Boolean,ripple:{type:[Boolean,Object],default:!1},readonly:Boolean,...tr(),...hl()},"VExpansionPanelTitle"),BT=Qn()({name:"VExpansionPanelTitle",directives:{Ripple:zm},props:f3(),setup(e,s){let{slots:u}=s;const d=vr(cb);if(!d)throw new Error("[Vuetify] v-expansion-panel-title needs to be placed inside v-expansion-panel");const{backgroundColorClasses:b,backgroundColorStyles:E}=Ms(e,"color"),{dimensionStyles:T}=dl(e),t=Fe(()=>({collapseIcon:e.collapseIcon,disabled:d.disabled.value,expanded:d.isSelected.value,expandIcon:e.expandIcon,readonly:e.readonly})),G=Fe(()=>d.isSelected.value?e.collapseIcon:e.expandIcon);return fi(()=>{var W;return Js(de("button",{class:["v-expansion-panel-title",{"v-expansion-panel-title--active":d.isSelected.value,"v-expansion-panel-title--focusable":e.focusable,"v-expansion-panel-title--static":e.static},b.value,e.class],style:[E.value,T.value,e.style],type:"button",tabindex:d.disabled.value?-1:void 0,disabled:d.disabled.value,"aria-expanded":d.isSelected.value,onClick:e.readonly?void 0:d.toggle},[de("span",{class:"v-expansion-panel-title__overlay"},null),(W=u.default)==null?void 0:W.call(u,t.value),!e.hideActions&&de(da,{defaults:{VIcon:{icon:G.value}}},{default:()=>{var Y;return[de("span",{class:"v-expansion-panel-title__icon"},[((Y=u.actions)==null?void 0:Y.call(u,t.value))??de(Ka,null,null)])]}})]),[[qh("ripple"),e.ripple]])}),{}}}),p3=vn({title:String,text:String,bgColor:String,...El(),...ey(),...Qs(),...ia(),...f3(),...d3()},"VExpansionPanel"),Hq=Qn()({name:"VExpansionPanel",props:p3(),emits:{"group:selected":e=>!0},setup(e,s){let{slots:u}=s;const d=ty(e,cb),{backgroundColorClasses:b,backgroundColorStyles:E}=Ms(e,"bgColor"),{elevationClasses:T}=hc(e),{roundedClasses:t}=Ao(e),G=Fe(()=>(d==null?void 0:d.disabled.value)||e.disabled),W=Fe(()=>d.group.items.value.reduce((J,Q,ce)=>(d.group.selected.value.includes(Q.id)&&J.push(ce),J),[])),Y=Fe(()=>{const J=d.group.items.value.findIndex(Q=>Q.id===d.id);return!d.isSelected.value&&W.value.some(Q=>Q-J===1)}),ne=Fe(()=>{const J=d.group.items.value.findIndex(Q=>Q.id===d.id);return!d.isSelected.value&&W.value.some(Q=>Q-J===-1)});return xa(cb,d),fi(()=>{const J=!!(u.text||e.text),Q=!!(u.title||e.title),ce=BT.filterProps(e),ie=FT.filterProps(e);return de(e.tag,{class:["v-expansion-panel",{"v-expansion-panel--active":d.isSelected.value,"v-expansion-panel--before-active":Y.value,"v-expansion-panel--after-active":ne.value,"v-expansion-panel--disabled":G.value},t.value,b.value,e.class],style:[E.value,e.style]},{default:()=>[de("div",{class:["v-expansion-panel__shadow",...T.value]},null),de(da,{defaults:{VExpansionPanelTitle:{...ce},VExpansionPanelText:{...ie}}},{default:()=>{var pe;return[Q&&de(BT,{key:"title"},{default:()=>[u.title?u.title():e.title]}),J&&de(FT,{key:"text"},{default:()=>[u.text?u.text():e.text]}),(pe=u.default)==null?void 0:pe.call(u)]}})]})}),{groupItem:d}}}),Zq=["default","accordion","inset","popout"],Wq=vn({flat:Boolean,...Q_(),...vC(p3(),["bgColor","collapseIcon","color","eager","elevation","expandIcon","focusable","hideActions","readonly","ripple","rounded","tile","static"]),...Da(),...tr(),...ia(),variant:{type:String,default:"default",validator:e=>Zq.includes(e)}},"VExpansionPanels"),Xq=Qn()({name:"VExpansionPanels",props:Wq(),emits:{"update:modelValue":e=>!0},setup(e,s){let{slots:u}=s;const{next:d,prev:b}=Bg(e,cb),{themeClasses:E}=Ja(e),T=Fe(()=>e.variant&&`v-expansion-panels--variant-${e.variant}`);return Io({VExpansionPanel:{bgColor:$n(e,"bgColor"),collapseIcon:$n(e,"collapseIcon"),color:$n(e,"color"),eager:$n(e,"eager"),elevation:$n(e,"elevation"),expandIcon:$n(e,"expandIcon"),focusable:$n(e,"focusable"),hideActions:$n(e,"hideActions"),readonly:$n(e,"readonly"),ripple:$n(e,"ripple"),rounded:$n(e,"rounded"),static:$n(e,"static")}}),fi(()=>de(e.tag,{class:["v-expansion-panels",{"v-expansion-panels--flat":e.flat,"v-expansion-panels--tile":e.tile},E.value,T.value,e.class],style:e.style},{default:()=>{var t;return[(t=u.default)==null?void 0:t.call(u,{prev:b,next:d})]}})),{next:d,prev:b}}}),Yq=vn({app:Boolean,appear:Boolean,extended:Boolean,layout:Boolean,offset:Boolean,modelValue:{type:Boolean,default:!0},...ul(rw({active:!0}),["location"]),...X_(),...Lm(),...$f({transition:"fab-transition"})},"VFab"),Kq=Qn()({name:"VFab",props:Yq(),emits:{"update:modelValue":e=>!0},setup(e,s){let{slots:u}=s;const d=mr(e,"modelValue"),b=Bi(56),E=yi(),{resizeRef:T}=Ff(ne=>{ne.length&&(b.value=ne[0].target.clientHeight)}),t=Fe(()=>e.app||e.absolute),G=Fe(()=>{var ne;return t.value?((ne=e.location)==null?void 0:ne.split(" ").shift())??"bottom":!1}),W=Fe(()=>{var ne;return t.value?((ne=e.location)==null?void 0:ne.split(" ")[1])??"end":!1});Du(()=>e.app,()=>{const ne=Y_({id:e.name,order:Fe(()=>parseInt(e.order,10)),position:G,layoutSize:Fe(()=>e.layout?b.value+24:0),elementSize:Fe(()=>b.value+24),active:Fe(()=>e.app&&d.value),absolute:$n(e,"absolute")});Jo(()=>{E.value=ne.layoutItemStyles.value})});const Y=yi();return fi(()=>{const ne=Ya.filterProps(e);return de("div",{ref:Y,class:["v-fab",{"v-fab--absolute":e.absolute,"v-fab--app":!!e.app,"v-fab--extended":e.extended,"v-fab--offset":e.offset,[`v-fab--${G.value}`]:t.value,[`v-fab--${W.value}`]:t.value},e.class],style:[e.app?{...E.value}:{height:e.absolute?"100%":"inherit"},e.style]},[de("div",{class:"v-fab__container"},[de(eu,{appear:e.appear,transition:e.transition},{default:()=>[Js(de(Ya,oi({ref:T},ne,{active:void 0,location:void 0}),u),[[Nd,e.active]])]})])])}),{}}}),Jq=vn({chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},hideInput:Boolean,multiple:Boolean,showSize:{type:[Boolean,Number,String],default:!1,validator:e=>typeof e=="boolean"||[1e3,1024].includes(Number(e))},...Fm({prependIcon:"$file"}),modelValue:{type:[Array,Object],default:e=>e.multiple?[]:null,validator:e=>po(e).every(s=>s!=null&&typeof s=="object")},...Tb({clearable:!0})},"VFileInput"),Qq=Qn()({name:"VFileInput",inheritAttrs:!1,props:Jq(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,s){let{attrs:u,emit:d,slots:b}=s;const{t:E}=Uo(),T=mr(e,"modelValue",e.modelValue,He=>po(He),He=>!e.multiple&&Array.isArray(He)?He[0]:He),{isFocused:t,focus:G,blur:W}=Om(e),Y=Fe(()=>typeof e.showSize!="boolean"?e.showSize:void 0),ne=Fe(()=>(T.value??[]).reduce((He,nt)=>{let{size:rt=0}=nt;return He+rt},0)),J=Fe(()=>gA(ne.value,Y.value)),Q=Fe(()=>(T.value??[]).map(He=>{const{name:nt="",size:rt=0}=He;return e.showSize?`${nt} (${gA(rt,Y.value)})`:nt})),ce=Fe(()=>{var nt;const He=((nt=T.value)==null?void 0:nt.length)??0;return e.showSize?E(e.counterSizeString,He,J.value):E(e.counterString,He)}),ie=yi(),pe=yi(),be=yi(),Ie=Fe(()=>t.value||e.active),$e=Fe(()=>["plain","underlined"].includes(e.variant));function Le(){var He;be.value!==document.activeElement&&((He=be.value)==null||He.focus()),t.value||G()}function Oe(He){var nt;(nt=be.value)==null||nt.click()}function Ve(He){d("mousedown:control",He)}function Ue(He){var nt;(nt=be.value)==null||nt.click(),d("click:control",He)}function qe(He){He.stopPropagation(),Le(),Na(()=>{T.value=[],W1(e["onClick:clear"],He)})}return Pi(T,He=>{(!Array.isArray(He)||!He.length)&&be.value&&(be.value.value="")}),fi(()=>{const He=!!(b.counter||e.counter),nt=!!(He||b.details),[rt,ft]=Og(u),{modelValue:$t,...hn}=Rc.filterProps(e),gn=qC(e);return de(Rc,oi({ref:ie,modelValue:T.value,"onUpdate:modelValue":pn=>T.value=pn,class:["v-file-input",{"v-file-input--chips":!!e.chips,"v-file-input--hide":e.hideInput,"v-input--plain-underlined":$e.value},e.class],style:e.style,"onClick:prepend":Oe},rt,hn,{centerAffix:!$e.value,focused:t.value}),{...b,default:pn=>{let{id:ri,isDisabled:ai,isDirty:_n,isReadonly:Bn,isValid:mn}=pn;return de(bv,oi({ref:pe,"prepend-icon":e.prependIcon,onMousedown:Ve,onClick:Ue,"onClick:clear":qe,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},gn,{id:ri.value,active:Ie.value||_n.value,dirty:_n.value||e.dirty,disabled:ai.value,focused:t.value,error:mn.value===!1}),{...b,default:Nn=>{var Fi;let{props:{class:Pn,...Ci}}=Nn;return de(sr,null,[de("input",oi({ref:be,type:"file",readonly:Bn.value,disabled:ai.value,multiple:e.multiple,name:e.name,onClick:Ln=>{Ln.stopPropagation(),Bn.value&&Ln.preventDefault(),Le()},onChange:Ln=>{if(!Ln.target)return;const sn=Ln.target;T.value=[...sn.files??[]]},onFocus:Le,onBlur:W},Ci,ft),null),de("div",{class:Pn},[!!((Fi=T.value)!=null&&Fi.length)&&!e.hideInput&&(b.selection?b.selection({fileNames:Q.value,totalBytes:ne.value,totalBytesReadable:J.value}):e.chips?Q.value.map(Ln=>de(xv,{key:Ln,size:"small",text:Ln},null)):Q.value.join(", "))])])}})},details:nt?pn=>{var ri,ai;return de(sr,null,[(ri=b.details)==null?void 0:ri.call(b,pn),He&&de(sr,null,[de("span",null,null),de(lw,{active:!!((ai=T.value)!=null&&ai.length),value:ce.value,disabled:e.disabled},b.counter)])])}:void 0})}),$d({},ie,pe,be)}}),eH=vn({app:Boolean,color:String,height:{type:[Number,String],default:"auto"},...gh(),...tr(),...El(),...X_(),...Qs(),...ia({tag:"footer"}),...Da()},"VFooter"),tH=Qn()({name:"VFooter",props:eH(),setup(e,s){let{slots:u}=s;const d=yi(),{themeClasses:b}=Ja(e),{backgroundColorClasses:E,backgroundColorStyles:T}=Ms($n(e,"color")),{borderClasses:t}=Wh(e),{elevationClasses:G}=hc(e),{roundedClasses:W}=Ao(e),Y=Bi(32),{resizeRef:ne}=Ff(Q=>{Q.length&&(Y.value=Q[0].target.clientHeight)}),J=Fe(()=>e.height==="auto"?Y.value:parseInt(e.height,10));return Du(()=>e.app,()=>{const Q=Y_({id:e.name,order:Fe(()=>parseInt(e.order,10)),position:Fe(()=>"bottom"),layoutSize:J,elementSize:Fe(()=>e.height==="auto"?void 0:J.value),active:Fe(()=>e.app),absolute:$n(e,"absolute")});Jo(()=>{d.value=Q.layoutItemStyles.value})}),fi(()=>de(e.tag,{ref:ne,class:["v-footer",b.value,E.value,t.value,G.value,W.value,e.class],style:[T.value,e.app?d.value:{height:Ji(e.height)},e.style]},u)),{}}}),nH=vn({...tr(),...c$()},"VForm"),iH=Qn()({name:"VForm",props:nH(),emits:{"update:modelValue":e=>!0,submit:e=>!0},setup(e,s){let{slots:u,emit:d}=s;const b=u$(e),E=yi();function T(G){G.preventDefault(),b.reset()}function t(G){const W=G,Y=b.validate();W.then=Y.then.bind(Y),W.catch=Y.catch.bind(Y),W.finally=Y.finally.bind(Y),d("submit",W),W.defaultPrevented||Y.then(ne=>{var Q;let{valid:J}=ne;J&&((Q=E.value)==null||Q.submit())}),W.preventDefault()}return fi(()=>{var G;return de("form",{ref:E,class:["v-form",e.class],style:e.style,novalidate:!0,onReset:T,onSubmit:t},[(G=u.default)==null?void 0:G.call(u,b)])}),$d(b,E)}}),rH=vn({disabled:Boolean,modelValue:{type:Boolean,default:null},...jC()},"VHover"),aH=Qn()({name:"VHover",props:rH(),emits:{"update:modelValue":e=>!0},setup(e,s){let{slots:u}=s;const d=mr(e,"modelValue"),{runOpenDelay:b,runCloseDelay:E}=UC(e,T=>!e.disabled&&(d.value=T));return()=>{var T;return(T=u.default)==null?void 0:T.call(u,{isHovering:d.value,props:{onMouseenter:b,onMouseleave:E}})}}}),sH=vn({color:String,direction:{type:String,default:"vertical",validator:e=>["vertical","horizontal"].includes(e)},side:{type:String,default:"end",validator:e=>["start","end","both"].includes(e)},mode:{type:String,default:"intersect",validator:e=>["intersect","manual"].includes(e)},margin:[Number,String],loadMoreText:{type:String,default:"$vuetify.infiniteScroll.loadMore"},emptyText:{type:String,default:"$vuetify.infiniteScroll.empty"},...hl(),...ia()},"VInfiniteScroll"),ik=Hh({name:"VInfiniteScrollIntersect",props:{side:{type:String,required:!0},rootMargin:String},emits:{intersect:(e,s)=>!0},setup(e,s){let{emit:u}=s;const{intersectionRef:d,isIntersecting:b}=tw();return Pi(b,async E=>{u("intersect",e.side,E)}),fi(()=>de("div",{class:"v-infinite-scroll-intersect",style:{"--v-infinite-margin-size":e.rootMargin},ref:d},[Kc(" ")])),{}}}),oH=Qn()({name:"VInfiniteScroll",props:sH(),emits:{load:e=>!0},setup(e,s){let{slots:u,emit:d}=s;const b=yi(),E=Bi("ok"),T=Bi("ok"),t=Fe(()=>Ji(e.margin)),G=Bi(!1);function W(Oe){if(!b.value)return;const Ve=e.direction==="vertical"?"scrollTop":"scrollLeft";b.value[Ve]=Oe}function Y(){if(!b.value)return 0;const Oe=e.direction==="vertical"?"scrollTop":"scrollLeft";return b.value[Oe]}function ne(){if(!b.value)return 0;const Oe=e.direction==="vertical"?"scrollHeight":"scrollWidth";return b.value[Oe]}function J(){if(!b.value)return 0;const Oe=e.direction==="vertical"?"clientHeight":"clientWidth";return b.value[Oe]}Ua(()=>{b.value&&(e.side==="start"?W(ne()):e.side==="both"&&W(ne()/2-J()/2))});function Q(Oe,Ve){Oe==="start"?E.value=Ve:Oe==="end"&&(T.value=Ve)}function ce(Oe){return Oe==="start"?E.value:T.value}let ie=0;function pe(Oe,Ve){G.value=Ve,G.value&&be(Oe)}function be(Oe){if(e.mode!=="manual"&&!G.value)return;const Ve=ce(Oe);if(!b.value||["empty","loading"].includes(Ve))return;ie=ne(),Q(Oe,"loading");function Ue(qe){Q(Oe,qe),Na(()=>{qe==="empty"||qe==="error"||(qe==="ok"&&Oe==="start"&&W(ne()-ie+Y()),e.mode!=="manual"&&Na(()=>{window.requestAnimationFrame(()=>{window.requestAnimationFrame(()=>{window.requestAnimationFrame(()=>{be(Oe)})})})}))})}d("load",{side:Oe,done:Ue})}const{t:Ie}=Uo();function $e(Oe,Ve){var He,nt,rt,ft,$t;if(e.side!==Oe&&e.side!=="both")return;const Ue=()=>be(Oe),qe={side:Oe,props:{onClick:Ue,color:e.color}};return Ve==="error"?(He=u.error)==null?void 0:He.call(u,qe):Ve==="empty"?((nt=u.empty)==null?void 0:nt.call(u,qe))??de("div",null,[Ie(e.emptyText)]):e.mode==="manual"?Ve==="loading"?((rt=u.loading)==null?void 0:rt.call(u,qe))??de(uv,{indeterminate:!0,color:e.color},null):((ft=u["load-more"])==null?void 0:ft.call(u,qe))??de(Ya,{variant:"outlined",color:e.color,onClick:Ue},{default:()=>[Ie(e.loadMoreText)]}):(($t=u.loading)==null?void 0:$t.call(u,qe))??de(uv,{indeterminate:!0,color:e.color},null)}const{dimensionStyles:Le}=dl(e);fi(()=>{const Oe=e.tag,Ve=e.side==="start"||e.side==="both",Ue=e.side==="end"||e.side==="both",qe=e.mode==="intersect";return de(Oe,{ref:b,class:["v-infinite-scroll",`v-infinite-scroll--${e.direction}`,{"v-infinite-scroll--start":Ve,"v-infinite-scroll--end":Ue}],style:Le.value},{default:()=>{var He;return[de("div",{class:"v-infinite-scroll__side"},[$e("start",E.value)]),Ve&&qe&&de(ik,{key:"start",side:"start",onIntersect:pe,rootMargin:t.value},null),(He=u.default)==null?void 0:He.call(u),Ue&&qe&&de(ik,{key:"end",side:"end",onIntersect:pe,rootMargin:t.value},null),de("div",{class:"v-infinite-scroll__side"},[$e("end",T.value)])]}})})}}),m3=Symbol.for("vuetify:v-item-group"),lH=vn({...tr(),...Q_({selectedClass:"v-item--selected"}),...ia(),...Da()},"VItemGroup"),cH=Qn()({name:"VItemGroup",props:lH(),emits:{"update:modelValue":e=>!0},setup(e,s){let{slots:u}=s;const{themeClasses:d}=Ja(e),{isSelected:b,select:E,next:T,prev:t,selected:G}=Bg(e,m3);return()=>de(e.tag,{class:["v-item-group",d.value,e.class],style:e.style},{default:()=>{var W;return[(W=u.default)==null?void 0:W.call(u,{isSelected:b,select:E,next:T,prev:t,selected:G.value})]}})}}),uH=Qn()({name:"VItem",props:ey(),emits:{"group:selected":e=>!0},setup(e,s){let{slots:u}=s;const{isSelected:d,select:b,toggle:E,selectedClass:T,value:t,disabled:G}=ty(e,m3);return()=>{var W;return(W=u.default)==null?void 0:W.call(u,{isSelected:d.value,selectedClass:T.value,select:b,toggle:E,value:t.value,disabled:G.value})}}}),hH=Hp("v-kbd","kbd"),dH=vn({...tr(),...hl(),...rL()},"VLayout"),fH=Qn()({name:"VLayout",props:dH(),setup(e,s){let{slots:u}=s;const{layoutClasses:d,layoutStyles:b,getLayoutItem:E,items:T,layoutRef:t}=sL(e),{dimensionStyles:G}=dl(e);return fi(()=>{var W;return de("div",{ref:t,class:[d.value,e.class],style:[G.value,b.value,e.style]},[(W=u.default)==null?void 0:W.call(u)])}),{getLayoutItem:E,items:T}}}),pH=vn({position:{type:String,required:!0},size:{type:[Number,String],default:300},modelValue:Boolean,...tr(),...X_()},"VLayoutItem"),mH=Qn()({name:"VLayoutItem",props:pH(),setup(e,s){let{slots:u}=s;const{layoutItemStyles:d}=Y_({id:e.name,order:Fe(()=>parseInt(e.order,10)),position:$n(e,"position"),elementSize:$n(e,"size"),layoutSize:$n(e,"size"),active:$n(e,"modelValue"),absolute:$n(e,"absolute")});return()=>{var b;return de("div",{class:["v-layout-item",e.class],style:[d.value,e.style]},[(b=u.default)==null?void 0:b.call(u)])}}}),gH=vn({modelValue:Boolean,options:{type:Object,default:()=>({root:void 0,rootMargin:void 0,threshold:void 0})},...tr(),...hl(),...ia(),...$f({transition:"fade-transition"})},"VLazy"),_H=Qn()({name:"VLazy",directives:{intersect:gb},props:gH(),emits:{"update:modelValue":e=>!0},setup(e,s){let{slots:u}=s;const{dimensionStyles:d}=dl(e),b=mr(e,"modelValue");function E(T){b.value||(b.value=T)}return fi(()=>Js(de(e.tag,{class:["v-lazy",e.class],style:[d.value,e.style]},{default:()=>[b.value&&de(eu,{transition:e.transition,appear:!0},{default:()=>{var T;return[(T=u.default)==null?void 0:T.call(u)]}})]}),[[qh("intersect"),{handler:E,options:e.options},null]])),{}}}),yH=vn({locale:String,fallbackLocale:String,messages:Object,rtl:{type:Boolean,default:void 0},...tr()},"VLocaleProvider"),vH=Qn()({name:"VLocaleProvider",props:yH(),setup(e,s){let{slots:u}=s;const{rtlClasses:d}=aj(e);return fi(()=>{var b;return de("div",{class:["v-locale-provider",d.value,e.class],style:e.style},[(b=u.default)==null?void 0:b.call(u)])}),{}}}),xH=vn({scrollable:Boolean,...tr(),...hl(),...ia({tag:"main"})},"VMain"),bH=Qn()({name:"VMain",props:xH(),setup(e,s){let{slots:u}=s;const{dimensionStyles:d}=dl(e),{mainStyles:b}=aL(),{ssrBootStyles:E}=K_();return fi(()=>de(e.tag,{class:["v-main",{"v-main--scrollable":e.scrollable},e.class],style:[b.value,E.value,d.value,e.style]},{default:()=>{var T,t;return[e.scrollable?de("div",{class:"v-main__scroller"},[(T=u.default)==null?void 0:T.call(u)]):(t=u.default)==null?void 0:t.call(u)]}})),{}}});function wH(e){let{rootEl:s,isSticky:u,layoutItemStyles:d}=e;const b=Bi(!1),E=Bi(0),T=Fe(()=>{const W=typeof b.value=="boolean"?"top":b.value;return[u.value?{top:"auto",bottom:"auto",height:void 0}:void 0,b.value?{[W]:Ji(E.value)}:{top:d.value.top}]});Ua(()=>{Pi(u,W=>{W?window.addEventListener("scroll",G,{passive:!0}):window.removeEventListener("scroll",G)},{immediate:!0})}),ql(()=>{window.removeEventListener("scroll",G)});let t=0;function G(){const W=t>window.scrollY?"up":"down",Y=s.value.getBoundingClientRect(),ne=parseFloat(d.value.top??0),J=window.scrollY-Math.max(0,E.value-ne),Q=Y.height+Math.max(E.value,ne)-window.scrollY-window.innerHeight,ce=parseFloat(getComputedStyle(s.value).getPropertyValue("--v-body-scroll-y"))||0;Y.height<window.innerHeight-ne?(b.value="top",E.value=ne):W==="up"&&b.value==="bottom"||W==="down"&&b.value==="top"?(E.value=window.scrollY+Y.top-ce,b.value=!0):W==="down"&&Q<=0?(E.value=0,b.value="bottom"):W==="up"&&J<=0&&(ce?b.value!=="top"&&(E.value=-J+ce+ne,b.value="top"):(E.value=Y.top+J,b.value="top")),t=window.scrollY}return{isStuck:b,stickyStyles:T}}const SH=100,TH=20;function rk(e){return(e<0?-1:1)*Math.sqrt(Math.abs(e))*1.41421356237}function ak(e){if(e.length<2)return 0;if(e.length===2)return e[1].t===e[0].t?0:(e[1].d-e[0].d)/(e[1].t-e[0].t);let s=0;for(let u=e.length-1;u>0;u--){if(e[u].t===e[u-1].t)continue;const d=rk(s),b=(e[u].d-e[u-1].d)/(e[u].t-e[u-1].t);s+=(b-d)*Math.abs(b),u===e.length-1&&(s*=.5)}return rk(s)*1e3}function CH(){const e={};function s(b){Array.from(b.changedTouches).forEach(E=>{(e[E.identifier]??(e[E.identifier]=new g6(TH))).push([b.timeStamp,E])})}function u(b){Array.from(b.changedTouches).forEach(E=>{delete e[E.identifier]})}function d(b){var W;const E=(W=e[b])==null?void 0:W.values().reverse();if(!E)throw new Error(`No samples for touch id ${b}`);const T=E[0],t=[],G=[];for(const Y of E){if(T[0]-Y[0]>SH)break;t.push({t:Y[0],d:Y[1].clientX}),G.push({t:Y[0],d:Y[1].clientY})}return{x:ak(t),y:ak(G),get direction(){const{x:Y,y:ne}=this,[J,Q]=[Math.abs(Y),Math.abs(ne)];return J>Q&&Y>=0?"right":J>Q&&Y<=0?"left":Q>J&&ne>=0?"down":Q>J&&ne<=0?"up":EH()}}}return{addMovement:s,endTouch:u,getVelocity:d}}function EH(){throw new Error}function MH(e){let{el:s,isActive:u,isTemporary:d,width:b,touchless:E,position:T}=e;Ua(()=>{window.addEventListener("touchstart",Ie,{passive:!0}),window.addEventListener("touchmove",$e,{passive:!1}),window.addEventListener("touchend",Le,{passive:!0})}),ql(()=>{window.removeEventListener("touchstart",Ie),window.removeEventListener("touchmove",$e),window.removeEventListener("touchend",Le)});const t=Fe(()=>["left","right"].includes(T.value)),{addMovement:G,endTouch:W,getVelocity:Y}=CH();let ne=!1;const J=Bi(!1),Q=Bi(0),ce=Bi(0);let ie;function pe(Ve,Ue){return(T.value==="left"?Ve:T.value==="right"?document.documentElement.clientWidth-Ve:T.value==="top"?Ve:T.value==="bottom"?document.documentElement.clientHeight-Ve:$y())-(Ue?b.value:0)}function be(Ve){let Ue=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;const qe=T.value==="left"?(Ve-ce.value)/b.value:T.value==="right"?(document.documentElement.clientWidth-Ve-ce.value)/b.value:T.value==="top"?(Ve-ce.value)/b.value:T.value==="bottom"?(document.documentElement.clientHeight-Ve-ce.value)/b.value:$y();return Ue?Math.max(0,Math.min(1,qe)):qe}function Ie(Ve){if(E.value)return;const Ue=Ve.changedTouches[0].clientX,qe=Ve.changedTouches[0].clientY,He=25,nt=T.value==="left"?Ue<He:T.value==="right"?Ue>document.documentElement.clientWidth-He:T.value==="top"?qe<He:T.value==="bottom"?qe>document.documentElement.clientHeight-He:$y(),rt=u.value&&(T.value==="left"?Ue<b.value:T.value==="right"?Ue>document.documentElement.clientWidth-b.value:T.value==="top"?qe<b.value:T.value==="bottom"?qe>document.documentElement.clientHeight-b.value:$y());(nt||rt||u.value&&d.value)&&(ie=[Ue,qe],ce.value=pe(t.value?Ue:qe,u.value),Q.value=be(t.value?Ue:qe),ne=ce.value>-20&&ce.value<80,W(Ve),G(Ve))}function $e(Ve){const Ue=Ve.changedTouches[0].clientX,qe=Ve.changedTouches[0].clientY;if(ne){if(!Ve.cancelable){ne=!1;return}const nt=Math.abs(Ue-ie[0]),rt=Math.abs(qe-ie[1]);(t.value?nt>rt&&nt>3:rt>nt&&rt>3)?(J.value=!0,ne=!1):(t.value?rt:nt)>3&&(ne=!1)}if(!J.value)return;Ve.preventDefault(),G(Ve);const He=be(t.value?Ue:qe,!1);Q.value=Math.max(0,Math.min(1,He)),He>1?ce.value=pe(t.value?Ue:qe,!0):He<0&&(ce.value=pe(t.value?Ue:qe,!1))}function Le(Ve){if(ne=!1,!J.value)return;G(Ve),J.value=!1;const Ue=Y(Ve.changedTouches[0].identifier),qe=Math.abs(Ue.x),He=Math.abs(Ue.y);(t.value?qe>He&&qe>400:He>qe&&He>3)?u.value=Ue.direction===({left:"right",right:"left",top:"down",bottom:"up"}[T.value]||$y()):u.value=Q.value>.5}const Oe=Fe(()=>J.value?{transform:T.value==="left"?`translateX(calc(-100% + ${Q.value*b.value}px))`:T.value==="right"?`translateX(calc(100% - ${Q.value*b.value}px))`:T.value==="top"?`translateY(calc(-100% + ${Q.value*b.value}px))`:T.value==="bottom"?`translateY(calc(100% - ${Q.value*b.value}px))`:$y(),transition:"none"}:void 0);return Du(J,()=>{var qe,He;const Ve=((qe=s.value)==null?void 0:qe.style.transform)??null,Ue=((He=s.value)==null?void 0:He.style.transition)??null;Jo(()=>{var nt,rt,ft,$t;(rt=s.value)==null||rt.style.setProperty("transform",((nt=Oe.value)==null?void 0:nt.transform)||"none"),($t=s.value)==null||$t.style.setProperty("transition",((ft=Oe.value)==null?void 0:ft.transition)||null)}),nu(()=>{var nt,rt;(nt=s.value)==null||nt.style.setProperty("transform",Ve),(rt=s.value)==null||rt.style.setProperty("transition",Ue)})}),{isDragging:J,dragProgress:Q,dragStyles:Oe}}function $y(){throw new Error}const IH=["start","end","left","right","top","bottom"],PH=vn({color:String,disableResizeWatcher:Boolean,disableRouteWatcher:Boolean,expandOnHover:Boolean,floating:Boolean,modelValue:{type:Boolean,default:null},permanent:Boolean,rail:{type:Boolean,default:null},railWidth:{type:[Number,String],default:56},scrim:{type:[Boolean,String],default:!0},image:String,temporary:Boolean,persistent:Boolean,touchless:Boolean,width:{type:[Number,String],default:256},location:{type:String,default:"start",validator:e=>IH.includes(e)},sticky:Boolean,...gh(),...tr(),...jC(),...W_({mobile:null}),...El(),...X_(),...Qs(),...ia({tag:"nav"}),...Da()},"VNavigationDrawer"),AH=Qn()({name:"VNavigationDrawer",props:PH(),emits:{"update:modelValue":e=>!0,"update:rail":e=>!0},setup(e,s){let{attrs:u,emit:d,slots:b}=s;const{isRtl:E}=Cl(),{themeClasses:T}=Ja(e),{borderClasses:t}=Wh(e),{backgroundColorClasses:G,backgroundColorStyles:W}=Ms($n(e,"color")),{elevationClasses:Y}=hc(e),{displayClasses:ne,mobile:J}=jd(e),{roundedClasses:Q}=Ao(e),ce=_L(),ie=mr(e,"modelValue",null,mn=>!!mn),{ssrBootStyles:pe}=K_(),{scopeId:be}=iy(),Ie=yi(),$e=Bi(!1),{runOpenDelay:Le,runCloseDelay:Oe}=UC(e,mn=>{$e.value=mn}),Ve=Fe(()=>e.rail&&e.expandOnHover&&$e.value?Number(e.width):Number(e.rail?e.railWidth:e.width)),Ue=Fe(()=>oT(e.location,E.value)),qe=Fe(()=>e.persistent),He=Fe(()=>!e.permanent&&(J.value||e.temporary)),nt=Fe(()=>e.sticky&&!He.value&&Ue.value!=="bottom");Du(()=>e.expandOnHover&&e.rail!=null,()=>{Pi($e,mn=>d("update:rail",!mn))}),Du(()=>!e.disableResizeWatcher,()=>{Pi(He,mn=>!e.permanent&&Na(()=>ie.value=!mn))}),Du(()=>!e.disableRouteWatcher&&!!ce,()=>{Pi(ce.currentRoute,()=>He.value&&(ie.value=!1))}),Pi(()=>e.permanent,mn=>{mn&&(ie.value=!0)}),e.modelValue==null&&!He.value&&(ie.value=e.permanent||!J.value);const{isDragging:rt,dragProgress:ft}=MH({el:Ie,isActive:ie,isTemporary:He,width:Ve,touchless:$n(e,"touchless"),position:Ue}),$t=Fe(()=>{const mn=He.value?0:e.rail&&e.expandOnHover?Number(e.railWidth):Ve.value;return rt.value?mn*ft.value:mn}),hn=Fe(()=>["top","bottom"].includes(e.location)?0:Ve.value),{layoutItemStyles:gn,layoutItemScrimStyles:pn}=Y_({id:e.name,order:Fe(()=>parseInt(e.order,10)),position:Ue,layoutSize:$t,elementSize:hn,active:Fe(()=>ie.value||rt.value),disableTransitions:Fe(()=>rt.value),absolute:Fe(()=>e.absolute||nt.value&&typeof ri.value!="string")}),{isStuck:ri,stickyStyles:ai}=wH({rootEl:Ie,isSticky:nt,layoutItemStyles:gn}),_n=Ms(Fe(()=>typeof e.scrim=="string"?e.scrim:null)),Bn=Fe(()=>({...rt.value?{opacity:ft.value*.2,transition:"none"}:void 0,...pn.value}));return Io({VList:{bgColor:"transparent"}}),fi(()=>{const mn=b.image||e.image;return de(sr,null,[de(e.tag,oi({ref:Ie,onMouseenter:Le,onMouseleave:Oe,class:["v-navigation-drawer",`v-navigation-drawer--${Ue.value}`,{"v-navigation-drawer--expand-on-hover":e.expandOnHover,"v-navigation-drawer--floating":e.floating,"v-navigation-drawer--is-hovering":$e.value,"v-navigation-drawer--rail":e.rail,"v-navigation-drawer--temporary":He.value,"v-navigation-drawer--persistent":qe.value,"v-navigation-drawer--active":ie.value,"v-navigation-drawer--sticky":nt.value},T.value,G.value,t.value,ne.value,Y.value,Q.value,e.class],style:[W.value,gn.value,pe.value,ai.value,e.style,["top","bottom"].includes(Ue.value)?{height:"auto"}:{}]},be,u),{default:()=>{var Nn,Pn,Ci;return[mn&&de("div",{key:"image",class:"v-navigation-drawer__img"},[b.image?de(da,{key:"image-defaults",disabled:!e.image,defaults:{VImg:{alt:"",cover:!0,height:"inherit",src:e.image}}},b.image):de(Pm,{key:"image-img",alt:"",cover:!0,height:"inherit",src:e.image},null)]),b.prepend&&de("div",{class:"v-navigation-drawer__prepend"},[(Nn=b.prepend)==null?void 0:Nn.call(b)]),de("div",{class:"v-navigation-drawer__content"},[(Pn=b.default)==null?void 0:Pn.call(b)]),b.append&&de("div",{class:"v-navigation-drawer__append"},[(Ci=b.append)==null?void 0:Ci.call(b)])]}}),de(kg,{name:"fade-transition"},{default:()=>[He.value&&(rt.value||ie.value)&&!!e.scrim&&de("div",oi({class:["v-navigation-drawer__scrim",_n.backgroundColorClasses.value],style:[Bn.value,_n.backgroundColorStyles.value],onClick:()=>{qe.value||(ie.value=!1)}},be),null)]})])}),{isStuck:ri}}}),kH=Hh({name:"VNoSsr",setup(e,s){let{slots:u}=s;const d=nz();return()=>{var b;return d.value&&((b=u.default)==null?void 0:b.call(u))}}}),DH=vn({autofocus:Boolean,divider:String,focusAll:Boolean,label:{type:String,default:"$vuetify.input.otp"},length:{type:[Number,String],default:6},modelValue:{type:[Number,String],default:void 0},placeholder:String,type:{type:String,default:"number"},...hl(),...bb(),...H1(Tb({variant:"outlined"}),["baseColor","bgColor","class","color","disabled","error","loading","rounded","style","theme","variant"])},"VOtpInput"),RH=Qn()({name:"VOtpInput",props:DH(),emits:{finish:e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,s){let{attrs:u,emit:d,slots:b}=s;const{dimensionStyles:E}=dl(e),{isFocused:T,focus:t,blur:G}=Om(e),W=mr(e,"modelValue","",qe=>qe==null?[]:String(qe).split(""),qe=>qe.join("")),{t:Y}=Uo(),ne=Fe(()=>Number(e.length)),J=Fe(()=>Array(ne.value).fill(0)),Q=yi(-1),ce=yi(),ie=yi([]),pe=Fe(()=>ie.value[Q.value]);function be(){if(Ue(pe.value.value)){pe.value.value="";return}const qe=W.value.slice(),He=pe.value.value;qe[Q.value]=He;let nt=null;Q.value>W.value.length?nt=W.value.length+1:Q.value+1!==ne.value&&(nt="next"),W.value=qe,nt&&D_(ce.value,nt)}function Ie(qe){const He=W.value.slice(),nt=Q.value;let rt=null;["ArrowLeft","ArrowRight","Backspace","Delete"].includes(qe.key)&&(qe.preventDefault(),qe.key==="ArrowLeft"?rt="prev":qe.key==="ArrowRight"?rt="next":["Backspace","Delete"].includes(qe.key)&&(He[Q.value]="",W.value=He,Q.value>0&&qe.key==="Backspace"?rt="prev":requestAnimationFrame(()=>{var ft;(ft=ie.value[nt])==null||ft.select()})),requestAnimationFrame(()=>{rt!=null&&D_(ce.value,rt)}))}function $e(qe,He){var rt,ft;He.preventDefault(),He.stopPropagation();const nt=((rt=He==null?void 0:He.clipboardData)==null?void 0:rt.getData("Text").slice(0,ne.value))??"";Ue(nt)||(W.value=nt.split(""),(ft=ie.value)==null||ft[qe].blur())}function Le(){W.value=[]}function Oe(qe,He){t(),Q.value=He}function Ve(){G(),Q.value=-1}function Ue(qe){return e.type==="number"&&/[^0-9]/g.test(qe)}return Io({VField:{color:Fe(()=>e.color),bgColor:Fe(()=>e.color),baseColor:Fe(()=>e.baseColor),disabled:Fe(()=>e.disabled),error:Fe(()=>e.error),variant:Fe(()=>e.variant)}},{scoped:!0}),Pi(W,qe=>{qe.length===ne.value&&d("finish",qe.join(""))},{deep:!0}),Pi(Q,qe=>{qe<0||Na(()=>{var He;(He=ie.value[qe])==null||He.select()})}),fi(()=>{var nt;const[qe,He]=Og(u);return de("div",oi({class:["v-otp-input",{"v-otp-input--divided":!!e.divider},e.class],style:[e.style]},qe),[de("div",{ref:ce,class:"v-otp-input__content",style:[E.value]},[J.value.map((rt,ft)=>de(sr,null,[e.divider&&ft!==0&&de("span",{class:"v-otp-input__divider"},[e.divider]),de(bv,{focused:T.value&&e.focusAll||Q.value===ft,key:ft},{...b,loader:void 0,default:()=>de("input",{ref:$t=>ie.value[ft]=$t,"aria-label":Y(e.label,ft+1),autofocus:ft===0&&e.autofocus,autocomplete:"one-time-code",class:["v-otp-input__field"],disabled:e.disabled,inputmode:e.type==="number"?"numeric":"text",min:e.type==="number"?0:void 0,maxlength:"1",placeholder:e.placeholder,type:e.type==="number"?"text":e.type,value:W.value[ft],onInput:be,onFocus:$t=>Oe($t,ft),onBlur:Ve,onKeydown:Ie,onPaste:$t=>$e(ft,$t)},null)})])),de("input",oi({class:"v-otp-input-input",type:"hidden"},He,{value:W.value.join("")}),null),de(jp,{contained:!0,"content-class":"v-otp-input__loader","model-value":!!e.loading,persistent:!0},{default:()=>{var rt;return[((rt=b.loader)==null?void 0:rt.call(b))??de(uv,{color:typeof e.loading=="boolean"?void 0:e.loading,indeterminate:!0,size:"24",width:"2"},null)]}}),(nt=b.default)==null?void 0:nt.call(b)])])}),{blur:()=>{var qe;(qe=ie.value)==null||qe.some(He=>He.blur())},focus:()=>{var qe;(qe=ie.value)==null||qe[0].focus()},reset:Le,isFocused:T}}});function LH(e){return Math.floor(Math.abs(e))*Math.sign(e)}const zH=vn({scale:{type:[Number,String],default:.5},...tr()},"VParallax"),OH=Qn()({name:"VParallax",props:zH(),setup(e,s){let{slots:u}=s;const{intersectionRef:d,isIntersecting:b}=tw(),{resizeRef:E,contentRect:T}=Ff(),{height:t}=jd(),G=yi();Jo(()=>{var Q;d.value=E.value=(Q=G.value)==null?void 0:Q.$el});let W;Pi(b,Q=>{Q?(W=CC(d.value),W=W===document.scrollingElement?document:W,W.addEventListener("scroll",J,{passive:!0}),J()):W.removeEventListener("scroll",J)}),ql(()=>{W==null||W.removeEventListener("scroll",J)}),Pi(t,J),Pi(()=>{var Q;return(Q=T.value)==null?void 0:Q.height},J);const Y=Fe(()=>1-Ko(+e.scale));let ne=-1;function J(){b.value&&(cancelAnimationFrame(ne),ne=requestAnimationFrame(()=>{var Oe;const Q=((Oe=G.value)==null?void 0:Oe.$el).querySelector(".v-img__img");if(!Q)return;const ce=W instanceof Document?document.documentElement.clientHeight:W.clientHeight,ie=W instanceof Document?window.scrollY:W.scrollTop,pe=d.value.getBoundingClientRect().top+ie,be=T.value.height,Ie=pe+(be-ce)/2,$e=LH((ie-Ie)*Y.value),Le=Math.max(1,(Y.value*(ce-be)+be)/be);Q.style.setProperty("transform",`translateY(${$e}px) scale(${Le})`)}))}return fi(()=>de(Pm,{class:["v-parallax",{"v-parallax--active":b.value},e.class],style:e.style,ref:G,cover:!0,onLoadstart:J,onLoad:J},u)),{}}}),FH=vn({...aw({falseIcon:"$radioOff",trueIcon:"$radioOn"})},"VRadio"),BH=Qn()({name:"VRadio",props:FH(),setup(e,s){let{slots:u}=s;return fi(()=>{const d=Dg.filterProps(e);return de(Dg,oi(d,{class:["v-radio",e.class],style:e.style,type:"radio"}),u)}),{}}}),VH=vn({height:{type:[Number,String],default:"auto"},...Fm(),...ul(OC(),["multiple"]),trueIcon:{type:_r,default:"$radioOn"},falseIcon:{type:_r,default:"$radioOff"},type:{type:String,default:"radio"}},"VRadioGroup"),NH=Qn()({name:"VRadioGroup",inheritAttrs:!1,props:VH(),emits:{"update:modelValue":e=>!0},setup(e,s){let{attrs:u,slots:d}=s;const b=uc(),E=Fe(()=>e.id||`radio-group-${b}`),T=mr(e,"modelValue");return fi(()=>{const[t,G]=Og(u),W=Rc.filterProps(e),Y=Dg.filterProps(e),ne=d.label?d.label({label:e.label,props:{for:E.value}}):e.label;return de(Rc,oi({class:["v-radio-group",e.class],style:e.style},t,W,{modelValue:T.value,"onUpdate:modelValue":J=>T.value=J,id:E.value}),{...d,default:J=>{let{id:Q,messagesId:ce,isDisabled:ie,isReadonly:pe}=J;return de(sr,null,[ne&&de(vv,{id:Q.value},{default:()=>[ne]}),de(IL,oi(Y,{id:Q.value,"aria-describedby":ce.value,defaultsTarget:"VRadio",trueIcon:e.trueIcon,falseIcon:e.falseIcon,type:e.type,disabled:ie.value,readonly:pe.value,"aria-labelledby":ne?Q.value:void 0,multiple:!1},G,{modelValue:T.value,"onUpdate:modelValue":be=>T.value=be}),d)])}})}),{}}}),jH=vn({...bb(),...Fm(),...Sz(),strict:Boolean,modelValue:{type:Array,default:()=>[0,0]}},"VRangeSlider"),UH=Qn()({name:"VRangeSlider",props:jH(),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,end:e=>!0,start:e=>!0},setup(e,s){let{slots:u,emit:d}=s;const b=yi(),E=yi(),T=yi(),{rtlClasses:t}=Cl();function G(nt){if(!b.value||!E.value)return;const rt=MT(nt,b.value.$el,e.direction),ft=MT(nt,E.value.$el,e.direction),$t=Math.abs(rt),hn=Math.abs(ft);return $t<hn||$t===hn&&rt<0?b.value.$el:E.value.$el}const W=Tz(e),Y=mr(e,"modelValue",void 0,nt=>nt!=null&&nt.length?nt.map(rt=>W.roundValue(rt)):[0,0]),{activeThumbRef:ne,hasLabels:J,max:Q,min:ce,mousePressed:ie,onSliderMousedown:pe,onSliderTouchstart:be,position:Ie,trackContainerRef:$e,readonly:Le}=Cz({props:e,steps:W,onSliderStart:()=>{d("start",Y.value)},onSliderEnd:nt=>{var $t;let{value:rt}=nt;const ft=ne.value===(($t=b.value)==null?void 0:$t.$el)?[rt,Y.value[1]]:[Y.value[0],rt];!e.strict&&ft[0]<ft[1]&&(Y.value=ft),d("end",Y.value)},onSliderMove:nt=>{var hn,gn,pn,ri;let{value:rt}=nt;const[ft,$t]=Y.value;!e.strict&&ft===$t&&ft!==ce.value&&(ne.value=rt>ft?(hn=E.value)==null?void 0:hn.$el:(gn=b.value)==null?void 0:gn.$el,(pn=ne.value)==null||pn.focus()),ne.value===((ri=b.value)==null?void 0:ri.$el)?Y.value=[Math.min(rt,$t),$t]:Y.value=[ft,Math.max(ft,rt)]},getActiveThumb:G}),{isFocused:Oe,focus:Ve,blur:Ue}=Om(e),qe=Fe(()=>Ie(Y.value[0])),He=Fe(()=>Ie(Y.value[1]));return fi(()=>{const nt=Rc.filterProps(e),rt=!!(e.label||u.label||u.prepend);return de(Rc,oi({class:["v-slider","v-range-slider",{"v-slider--has-labels":!!u["tick-label"]||J.value,"v-slider--focused":Oe.value,"v-slider--pressed":ie.value,"v-slider--disabled":e.disabled},t.value,e.class],style:e.style,ref:T},nt,{focused:Oe.value}),{...u,prepend:rt?ft=>{var $t,hn;return de(sr,null,[(($t=u.label)==null?void 0:$t.call(u,ft))??(e.label?de(vv,{class:"v-slider__label",text:e.label},null):void 0),(hn=u.prepend)==null?void 0:hn.call(u,ft)])}:void 0,default:ft=>{var gn,pn;let{id:$t,messagesId:hn}=ft;return de("div",{class:"v-slider__container",onMousedown:Le.value?void 0:pe,onTouchstartPassive:Le.value?void 0:be},[de("input",{id:`${$t.value}_start`,name:e.name||$t.value,disabled:!!e.disabled,readonly:!!e.readonly,tabindex:"-1",value:Y.value[0]},null),de("input",{id:`${$t.value}_stop`,name:e.name||$t.value,disabled:!!e.disabled,readonly:!!e.readonly,tabindex:"-1",value:Y.value[1]},null),de(Ez,{ref:$e,start:qe.value,stop:He.value},{"tick-label":u["tick-label"]}),de(IT,{ref:b,"aria-describedby":hn.value,focused:Oe&&ne.value===((gn=b.value)==null?void 0:gn.$el),modelValue:Y.value[0],"onUpdate:modelValue":ri=>Y.value=[ri,Y.value[1]],onFocus:ri=>{var ai,_n,Bn,mn;Ve(),ne.value=(ai=b.value)==null?void 0:ai.$el,Q.value!==ce.value&&Y.value[0]===Y.value[1]&&Y.value[1]===ce.value&&ri.relatedTarget!==((_n=E.value)==null?void 0:_n.$el)&&((Bn=b.value)==null||Bn.$el.blur(),(mn=E.value)==null||mn.$el.focus())},onBlur:()=>{Ue(),ne.value=void 0},min:ce.value,max:Y.value[1],position:qe.value,ripple:e.ripple},{"thumb-label":u["thumb-label"]}),de(IT,{ref:E,"aria-describedby":hn.value,focused:Oe&&ne.value===((pn=E.value)==null?void 0:pn.$el),modelValue:Y.value[1],"onUpdate:modelValue":ri=>Y.value=[Y.value[0],ri],onFocus:ri=>{var ai,_n,Bn,mn;Ve(),ne.value=(ai=E.value)==null?void 0:ai.$el,Q.value!==ce.value&&Y.value[0]===Y.value[1]&&Y.value[0]===Q.value&&ri.relatedTarget!==((_n=b.value)==null?void 0:_n.$el)&&((Bn=E.value)==null||Bn.$el.blur(),(mn=b.value)==null||mn.$el.focus())},onBlur:()=>{Ue(),ne.value=void 0},min:Y.value[0],max:Q.value,position:He.value,ripple:e.ripple},{"thumb-label":u["thumb-label"]})])}})}),{}}}),$H=vn({name:String,itemAriaLabel:{type:String,default:"$vuetify.rating.ariaLabel.item"},activeColor:String,color:String,clearable:Boolean,disabled:Boolean,emptyIcon:{type:_r,default:"$ratingEmpty"},fullIcon:{type:_r,default:"$ratingFull"},halfIncrements:Boolean,hover:Boolean,length:{type:[Number,String],default:5},readonly:Boolean,modelValue:{type:[Number,String],default:0},itemLabels:Array,itemLabelPosition:{type:String,default:"top",validator:e=>["top","bottom"].includes(e)},ripple:Boolean,...tr(),...Hl(),...Zp(),...ia(),...Da()},"VRating"),GH=Qn()({name:"VRating",props:$H(),emits:{"update:modelValue":e=>!0},setup(e,s){let{slots:u}=s;const{t:d}=Uo(),{themeClasses:b}=Ja(e),E=mr(e,"modelValue"),T=Fe(()=>Ko(parseFloat(E.value),0,+e.length)),t=Fe(()=>Vp(Number(e.length),1)),G=Fe(()=>t.value.flatMap(ie=>e.halfIncrements?[ie-.5,ie]:[ie])),W=Bi(-1),Y=Fe(()=>G.value.map(ie=>{const pe=e.hover&&W.value>-1,be=T.value>=ie,Ie=W.value>=ie,Le=(pe?Ie:be)?e.fullIcon:e.emptyIcon,Oe=e.activeColor??e.color,Ve=be||Ie?Oe:e.color;return{isFilled:be,isHovered:Ie,icon:Le,color:Ve}})),ne=Fe(()=>[0,...G.value].map(ie=>{function pe(){W.value=ie}function be(){W.value=-1}function Ie(){e.disabled||e.readonly||(E.value=T.value===ie&&e.clearable?0:ie)}return{onMouseenter:e.hover?pe:void 0,onMouseleave:e.hover?be:void 0,onClick:Ie}})),J=Fe(()=>e.name??`v-rating-${uc()}`);function Q(ie){var qe,He;let{value:pe,index:be,showStar:Ie=!0}=ie;const{onMouseenter:$e,onMouseleave:Le,onClick:Oe}=ne.value[be+1],Ve=`${J.value}-${String(pe).replace(".","-")}`,Ue={color:(qe=Y.value[be])==null?void 0:qe.color,density:e.density,disabled:e.disabled,icon:(He=Y.value[be])==null?void 0:He.icon,ripple:e.ripple,size:e.size,variant:"plain"};return de(sr,null,[de("label",{for:Ve,class:{"v-rating__item--half":e.halfIncrements&&pe%1>0,"v-rating__item--full":e.halfIncrements&&pe%1===0},onMouseenter:$e,onMouseleave:Le,onClick:Oe},[de("span",{class:"v-rating__hidden"},[d(e.itemAriaLabel,pe,e.length)]),Ie?u.item?u.item({...Y.value[be],props:Ue,value:pe,index:be,rating:T.value}):de(Ya,oi({"aria-label":d(e.itemAriaLabel,pe,e.length)},Ue),null):void 0]),de("input",{class:"v-rating__hidden",name:J.value,id:Ve,type:"radio",value:pe,checked:T.value===pe,tabindex:-1,readonly:e.readonly,disabled:e.disabled},null)])}function ce(ie){return u["item-label"]?u["item-label"](ie):ie.label?de("span",null,[ie.label]):de("span",null,[Kc(" ")])}return fi(()=>{var pe;const ie=!!((pe=e.itemLabels)!=null&&pe.length)||u["item-label"];return de(e.tag,{class:["v-rating",{"v-rating--hover":e.hover,"v-rating--readonly":e.readonly},b.value,e.class],style:e.style},{default:()=>[de(Q,{value:0,index:-1,showStar:!1},null),t.value.map((be,Ie)=>{var $e,Le;return de("div",{class:"v-rating__wrapper"},[ie&&e.itemLabelPosition==="top"?ce({value:be,index:Ie,label:($e=e.itemLabels)==null?void 0:$e[Ie]}):void 0,de("div",{class:"v-rating__item"},[e.halfIncrements?de(sr,null,[de(Q,{value:be-.5,index:Ie*2},null),de(Q,{value:be,index:Ie*2+1},null)]):de(Q,{value:be,index:Ie},null)]),ie&&e.itemLabelPosition==="bottom"?ce({value:be,index:Ie,label:(Le=e.itemLabels)==null?void 0:Le[Ie]}):void 0])})]})}),{}}}),qH={actions:"button@2",article:"heading, paragraph",avatar:"avatar",button:"button",card:"image, heading","card-avatar":"image, list-item-avatar",chip:"chip","date-picker":"list-item, heading, divider, date-picker-options, date-picker-days, actions","date-picker-options":"text, avatar@2","date-picker-days":"avatar@28",divider:"divider",heading:"heading",image:"image","list-item":"text","list-item-avatar":"avatar, text","list-item-two-line":"sentences","list-item-avatar-two-line":"avatar, sentences","list-item-three-line":"paragraph","list-item-avatar-three-line":"avatar, paragraph",ossein:"ossein",paragraph:"text@3",sentences:"text@2",subtitle:"text",table:"table-heading, table-thead, table-tbody, table-tfoot","table-heading":"chip, text","table-thead":"heading@6","table-tbody":"table-row-divider@6","table-row-divider":"table-row, divider","table-row":"text@6","table-tfoot":"text@2, avatar@2",text:"text"};function HH(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return de("div",{class:["v-skeleton-loader__bone",`v-skeleton-loader__${e}`]},[s])}function sk(e){const[s,u]=e.split("@");return Array.from({length:u}).map(()=>Sw(s))}function Sw(e){let s=[];if(!e)return s;const u=qH[e];if(e!==u){if(e.includes(","))return ok(e);if(e.includes("@"))return sk(e);u.includes(",")?s=ok(u):u.includes("@")?s=sk(u):u&&s.push(Sw(u))}return[HH(e,s)]}function ok(e){return e.replace(/\s/g,"").split(",").map(Sw)}const ZH=vn({boilerplate:Boolean,color:String,loading:Boolean,loadingText:{type:String,default:"$vuetify.loading"},type:{type:[String,Array],default:"ossein"},...hl(),...El(),...Da()},"VSkeletonLoader"),WH=Qn()({name:"VSkeletonLoader",props:ZH(),setup(e,s){let{slots:u}=s;const{backgroundColorClasses:d,backgroundColorStyles:b}=Ms($n(e,"color")),{dimensionStyles:E}=dl(e),{elevationClasses:T}=hc(e),{themeClasses:t}=Ja(e),{t:G}=Uo(),W=Fe(()=>Sw(po(e.type).join(",")));return fi(()=>{var J;const Y=!u.default||e.loading,ne=e.boilerplate||!Y?{}:{ariaLive:"polite",ariaLabel:G(e.loadingText),role:"alert"};return de("div",oi({class:["v-skeleton-loader",{"v-skeleton-loader--boilerplate":e.boilerplate},t.value,d.value,T.value],style:[b.value,Y?E.value:{}]},ne),[Y?W.value:(J=u.default)==null?void 0:J.call(u)])}),{}}}),XH=Qn()({name:"VSlideGroupItem",props:ey(),emits:{"group:selected":e=>!0},setup(e,s){let{slots:u}=s;const d=ty(e,FL);return()=>{var b;return(b=u.default)==null?void 0:b.call(u,{isSelected:d.isSelected.value,select:d.select,toggle:d.toggle,selectedClass:d.selectedClass.value})}}});function YH(e){const s=Bi(e());let u=-1;function d(){clearInterval(u)}function b(){d(),Na(()=>s.value=e())}function E(T){const t=T?getComputedStyle(T):{transitionDuration:.2},G=parseFloat(t.transitionDuration)*1e3||200;if(d(),s.value<=0)return;const W=performance.now();u=window.setInterval(()=>{const Y=performance.now()-W+G;s.value=Math.max(e()-Y,0),s.value<=0&&d()},G)}return nu(d),{clear:d,time:s,start:E,reset:b}}const KH=vn({multiLine:Boolean,text:String,timer:[Boolean,String],timeout:{type:[Number,String],default:5e3},vertical:Boolean,...Lm({location:"bottom"}),..._v(),...Qs(),...Ud(),...Da(),...ul(Sb({transition:"v-snackbar-transition"}),["persistent","noClickAnimation","scrim","scrollStrategy"])},"VSnackbar"),JH=Qn()({name:"VSnackbar",props:KH(),emits:{"update:modelValue":e=>!0},setup(e,s){let{slots:u}=s;const d=mr(e,"modelValue"),{positionClasses:b}=yv(e),{scopeId:E}=iy(),{themeClasses:T}=Ja(e),{colorClasses:t,colorStyles:G,variantClasses:W}=J_(e),{roundedClasses:Y}=Ao(e),ne=YH(()=>Number(e.timeout)),J=yi(),Q=yi(),ce=Bi(!1),ie=Bi(0),pe=yi(),be=vr(tb,void 0);Du(()=>!!be,()=>{const rt=aL();Jo(()=>{pe.value=rt.mainStyles.value})}),Pi(d,$e),Pi(()=>e.timeout,$e),Ua(()=>{d.value&&$e()});let Ie=-1;function $e(){ne.reset(),window.clearTimeout(Ie);const rt=Number(e.timeout);if(!d.value||rt===-1)return;const ft=yC(Q.value);ne.start(ft),Ie=window.setTimeout(()=>{d.value=!1},rt)}function Le(){ne.reset(),window.clearTimeout(Ie)}function Oe(){ce.value=!0,Le()}function Ve(){ce.value=!1,$e()}function Ue(rt){ie.value=rt.touches[0].clientY}function qe(rt){Math.abs(ie.value-rt.changedTouches[0].clientY)>50&&(d.value=!1)}function He(){ce.value&&Ve()}const nt=Fe(()=>e.location.split(" ").reduce((rt,ft)=>(rt[`v-snackbar--${ft}`]=!0,rt),{}));return fi(()=>{const rt=jp.filterProps(e),ft=!!(u.default||u.text||e.text);return de(jp,oi({ref:J,class:["v-snackbar",{"v-snackbar--active":d.value,"v-snackbar--multi-line":e.multiLine&&!e.vertical,"v-snackbar--timer":!!e.timer,"v-snackbar--vertical":e.vertical},nt.value,b.value,e.class],style:[pe.value,e.style]},rt,{modelValue:d.value,"onUpdate:modelValue":$t=>d.value=$t,contentProps:oi({class:["v-snackbar__wrapper",T.value,t.value,Y.value,W.value],style:[G.value],onPointerenter:Oe,onPointerleave:Ve},rt.contentProps),persistent:!0,noClickAnimation:!0,scrim:!1,scrollStrategy:"none",_disableGlobalStack:!0,onTouchstartPassive:Ue,onTouchend:qe,onAfterLeave:He},E),{default:()=>{var $t,hn;return[Fg(!1,"v-snackbar"),e.timer&&!ce.value&&de("div",{key:"timer",class:"v-snackbar__timer"},[de(nw,{ref:Q,color:typeof e.timer=="string"?e.timer:"info",max:e.timeout,"model-value":ne.time.value},null)]),ft&&de("div",{key:"content",class:"v-snackbar__content",role:"status","aria-live":"polite"},[(($t=u.text)==null?void 0:$t.call(u))??e.text,(hn=u.default)==null?void 0:hn.call(u)]),u.actions&&de(da,{defaults:{VBtn:{variant:"text",ripple:!1,slim:!0}}},{default:()=>[de("div",{class:"v-snackbar__actions"},[u.actions({isActive:d})])]})]},activator:u.activator})}),$d({},J)}}),g3=vn({autoDraw:Boolean,autoDrawDuration:[Number,String],autoDrawEasing:{type:String,default:"ease"},color:String,gradient:{type:Array,default:()=>[]},gradientDirection:{type:String,validator:e=>["top","bottom","left","right"].includes(e),default:"top"},height:{type:[String,Number],default:75},labels:{type:Array,default:()=>[]},labelSize:{type:[Number,String],default:7},lineWidth:{type:[String,Number],default:4},id:String,itemValue:{type:String,default:"value"},modelValue:{type:Array,default:()=>[]},min:[String,Number],max:[String,Number],padding:{type:[String,Number],default:8},showLabels:Boolean,smooth:[Boolean,String,Number],width:{type:[Number,String],default:300}},"Line"),_3=vn({autoLineWidth:Boolean,...g3()},"VBarline"),lk=Qn()({name:"VBarline",props:_3(),setup(e,s){let{slots:u}=s;const d=uc(),b=Fe(()=>e.id||`barline-${d}`),E=Fe(()=>Number(e.autoDrawDuration)||500),T=Fe(()=>!!(e.showLabels||e.labels.length>0||u!=null&&u.label)),t=Fe(()=>parseFloat(e.lineWidth)||4),G=Fe(()=>Math.max(e.modelValue.length*t.value,Number(e.width))),W=Fe(()=>({minX:0,maxX:G.value,minY:0,maxY:parseInt(e.height,10)})),Y=Fe(()=>e.modelValue.map(pe=>Sl(pe,e.itemValue,pe)));function ne(pe,be){const{minX:Ie,maxX:$e,minY:Le,maxY:Oe}=be,Ve=pe.length;let Ue=e.max!=null?Number(e.max):Math.max(...pe),qe=e.min!=null?Number(e.min):Math.min(...pe);qe>0&&e.min==null&&(qe=0),Ue<0&&e.max==null&&(Ue=0);const He=$e/Ve,nt=(Oe-Le)/(Ue-qe||1),rt=Oe-Math.abs(qe*nt);return pe.map((ft,$t)=>{const hn=Math.abs(nt*ft);return{x:Ie+$t*He,y:rt-hn+ +(ft<0)*hn,height:hn,value:ft}})}const J=Fe(()=>{const pe=[],be=ne(Y.value,W.value),Ie=be.length;for(let $e=0;pe.length<Ie;$e++){const Le=be[$e];let Oe=e.labels[$e];Oe||(Oe=typeof Le=="object"?Le.value:Le),pe.push({x:Le.x,value:String(Oe)})}return pe}),Q=Fe(()=>ne(Y.value,W.value)),ce=Fe(()=>(Math.abs(Q.value[0].x-Q.value[1].x)-t.value)/2),ie=Fe(()=>typeof e.smooth=="boolean"?e.smooth?2:0:Number(e.smooth));fi(()=>{const pe=e.gradient.slice().length?e.gradient.slice().reverse():[""];return de("svg",{display:"block"},[de("defs",null,[de("linearGradient",{id:b.value,gradientUnits:"userSpaceOnUse",x1:e.gradientDirection==="left"?"100%":"0",y1:e.gradientDirection==="top"?"100%":"0",x2:e.gradientDirection==="right"?"100%":"0",y2:e.gradientDirection==="bottom"?"100%":"0"},[pe.map((be,Ie)=>de("stop",{offset:Ie/Math.max(pe.length-1,1),"stop-color":be||"currentColor"},null))])]),de("clipPath",{id:`${b.value}-clip`},[Q.value.map(be=>de("rect",{x:be.x+ce.value,y:be.y,width:t.value,height:be.height,rx:ie.value,ry:ie.value},[e.autoDraw&&de(sr,null,[de("animate",{attributeName:"y",from:be.y+be.height,to:be.y,dur:`${E.value}ms`,fill:"freeze"},null),de("animate",{attributeName:"height",from:"0",to:be.height,dur:`${E.value}ms`,fill:"freeze"},null)])]))]),T.value&&de("g",{key:"labels",style:{textAnchor:"middle",dominantBaseline:"mathematical",fill:"currentColor"}},[J.value.map((be,Ie)=>{var $e;return de("text",{x:be.x+ce.value+t.value/2,y:parseInt(e.height,10)-2+(parseInt(e.labelSize,10)||7*.75),"font-size":Number(e.labelSize)||7},[(($e=u.label)==null?void 0:$e.call(u,{index:Ie,value:be.value}))??be.value])})]),de("g",{"clip-path":`url(#${b.value}-clip)`,fill:`url(#${b.value})`},[de("rect",{x:0,y:0,width:Math.max(e.modelValue.length*t.value,Number(e.width)),height:e.height},null)])])})}});function QH(e,s){let u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1,d=arguments.length>3&&arguments[3]!==void 0?arguments[3]:75;if(e.length===0)return"";const b=e.shift(),E=e[e.length-1];return(u?`M${b.x} ${d-b.x+2} L${b.x} ${b.y}`:`M${b.x} ${b.y}`)+e.map((T,t)=>{const G=e[t+1],W=e[t-1]||b,Y=G&&eZ(G,T,W);if(!G||Y)return`L${T.x} ${T.y}`;const ne=Math.min(ck(W,T),ck(G,T)),Q=ne/2<s?ne/2:s,ce=uk(W,T,Q),ie=uk(G,T,Q);return`L${ce.x} ${ce.y}S${T.x} ${T.y} ${ie.x} ${ie.y}`}).join("")+(u?`L${E.x} ${d-b.x+2} Z`:"")}function Y0(e){return parseInt(e,10)}function eZ(e,s,u){return Y0(e.x+u.x)===Y0(2*s.x)&&Y0(e.y+u.y)===Y0(2*s.y)}function ck(e,s){return Math.sqrt(Math.pow(s.x-e.x,2)+Math.pow(s.y-e.y,2))}function uk(e,s,u){const d={x:e.x-s.x,y:e.y-s.y},b=Math.sqrt(d.x*d.x+d.y*d.y),E={x:d.x/b,y:d.y/b};return{x:s.x+E.x*u,y:s.y+E.y*u}}const y3=vn({fill:Boolean,...g3()},"VTrendline"),hk=Qn()({name:"VTrendline",props:y3(),setup(e,s){let{slots:u}=s;const d=uc(),b=Fe(()=>e.id||`trendline-${d}`),E=Fe(()=>Number(e.autoDrawDuration)||(e.fill?500:2e3)),T=yi(0),t=yi(null);function G(pe,be){const{minX:Ie,maxX:$e,minY:Le,maxY:Oe}=be,Ve=pe.length,Ue=e.max!=null?Number(e.max):Math.max(...pe),qe=e.min!=null?Number(e.min):Math.min(...pe),He=($e-Ie)/(Ve-1),nt=(Oe-Le)/(Ue-qe||1);return pe.map((rt,ft)=>({x:Ie+ft*He,y:Oe-(rt-qe)*nt,value:rt}))}const W=Fe(()=>!!(e.showLabels||e.labels.length>0||u!=null&&u.label)),Y=Fe(()=>parseFloat(e.lineWidth)||4),ne=Fe(()=>Number(e.width)),J=Fe(()=>{const pe=Number(e.padding);return{minX:pe,maxX:ne.value-pe,minY:pe,maxY:parseInt(e.height,10)-pe}}),Q=Fe(()=>e.modelValue.map(pe=>Sl(pe,e.itemValue,pe))),ce=Fe(()=>{const pe=[],be=G(Q.value,J.value),Ie=be.length;for(let $e=0;pe.length<Ie;$e++){const Le=be[$e];let Oe=e.labels[$e];Oe||(Oe=typeof Le=="object"?Le.value:Le),pe.push({x:Le.x,value:String(Oe)})}return pe});Pi(()=>e.modelValue,async()=>{if(await Na(),!e.autoDraw||!t.value)return;const pe=t.value,be=pe.getTotalLength();e.fill?(pe.style.transformOrigin="bottom center",pe.style.transition="none",pe.style.transform="scaleY(0)",pe.getBoundingClientRect(),pe.style.transition=`transform ${E.value}ms ${e.autoDrawEasing}`,pe.style.transform="scaleY(1)"):(pe.style.strokeDasharray=`${be}`,pe.style.strokeDashoffset=`${be}`,pe.getBoundingClientRect(),pe.style.transition=`stroke-dashoffset ${E.value}ms ${e.autoDrawEasing}`,pe.style.strokeDashoffset="0"),T.value=be},{immediate:!0});function ie(pe){const be=typeof e.smooth=="boolean"?e.smooth?8:0:Number(e.smooth);return QH(G(Q.value,J.value),be,pe,parseInt(e.height,10))}fi(()=>{var be;const pe=e.gradient.slice().length?e.gradient.slice().reverse():[""];return de("svg",{display:"block","stroke-width":parseFloat(e.lineWidth)??4},[de("defs",null,[de("linearGradient",{id:b.value,gradientUnits:"userSpaceOnUse",x1:e.gradientDirection==="left"?"100%":"0",y1:e.gradientDirection==="top"?"100%":"0",x2:e.gradientDirection==="right"?"100%":"0",y2:e.gradientDirection==="bottom"?"100%":"0"},[pe.map((Ie,$e)=>de("stop",{offset:$e/Math.max(pe.length-1,1),"stop-color":Ie||"currentColor"},null))])]),W.value&&de("g",{key:"labels",style:{textAnchor:"middle",dominantBaseline:"mathematical",fill:"currentColor"}},[ce.value.map((Ie,$e)=>{var Le;return de("text",{x:Ie.x+Y.value/2+Y.value/2,y:parseInt(e.height,10)-4+(parseInt(e.labelSize,10)||7*.75),"font-size":Number(e.labelSize)||7},[((Le=u.label)==null?void 0:Le.call(u,{index:$e,value:Ie.value}))??Ie.value])})]),de("path",{ref:t,d:ie(e.fill),fill:e.fill?`url(#${b.value})`:"none",stroke:e.fill?"none":`url(#${b.value})`},null),e.fill&&de("path",{d:ie(!1),fill:"none",stroke:e.color??((be=e.gradient)==null?void 0:be[0])},null)])})}}),tZ=vn({type:{type:String,default:"trend"},..._3(),...y3()},"VSparkline"),nZ=Qn()({name:"VSparkline",props:tZ(),setup(e,s){let{slots:u}=s;const{textColorClasses:d,textColorStyles:b}=Dc($n(e,"color")),E=Fe(()=>!!(e.showLabels||e.labels.length>0||u!=null&&u.label)),T=Fe(()=>{let t=parseInt(e.height,10);return E.value&&(t+=parseInt(e.labelSize,10)*1.5),t});fi(()=>{const t=e.type==="trend"?hk:lk,G=e.type==="trend"?hk.filterProps(e):lk.filterProps(e);return de(t,oi({key:e.type,class:d.value,style:b.value,viewBox:`0 0 ${e.width} ${parseInt(T.value,10)}`},G),u)})}}),iZ=vn({...tr(),...sz({offset:8,minWidth:0,openDelay:0,closeDelay:100,location:"top center",transition:"scale-transition"})},"VSpeedDial"),rZ=Qn()({name:"VSpeedDial",props:iZ(),emits:{"update:modelValue":e=>!0},setup(e,s){let{slots:u}=s;const d=mr(e,"modelValue"),b=yi(),E=Fe(()=>{var W;const[t,G="center"]=((W=e.location)==null?void 0:W.split(" "))??[];return`${t} ${G}`}),T=Fe(()=>({[`v-speed-dial__content--${E.value.replace(" ","-")}`]:!0}));return fi(()=>{const t=hv.filterProps(e);return de(hv,oi(t,{modelValue:d.value,"onUpdate:modelValue":G=>d.value=G,class:e.class,style:e.style,contentClass:["v-speed-dial__content",T.value,e.contentClass],location:E.value,ref:b,transition:"fade-transition"}),{...u,default:G=>de(da,{defaults:{VBtn:{size:"small"}}},{default:()=>[de(eu,{appear:!0,group:!0,transition:e.transition},{default:()=>{var W;return[(W=u.default)==null?void 0:W.call(u,G)]}})]})})}),{}}}),hE=Symbol.for("vuetify:v-stepper"),v3=vn({color:String,disabled:{type:[Boolean,String],default:!1},prevText:{type:String,default:"$vuetify.stepper.prev"},nextText:{type:String,default:"$vuetify.stepper.next"}},"VStepperActions"),x3=Qn()({name:"VStepperActions",props:v3(),emits:{"click:prev":()=>!0,"click:next":()=>!0},setup(e,s){let{emit:u,slots:d}=s;const{t:b}=Uo();function E(){u("click:prev")}function T(){u("click:next")}return fi(()=>{const t={onClick:E},G={onClick:T};return de("div",{class:"v-stepper-actions"},[de(da,{defaults:{VBtn:{disabled:["prev",!0].includes(e.disabled),text:b(e.prevText),variant:"text"}}},{default:()=>{var W;return[((W=d.prev)==null?void 0:W.call(d,{props:t}))??de(Ya,t,null)]}}),de(da,{defaults:{VBtn:{color:e.color,disabled:["next",!0].includes(e.disabled),text:b(e.nextText),variant:"tonal"}}},{default:()=>{var W;return[((W=d.next)==null?void 0:W.call(d,{props:G}))??de(Ya,G,null)]}})])}),{}}}),b3=Hp("v-stepper-header"),aZ=vn({color:String,title:String,subtitle:String,complete:Boolean,completeIcon:{type:_r,default:"$complete"},editable:Boolean,editIcon:{type:_r,default:"$edit"},error:Boolean,errorIcon:{type:_r,default:"$error"},icon:_r,ripple:{type:[Boolean,Object],default:!0},rules:{type:Array,default:()=>[]}},"StepperItem"),sZ=vn({...aZ(),...ey()},"VStepperItem"),w3=Qn()({name:"VStepperItem",directives:{Ripple:zm},props:sZ(),emits:{"group:selected":e=>!0},setup(e,s){let{slots:u}=s;const d=ty(e,hE,!0),b=Fe(()=>(d==null?void 0:d.value.value)??e.value),E=Fe(()=>e.rules.every(J=>J()===!0)),T=Fe(()=>!e.disabled&&e.editable),t=Fe(()=>!e.disabled&&e.editable),G=Fe(()=>e.error||!E.value),W=Fe(()=>e.complete||e.rules.length>0&&E.value),Y=Fe(()=>G.value?e.errorIcon:W.value?e.completeIcon:d.isSelected.value&&e.editable?e.editIcon:e.icon),ne=Fe(()=>({canEdit:t.value,hasError:G.value,hasCompleted:W.value,title:e.title,subtitle:e.subtitle,step:b.value,value:e.value}));return fi(()=>{var pe,be,Ie;const J=(!d||d.isSelected.value||W.value||t.value)&&!G.value&&!e.disabled,Q=!!(e.title!=null||u.title),ce=!!(e.subtitle!=null||u.subtitle);function ie(){d==null||d.toggle()}return Js(de("button",{class:["v-stepper-item",{"v-stepper-item--complete":W.value,"v-stepper-item--disabled":e.disabled,"v-stepper-item--error":G.value},d==null?void 0:d.selectedClass.value],disabled:!e.editable,type:"button",onClick:ie},[T.value&&Fg(!0,"v-stepper-item"),de(Vd,{key:"stepper-avatar",class:"v-stepper-item__avatar",color:J?e.color:void 0,size:24},{default:()=>{var $e;return[(($e=u.icon)==null?void 0:$e.call(u,ne.value))??(Y.value?de(Ka,{icon:Y.value},null):b.value)]}}),de("div",{class:"v-stepper-item__content"},[Q&&de("div",{key:"title",class:"v-stepper-item__title"},[((pe=u.title)==null?void 0:pe.call(u,ne.value))??e.title]),ce&&de("div",{key:"subtitle",class:"v-stepper-item__subtitle"},[((be=u.subtitle)==null?void 0:be.call(u,ne.value))??e.subtitle]),(Ie=u.default)==null?void 0:Ie.call(u,ne.value)])]),[[qh("ripple"),e.ripple&&e.editable,null]])}),{}}}),oZ=vn({...ul(hw(),["continuous","nextIcon","prevIcon","showArrows","touch","mandatory"])},"VStepperWindow"),S3=Qn()({name:"VStepperWindow",props:oZ(),emits:{"update:modelValue":e=>!0},setup(e,s){let{slots:u}=s;const d=vr(hE,null),b=mr(e,"modelValue"),E=Fe({get(){var T;return b.value!=null||!d?b.value:(T=d.items.value.find(t=>d.selected.value.includes(t.id)))==null?void 0:T.value},set(T){b.value=T}});return fi(()=>{const T=V_.filterProps(e);return de(V_,oi({_as:"VStepperWindow"},T,{modelValue:E.value,"onUpdate:modelValue":t=>E.value=t,class:["v-stepper-window",e.class],style:e.style,mandatory:!1,touch:!1}),u)}),{}}}),lZ=vn({...dw()},"VStepperWindowItem"),T3=Qn()({name:"VStepperWindowItem",props:lZ(),setup(e,s){let{slots:u}=s;return fi(()=>{const d=N_.filterProps(e);return de(N_,oi({_as:"VStepperWindowItem"},d,{class:["v-stepper-window-item",e.class],style:e.style}),u)}),{}}}),cZ=vn({altLabels:Boolean,bgColor:String,completeIcon:_r,editIcon:_r,editable:Boolean,errorIcon:_r,hideActions:Boolean,items:{type:Array,default:()=>[]},itemTitle:{type:String,default:"title"},itemValue:{type:String,default:"value"},nonLinear:Boolean,flat:Boolean,...W_()},"Stepper"),uZ=vn({...cZ(),...Q_({mandatory:"force",selectedClass:"v-stepper-item--selected"}),...fw(),...H1(v3(),["prevText","nextText"])},"VStepper"),hZ=Qn()({name:"VStepper",props:uZ(),emits:{"update:modelValue":e=>!0},setup(e,s){let{slots:u}=s;const{items:d,next:b,prev:E,selected:T}=Bg(e,hE),{displayClasses:t,mobile:G}=jd(e),{completeIcon:W,editIcon:Y,errorIcon:ne,color:J,editable:Q,prevText:ce,nextText:ie}=zg(e),pe=Fe(()=>e.items.map(($e,Le)=>{const Oe=Sl($e,e.itemTitle,$e),Ve=Sl($e,e.itemValue,Le+1);return{title:Oe,value:Ve,raw:$e}})),be=Fe(()=>d.value.findIndex($e=>T.value.includes($e.id))),Ie=Fe(()=>e.disabled?e.disabled:be.value===0?"prev":be.value===d.value.length-1?"next":!1);return Io({VStepperItem:{editable:Q,errorIcon:ne,completeIcon:W,editIcon:Y,prevText:ce,nextText:ie},VStepperActions:{color:J,disabled:Ie,prevText:ce,nextText:ie}}),fi(()=>{const $e=j_.filterProps(e),Le=!!(u.header||e.items.length),Oe=e.items.length>0,Ve=!e.hideActions&&!!(Oe||u.actions);return de(j_,oi($e,{color:e.bgColor,class:["v-stepper",{"v-stepper--alt-labels":e.altLabels,"v-stepper--flat":e.flat,"v-stepper--non-linear":e.nonLinear,"v-stepper--mobile":G.value},t.value,e.class],style:e.style}),{default:()=>{var Ue,qe;return[Le&&de(b3,{key:"stepper-header"},{default:()=>[pe.value.map((He,nt)=>{let{raw:rt,...ft}=He;return de(sr,null,[!!nt&&de(wb,null,null),de(w3,ft,{default:u[`header-item.${ft.value}`]??u.header,icon:u.icon,title:u.title,subtitle:u.subtitle})])})]}),Oe&&de(S3,{key:"stepper-window"},{default:()=>[pe.value.map(He=>de(T3,{value:He.value},{default:()=>{var nt,rt;return((nt=u[`item.${He.value}`])==null?void 0:nt.call(u,He))??((rt=u.item)==null?void 0:rt.call(u,He))}}))]}),(Ue=u.default)==null?void 0:Ue.call(u,{prev:E,next:b}),Ve&&(((qe=u.actions)==null?void 0:qe.call(u,{next:b,prev:E}))??de(x3,{key:"stepper-actions","onClick:prev":E,"onClick:next":b},u))]}})}),{prev:E,next:b}}}),dZ=vn({indeterminate:Boolean,inset:Boolean,flat:Boolean,loading:{type:[Boolean,String],default:!1},...Fm(),...aw()},"VSwitch"),fZ=Qn()({name:"VSwitch",inheritAttrs:!1,props:dZ(),emits:{"update:focused":e=>!0,"update:modelValue":e=>!0,"update:indeterminate":e=>!0},setup(e,s){let{attrs:u,slots:d}=s;const b=mr(e,"indeterminate"),E=mr(e,"modelValue"),{loaderClasses:T}=_b(e),{isFocused:t,focus:G,blur:W}=Om(e),Y=yi(),ne=qa&&window.matchMedia("(forced-colors: active)").matches,J=Fe(()=>typeof e.loading=="string"&&e.loading!==""?e.loading:e.color),Q=uc(),ce=Fe(()=>e.id||`switch-${Q}`);function ie(){b.value&&(b.value=!1)}function pe(be){var Ie,$e;be.stopPropagation(),be.preventDefault(),($e=(Ie=Y.value)==null?void 0:Ie.input)==null||$e.click()}return fi(()=>{const[be,Ie]=Og(u),$e=Rc.filterProps(e),Le=Dg.filterProps(e);return de(Rc,oi({class:["v-switch",{"v-switch--flat":e.flat},{"v-switch--inset":e.inset},{"v-switch--indeterminate":b.value},T.value,e.class]},be,$e,{modelValue:E.value,"onUpdate:modelValue":Oe=>E.value=Oe,id:ce.value,focused:t.value,style:e.style}),{...d,default:Oe=>{let{id:Ve,messagesId:Ue,isDisabled:qe,isReadonly:He,isValid:nt}=Oe;const rt={model:E,isValid:nt};return de(Dg,oi({ref:Y},Le,{modelValue:E.value,"onUpdate:modelValue":[ft=>E.value=ft,ie],id:Ve.value,"aria-describedby":Ue.value,type:"checkbox","aria-checked":b.value?"mixed":void 0,disabled:qe.value,readonly:He.value,onFocus:G,onBlur:W},Ie),{...d,default:ft=>{let{backgroundColorClasses:$t,backgroundColorStyles:hn}=ft;return de("div",{class:["v-switch__track",ne?void 0:$t.value],style:hn.value,onClick:pe},[d["track-true"]&&de("div",{key:"prepend",class:"v-switch__track-true"},[d["track-true"](rt)]),d["track-false"]&&de("div",{key:"append",class:"v-switch__track-false"},[d["track-false"](rt)])])},input:ft=>{let{inputNode:$t,icon:hn,backgroundColorClasses:gn,backgroundColorStyles:pn}=ft;return de(sr,null,[$t,de("div",{class:["v-switch__thumb",{"v-switch__thumb--filled":hn||e.loading},e.inset||ne?void 0:gn.value],style:e.inset?void 0:pn.value},[d.thumb?de(da,{defaults:{VIcon:{icon:hn,size:"x-small"}}},{default:()=>[d.thumb({...rt,icon:hn})]}):de(kC,null,{default:()=>[e.loading?de(yb,{name:"v-switch",active:!0,color:nt.value===!1?void 0:J.value},{default:ri=>d.loader?d.loader(ri):de(uv,{active:ri.isActive,color:ri.color,indeterminate:!0,size:"16",width:"2"},null)}):hn&&de(Ka,{key:String(hn),icon:hn,size:"x-small"},null)]})])])}})}})}),{}}}),pZ=vn({color:String,height:[Number,String],window:Boolean,...tr(),...El(),...X_(),...Qs(),...ia(),...Da()},"VSystemBar"),mZ=Qn()({name:"VSystemBar",props:pZ(),setup(e,s){let{slots:u}=s;const{themeClasses:d}=Ja(e),{backgroundColorClasses:b,backgroundColorStyles:E}=Ms($n(e,"color")),{elevationClasses:T}=hc(e),{roundedClasses:t}=Ao(e),{ssrBootStyles:G}=K_(),W=Fe(()=>e.height??(e.window?32:24)),{layoutItemStyles:Y}=Y_({id:e.name,order:Fe(()=>parseInt(e.order,10)),position:Bi("top"),layoutSize:W,elementSize:W,active:Fe(()=>!0),absolute:$n(e,"absolute")});return fi(()=>de(e.tag,{class:["v-system-bar",{"v-system-bar--window":e.window},d.value,b.value,T.value,t.value,e.class],style:[E.value,Y.value,G.value,e.style]},u)),{}}}),dE=Symbol.for("vuetify:v-tabs"),gZ=vn({fixed:Boolean,sliderColor:String,hideSlider:Boolean,direction:{type:String,default:"horizontal"},...ul(rw({selectedClass:"v-tab--selected",variant:"text"}),["active","block","flat","location","position","symbol"])},"VTab"),C3=Qn()({name:"VTab",props:gZ(),setup(e,s){let{slots:u,attrs:d}=s;const{textColorClasses:b,textColorStyles:E}=Dc(e,"sliderColor"),T=yi(),t=yi(),G=Fe(()=>e.direction==="horizontal"),W=Fe(()=>{var ne,J;return((J=(ne=T.value)==null?void 0:ne.group)==null?void 0:J.isSelected.value)??!1});function Y(ne){var Q,ce;let{value:J}=ne;if(J){const ie=(ce=(Q=T.value)==null?void 0:Q.$el.parentElement)==null?void 0:ce.querySelector(".v-tab--selected .v-tab__slider"),pe=t.value;if(!ie||!pe)return;const be=getComputedStyle(ie).color,Ie=ie.getBoundingClientRect(),$e=pe.getBoundingClientRect(),Le=G.value?"x":"y",Oe=G.value?"X":"Y",Ve=G.value?"right":"bottom",Ue=G.value?"width":"height",qe=Ie[Le],He=$e[Le],nt=qe>He?Ie[Ve]-$e[Ve]:Ie[Le]-$e[Le],rt=Math.sign(nt)>0?G.value?"right":"bottom":Math.sign(nt)<0?G.value?"left":"top":"center",$t=(Math.abs(nt)+(Math.sign(nt)<0?Ie[Ue]:$e[Ue]))/Math.max(Ie[Ue],$e[Ue])||0,hn=Ie[Ue]/$e[Ue]||0,gn=1.5;P_(pe,{backgroundColor:[be,"currentcolor"],transform:[`translate${Oe}(${nt}px) scale${Oe}(${hn})`,`translate${Oe}(${nt/gn}px) scale${Oe}(${($t-1)/gn+1})`,"none"],transformOrigin:Array(3).fill(rt)},{duration:225,easing:Qx})}}return fi(()=>{const ne=Ya.filterProps(e);return de(Ya,oi({symbol:dE,ref:T,class:["v-tab",e.class],style:e.style,tabindex:W.value?0:-1,role:"tab","aria-selected":String(W.value),active:!1},ne,d,{block:e.fixed,maxWidth:e.fixed?300:void 0,"onGroup:selected":Y}),{...u,default:()=>{var J;return de(sr,null,[((J=u.default)==null?void 0:J.call(u))??e.text,!e.hideSlider&&de("div",{ref:t,class:["v-tab__slider",b.value],style:E.value},null)])}})}),$d({},T)}}),_Z=vn({...ul(hw(),["continuous","nextIcon","prevIcon","showArrows","touch","mandatory"])},"VTabsWindow"),E3=Qn()({name:"VTabsWindow",props:_Z(),emits:{"update:modelValue":e=>!0},setup(e,s){let{slots:u}=s;const d=vr(dE,null),b=mr(e,"modelValue"),E=Fe({get(){var T;return b.value!=null||!d?b.value:(T=d.items.value.find(t=>d.selected.value.includes(t.id)))==null?void 0:T.value},set(T){b.value=T}});return fi(()=>{const T=V_.filterProps(e);return de(V_,oi({_as:"VTabsWindow"},T,{modelValue:E.value,"onUpdate:modelValue":t=>E.value=t,class:["v-tabs-window",e.class],style:e.style,mandatory:!1,touch:!1}),u)}),{}}}),yZ=vn({...dw()},"VTabsWindowItem"),M3=Qn()({name:"VTabsWindowItem",props:yZ(),setup(e,s){let{slots:u}=s;return fi(()=>{const d=N_.filterProps(e);return de(N_,oi({_as:"VTabsWindowItem"},d,{class:["v-tabs-window-item",e.class],style:e.style}),u)}),{}}});function vZ(e){return e?e.map(s=>q1(s)?s:{text:s,value:s}):[]}const xZ=vn({alignTabs:{type:String,default:"start"},color:String,fixedTabs:Boolean,items:{type:Array,default:()=>[]},stacked:Boolean,bgColor:String,grow:Boolean,height:{type:[Number,String],default:void 0},hideSlider:Boolean,sliderColor:String,...FC({mandatory:"force",selectedClass:"v-tab-item--selected"}),...Hl(),...ia()},"VTabs"),bZ=Qn()({name:"VTabs",props:xZ(),emits:{"update:modelValue":e=>!0},setup(e,s){let{attrs:u,slots:d}=s;const b=mr(e,"modelValue"),E=Fe(()=>vZ(e.items)),{densityClasses:T}=iu(e),{backgroundColorClasses:t,backgroundColorStyles:G}=Ms($n(e,"bgColor")),{scopeId:W}=iy();return Io({VTab:{color:$n(e,"color"),direction:$n(e,"direction"),stacked:$n(e,"stacked"),fixed:$n(e,"fixedTabs"),sliderColor:$n(e,"sliderColor"),hideSlider:$n(e,"hideSlider")}}),fi(()=>{const Y=sb.filterProps(e),ne=!!(d.window||e.items.length>0);return de(sr,null,[de(sb,oi(Y,{modelValue:b.value,"onUpdate:modelValue":J=>b.value=J,class:["v-tabs",`v-tabs--${e.direction}`,`v-tabs--align-tabs-${e.alignTabs}`,{"v-tabs--fixed-tabs":e.fixedTabs,"v-tabs--grow":e.grow,"v-tabs--stacked":e.stacked},T.value,t.value,e.class],style:[{"--v-tabs-height":Ji(e.height)},G.value,e.style],role:"tablist",symbol:dE},W,u),{default:()=>{var J;return[((J=d.default)==null?void 0:J.call(d))??E.value.map(Q=>{var ce;return((ce=d.tab)==null?void 0:ce.call(d,{item:Q}))??de(C3,oi(Q,{key:Q.text,value:Q.value}),{default:d[`tab.${Q.value}`]?()=>{var ie;return(ie=d[`tab.${Q.value}`])==null?void 0:ie.call(d,{item:Q})}:void 0})})]}}),ne&&de(E3,oi({modelValue:b.value,"onUpdate:modelValue":J=>b.value=J,key:"tabs-window"},W),{default:()=>{var J;return[E.value.map(Q=>{var ce;return((ce=d.item)==null?void 0:ce.call(d,{item:Q}))??de(M3,{value:Q.value},{default:()=>{var ie;return(ie=d[`item.${Q.value}`])==null?void 0:ie.call(d,{item:Q})}})}),(J=d.window)==null?void 0:J.call(d)]}})])}),{}}}),wZ=vn({autoGrow:Boolean,autofocus:Boolean,counter:[Boolean,Number,String],counterValue:Function,prefix:String,placeholder:String,persistentPlaceholder:Boolean,persistentCounter:Boolean,noResize:Boolean,rows:{type:[Number,String],default:5,validator:e=>!isNaN(parseFloat(e))},maxRows:{type:[Number,String],validator:e=>!isNaN(parseFloat(e))},suffix:String,modelModifiers:Object,...Fm(),...Tb()},"VTextarea"),SZ=Qn()({name:"VTextarea",directives:{Intersect:gb},inheritAttrs:!1,props:wZ(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,s){let{attrs:u,emit:d,slots:b}=s;const E=mr(e,"modelValue"),{isFocused:T,focus:t,blur:G}=Om(e),W=Fe(()=>typeof e.counterValue=="function"?e.counterValue(E.value):(E.value||"").toString().length),Y=Fe(()=>{if(u.maxlength)return u.maxlength;if(!(!e.counter||typeof e.counter!="number"&&typeof e.counter!="string"))return e.counter});function ne(rt,ft){var $t,hn;!e.autofocus||!rt||(hn=($t=ft[0].target)==null?void 0:$t.focus)==null||hn.call($t)}const J=yi(),Q=yi(),ce=Bi(""),ie=yi(),pe=Fe(()=>e.persistentPlaceholder||T.value||e.active);function be(){var rt;ie.value!==document.activeElement&&((rt=ie.value)==null||rt.focus()),T.value||t()}function Ie(rt){be(),d("click:control",rt)}function $e(rt){d("mousedown:control",rt)}function Le(rt){rt.stopPropagation(),be(),Na(()=>{E.value="",W1(e["onClick:clear"],rt)})}function Oe(rt){var $t;const ft=rt.target;if(E.value=ft.value,($t=e.modelModifiers)!=null&&$t.trim){const hn=[ft.selectionStart,ft.selectionEnd];Na(()=>{ft.selectionStart=hn[0],ft.selectionEnd=hn[1]})}}const Ve=yi(),Ue=yi(+e.rows),qe=Fe(()=>["plain","underlined"].includes(e.variant));Jo(()=>{e.autoGrow||(Ue.value=+e.rows)});function He(){e.autoGrow&&Na(()=>{if(!Ve.value||!Q.value)return;const rt=getComputedStyle(Ve.value),ft=getComputedStyle(Q.value.$el),$t=parseFloat(rt.getPropertyValue("--v-field-padding-top"))+parseFloat(rt.getPropertyValue("--v-input-padding-top"))+parseFloat(rt.getPropertyValue("--v-field-padding-bottom")),hn=Ve.value.scrollHeight,gn=parseFloat(rt.lineHeight),pn=Math.max(parseFloat(e.rows)*gn+$t,parseFloat(ft.getPropertyValue("--v-input-control-height"))),ri=parseFloat(e.maxRows)*gn+$t||1/0,ai=Ko(hn??0,pn,ri);Ue.value=Math.floor((ai-$t)/gn),ce.value=Ji(ai)})}Ua(He),Pi(E,He),Pi(()=>e.rows,He),Pi(()=>e.maxRows,He),Pi(()=>e.density,He);let nt;return Pi(Ve,rt=>{rt?(nt=new ResizeObserver(He),nt.observe(Ve.value)):nt==null||nt.disconnect()}),ql(()=>{nt==null||nt.disconnect()}),fi(()=>{const rt=!!(b.counter||e.counter||e.counterValue),ft=!!(rt||b.details),[$t,hn]=Og(u),{modelValue:gn,...pn}=Rc.filterProps(e),ri=qC(e);return de(Rc,oi({ref:J,modelValue:E.value,"onUpdate:modelValue":ai=>E.value=ai,class:["v-textarea v-text-field",{"v-textarea--prefixed":e.prefix,"v-textarea--suffixed":e.suffix,"v-text-field--prefixed":e.prefix,"v-text-field--suffixed":e.suffix,"v-textarea--auto-grow":e.autoGrow,"v-textarea--no-resize":e.noResize||e.autoGrow,"v-input--plain-underlined":qe.value},e.class],style:e.style},$t,pn,{centerAffix:Ue.value===1&&!qe.value,focused:T.value}),{...b,default:ai=>{let{id:_n,isDisabled:Bn,isDirty:mn,isReadonly:Nn,isValid:Pn}=ai;return de(bv,oi({ref:Q,style:{"--v-textarea-control-height":ce.value},onClick:Ie,onMousedown:$e,"onClick:clear":Le,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},ri,{id:_n.value,active:pe.value||mn.value,centerAffix:Ue.value===1&&!qe.value,dirty:mn.value||e.dirty,disabled:Bn.value,focused:T.value,error:Pn.value===!1}),{...b,default:Ci=>{let{props:{class:Fi,...Ln}}=Ci;return de(sr,null,[e.prefix&&de("span",{class:"v-text-field__prefix"},[e.prefix]),Js(de("textarea",oi({ref:ie,class:Fi,value:E.value,onInput:Oe,autofocus:e.autofocus,readonly:Nn.value,disabled:Bn.value,placeholder:e.placeholder,rows:e.rows,name:e.name,onFocus:be,onBlur:G},Ln,hn),null),[[qh("intersect"),{handler:ne},null,{once:!0}]]),e.autoGrow&&Js(de("textarea",{class:[Fi,"v-textarea__sizer"],id:`${Ln.id}-sizer`,"onUpdate:modelValue":sn=>E.value=sn,ref:Ve,readonly:!0,"aria-hidden":"true"},null),[[b4,E.value]]),e.suffix&&de("span",{class:"v-text-field__suffix"},[e.suffix])])}})},details:ft?ai=>{var _n;return de(sr,null,[(_n=b.details)==null?void 0:_n.call(b,ai),rt&&de(sr,null,[de("span",null,null),de(lw,{active:e.persistentCounter||T.value,value:W.value,max:Y.value,disabled:e.disabled},b.counter)])])}:void 0})}),$d({},J,Q,ie)}}),TZ=vn({withBackground:Boolean,...tr(),...Da(),...ia()},"VThemeProvider"),CZ=Qn()({name:"VThemeProvider",props:TZ(),setup(e,s){let{slots:u}=s;const{themeClasses:d}=Ja(e);return()=>{var b;return e.withBackground?de(e.tag,{class:["v-theme-provider",d.value,e.class],style:e.style},{default:()=>{var E;return[(E=u.default)==null?void 0:E.call(u)]}}):(b=u.default)==null?void 0:b.call(u)}}}),EZ=vn({dotColor:String,fillDot:Boolean,hideDot:Boolean,icon:_r,iconColor:String,lineColor:String,...tr(),...Qs(),...Zp(),...El()},"VTimelineDivider"),MZ=Qn()({name:"VTimelineDivider",props:EZ(),setup(e,s){let{slots:u}=s;const{sizeClasses:d,sizeStyles:b}=gv(e,"v-timeline-divider__dot"),{backgroundColorStyles:E,backgroundColorClasses:T}=Ms($n(e,"dotColor")),{roundedClasses:t}=Ao(e,"v-timeline-divider__dot"),{elevationClasses:G}=hc(e),{backgroundColorClasses:W,backgroundColorStyles:Y}=Ms($n(e,"lineColor"));return fi(()=>de("div",{class:["v-timeline-divider",{"v-timeline-divider--fill-dot":e.fillDot},e.class],style:e.style},[de("div",{class:["v-timeline-divider__before",W.value],style:Y.value},null),!e.hideDot&&de("div",{key:"dot",class:["v-timeline-divider__dot",G.value,t.value,d.value],style:b.value},[de("div",{class:["v-timeline-divider__inner-dot",T.value,t.value],style:E.value},[u.default?de(da,{key:"icon-defaults",disabled:!e.icon,defaults:{VIcon:{color:e.iconColor,icon:e.icon,size:e.size}}},u.default):de(Ka,{key:"icon",color:e.iconColor,icon:e.icon,size:e.size},null)])]),de("div",{class:["v-timeline-divider__after",W.value],style:Y.value},null)])),{}}}),I3=vn({density:String,dotColor:String,fillDot:Boolean,hideDot:Boolean,hideOpposite:{type:Boolean,default:void 0},icon:_r,iconColor:String,lineInset:[Number,String],...tr(),...hl(),...El(),...Qs(),...Zp(),...ia()},"VTimelineItem"),IZ=Qn()({name:"VTimelineItem",props:I3(),setup(e,s){let{slots:u}=s;const{dimensionStyles:d}=dl(e),b=Bi(0),E=yi();return Pi(E,T=>{var t;T&&(b.value=((t=T.$el.querySelector(".v-timeline-divider__dot"))==null?void 0:t.getBoundingClientRect().width)??0)},{flush:"post"}),fi(()=>{var T,t;return de("div",{class:["v-timeline-item",{"v-timeline-item--fill-dot":e.fillDot},e.class],style:[{"--v-timeline-dot-size":Ji(b.value),"--v-timeline-line-inset":e.lineInset?`calc(var(--v-timeline-dot-size) / 2 + ${Ji(e.lineInset)})`:Ji(0)},e.style]},[de("div",{class:"v-timeline-item__body",style:d.value},[(T=u.default)==null?void 0:T.call(u)]),de(MZ,{ref:E,hideDot:e.hideDot,icon:e.icon,iconColor:e.iconColor,size:e.size,elevation:e.elevation,dotColor:e.dotColor,fillDot:e.fillDot,rounded:e.rounded},{default:u.icon}),e.density!=="compact"&&de("div",{class:"v-timeline-item__opposite"},[!e.hideOpposite&&((t=u.opposite)==null?void 0:t.call(u))])])}),{}}}),PZ=vn({align:{type:String,default:"center",validator:e=>["center","start"].includes(e)},direction:{type:String,default:"vertical",validator:e=>["vertical","horizontal"].includes(e)},justify:{type:String,default:"auto",validator:e=>["auto","center"].includes(e)},side:{type:String,validator:e=>e==null||["start","end"].includes(e)},lineThickness:{type:[String,Number],default:2},lineColor:String,truncateLine:{type:String,validator:e=>["start","end","both"].includes(e)},...H1(I3({lineInset:0}),["dotColor","fillDot","hideOpposite","iconColor","lineInset","size"]),...tr(),...Hl(),...ia(),...Da()},"VTimeline"),AZ=Qn()({name:"VTimeline",props:PZ(),setup(e,s){let{slots:u}=s;const{themeClasses:d}=Ja(e),{densityClasses:b}=iu(e),{rtlClasses:E}=Cl();Io({VTimelineDivider:{lineColor:$n(e,"lineColor")},VTimelineItem:{density:$n(e,"density"),dotColor:$n(e,"dotColor"),fillDot:$n(e,"fillDot"),hideOpposite:$n(e,"hideOpposite"),iconColor:$n(e,"iconColor"),lineColor:$n(e,"lineColor"),lineInset:$n(e,"lineInset"),size:$n(e,"size")}});const T=Fe(()=>{const G=e.side?e.side:e.density!=="default"?"end":null;return G&&`v-timeline--side-${G}`}),t=Fe(()=>{const G=["v-timeline--truncate-line-start","v-timeline--truncate-line-end"];switch(e.truncateLine){case"both":return G;case"start":return G[0];case"end":return G[1];default:return null}});return fi(()=>de(e.tag,{class:["v-timeline",`v-timeline--${e.direction}`,`v-timeline--align-${e.align}`,`v-timeline--justify-${e.justify}`,t.value,{"v-timeline--inset-line":!!e.lineInset},d.value,b.value,T.value,E.value,e.class],style:[{"--v-timeline-line-thickness":Ji(e.lineThickness)},e.style]},u)),{}}}),kZ=vn({...tr(),...Ud({variant:"text"})},"VToolbarItems"),DZ=Qn()({name:"VToolbarItems",props:kZ(),setup(e,s){let{slots:u}=s;return Io({VBtn:{color:$n(e,"color"),height:"inherit",variant:$n(e,"variant")}}),fi(()=>{var d;return de("div",{class:["v-toolbar-items",e.class],style:e.style},[(d=u.default)==null?void 0:d.call(u)])}),{}}}),RZ=vn({id:String,text:String,...ul(Sb({closeOnBack:!1,location:"end",locationStrategy:"connected",eager:!0,minWidth:0,offset:10,openOnClick:!1,openOnHover:!0,origin:"auto",scrim:!1,scrollStrategy:"reposition",transition:!1}),["absolute","persistent"])},"VTooltip"),P3=Qn()({name:"VTooltip",props:RZ(),emits:{"update:modelValue":e=>!0},setup(e,s){let{slots:u}=s;const d=mr(e,"modelValue"),{scopeId:b}=iy(),E=uc(),T=Fe(()=>e.id||`v-tooltip-${E}`),t=yi(),G=Fe(()=>e.location.split(" ").length>1?e.location:e.location+" center"),W=Fe(()=>e.origin==="auto"||e.origin==="overlap"||e.origin.split(" ").length>1||e.location.split(" ").length>1?e.origin:e.origin+" center"),Y=Fe(()=>e.transition?e.transition:d.value?"scale-transition":"fade-transition"),ne=Fe(()=>oi({"aria-describedby":T.value},e.activatorProps));return fi(()=>{const J=jp.filterProps(e);return de(jp,oi({ref:t,class:["v-tooltip",e.class],style:e.style,id:T.value},J,{modelValue:d.value,"onUpdate:modelValue":Q=>d.value=Q,transition:Y.value,absolute:!0,location:G.value,origin:W.value,persistent:!0,role:"tooltip",activatorProps:ne.value,_disableGlobalStack:!0},b),{activator:u.activator,default:function(){var pe;for(var Q=arguments.length,ce=new Array(Q),ie=0;ie<Q;ie++)ce[ie]=arguments[ie];return((pe=u.default)==null?void 0:pe.call(u,...ce))??e.text}})}),$d({},t)}}),LZ=Qn()({name:"VValidation",props:RL(),emits:{"update:modelValue":e=>!0},setup(e,s){let{slots:u}=s;const d=LL(e,"validation");return()=>{var b;return(b=u.default)==null?void 0:b.call(u,d)}}}),zZ=Object.freeze(Object.defineProperty({__proto__:null,VAlert:i$,VAlertTitle:EL,VApp:dU,VAppBar:DU,VAppBarNavIcon:QU,VAppBarTitle:e$,VAutocomplete:C8,VAvatar:Vd,VBadge:M8,VBanner:A8,VBannerActions:uz,VBannerText:hz,VBottomNavigation:D8,VBottomSheet:L8,VBreadcrumbs:B8,VBreadcrumbsDivider:fz,VBreadcrumbsItem:pz,VBtn:Ya,VBtnGroup:gT,VBtnToggle:BU,VCard:$8,VCardActions:mz,VCardItem:yz,VCardSubtitle:gz,VCardText:vz,VCardTitle:_z,VCarousel:J8,VCarouselItem:eG,VCheckbox:d$,VCheckboxBtn:Am,VChip:xv,VChipGroup:_$,VClassIcon:PC,VCode:tG,VCol:Aq,VColorPicker:$G,VCombobox:HG,VComponentIcon:fT,VConfirmEdit:WG,VContainer:Eq,VCounter:lw,VDataIterator:rq,VDataTable:xq,VDataTableFooter:lb,VDataTableHeaders:U_,VDataTableRow:sE,VDataTableRows:$_,VDataTableServer:Tq,VDataTableVirtual:wq,VDatePicker:$q,VDatePickerControls:DT,VDatePickerHeader:RT,VDatePickerMonth:LT,VDatePickerMonths:zT,VDatePickerYears:OT,VDefaultsProvider:da,VDialog:TT,VDialogBottomTransition:gU,VDialogTopTransition:_U,VDialogTransition:Q1,VDivider:wb,VEmptyState:qq,VExpandTransition:ew,VExpandXTransition:RC,VExpansionPanel:Hq,VExpansionPanelText:FT,VExpansionPanelTitle:BT,VExpansionPanels:Xq,VFab:Kq,VFabTransition:mU,VFadeTransition:nb,VField:bv,VFieldLabel:Dx,VFileInput:Qq,VFooter:tH,VForm:iH,VHover:aH,VIcon:Ka,VImg:Pm,VInfiniteScroll:oH,VInput:Rc,VItem:uH,VItemGroup:cH,VKbd:hH,VLabel:vv,VLayout:fH,VLayoutItem:mH,VLazy:_H,VLigatureIcon:iU,VList:ow,VListGroup:xT,VListImg:N$,VListItem:km,VListItemAction:U$,VListItemMedia:G$,VListItemSubtitle:HL,VListItemTitle:ZL,VListSubheader:WL,VLocaleProvider:vH,VMain:bH,VMenu:hv,VMessages:kL,VNavigationDrawer:AH,VNoSsr:kH,VOtpInput:RH,VOverlay:jp,VPagination:AT,VParallax:OH,VProgressCircular:uv,VProgressLinear:nw,VRadio:BH,VRadioGroup:NH,VRangeSlider:UH,VRating:GH,VResponsive:pT,VRow:Fq,VScaleTransition:kC,VScrollXReverseTransition:vU,VScrollXTransition:yU,VScrollYReverseTransition:bU,VScrollYTransition:xU,VSelect:WC,VSelectionControl:Dg,VSelectionControlGroup:IL,VSheet:j_,VSkeletonLoader:WH,VSlideGroup:sb,VSlideGroupItem:XH,VSlideXReverseTransition:SU,VSlideXTransition:wU,VSlideYReverseTransition:TU,VSlideYTransition:DC,VSlider:PT,VSnackbar:JH,VSpacer:s3,VSparkline:nZ,VSpeedDial:rZ,VStepper:hZ,VStepperActions:x3,VStepperHeader:b3,VStepperItem:w3,VStepperWindow:S3,VStepperWindowItem:T3,VSvgIcon:IC,VSwitch:fZ,VSystemBar:mZ,VTab:C3,VTable:G_,VTabs:bZ,VTabsWindow:E3,VTabsWindowItem:M3,VTextField:B_,VTextarea:SZ,VThemeProvider:CZ,VTimeline:AZ,VTimelineItem:IZ,VToolbar:mT,VToolbarItems:DZ,VToolbarTitle:AC,VTooltip:P3,VValidation:LZ,VVirtualScroll:uw,VWindow:V_,VWindowItem:N_},Symbol.toStringTag,{value:"Module"}));function OZ(e,s){const u=s.modifiers||{},d=s.value,{once:b,immediate:E,...T}=u,t=!Object.keys(T).length,{handler:G,options:W}=typeof d=="object"?d:{handler:d,options:{attributes:(T==null?void 0:T.attr)??t,characterData:(T==null?void 0:T.char)??t,childList:(T==null?void 0:T.child)??t,subtree:(T==null?void 0:T.sub)??t}},Y=new MutationObserver(function(){let ne=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],J=arguments.length>1?arguments[1]:void 0;G==null||G(ne,J),b&&A3(e,s)});E&&(G==null||G([],Y)),e._mutate=Object(e._mutate),e._mutate[s.instance.$.uid]={observer:Y},Y.observe(e,W)}function A3(e,s){var u;(u=e._mutate)!=null&&u[s.instance.$.uid]&&(e._mutate[s.instance.$.uid].observer.disconnect(),delete e._mutate[s.instance.$.uid])}const FZ={mounted:OZ,unmounted:A3};function BZ(e,s){var b,E;const u=s.value,d={passive:!((b=s.modifiers)!=null&&b.active)};window.addEventListener("resize",u,d),e._onResize=Object(e._onResize),e._onResize[s.instance.$.uid]={handler:u,options:d},(E=s.modifiers)!=null&&E.quiet||u()}function VZ(e,s){var b;if(!((b=e._onResize)!=null&&b[s.instance.$.uid]))return;const{handler:u,options:d}=e._onResize[s.instance.$.uid];window.removeEventListener("resize",u,d),delete e._onResize[s.instance.$.uid]}const NZ={mounted:BZ,unmounted:VZ};function k3(e,s){const{self:u=!1}=s.modifiers??{},d=s.value,b=typeof d=="object"&&d.options||{passive:!0},E=typeof d=="function"||"handleEvent"in d?d:d.handler,T=u?e:s.arg?document.querySelector(s.arg):window;T&&(T.addEventListener("scroll",E,b),e._onScroll=Object(e._onScroll),e._onScroll[s.instance.$.uid]={handler:E,options:b,target:u?void 0:T})}function D3(e,s){var E;if(!((E=e._onScroll)!=null&&E[s.instance.$.uid]))return;const{handler:u,options:d,target:b=e}=e._onScroll[s.instance.$.uid];b.removeEventListener("scroll",u,d),delete e._onScroll[s.instance.$.uid]}function jZ(e,s){s.value!==s.oldValue&&(D3(e,s),k3(e,s))}const UZ={mounted:k3,unmounted:D3,updated:jZ};function $Z(e,s){const u=typeof e=="string"?Ul(e):e,d=GZ(u,s);return{mounted:d,updated:d,unmounted(b){eR(null,b)}}}function GZ(e,s){return function(u,d,b){var ne,J,Q;const E=typeof s=="function"?s(d):s,T=((ne=d.value)==null?void 0:ne.text)??d.value??(E==null?void 0:E.text),t=q1(d.value)?d.value:{},G=()=>T??u.textContent,W=(b.ctx===d.instance.$?(J=qZ(b,d.instance.$))==null?void 0:J.provides:(Q=b.ctx)==null?void 0:Q.provides)??d.instance.$.provides,Y=Uf(e,oi(E,t),G);Y.appContext=Object.assign(Object.create(null),d.instance.$.appContext,{provides:W}),eR(Y,u)}}function qZ(e,s){const u=new Set,d=E=>{var T,t;for(const G of E){if(!G)continue;if(G===e||G.el&&e.el&&G.el===e.el)return!0;u.add(G);let W;if(G.suspense?W=d([G.ssContent]):Array.isArray(G.children)?W=d(G.children):(T=G.component)!=null&&T.vnode&&(W=d([(t=G.component)==null?void 0:t.subTree])),W)return W;u.delete(G)}return!1};if(!d([s.subTree]))return s;const b=Array.from(u).reverse();for(const E of b)if(E.component)return E.component;return s}const HZ=$Z(P3,e=>{var s;return{activator:"parent",location:(s=e.arg)==null?void 0:s.replace("-"," "),text:typeof e.value=="boolean"?void 0:e.value}}),ZZ=Object.freeze(Object.defineProperty({__proto__:null,ClickOutside:az,Intersect:gb,Mutate:FZ,Resize:NZ,Ripple:zm,Scroll:UZ,Tooltip:HZ,Touch:XC},Symbol.toStringTag,{value:"Module"}));var Cx={},K0={},dk;function WZ(){if(dk)return K0;dk=1,Object.defineProperty(K0,"__esModule",{value:!0});class e{constructor(u=null){this.state="pending",this.fate="unresolved",this._val=u||null,this.promise=new Promise((d,b)=>{this._resolve=d,this._reject=b}),this.promise.then(d=>{this.state="fulfilled",this._val=d},()=>{this.state="rejected",this._val=null})}resolve(u){if(this.fate==="resolved")throw"Deferred cannot be resolved twice";this.fate="resolved",this._resolve(u)}reject(u){if(this.fate==="resolved")throw"Deferred cannot be resolved twice";this.fate="resolved",this._reject(u)}isResolved(){return this.fate==="resolved"}isPending(){return this.state==="pending"}isFulfilled(){return this.state==="fulfilled"}isRejected(){return this.state==="rejected"}get val(){return this._val}}return K0.default=e,K0}var fk;function R3(){if(fk)return Cx;fk=1;var e=Cx.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(Cx,"__esModule",{value:!0});const s=e(WZ());return Cx.default=s.default,Cx}var XZ=R3();const ry=Z_(XZ);var Ex={},pk;function YZ(){if(pk)return Ex;pk=1;var e=Ex.__importDefault||function(u){return u&&u.__esModule?u:{default:u}};Object.defineProperty(Ex,"__esModule",{value:!0});const s=e(R3());return Ex.default=s.default,Ex}var KZ=YZ();const Tw=Z_(KZ);var V2,mk;function JZ(){return mk||(mk=1,V2=function e(s,u){if(s===u)return!0;if(s&&u&&typeof s=="object"&&typeof u=="object"){if(s.constructor!==u.constructor)return!1;var d,b,E;if(Array.isArray(s)){if(d=s.length,d!=u.length)return!1;for(b=d;b--!==0;)if(!e(s[b],u[b]))return!1;return!0}if(s.constructor===RegExp)return s.source===u.source&&s.flags===u.flags;if(s.valueOf!==Object.prototype.valueOf)return s.valueOf()===u.valueOf();if(s.toString!==Object.prototype.toString)return s.toString()===u.toString();if(E=Object.keys(s),d=E.length,d!==Object.keys(u).length)return!1;for(b=d;b--!==0;)if(!Object.prototype.hasOwnProperty.call(u,E[b]))return!1;for(b=d;b--!==0;){var T=E[b];if(!e(s[T],u[T]))return!1}return!0}return s!==s&&u!==u}),V2}var QZ=JZ();const A1=Z_(QZ),VT=function(e,s){const u={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},d={on(E,T,t){if(u[E]===void 0)throw new Error(`Invalid event type: ${E}`);u[E].push({selector:T,fn:t})},render(E){s.store.featureChanged(E)}},b=function(E,T){const t=u[E];let G=t.length;for(;G--;){const W=t[G];if(W.selector(T)){W.fn.call(d,T)||s.store.render(),s.ui.updateMapClasses();break}}};return e.start.call(d),{render:e.render,stop(){e.stop&&e.stop()},trash(){e.trash&&(e.trash(),s.store.render())},combineFeatures(){e.combineFeatures&&e.combineFeatures()},uncombineFeatures(){e.uncombineFeatures&&e.uncombineFeatures()},drag(E){b("drag",E)},click(E){b("click",E)},mousemove(E){b("mousemove",E)},mousedown(E){b("mousedown",E)},mouseup(E){b("mouseup",E)},mouseout(E){b("mouseout",E)},keydown(E){b("keydown",E)},keyup(E){b("keyup",E)},touchstart(E){b("touchstart",E)},touchmove(E){b("touchmove",E)},touchend(E){b("touchend",E)},tap(E){b("tap",E)}}};var J0={},Mx={},gk;function e7(){return gk||(gk=1,Mx.RADIUS=6378137,Mx.FLATTENING=1/298.257223563,Mx.POLAR_RADIUS=63567523142e-4),Mx}var _k;function t7(){if(_k)return J0;_k=1;var e=e7();J0.geometry=s,J0.ring=d;function s(E){var T=0,t;switch(E.type){case"Polygon":return u(E.coordinates);case"MultiPolygon":for(t=0;t<E.coordinates.length;t++)T+=u(E.coordinates[t]);return T;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(t=0;t<E.geometries.length;t++)T+=s(E.geometries[t]);return T}}function u(E){var T=0;if(E&&E.length>0){T+=Math.abs(d(E[0]));for(var t=1;t<E.length;t++)T-=Math.abs(d(E[t]))}return T}function d(E){var T,t,G,W,Y,ne,J,Q=0,ce=E.length;if(ce>2){for(J=0;J<ce;J++)J===ce-2?(W=ce-2,Y=ce-1,ne=0):J===ce-1?(W=ce-1,Y=0,ne=1):(W=J,Y=J+1,ne=J+2),T=E[W],t=E[Y],G=E[ne],Q+=(b(G[0])-b(T[0]))*Math.sin(b(t[1]));Q=Q*e.RADIUS*e.RADIUS/2}return Q}function b(E){return E*Math.PI/180}return J0}var n7=t7();const i7=Z_(n7),dh={CANVAS:"mapboxgl-canvas",CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},zd={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},Eo={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},ph={POLYGON:"polygon",LINE:"line_string",POINT:"point"},Vr={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},Va={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select"},Lu={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},Mb={MOVE:"move",CHANGE_PROPERTIES:"change_properties",CHANGE_COORDINATES:"change_coordinates"},tu={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},cc={ACTIVE:"true",INACTIVE:"false"},L3=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],r7=-90,NT=-85,a7=90,jT=85,s7=-270,o7=270,z3=Object.freeze(Object.defineProperty({__proto__:null,LAT_MAX:a7,LAT_MIN:r7,LAT_RENDERED_MAX:jT,LAT_RENDERED_MIN:NT,LNG_MAX:o7,LNG_MIN:s7,activeStates:cc,classes:dh,cursors:Eo,events:Lu,geojsonTypes:Vr,interactions:L3,meta:tu,modes:Va,sources:zd,types:ph,updateActions:Mb},Symbol.toStringTag,{value:"Module"})),yk={Point:0,LineString:1,MultiLineString:1,Polygon:2};function l7(e,s){const u=yk[e.geometry.type]-yk[s.geometry.type];return u===0&&e.geometry.type===Vr.POLYGON?e.area-s.area:u}function O3(e){return e.map(s=>(s.geometry.type===Vr.POLYGON&&(s.area=i7.geometry({type:Vr.FEATURE,property:{},geometry:s.geometry})),s)).sort(l7).map(s=>(delete s.area,s))}function F3(e,s=0){return[[e.point.x-s,e.point.y-s],[e.point.x+s,e.point.y+s]]}function Bd(e){if(this._items={},this._nums={},this._length=e?e.length:0,!!e)for(let s=0,u=e.length;s<u;s++)this.add(e[s]),e[s]!==void 0&&(typeof e[s]=="string"?this._items[e[s]]=s:this._nums[e[s]]=s)}Bd.prototype.add=function(e){return this.has(e)?this:(this._length++,typeof e=="string"?this._items[e]=this._length:this._nums[e]=this._length,this)};Bd.prototype.delete=function(e){return this.has(e)===!1?this:(this._length--,delete this._items[e],delete this._nums[e],this)};Bd.prototype.has=function(e){return typeof e!="string"&&typeof e!="number"?!1:this._items[e]!==void 0||this._nums[e]!==void 0};Bd.prototype.values=function(){const e=[];return Object.keys(this._items).forEach(s=>{e.push({k:s,v:this._items[s]})}),Object.keys(this._nums).forEach(s=>{e.push({k:JSON.parse(s),v:this._nums[s]})}),e.sort((s,u)=>s.v-u.v).map(s=>s.k)};Bd.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};const c7=[tu.FEATURE,tu.MIDPOINT,tu.VERTEX],dv={click:u7,touch:h7};function u7(e,s,u){return B3(e,s,u,u.options.clickBuffer)}function h7(e,s,u){return B3(e,s,u,u.options.touchBuffer)}function B3(e,s,u,d){if(u.map===null)return[];const b=e?F3(e,d):s,E={};u.options.styles&&(E.layers=u.options.styles.map(W=>W.id).filter(W=>u.map.getLayer(W)!=null));const T=u.map.queryRenderedFeatures(b,E).filter(W=>c7.indexOf(W.properties.meta)!==-1),t=new Bd,G=[];return T.forEach(W=>{const Y=W.properties.id;t.has(Y)||(t.add(Y),G.push(W))}),O3(G)}function d1(e,s){const u=dv.click(e,null,s),d={mouse:Eo.NONE};return u[0]&&(d.mouse=u[0].properties.active===cc.ACTIVE?Eo.MOVE:Eo.POINTER,d.feature=u[0].properties.meta),s.events.currentModeName().indexOf("draw")!==-1&&(d.mouse=Eo.ADD),s.ui.queueMapClasses(d),s.ui.updateMapClasses(),u[0]}function fE(e,s){const u=e.x-s.x,d=e.y-s.y;return Math.sqrt(u*u+d*d)}const d7=4,f7=12,p7=500;function UT(e,s,u={}){const d=u.fineTolerance!=null?u.fineTolerance:d7,b=u.grossTolerance!=null?u.grossTolerance:f7,E=u.interval!=null?u.interval:p7;e.point=e.point||s.point,e.time=e.time||s.time;const T=fE(e.point,s.point);return T<d||T<b&&s.time-e.time<E}const m7=25,g7=250;function $T(e,s,u={}){const d=u.tolerance!=null?u.tolerance:m7,b=u.interval!=null?u.interval:g7;return e.point=e.point||s.point,e.time=e.time||s.time,fE(e.point,s.point)<d&&s.time-e.time<b}let _7=(e,s=21)=>(u=s)=>{let d="",b=u|0;for(;b--;)d+=e[Math.random()*e.length|0];return d};const y7=_7("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",32);function pE(){return y7()}const zu=function(e,s){this.ctx=e,this.properties=s.properties||{},this.coordinates=s.geometry.coordinates,this.id=s.id||pE(),this.type=s.geometry.type};zu.prototype.changed=function(){this.ctx.store.featureChanged(this.id)};zu.prototype.incomingCoords=function(e){this.setCoordinates(e)};zu.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()};zu.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))};zu.prototype.setProperty=function(e,s){this.properties[e]=s};zu.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:Vr.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))};zu.prototype.internal=function(e){const s={id:this.id,meta:tu.FEATURE,"meta:type":this.type,active:cc.INACTIVE,mode:e};if(this.ctx.options.userProperties)for(const u in this.properties)s[`user_${u}`]=this.properties[u];return{type:Vr.FEATURE,properties:s,geometry:{coordinates:this.getCoordinates(),type:this.type}}};const Vg=function(e,s){zu.call(this,e,s)};Vg.prototype=Object.create(zu.prototype);Vg.prototype.isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"};Vg.prototype.updateCoordinate=function(e,s,u){arguments.length===3?this.coordinates=[s,u]:this.coordinates=[e,s],this.changed()};Vg.prototype.getCoordinate=function(){return this.getCoordinates()};const Wp=function(e,s){zu.call(this,e,s)};Wp.prototype=Object.create(zu.prototype);Wp.prototype.isValid=function(){return this.coordinates.length>1};Wp.prototype.addCoordinate=function(e,s,u){this.changed();const d=parseInt(e,10);this.coordinates.splice(d,0,[s,u])};Wp.prototype.getCoordinate=function(e){const s=parseInt(e,10);return JSON.parse(JSON.stringify(this.coordinates[s]))};Wp.prototype.removeCoordinate=function(e){this.changed(),this.coordinates.splice(parseInt(e,10),1)};Wp.prototype.updateCoordinate=function(e,s,u){const d=parseInt(e,10);this.coordinates[d]=[s,u],this.changed()};const Xh=function(e,s){zu.call(this,e,s),this.coordinates=this.coordinates.map(u=>u.slice(0,-1))};Xh.prototype=Object.create(zu.prototype);Xh.prototype.isValid=function(){return this.coordinates.length===0?!1:this.coordinates.every(e=>e.length>2)};Xh.prototype.incomingCoords=function(e){this.coordinates=e.map(s=>s.slice(0,-1)),this.changed()};Xh.prototype.setCoordinates=function(e){this.coordinates=e,this.changed()};Xh.prototype.addCoordinate=function(e,s,u){this.changed();const d=e.split(".").map(E=>parseInt(E,10));this.coordinates[d[0]].splice(d[1],0,[s,u])};Xh.prototype.removeCoordinate=function(e){this.changed();const s=e.split(".").map(d=>parseInt(d,10)),u=this.coordinates[s[0]];u&&(u.splice(s[1],1),u.length<3&&this.coordinates.splice(s[0],1))};Xh.prototype.getCoordinate=function(e){const s=e.split(".").map(d=>parseInt(d,10)),u=this.coordinates[s[0]];return JSON.parse(JSON.stringify(u[s[1]]))};Xh.prototype.getCoordinates=function(){return this.coordinates.map(e=>e.concat([e[0]]))};Xh.prototype.updateCoordinate=function(e,s,u){this.changed();const d=e.split("."),b=parseInt(d[0],10),E=parseInt(d[1],10);this.coordinates[b]===void 0&&(this.coordinates[b]=[]),this.coordinates[b][E]=[s,u]};const v7={MultiPoint:Vg,MultiLineString:Wp,MultiPolygon:Xh},Cw=(e,s,u,d,b)=>{const E=u.split("."),T=parseInt(E[0],10),t=E[1]?E.slice(1).join("."):null;return e[T][s](t,d,b)},Ru=function(e,s){if(zu.call(this,e,s),delete this.coordinates,this.model=v7[s.geometry.type],this.model===void 0)throw new TypeError(`${s.geometry.type} is not a valid type`);this.features=this._coordinatesToFeatures(s.geometry.coordinates)};Ru.prototype=Object.create(zu.prototype);Ru.prototype._coordinatesToFeatures=function(e){const s=this.model.bind(this);return e.map(u=>new s(this.ctx,{id:pE(),type:Vr.FEATURE,properties:{},geometry:{coordinates:u,type:this.type.replace("Multi","")}}))};Ru.prototype.isValid=function(){return this.features.every(e=>e.isValid())};Ru.prototype.setCoordinates=function(e){this.features=this._coordinatesToFeatures(e),this.changed()};Ru.prototype.getCoordinate=function(e){return Cw(this.features,"getCoordinate",e)};Ru.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(e=>e.type===Vr.POLYGON?e.getCoordinates():e.coordinates)))};Ru.prototype.updateCoordinate=function(e,s,u){Cw(this.features,"updateCoordinate",e,s,u),this.changed()};Ru.prototype.addCoordinate=function(e,s,u){Cw(this.features,"addCoordinate",e,s,u),this.changed()};Ru.prototype.removeCoordinate=function(e){Cw(this.features,"removeCoordinate",e),this.changed()};Ru.prototype.getFeatures=function(){return this.features};function Sa(e){this.map=e.map,this.drawConfig=JSON.parse(JSON.stringify(e.options||{})),this._ctx=e}Sa.prototype.setSelected=function(e){return this._ctx.store.setSelected(e)};Sa.prototype.setSelectedCoordinates=function(e){this._ctx.store.setSelectedCoordinates(e),e.reduce((s,u)=>(s[u.feature_id]===void 0&&(s[u.feature_id]=!0,this._ctx.store.get(u.feature_id).changed()),s),{})};Sa.prototype.getSelected=function(){return this._ctx.store.getSelected()};Sa.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()};Sa.prototype.isSelected=function(e){return this._ctx.store.isSelected(e)};Sa.prototype.getFeature=function(e){return this._ctx.store.get(e)};Sa.prototype.select=function(e){return this._ctx.store.select(e)};Sa.prototype.deselect=function(e){return this._ctx.store.deselect(e)};Sa.prototype.deleteFeature=function(e,s={}){return this._ctx.store.delete(e,s)};Sa.prototype.addFeature=function(e,s={}){return this._ctx.store.add(e,s)};Sa.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()};Sa.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()};Sa.prototype.setActionableState=function(e={}){const s={trash:e.trash||!1,combineFeatures:e.combineFeatures||!1,uncombineFeatures:e.uncombineFeatures||!1};return this._ctx.events.actionable(s)};Sa.prototype.changeMode=function(e,s={},u={}){return this._ctx.events.changeMode(e,s,u)};Sa.prototype.fire=function(e,s){return this._ctx.events.fire(e,s)};Sa.prototype.updateUIClasses=function(e){return this._ctx.ui.queueMapClasses(e)};Sa.prototype.activateUIButton=function(e){return this._ctx.ui.setActiveButton(e)};Sa.prototype.featuresAt=function(e,s,u="click"){if(u!=="click"&&u!=="touch")throw new Error("invalid buffer type");return dv[u](e,s,this._ctx)};Sa.prototype.newFeature=function(e){const s=e.geometry.type;return s===Vr.POINT?new Vg(this._ctx,e):s===Vr.LINE_STRING?new Wp(this._ctx,e):s===Vr.POLYGON?new Xh(this._ctx,e):new Ru(this._ctx,e)};Sa.prototype.isInstanceOf=function(e,s){if(e===Vr.POINT)return s instanceof Vg;if(e===Vr.LINE_STRING)return s instanceof Wp;if(e===Vr.POLYGON)return s instanceof Xh;if(e==="MultiFeature")return s instanceof Ru;throw new Error(`Unknown feature class: ${e}`)};Sa.prototype.doRender=function(e){return this._ctx.store.featureChanged(e)};Sa.prototype.onSetup=function(){};Sa.prototype.onDrag=function(){};Sa.prototype.onClick=function(){};Sa.prototype.onMouseMove=function(){};Sa.prototype.onMouseDown=function(){};Sa.prototype.onMouseUp=function(){};Sa.prototype.onMouseOut=function(){};Sa.prototype.onKeyUp=function(){};Sa.prototype.onKeyDown=function(){};Sa.prototype.onTouchStart=function(){};Sa.prototype.onTouchMove=function(){};Sa.prototype.onTouchEnd=function(){};Sa.prototype.onTap=function(){};Sa.prototype.onStop=function(){};Sa.prototype.onTrash=function(){};Sa.prototype.onCombineFeature=function(){};Sa.prototype.onUncombineFeature=function(){};Sa.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};const V3={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},x7=Object.keys(V3);function b7(e){const s=Object.keys(e);return function(u,d={}){let b={};const E=s.reduce((t,G)=>(t[G]=e[G],t),new Sa(u));function T(t){return G=>E[t](b,G)}return{start(){b=E.onSetup(d),x7.forEach(t=>{const G=V3[t];let W=()=>!1;e[G]&&(W=()=>!0),this.on(t,W,T(G))})},stop(){E.onStop(b)},trash(){E.onTrash(b)},combineFeatures(){E.onCombineFeatures(b)},uncombineFeatures(){E.onUncombineFeatures(b)},render(t,G){E.toDisplayFeatures(b,t,G)}}}}function w7(e){const s=Object.keys(e.options.modes).reduce((J,Q)=>(J[Q]=b7(e.options.modes[Q]),J),{});let u={},d={};const b={};let E=null,T=null;b.drag=function(J,Q){Q({point:J.point,time:new Date().getTime()})?(e.ui.queueMapClasses({mouse:Eo.DRAG}),T.drag(J)):J.originalEvent.stopPropagation()},b.mousedrag=function(J){b.drag(J,Q=>!UT(u,Q))},b.touchdrag=function(J){b.drag(J,Q=>!$T(d,Q))},b.mousemove=function(J){if((J.originalEvent.buttons!==void 0?J.originalEvent.buttons:J.originalEvent.which)===1)return b.mousedrag(J);const ce=d1(J,e);J.featureTarget=ce,T.mousemove(J)},b.mousedown=function(J){u={time:new Date().getTime(),point:J.point};const Q=d1(J,e);J.featureTarget=Q,T.mousedown(J)},b.mouseup=function(J){const Q=d1(J,e);J.featureTarget=Q,UT(u,{point:J.point,time:new Date().getTime()})?T.click(J):T.mouseup(J)},b.mouseout=function(J){T.mouseout(J)},b.touchstart=function(J){if(!e.options.touchEnabled)return;d={time:new Date().getTime(),point:J.point};const Q=dv.touch(J,null,e)[0];J.featureTarget=Q,T.touchstart(J)},b.touchmove=function(J){if(e.options.touchEnabled)return T.touchmove(J),b.touchdrag(J)},b.touchend=function(J){if(J.originalEvent.preventDefault(),!e.options.touchEnabled)return;const Q=dv.touch(J,null,e)[0];J.featureTarget=Q,$T(d,{time:new Date().getTime(),point:J.point})?T.tap(J):T.touchend(J)};const t=J=>!(J===8||J===46||J>=48&&J<=57);b.keydown=function(J){(J.srcElement||J.target).classList.contains(dh.CANVAS)&&((J.keyCode===8||J.keyCode===46)&&e.options.controls.trash?(J.preventDefault(),T.trash()):t(J.keyCode)?T.keydown(J):J.keyCode===49&&e.options.controls.point?G(Va.DRAW_POINT):J.keyCode===50&&e.options.controls.line_string?G(Va.DRAW_LINE_STRING):J.keyCode===51&&e.options.controls.polygon&&G(Va.DRAW_POLYGON))},b.keyup=function(J){t(J.keyCode)&&T.keyup(J)},b.zoomend=function(){e.store.changeZoom()},b.data=function(J){if(J.dataType==="style"){const{setup:Q,map:ce,options:ie,store:pe}=e;ie.styles.some(Ie=>ce.getLayer(Ie.id))||(Q.addLayers(),pe.setDirty(),pe.render())}};function G(J,Q,ce={}){T.stop();const ie=s[J];if(ie===void 0)throw new Error(`${J} is not valid`);E=J;const pe=ie(e,Q);T=VT(pe,e),ce.silent||e.map.fire(Lu.MODE_CHANGE,{mode:J}),e.store.setDirty(),e.store.render()}const W={trash:!1,combineFeatures:!1,uncombineFeatures:!1};function Y(J){let Q=!1;Object.keys(J).forEach(ce=>{if(W[ce]===void 0)throw new Error("Invalid action type");W[ce]!==J[ce]&&(Q=!0),W[ce]=J[ce]}),Q&&e.map.fire(Lu.ACTIONABLE,{actions:W})}return{start(){E=e.options.defaultMode,T=VT(s[E](e),e)},changeMode:G,actionable:Y,currentModeName(){return E},currentModeRender(J,Q){return T.render(J,Q)},fire(J,Q){e.map&&e.map.fire(J,Q)},addEventListeners(){e.map.on("mousemove",b.mousemove),e.map.on("mousedown",b.mousedown),e.map.on("mouseup",b.mouseup),e.map.on("data",b.data),e.map.on("touchmove",b.touchmove),e.map.on("touchstart",b.touchstart),e.map.on("touchend",b.touchend),e.container.addEventListener("mouseout",b.mouseout),e.options.keybindings&&(e.container.addEventListener("keydown",b.keydown),e.container.addEventListener("keyup",b.keyup))},removeEventListeners(){e.map.off("mousemove",b.mousemove),e.map.off("mousedown",b.mousedown),e.map.off("mouseup",b.mouseup),e.map.off("data",b.data),e.map.off("touchmove",b.touchmove),e.map.off("touchstart",b.touchstart),e.map.off("touchend",b.touchend),e.container.removeEventListener("mouseout",b.mouseout),e.options.keybindings&&(e.container.removeEventListener("keydown",b.keydown),e.container.removeEventListener("keyup",b.keyup))},trash(J){T.trash(J)},combineFeatures(){T.combineFeatures()},uncombineFeatures(){T.uncombineFeatures()},getMode(){return E}}}function Ib(e){return[].concat(e).filter(s=>s!==void 0)}function S7(){const e=this;if(!(e.ctx.map&&e.ctx.map.getSource(zd.HOT)!==void 0))return G();const u=e.ctx.events.currentModeName();e.ctx.ui.queueMapClasses({mode:u});let d=[],b=[];e.isDirty?b=e.getAllIds():(d=e.getChangedIds().filter(W=>e.get(W)!==void 0),b=e.sources.hot.filter(W=>W.properties.id&&d.indexOf(W.properties.id)===-1&&e.get(W.properties.id)!==void 0).map(W=>W.properties.id)),e.sources.hot=[];const E=e.sources.cold.length;e.sources.cold=e.isDirty?[]:e.sources.cold.filter(W=>{const Y=W.properties.id||W.properties.parent;return d.indexOf(Y)===-1});const T=E!==e.sources.cold.length||b.length>0;d.forEach(W=>t(W,"hot")),b.forEach(W=>t(W,"cold"));function t(W,Y){const J=e.get(W).internal(u);e.ctx.events.currentModeRender(J,Q=>{Q.properties.mode=u,e.sources[Y].push(Q)})}T&&e.ctx.map.getSource(zd.COLD).setData({type:Vr.FEATURE_COLLECTION,features:e.sources.cold}),e.ctx.map.getSource(zd.HOT).setData({type:Vr.FEATURE_COLLECTION,features:e.sources.hot}),G();function G(){e.isDirty=!1,e.clearChangedIds()}}function eo(e){this._features={},this._featureIds=new Bd,this._selectedFeatureIds=new Bd,this._selectedCoordinates=[],this._changedFeatureIds=new Bd,this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=e,this.sources={hot:[],cold:[]};let s;this.render=()=>{s||(s=requestAnimationFrame(()=>{s=null,S7.call(this),this._emitSelectionChange&&(this.ctx.events.fire(Lu.SELECTION_CHANGE,{features:this.getSelected().map(u=>u.toGeoJSON()),points:this.getSelectedCoordinates().map(u=>({type:Vr.FEATURE,properties:{},geometry:{type:Vr.POINT,coordinates:u.coordinates}}))}),this._emitSelectionChange=!1),this.ctx.events.fire(Lu.RENDER,{})}))},this.isDirty=!1}eo.prototype.createRenderBatch=function(){const e=this.render;let s=0;return this.render=function(){s++},()=>{this.render=e,s>0&&this.render()}};eo.prototype.setDirty=function(){return this.isDirty=!0,this};eo.prototype.featureCreated=function(e,s={}){if(this._changedFeatureIds.add(e),(s.silent!=null?s.silent:this.ctx.options.suppressAPIEvents)!==!0){const d=this.get(e);this.ctx.events.fire(Lu.CREATE,{features:[d.toGeoJSON()]})}return this};eo.prototype.featureChanged=function(e,s={}){return this._changedFeatureIds.add(e),(s.silent!=null?s.silent:this.ctx.options.suppressAPIEvents)!==!0&&this.ctx.events.fire(Lu.UPDATE,{action:s.action?s.action:Mb.CHANGE_COORDINATES,features:[this.get(e).toGeoJSON()]}),this};eo.prototype.getChangedIds=function(){return this._changedFeatureIds.values()};eo.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this};eo.prototype.getAllIds=function(){return this._featureIds.values()};eo.prototype.add=function(e,s={}){return this._features[e.id]=e,this._featureIds.add(e.id),this.featureCreated(e.id,{silent:s.silent}),this};eo.prototype.delete=function(e,s={}){const u=[];return Ib(e).forEach(d=>{this._featureIds.has(d)&&(this._featureIds.delete(d),this._selectedFeatureIds.delete(d),s.silent||u.indexOf(this._features[d])===-1&&u.push(this._features[d].toGeoJSON()),delete this._features[d],this.isDirty=!0)}),u.length&&this.ctx.events.fire(Lu.DELETE,{features:u}),N3(this,s),this};eo.prototype.get=function(e){return this._features[e]};eo.prototype.getAll=function(){return Object.keys(this._features).map(e=>this._features[e])};eo.prototype.select=function(e,s={}){return Ib(e).forEach(u=>{this._selectedFeatureIds.has(u)||(this._selectedFeatureIds.add(u),this._changedFeatureIds.add(u),s.silent||(this._emitSelectionChange=!0))}),this};eo.prototype.deselect=function(e,s={}){return Ib(e).forEach(u=>{this._selectedFeatureIds.has(u)&&(this._selectedFeatureIds.delete(u),this._changedFeatureIds.add(u),s.silent||(this._emitSelectionChange=!0))}),N3(this,s),this};eo.prototype.clearSelected=function(e={}){return this.deselect(this._selectedFeatureIds.values(),{silent:e.silent}),this};eo.prototype.setSelected=function(e,s={}){return e=Ib(e),this.deselect(this._selectedFeatureIds.values().filter(u=>e.indexOf(u)===-1),{silent:s.silent}),this.select(e.filter(u=>!this._selectedFeatureIds.has(u)),{silent:s.silent}),this};eo.prototype.setSelectedCoordinates=function(e){return this._selectedCoordinates=e,this._emitSelectionChange=!0,this};eo.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this};eo.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()};eo.prototype.getSelected=function(){return this.getSelectedIds().map(e=>this.get(e))};eo.prototype.getSelectedCoordinates=function(){return this._selectedCoordinates.map(s=>({coordinates:this.get(s.feature_id).getCoordinate(s.coord_path)}))};eo.prototype.isSelected=function(e){return this._selectedFeatureIds.has(e)};eo.prototype.setFeatureProperty=function(e,s,u,d={}){this.get(e).setProperty(s,u),this.featureChanged(e,{silent:d.silent,action:Mb.CHANGE_PROPERTIES})};function N3(e,s={}){const u=e._selectedCoordinates.filter(d=>e._selectedFeatureIds.has(d.feature_id));e._selectedCoordinates.length!==u.length&&!s.silent&&(e._emitSelectionChange=!0),e._selectedCoordinates=u}eo.prototype.storeMapConfig=function(){L3.forEach(e=>{this.ctx.map[e]&&(this._mapInitialConfig[e]=this.ctx.map[e].isEnabled())})};eo.prototype.restoreMapConfig=function(){Object.keys(this._mapInitialConfig).forEach(e=>{this._mapInitialConfig[e]?this.ctx.map[e].enable():this.ctx.map[e].disable()})};eo.prototype.getInitialConfigValue=function(e){return this._mapInitialConfig[e]!==void 0?this._mapInitialConfig[e]:!0};const T7=["mode","feature","mouse"];function C7(e){const s={};let u=null,d={mode:null,feature:null,mouse:null},b={mode:null,feature:null,mouse:null};function E(){T({mode:null,feature:null,mouse:null}),t()}function T(Q){b=Object.assign(b,Q)}function t(){if(!e.container)return;const Q=[],ce=[];T7.forEach(ie=>{b[ie]!==d[ie]&&(Q.push(`${ie}-${d[ie]}`),b[ie]!==null&&ce.push(`${ie}-${b[ie]}`))}),Q.length>0&&e.container.classList.remove(...Q),ce.length>0&&e.container.classList.add(...ce),d=Object.assign(d,b)}function G(Q,ce={}){const ie=document.createElement("button");return ie.className=`${dh.CONTROL_BUTTON} ${ce.className}`,ie.setAttribute("title",ce.title),ce.container.appendChild(ie),ie.addEventListener("click",pe=>{if(pe.preventDefault(),pe.stopPropagation(),pe.target===u){W(),ce.onDeactivate();return}Y(Q),ce.onActivate()},!0),ie}function W(){u&&(u.classList.remove(dh.ACTIVE_BUTTON),u=null)}function Y(Q){W();const ce=s[Q];ce&&ce&&Q!=="trash"&&(ce.classList.add(dh.ACTIVE_BUTTON),u=ce)}function ne(){const Q=e.options.controls,ce=document.createElement("div");return ce.className=`${dh.CONTROL_GROUP} ${dh.CONTROL_BASE}`,Q&&(Q[ph.LINE]&&(s[ph.LINE]=G(ph.LINE,{container:ce,className:dh.CONTROL_BUTTON_LINE,title:`LineString tool ${e.options.keybindings?"(l)":""}`,onActivate:()=>e.events.changeMode(Va.DRAW_LINE_STRING),onDeactivate:()=>e.events.trash()})),Q[ph.POLYGON]&&(s[ph.POLYGON]=G(ph.POLYGON,{container:ce,className:dh.CONTROL_BUTTON_POLYGON,title:`Polygon tool ${e.options.keybindings?"(p)":""}`,onActivate:()=>e.events.changeMode(Va.DRAW_POLYGON),onDeactivate:()=>e.events.trash()})),Q[ph.POINT]&&(s[ph.POINT]=G(ph.POINT,{container:ce,className:dh.CONTROL_BUTTON_POINT,title:`Marker tool ${e.options.keybindings?"(m)":""}`,onActivate:()=>e.events.changeMode(Va.DRAW_POINT),onDeactivate:()=>e.events.trash()})),Q.trash&&(s.trash=G("trash",{container:ce,className:dh.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:()=>{e.events.trash()}})),Q.combine_features&&(s.combine_features=G("combineFeatures",{container:ce,className:dh.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:()=>{e.events.combineFeatures()}})),Q.uncombine_features&&(s.uncombine_features=G("uncombineFeatures",{container:ce,className:dh.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:()=>{e.events.uncombineFeatures()}}))),ce}function J(){Object.keys(s).forEach(Q=>{const ce=s[Q];ce.parentNode&&ce.parentNode.removeChild(ce),delete s[Q]})}return{setActiveButton:Y,queueMapClasses:T,updateMapClasses:t,clearMapClasses:E,addButtons:ne,removeButtons:J}}function E7(e){let s=null,u=null;const d={onRemove(){return e.map.off("load",d.connect),clearInterval(u),d.removeLayers(),e.store.restoreMapConfig(),e.ui.removeButtons(),e.events.removeEventListeners(),e.ui.clearMapClasses(),e.boxZoomInitial&&e.map.boxZoom.enable(),e.map=null,e.container=null,e.store=null,s&&s.parentNode&&s.parentNode.removeChild(s),s=null,this},connect(){e.map.off("load",d.connect),clearInterval(u),d.addLayers(),e.store.storeMapConfig(),e.events.addEventListeners()},onAdd(b){if(e.map=b,e.events=w7(e),e.ui=C7(e),e.container=b.getContainer(),e.store=new eo(e),s=e.ui.addButtons(),e.options.boxSelect){e.boxZoomInitial=b.boxZoom.isEnabled(),b.boxZoom.disable();const E=b.dragPan.isEnabled();b.dragPan.disable(),b.dragPan.enable(),E||b.dragPan.disable()}return b.loaded()?d.connect():(b.on("load",d.connect),u=setInterval(()=>{b.loaded()&&d.connect()},16)),e.events.start(),s},addLayers(){e.map.addSource(zd.COLD,{data:{type:Vr.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.map.addSource(zd.HOT,{data:{type:Vr.FEATURE_COLLECTION,features:[]},type:"geojson"}),e.options.styles.forEach(b=>{e.map.addLayer(b)}),e.store.setDirty(!0),e.store.render()},removeLayers(){e.options.styles.forEach(b=>{e.map.getLayer(b.id)&&e.map.removeLayer(b.id)}),e.map.getSource(zd.COLD)&&e.map.removeSource(zd.COLD),e.map.getSource(zd.HOT)&&e.map.removeSource(zd.HOT)}};return e.setup=d,d}const N2="#3bb2d0",Ix="#fbb03b",vk="#fff",j3=[{id:"gl-draw-polygon-fill",type:"fill",filter:["all",["==","$type","Polygon"]],paint:{"fill-color":["case",["==",["get","active"],"true"],Ix,N2],"fill-opacity":.1}},{id:"gl-draw-lines",type:"line",filter:["any",["==","$type","LineString"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["case",["==",["get","active"],"true"],Ix,N2],"line-dasharray":["case",["==",["get","active"],"true"],[.2,2],[2,0]],"line-width":2}},{id:"gl-draw-point-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":vk}},{id:"gl-draw-point-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","feature"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":["case",["==",["get","active"],"true"],Ix,N2]}},{id:"gl-draw-vertex-outer",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],7,5],"circle-color":vk}},{id:"gl-draw-vertex-inner",type:"circle",filter:["all",["==","$type","Point"],["==","meta","vertex"],["!=","mode","simple_select"]],paint:{"circle-radius":["case",["==",["get","active"],"true"],5,3],"circle-color":Ix}},{id:"gl-draw-midpoint",type:"circle",filter:["all",["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":Ix}}];function Ew(e){return function(s){const u=s.featureTarget;return!u||!u.properties?!1:u.properties.meta===e}}function U3(e){return!e.originalEvent||!e.originalEvent.shiftKey?!1:e.originalEvent.button===0}function ay(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.active===cc.ACTIVE&&e.featureTarget.properties.meta===tu.FEATURE}function mE(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.active===cc.INACTIVE&&e.featureTarget.properties.meta===tu.FEATURE}function Mw(e){return e.featureTarget===void 0}function gE(e){return!e.featureTarget||!e.featureTarget.properties?!1:e.featureTarget.properties.meta===tu.FEATURE}function Pb(e){const s=e.featureTarget;return!s||!s.properties?!1:s.properties.meta===tu.VERTEX}function k1(e){return e.originalEvent?e.originalEvent.shiftKey===!0:!1}function Iw(e){return e.keyCode===27}function Pw(e){return e.keyCode===13}function M7(){return!0}const I7=Object.freeze(Object.defineProperty({__proto__:null,isActiveFeature:ay,isEnterKey:Pw,isEscapeKey:Iw,isFeature:gE,isInactiveFeature:mE,isOfMetaType:Ew,isShiftDown:k1,isShiftMousedown:U3,isTrue:M7,isVertex:Pb,noTarget:Mw},Symbol.toStringTag,{value:"Module"}));function Pg(e,s){this.x=e,this.y=s}Pg.prototype={clone(){return new Pg(this.x,this.y)},add(e){return this.clone()._add(e)},sub(e){return this.clone()._sub(e)},multByPoint(e){return this.clone()._multByPoint(e)},divByPoint(e){return this.clone()._divByPoint(e)},mult(e){return this.clone()._mult(e)},div(e){return this.clone()._div(e)},rotate(e){return this.clone()._rotate(e)},rotateAround(e,s){return this.clone()._rotateAround(e,s)},matMult(e){return this.clone()._matMult(e)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(e){return this.x===e.x&&this.y===e.y},dist(e){return Math.sqrt(this.distSqr(e))},distSqr(e){const s=e.x-this.x,u=e.y-this.y;return s*s+u*u},angle(){return Math.atan2(this.y,this.x)},angleTo(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith(e){return this.angleWithSep(e.x,e.y)},angleWithSep(e,s){return Math.atan2(this.x*s-this.y*e,this.x*e+this.y*s)},_matMult(e){const s=e[0]*this.x+e[1]*this.y,u=e[2]*this.x+e[3]*this.y;return this.x=s,this.y=u,this},_add(e){return this.x+=e.x,this.y+=e.y,this},_sub(e){return this.x-=e.x,this.y-=e.y,this},_mult(e){return this.x*=e,this.y*=e,this},_div(e){return this.x/=e,this.y/=e,this},_multByPoint(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint(e){return this.x/=e.x,this.y/=e.y,this},_unit(){return this._div(this.mag()),this},_perp(){const e=this.y;return this.y=this.x,this.x=-e,this},_rotate(e){const s=Math.cos(e),u=Math.sin(e),d=s*this.x-u*this.y,b=u*this.x+s*this.y;return this.x=d,this.y=b,this},_rotateAround(e,s){const u=Math.cos(e),d=Math.sin(e),b=s.x+u*(this.x-s.x)-d*(this.y-s.y),E=s.y+d*(this.x-s.x)+u*(this.y-s.y);return this.x=b,this.y=E,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Pg};Pg.convert=function(e){if(e instanceof Pg)return e;if(Array.isArray(e))return new Pg(+e[0],+e[1]);if(e.x!==void 0&&e.y!==void 0)return new Pg(+e.x,+e.y);throw new Error("Expected [x, y] or {x, y} point format")};function _E(e,s){const u=s.getBoundingClientRect();return new Pg(e.clientX-u.left-(s.clientLeft||0),e.clientY-u.top-(s.clientTop||0))}function fv(e,s,u,d){return{type:Vr.FEATURE,properties:{meta:tu.VERTEX,parent:e,coord_path:u,active:d?cc.ACTIVE:cc.INACTIVE},geometry:{type:Vr.POINT,coordinates:s}}}function $3(e,s,u){const d=s.geometry.coordinates,b=u.geometry.coordinates;if(d[1]>jT||d[1]<NT||b[1]>jT||b[1]<NT)return null;const E={lng:(d[0]+b[0])/2,lat:(d[1]+b[1])/2};return{type:Vr.FEATURE,properties:{meta:tu.MIDPOINT,parent:e,lng:E.lng,lat:E.lat,coord_path:u.properties.coord_path},geometry:{type:Vr.POINT,coordinates:[E.lng,E.lat]}}}function Aw(e,s={},u=null){const{type:d,coordinates:b}=e.geometry,E=e.properties&&e.properties.id;let T=[];d===Vr.POINT?T.push(fv(E,b,u,G(u))):d===Vr.POLYGON?b.forEach((Y,ne)=>{t(Y,u!==null?`${u}.${ne}`:String(ne))}):d===Vr.LINE_STRING?t(b,u):d.indexOf(Vr.MULTI_PREFIX)===0&&W();function t(Y,ne){let J="",Q=null;Y.forEach((ce,ie)=>{const pe=ne!=null?`${ne}.${ie}`:String(ie),be=fv(E,ce,pe,G(pe));if(s.midpoints&&Q){const $e=$3(E,Q,be);$e&&T.push($e)}Q=be;const Ie=JSON.stringify(ce);J!==Ie&&T.push(be),ie===0&&(J=Ie)})}function G(Y){return s.selectedPaths?s.selectedPaths.indexOf(Y)!==-1:!1}function W(){const Y=d.replace(Vr.MULTI_PREFIX,"");b.forEach((ne,J)=>{const Q={type:Vr.FEATURE,properties:e.properties,geometry:{type:Y,coordinates:ne}};T=T.concat(Aw(Q,s,J))})}return T}const Bf={enable(e){setTimeout(()=>{!e.map||!e.map.doubleClickZoom||!e._ctx||!e._ctx.store||!e._ctx.store.getInitialConfigValue||e._ctx.store.getInitialConfigValue("doubleClickZoom")&&e.map.doubleClickZoom.enable()},0)},disable(e){setTimeout(()=>{!e.map||!e.map.doubleClickZoom||e.map.doubleClickZoom.disable()},0)}},{LAT_MIN:Q0,LAT_MAX:e1,LAT_RENDERED_MIN:xk,LAT_RENDERED_MAX:bk,LNG_MIN:wk,LNG_MAX:Sk}=z3;function P7(e){const s={Point:0,LineString:1,Polygon:2,MultiPoint:1,MultiLineString:2,MultiPolygon:3}[e.geometry.type],u=[e.geometry.coordinates].flat(s),d=u.map(t=>t[0]),b=u.map(t=>t[1]),E=t=>Math.min.apply(null,t),T=t=>Math.max.apply(null,t);return[E(d),E(b),T(d),T(b)]}function yE(e,s){let u=Q0,d=e1,b=Q0,E=e1,T=Sk,t=wk;e.forEach(W=>{const Y=P7(W),ne=Y[1],J=Y[3],Q=Y[0],ce=Y[2];ne>u&&(u=ne),J<d&&(d=J),J>b&&(b=J),ne<E&&(E=ne),Q<T&&(T=Q),ce>t&&(t=ce)});const G=s;return u+G.lat>bk&&(G.lat=bk-u),b+G.lat>e1&&(G.lat=e1-b),d+G.lat<xk&&(G.lat=xk-d),E+G.lat<Q0&&(G.lat=Q0-E),T+G.lng<=wk&&(G.lng+=Math.ceil(Math.abs(G.lng)/360)*360),t+G.lng>=Sk&&(G.lng-=Math.ceil(Math.abs(G.lng)/360)*360),G}function vE(e,s){const u=yE(e.map(d=>d.toGeoJSON()),s);e.forEach(d=>{const b=d.getCoordinates(),E=W=>{const Y={lng:W[0]+u.lng,lat:W[1]+u.lat};return[Y.lng,Y.lat]},T=W=>W.map(Y=>E(Y)),t=W=>W.map(Y=>T(Y));let G;d.type===Vr.POINT?G=E(b):d.type===Vr.LINE_STRING||d.type===Vr.MULTI_POINT?G=b.map(E):d.type===Vr.POLYGON||d.type===Vr.MULTI_LINE_STRING?G=b.map(T):d.type===Vr.MULTI_POLYGON&&(G=b.map(t)),d.incomingCoords(G)})}const qs={};qs.onSetup=function(e){const s={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initialDragPanState:this.map.dragPan.isEnabled(),initiallySelectedFeatureIds:e.featureIds||[]};return this.setSelected(s.initiallySelectedFeatureIds.filter(u=>this.getFeature(u)!==void 0)),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),s};qs.fireUpdate=function(){this.fire(Lu.UPDATE,{action:Mb.MOVE,features:this.getSelected().map(e=>e.toGeoJSON())})};qs.fireActionable=function(){const e=this.getSelected(),s=e.filter(E=>this.isInstanceOf("MultiFeature",E));let u=!1;if(e.length>1){u=!0;const E=e[0].type.replace("Multi","");e.forEach(T=>{T.type.replace("Multi","")!==E&&(u=!1)})}const d=s.length>0,b=e.length>0;this.setActionableState({combineFeatures:u,uncombineFeatures:d,trash:b})};qs.getUniqueIds=function(e){return e.length?e.map(u=>u.properties.id).filter(u=>u!==void 0).reduce((u,d)=>(u.add(d),u),new Bd).values():[]};qs.stopExtendedInteractions=function(e){e.boxSelectElement&&(e.boxSelectElement.parentNode&&e.boxSelectElement.parentNode.removeChild(e.boxSelectElement),e.boxSelectElement=null),(e.canDragMove||e.canBoxSelect)&&e.initialDragPanState===!0&&this.map.dragPan.enable(),e.boxSelecting=!1,e.canBoxSelect=!1,e.dragMoving=!1,e.canDragMove=!1};qs.onStop=function(){Bf.enable(this)};qs.onMouseMove=function(e,s){return gE(s)&&e.dragMoving&&this.fireUpdate(),this.stopExtendedInteractions(e),!0};qs.onMouseOut=function(e){return e.dragMoving?this.fireUpdate():!0};qs.onTap=qs.onClick=function(e,s){if(Mw(s))return this.clickAnywhere(e,s);if(Ew(tu.VERTEX)(s))return this.clickOnVertex(e,s);if(gE(s))return this.clickOnFeature(e,s)};qs.clickAnywhere=function(e){const s=this.getSelectedIds();s.length&&(this.clearSelectedFeatures(),s.forEach(u=>this.doRender(u))),Bf.enable(this),this.stopExtendedInteractions(e)};qs.clickOnVertex=function(e,s){this.changeMode(Va.DIRECT_SELECT,{featureId:s.featureTarget.properties.parent,coordPath:s.featureTarget.properties.coord_path,startPos:s.lngLat}),this.updateUIClasses({mouse:Eo.MOVE})};qs.startOnActiveFeature=function(e,s){this.stopExtendedInteractions(e),this.map.dragPan.disable(),this.doRender(s.featureTarget.properties.id),e.canDragMove=!0,e.dragMoveLocation=s.lngLat};qs.clickOnFeature=function(e,s){Bf.disable(this),this.stopExtendedInteractions(e);const u=k1(s),d=this.getSelectedIds(),b=s.featureTarget.properties.id,E=this.isSelected(b);if(!u&&E&&this.getFeature(b).type!==Vr.POINT)return this.changeMode(Va.DIRECT_SELECT,{featureId:b});E&&u?(this.deselect(b),this.updateUIClasses({mouse:Eo.POINTER}),d.length===1&&Bf.enable(this)):!E&&u?(this.select(b),this.updateUIClasses({mouse:Eo.MOVE})):!E&&!u&&(d.forEach(T=>this.doRender(T)),this.setSelected(b),this.updateUIClasses({mouse:Eo.MOVE})),this.doRender(b)};qs.onMouseDown=function(e,s){if(e.initialDragPanState=this.map.dragPan.isEnabled(),ay(s))return this.startOnActiveFeature(e,s);if(this.drawConfig.boxSelect&&U3(s))return this.startBoxSelect(e,s)};qs.startBoxSelect=function(e,s){this.stopExtendedInteractions(e),this.map.dragPan.disable(),e.boxSelectStartLocation=_E(s.originalEvent,this.map.getContainer()),e.canBoxSelect=!0};qs.onTouchStart=function(e,s){if(ay(s))return this.startOnActiveFeature(e,s)};qs.onDrag=function(e,s){if(e.canDragMove)return this.dragMove(e,s);if(this.drawConfig.boxSelect&&e.canBoxSelect)return this.whileBoxSelect(e,s)};qs.whileBoxSelect=function(e,s){e.boxSelecting=!0,this.updateUIClasses({mouse:Eo.ADD}),e.boxSelectElement||(e.boxSelectElement=document.createElement("div"),e.boxSelectElement.classList.add(dh.BOX_SELECT),this.map.getContainer().appendChild(e.boxSelectElement));const u=_E(s.originalEvent,this.map.getContainer()),d=Math.min(e.boxSelectStartLocation.x,u.x),b=Math.max(e.boxSelectStartLocation.x,u.x),E=Math.min(e.boxSelectStartLocation.y,u.y),T=Math.max(e.boxSelectStartLocation.y,u.y),t=`translate(${d}px, ${E}px)`;e.boxSelectElement.style.transform=t,e.boxSelectElement.style.WebkitTransform=t,e.boxSelectElement.style.width=`${b-d}px`,e.boxSelectElement.style.height=`${T-E}px`};qs.dragMove=function(e,s){e.dragMoving=!0,s.originalEvent.stopPropagation();const u={lng:s.lngLat.lng-e.dragMoveLocation.lng,lat:s.lngLat.lat-e.dragMoveLocation.lat};vE(this.getSelected(),u),e.dragMoveLocation=s.lngLat};qs.onTouchEnd=qs.onMouseUp=function(e,s){if(e.dragMoving)this.fireUpdate();else if(e.boxSelecting){const u=[e.boxSelectStartLocation,_E(s.originalEvent,this.map.getContainer())],d=this.featuresAt(null,u,"click"),b=this.getUniqueIds(d).filter(E=>!this.isSelected(E));b.length&&(this.select(b),b.forEach(E=>this.doRender(E)),this.updateUIClasses({mouse:Eo.MOVE}))}this.stopExtendedInteractions(e)};qs.toDisplayFeatures=function(e,s,u){s.properties.active=this.isSelected(s.properties.id)?cc.ACTIVE:cc.INACTIVE,u(s),this.fireActionable(),!(s.properties.active!==cc.ACTIVE||s.geometry.type===Vr.POINT)&&Aw(s).forEach(u)};qs.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()};qs.onCombineFeatures=function(){const e=this.getSelected();if(e.length===0||e.length<2)return;const s=[],u=[],d=e[0].type.replace("Multi","");for(let b=0;b<e.length;b++){const E=e[b];if(E.type.replace("Multi","")!==d)return;E.type.includes("Multi")?E.getCoordinates().forEach(T=>{s.push(T)}):s.push(E.getCoordinates()),u.push(E.toGeoJSON())}if(u.length>1){const b=this.newFeature({type:Vr.FEATURE,properties:u[0].properties,geometry:{type:`Multi${d}`,coordinates:s}});this.addFeature(b),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([b.id]),this.fire(Lu.COMBINE_FEATURES,{createdFeatures:[b.toGeoJSON()],deletedFeatures:u})}this.fireActionable()};qs.onUncombineFeatures=function(){const e=this.getSelected();if(e.length===0)return;const s=[],u=[];for(let d=0;d<e.length;d++){const b=e[d];this.isInstanceOf("MultiFeature",b)&&(b.getFeatures().forEach(E=>{this.addFeature(E),E.properties=b.properties,s.push(E.toGeoJSON()),this.select([E.id])}),this.deleteFeature(b.id,{silent:!0}),u.push(b.toGeoJSON()))}s.length>1&&this.fire(Lu.UNCOMBINE_FEATURES,{createdFeatures:s,deletedFeatures:u}),this.fireActionable()};const G3=Ew(tu.VERTEX),q3=Ew(tu.MIDPOINT),Hs={};Hs.fireUpdate=function(){this.fire(Lu.UPDATE,{action:Mb.CHANGE_COORDINATES,features:this.getSelected().map(e=>e.toGeoJSON())})};Hs.fireActionable=function(e){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:e.selectedCoordPaths.length>0})};Hs.startDragging=function(e,s){e.initialDragPanState=this.map.dragPan.isEnabled(),this.map.dragPan.disable(),e.canDragMove=!0,e.dragMoveLocation=s.lngLat};Hs.stopDragging=function(e){e.canDragMove&&e.initialDragPanState===!0&&this.map.dragPan.enable(),e.dragMoving=!1,e.canDragMove=!1,e.dragMoveLocation=null};Hs.onVertex=function(e,s){this.startDragging(e,s);const u=s.featureTarget.properties,d=e.selectedCoordPaths.indexOf(u.coord_path);!k1(s)&&d===-1?e.selectedCoordPaths=[u.coord_path]:k1(s)&&d===-1&&e.selectedCoordPaths.push(u.coord_path);const b=this.pathsToCoordinates(e.featureId,e.selectedCoordPaths);this.setSelectedCoordinates(b)};Hs.onMidpoint=function(e,s){this.startDragging(e,s);const u=s.featureTarget.properties;e.feature.addCoordinate(u.coord_path,u.lng,u.lat),this.fireUpdate(),e.selectedCoordPaths=[u.coord_path]};Hs.pathsToCoordinates=function(e,s){return s.map(u=>({feature_id:e,coord_path:u}))};Hs.onFeature=function(e,s){e.selectedCoordPaths.length===0?this.startDragging(e,s):this.stopDragging(e)};Hs.dragFeature=function(e,s,u){vE(this.getSelected(),u),e.dragMoveLocation=s.lngLat};Hs.dragVertex=function(e,s,u){const d=e.selectedCoordPaths.map(T=>e.feature.getCoordinate(T)),b=d.map(T=>({type:Vr.FEATURE,properties:{},geometry:{type:Vr.POINT,coordinates:T}})),E=yE(b,u);for(let T=0;T<d.length;T++){const t=d[T];e.feature.updateCoordinate(e.selectedCoordPaths[T],t[0]+E.lng,t[1]+E.lat)}};Hs.clickNoTarget=function(){this.changeMode(Va.SIMPLE_SELECT)};Hs.clickInactive=function(){this.changeMode(Va.SIMPLE_SELECT)};Hs.clickActiveFeature=function(e){e.selectedCoordPaths=[],this.clearSelectedCoordinates(),e.feature.changed()};Hs.onSetup=function(e){const s=e.featureId,u=this.getFeature(s);if(!u)throw new Error("You must provide a featureId to enter direct_select mode");if(u.type===Vr.POINT)throw new TypeError("direct_select mode doesn't handle point features");const d={featureId:s,feature:u,dragMoveLocation:e.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:e.coordPath?[e.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(s,d.selectedCoordPaths)),this.setSelected(s),Bf.disable(this),this.setActionableState({trash:!0}),d};Hs.onStop=function(){Bf.enable(this),this.clearSelectedCoordinates()};Hs.toDisplayFeatures=function(e,s,u){e.featureId===s.properties.id?(s.properties.active=cc.ACTIVE,u(s),Aw(s,{map:this.map,midpoints:!0,selectedPaths:e.selectedCoordPaths}).forEach(u)):(s.properties.active=cc.INACTIVE,u(s)),this.fireActionable(e)};Hs.onTrash=function(e){e.selectedCoordPaths.sort((s,u)=>u.localeCompare(s,"en",{numeric:!0})).forEach(s=>e.feature.removeCoordinate(s)),this.fireUpdate(),e.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(e),e.feature.isValid()===!1&&(this.deleteFeature([e.featureId]),this.changeMode(Va.SIMPLE_SELECT,{}))};Hs.onMouseMove=function(e,s){const u=ay(s),d=G3(s),b=q3(s),E=e.selectedCoordPaths.length===0;return u&&E?this.updateUIClasses({mouse:Eo.MOVE}):d&&!E?this.updateUIClasses({mouse:Eo.MOVE}):this.updateUIClasses({mouse:Eo.NONE}),(d||u||b)&&e.dragMoving&&this.fireUpdate(),this.stopDragging(e),!0};Hs.onMouseOut=function(e){return e.dragMoving&&this.fireUpdate(),!0};Hs.onTouchStart=Hs.onMouseDown=function(e,s){if(G3(s))return this.onVertex(e,s);if(ay(s))return this.onFeature(e,s);if(q3(s))return this.onMidpoint(e,s)};Hs.onDrag=function(e,s){if(e.canDragMove!==!0)return;e.dragMoving=!0,s.originalEvent.stopPropagation();const u={lng:s.lngLat.lng-e.dragMoveLocation.lng,lat:s.lngLat.lat-e.dragMoveLocation.lat};e.selectedCoordPaths.length>0?this.dragVertex(e,s,u):this.dragFeature(e,s,u),e.dragMoveLocation=s.lngLat};Hs.onClick=function(e,s){if(Mw(s))return this.clickNoTarget(e,s);if(ay(s))return this.clickActiveFeature(e,s);if(mE(s))return this.clickInactive(e,s);this.stopDragging(e)};Hs.onTap=function(e,s){if(Mw(s))return this.clickNoTarget(e,s);if(ay(s))return this.clickActiveFeature(e,s);if(mE(s))return this.clickInactive(e,s)};Hs.onTouchEnd=Hs.onMouseUp=function(e){e.dragMoving&&this.fireUpdate(),this.stopDragging(e)};const Up={};Up.onSetup=function(){const e=this.newFeature({type:Vr.FEATURE,properties:{},geometry:{type:Vr.POINT,coordinates:[]}});return this.addFeature(e),this.clearSelectedFeatures(),this.updateUIClasses({mouse:Eo.ADD}),this.activateUIButton(ph.POINT),this.setActionableState({trash:!0}),{point:e}};Up.stopDrawingAndRemove=function(e){this.deleteFeature([e.point.id],{silent:!0}),this.changeMode(Va.SIMPLE_SELECT)};Up.onTap=Up.onClick=function(e,s){this.updateUIClasses({mouse:Eo.MOVE}),e.point.updateCoordinate("",s.lngLat.lng,s.lngLat.lat),this.fire(Lu.CREATE,{features:[e.point.toGeoJSON()]}),this.changeMode(Va.SIMPLE_SELECT,{featureIds:[e.point.id]})};Up.onStop=function(e){this.activateUIButton(),e.point.getCoordinate().length||this.deleteFeature([e.point.id],{silent:!0})};Up.toDisplayFeatures=function(e,s,u){const d=s.properties.id===e.point.id;if(s.properties.active=d?cc.ACTIVE:cc.INACTIVE,!d)return u(s)};Up.onTrash=Up.stopDrawingAndRemove;Up.onKeyUp=function(e,s){if(Iw(s)||Pw(s))return this.stopDrawingAndRemove(e,s)};function D1(e,s){return e.lngLat?e.lngLat.lng===s[0]&&e.lngLat.lat===s[1]:!1}const Vf={};Vf.onSetup=function(){const e=this.newFeature({type:Vr.FEATURE,properties:{},geometry:{type:Vr.POLYGON,coordinates:[[]]}});return this.addFeature(e),this.clearSelectedFeatures(),Bf.disable(this),this.updateUIClasses({mouse:Eo.ADD}),this.activateUIButton(ph.POLYGON),this.setActionableState({trash:!0}),{polygon:e,currentVertexPosition:0}};Vf.clickAnywhere=function(e,s){if(e.currentVertexPosition>0&&D1(s,e.polygon.coordinates[0][e.currentVertexPosition-1]))return this.changeMode(Va.SIMPLE_SELECT,{featureIds:[e.polygon.id]});this.updateUIClasses({mouse:Eo.ADD}),e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,s.lngLat.lng,s.lngLat.lat),e.currentVertexPosition++,e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,s.lngLat.lng,s.lngLat.lat)};Vf.clickOnVertex=function(e){return this.changeMode(Va.SIMPLE_SELECT,{featureIds:[e.polygon.id]})};Vf.onMouseMove=function(e,s){e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,s.lngLat.lng,s.lngLat.lat),Pb(s)&&this.updateUIClasses({mouse:Eo.POINTER})};Vf.onTap=Vf.onClick=function(e,s){return Pb(s)?this.clickOnVertex(e,s):this.clickAnywhere(e,s)};Vf.onKeyUp=function(e,s){Iw(s)?(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(Va.SIMPLE_SELECT)):Pw(s)&&this.changeMode(Va.SIMPLE_SELECT,{featureIds:[e.polygon.id]})};Vf.onStop=function(e){this.updateUIClasses({mouse:Eo.NONE}),Bf.enable(this),this.activateUIButton(),this.getFeature(e.polygon.id)!==void 0&&(e.polygon.removeCoordinate(`0.${e.currentVertexPosition}`),e.polygon.isValid()?this.fire(Lu.CREATE,{features:[e.polygon.toGeoJSON()]}):(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(Va.SIMPLE_SELECT,{},{silent:!0})))};Vf.toDisplayFeatures=function(e,s,u){const d=s.properties.id===e.polygon.id;if(s.properties.active=d?cc.ACTIVE:cc.INACTIVE,!d)return u(s);if(s.geometry.coordinates.length===0)return;const b=s.geometry.coordinates[0].length;if(!(b<3)){if(s.properties.meta=tu.FEATURE,u(fv(e.polygon.id,s.geometry.coordinates[0][0],"0.0",!1)),b>3){const E=s.geometry.coordinates[0].length-3;u(fv(e.polygon.id,s.geometry.coordinates[0][E],`0.${E}`,!1))}if(b<=4){const E=[[s.geometry.coordinates[0][0][0],s.geometry.coordinates[0][0][1]],[s.geometry.coordinates[0][1][0],s.geometry.coordinates[0][1][1]]];if(u({type:Vr.FEATURE,properties:s.properties,geometry:{coordinates:E,type:Vr.LINE_STRING}}),b===3)return}return u(s)}};Vf.onTrash=function(e){this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(Va.SIMPLE_SELECT)};const Nf={};Nf.onSetup=function(e){e=e||{};const s=e.featureId;let u,d,b="forward";if(s){if(u=this.getFeature(s),!u)throw new Error("Could not find a feature with the provided featureId");let E=e.from;if(E&&E.type==="Feature"&&E.geometry&&E.geometry.type==="Point"&&(E=E.geometry),E&&E.type==="Point"&&E.coordinates&&E.coordinates.length===2&&(E=E.coordinates),!E||!Array.isArray(E))throw new Error("Please use the `from` property to indicate which point to continue the line from");const T=u.coordinates.length-1;if(u.coordinates[T][0]===E[0]&&u.coordinates[T][1]===E[1])d=T+1,u.addCoordinate(d,...u.coordinates[T]);else if(u.coordinates[0][0]===E[0]&&u.coordinates[0][1]===E[1])b="backwards",d=0,u.addCoordinate(d,...u.coordinates[0]);else throw new Error("`from` should match the point at either the start or the end of the provided LineString")}else u=this.newFeature({type:Vr.FEATURE,properties:{},geometry:{type:Vr.LINE_STRING,coordinates:[]}}),d=0,this.addFeature(u);return this.clearSelectedFeatures(),Bf.disable(this),this.updateUIClasses({mouse:Eo.ADD}),this.activateUIButton(ph.LINE),this.setActionableState({trash:!0}),{line:u,currentVertexPosition:d,direction:b}};Nf.clickAnywhere=function(e,s){if(e.currentVertexPosition>0&&D1(s,e.line.coordinates[e.currentVertexPosition-1])||e.direction==="backwards"&&D1(s,e.line.coordinates[e.currentVertexPosition+1]))return this.changeMode(Va.SIMPLE_SELECT,{featureIds:[e.line.id]});this.updateUIClasses({mouse:Eo.ADD}),e.line.updateCoordinate(e.currentVertexPosition,s.lngLat.lng,s.lngLat.lat),e.direction==="forward"?(e.currentVertexPosition++,e.line.updateCoordinate(e.currentVertexPosition,s.lngLat.lng,s.lngLat.lat)):e.line.addCoordinate(0,s.lngLat.lng,s.lngLat.lat)};Nf.clickOnVertex=function(e){return this.changeMode(Va.SIMPLE_SELECT,{featureIds:[e.line.id]})};Nf.onMouseMove=function(e,s){e.line.updateCoordinate(e.currentVertexPosition,s.lngLat.lng,s.lngLat.lat),Pb(s)&&this.updateUIClasses({mouse:Eo.POINTER})};Nf.onTap=Nf.onClick=function(e,s){if(Pb(s))return this.clickOnVertex(e,s);this.clickAnywhere(e,s)};Nf.onKeyUp=function(e,s){Pw(s)?this.changeMode(Va.SIMPLE_SELECT,{featureIds:[e.line.id]}):Iw(s)&&(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(Va.SIMPLE_SELECT))};Nf.onStop=function(e){Bf.enable(this),this.activateUIButton(),this.getFeature(e.line.id)!==void 0&&(e.line.removeCoordinate(`${e.currentVertexPosition}`),e.line.isValid()?this.fire(Lu.CREATE,{features:[e.line.toGeoJSON()]}):(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(Va.SIMPLE_SELECT,{},{silent:!0})))};Nf.onTrash=function(e){this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(Va.SIMPLE_SELECT)};Nf.toDisplayFeatures=function(e,s,u){const d=s.properties.id===e.line.id;if(s.properties.active=d?cc.ACTIVE:cc.INACTIVE,!d)return u(s);s.geometry.coordinates.length<2||(s.properties.meta=tu.FEATURE,u(fv(e.line.id,s.geometry.coordinates[e.direction==="forward"?s.geometry.coordinates.length-2:1],`${e.direction==="forward"?s.geometry.coordinates.length-2:1}`,!1)),u(s))};const H3={simple_select:qs,direct_select:Hs,draw_point:Up,draw_polygon:Vf,draw_line_string:Nf},A7={defaultMode:Va.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:j3,modes:H3,controls:{},userProperties:!1,suppressAPIEvents:!0},k7={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},D7={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function Tk(e,s){return e.map(u=>u.source?u:Object.assign({},u,{id:`${u.id}.${s}`,source:s==="hot"?zd.HOT:zd.COLD}))}function R7(e={}){let s=Object.assign({},e);return e.controls||(s.controls={}),e.displayControlsDefault===!1?s.controls=Object.assign({},D7,e.controls):s.controls=Object.assign({},k7,e.controls),s=Object.assign({},A7,s),s.styles=Tk(s.styles,"cold").concat(Tk(s.styles,"hot")),s}var j2,Ck;function L7(){if(Ck)return j2;Ck=1,j2=s;var e={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"};function s(u){if(!u||!u.type)return null;var d=e[u.type];if(!d)return null;if(d==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:u}]};if(d==="feature")return{type:"FeatureCollection",features:[u]};if(d==="featurecollection")return u}return j2}var z7=L7();const O7=Z_(z7);function Z3(e,s){return e.length!==s.length?!1:JSON.stringify(e.map(u=>u).sort())===JSON.stringify(s.map(u=>u).sort())}const F7={Polygon:Xh,LineString:Wp,Point:Vg,MultiPolygon:Ru,MultiLineString:Ru,MultiPoint:Ru};function B7(e,s){s.modes=Va;const u=e.options.suppressAPIEvents!==void 0?!!e.options.suppressAPIEvents:!0;return s.getFeatureIdsAt=function(d){return dv.click({point:d},null,e).map(E=>E.properties.id)},s.getSelectedIds=function(){return e.store.getSelectedIds()},s.getSelected=function(){return{type:Vr.FEATURE_COLLECTION,features:e.store.getSelectedIds().map(d=>e.store.get(d)).map(d=>d.toGeoJSON())}},s.getSelectedPoints=function(){return{type:Vr.FEATURE_COLLECTION,features:e.store.getSelectedCoordinates().map(d=>({type:Vr.FEATURE,properties:{},geometry:{type:Vr.POINT,coordinates:d.coordinates}}))}},s.set=function(d){if(d.type===void 0||d.type!==Vr.FEATURE_COLLECTION||!Array.isArray(d.features))throw new Error("Invalid FeatureCollection");const b=e.store.createRenderBatch();let E=e.store.getAllIds().slice();const T=s.add(d),t=new Bd(T);return E=E.filter(G=>!t.has(G)),E.length&&s.delete(E),b(),T},s.add=function(d){const E=JSON.parse(JSON.stringify(O7(d))).features.map(T=>{if(T.id=T.id||pE(),T.geometry===null)throw new Error("Invalid geometry: null");if(e.store.get(T.id)===void 0||e.store.get(T.id).type!==T.geometry.type){const t=F7[T.geometry.type];if(t===void 0)throw new Error(`Invalid geometry type: ${T.geometry.type}.`);const G=new t(e,T);e.store.add(G,{silent:u})}else{const t=e.store.get(T.id),G=t.properties;t.properties=T.properties,A1(G,T.properties)||e.store.featureChanged(t.id,{silent:u}),A1(t.getCoordinates(),T.geometry.coordinates)||t.incomingCoords(T.geometry.coordinates)}return T.id});return e.store.render(),E},s.get=function(d){const b=e.store.get(d);if(b)return b.toGeoJSON()},s.getAll=function(){return{type:Vr.FEATURE_COLLECTION,features:e.store.getAll().map(d=>d.toGeoJSON())}},s.delete=function(d){return e.store.delete(d,{silent:u}),s.getMode()===Va.DIRECT_SELECT&&!e.store.getSelectedIds().length?e.events.changeMode(Va.SIMPLE_SELECT,void 0,{silent:u}):e.store.render(),s},s.deleteAll=function(){return e.store.delete(e.store.getAllIds(),{silent:u}),s.getMode()===Va.DIRECT_SELECT?e.events.changeMode(Va.SIMPLE_SELECT,void 0,{silent:u}):e.store.render(),s},s.changeMode=function(d,b={}){return d===Va.SIMPLE_SELECT&&s.getMode()===Va.SIMPLE_SELECT?(Z3(b.featureIds||[],e.store.getSelectedIds())||(e.store.setSelected(b.featureIds,{silent:u}),e.store.render()),s):(d===Va.DIRECT_SELECT&&s.getMode()===Va.DIRECT_SELECT&&b.featureId===e.store.getSelectedIds()[0]||e.events.changeMode(d,b,{silent:u}),s)},s.getMode=function(){return e.events.getMode()},s.trash=function(){return e.events.trash({silent:u}),s},s.combineFeatures=function(){return e.events.combineFeatures({silent:u}),s},s.uncombineFeatures=function(){return e.events.uncombineFeatures({silent:u}),s},s.setFeatureProperty=function(d,b,E){return e.store.setFeatureProperty(d,b,E,{silent:u}),s},s}const V7=Object.freeze(Object.defineProperty({__proto__:null,CommonSelectors:I7,ModeHandler:VT,StringSet:Bd,constrainFeatureMovement:yE,createMidPoint:$3,createSupplementaryPoints:Aw,createVertex:fv,doubleClickZoom:Bf,euclideanDistance:fE,featuresAt:dv,getFeatureAtAndSetCursors:d1,isClick:UT,isEventAtCoordinates:D1,isTap:$T,mapEventToBoundingBox:F3,moveFeatures:vE,sortFeatures:O3,stringSetsAreEqual:Z3,theme:j3,toDenseArray:Ib},Symbol.toStringTag,{value:"Module"})),N7=function(e,s){e=R7(e);const u={options:e};s=B7(u,s),u.api=s;const d=E7(u);return s.onAdd=d.onAdd,s.onRemove=d.onRemove,s.types=ph,s.options=e,s};function kw(e){N7(e,this)}kw.modes=H3;kw.constants=z3;kw.lib=V7;function yr(e,s,u,d){function b(E){return E instanceof u?E:new u(function(T){T(E)})}return new(u||(u=Promise))(function(E,T){function t(Y){try{W(d.next(Y))}catch(ne){T(ne)}}function G(Y){try{W(d.throw(Y))}catch(ne){T(ne)}}function W(Y){Y.done?E(Y.value):b(Y.value).then(t,G)}W((d=d.apply(e,[])).next())})}const W3=e=>e&&e.outerHTML!=="<div></div>",cl=(e,s,u=[void 0])=>{const d={},b=s||Object.keys(e);for(const E of b)u.some(T=>T===e[E])||(d[E]=e[E]);return d},X3=(e,s)=>e.parent?e.parent.type?e.parent.type.name===s:e.parent.vnode.tag?e.parent.vnode.tag.endsWith(s):!1:!1,j7=(e,s)=>e.parent?e.parent.type?e.parent.type.name.includes(s):e.parent.vnode.tag?e.parent.vnode.tag.includes(s):!1:!1,xE=(e,s,u)=>{for(const d of u)e.on(d,b=>{s.emit(d,b)})};var U7=()=>navigator.userAgent.toLowerCase().includes("safari")&&!navigator.userAgent.toLocaleLowerCase().includes("chrome");const $7=(e,s,u,d)=>yr(void 0,void 0,void 0,function*(){const b=e?yield e.promise:null,E=q7(u),T=new SR(E);X3(d,"MapboxMap")&&b?b.addControl(T):(d.parent&&T.addTo(d.refs.geocoder),W3(d.refs["custom-input"])&&H7(d.refs["custom-input"],T,d)),s.resolve(T)}),G7=(e,s)=>yr(void 0,void 0,void 0,function*(){const u=yield e.promise;u.on("result",d=>{s.emit("result",d.result),s.proxy.geocoderState.result=d.result}),u.on("results",d=>{s.emit("results",d),s.proxy.geocoderState.results=d}),u.on("error",d=>{s.emit("error",d),s.proxy.geocoderState.error=d}),u.on("loading",d=>{s.emit("loading",d),s.proxy.geocoderState.loading=d}),u.on("clear",()=>{s.emit("clear")})}),q7=e=>{const s=cl(e);return s.accessToken=e.accessToken||kc.accessToken,s.mapboxgl=kc,s},H7=(e,s,u)=>{if(u&&u.proxy){u.proxy.showOriginalGeocoder&&(u.proxy.showOriginalGeocoder=!1);const d=e.getElementsByTagName("input");if(!d)throw new Error("MapboxGeocoderControl: No inputs found");const b=d[0];b.addEventListener("keyup",E=>{s.query(b.value),U7()&&(setTimeout(()=>{b.focus()},100),setTimeout(()=>{b.focus()},200))})}};var Y3=mo({name:"MapboxGeocoderControl",props:{accessToken:{type:String,default:""},origin:{type:String},zoom:{type:Number},flyTo:{type:[Boolean,Object],default:()=>{}},placeholder:{type:String},proximity:{type:Object},trackProximity:{type:Boolean,default:()=>{}},collapsed:{type:Boolean,default:()=>{}},clearAndBlurOnEsc:{type:Boolean,default:()=>{}},clearOnBlur:{type:Boolean,default:()=>{}},bbox:{type:Array},countries:{type:String},types:{type:String},minLength:{type:Number},limit:{type:Number},language:{type:String},filter:{type:Function},localGeocoder:{type:Function},externalGeocoder:{type:Function},reverseGeocode:{type:Boolean,default:()=>{}},enableEventLogging:{type:Boolean,default:()=>{}},marker:{type:Boolean,default:()=>{}},render:{type:Function},getItemValue:{type:Function},mode:{type:String},localGeocoderOnly:{type:Boolean,default:()=>{}}},setup(e){const s=vr("vmb_map",null),u=new ry,d=yi(!0),b=yi({result:{},results:{},error:null,loading:null});return Ua(()=>yr(this,void 0,void 0,function*(){const E=jf();E&&(yield $7(s,u,e,E)),E&&(yield G7(u,E))})),Tl(()=>yr(this,void 0,void 0,function*(){const E=yield u.promise;if(s){const T=yield s.promise;T._removed||T.removeControl(E)}})),Pi(e,()=>yr(this,void 0,void 0,function*(){})),{showOriginalGeocoder:d,geocoderState:b}}});const Z7={ref:"geocoder"},W7={ref:"custom-input"};function X7(e,s,u,d,b,E){return ja(),Gs("div",null,[Js(Ys("div",Z7,null,512),[[Nd,e.showOriginalGeocoder]]),Ys("div",W7,[Ac(e.$slots,"input",{result:e.geocoderState.result,results:e.geocoderState.results,error:e.geocoderState.error,loading:e.geocoderState.loading})],512)])}Y3.render=X7;var Od=(e,s,u)=>e&&e.value!==void 0?Pi(e,s,u):null;function Y7(e,s,u){if(window.ResizeObserver)J7(e,s);else{const d=Q7(e,u);Pi(d,()=>{s.resize()})}}function K7(e,s){s.value&&e.touchZoomRotate.enable(),Pi(s,u=>{u?e.touchZoomRotate.enable():e.touchZoomRotate.disable()})}function J7(e,s){if(!e.value)throw new Error("Could not enable auto-resize because root container could not be found");new window.ResizeObserver(()=>s.resize()).observe(e.value)}function Q7(e,s){const u=jf(),d=$l(new DOMRect(0,0,0,0).toJSON());if(u){let b=e.value?e.value.getBoundingClientRect():new DOMRect(0,0,0,0);addEventListener("resize",E=>{setTimeout(()=>{if(e.value){const T=e.value.getBoundingClientRect().toJSON(),t=b.width!==T.width||b.height!==T.height;b=T,t&&Object.assign(d,T)}},s||0)})}return d}const K3=e=>({height:e.height,width:e.width,"--zoom-logo":e.zoomLogo>=.8?e.zoomLogo:1}),e9=e=>e.includes("/")?e:`mapbox://styles/mapbox/${e}`,t9=(e,s)=>{const u=cl(e,["accessToken","antialias","attributionControl","bearing","bearingSnap","bounds","boxZoom","center","clickTolerance","collectResourceTiming","container","cooperativeGestures","crossSourceCollisions","customAttribution","doubleClickZoom","dragPan","dragRotate","fadeDuration","failIfMajorPerformanceCaveat","fitBoundsOptions","hash","interactive","keyboard","localIdeographFontFamily","logoPosition","maxBounds","maxPitch","maxTileCacheSize","maxZoom","minPitch","minZoom","pitch","pitchWithRotate","preserveDrawingBuffer","projection","refreshExpiredTiles","renderWorldCopies","scrollZoom","touchZoomRotate","trackResize","transformRequest","zoom"]);return u.style=e9(e.mapStyle),u.container=s,u},n9=(e,s,u,d)=>(()=>{const b=u.value,E=t9(e,b),T=new kc.Map(E);T.on("load",()=>{s.resolve(T)}),e.autoResize&&Y7(d,T,e.autoResizeDelay),e.touchZoomRotate&&K7(T,$n(e,"touchZoomRotate"))})(),i9=(e,s)=>{s.value=K3(e)};function r9(e,s,u){return yr(this,void 0,void 0,function*(){const{cooperativeGestures:d,width:b,height:E,bearing:T,maxBounds:t,maxPitch:G,minZoom:W,maxZoom:Y,minPitch:ne,pitch:J,projection:Q,renderWorldCopies:ce,zoom:ie,mapStyle:pe}=zg(s),{center:be,flyToOptions:Ie}=u;yield s9(e,b,E),yield o9(e,{bearing:T,maxBounds:t,maxPitch:G,minPitch:ne,pitch:J,renderWorldCopies:ce}),yield l9(e,{maxZoom:Y,center:be,flyToOptions:Ie,minZoom:W,zoom:ie}),yield a9(e,pe),yield c9(e,Q)})}function a9(e,s){return yr(this,void 0,void 0,function*(){const u=yield e.promise;Pi(s,d=>u.setStyle(d))})}function s9(e,s,u){return yr(this,void 0,void 0,function*(){const d=yield e.promise;Pi(s,()=>d.resize()),Pi(u,()=>d.resize())})}function o9(e,s){return yr(this,void 0,void 0,function*(){const u=yield e.promise;Od(s.bearing,d=>u.setBearing(d)),Od(s.maxBounds,d=>u.setMaxBounds(d)),Od(s.maxPitch,d=>u.setMaxPitch(d)),Od(s.minPitch,d=>u.setMinPitch(d)),Od(s.pitch,d=>u.setPitch(d)),Od(s.renderWorldCopies,d=>u.setRenderWorldCopies(d))})}function l9(e,s){Od(s.center,u=>Px(e,{center:u}),{deep:!0}),Od(s.flyToOptions,u=>Px(e,{flyToOptions:u}),{deep:!0}),Od(s.maxZoom,u=>Px(e,{maxZoom:u})),Od(s.minZoom,u=>Px(e,{minZoom:u})),Od(s.zoom,u=>Px(e,{zoom:u}))}function c9(e,s){return yr(this,void 0,void 0,function*(){const u=yield e.promise;Od(s,d=>u.setProjection(d))})}function Px(e,s){return yr(this,void 0,void 0,function*(){const u=yield e.promise,d=s.flyToOptions?cl(s.flyToOptions,["curve","maxDuration","minZoom","screenSpeed","speed"]):{};s.center&&(d.center=s.center),s.zoom&&(d.zoom=s.zoom),u.flyTo(d)})}const J3=["boxzoomstart","click","contextmenu","data","dataloading","dblclick","drag","dragend","dragstart","error","idle","load","mousedown","mouseenter","mouseleave","mousemouve","mouseout","mouseover","mouseup","move","moveend","movestart","pitch","pitchend","pitchstart","remove","resize","rotate","rotateend","rotatestart","sourcedata","sourcedataloading","styledata","styledataloading","styleimagemissing","touchcancel","touchend","touchstart","webglcontextlost","webglcontextrestored","wheel","zoom","zoomend","zoomstart"],u9=[...J3,"update:center","update:flyToOptions","update:zoom","update:pitch","update:bearing","loaded"],h9=(e,s)=>yr(void 0,void 0,void 0,function*(){const u=yield e.promise;xE(u,s,J3),s.emit("loaded",u),u.on("zoomend",d=>{s.emit("update:zoom",d.target.getZoom()),s.emit("update:center",d.target.getCenter().toArray())}),u.on("dragend",d=>{s.emit("update:center",d.target.getCenter().toArray())}),u.on("pitchend",d=>{s.emit("update:pitch",d.target.getPitch())}),u.on("rotateend",d=>{s.emit("update:bearing",d.target.getBearing())})}),d9=e=>{const s=["string","number","boolean"];let u=!1;return e===null&&(u=!0),s.some(d=>typeof e===d)&&(u=!0),u};function Ek(e,s="change",u="value"){const d=jf(),b=s instanceof Array?s:[s];if(!d)throw new Error("vmodel: Instance not found");const E=yi(d.props[u]||e);for(const T of b)Pi(E,t=>{d.emit(T,E.value)});return Pi(d.props,()=>{(d9(d.props[u])?d.props[u]!==E.value:!A1(d.props[u],E.value))&&(E.value=d.props[u])}),E}var bE=mo({name:"MapboxMap",emits:u9,props:{accessToken:{type:String,required:!0},height:{type:String,default:"100%"},width:{type:String,default:"100%"},container:{type:[Object,String],default:""},minZoom:{type:Number,default:0},maxZoom:{type:Number,default:22},minPitch:{type:Number,default:0},maxPitch:{type:Number,default:60},mapStyle:{type:[Object,String],default:"mapbox://styles/mapbox/streets-v11"},hash:{type:Boolean},interactive:{type:Boolean,default:!0},bearingSnap:{type:Number},pitchWithRotate:{type:Boolean,default:!0},clickTolerance:{type:Number},attributionControl:{type:Boolean,default:!0},customAttribution:{type:Array},logoPosition:{type:String,default:"bottom-left"},failIfMajorPerformanceCaveat:{type:Boolean},preserveDrawingBuffer:{type:Boolean},antialias:{type:Boolean},refreshExpiredTiles:{type:Boolean},maxBounds:{type:[Array,Object]},scrollZoom:{type:[Boolean,Object],default:!0},boxZoom:{type:Boolean},dragRotate:{type:Boolean,default:!0},dragPan:{type:[Object,Boolean],default:!0},keyboard:{type:Boolean},doubleClickZoom:{type:Boolean},touchZoomRotate:{type:[Boolean,Object],default:!0},trackResize:{type:Boolean,default:!0},center:{default:()=>[0,0]},zoom:{type:Number},bearing:{type:Number},pitch:{type:Number},bounds:{type:Array},fitBoundsOptions:{type:Object},renderWorldCopies:{type:Boolean,default:!0},maxTileCacheSize:{type:Number,default:null},localIdeographFontFamily:{type:String,default:"sans-serif"},transformRequest:{type:Function,default:null},collectResourceTiming:{type:Boolean,default:!1},fadeDuration:{type:Number,default:300},crossSourceCollisions:{type:Boolean,default:!0},zoomLogo:{type:Number,default:1},flyToOptions:{default:()=>({})},autoResize:{type:Boolean,default:!1},autoResizeDelay:{type:Number},cooperativeGestures:{type:Boolean,default:!1},projection:{type:String}},setup:e=>{const s=yi(null),u=yi(null),d=new Tw;xa("vmb_map",d);const b=Ek(e,"update:center","center"),E=Ek(e,"update:flyToOptions","flyToOptions"),T=yi(K3(e));return Pi(e,t=>yr(void 0,void 0,void 0,function*(){i9(t,T)})),r9(d,e,{center:b,flyToOptions:E}),Ua(()=>yr(void 0,void 0,void 0,function*(){const t=jf();kc.accessToken=e.accessToken,n9(e,d,u,s),t&&(yield h9(d,t))})),Tl(()=>yr(void 0,void 0,void 0,function*(){(yield d.promise).remove()})),{vmb_map:d,root:s,style:T,i_center:b,i_flyToOptions:E,mapContainer:u}}});const f9={key:1};function p9(e,s,u,d,b,E){return ja(),Gs("div",{style:Ky(e.style),ref:"root",class:"mapbox-map"},[Ys("div",null,[Ac(e.$slots,"default")]),e.vmb_map.isResolved?(ja(),Gs("div",{key:0,ref:"mapContainer",class:"map-container",style:Ky({height:e.height,width:e.width})},null,4)):(ja(),Gs("div",f9,[Ac(e.$slots,"loader",{},()=>[Ys("div",{style:Ky(e.style)},null,4)])]))],4)}function m9(e,s){s===void 0&&(s={});var u=s.insertAt;if(!(typeof document>"u")){var d=document.head||document.getElementsByTagName("head")[0],b=document.createElement("style");b.type="text/css",u==="top"&&d.firstChild?d.insertBefore(b,d.firstChild):d.appendChild(b),b.styleSheet?b.styleSheet.cssText=e:b.appendChild(document.createTextNode(e))}}var g9=`[data-v-55cc3ed8] .mapboxgl-ctrl-logo {
  zoom: var(--zoom-logo);
}`;m9(g9);bE.render=p9;bE.__scopeId="data-v-55cc3ed8";var _9={setup(){return{vmb_map:vr("vmb_map",null)}}};const y9=e=>X3(e,"MapboxMarker"),v9=e=>cl(e,["element","offset","anchor","color","draggable","clickTolerance","rotation","rotationAlignment","pitchAlignment","scale"]),Q3=["drag","dragend","dragstart"],x9=[...Q3,"update:lngLat","click"],b9=(e,s)=>{xE(e,s,Q3),e.on("dragend",u=>s.emit("update:lngLat",u.target._lngLat.toArray())),e.getElement().addEventListener("click",u=>s.emit("click",u))},w9=(e,s)=>yr(void 0,void 0,void 0,function*(){const u=yield s.promise,d=cl(e);typeof d.draggable=="boolean"&&u.setDraggable(d.draggable),d.lngLat&&u.setLngLat(d.lngLat),d.offset&&u.setOffset(d.offset),d.rotation&&u.setRotation(d.rotation),d.pitchAlignment&&u.setPitchAlignment(d.pitchAlignment),d.rotationAlignment&&u.setRotationAlignment(d.rotationAlignment)}),S9=(e,s,u,d,b,E)=>yr(void 0,void 0,void 0,function*(){const T=yield s.promise;E&&W3(E.value)&&(e.element=E.value);const t=new gC.Marker(e).setLngLat(b);t.addTo(T),u.resolve(t)});var eO=mo({name:"MapboxMarker",emits:x9,props:{lngLat:{default:()=>[0,0]},offset:{type:[Array],default:()=>[0,0]},anchor:{type:String,default:()=>"bottom"},color:{type:String,default:"#4668F2"},scale:{type:Number,default:1},draggable:{type:Boolean,default:!1},rotation:{type:Number,default:0},pitchAlignment:{type:String,default:"auto"},rotationAlignment:{type:String,default:"auto"}},setup(e){const{vmb_map:s}=_9.setup(),u=new ry,d=yi(null),b=v9(e);return xa("vmb_marker",u),Ua(()=>yr(this,void 0,void 0,function*(){const E=jf();if(E&&s){yield S9(b,s,u,E,e.lngLat,d);const T=yield u.promise;b9(T,E)}})),Tl(()=>yr(this,void 0,void 0,function*(){(yield u.promise).remove()})),Pi(e,E=>yr(this,void 0,void 0,function*(){yield w9(E,u)})),{icon:d}}});const T9={ref:"icon"},C9=["height","width"],E9={"fill-rule":"nonzero"},M9=jD('<g transform="translate(3.0, 29.0)" fill="#000000"><ellipse opacity="0.04" cx="10.5" cy="5.80029008" rx="10.5" ry="5.25002273"></ellipse><ellipse opacity="0.04" cx="10.5" cy="5.80029008" rx="10.5" ry="5.25002273"></ellipse><ellipse opacity="0.04" cx="10.5" cy="5.80029008" rx="9.5" ry="4.77275007"></ellipse><ellipse opacity="0.04" cx="10.5" cy="5.80029008" rx="8.5" ry="4.29549936"></ellipse><ellipse opacity="0.04" cx="10.5" cy="5.80029008" rx="7.5" ry="3.81822308"></ellipse><ellipse opacity="0.04" cx="10.5" cy="5.80029008" rx="6.5" ry="3.34094679"></ellipse><ellipse opacity="0.04" cx="10.5" cy="5.80029008" rx="5.5" ry="2.86367051"></ellipse><ellipse opacity="0.04" cx="10.5" cy="5.80029008" rx="4.5" ry="2.38636864"></ellipse></g>',1),I9=["fill"],P9=Ys("path",{d:"M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"},null,-1),A9=[P9],k9=jD('<g opacity="0.25" fill="#000000"><path d="M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"></path></g><g transform="translate(6.0, 7.0)" fill="#FFFFFF"></g><g transform="translate(8.0, 8.0)"><circle fill="#000000" opacity="0.25" cx="5.5" cy="5.5" r="5.4999962"></circle><circle fill="#FFFFFF" cx="5.5" cy="5.5" r="5.4999962"></circle></g>',3);function D9(e,s,u,d,b,E){return ja(),Gs("div",null,[Ys("div",T9,[Ac(e.$slots,"icon",{},()=>[(ja(),Gs("svg",{display:"block",height:42*e.scale+"px",width:27*e.scale+"px",viewBox:"0 0 27 41"},[Ys("g",E9,[M9,Ys("g",{fill:e.color},A9,8,I9),k9])],8,C9))])],512),Ac(e.$slots,"default")])}eO.render=D9;const R9=e=>{const{showCompass:s,showZoom:u,vizualizePitch:d}=e;return{showCompass:s,showZoom:u,vizualizePitch:d}},L9=(e,s,u)=>yr(void 0,void 0,void 0,function*(){(yield s.promise).addControl(e,u)});var tO=mo({name:"MapboxNavigationControl",props:{showCompass:{type:Boolean,default:!0},showZoom:{type:Boolean,default:!0},visualizePitch:{type:Boolean,default:!1},position:{type:String,default:()=>"top-right"}},setup(e){const s=vr("vmb_map",null),u=R9(e),d=new kc.NavigationControl(u),b=e.position;Ua(()=>{s&&L9(d,s,b)}),Tl(()=>yr(this,void 0,void 0,function*(){s&&(yield s.promise).removeControl(d)}))}});function z9(e,s,u,d,b,E){return ja(),Gs("div")}tO.render=z9;const O9=(e,s)=>{s.getLayer(e)&&s.removeLayer(e)},F9=(e,s)=>{s.getSource(e)&&s.removeSource(e)},B9=e=>j7(e,"MapboxGeogeometry"),Rx=e=>e/110.574,Lx=(e,s)=>e/(Math.cos(s*Math.PI/180)*111.32),Dw=(e,s)=>yr(void 0,void 0,void 0,function*(){const u=yield e.promise,d=s;O9(d.id,u),F9(d.id,u),u.addSource(d.id,d.getGeoJSON())}),Rw=(e,s,u)=>yr(void 0,void 0,void 0,function*(){const d=yield s.promise,b=u,E=cl(e),T=d.getSource(b.id);b.updateOptions(E),T.setData(b.getGeoJSON().data)}),V9=(e,s,u)=>yr(void 0,void 0,void 0,function*(){s&&(yield s.promise).setPopup(u)}),N9=(e,s,u)=>yr(void 0,void 0,void 0,function*(){const d=yield s.promise,b=yield e.promise;if(d.id){const E=yield d.geogeometry.promise;b.on("click",d.id,T=>{const t=E.center;u.setLngLat(t).addTo(b)})}}),nO=e=>cl(e,["closeButton","closeOnClick","closeOnMove","focusAfterOpen","anchor","offset","className","maxWidth"]),j9=(e,s,u,d,b,E)=>yr(void 0,void 0,void 0,function*(){const T=yield s.promise,t=u;E.value&&t.setDOMContent(E.value),y9(e)?yield V9(e,d,t):B9(e)&&b?yield N9(s,b,t):t.addTo(T)}),iO=["close","open"],U9=[...iO],$9=(e,s)=>{xE(e,s,iO)},G9=(e,s)=>yr(void 0,void 0,void 0,function*(){const u=nO(e);u.maxWidth&&s.setMaxWidth(u.maxWidth),u.offset&&s.setOffset(u.offset),e.lngLat&&s.setLngLat(e.lngLat)});var rO=mo({name:"MapboxPopup",emits:U9,props:{lngLat:{type:[Object,Array],default:()=>[0,0]},closeButton:{type:Boolean,default:!1},closeOnClick:{type:Boolean,default:!0},closeOnMove:{type:Boolean,default:!1},anchor:{type:String,default:void 0},offset:{type:[Number,Array],default:void 0},className:{type:String},focusAfterOpen:{type:Boolean,default:!0},maxWidth:{type:String,default:"500px"},renderless:{type:Boolean,default:!1}},setup(e){const s=yi(null),u=vr("vmb_map",null),d=vr("vmb_marker",null),b=vr("vmb_geogeometry_paint",null),E=nO(e),T=new kc.Popup(E).setLngLat(e.lngLat);return Ua(()=>yr(this,void 0,void 0,function*(){const t=jf();u&&t&&(yield j9(t,u,T,d,b,s),$9(T,t))})),Pi(e,t=>{G9(t,T)}),Tl(()=>yr(this,void 0,void 0,function*(){T.remove()})),{content:s}}});const q9={ref:"content"};function H9(e,s,u,d,b,E){return ja(),Gs("div",q9,[Ac(e.$slots,"default")],512)}rO.render=H9;const Z9=e=>cl(e),W9=(e,s)=>yr(void 0,void 0,void 0,function*(){(yield e.promise).addControl(s)});var aO=mo({name:"MapboxAttributionControl",props:{compact:{type:Boolean,default:!1},customAttribution:{type:[String,Array],default:void 0}},setup(e){const s=Z9(e),u=new kc.AttributionControl(s),d=vr("vmb_map",null);Ua(()=>yr(this,void 0,void 0,function*(){d&&W9(d,u)})),Tl(()=>yr(this,void 0,void 0,function*(){d&&(yield d.promise).removeControl(u)}))}});function X9(e,s,u,d,b,E){return ja(),Gs("div")}aO.render=X9;const Y9=e=>{const{maxWidth:s,unit:u}=e;return{maxWidth:s,unit:u}},K9=(e,s)=>yr(void 0,void 0,void 0,function*(){(yield e.promise).addControl(s)});var sO=mo({name:"MapboxScaleControl",props:{maxWidth:{type:Number,default:100},unit:{type:String,default:"metric"}},setup(e){const s=Y9(e),u=new kc.ScaleControl(s),d=vr("vmb_map",null);Ua(()=>yr(this,void 0,void 0,function*(){d&&(yield K9(d,u))})),Tl(()=>yr(this,void 0,void 0,function*(){d&&(yield d.promise).removeControl(u)}))}});function J9(e,s,u,d,b,E){return ja(),Gs("div")}sO.render=J9;const Q9=e=>cl(e),eW=(e,s)=>yr(void 0,void 0,void 0,function*(){(yield s.promise).addControl(e)});var oO=mo({name:"MapboxFullscreenControl",props:{container:{type:Object,default:void 0}},setup(e){const s=vr("vmb_map",null),u=Q9(e),d=new kc.FullscreenControl(u);Ua(()=>yr(this,void 0,void 0,function*(){s&&(yield eW(d,s))})),Tl(()=>yr(this,void 0,void 0,function*(){s&&(yield s.promise).removeControl(d)}))}});function tW(e,s,u,d,b,E){return ja(),Gs("div")}oO.render=tW;const nW=e=>cl(e,["position"]),iW=(e,s)=>{e.on("draw.create",u=>{s.emit("create",u)}),e.on("draw.update",u=>{s.emit("update",u)}),e.on("draw.delete",u=>{s.emit("delete",u)}),e.on("draw.selectionchange",u=>{s.emit("selectionchange",u)})},rW=(e,s,u,d)=>yr(void 0,void 0,void 0,function*(){d.emit("loaded",s);const b=yield e.promise;iW(b,d),b.addControl(s,u.position)});var lO=mo({name:"MapboxDrawControl",props:{position:{type:String,default:"top-left"}},setup(e){const s=nW(e),u=new kw,d=vr("vmb_map",null);Ua(()=>yr(this,void 0,void 0,function*(){const b=jf();d&&b&&rW(d,u,s,b)})),Tl(()=>yr(this,void 0,void 0,function*(){d&&(yield d.promise).removeControl(u)}))}});function aW(e,s,u,d,b,E){return ja(),Gs("div")}lO.render=aW;var cO=mo({name:"MapboxSourceGeoJson",props:{container:{type:Object,default:void 0}},setup(e){const s=vr("vmb_map",null);new gC.GeoJSONSource,Ua(()=>yr(this,void 0,void 0,function*(){s&&(yield s.promise).addSource}))}});const sW={ref:"features"};function oW(e,s,u,d,b,E){return ja(),Gs("div",sW,[Ac(e.$slots,"default")],512)}cO.render=oW;const lW=e=>cl(e);var uO=mo({name:"MapboxGeolocateControl",props:{positionOptions:{type:Object,default:()=>({enableHighAccuracy:!1,timeout:6e3})},fitBoundsOptions:{type:Object,default:()=>({maxZoom:15})},trackUserLocation:{type:Boolean,default:!1},showAccuracyCircle:{type:Boolean,default:!0},showUserLocation:{type:Boolean,default:!0}},setup(e){const s=vr("vmb_map",null),u=lW(e),d=new kc.GeolocateControl(u);Ua(()=>yr(this,void 0,void 0,function*(){s&&(yield s.promise).addControl(d)})),Tl(()=>yr(this,void 0,void 0,function*(){s&&(yield s.promise).removeControl(d)}))}});function cW(e,s,u,d,b,E){return ja(),Gs("div")}uO.render=cW;class Lw{constructor(s){this.id=s.id,this.fillColor=s.fillColor||"#4668F2",this.antialias=typeof s.antialias=="boolean"?s.antialias:!0,this.opacity=typeof s.opacity=="number"?s.opacity:.6,s.outlineColor&&(this.outlineColor=s.outlineColor),this.deferred=new ry,xa("vmb_geogeometry",this.deferred)}updateOptions(s){s.fillColor&&(this.fillColor=s.fillColor),typeof s.antialias=="boolean"&&(this.antialias=s.antialias),typeof s.opacity=="number"&&(this.opacity=s.opacity),s.outlineColor&&(this.outlineColor=s.outlineColor)}getPaint(){const s={};return this.fillColor&&(s["fill-color"]=this.fillColor),this.antialias&&(s["fill-antialias"]=this.antialias),this.opacity&&(s["fill-opacity"]=this.opacity),this.outlineColor&&(s["fill-outline-color"]=this.outlineColor),s}getLayer(){return{id:this.id,type:"fill",source:this.id,layout:{},paint:this.getPaint()}}}class uW extends Lw{constructor(s){super(s),this.edges=s.edges||10,this.radius=s.radius,this.center=s.center}updateOptions(s){super.updateOptions(s),s.edges&&(this.edges=s.edges),s.radius&&(this.radius=s.radius),s.center&&(this.center=s.center)}getGeoJSON(){const s=this.edges,u=Lx(this.radius,this.center[1]),d=Rx(this.radius),b=[];for(let E=0;E<s;E++){const T=E/s*(2*Math.PI),t=u*Math.cos(T),G=d*Math.sin(T);b.push([this.center[0]+t,this.center[1]+G])}return b.push(b[0]),{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Polygon",coordinates:[b]},properties:{}}]}}}}class hO{constructor(s){this.geogeometry=s.geogeometry,this.deferred=new ry,xa("vmb_geogeometry_paint",this.deferred)}_init(s,u){return yr(this,void 0,void 0,function*(){const d=yield this.geogeometry.promise;this.geoId=d.id,this.id=`${this.geoId}-${s}-${u}`})}setGeoId(s){this.geoId=s}}let Mk=0;class hW extends hO{constructor(s){super(s),this.geoId=s.geoId,this.id=`${s.geoId}-fill-${Mk++}`,this.color=s.color||"#4668F2",this.antialias=typeof s.antialias=="boolean"?s.antialias:!0,this.opacity=typeof s.opacity=="number"?s.opacity:.6,s.outlineColor&&(this.outlineColor=s.outlineColor)}init(){const s=Object.create(null,{_init:{get:()=>super._init}});return yr(this,void 0,void 0,function*(){yield s._init.call(this,"fill",Mk++)})}getPaint(){const s={};return this.color&&(s["fill-color"]=this.color),this.antialias&&(s["fill-antialias"]=this.antialias),this.opacity&&(s["fill-opacity"]=this.opacity),this.outlineColor&&(s["fill-outline-color"]=this.outlineColor),s}update(s,u){return yr(this,void 0,void 0,function*(){const d=yield u.promise,b=cl(s);this.id&&(b.color&&b.color!==this.color&&(d.setPaintProperty(this.id,"fill-color",b.color),this.color=b.color),typeof b.antialias=="boolean"&&b.antialias!==this.antialias&&(d.setPaintProperty(this.id,"fill-antialias",b.antialias),this.antialias=b.antialias),typeof b.opacity=="number"&&b.opacity!==this.opacity&&(d.setPaintProperty(this.id,"fill-opacity",b.opacity),this.opacity=b.opacity),b.outlineColor&&b.outlineColor!==this.outlineColor&&(d.setPaintProperty(this.id,"fill-outline-color",b.outlineColor),this.outlineColor=b.outlineColor))})}getLayer(){if(this.id)return{id:this.id,type:"fill",source:this.geoId,layout:{},paint:this.getPaint()};throw new Error("Geogeometry.Paint.Fill: Cannot get layer. Not initialized")}}var wv=mo({name:"MapboxGeogeometryFill",props:{color:{type:String,default:"#4668F2"},antialias:{type:Boolean,default:!0},opacity:{type:Number,default:.6},outlineColor:{type:String}},setup(e){const s=vr("vmb_geogeometry",null),u=new ry,d=vr("vmb_map",null);if(!s)throw new Error("MapboxGeogeometryFill: no geogeometry found as parent");const b=new hW(Object.assign(Object.assign({},cl(e)),{geogeometry:s}));return xa("vmb_fill",u),Ua(()=>yr(this,void 0,void 0,function*(){if(d&&s){const E=yield d.promise;(yield s.promise)&&E&&(yield b.init(),E.addLayer(b.getLayer()),u.resolve(b),b.deferred.resolve(b))}})),Pi(e,()=>yr(this,void 0,void 0,function*(){const E=yield u.promise;E&&d&&E.update(e,d)})),Tl(()=>yr(this,void 0,void 0,function*(){d&&b.id&&(yield d.promise).removeLayer(b.id)})),{}}});function dW(e,s,u,d,b,E){return ja(),Gs("div",null,[Ac(e.$slots,"default")])}wv.render=dW;let fW=0;var dO=mo({name:"MapboxGeogeometryCircle",components:{MapboxGeogeometryFill:wv},props:{id:{type:String,default:"circle"},center:{type:Array,required:!0},radius:{type:Number,required:!0},edges:{type:Number,default:10},fillColor:{type:String},outlineColor:{type:String},opacity:{type:Number},antialias:{type:Boolean}},setup(e){const s=vr("vmb_map",null),u=new Tw,d=`${e.id}-${fW++}`,b=new uW(cl(Object.assign(Object.assign({},e),{id:d}),["id","radius","center","edges","fillColor","outlineColor","opacity","antialias"]));xa("vmb_circle",u),Ua(()=>yr(this,void 0,void 0,function*(){s&&(yield Dw(s,b),u.resolve(b),b.deferred.resolve(b))})),Pi(e,()=>yr(this,void 0,void 0,function*(){s&&(yield Rw(e,s,b))})),Tl(()=>yr(this,void 0,void 0,function*(){s&&(yield s.promise).removeLayer(b.id)}))}});const pW={ref:"features"};function mW(e,s,u,d,b,E){const T=Ul("mapbox-geogeometry-fill");return ja(),Gs("div",pW,[Ac(e.$slots,"default",{},()=>[de(T,{color:e.fillColor,outlineColor:e.outlineColor,opacity:e.opacity,antialias:e.antialias},{default:fh(()=>[Ac(e.$slots,"popup")]),_:3},8,["color","outlineColor","opacity","antialias"])])],512)}dO.render=mW;class gW extends Lw{constructor(s){super(s),this.path=s.path}updateOptions(s){super.updateOptions(s),s.path&&(this.path=s.path)}get center(){const s=this.path.reduce((u,d)=>[u[0]+d[0],u[1]+d[1]]);return[s[0]/this.path.length,s[1]/this.path.length]}getGeoJSON(){return{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Polygon",coordinates:[this.path]},properties:{}}]}}}}let _W=0;var fO=mo({name:"MapboxGeogeometryPolygon",components:{MapboxGeogeometryFill:wv},props:{id:{type:String,default:"polygon"},path:{type:Array,required:!0},fillColor:{type:String},outlineColor:{type:String},opacity:{type:Number},antialias:{type:Boolean}},setup(e){const s=vr("vmb_map",null),u=new Tw,d=`${e.id}-${_W++}`,b=new gW(cl(Object.assign(Object.assign({},e),{id:d}),["id","path","fillColor","outlineColor","opacity","antialias"]));xa("vmb_polygon",u),Ua(()=>yr(this,void 0,void 0,function*(){s&&(yield Dw(s,b),u.resolve(b),b.deferred.resolve(b))})),Pi(e,()=>yr(this,void 0,void 0,function*(){s&&(b.updateOptions(e),yield Rw(e,s,b))})),Tl(()=>yr(this,void 0,void 0,function*(){s&&(yield s.promise).removeLayer(b.id)}))}});const yW={ref:"features"};function vW(e,s,u,d,b,E){const T=Ul("mapbox-geogeometry-fill");return ja(),Gs("div",yW,[Ac(e.$slots,"default",{},()=>[de(T,{color:e.fillColor,outlineColor:e.outlineColor,opacity:e.opacity,antialias:e.antialias},{default:fh(()=>[Ac(e.$slots,"popup")]),_:3},8,["color","outlineColor","opacity","antialias"])])],512)}fO.render=vW;const xW=(e,s)=>{if(e.length!==4)throw"MapboxGeogeometryRectangle.rotateRectagle: Not a rectangle. Please supply exactly four coordinates";const u=s*Math.PI/180,d=[];for(let b=0;b<e.length;b++)d.push([e[b][0]*Math.cos(u)-e[b][1]*Math.sin(u),e[b][0]*Math.sin(u)+e[b][1]*Math.cos(u)]);return d};class bW extends Lw{constructor(s){super(s),this.width=s.width,this.height=s.height,this.center=s.center,this.rotationDeg=s.rotationDeg||0}updateOptions(s){super.updateOptions(s),s.width&&(this.width=s.width),s.height&&(this.height=s.height),typeof s.rotationDeg=="number"&&s.rotationDeg!==this.rotationDeg&&(this.rotationDeg=s.rotationDeg)}get coordinates(){const s=xW([[this.width/2,this.height/2],[-this.width/2,this.height/2],[-this.width/2,-this.height/2],[this.width/2,-this.height/2]],this.rotationDeg);return[[this.center[0]+Lx(s[0][0],this.center[1]),this.center[1]+Rx(s[0][1])],[this.center[0]+Lx(s[1][0],this.center[1]),this.center[1]+Rx(s[1][1])],[this.center[0]+Lx(s[2][0],this.center[1]),this.center[1]+Rx(s[2][1])],[this.center[0]+Lx(s[3][0],this.center[1]),this.center[1]+Rx(s[3][1])]]}getGeoJSON(){return{type:"geojson",data:{type:"FeatureCollection",features:[{type:"Feature",geometry:{type:"Polygon",coordinates:[[...this.coordinates,this.coordinates[0]]]},properties:{}}]}}}}let wW=0;var pO=mo({name:"MapboxGeogeometryRectangle",components:{MapboxGeogeometryFill:wv},props:{id:{type:String,default:"rectangle"},center:{type:Array,required:!0},width:{type:Number,required:!0},height:{type:Number,required:!0},fillColor:{type:String},outlineColor:{type:String},opacity:{type:Number,default:.6},antialias:{type:Boolean,default:!0},rotationDeg:{type:Number}},setup(e){const s=vr("vmb_map",null),u=new Tw,d=`${e.id}-${wW++}`,b=new bW(cl(Object.assign(Object.assign({},e),{id:d}),["id","width","height","center","fillColor","outlineColor","opacity","antialias","rotationDeg"]));xa("vmb_rectangle",u),Ua(()=>yr(this,void 0,void 0,function*(){s&&(yield Dw(s,b),u.resolve(b),b.deferred.resolve(b))})),Tl(()=>yr(this,void 0,void 0,function*(){s&&(yield s.promise).removeLayer(b.id)})),Pi(e,()=>yr(this,void 0,void 0,function*(){s&&(yield Rw(e,s,b))}))}});const SW={ref:"features"};function TW(e,s,u,d,b,E){const T=Ul("mapbox-geogeometry-fill");return ja(),Gs("div",SW,[Ac(e.$slots,"default",{},()=>[de(T,{color:e.fillColor,outlineColor:e.outlineColor,opacity:e.opacity,antialias:e.antialias},{default:fh(()=>[Ac(e.$slots,"popup")]),_:3},8,["color","outlineColor","opacity","antialias"])])],512)}pO.render=TW;const CW=e=>e.length<=1?!1:e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1],EW=e=>e.length===0||e[0].length===2&&typeof e[0][0]=="number"&&typeof e[0][1]=="number",mO=(e,s=0,u=[0,0])=>{let d=s;const b=[u[0],u[1]];if(EW(e)){CW(e)&&e.pop();for(const E of e)b[0]=(E[0]+b[0]*d)/(d+1),b[1]=(E[1]+b[1]*d)/(d+1),d++}else for(const E of e){const{visited:T,center:t}=mO(E);b[0]=(b[0]*d+t[0]*T)/(T+d),b[1]=(b[1]*d+t[1]*T)/(T+d),d+=T}return{visited:d,center:b}},gO=(e,s=0,u=[0,0])=>{let d=s;const b=[u[0],u[1]];switch(e.geometry.type){case"Polygon":case"LineString":{const{center:E,visited:T}=mO(e.geometry.coordinates);b[0]=(b[0]*d+E[0]*T)/(T+d),b[1]=(b[1]*d+E[1]*T)/(T+d),d+=T;break}}return{visited:d,center:b}},MW=(e,s=0,u=[0,0])=>{let d=s;const b=[u[0],u[1]];for(const E of e.features){const{center:T,visited:t}=gO(E);b[0]=(b[0]*d+T[0]*t)/(t+d),b[1]=(b[1]*d+T[1]*t)/(t+d),d+=t;break}return{visited:d,center:b}};class IW extends Lw{constructor(s){super(s),this.source=s.source}updateOptions(s){super.updateOptions(s),s.source&&(this.source=s.source)}get center(){const s=this.getGeoJSONData();if(!s||!s.type)return console.warn("Geogeometry Raw: Could not get center. Coordinates could not be obtained"),[0,0];if(s.type==="Feature")return gO(s).center;if(s.type==="FeatureCollection")return MW(s).center;throw new Error("Geogeometry Raw: Unknown Error getting Center")}getGeoJSON(){return this.source.type==="geojson"?this.source:{type:"geojson",data:this.source}}getGeoJSONData(){return this.getGeoJSON().data}}let PW=0;var _O=mo({name:"MapboxGeogeometryRaw",components:{MapboxGeogeometryFill:wv},props:{source:{type:Object,required:!0},id:{type:String,default:"raw"},fillColor:{type:String,default:"red"},outlineColor:{type:String},opacity:{type:Number},antialias:{type:Boolean}},setup(e){const s=vr("vmb_map",null),u=new ry,d=`${e.id}-${PW++}`,b=new IW(cl(Object.assign(Object.assign({},e),{id:d}),["source","id","fillColor","outlineColor","opacity","antialias"]));xa("vmb_raw",u),Ua(()=>yr(this,void 0,void 0,function*(){s&&(yield Dw(s,b),u.resolve(b),b.deferred.resolve(b))})),Pi(e,()=>yr(this,void 0,void 0,function*(){s&&(b.updateOptions(e),yield Rw(e,s,b))})),Tl(()=>yr(this,void 0,void 0,function*(){s&&(yield s.promise).removeLayer(b.id)}))}});const AW={ref:"features"};function kW(e,s,u,d,b,E){return Ul("mapbox-geogeometry-fill"),ja(),Gs("div",AW,[Ac(e.$slots,"default",{},()=>[B5("",!0)])],512)}_O.render=kW;let DW=0;class RW extends hO{constructor(s){super(s),this.color=s.color||"#000",this.opacity=typeof s.opacity=="number"?s.opacity:.6,s.geoId&&(this.geoId=s.geoId),typeof s.blur=="number"&&(this.blur=s.blur),s.cap&&(this.cap=s.cap),s.join&&(this.join=s.join),typeof s.width=="number"&&(this.width=s.width),s.translate&&(this.translate=s.translate),typeof s.offset=="number"&&(this.offset=s.offset),s.dasharray&&(this.dasharray=s.dasharray),typeof s.gapWidth=="number"&&(this.gapWidth=s.gapWidth),s.gradient&&(this.gradient=s.gradient),typeof s.miterLimit=="number"&&(this.miterLimit=s.miterLimit),typeof s.roundLimit=="number"&&(this.roundLimit=s.roundLimit),typeof s.sortKey=="number"&&(this.sortKey=s.sortKey),s.translateAnchor&&(this.translateAnchor=s.translateAnchor)}getPaint(){const s={"line-blur":this.blur,"line-opacity":this.opacity,"line-color":this.color,"line-width":this.width,"line-translate":this.translate,"line-offset":this.offset,"line-dasharray":this.dasharray,"line-gap-width":this.gapWidth,"line-translate-anchor":this.translateAnchor},u=cl(s);return console.log(u),u}getLayout(){const s={"line-cap":this.cap,"line-join":this.join,"line-miter-limit":this.miterLimit,"line-round-limit":this.roundLimit,"line-sort-key":this.sortKey},u=cl(s);return console.log(u),u}init(){return super._init("line",DW++),this}update(s,u){return yr(this,void 0,void 0,function*(){const d=yield u.promise,b=cl(s);this.id&&(b.color&&b.color!==this.color&&(d.setPaintProperty(this.id,"line-color",b.color),this.color=b.color),typeof b.blur=="number"&&b.blur!==this.blur&&(d.setPaintProperty(this.id,"line-blur",b.blur),this.blur=b.blur),b.cap&&b.cap!==this.cap&&(d.setPaintProperty(this.id,"line-cap",b.cap),this.cap=b.cap),b.join&&b.join!==this.join&&(d.setPaintProperty(this.id,"line-join",b.join),this.join=b.join),typeof b.opacity=="number"&&b.opacity!==this.opacity&&(d.setPaintProperty(this.id,"line-opacity",b.opacity),this.opacity=b.opacity),typeof b.width=="number"&&b.width!==this.width&&(d.setPaintProperty(this.id,"line-width",b.width),this.width=b.width),b.translate&&this.translate&&(b.translate[0]!==this.translate[0]||b.translate[1]!==this.translate[1])&&(d.setPaintProperty(this.id,"line-translate",b.translate),this.translate=b.translate),typeof b.offset=="number"&&this.offset!==b.offset&&(d.setPaintProperty(this.id,"line-offset",b.offset),this.offset=b.offset),b.dasharray&&!A1(this.dasharray,b.dasharray)&&(d.setPaintProperty(this.id,"line-dasharray",b.dasharray),this.dasharray=b.dasharray),typeof b.gapWidth=="number"&&this.gapWidth!==b.gapWidth&&(d.setPaintProperty(this.id,"line-gap-width",b.gapWidth),this.gapWidth=b.gapWidth),typeof b.miterLimit=="number"&&this.miterLimit!==b.miterLimit&&(d.setPaintProperty(this.id,"line-miter-limit",b.miterLimit),this.miterLimit=b.miterLimit),typeof b.roundLimit=="number"&&this.roundLimit!==b.roundLimit&&(d.setPaintProperty(this.id,"line-round-limit",b.roundLimit),this.roundLimit=b.roundLimit),typeof b.sortKey=="number"&&(d.setPaintProperty(this.id,"line-sort-key",b.sortKey),this.sortKey=b.sortKey),b.translateAnchor&&this.translateAnchor!==b.translateAnchor&&(d.setPaintProperty(this.id,"line-translate-anchor",b.translateAnchor),this.translateAnchor=b.translateAnchor))})}getLayer(){if(this.id)return{id:this.id,type:"line",source:this.geoId,layout:this.getLayout(),paint:this.getPaint()};throw new Error("Geogeometry.Paint.Line: Cannot get Layer. Not initialized")}}var yO=mo({name:"MapboxGeogeometryLine",props:{blur:{type:Number},cap:{type:String},join:{type:String},opacity:{type:Number,default:1},color:{type:String,default:"#4668F2"},width:{type:Number},translate:{type:Array},offset:{type:Number},dasharray:{type:Array},gapWidth:{type:Number}},setup(e){const s=vr("vmb_geogeometry",null),u=new ry,d=vr("vmb_map",null);if(xa("vmb_paint",u),!s)throw new Error("MapboxGeogeometryLine: no geogeometry found as parent");const b=new RW(Object.assign(Object.assign({},cl(e)),{geogeometry:s}));return Ua(()=>yr(this,void 0,void 0,function*(){if(d&&s){yield b.init();const E=yield d.promise;(yield s.promise)&&E&&(E.addLayer(b.getLayer()),u.resolve(b))}})),Pi(e,()=>yr(this,void 0,void 0,function*(){const E=yield u.promise;E&&d&&E.update(e,d)})),Tl(()=>yr(this,void 0,void 0,function*(){d&&b.id&&(yield d.promise).removeLayer(b.id)})),{}}});function LW(e,s,u,d,b,E){return ja(),Gs("div")}yO.render=LW;var Ik=Object.freeze({__proto__:null,MapboxGeocoderControl:Y3,MapboxMap:bE,MapboxMarker:eO,MapboxNavigationControl:tO,MapboxPopup:rO,MapboxAttributionControl:aO,MapboxScaleControl:sO,MapboxFullscreenControl:oO,MapboxDrawControl:lO,MapboxSourceGeoJson:cO,MapboxGeolocateControl:uO,MapboxGeogeometryCircle:dO,MapboxGeogeometryPolygon:fO,MapboxGeogeometryRectangle:pO,MapboxGeogeometryRaw:_O,MapboxGeogeometryFill:wv,MapboxGeogeometryLine:yO}),zW=e=>{Object.keys(Ik).forEach(s=>{e.component(s,Ik[s])})};const OW=oL({components:zZ,directives:ZZ,theme:{defaultTheme:"dark"}});C4(AV).use(OW).use(zW).use(o6).mount("#app");
